2025-07-18 04:22:53,934 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-18 04:22:54,902 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-18 04:22:54,902 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-18 04:22:54,902 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-18 04:22:54,903 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-18 04:22:54,941 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-18 04:22:54,941 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-18 04:22:55,702 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:22:55,702 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 4, Symbol AUDJPY, Pos 1 (ID: 1572): Type=BUY, Qty=10.00000000, StoredMargin=3249.77540855
2025-07-18 04:22:55,702 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 4, Symbol AUDJPY, Pos 1: MarginPerLot=324.977540855
2025-07-18 04:22:55,702 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:22:55,702 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:22:55,702 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:22:55,702 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 3249.78
2025-07-18 04:22:55,703 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:22:55,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-18 04:22:55,805 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 9, Symbol BTCUSD, Pos 1 (ID: 1567): Type=BUY, Qty=0.35000000, StoredMargin=8271.68000000
2025-07-18 04:22:55,805 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 9, Symbol BTCUSD, Pos 1: MarginPerLot=23633.37142857142857142857143
2025-07-18 04:22:55,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.35000000, TotalSellQty=0, NetQty=0.35000000, IsHedged=False
2025-07-18 04:22:55,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23633.37142857142857142857143')], HighestMarginPerLot=23633.37142857142857142857143
2025-07-18 04:22:55,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=8271.68
2025-07-18 04:22:55,805 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 8271.68
2025-07-18 04:22:55,805 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 8271.68
2025-07-18 04:22:55,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:22:55,854 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:22:55,854 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:22:55,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:22:55,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:22:55,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:22:55,854 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:22:55,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:22:55,854 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:22:55,854 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:22:55,854 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:22:55,854 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:22:55,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:22:55,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:22:55,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:22:55,854 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:22:55,854 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:22:55,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-18 04:22:55,938 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 26, Symbol XAGUSD, Pos 1 (ID: 1523): Type=BUY, Qty=0.01000000, StoredMargin=19.54000000
2025-07-18 04:22:55,938 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 26, Symbol XAGUSD, Pos 1: MarginPerLot=1954
2025-07-18 04:22:55,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:22:55,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-18 04:22:55,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-18 04:22:55,938 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol XAGUSD: 19.54
2025-07-18 04:22:55,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-18 04:22:55,938 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 26, Symbol BTCUSD, Pos 1 (ID: 1524): Type=BUY, Qty=6.00000000, StoredMargin=146464.93000000
2025-07-18 04:22:55,938 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 26, Symbol BTCUSD, Pos 1: MarginPerLot=24410.82166666666666666666667
2025-07-18 04:22:55,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-18 04:22:55,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-18 04:22:55,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-18 04:22:55,939 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 146464.93
2025-07-18 04:22:55,939 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-18 04:22:55,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:22:55,952 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:22:55,952 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:22:55,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:22:55,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:22:55,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:22:55,952 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:22:55,952 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:00,752 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-18 04:23:00,754 - DEBUG - orders - Starting the optimized SL/TP checker task (triggered by market updates).
2025-07-18 04:23:00,912 - DEBUG - orders - Updated users with orders cache
2025-07-18 04:23:00,979 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:00,979 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:00,979 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:00,979 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:00,979 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:00,979 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:00,979 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:23:00,979 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:01,485 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:23:01,485 - INFO - orders - Using order model: UserOrder
2025-07-18 04:23:01,487 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:23:01,489 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:23:01,490 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:23:01,490 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:23:01,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:23:01,493 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:23:01,493 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:23:01,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:23:01,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:23:01,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:23:01,493 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:23:01,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:23:01,493 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:23:01,493 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:23:01,493 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:23:01,493 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:23:01,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:23:01,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:23:01,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:23:01,493 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:23:01,493 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:23:01,498 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:23:01,667 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'GBPAUD', 'USDJPY', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURPLN', 'USDCHF', 'CADJPY', 'GBPUSD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'CHFJPY', 'AUDCHF', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:01,689 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:01,723 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:01,726 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:01,784 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:02,980 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-18 04:23:03,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:03,796 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:03,796 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:03,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:03,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:03,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:03,796 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:23:03,797 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:04,238 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:04,249 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:04,261 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:04,282 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:04,303 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:04,352 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:04,945 - INFO - orders - Starting the users with orders cache updater task.
2025-07-18 04:23:04,997 - DEBUG - orders - Updated users with orders cache for all symbols
2025-07-18 04:23:06,213 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'JP225', 'USDCHF', 'EURCAD', 'CADJPY', 'US30', 'GBPUSD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:06,221 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:06,233 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:23:06,243 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:06,256 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:06,271 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:06,312 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:06,314 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:23:08,568 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:08,578 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:23:08,599 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:08,611 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:08,631 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:08,668 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:08,670 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:23:09,732 - INFO - orders - Cancel takeprofit request received - Order ID: 1094-001, User ID: 1
2025-07-18 04:23:09,763 - INFO - orders - User 1 is_barclays_live_user: False
2025-07-18 04:23:09,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:09,867 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:09,867 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:09,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:09,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:09,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:09,867 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:23:09,867 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:09,882 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:09,882 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:09,882 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:09,882 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:09,882 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:09,882 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:09,882 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:23:09,883 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:09,886 - INFO - orders - Background balance/margin cache updated for user 1: balance=16451.87000000, margin=6.52
2025-07-18 04:23:09,889 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:23:10,832 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'EURNZD', 'EURSEK', 'SGDJPY', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'NOKSEK', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:10,837 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:10,868 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:10,873 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:13,122 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURZAR', 'AUDJPY', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'GBPUSD', 'CHFSGD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:13,128 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:13,138 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:13,155 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:15,426 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'AUDJPY', 'EURPLN', 'SGDJPY', 'EURCAD', 'CADJPY', 'GBPUSD', 'CHFSGD', 'AUDCAD', 'D30', 'NZDCAD', 'EURUSD', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:15,435 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:15,456 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:15,463 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:15,472 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:17,783 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'USDJPY', 'CADCHF', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'CHFSGD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:17,785 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:17,799 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:20,036 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:20,048 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:23:20,066 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:20,076 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:20,121 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:23:22,327 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'EURNZD', 'EURZAR', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:23:22,332 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:22,342 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:23:22,357 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:22,362 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:22,399 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:23:23,773 - INFO - orders - Add stoploss request received - Order ID: 1094-001, User ID: 1
2025-07-18 04:23:23,799 - INFO - orders - Generated stoploss_id: 1101-005 for order 1094-001
2025-07-18 04:23:23,802 - INFO - orders - User 1 is_barclays_live_user: False
2025-07-18 04:23:23,803 - INFO - orders - Non-Barclays user. Adding stoploss to order 1094-001 immediately
2025-07-18 04:23:23,912 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:23,912 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:23,912 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:23,912 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:23,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:23,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:23,913 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:23:23,913 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:23,967 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:23,967 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:23,967 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:23,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:23,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:23,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:23,968 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:23:23,968 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:23,975 - INFO - orders - Background balance/margin cache updated for user 1: balance=16451.87000000, margin=6.52
2025-07-18 04:23:23,978 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:23:24,632 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:24,647 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:24,656 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:23:24,689 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:24,702 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:24,741 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:24,741 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:23:26,995 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:27,020 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:27,029 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:27,038 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:27,059 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:29,219 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'GBPAUD', 'BTCUSD', 'CADCHF', 'EURNZD', 'AUDJPY', 'SGDJPY', 'JP225', 'EURCAD', 'CADJPY', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:29,226 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:23:29,247 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:29,256 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:29,294 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:29,304 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:23:31,534 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'USDZAR', 'SGDJPY', 'EURCAD', 'USDNOK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:31,537 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:31,547 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:31,569 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:31,600 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:33,860 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:33,874 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:33,879 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:36,124 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:36,136 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:36,140 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:23:36,166 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:36,191 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:36,207 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:36,242 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:23:36,243 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:40,891 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'EURNZD', 'USDSGD', 'EURZAR', 'USDZAR', 'SGDJPY', 'EURCAD', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:40,897 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:40,960 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:40,991 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:41,038 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:41,040 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'GBPAUD', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'CHFJPY', 'EURUSD', 'EURSGD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:23:41,046 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:41,050 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:41,079 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:41,745 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:23:41,745 - INFO - orders - Using order model: UserOrder
2025-07-18 04:23:41,748 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:23:41,751 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:23:41,752 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:23:41,752 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:23:41,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:23:41,757 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:23:41,757 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:23:41,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:23:41,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:23:41,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:23:41,758 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:23:41,758 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:23:41,758 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:23:41,758 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:23:41,758 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:23:41,758 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:23:41,758 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:23:41,758 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:23:41,758 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:23:41,759 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:23:41,759 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:23:41,763 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:23:43,065 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'GBPAUD', 'CADCHF', 'EURNZD', 'EURSEK', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'GBPNZD', 'NZDCAD', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:23:43,092 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:43,096 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:43,125 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1094-001 (handled by service provider)
2025-07-18 04:23:45,222 - INFO - orders - Cancel stoploss request received - Order ID: 1094-001, User ID: 1
2025-07-18 04:23:45,241 - INFO - orders - User 1 is_barclays_live_user: False
2025-07-18 04:23:45,312 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:45,327 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:45,327 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:45,328 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:45,328 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:45,328 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:45,331 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:23:45,332 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:45,340 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'USDZAR', 'SGDJPY', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:45,362 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:45,422 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:45,428 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:45,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:45,476 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:45,477 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:45,477 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:45,477 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:45,477 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:45,477 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:23:45,477 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:45,486 - INFO - orders - Background balance/margin cache updated for user 1: balance=16451.87000000, margin=6.52
2025-07-18 04:23:45,493 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:23:47,675 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'BTCUSD', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'JP225', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'GBPNZD', 'D30', 'NZDCAD', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD'], triggering optimized SL/TP check
2025-07-18 04:23:47,690 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:23:47,692 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:47,703 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:47,758 - INFO - orders - Order close request received - Order ID: 1094-001, User ID: 1, Close Price: 0.89497
2025-07-18 04:23:47,759 - DEBUG - orders - user_to_operate_on: <app.database.models.DemoUser object at 0x000001F0064C4050>, type: <class 'app.database.models.DemoUser'>, user_type: demo, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'city', 'country', 'created_at', 'demo_user_favorites', 'email', 'group_name', 'hashed_password', 'id', 'isActive', 'is_service_account', 'leverage', 'margin', 'metadata', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-18 04:23:47,759 - DEBUG - orders - Using order model: demo_user_orders for user 1 (user_type: demo)
2025-07-18 04:23:47,759 - INFO - orders - Request to close order 1094-001 for user 1 (user_type: demo) with price 0.89497. Frontend provided type: BUY, company: AUDCAD, status: CLOSED, frontend_status: CLOSED.
2025-07-18 04:23:47,771 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:47,847 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:47,877 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-18 04:23:47,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:23:47,901 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 757): Type=BUY, Qty=0.01000000, StoredMargin=6.52460761
2025-07-18 04:23:47,901 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.460761
2025-07-18 04:23:47,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:47,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.460761')], HighestMarginPerLot=652.460761
2025-07-18 04:23:47,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:23:47,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:23:47,916 - INFO - orders - Existing entry commission for order 1094-001: 0.10000000
2025-07-18 04:23:47,916 - INFO - orders - Commission calculation for order 1094-001: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-18 04:23:47,916 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.090000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 1094-001)
2025-07-18 04:23:47,917 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:23:47,918 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:23:47,918 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:23:47,919 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:23:47,919 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:23:47,921 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3720400000'), 'o': Decimal('1.3720100000')}
2025-07-18 04:23:47,921 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3720400000
2025-07-18 04:23:47,921 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.090000000000000000000000 CAD / 1.3720400000 = -0.06559575522579516632168158363 USD
2025-07-18 04:23:47,971 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=16451.60000000, margin=0
2025-07-18 04:23:48,006 - INFO - orders - Background balance/margin cache updated for user 1: balance=16451.60000000, margin=0.0
2025-07-18 04:23:48,025 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:23:49,909 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'GBPAUD', 'USDJPY', 'EURNZD', 'AUDJPY', 'EURSEK', 'USDCZK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'NZDUSD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:49,912 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:49,936 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:51,525 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-18 04:23:51,854 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.9040000000', 'o': '96.8980000000'}
2025-07-18 04:23:51,854 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.9040000000, ask=96.91369040000000
2025-07-18 04:23:51,854 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.9040000000, ask=96.91369040000000
2025-07-18 04:23:51,856 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 969.14 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:23:51,856 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-18 04:23:51,859 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:23:51,859 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-18 04:23:51,860 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-18 04:23:51,862 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('148.5490000000'), 'o': Decimal('148.5440000000')}
2025-07-18 04:23:51,862 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 148.5490000000
2025-07-18 04:23:51,863 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 969.14 JPY / 148.5490000000 = 6.524042571811321516805902430 USD
2025-07-18 04:23:51,863 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 96.91369040000000, Margin: 6.524042571811321516805902430, Commission: 0.10
2025-07-18 04:23:51,863 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.524042571811321516805902430
2025-07-18 04:23:51,863 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-18 04:23:51,863 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.524042571811321516805902430
2025-07-18 04:23:51,863 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-18 04:23:51,864 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-18 04:23:51,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-18 04:23:51,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-18 04:23:51,865 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1 (ID: None): Type=BUY, Qty=0.01, StoredMargin=6.524042571811321516805902430
2025-07-18 04:23:51,865 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1: MarginPerLot=652.4042571811321516805902430
2025-07-18 04:23:51,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-18 04:23:51,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.4042571811321516805902430')], HighestMarginPerLot=652.4042571811321516805902430
2025-07-18 04:23:51,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.52
2025-07-18 04:23:51,867 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-18 04:23:51,867 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.52, AdditionalMargin: 6.52, OpenOrders: 0
2025-07-18 04:23:51,867 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.524042571811321516805902430
2025-07-18 04:23:51,895 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=16451.60000000, margin=6.52000000 (was 0E-8)
2025-07-18 04:23:51,895 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-18 04:23:51,895 - INFO - orders - [PERF] Order processing: 0.3659s
2025-07-18 04:23:51,896 - DEBUG - orders - [DEBUG][create_user_order] Received order_data: {'order_id': '1106-001', 'order_status': 'OPEN', 'order_user_id': 1, 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_price': Decimal('96.954'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.00'), 'margin': Decimal('6.524042571811321516805902430'), 'commission': Decimal('0.10'), 'status': 'OPEN', 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'close_id': None}
2025-07-18 04:23:51,896 - DEBUG - orders - [DEBUG][create_user_order] Created OrderActionHistory record for order_id: 1106-001
2025-07-18 04:23:51,915 - INFO - orders - [PERF] Order creation: 0.0195s
2025-07-18 04:23:51,915 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-18 04:23:51,915 - INFO - orders - [PERF] TOTAL place_order: 0.3936s
2025-07-18 04:23:51,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-18 04:23:51,952 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1 (ID: 758): Type=BUY, Qty=0.01000000, StoredMargin=6.52404257
2025-07-18 04:23:51,952 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1: MarginPerLot=652.404257
2025-07-18 04:23:51,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:51,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.404257')], HighestMarginPerLot=652.404257
2025-07-18 04:23:51,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.52
2025-07-18 04:23:51,952 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 6.52
2025-07-18 04:23:51,952 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:51,975 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-18 04:23:51,975 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1 (ID: 758): Type=BUY, Qty=0.01000000, StoredMargin=6.52404257
2025-07-18 04:23:51,976 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1: MarginPerLot=652.404257
2025-07-18 04:23:51,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:23:51,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.404257')], HighestMarginPerLot=652.404257
2025-07-18 04:23:51,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.52
2025-07-18 04:23:51,976 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 6.52
2025-07-18 04:23:51,976 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:23:51,980 - INFO - orders - Background balance/margin cache updated for user 1: balance=16451.60000000, margin=6.52
2025-07-18 04:23:52,445 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:52,473 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:23:52,482 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:23:52,492 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:52,500 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:54,497 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'JP225', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'CHFJPY', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:54,526 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:23:54,538 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:54,542 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:56,792 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'CADCHF', 'EURNZD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:56,811 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:56,829 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:23:56,834 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:23:59,154 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'EURCAD', 'USDNOK', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:23:59,172 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:23:59,186 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:23:59,191 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:01,504 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'AUDJPY', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'CADJPY', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:24:01,516 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:24:01,523 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:24:01,539 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:24:01,565 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:01,572 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:24:01,620 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:24:03,773 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURZAR', 'AUDJPY', 'EURSEK', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:24:03,785 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:24:03,815 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:24:03,843 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:03,860 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:24:05,352 - INFO - orders - Add stoploss request received - Order ID: 1106-001, User ID: 1
2025-07-18 04:24:05,371 - INFO - orders - Generated stoploss_id: 1107-005 for order 1106-001
2025-07-18 04:24:05,374 - INFO - orders - User 1 is_barclays_live_user: False
2025-07-18 04:24:05,374 - INFO - orders - Non-Barclays user. Adding stoploss to order 1106-001 immediately
2025-07-18 04:24:05,413 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-18 04:24:05,413 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1 (ID: 758): Type=BUY, Qty=0.01000000, StoredMargin=6.52404257
2025-07-18 04:24:05,414 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1: MarginPerLot=652.404257
2025-07-18 04:24:05,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:24:05,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.404257')], HighestMarginPerLot=652.404257
2025-07-18 04:24:05,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.52
2025-07-18 04:24:05,414 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 6.52
2025-07-18 04:24:05,414 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:24:05,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-18 04:24:05,456 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1 (ID: 758): Type=BUY, Qty=0.01000000, StoredMargin=6.52404257
2025-07-18 04:24:05,456 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1: MarginPerLot=652.404257
2025-07-18 04:24:05,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:24:05,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.404257')], HighestMarginPerLot=652.404257
2025-07-18 04:24:05,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.52
2025-07-18 04:24:05,456 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 6.52
2025-07-18 04:24:05,456 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:24:05,474 - INFO - orders - Background balance/margin cache updated for user 1: balance=16451.60000000, margin=6.52
2025-07-18 04:24:05,481 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:24:06,019 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:24:06,029 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:24:06,034 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:24:06,058 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:24:06,075 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:06,102 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:24:06,109 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:24:08,285 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'GBPAUD', 'BTCUSD', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:24:08,294 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:24:08,304 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:24:08,324 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:08,333 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:24:08,372 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:24:08,382 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:24:10,587 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'GBPAUD', 'BTCUSD', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD'], triggering optimized SL/TP check
2025-07-18 04:24:10,594 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:24:10,598 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:24:10,617 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:24:10,633 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:10,673 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:24:10,674 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:24:12,892 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:24:12,914 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:24:12,925 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:12,932 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:24:12,969 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:24:15,241 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:24:15,260 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:24:15,261 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:24:15,276 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:24:15,331 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:15,347 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:24:15,363 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:24:15,372 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:24:19,699 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:24:19,725 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:24:19,729 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:24:19,750 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:24:20,578 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:24:20,630 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:24:20,680 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:24:20,747 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:25:21,961 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-18 04:25:22,753 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-18 04:25:22,753 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-18 04:25:22,753 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-18 04:25:22,753 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-18 04:25:22,811 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-18 04:25:22,811 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-18 04:25:23,585 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:25:23,585 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:25:23,585 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:25:23,585 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:25:23,585 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:25:23,585 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:25:23,585 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:25:23,586 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:25:24,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-18 04:25:24,428 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1 (ID: 758): Type=BUY, Qty=0.01000000, StoredMargin=6.52404257
2025-07-18 04:25:24,428 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1: MarginPerLot=652.404257
2025-07-18 04:25:24,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:25:24,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.404257')], HighestMarginPerLot=652.404257
2025-07-18 04:25:24,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.52
2025-07-18 04:25:24,428 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 6.52
2025-07-18 04:25:24,428 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:25:28,125 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-18 04:25:28,126 - DEBUG - orders - Starting the optimized SL/TP checker task (triggered by market updates).
2025-07-18 04:25:28,220 - DEBUG - orders - Updated users with orders cache
2025-07-18 04:25:28,670 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:25:28,670 - INFO - orders - Using order model: UserOrder
2025-07-18 04:25:28,672 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:25:28,674 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:25:28,677 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:25:28,677 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:25:28,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:25:28,680 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:25:28,680 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:25:28,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:25:28,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:25:28,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:25:28,681 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:25:28,681 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:25:28,681 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:25:28,681 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:25:28,681 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:25:28,681 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:25:28,681 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:25:28,681 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:25:28,681 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:25:28,681 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:25:28,681 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:25:28,684 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:25:29,203 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD'], triggering optimized SL/TP check
2025-07-18 04:25:29,207 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:29,227 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:29,229 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:29,235 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:25:29,235 - INFO - orders - Using order model: UserOrder
2025-07-18 04:25:29,241 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:25:29,245 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:25:29,248 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:25:29,248 - DEBUG - orders - [CACHE] static_orders_data for user 25: open_orders=['1031-001'], pending_orders=[]
2025-07-18 04:25:29,251 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:25:29,251 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:25:29,251 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:25:29,251 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:25:29,251 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:25:29,251 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:25:29,251 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:25:29,251 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:25:29,256 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:25:31,511 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:31,515 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:31,530 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:25:31,551 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:31,578 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:31,591 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:31,623 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:31,625 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:25:32,754 - INFO - orders - Starting the users with orders cache updater task.
2025-07-18 04:25:32,793 - DEBUG - orders - Updated users with orders cache for all symbols
2025-07-18 04:25:33,771 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:33,794 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:33,796 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:25:33,808 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:33,831 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:33,844 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:33,862 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:33,867 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:25:36,005 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'SGDJPY', 'JP225', 'EURCAD', 'CADJPY', 'US30', 'EURAUD', 'CHFSGD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:36,025 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:36,065 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:38,283 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:38,290 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:38,298 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:25:38,314 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:38,329 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:38,336 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:38,354 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:38,361 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:25:39,121 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDJPY, Type: SELL_LIMIT, Quantity: 0.01
2025-07-18 04:25:39,186 - ERROR - orders - Could not get current market prices for AUDJPY
2025-07-18 04:25:39,187 - ERROR - orders - Unexpected error in place_order: 500: Could not get current market prices for AUDJPY
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 852, in place_pending_order
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Could not get current market prices for AUDJPY
2025-07-18 04:25:40,583 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'NZDCAD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:40,587 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:40,592 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:25:40,618 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:40,633 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:40,656 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:40,685 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:25:40,688 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:42,892 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'EURUSD', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:42,897 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:42,907 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:25:42,918 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:42,938 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:42,962 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:42,968 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:25:45,160 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'CADJPY', 'EURAUD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'NZDCAD', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:45,179 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:25:45,181 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:45,199 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:45,219 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:45,261 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:45,262 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:25:47,143 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDJPY, Type: SELL_LIMIT, Quantity: 0.01
2025-07-18 04:25:47,154 - ERROR - orders - Could not get current market prices for AUDJPY
2025-07-18 04:25:47,154 - ERROR - orders - Unexpected error in place_order: 500: Could not get current market prices for AUDJPY
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 852, in place_pending_order
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Could not get current market prices for AUDJPY
2025-07-18 04:25:47,593 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:47,599 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:47,624 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:47,636 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:47,640 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:47,693 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:49,771 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'GBPAUD', 'CADCHF', 'EURNZD', 'EURSEK', 'SGDJPY', 'USDCHF', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'GBPNOK', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:25:49,783 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:49,808 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:49,820 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:52,092 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'EURPLN', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:52,107 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:52,121 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:25:52,129 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:52,133 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:52,155 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:25:54,453 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:25:54,482 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:54,488 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:56,638 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'GBPAUD', 'USDCNH', 'CADCHF', 'USDSGD', 'EURZAR', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'GBPNZD', 'EURCHF', 'NZDCAD', 'EURUSD', 'AUDCHF', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:56,652 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:25:56,665 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:58,949 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'GBPAUD', 'BTCUSD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:25:58,971 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:25:58,991 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:25:58,995 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:25:59,029 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:26:01,326 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:26:01,340 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:26:01,344 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:26:01,355 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:26:01,390 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:01,417 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:26:01,420 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:26:05,917 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'CHFJPY', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:26:05,924 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:26:05,979 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:26:06,037 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:26:06,063 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:06,094 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:26:06,098 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:26:06,101 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:26:06,110 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:26:06,118 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:06,156 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:26:06,681 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:26:06,681 - INFO - orders - Using order model: UserOrder
2025-07-18 04:26:06,684 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:26:06,688 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:26:06,690 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:26:06,690 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:26:06,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:26:06,696 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:26:06,697 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:26:06,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:26:06,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:26:06,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:26:06,697 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:26:06,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:26:06,697 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:26:06,697 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:26:06,698 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:26:06,698 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:26:06,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:26:06,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:26:06,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:26:06,698 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:26:06,698 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:26:06,702 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:26:07,731 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:26:07,732 - INFO - orders - Using order model: UserOrder
2025-07-18 04:26:07,737 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:26:07,743 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:26:07,745 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:26:07,745 - DEBUG - orders - [CACHE] static_orders_data for user 25: open_orders=['1031-001'], pending_orders=[]
2025-07-18 04:26:07,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:26:07,751 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:26:07,751 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:26:07,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:26:07,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:26:07,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:26:07,752 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:26:07,752 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:26:07,757 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:26:08,346 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'USDCHF', 'EURCAD', 'USDNOK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:26:08,361 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:26:08,375 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:26:08,382 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:26:08,393 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:08,428 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:26:10,553 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'USDSEK', 'US30', 'GBPUSD', 'CHFSGD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:26:10,577 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:26:10,588 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:26:10,599 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:26:10,609 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:10,643 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:26:12,715 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'CADJPY', 'USDSEK', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:26:12,731 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:26:12,745 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:26:12,753 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:12,772 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 1 order 1106-001 (handled by service provider)
2025-07-18 04:26:15,006 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'USDCNH', 'USDSGD', 'EURZAR', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD'], triggering optimized SL/TP check
2025-07-18 04:26:15,015 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:26:15,039 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:15,783 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY_LIMIT, Quantity: 0.01
2025-07-18 04:26:15,794 - ERROR - orders - Could not get current market prices for AUDCAD
2025-07-18 04:26:15,794 - ERROR - orders - Unexpected error in place_order: 500: Could not get current market prices for AUDCAD
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 852, in place_pending_order
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Could not get current market prices for AUDCAD
2025-07-18 04:26:17,333 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'USDJPY', 'USDSGD', 'USDZAR', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'EURSGD'], triggering optimized SL/TP check
2025-07-18 04:26:17,339 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:26:17,365 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:19,605 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'USDSEK', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:26:19,645 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:22,272 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:26:22,279 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:26:22,283 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:26:22,361 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:26:22,438 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays user 25 order 1031-001 (handled by service provider)
2025-07-18 04:27:30,228 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-18 04:27:31,195 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-18 04:27:31,195 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-18 04:27:31,195 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-18 04:27:31,195 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-18 04:27:31,235 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-18 04:27:31,235 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-18 04:27:36,328 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-18 04:27:36,328 - DEBUG - orders - Starting the optimized SL/TP checker task (triggered by market updates).
2025-07-18 04:27:36,336 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:36,360 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:27:36,418 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:36,437 - WARNING - orders - [SLTP_CHECK] No adjusted price available for BTCUSD in group Group B
2025-07-18 04:27:36,438 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:36,473 - DEBUG - orders - Updated users with orders cache
2025-07-18 04:27:37,017 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:27:37,018 - INFO - orders - Using order model: UserOrder
2025-07-18 04:27:37,020 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:27:37,022 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:27:37,023 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:27:37,023 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:27:37,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:27:37,027 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:27:37,027 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:27:37,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:27:37,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:27:37,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:27:37,027 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:27:37,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:27:37,027 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:27:37,027 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:27:37,027 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:27:37,027 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:27:37,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:27:37,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:27:37,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:27:37,027 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:27:37,027 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:27:37,030 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:27:37,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-18 04:27:37,041 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1 (ID: 758): Type=BUY, Qty=0.01000000, StoredMargin=6.52404257
2025-07-18 04:27:37,041 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1: MarginPerLot=652.404257
2025-07-18 04:27:37,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:27:37,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.404257')], HighestMarginPerLot=652.404257
2025-07-18 04:27:37,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.52
2025-07-18 04:27:37,041 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 6.52
2025-07-18 04:27:37,041 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:27:37,676 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:27:37,676 - INFO - orders - Using order model: UserOrder
2025-07-18 04:27:37,679 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:27:37,682 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:27:37,684 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:27:37,685 - DEBUG - orders - [CACHE] static_orders_data for user 25: open_orders=['1031-001'], pending_orders=[]
2025-07-18 04:27:37,689 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:27:37,689 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:27:37,689 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:27:37,689 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:27:37,689 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:27:37,689 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:27:37,689 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:27:37,689 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:27:37,695 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:27:37,794 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'CADJPY', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'D30', 'NZDCAD', 'EURUSD', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:37,797 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:27:37,798 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:27:37,805 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:27:37,814 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:37,820 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:40,087 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'EURCAD', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:40,090 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:27:40,091 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:27:40,115 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:40,118 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:41,209 - INFO - orders - Starting the users with orders cache updater task.
2025-07-18 04:27:41,233 - DEBUG - orders - Updated users with orders cache for all symbols
2025-07-18 04:27:42,398 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:27:42,410 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:27:42,425 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:27:42,438 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:42,454 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:44,726 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'CADJPY', 'USDSEK', 'US30', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:44,735 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:27:44,768 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:27:44,787 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:47,024 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:47,033 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:27:47,054 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:27:47,082 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:47,090 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:49,271 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:49,306 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:27:49,320 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:49,326 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:51,530 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'USDZAR', 'USDNOK', 'EURAUD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'CHFJPY', 'EURUSD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:51,557 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:27:51,562 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:53,854 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:53,857 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:27:53,876 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:27:53,892 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:53,895 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:56,197 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURSEK', 'EURPLN', 'USDCHF', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:56,208 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:27:56,218 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:27:56,253 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:56,257 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:27:58,419 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'JP225', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:27:58,430 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:27:58,442 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:27:58,457 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:27:58,465 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:28:00,814 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:00,816 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:00,839 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 3 users
2025-07-18 04:28:00,859 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:28:00,883 - WARNING - orders - [SLTP_CHECK] Stop loss triggered for BUY order 1106-001 at 96.84400000000001 <= 96.84500000 (diff: 0.00099999999999, epsilon: 0.00001, reason: exact match)
2025-07-18 04:28:00,891 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-18 04:28:00,891 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1 (ID: 758): Type=BUY, Qty=0.01000000, StoredMargin=6.52404257
2025-07-18 04:28:00,891 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDJPY, Pos 1: MarginPerLot=652.404257
2025-07-18 04:28:00,891 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:00,892 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.404257')], HighestMarginPerLot=652.404257
2025-07-18 04:28:00,892 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.52
2025-07-18 04:28:00,892 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-18 04:28:00,901 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -109.9999999999900000000000000 JPY to USD for PnL on Close (user_id: 1, position: 1106-001)
2025-07-18 04:28:00,901 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-18 04:28:00,902 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:28:00,902 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-18 04:28:00,902 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-18 04:28:00,903 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('148.5550000000'), 'o': Decimal('148.5520000000')}
2025-07-18 04:28:00,903 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 148.5550000000
2025-07-18 04:28:00,903 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -109.9999999999900000000000000 JPY / 148.5550000000 = -0.7404664938910841102621924540 USD
2025-07-18 04:28:00,982 - INFO - orders - [ORDER_CLOSE] Successfully closed order 1106-001 for user 1
2025-07-18 04:28:00,994 - INFO - orders - Balance/margin cache updated for user 1: balance=16450.66000000, margin=0E-8
2025-07-18 04:28:03,040 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:03,055 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:03,068 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:03,087 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:28:05,409 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:05,413 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:05,417 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:05,441 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:05,453 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:05,463 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:28:06,207 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-18 04:28:07,672 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'EURPLN', 'SGDJPY', 'JP225', 'EURCAD', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:07,679 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:07,685 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:07,715 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:07,720 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:28:09,976 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD'], triggering optimized SL/TP check
2025-07-18 04:28:10,002 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:10,024 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:10,034 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:28:11,754 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:28:11,754 - INFO - orders - Using order model: UserOrder
2025-07-18 04:28:11,757 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:28:11,760 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:28:11,761 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:28:11,762 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:28:11,766 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:28:11,766 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:28:11,766 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:28:11,767 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:28:11,767 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:28:11,767 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:28:11,767 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:28:11,767 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:28:11,767 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:28:11,767 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:28:11,767 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:28:11,767 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:28:11,767 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:28:11,767 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:28:11,767 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:28:11,768 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:28:11,768 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:28:11,772 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:28:12,231 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'BTCUSD', 'CADCHF', 'EURNZD', 'EURZAR', 'USDZAR', 'SGDJPY', 'JP225', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:12,252 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:12,256 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:12,282 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:13,034 - INFO - orders - Order placement request received - User: 1, Symbol: AUDCAD, Type: BUY
2025-07-18 04:28:13,039 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:28:13,039 - INFO - orders - Using order model: UserOrder
2025-07-18 04:28:13,316 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:28:13,322 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:28:13,326 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:28:13,327 - DEBUG - orders - [CACHE] static_orders_data for user 25: open_orders=['1031-001'], pending_orders=[]
2025-07-18 04:28:13,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:28:13,336 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:28:13,336 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:28:13,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:28:13,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:28:13,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:28:13,337 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:28:13,337 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:28:13,342 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8951000000', 'o': '0.8950400000'}
2025-07-18 04:28:13,343 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8951000000, ask=0.89518951000000
2025-07-18 04:28:13,343 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8951000000, ask=0.89518951000000
2025-07-18 04:28:13,345 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.95 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:28:13,346 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:28:13,347 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:28:13,348 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:28:13,348 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:28:13,348 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:28:13,350 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3722300000'), 'o': Decimal('1.3722000000')}
2025-07-18 04:28:13,350 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3722300000
2025-07-18 04:28:13,350 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.95 CAD / 1.3722300000 = 6.522230238371118544267360428 USD
2025-07-18 04:28:13,350 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: BUY, Qty: 0.01, Price: 0.89518951000000, Margin: 6.522230238371118544267360428, Commission: 0.10
2025-07-18 04:28:13,350 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDCAD, OrderType: BUY, Quantity: 0.01, FullMargin: 6.522230238371118544267360428
2025-07-18 04:28:13,350 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-18 04:28:13,351 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.522230238371118544267360428
2025-07-18 04:28:13,351 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-18 04:28:13,351 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-18 04:28:13,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:28:13,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:13,351 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: None): Type=BUY, Qty=0.01, StoredMargin=6.522230238371118544267360428
2025-07-18 04:28:13,351 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.2230238371118544267360428
2025-07-18 04:28:13,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-18 04:28:13,352 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.2230238371118544267360428')], HighestMarginPerLot=652.2230238371118544267360428
2025-07-18 04:28:13,352 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:13,355 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-18 04:28:13,355 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDCAD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.52, AdditionalMargin: 6.52, OpenOrders: 0
2025-07-18 04:28:13,355 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.522230238371118544267360428
2025-07-18 04:28:13,387 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=16450.66000000, margin=6.52000000 (was 0E-8)
2025-07-18 04:28:13,387 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-18 04:28:13,387 - INFO - orders - [PERF] Order processing: 0.3487s
2025-07-18 04:28:13,388 - DEBUG - orders - [DEBUG][create_user_order] Received order_data: {'order_id': '1111-001', 'order_status': 'OPEN', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.8951'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.00'), 'margin': Decimal('6.522230238371118544267360428'), 'commission': Decimal('0.10'), 'status': 'OPEN', 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'close_id': None}
2025-07-18 04:28:13,389 - DEBUG - orders - [DEBUG][create_user_order] Created OrderActionHistory record for order_id: 1111-001
2025-07-18 04:28:13,425 - INFO - orders - [PERF] Order creation: 0.0382s
2025-07-18 04:28:13,425 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-18 04:28:13,426 - INFO - orders - [PERF] TOTAL place_order: 0.3951s
2025-07-18 04:28:13,475 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:13,475 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 759): Type=BUY, Qty=0.01000000, StoredMargin=6.52223024
2025-07-18 04:28:13,475 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.223024
2025-07-18 04:28:13,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:13,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.223024')], HighestMarginPerLot=652.223024
2025-07-18 04:28:13,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:13,476 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:28:13,477 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:28:13,525 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:13,526 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 759): Type=BUY, Qty=0.01000000, StoredMargin=6.52223024
2025-07-18 04:28:13,526 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.223024
2025-07-18 04:28:13,526 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:13,526 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.223024')], HighestMarginPerLot=652.223024
2025-07-18 04:28:13,526 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:13,527 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:28:13,527 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:28:13,534 - INFO - orders - Background balance/margin cache updated for user 1: balance=16450.66000000, margin=6.52
2025-07-18 04:28:14,331 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:28:14,537 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:14,570 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:14,587 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:16,891 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:16,900 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:16,922 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:16,934 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:16,944 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:19,111 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:19,128 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:19,129 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:19,147 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:19,175 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:19,184 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:21,506 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'USDNOK', 'CADJPY', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:21,528 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:21,530 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:21,537 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:21,555 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:22,592 - INFO - orders - Add stoploss request received - Order ID: 1111-001, User ID: 1
2025-07-18 04:28:22,609 - INFO - orders - Generated stoploss_id: 1112-005 for order 1111-001
2025-07-18 04:28:22,611 - INFO - orders - User 1 is_barclays_live_user: False
2025-07-18 04:28:22,611 - INFO - orders - Non-Barclays user. Adding stoploss to order 1111-001 immediately
2025-07-18 04:28:22,648 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:22,648 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 759): Type=BUY, Qty=0.01000000, StoredMargin=6.52223024
2025-07-18 04:28:22,648 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.223024
2025-07-18 04:28:22,648 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:22,648 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.223024')], HighestMarginPerLot=652.223024
2025-07-18 04:28:22,649 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:22,649 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:28:22,649 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:28:22,675 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:22,675 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 759): Type=BUY, Qty=0.01000000, StoredMargin=6.52223024
2025-07-18 04:28:22,676 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.223024
2025-07-18 04:28:22,676 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:22,676 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.223024')], HighestMarginPerLot=652.223024
2025-07-18 04:28:22,676 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:22,676 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:28:22,677 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:28:22,687 - INFO - orders - Background balance/margin cache updated for user 1: balance=16450.66000000, margin=6.52
2025-07-18 04:28:22,694 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:28:23,772 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:23,778 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:23,798 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:23,818 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:23,842 - WARNING - orders - [SLTP_CHECK] Stop loss triggered for BUY order 1111-001 at 0.89501 <= 0.89503000 (diff: 0.00002000, epsilon: 0.00001, reason: exact match)
2025-07-18 04:28:23,848 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:23,849 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 759): Type=BUY, Qty=0.01000000, StoredMargin=6.52223024
2025-07-18 04:28:23,849 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.223024
2025-07-18 04:28:23,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:23,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.223024')], HighestMarginPerLot=652.223024
2025-07-18 04:28:23,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:23,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:28:23,856 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.090000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 1111-001)
2025-07-18 04:28:23,856 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:28:23,858 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:28:23,858 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:28:23,858 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:28:23,860 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3722500000'), 'o': Decimal('1.3722200000')}
2025-07-18 04:28:23,860 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3722500000
2025-07-18 04:28:23,860 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.090000000000000000000000 CAD / 1.3722500000 = -0.06558571688832209874294042631 USD
2025-07-18 04:28:23,927 - INFO - orders - [ORDER_CLOSE] Successfully closed order 1111-001 for user 1
2025-07-18 04:28:23,935 - INFO - orders - Balance/margin cache updated for user 1: balance=16450.39000000, margin=0E-8
2025-07-18 04:28:25,991 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDSGD', 'EURZAR', 'USDZAR', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'AUDCAD', 'GBPNZD', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:26,024 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:28:27,041 - INFO - orders - Order placement request received - User: 1, Symbol: AUDCAD, Type: BUY
2025-07-18 04:28:27,425 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8950700000', 'o': '0.8950000000'}
2025-07-18 04:28:27,425 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8950700000, ask=0.89515950700000
2025-07-18 04:28:27,425 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8950700000, ask=0.89515950700000
2025-07-18 04:28:27,428 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.95 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:28:27,429 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:28:27,431 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:28:27,431 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:28:27,431 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:28:27,433 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3722500000'), 'o': Decimal('1.3721900000')}
2025-07-18 04:28:27,433 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3722500000
2025-07-18 04:28:27,433 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.95 CAD / 1.3722500000 = 6.522135179449808708325742394 USD
2025-07-18 04:28:27,434 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: BUY, Qty: 0.01, Price: 0.89515950700000, Margin: 6.522135179449808708325742394, Commission: 0.10
2025-07-18 04:28:27,434 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDCAD, OrderType: BUY, Quantity: 0.01, FullMargin: 6.522135179449808708325742394
2025-07-18 04:28:27,434 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-18 04:28:27,434 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.522135179449808708325742394
2025-07-18 04:28:27,434 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-18 04:28:27,435 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-18 04:28:27,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:28:27,436 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:27,436 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: None): Type=BUY, Qty=0.01, StoredMargin=6.522135179449808708325742394
2025-07-18 04:28:27,436 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.2135179449808708325742394
2025-07-18 04:28:27,436 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-18 04:28:27,437 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.2135179449808708325742394')], HighestMarginPerLot=652.2135179449808708325742394
2025-07-18 04:28:27,437 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:27,437 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-18 04:28:27,437 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDCAD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.52, AdditionalMargin: 6.52, OpenOrders: 0
2025-07-18 04:28:27,437 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.522135179449808708325742394
2025-07-18 04:28:27,461 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=16450.39000000, margin=6.52000000 (was 0E-8)
2025-07-18 04:28:27,461 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-18 04:28:27,461 - INFO - orders - [PERF] Order processing: 0.4163s
2025-07-18 04:28:27,462 - DEBUG - orders - [DEBUG][create_user_order] Received order_data: {'order_id': '1116-001', 'order_status': 'OPEN', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.89506'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.00'), 'margin': Decimal('6.522135179449808708325742394'), 'commission': Decimal('0.10'), 'status': 'OPEN', 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'close_id': None}
2025-07-18 04:28:27,463 - DEBUG - orders - [DEBUG][create_user_order] Created OrderActionHistory record for order_id: 1116-001
2025-07-18 04:28:27,479 - INFO - orders - [PERF] Order creation: 0.0174s
2025-07-18 04:28:27,479 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-18 04:28:27,479 - INFO - orders - [PERF] TOTAL place_order: 0.4389s
2025-07-18 04:28:27,518 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:27,520 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 760): Type=BUY, Qty=0.01000000, StoredMargin=6.52213518
2025-07-18 04:28:27,521 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.213518
2025-07-18 04:28:27,522 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:27,523 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.213518')], HighestMarginPerLot=652.213518
2025-07-18 04:28:27,523 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:27,524 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:28:27,527 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:28:27,552 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:27,552 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 760): Type=BUY, Qty=0.01000000, StoredMargin=6.52213518
2025-07-18 04:28:27,552 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.213518
2025-07-18 04:28:27,553 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:27,553 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.213518')], HighestMarginPerLot=652.213518
2025-07-18 04:28:27,553 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:27,554 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:28:27,554 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:28:27,561 - INFO - orders - Background balance/margin cache updated for user 1: balance=16450.39000000, margin=6.52
2025-07-18 04:28:28,023 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:28:28,362 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'BTCUSD', 'CADCHF', 'AUDJPY', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:28,369 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:28,377 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:28,387 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:28,410 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:28,432 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:30,611 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'EURNZD', 'EURZAR', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:28:30,624 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:30,635 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:30,650 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:30,660 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:32,865 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:32,871 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:32,875 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:32,897 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:32,924 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:35,177 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'USDZAR', 'SGDJPY', 'JP225', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:35,196 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:35,210 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:35,214 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:37,472 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'JP225', 'EURCAD', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'CHFJPY', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:37,475 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:37,486 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:37,504 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:37,521 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:37,533 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:39,806 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:39,820 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:39,826 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:39,848 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:39,855 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:40,171 - INFO - orders - Add takeprofit request received - Order ID: 1116-001, User ID: 1
2025-07-18 04:28:40,200 - INFO - orders - Generated takeprofit_id: 1117-006 for order 1116-001
2025-07-18 04:28:40,202 - INFO - orders - User 1 is_barclays_live_user: False
2025-07-18 04:28:40,202 - INFO - orders - Non-Barclays user. Adding takeprofit to order 1116-001 immediately
2025-07-18 04:28:40,270 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:40,270 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 760): Type=BUY, Qty=0.01000000, StoredMargin=6.52213518
2025-07-18 04:28:40,270 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.213518
2025-07-18 04:28:40,270 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:40,271 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.213518')], HighestMarginPerLot=652.213518
2025-07-18 04:28:40,271 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:40,271 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:28:40,272 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:28:40,314 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:28:40,314 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 760): Type=BUY, Qty=0.01000000, StoredMargin=6.52213518
2025-07-18 04:28:40,314 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.213518
2025-07-18 04:28:40,314 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:28:40,314 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.213518')], HighestMarginPerLot=652.213518
2025-07-18 04:28:40,315 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:28:40,315 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:28:40,315 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:28:40,319 - INFO - orders - Background balance/margin cache updated for user 1: balance=16450.39000000, margin=6.52
2025-07-18 04:28:40,321 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:28:42,078 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'GBPNZD', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:42,091 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:42,095 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:42,116 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:42,143 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:42,154 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:44,436 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:44,451 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:44,482 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:46,755 - DEBUG - orders - Market data update received for symbols: ['GBPAUD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'EURPLN', 'SGDJPY', 'EURCAD', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:46,802 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:47,998 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:28:47,998 - INFO - orders - Using order model: UserOrder
2025-07-18 04:28:48,002 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:28:48,005 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:28:48,007 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:28:48,007 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:28:48,011 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:28:48,012 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:28:48,012 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:28:48,012 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:28:48,012 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:28:48,012 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:28:48,012 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:28:48,012 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:28:48,012 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:28:48,012 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:28:48,012 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:28:48,012 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:28:48,012 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:28:48,013 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:28:48,013 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:28:48,013 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:28:48,013 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:28:48,017 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:28:48,907 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:28:48,907 - INFO - orders - Using order model: UserOrder
2025-07-18 04:28:48,909 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:28:48,910 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:28:48,910 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:28:48,910 - DEBUG - orders - [CACHE] static_orders_data for user 25: open_orders=['1031-001'], pending_orders=[]
2025-07-18 04:28:48,912 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:28:48,912 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:28:48,912 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:28:48,912 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:28:48,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:28:48,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:28:48,913 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:28:48,913 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:28:48,914 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:28:49,039 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'EURPLN', 'SGDJPY', 'JP225', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD'], triggering optimized SL/TP check
2025-07-18 04:28:49,050 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:49,065 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:49,090 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:49,101 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:51,566 - DEBUG - orders - Market data update received for symbols: ['GBPAUD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'EURCAD', 'CADJPY', 'US30', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:51,607 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:51,635 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:53,567 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:53,575 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:53,585 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:53,596 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:53,613 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:28:53,618 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:55,887 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'BTCUSD', 'USDJPY', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:55,894 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:55,907 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:55,928 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:28:56,289 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDCAD, Type: SELL_LIMIT, Quantity: 0.01
2025-07-18 04:28:56,318 - ERROR - orders - Could not get current market prices for AUDCAD
2025-07-18 04:28:56,318 - ERROR - orders - Unexpected error in place_order: 500: Could not get current market prices for AUDCAD
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 852, in place_pending_order
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Could not get current market prices for AUDCAD
2025-07-18 04:28:58,151 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'CHFJPY', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:28:58,156 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:28:58,157 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:28:58,178 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:28:58,198 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:29:00,516 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:29:00,522 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:29:00,525 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:29:00,546 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:29:00,563 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:29:00,571 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:29:01,211 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDCAD, Type: SELL_LIMIT, Quantity: 0.01
2025-07-18 04:29:01,223 - ERROR - orders - Could not get current market prices for AUDCAD
2025-07-18 04:29:01,223 - ERROR - orders - Unexpected error in place_order: 500: Could not get current market prices for AUDCAD
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 852, in place_pending_order
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Could not get current market prices for AUDCAD
2025-07-18 04:29:02,760 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURSEK', 'USDZAR', 'SGDJPY', 'JP225', 'USDCHF', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:29:02,778 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:29:02,794 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:29:02,798 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:29:05,120 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:29:05,142 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:29:05,145 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:29:05,164 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:29:05,184 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:29:07,319 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:29:07,338 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:29:07,341 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:29:07,398 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:29:07,405 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:29:09,730 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURZAR', 'AUDJPY', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD'], triggering optimized SL/TP check
2025-07-18 04:29:09,760 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:29:09,779 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:29:11,978 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:29:11,996 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:29:12,012 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:29:12,015 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:29:14,324 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:29:14,343 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:29:14,350 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:29:14,367 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:29:14,372 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:43:06,546 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-18 04:43:07,730 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-18 04:43:07,730 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-18 04:43:07,730 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-18 04:43:07,730 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-18 04:43:07,786 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-18 04:43:07,786 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-18 04:43:08,468 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:43:08,468 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 4, Symbol AUDJPY, Pos 1 (ID: 1572): Type=BUY, Qty=10.00000000, StoredMargin=3249.77540855
2025-07-18 04:43:08,468 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 4, Symbol AUDJPY, Pos 1: MarginPerLot=324.977540855
2025-07-18 04:43:08,468 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:43:08,468 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:43:08,468 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:43:08,469 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 3249.78
2025-07-18 04:43:08,469 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:43:08,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-18 04:43:08,533 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 9, Symbol BTCUSD, Pos 1 (ID: 1567): Type=BUY, Qty=0.35000000, StoredMargin=8271.68000000
2025-07-18 04:43:08,533 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 9, Symbol BTCUSD, Pos 1: MarginPerLot=23633.37142857142857142857143
2025-07-18 04:43:08,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.35000000, TotalSellQty=0, NetQty=0.35000000, IsHedged=False
2025-07-18 04:43:08,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23633.37142857142857142857143')], HighestMarginPerLot=23633.37142857142857142857143
2025-07-18 04:43:08,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=8271.68
2025-07-18 04:43:08,533 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 8271.68
2025-07-18 04:43:08,533 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 8271.68
2025-07-18 04:43:08,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:43:08,575 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:43:08,575 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:43:08,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:43:08,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:43:08,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:43:08,575 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:43:08,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:43:08,575 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:43:08,575 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:43:08,575 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:43:08,575 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:43:08,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:43:08,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:43:08,576 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:43:08,576 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:43:08,576 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:43:08,657 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:43:08,657 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:43:08,657 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:43:08,657 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:43:08,657 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:43:08,657 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:43:08,657 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:43:08,657 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:43:08,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-18 04:43:08,696 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 26, Symbol XAGUSD, Pos 1 (ID: 1523): Type=BUY, Qty=0.01000000, StoredMargin=19.54000000
2025-07-18 04:43:08,696 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 26, Symbol XAGUSD, Pos 1: MarginPerLot=1954
2025-07-18 04:43:08,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:08,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-18 04:43:08,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-18 04:43:08,697 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol XAGUSD: 19.54
2025-07-18 04:43:08,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-18 04:43:08,697 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 26, Symbol BTCUSD, Pos 1 (ID: 1524): Type=BUY, Qty=6.00000000, StoredMargin=146464.93000000
2025-07-18 04:43:08,697 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 26, Symbol BTCUSD, Pos 1: MarginPerLot=24410.82166666666666666666667
2025-07-18 04:43:08,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-18 04:43:08,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-18 04:43:08,697 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-18 04:43:08,697 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 146464.93
2025-07-18 04:43:08,697 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-18 04:43:08,713 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:08,713 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 760): Type=BUY, Qty=0.01000000, StoredMargin=6.52213518
2025-07-18 04:43:08,713 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.213518
2025-07-18 04:43:08,713 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:08,713 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.213518')], HighestMarginPerLot=652.213518
2025-07-18 04:43:08,713 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:08,713 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:43:08,714 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:43:13,145 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-18 04:43:13,145 - DEBUG - orders - Starting the optimized SL/TP checker task (triggered by market updates).
2025-07-18 04:43:13,150 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'SGDJPY', 'JP225', 'EURCAD', 'CADJPY', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:13,272 - DEBUG - orders - Updated users with orders cache
2025-07-18 04:43:14,011 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:43:14,011 - INFO - orders - Using order model: UserOrder
2025-07-18 04:43:14,015 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:43:14,017 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:43:14,019 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:43:14,019 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:43:14,022 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:14,022 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 760): Type=BUY, Qty=0.01000000, StoredMargin=6.52213518
2025-07-18 04:43:14,022 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.213518
2025-07-18 04:43:14,022 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:14,022 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.213518')], HighestMarginPerLot=652.213518
2025-07-18 04:43:14,022 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:14,022 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:43:14,022 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:43:14,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:43:14,024 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:43:14,024 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:43:14,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:43:14,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:43:14,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:43:14,024 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:43:14,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:43:14,024 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:43:14,024 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:43:14,024 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:43:14,024 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:43:14,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:43:14,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:43:14,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:43:14,025 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:43:14,025 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:43:14,028 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:43:14,634 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:43:14,634 - INFO - orders - Using order model: UserOrder
2025-07-18 04:43:14,636 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:43:14,637 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:43:14,639 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:43:14,639 - DEBUG - orders - [CACHE] static_orders_data for user 25: open_orders=['1031-001'], pending_orders=[]
2025-07-18 04:43:14,641 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:43:14,641 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:43:14,641 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:43:14,641 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:43:14,641 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:43:14,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:43:14,642 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:43:14,642 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:43:14,644 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:43:14,688 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:14,690 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:14,704 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:14,711 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:14,713 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:43:14,740 - WARNING - orders - [SLTP_CHECK] Take profit triggered for BUY order 1116-001 at 0.89508 >= 0.89507000 (diff: 0.00001000, epsilon: 0.00001, reason: exact match)
2025-07-18 04:43:14,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:14,746 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 760): Type=BUY, Qty=0.01000000, StoredMargin=6.52213518
2025-07-18 04:43:14,746 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.213518
2025-07-18 04:43:14,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:14,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.213518')], HighestMarginPerLot=652.213518
2025-07-18 04:43:14,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:14,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:43:14,754 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 0.020000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 1116-001)
2025-07-18 04:43:14,754 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:43:14,755 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:43:14,755 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:43:14,755 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:43:14,757 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3722900000'), 'o': Decimal('1.3722700000')}
2025-07-18 04:43:14,757 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3722900000
2025-07-18 04:43:14,757 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 0.020000000000000000000000 CAD / 1.3722900000 = 0.01457417892719468916919893026 USD
2025-07-18 04:43:14,819 - INFO - orders - [ORDER_CLOSE] Successfully closed order 1116-001 for user 1
2025-07-18 04:43:14,822 - INFO - orders - Balance/margin cache updated for user 1: balance=16450.20000000, margin=0E-8
2025-07-18 04:43:16,997 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:17,003 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:17,007 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:17,036 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:17,088 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:17,730 - INFO - orders - Starting the users with orders cache updater task.
2025-07-18 04:43:17,767 - DEBUG - orders - Updated users with orders cache for all symbols
2025-07-18 04:43:19,293 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:43:19,305 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:19,315 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:19,331 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:19,343 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:43:20,379 - INFO - orders - Order placement request received - User: 1, Symbol: AUDCAD, Type: BUY
2025-07-18 04:43:20,693 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8951400000', 'o': '0.8950900000'}
2025-07-18 04:43:20,694 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8951400000, ask=0.89522951400000
2025-07-18 04:43:20,694 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8951400000, ask=0.89522951400000
2025-07-18 04:43:20,695 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.95 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:43:20,695 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:43:20,696 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:43:20,696 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:43:20,696 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:43:20,697 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723800000'), 'o': Decimal('1.3723300000')}
2025-07-18 04:43:20,697 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723800000
2025-07-18 04:43:20,697 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.95 CAD / 1.3723800000 = 6.521517363995394861481513866 USD
2025-07-18 04:43:20,697 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: BUY, Qty: 0.01, Price: 0.89522951400000, Margin: 6.521517363995394861481513866, Commission: 0.10
2025-07-18 04:43:20,697 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDCAD, OrderType: BUY, Quantity: 0.01, FullMargin: 6.521517363995394861481513866
2025-07-18 04:43:20,697 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-18 04:43:20,697 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.521517363995394861481513866
2025-07-18 04:43:20,698 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-18 04:43:20,698 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-18 04:43:20,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:43:20,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:20,698 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: None): Type=BUY, Qty=0.01, StoredMargin=6.521517363995394861481513866
2025-07-18 04:43:20,698 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.1517363995394861481513866
2025-07-18 04:43:20,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-18 04:43:20,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.1517363995394861481513866')], HighestMarginPerLot=652.1517363995394861481513866
2025-07-18 04:43:20,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:20,698 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-18 04:43:20,699 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDCAD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.52, AdditionalMargin: 6.52, OpenOrders: 0
2025-07-18 04:43:20,699 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.521517363995394861481513866
2025-07-18 04:43:20,716 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=16450.20000000, margin=6.52000000 (was 0E-8)
2025-07-18 04:43:20,716 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-18 04:43:20,716 - INFO - orders - [PERF] Order processing: 0.3313s
2025-07-18 04:43:20,717 - DEBUG - orders - [DEBUG][create_user_order] Received order_data: {'order_id': '1121-001', 'order_status': 'OPEN', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.89512'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.00'), 'margin': Decimal('6.521517363995394861481513866'), 'commission': Decimal('0.10'), 'status': 'OPEN', 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'close_id': None}
2025-07-18 04:43:20,717 - DEBUG - orders - [DEBUG][create_user_order] Created OrderActionHistory record for order_id: 1121-001
2025-07-18 04:43:20,730 - INFO - orders - [PERF] Order creation: 0.0134s
2025-07-18 04:43:20,730 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-18 04:43:20,730 - INFO - orders - [PERF] TOTAL place_order: 0.3552s
2025-07-18 04:43:20,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:20,750 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 761): Type=BUY, Qty=0.01000000, StoredMargin=6.52151736
2025-07-18 04:43:20,750 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.151736
2025-07-18 04:43:20,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:20,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.151736')], HighestMarginPerLot=652.151736
2025-07-18 04:43:20,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:20,754 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:43:20,755 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:43:20,787 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:20,787 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 761): Type=BUY, Qty=0.01000000, StoredMargin=6.52151736
2025-07-18 04:43:20,787 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.151736
2025-07-18 04:43:20,787 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:20,787 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.151736')], HighestMarginPerLot=652.151736
2025-07-18 04:43:20,787 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:20,788 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:43:20,788 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:43:20,792 - INFO - orders - Background balance/margin cache updated for user 1: balance=16450.20000000, margin=6.52
2025-07-18 04:43:21,205 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:43:21,568 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:21,577 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:21,579 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:21,593 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:21,605 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:21,614 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:43:21,636 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:23,925 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'CHFJPY', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:23,929 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:23,930 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:23,941 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:23,978 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:23,981 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:43:23,990 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:26,187 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'USDSGD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'NZDUSD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'NOKSEK', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:26,194 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:26,203 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:26,224 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:26,267 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:28,529 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'GBPNZD', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:28,550 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:28,587 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:28,592 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:43:28,728 - INFO - orders - Add stoploss request received - Order ID: 1121-001, User ID: 1
2025-07-18 04:43:28,759 - INFO - orders - Generated stoploss_id: 1122-005 for order 1121-001
2025-07-18 04:43:28,763 - INFO - orders - User 1 is_barclays_live_user: False
2025-07-18 04:43:28,764 - INFO - orders - Non-Barclays user. Adding stoploss to order 1121-001 immediately
2025-07-18 04:43:28,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:28,832 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 761): Type=BUY, Qty=0.01000000, StoredMargin=6.52151736
2025-07-18 04:43:28,832 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.151736
2025-07-18 04:43:28,833 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:28,833 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.151736')], HighestMarginPerLot=652.151736
2025-07-18 04:43:28,833 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:28,833 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:43:28,833 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:43:28,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:28,863 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 761): Type=BUY, Qty=0.01000000, StoredMargin=6.52151736
2025-07-18 04:43:28,863 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.151736
2025-07-18 04:43:28,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:28,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.151736')], HighestMarginPerLot=652.151736
2025-07-18 04:43:28,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:28,863 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:43:28,863 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:43:28,870 - INFO - orders - Background balance/margin cache updated for user 1: balance=16450.20000000, margin=6.52
2025-07-18 04:43:28,874 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:43:30,800 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:43:30,818 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:30,849 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:33,146 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:33,162 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:33,171 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:33,181 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:33,196 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:33,213 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:43:33,246 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:35,410 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'EURSEK', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:35,417 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:35,465 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:35,473 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:43:35,503 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:37,766 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:37,774 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:37,805 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:37,846 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:43:37,867 - WARNING - orders - [SLTP_CHECK] Stop loss triggered for BUY order 1121-001 at 0.89508 <= 0.89508000 (diff: 0E-8, epsilon: 0.00001, reason: exact match)
2025-07-18 04:43:37,875 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:43:37,876 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 761): Type=BUY, Qty=0.01000000, StoredMargin=6.52151736
2025-07-18 04:43:37,876 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.151736
2025-07-18 04:43:37,876 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:43:37,876 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.151736')], HighestMarginPerLot=652.151736
2025-07-18 04:43:37,876 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:43:37,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:43:37,883 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.040000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 1121-001)
2025-07-18 04:43:37,884 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:43:37,884 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:43:37,885 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:43:37,885 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:43:37,886 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723500000'), 'o': Decimal('1.3723300000')}
2025-07-18 04:43:37,887 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723500000
2025-07-18 04:43:37,887 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.040000000000000000000000 CAD / 1.3723500000 = -0.02914708346996028709877217911 USD
2025-07-18 04:43:37,952 - INFO - orders - [ORDER_CLOSE] Successfully closed order 1121-001 for user 1
2025-07-18 04:43:37,956 - INFO - orders - Balance/margin cache updated for user 1: balance=16449.97000000, margin=0E-8
2025-07-18 04:43:40,007 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:40,038 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:40,072 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:43:42,350 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:42,373 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:42,382 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:42,434 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:43,645 - INFO - orders - [get_closed_orders] user_type: demo
2025-07-18 04:43:44,520 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'GBPAUD', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'USDZAR', 'EURCAD', 'USDNOK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:44,547 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:44,556 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:44,583 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:43:46,869 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'USDZAR', 'EURPLN', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:46,903 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:46,917 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:46,923 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:43:51,600 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'USDSEK', 'GBPUSD', 'EURAUD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:51,642 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:51,650 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:51,684 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:51,727 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:51,742 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:43:51,769 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:51,774 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'AUDJPY', 'EURSEK', 'USDZAR', 'SGDJPY', 'JP225', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:51,778 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:51,785 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:51,809 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:51,818 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:43:51,841 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:43:52,337 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:43:52,337 - INFO - orders - Using order model: UserOrder
2025-07-18 04:43:52,343 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:43:52,347 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:43:52,349 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:43:52,349 - DEBUG - orders - [CACHE] static_orders_data for user 14: open_orders=['1000330-001', '1000332-001', '1000333-001'], pending_orders=[]
2025-07-18 04:43:52,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:43:52,353 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1 (ID: 1562): Type=BUY, Qty=0.40000000, StoredMargin=9422.73000000
2025-07-18 04:43:52,353 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol BTCUSD, Pos 1: MarginPerLot=23556.825
2025-07-18 04:43:52,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:43:52,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:43:52,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:43:52,353 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 9422.73
2025-07-18 04:43:52,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:43:52,353 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1 (ID: 1563): Type=BUY, Qty=0.10000000, StoredMargin=65.21517371
2025-07-18 04:43:52,353 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 1: MarginPerLot=652.1517371
2025-07-18 04:43:52,353 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2 (ID: 1564): Type=BUY, Qty=0.01000000, StoredMargin=6.52134765
2025-07-18 04:43:52,353 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 14, Symbol AUDJPY, Pos 2: MarginPerLot=652.134765
2025-07-18 04:43:52,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:43:52,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:43:52,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:43:52,353 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDJPY: 71.74
2025-07-18 04:43:52,353 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:43:52,358 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:43:53,406 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:43:53,407 - INFO - orders - Using order model: UserOrder
2025-07-18 04:43:53,410 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:43:53,412 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:43:53,413 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:43:53,413 - DEBUG - orders - [CACHE] static_orders_data for user 25: open_orders=['1031-001'], pending_orders=[]
2025-07-18 04:43:53,416 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:43:53,416 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1 (ID: 1574): Type=BUY, Qty=0.10000000, StoredMargin=5936.62000000
2025-07-18 04:43:53,416 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 25, Symbol BTCUSD, Pos 1: MarginPerLot=59366.2
2025-07-18 04:43:53,416 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:43:53,416 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:43:53,416 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:43:53,416 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol BTCUSD: 5936.62
2025-07-18 04:43:53,416 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:43:53,419 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:43:53,972 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'USDTRY', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:54,075 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:54,166 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:54,339 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:54,492 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:43:56,131 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:43:56,246 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:56,337 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:43:56,520 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:43:58,527 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'GBPAUD', 'BTCUSD', 'USDCNH', 'EURNZD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:43:58,602 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:43:58,629 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:43:58,670 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:43:58,698 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:00,838 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURSEK', 'USDZAR', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'EURCHF', 'D30', 'NZDCAD', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:00,927 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:44:01,135 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:44:02,607 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:03,367 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:03,419 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:03,557 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:03,748 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:03,780 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:44:05,240 - INFO - orders - Order placement request received - User: 1, Symbol: AUDCAD, Type: BUY
2025-07-18 04:44:05,433 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'EURSEK', 'USDZAR', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'AUDCAD', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:06,116 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:44:06,124 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:06,188 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8951400000', 'o': '0.8951200000'}
2025-07-18 04:44:06,188 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8951400000, ask=0.89522951400000
2025-07-18 04:44:06,189 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8951400000, ask=0.89522951400000
2025-07-18 04:44:06,240 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.95 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:44:06,240 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:44:06,283 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:44:06,283 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:44:06,284 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:44:06,308 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:06,352 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723500000'), 'o': Decimal('1.3723300000')}
2025-07-18 04:44:06,352 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723500000
2025-07-18 04:44:06,352 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.95 CAD / 1.3723500000 = 6.521659926403614238350275076 USD
2025-07-18 04:44:06,353 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: BUY, Qty: 0.01, Price: 0.89522951400000, Margin: 6.521659926403614238350275076, Commission: 0.10
2025-07-18 04:44:06,353 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDCAD, OrderType: BUY, Quantity: 0.01, FullMargin: 6.521659926403614238350275076
2025-07-18 04:44:06,354 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-18 04:44:06,354 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.521659926403614238350275076
2025-07-18 04:44:06,354 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-18 04:44:06,354 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-18 04:44:06,359 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:44:06,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:06,361 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: None): Type=BUY, Qty=0.01, StoredMargin=6.521659926403614238350275076
2025-07-18 04:44:06,361 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.1659926403614238350275076
2025-07-18 04:44:06,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-18 04:44:06,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.1659926403614238350275076')], HighestMarginPerLot=652.1659926403614238350275076
2025-07-18 04:44:06,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:06,363 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:44:06,371 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-18 04:44:06,371 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDCAD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.52, AdditionalMargin: 6.52, OpenOrders: 0
2025-07-18 04:44:06,372 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.521659926403614238350275076
2025-07-18 04:44:06,459 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:07,092 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=16449.97000000, margin=6.52000000 (was 0E-8)
2025-07-18 04:44:07,093 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-18 04:44:07,093 - INFO - orders - [PERF] Order processing: 1.7358s
2025-07-18 04:44:07,093 - DEBUG - orders - [DEBUG][create_user_order] Received order_data: {'order_id': '1126-001', 'order_status': 'OPEN', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.89514'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.00'), 'margin': Decimal('6.521659926403614238350275076'), 'commission': Decimal('0.10'), 'status': 'OPEN', 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'close_id': None}
2025-07-18 04:44:07,094 - DEBUG - orders - [DEBUG][create_user_order] Created OrderActionHistory record for order_id: 1126-001
2025-07-18 04:44:07,289 - INFO - orders - [PERF] Order creation: 0.1958s
2025-07-18 04:44:07,289 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-18 04:44:07,289 - INFO - orders - [PERF] TOTAL place_order: 2.0501s
2025-07-18 04:44:08,004 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD'], triggering optimized SL/TP check
2025-07-18 04:44:08,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:08,048 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 762): Type=BUY, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:08,049 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.165993
2025-07-18 04:44:08,049 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:44:08,049 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:44:08,049 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:08,049 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:44:08,050 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:44:08,053 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:08,150 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:08,483 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:08,647 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:44:08,741 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:08,741 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 762): Type=BUY, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:08,741 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.165993
2025-07-18 04:44:08,741 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:44:08,742 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:44:08,743 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:08,743 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:44:08,743 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:44:09,278 - INFO - orders - Background balance/margin cache updated for user 1: balance=16449.97000000, margin=6.52
2025-07-18 04:44:10,192 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'EURUSD', 'AUDCHF', 'EURSGD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:10,288 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:44:10,293 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:10,397 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:10,531 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:10,581 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:44:11,952 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:12,496 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'EURAUD', 'CHFSGD', 'AUDCAD', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:12,565 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:12,644 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:12,954 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 1 users
2025-07-18 04:44:14,562 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:14,601 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:14,651 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:14,655 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:44:14,865 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:14,946 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:44:16,895 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'GBPAUD', 'BTCUSD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'CHFJPY', 'EURUSD', 'AUDCHF', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:16,927 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:16,958 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:44:17,082 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:17,860 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:17,886 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:44:17,914 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:20,084 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:20,264 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:20,317 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDCAD, Type: SELL_LIMIT, Quantity: 0.01
2025-07-18 04:44:21,055 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:21,822 - INFO - orders - Validating pending order price: Order type=SELL_LIMIT, Order price=0.89515, Current buy price=0.89514, Current sell price=0.89507
2025-07-18 04:44:22,493 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-07-18 04:44:22,570 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:22,581 - INFO - orders - [DEBUG] User data from cache: {'wallet_balance': Decimal('16449.97000000'), 'margin': Decimal('6.52000000'), 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'user_id': 1, 'user_type': 'demo'}
2025-07-18 04:44:22,582 - INFO - orders - [DEBUG] Group name: Group B
2025-07-18 04:44:22,601 - DEBUG - orders - [DEBUG] Group settings from cache: {'sending_orders': 'barclays'}
2025-07-18 04:44:22,601 - DEBUG - orders - [DEBUG] sending_orders value: barclays, type: <class 'str'>
2025-07-18 04:44:22,602 - DEBUG - orders - [DEBUG] sending_orders_normalized: barclays
2025-07-18 04:44:22,602 - INFO - orders - User 1 is_barclays_live_user: False (user_type: demo, sending_orders_normalized: barclays)
2025-07-18 04:44:22,664 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:22,693 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCAD: contract_size=100000.00000000, profit_currency=CAD, digit=5.00000
2025-07-18 04:44:23,105 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8951200000', 'o': '0.8951100000'}
2025-07-18 04:44:23,105 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8951200000, ask=0.89520951200000
2025-07-18 04:44:23,106 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8951200000, ask=0.89520951200000
2025-07-18 04:44:23,154 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.95 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:44:23,155 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:44:23,159 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:23,173 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:44:23,173 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:44:23,173 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:44:23,230 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723500000'), 'o': Decimal('1.3723300000')}
2025-07-18 04:44:23,231 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723500000
2025-07-18 04:44:23,231 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.95 CAD / 1.3723500000 = 6.521659926403614238350275076 USD
2025-07-18 04:44:23,231 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: SELL_LIMIT, Qty: 0.01, Price: 0.8951200000, Margin: 6.521659926403614238350275076, Commission: 0.10
2025-07-18 04:44:23,232 - INFO - orders - Calculated initial margin: 6.521659926403614238350275076, commission: 0.10 for pending order 1127-001
2025-07-18 04:44:23,343 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:23,385 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:44:24,148 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '1127-001', 'order_company_name': 'AUDCAD', 'order_type': 'SELL_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89515'), 'user_type': 'demo', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1128-005', 'takeprofit_id': '1129-006', 'order_user_id': 1, 'order_status': 'PENDING', 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.521659926403614238350275076'), 'commission': Decimal('0.10'), 'open_time': None}
2025-07-18 04:44:24,148 - INFO - orders - Placing PENDING order: SELL_LIMIT for user 1 at price 0.89515
2025-07-18 04:44:24,148 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '1127-001', 'order_status': 'PENDING', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'SELL_LIMIT', 'order_price': Decimal('0.89515'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.521659926403614238350275076'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1128-005', 'takeprofit_id': '1129-006', 'close_id': None}
2025-07-18 04:44:24,150 - DEBUG - orders - [DEBUG][create_order] Received order_data: {'order_id': '1127-001', 'order_status': 'PENDING', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'SELL_LIMIT', 'order_price': Decimal('0.89515'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.521659926403614238350275076'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1128-005', 'takeprofit_id': '1129-006', 'close_id': None}
2025-07-18 04:44:24,157 - DEBUG - orders - [DEBUG][create_order] Created OrderActionHistory record for order_id: 1127-001
2025-07-18 04:44:24,674 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'NZDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'NZDCAD', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:25,081 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:25,099 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:44:25,685 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:26,347 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:26,560 - INFO - orders - Order 1127-001 verified in database on attempt 1 before adding to Redis.
2025-07-18 04:44:26,568 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:44:26,924 - INFO - orders - Pending order 1127-001 added to Redis for non-Barclays user or demo user.
2025-07-18 04:44:27,056 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:27,057 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 762): Type=BUY, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:27,057 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.165993
2025-07-18 04:44:27,057 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:44:27,057 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:44:27,057 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:27,057 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:44:27,057 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:44:27,146 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:27,290 - DEBUG - orders - Balance/margin cache updated for user 1: balance=16449.97000000, margin=6.52
2025-07-18 04:44:27,483 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDCZK', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:27,678 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:27,721 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:27,721 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 762): Type=BUY, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:27,721 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.165993
2025-07-18 04:44:27,721 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:44:27,722 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:44:27,722 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:27,722 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:44:27,723 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:44:29,395 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:29,814 - INFO - orders - [PERF] TOTAL place_order: 9.4987s
2025-07-18 04:44:30,249 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'US30', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'AUDCHF', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:30,372 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:30,517 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:30,518 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 762): Type=BUY, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:30,518 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.165993
2025-07-18 04:44:30,518 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:44:30,518 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:44:30,518 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:30,519 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:44:30,519 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:44:30,522 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:30,617 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:30,668 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:44:30,730 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:30,730 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 762): Type=BUY, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:30,730 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.165993
2025-07-18 04:44:30,730 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:44:30,731 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:44:30,731 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:30,731 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:44:30,731 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:44:30,770 - INFO - orders - Background balance/margin cache updated for user 1: balance=16449.97000000, margin=6.52
2025-07-18 04:44:30,805 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'CADCHF', 'EURNZD', 'EURZAR', 'AUDJPY', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'CADJPY', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD'], triggering optimized SL/TP check
2025-07-18 04:44:30,829 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:30,869 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:30,899 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:30,924 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:44:32,216 - INFO - orders - [PENDING_CHECK] Found 1 matching SELL_LIMIT orders for AUDCAD at price 0.89517
2025-07-18 04:44:32,221 - INFO - orders - [PENDING_ORDER] Starting execution of order 1127-001 for user 1
2025-07-18 04:44:32,221 - INFO - orders - [PENDING_ORDER] Order 1127-001: Placed at 0.89515000, Triggered at 0.89517
2025-07-18 04:44:32,221 - INFO - orders - [PENDING_ORDER] Order 1127-001: Type SELL_LIMIT -> SELL
2025-07-18 04:44:32,226 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCAD: contract_size=100000.00000000, profit_currency=CAD, digit=5.00000
2025-07-18 04:44:32,602 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8951700000', 'o': '0.8951100000'}
2025-07-18 04:44:32,603 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8951700000, ask=0.89525951700000
2025-07-18 04:44:32,603 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8951700000, ask=0.89525951700000
2025-07-18 04:44:32,617 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.95 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:44:32,617 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:44:32,619 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:44:32,619 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:44:32,619 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:44:32,633 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723500000'), 'o': Decimal('1.3723300000')}
2025-07-18 04:44:32,633 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723500000
2025-07-18 04:44:32,633 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.95 CAD / 1.3723500000 = 6.521659926403614238350275076 USD
2025-07-18 04:44:32,633 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: SELL, Qty: 0.01000000, Price: 0.8951700000, Margin: 6.521659926403614238350275076, Commission: 0.10
2025-07-18 04:44:32,651 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:32,651 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 762): Type=BUY, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:32,651 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.165993
2025-07-18 04:44:32,651 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:44:32,651 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:44:32,651 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:32,651 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:44:32,651 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:44:32,651 - INFO - orders - [PENDING_ORDER] Total user margin: 6.52
2025-07-18 04:44:32,673 - INFO - orders - [PENDING_ORDER] Updated user 1 total margin to 6.52 (includes all symbols)
2025-07-18 04:44:32,693 - INFO - orders - [PENDING_ORDER] Order 1127-001 status is OPEN, margin/commission updated
2025-07-18 04:44:32,729 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDCAD
2025-07-18 04:44:32,729 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1 (ID: 762): Type=BUY, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:32,729 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 1: MarginPerLot=652.165993
2025-07-18 04:44:32,730 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 2 (ID: 763): Type=SELL, Qty=0.01000000, StoredMargin=6.52165993
2025-07-18 04:44:32,730 - DEBUG - orders - [MARGIN_TOTAL_CONTRIB_POS] User 1, Symbol AUDCAD, Pos 2: MarginPerLot=652.165993
2025-07-18 04:44:32,730 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-18 04:44:32,730 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993'), Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:44:32,730 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:44:32,730 - DEBUG - orders - [TOTAL_USER_MARGIN] Symbol AUDCAD: 6.52
2025-07-18 04:44:32,730 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:44:32,737 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'USDJPY', 'USDCNH', 'EURZAR', 'EURSEK', 'USDZAR', 'EURPLN', 'SGDJPY', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'CHFSGD', 'AUDUSD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:32,745 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:32,767 - WARNING - orders - [PENDING_ORDER] Cache verification failed for user 1, retrying...
2025-07-18 04:44:32,786 - INFO - orders - [PENDING_ORDER] Successfully executed order 1127-001 for user 1
2025-07-18 04:44:32,787 - INFO - orders - [PENDING_ORDER] Order 1127-001: Final price=0.8951700000, margin=6.521659926403614238350275076, commission=0.10
2025-07-18 04:44:32,787 - INFO - orders - [PENDING_ORDER_SUMMARY] Order 1127-001 executed: SELL_LIMIT -> SELL, Placed: 0.89515000, Triggered: 0.89517, Margin: 6.521659926403614238350275076, Commission: 0.10, AdditionalMargin: None
2025-07-18 04:44:35,072 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'USDSGD', 'USDZAR', 'EURPLN', 'SGDJPY', 'USDCHF', 'USDNOK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'NOKSEK', 'USDCAD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:44:35,075 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:44:35,077 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:35,098 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:35,103 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:44:35,133 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:37,339 - DEBUG - orders - Market data update received for symbols: ['GBPSEK', 'XAGUSD', 'NZDJPY', 'GBPAUD', 'BTCUSD', 'USDJPY', 'CADCHF', 'USDSGD', 'EURZAR', 'EURSEK', 'USDZAR', 'SGDJPY', 'USDCHF', 'EURCAD', 'USDNOK', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'AUDCHF', 'NOKSEK', 'EURSGD', 'EURGBP'], triggering optimized SL/TP check
2025-07-18 04:44:37,345 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:44:37,355 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:37,391 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:37,396 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
2025-07-18 04:44:37,436 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:39,680 - DEBUG - orders - Market data update received for symbols: ['XAGUSD', 'BTCUSD', 'USDCNH', 'CADCHF', 'USDSGD', 'USDZAR', 'EURPLN', 'SGDJPY', 'JP225', 'EURCAD', 'CADJPY', 'USDSEK', 'US30', 'EURAUD', 'CHFSGD', 'EURNOK', 'GBPNZD', 'D30', 'NZDCAD', 'GBPNOK', 'EURUSD', 'NOKSEK', 'EURSGD', 'USDCAD'], triggering optimized SL/TP check
2025-07-18 04:44:39,686 - DEBUG - orders - Processing SL/TP for symbol XAGUSD with 1 users
2025-07-18 04:44:39,693 - DEBUG - orders - Processing SL/TP for symbol BTCUSD with 4 users
2025-07-18 04:44:39,767 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:44:41,938 - DEBUG - orders - Market data update received for symbols: ['NZDJPY', 'GBPAUD', 'USDJPY', 'CADCHF', 'EURNZD', 'USDSGD', 'EURZAR', 'AUDJPY', 'EURSEK', 'USDZAR', 'EURPLN', 'EURCAD', 'USDNOK', 'CADJPY', 'USDSEK', 'GBPUSD', 'EURAUD', 'CHFSGD', 'AUDUSD', 'AUDCAD', 'EURNOK', 'GBPNZD', 'EURCHF', 'D30', 'NZDCAD', 'GBPNOK', 'CHFJPY', 'EURUSD', 'NOKSEK', 'EURSGD', 'EURGBP', 'EURJPY'], triggering optimized SL/TP check
2025-07-18 04:44:41,953 - DEBUG - orders - Processing SL/TP for symbol AUDJPY with 2 users
2025-07-18 04:44:41,981 - DEBUG - orders - Processing SL/TP for symbol GBPUSD with 1 users
2025-07-18 04:44:41,989 - DEBUG - orders - Processing SL/TP for symbol AUDCAD with 2 users
