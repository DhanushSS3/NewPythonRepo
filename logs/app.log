2025-07-21 01:28:34,072 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:28:34,119 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:28:34,132 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:28:34,132 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:28:34,535 - INFO - app - Application starting up - Trading system initialized
2025-07-21 01:28:34,536 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-21 01:28:34,537 - INFO - app - Environment: PRODUCTION
2025-07-21 01:28:34,606 - INFO - app - Application startup initiated
2025-07-21 01:28:34,607 - INFO - app - Initializing core services...
2025-07-21 01:28:34,673 - INFO - app - Firebase initialized
2025-07-21 01:28:34,673 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-21 01:28:34,706 - INFO - app - Redis initialized
2025-07-21 01:28:35,314 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-21 01:28:35,317 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-21 01:28:35,320 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-21 01:28:35,320 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-21 01:28:35,321 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-21 01:28:35,322 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-21 01:28:35,322 - INFO - app - Scheduler initialized
2025-07-21 01:28:35,324 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-21 01:28:35,324 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-21 01:28:36,647 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-21 01:28:36,675 - INFO - app - Starting stale cache cleanup task
2025-07-21 01:28:36,727 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-21 01:28:36,727 - INFO - app - Background tasks initialized
2025-07-21 01:28:36,727 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:28:37,469 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:28:37,469 - INFO - app - Application startup completed successfully
2025-07-21 01:28:37,470 - INFO - app - Starting cache validation task
2025-07-21 01:28:37,472 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-21 01:28:37,475 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-21 01:28:37,477 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-21 01:28:37,477 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:28:37,477 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:28:37,477 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:28:37,478 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:28:37,542 - INFO - app - Found 24 static orders cache entries to check
2025-07-21 01:28:37,553 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-21 01:28:37,557 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-21 01:28:37,560 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-21 01:28:37,568 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-21 01:28:37,573 - INFO - app - Validating cache for 29 users
2025-07-21 01:28:37,574 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:28:37,574 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:28:37,574 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:28:37,576 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-21 01:28:37,584 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,605 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-21 01:28:37,611 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-21 01:28:37,615 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-21 01:28:37,623 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-21 01:28:37,626 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-21 01:28:37,636 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-21 01:28:37,638 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-21 01:28:37,642 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-21 01:28:37,643 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,646 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-21 01:28:37,661 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-21 01:28:37,665 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,669 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-21 01:28:37,672 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-21 01:28:37,673 - INFO - app - Completed stale cache cleanup task
2025-07-21 01:28:37,695 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,714 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,734 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,748 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,766 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,783 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,794 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,806 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,816 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,826 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,836 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,846 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,854 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,898 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,911 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-21 01:28:37,923 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:28:37,926 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-21 01:28:38,286 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-581.14465733055773338019411', 'margin': '3249.78', 'free_margin': '-3830.92465733055773338019411', 'profit_loss': '-20396.57465733055773338019411', 'margin_level': '-17.88258458512753889125399596', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-20396.57465733055773338019411', 'current_price': '96.5170000000'}], 'margin_call': False}
2025-07-21 01:28:38,290 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -17.88258458512753889125399596
2025-07-21 01:28:38,290 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:28:38,291 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:28:38,296 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:28:38,296 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:28:38,308 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:28:38,428 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:28:38,428 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:28:38,435 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-21 01:28:38,448 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-21 01:28:38,469 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-21 01:28:38,481 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-21 01:28:38,500 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-21 01:28:38,516 - INFO - app - Cache validation completed
2025-07-21 01:28:38,666 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:28:38,982 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:28:38,985 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:28:38,987 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:28:38,989 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:28:38,989 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3442600000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3442600000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3442500000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3442500000'}], 'margin_call': False}
2025-07-21 01:28:39,010 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:28:39,011 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:28:39,011 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:28:39,033 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,033 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:28:39,056 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,057 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:28:39,081 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,081 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:28:39,270 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:28:39,356 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:28:39,586 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:28:39,604 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:28:39,604 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:28:39,621 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 6.317664711251403398747439267% which is below threshold 100.0%
2025-07-21 01:28:39,622 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '599.828780710351120273055997', 'margin': '9494.47', 'free_margin': '-8894.641219289648879726944003', 'profit_loss': '-9302.191219289648879726944003', 'margin_level': '6.317664711251403398747439267', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9257.970000000000000000000000', 'current_price': '119352.5000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-40.20110844513534520631273022', 'current_price': '96.5170000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.020110844513534520631273022', 'current_price': '96.5170000000'}], 'margin_call': True}
2025-07-21 01:28:39,624 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 6.317664711251403398747439267
2025-07-21 01:28:39,640 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:28:39,647 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:28:39,672 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:28:39,704 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:28:39,704 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:28:39,705 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:28:39,732 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:28:39,742 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:28:39,750 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,751 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:28:39,797 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,797 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:28:39,863 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,864 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:28:39,923 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,923 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:28:39,955 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,955 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:28:39,992 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:39,992 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:28:40,034 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:40,034 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:28:40,073 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:28:40,080 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:28:40,080 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:28:40,083 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:40,083 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:28:40,098 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:28:40,098 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:28:40,104 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:28:40,104 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:28:40,104 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:28:40,105 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:28:40,109 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:28:40,120 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:28:40,122 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:28:40,128 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:28:40,128 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:28:40,141 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:28:40,141 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:28:40,141 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:28:40,141 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:28:40,252 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:28:40,643 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.895293955146194299112963269% which is below threshold 100.0%
2025-07-21 01:28:40,644 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '290.615000000000000000000000', 'margin': '5936.62', 'free_margin': '-5646.005000000000000000000000', 'profit_loss': '-6099.005000000000000000000000', 'margin_level': '4.895293955146194299112963269', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6099.005000000000000000000000', 'current_price': '119233.6000000000'}], 'margin_call': True}
2025-07-21 01:28:40,648 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.895293955146194299112963269
2025-07-21 01:28:40,687 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:28:40,688 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:28:40,786 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:28:41,152 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 70.58894366071707123628873423% which is below threshold 100.0%
2025-07-21 01:28:41,152 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '103401.8400000000000000000000', 'margin': '146484.47', 'free_margin': '-43082.6300000000000000000000', 'profit_loss': '-80943.97000000000000000000000', 'margin_level': '70.58894366071707123628873423', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-132.5500000000000000000000000', 'current_price': '38.4490000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-80811.42000000000000000000000', 'current_price': '119233.6000000000'}], 'margin_call': True}
2025-07-21 01:28:41,154 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 70.58894366071707123628873423
2025-07-21 01:28:41,157 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:28:41,157 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:28:41,217 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:41,217 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:28:41,219 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:28:41,219 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:28:41,237 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:28:41,240 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:28:41,240 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:28:41,289 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:41,290 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:28:41,291 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:28:41,291 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:28:41,293 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:28:41,293 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:28:41,495 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:28:41,496 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:28:41,974 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:28:41,978 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:28:41,980 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:28:41,980 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:28:42,181 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:28:42,183 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:28:42,589 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:28:42,608 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:28:42,608 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:28:42,608 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:28:42,790 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:28:42,792 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:28:43,203 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:28:43,222 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:28:43,222 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:28:43,222 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:28:43,325 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:43,325 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:28:43,346 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:28:52,471 - INFO - app - Starting stale cache cleanup task
2025-07-21 01:28:52,473 - INFO - app - Found 24 static orders cache entries to check
2025-07-21 01:28:52,476 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-21 01:28:52,477 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-21 01:28:52,478 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-21 01:28:52,479 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-21 01:28:52,481 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-21 01:28:52,483 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-21 01:28:52,487 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-21 01:28:52,488 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-21 01:28:52,490 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-21 01:28:52,492 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-21 01:28:52,498 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-21 01:28:52,499 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-21 01:28:52,500 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-21 01:28:52,501 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-21 01:28:52,503 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-21 01:28:52,507 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-21 01:28:52,509 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-21 01:28:52,510 - INFO - app - Completed stale cache cleanup task
2025-07-21 01:28:56,006 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 1
2025-07-21 01:28:56,009 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 1
2025-07-21 01:28:56,010 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 1
2025-07-21 01:28:56,011 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 1
2025-07-21 01:28:56,014 - WARNING - app.api.v1.endpoints.users - Refresh token valid, but user ID 1 not found or inactive.
2025-07-21 01:28:56,019 - WARNING - app.api.v1.endpoints.users - Refresh token valid, but user ID 1 not found or inactive.
2025-07-21 01:28:56,020 - INFO - app.api.v1.endpoints.users - Invalidated refresh token for invalid user ID 1.
2025-07-21 01:28:56,022 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: User not found or inactive
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 331, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive
2025-07-21 01:28:56,043 - INFO - app.api.v1.endpoints.users - Invalidated refresh token for invalid user ID 1.
2025-07-21 01:28:56,044 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: User not found or inactive
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 331, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive
2025-07-21 01:29:13,348 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:29:13,348 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:29:13,348 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:29:13,348 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:29:13,355 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:29:13,355 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:29:13,356 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:29:13,450 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:29:13,826 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2257.46716467844952857287689', 'margin': '3249.78', 'free_margin': '-5507.24716467844952857287689', 'profit_loss': '-22072.89716467844952857287689', 'margin_level': '-69.46523040570283307094255273', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22072.89716467844952857287689', 'current_price': '96.269'}], 'margin_call': False}
2025-07-21 01:29:13,829 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -69.46523040570283307094255273
2025-07-21 01:29:13,831 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:29:13,831 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:29:13,842 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:29:13,843 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:29:13,869 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:29:13,876 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:29:13,876 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:29:13,992 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:29:14,334 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:29:14,337 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:29:14,340 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:29:14,342 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:29:14,343 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.344705'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.344705'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3445449999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3445449999999999'}], 'margin_call': False}
2025-07-21 01:29:14,344 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:29:14,346 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:29:14,346 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:29:14,386 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:14,386 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:29:14,446 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:14,446 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:29:14,505 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:14,506 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:29:14,761 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:29:15,157 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 5.297745789505645053284436488% which is below threshold 100.0%
2025-07-21 01:29:15,158 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '502.992884660876617890574837', 'margin': '9494.47', 'free_margin': '-8991.477115339123382109425163', 'profit_loss': '-9399.027115339123382109425163', 'margin_level': '5.297745789505645053284436488', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9338.970000000000000000000000', 'current_price': '119150.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.59737758102125646311378460', 'current_price': '96.304'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.459737758102125646311378460', 'current_price': '96.304'}], 'margin_call': True}
2025-07-21 01:29:15,162 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 5.297745789505645053284436488
2025-07-21 01:29:15,230 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:29:15,230 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:29:15,297 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:15,297 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:29:15,355 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:15,355 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:29:15,403 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:15,404 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:29:15,449 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:15,449 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:29:15,525 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:15,525 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:29:15,705 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:15,705 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:29:15,744 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:15,745 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:29:15,782 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:15,782 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:29:15,902 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:29:16,278 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.754473084010767069477244627% which is below threshold 100.0%
2025-07-21 01:29:16,278 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '282.255000000000000000000000', 'margin': '5936.62', 'free_margin': '-5654.365000000000000000000000', 'profit_loss': '-6107.365000000000000000000000', 'margin_level': '4.754473084010767069477244627', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6107.365000000000000000000000', 'current_price': '119150.0'}], 'margin_call': True}
2025-07-21 01:29:16,285 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.754473084010767069477244627
2025-07-21 01:29:16,338 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:29:16,338 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:29:16,462 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:29:16,788 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 70.21977483346869449710266215% which is below threshold 100.0%
2025-07-21 01:29:16,789 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '102861.0649999999997500000000', 'margin': '146484.47', 'free_margin': '-43623.4050000000002500000000', 'profit_loss': '-81484.74500000000025000000000', 'margin_level': '70.21977483346869449710266215', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-133.3250000000002500000000000', 'current_price': '38.433499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-81351.42000000000000000000000', 'current_price': '119143.6'}], 'margin_call': True}
2025-07-21 01:29:16,953 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 70.21977483346869449710266215
2025-07-21 01:29:16,956 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:29:16,956 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:29:17,033 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:17,033 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:29:17,036 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:29:17,037 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:29:17,078 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:29:17,082 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:29:17,082 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:29:17,147 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:17,147 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:29:17,150 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:29:17,150 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:29:17,152 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:29:17,153 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:29:17,343 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:29:17,344 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:29:17,712 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:29:17,716 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:29:17,719 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:29:17,719 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:29:18,050 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:29:18,051 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:29:18,408 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:29:18,412 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:29:18,412 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:29:18,412 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:29:18,544 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:29:18,545 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:29:18,939 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:29:18,942 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:29:18,942 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:29:18,943 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:29:19,012 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:19,012 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:29:19,057 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:35,323 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:29:35,635 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:29:49,072 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:29:49,072 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:29:49,072 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:29:49,072 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:29:49,080 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:29:49,080 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:29:49,080 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:29:49,344 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:29:49,660 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2257.17014734010557121325791', 'margin': '3249.78', 'free_margin': '-5506.95014734010557121325791', 'profit_loss': '-22072.60014734010557121325791', 'margin_level': '-69.45609079199532187450405597', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22072.60014734010557121325791', 'current_price': '96.269'}], 'margin_call': False}
2025-07-21 01:29:49,663 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -69.45609079199532187450405597
2025-07-21 01:29:49,663 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:29:49,663 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:29:49,669 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:29:49,669 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:29:49,685 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:29:49,688 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:29:49,689 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:29:49,832 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:29:50,176 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:29:50,191 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:29:50,196 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:29:50,200 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:29:50,201 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.344735'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.344735'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3445749999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3445749999999999'}], 'margin_call': False}
2025-07-21 01:29:50,203 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:29:50,205 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:29:50,205 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:29:50,253 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:50,253 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:29:50,308 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:50,309 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:29:50,349 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:50,350 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:29:50,630 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:29:50,995 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 5.323002676224250012753461815% which is below threshold 100.0%
2025-07-21 01:29:50,996 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '505.390892193308550185873606', 'margin': '9494.47', 'free_margin': '-8989.079107806691449814126394', 'profit_loss': '-9396.629107806691449814126394', 'margin_level': '5.323002676224250012753461815', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9336.570000000000000000000000', 'current_price': '119156.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.59918891517404528556944914', 'current_price': '96.304'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.459918891517404528556944914', 'current_price': '96.304'}], 'margin_call': True}
2025-07-21 01:29:51,000 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 5.323002676224250012753461815
2025-07-21 01:29:51,056 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:29:51,056 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:29:51,119 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:51,119 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:29:51,185 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:51,185 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:29:51,248 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:51,249 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:29:51,329 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:51,329 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:29:51,388 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:51,388 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:29:51,448 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:51,449 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:29:51,525 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:51,525 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:29:51,554 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:51,554 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:29:51,641 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:29:52,011 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.784624921251486536109772901% which is below threshold 100.0%
2025-07-21 01:29:52,011 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '284.045000000000000000000000', 'margin': '5936.62', 'free_margin': '-5652.575000000000000000000000', 'profit_loss': '-6105.575000000000000000000000', 'margin_level': '4.784624921251486536109772901', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6105.575000000000000000000000', 'current_price': '119167.9'}], 'margin_call': True}
2025-07-21 01:29:52,014 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.784624921251486536109772901
2025-07-21 01:29:52,058 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:29:52,059 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:29:52,158 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:29:52,524 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 70.31923930229600448429789178% which is below threshold 100.0%
2025-07-21 01:29:52,524 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '103006.7650000000000000000000', 'margin': '146484.47', 'free_margin': '-43477.7050000000000000000000', 'profit_loss': '-81339.04500000000000000000000', 'margin_level': '70.31923930229600448429789178', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-133.425000000000000000000000', 'current_price': '38.4315'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-81205.62000000000000000000000', 'current_price': '119167.9'}], 'margin_call': True}
2025-07-21 01:29:52,556 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 70.31923930229600448429789178
2025-07-21 01:29:52,557 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:29:52,558 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:29:52,593 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:52,593 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:29:52,594 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:29:52,594 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:29:52,608 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:29:52,610 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:29:52,610 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:29:52,666 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:52,666 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:29:52,668 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:29:52,668 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:29:52,669 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:29:52,669 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:29:52,816 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:29:52,817 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:29:53,139 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:29:53,141 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:29:53,143 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:29:53,143 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:29:53,260 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:29:53,261 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:29:53,650 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:29:53,660 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:29:53,660 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:29:53,660 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:29:53,759 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:29:53,759 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:29:54,165 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:29:54,168 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:29:54,168 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:29:54,168 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:29:54,223 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:29:54,223 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:29:54,250 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:24,279 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:30:24,280 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:30:24,280 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:30:24,280 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:30:24,291 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:30:24,291 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:30:24,291 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:30:24,372 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:30:24,783 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2271.72782358905035484961136', 'margin': '3249.78', 'free_margin': '-5521.50782358905035484961136', 'profit_loss': '-22087.15782358905035484961136', 'margin_level': '-69.90404961532935629025999791', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22087.15782358905035484961136', 'current_price': '96.267'}], 'margin_call': False}
2025-07-21 01:30:24,815 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -69.90404961532935629025999791
2025-07-21 01:30:24,815 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:30:24,815 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:30:24,821 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:30:24,821 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:30:24,839 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:30:24,841 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:30:24,841 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:30:24,920 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:30:25,298 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:30:25,308 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:30:25,321 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:30:25,327 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:30:25,327 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.344825'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.344825'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.344665'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.344665'}], 'margin_call': False}
2025-07-21 01:30:25,359 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:30:25,361 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:30:25,361 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:30:25,389 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:25,389 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:30:25,407 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:25,407 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:30:25,426 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:25,426 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:30:25,490 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:30:25,914 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 5.297001236599298774751851931% which is below threshold 100.0%
2025-07-21 01:30:25,915 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '502.922193308549442379182156', 'margin': '9494.47', 'free_margin': '-8991.547806691450557620817844', 'profit_loss': '-9399.097806691450557620817844', 'margin_level': '5.297001236599298774751851931', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9338.890000000000000000000000', 'current_price': '119150.2'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.73436971950050692801622170', 'current_price': '96.30199999999999'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.473436971950050692801622170', 'current_price': '96.30199999999999'}], 'margin_call': True}
2025-07-21 01:30:25,950 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 5.297001236599298774751851931
2025-07-21 01:30:25,986 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:30:25,986 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:30:26,002 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:26,002 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:30:26,017 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:26,018 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:30:26,033 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:26,033 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:30:26,053 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:26,053 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:30:26,067 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:26,067 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:30:26,081 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:26,082 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:30:26,096 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:26,096 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:30:26,110 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:26,110 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:30:26,156 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:30:26,522 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.754809976046976225529004720% which is below threshold 100.0%
2025-07-21 01:30:26,522 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '282.275000000000000000000000', 'margin': '5936.62', 'free_margin': '-5654.345000000000000000000000', 'profit_loss': '-6107.345000000000000000000000', 'margin_level': '4.754809976046976225529004720', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6107.345000000000000000000000', 'current_price': '119150.2'}], 'margin_call': True}
2025-07-21 01:30:26,525 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.754809976046976225529004720
2025-07-21 01:30:26,570 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:30:26,571 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:30:26,647 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:30:27,033 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 70.24670601600292491756976013% which is below threshold 100.0%
2025-07-21 01:30:27,034 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '102900.5149999999997500000000', 'margin': '146484.47', 'free_margin': '-43583.9550000000002500000000', 'profit_loss': '-81445.29500000000025000000000', 'margin_level': '70.24670601600292491756976013', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-133.4750000000002500000000000', 'current_price': '38.430499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-81311.82000000000000000000000', 'current_price': '119150.2'}], 'margin_call': True}
2025-07-21 01:30:27,037 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 70.24670601600292491756976013
2025-07-21 01:30:27,040 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:30:27,040 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:30:27,091 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:27,091 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:30:27,092 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:30:27,093 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:30:27,109 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:30:27,111 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:30:27,111 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:30:27,143 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:27,143 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:30:27,144 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:30:27,144 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:30:27,146 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:30:27,146 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:30:27,229 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:30:27,229 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:30:27,649 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:30:27,652 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:30:27,657 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:30:27,657 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:30:27,769 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:30:27,769 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:30:28,098 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:30:28,101 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:30:28,101 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:30:28,102 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:30:28,196 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:30:28,196 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:30:28,581 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:30:28,584 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:30:28,584 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:30:28,584 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:30:28,648 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:28,648 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:30:28,681 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:35,327 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:30:35,738 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:30:58,687 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:30:58,687 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:30:58,688 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:30:58,688 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:30:58,729 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:30:58,729 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:30:58,729 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:30:58,839 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:30:59,188 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2294.08762924507895306078304', 'margin': '3249.78', 'free_margin': '-5543.86762924507895306078304', 'profit_loss': '-22109.51762924507895306078304', 'margin_level': '-70.59209021057052948386607832', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22109.51762924507895306078304', 'current_price': '96.264'}], 'margin_call': False}
2025-07-21 01:30:59,191 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -70.59209021057052948386607832
2025-07-21 01:30:59,191 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:30:59,191 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:30:59,196 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:30:59,196 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:30:59,211 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:30:59,219 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:30:59,219 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:30:59,360 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:30:59,701 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:30:59,703 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:30:59,707 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:30:59,709 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:30:59,709 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.344895'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.344895'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.344735'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.344735'}], 'margin_call': False}
2025-07-21 01:30:59,711 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:30:59,713 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:30:59,713 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:30:59,786 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:59,786 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:30:59,933 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:59,933 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:30:59,978 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:30:59,979 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:31:00,092 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:31:00,419 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 5.333348033928789409787864462% which is below threshold 100.0%
2025-07-21 01:31:00,420 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '506.373129076958731875485855', 'margin': '9494.47', 'free_margin': '-8988.096870923041268124514145', 'profit_loss': '-9395.646870923041268124514145', 'margin_level': '5.333348033928789409787864462', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9335.210000000000000000000000', 'current_price': '119159.4'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.94260993003751647683104066', 'current_price': '96.29899999999999'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.494260993003751647683104066', 'current_price': '96.29899999999999'}], 'margin_call': True}
2025-07-21 01:31:00,422 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 5.333348033928789409787864462
2025-07-21 01:31:00,470 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:31:00,471 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:31:00,529 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:00,529 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:31:00,588 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:00,589 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:31:00,633 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:00,634 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:31:00,666 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:00,666 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:31:00,685 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:00,685 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:31:00,707 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:00,707 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:31:00,762 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:00,762 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:31:00,836 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:00,836 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:31:01,000 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:31:01,339 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.773002146002270652324049712% which is below threshold 100.0%
2025-07-21 01:31:01,340 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '283.355000000000000000000000', 'margin': '5936.62', 'free_margin': '-5653.265000000000000000000000', 'profit_loss': '-6106.265000000000000000000000', 'margin_level': '4.773002146002270652324049712', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6106.265000000000000000000000', 'current_price': '119161.0'}], 'margin_call': True}
2025-07-21 01:31:01,343 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.773002146002270652324049712
2025-07-21 01:31:01,396 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:31:01,396 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:31:01,605 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:31:01,951 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 70.29104518724749439309163627% which is below threshold 100.0%
2025-07-21 01:31:01,951 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '102965.4649999999997500000000', 'margin': '146484.47', 'free_margin': '-43519.0050000000002500000000', 'profit_loss': '-81380.34500000000025000000000', 'margin_level': '70.29104518724749439309163627', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-133.3250000000002500000000000', 'current_price': '38.433499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-81247.02000000000000000000000', 'current_price': '119161.0'}], 'margin_call': True}
2025-07-21 01:31:01,953 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 70.29104518724749439309163627
2025-07-21 01:31:01,955 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:31:01,955 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:31:01,992 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:01,993 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:31:01,994 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:31:01,994 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:31:02,005 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:31:02,008 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:31:02,008 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:31:02,041 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:02,041 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:31:02,043 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:31:02,043 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:31:02,045 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:31:02,045 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:31:02,236 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:31:02,237 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:31:02,666 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:31:02,697 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:31:02,698 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:31:02,699 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:31:02,813 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:31:02,814 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:31:03,179 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:31:03,181 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:31:03,181 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:31:03,182 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:31:03,306 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:31:03,307 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:31:03,612 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:31:03,616 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:31:03,616 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:31:03,617 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:31:03,654 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:03,654 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:31:03,685 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:33,701 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:31:33,701 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:31:33,701 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:31:33,701 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:31:33,705 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:31:33,705 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:31:33,705 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:31:33,797 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:31:34,210 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2287.17921878907913503721179', 'margin': '3249.78', 'free_margin': '-5536.95921878907913503721179', 'profit_loss': '-22102.60921878907913503721179', 'margin_level': '-70.37950934491193665531856895', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22102.60921878907913503721179', 'current_price': '96.265'}], 'margin_call': False}
2025-07-21 01:31:34,243 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -70.37950934491193665531856895
2025-07-21 01:31:34,244 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:31:34,244 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:31:34,255 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:31:34,256 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:31:34,282 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:31:34,291 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:31:34,292 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:31:34,491 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:31:34,840 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:31:34,864 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:31:34,901 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:31:34,914 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:31:34,915 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.344865'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.344865'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.344705'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.344705'}], 'margin_call': False}
2025-07-21 01:31:34,919 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:31:34,922 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:31:34,922 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:31:34,977 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:34,977 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:31:35,019 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:35,020 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:31:35,048 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:35,048 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:31:35,139 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:31:35,538 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:31:35,854 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:31:35,858 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 5.462635484064875242506565801% which is below threshold 100.0%
2025-07-21 01:31:35,859 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '518.648287243894360437213138', 'margin': '9494.47', 'free_margin': '-8975.821712756105639562786862', 'profit_loss': '-9383.371712756105639562786862', 'margin_level': '5.462635484064875242506565801', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9323.010000000000000000000000', 'current_price': '119189.9'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.87428432373239960253351089', 'current_price': '96.3'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.487428432373239960253351089', 'current_price': '96.3'}], 'margin_call': True}
2025-07-21 01:31:35,894 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 5.462635484064875242506565801
2025-07-21 01:31:35,945 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:31:35,945 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:31:35,967 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:35,967 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:31:36,006 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:36,006 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:31:36,046 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:36,047 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:31:36,099 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:36,100 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:31:36,162 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:36,162 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:31:36,227 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:36,227 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:31:36,277 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:36,277 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:31:36,318 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:36,318 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:31:36,505 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:31:36,869 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.821683045234493701803383070% which is below threshold 100.0%
2025-07-21 01:31:36,869 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '286.245000000000000000000000', 'margin': '5936.62', 'free_margin': '-5650.375000000000000000000000', 'profit_loss': '-6103.375000000000000000000000', 'margin_level': '4.821683045234493701803383070', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6103.375000000000000000000000', 'current_price': '119189.9'}], 'margin_call': True}
2025-07-21 01:31:36,872 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.821683045234493701803383070
2025-07-21 01:31:36,928 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:31:36,928 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:31:37,197 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:31:37,553 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 70.40955604372258711111150554% which is below threshold 100.0%
2025-07-21 01:31:37,554 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '103139.0650000000000000000000', 'margin': '146484.47', 'free_margin': '-43345.4050000000000000000000', 'profit_loss': '-81206.74500000000000000000000', 'margin_level': '70.40955604372258711111150554', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-133.125000000000000000000000', 'current_price': '38.4375'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-81073.62000000000000000000000', 'current_price': '119189.9'}], 'margin_call': True}
2025-07-21 01:31:37,556 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 70.40955604372258711111150554
2025-07-21 01:31:37,559 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:31:37,560 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:31:37,630 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:37,630 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:31:37,632 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:31:37,632 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:31:37,648 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:31:37,650 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:31:37,650 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:31:37,723 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:37,723 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:31:37,726 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:31:37,726 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:31:37,728 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:31:37,728 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:31:37,871 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:31:37,872 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:31:38,302 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:31:38,306 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:31:38,308 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:31:38,308 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:31:38,442 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:31:38,442 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:31:38,815 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:31:38,849 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:31:38,849 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:31:38,849 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:31:38,973 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:31:38,973 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:31:39,327 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:31:39,361 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:31:39,362 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:31:39,362 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:31:39,439 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:31:39,439 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:31:39,478 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:09,489 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:32:09,489 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:32:09,489 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:32:09,490 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:32:09,508 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:32:09,509 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:32:09,509 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:32:09,743 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:32:10,050 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2307.45812129487552133678525', 'margin': '3249.78', 'free_margin': '-5557.23812129487552133678525', 'profit_loss': '-22122.88812129487552133678525', 'margin_level': '-71.00351781643297458094964121', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22122.88812129487552133678525', 'current_price': '96.262'}], 'margin_call': False}
2025-07-21 01:32:10,053 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -71.00351781643297458094964121
2025-07-21 01:32:10,053 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:32:10,054 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:32:10,064 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:32:10,065 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:32:10,087 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:32:10,091 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:32:10,091 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:32:10,212 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:32:10,560 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:32:10,566 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:32:10,570 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:32:10,573 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:32:10,574 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3448550000000001'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3448550000000001'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.344695'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.344695'}], 'margin_call': False}
2025-07-21 01:32:10,576 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:32:10,577 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:32:10,578 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:32:10,613 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:10,613 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:32:10,650 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:10,650 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:32:10,679 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:10,679 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:32:10,909 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:32:11,219 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 5.464984935140751623697883568% which is below threshold 100.0%
2025-07-21 01:32:11,219 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '518.871355171458120686508446', 'margin': '9494.47', 'free_margin': '-8975.598644828541879313491554', 'profit_loss': '-9383.148644828541879313491554', 'margin_level': '5.464984935140751623697883568', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9323.010000000000000000000000', 'current_price': '119189.9'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.67149529867443573953777622', 'current_price': '96.303'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.467149529867443573953777622', 'current_price': '96.303'}], 'margin_call': True}
2025-07-21 01:32:11,222 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 5.464984935140751623697883568
2025-07-21 01:32:11,279 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:32:11,279 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:32:11,331 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:11,331 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:32:11,366 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:11,366 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:32:11,409 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:11,410 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:32:11,447 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:11,447 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:32:11,489 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:11,489 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:32:11,560 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:11,561 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:32:11,592 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:11,593 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:32:11,654 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:11,655 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:32:11,909 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:32:12,245 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.821683045234493701803383070% which is below threshold 100.0%
2025-07-21 01:32:12,245 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '286.245000000000000000000000', 'margin': '5936.62', 'free_margin': '-5650.375000000000000000000000', 'profit_loss': '-6103.375000000000000000000000', 'margin_level': '4.821683045234493701803383070', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6103.375000000000000000000000', 'current_price': '119189.9'}], 'margin_call': True}
2025-07-21 01:32:12,247 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.821683045234493701803383070
2025-07-21 01:32:12,279 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:32:12,279 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:32:12,392 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:32:12,705 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 70.40952191041139019719974411% which is below threshold 100.0%
2025-07-21 01:32:12,706 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '103139.0149999999997500000000', 'margin': '146484.47', 'free_margin': '-43345.4550000000002500000000', 'profit_loss': '-81206.79500000000025000000000', 'margin_level': '70.40952191041139019719974411', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-133.1750000000002500000000000', 'current_price': '38.436499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-81073.62000000000000000000000', 'current_price': '119189.9'}], 'margin_call': True}
2025-07-21 01:32:12,707 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 70.40952191041139019719974411
2025-07-21 01:32:12,709 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:32:12,709 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:32:12,757 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:12,757 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:32:12,759 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:32:12,759 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:32:12,768 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:32:12,771 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:32:12,771 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:32:12,799 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:12,800 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:32:12,801 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:32:12,801 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:32:12,802 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:32:12,802 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:32:12,911 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:32:12,911 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:32:13,219 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:32:13,221 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:32:13,222 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:32:13,222 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:32:13,362 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:32:13,362 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:32:13,732 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:32:13,764 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:32:13,765 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:32:13,765 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:32:14,001 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:32:14,004 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:32:14,348 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:32:14,356 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:32:14,356 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:32:14,361 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:32:14,445 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:14,445 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:32:14,481 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:32:22,591 - INFO - app - Application shutdown initiated
2025-07-21 01:32:22,591 - INFO - app - Scheduler shutdown completed
2025-07-21 01:32:22,591 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-21 01:32:23,390 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-21 01:32:23,390 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-21 01:32:23,400 - INFO - app - Redis connection closed
2025-07-21 01:32:23,400 - INFO - app - Application shutdown completed
2025-07-21 01:46:03,979 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:46:04,026 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:46:04,040 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:46:04,040 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:46:04,472 - INFO - app - Application starting up - Trading system initialized
2025-07-21 01:46:04,472 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-21 01:46:04,473 - INFO - app - Environment: PRODUCTION
2025-07-21 01:46:04,522 - INFO - app - Application startup initiated
2025-07-21 01:46:04,522 - INFO - app - Initializing core services...
2025-07-21 01:46:04,573 - INFO - app - Firebase initialized
2025-07-21 01:46:04,574 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-21 01:46:04,598 - INFO - app - Redis initialized
2025-07-21 01:46:05,814 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-21 01:46:05,818 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-21 01:46:05,824 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-21 01:46:05,824 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-21 01:46:05,825 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-21 01:46:05,829 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-21 01:46:05,829 - INFO - app - Scheduler initialized
2025-07-21 01:46:05,832 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-21 01:46:05,832 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-21 01:46:06,950 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-21 01:46:06,966 - INFO - app - Starting stale cache cleanup task
2025-07-21 01:46:07,006 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-21 01:46:07,006 - INFO - app - Background tasks initialized
2025-07-21 01:46:07,006 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:46:07,663 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:46:07,663 - INFO - app - Application startup completed successfully
2025-07-21 01:46:07,664 - INFO - app - Starting cache validation task
2025-07-21 01:46:07,666 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-21 01:46:07,668 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-21 01:46:07,671 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-21 01:46:07,671 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:46:07,671 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:46:07,671 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:46:07,671 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:46:07,711 - INFO - app - Found 24 static orders cache entries to check
2025-07-21 01:46:07,721 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:46:07,721 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:46:07,721 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:46:07,723 - INFO - app - Validating cache for 29 users
2025-07-21 01:46:07,725 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-21 01:46:07,733 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,733 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-21 01:46:07,746 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-21 01:46:07,750 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-21 01:46:07,754 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-21 01:46:07,759 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-21 01:46:07,762 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-21 01:46:07,764 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-21 01:46:07,775 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,784 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-21 01:46:07,791 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-21 01:46:07,792 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,798 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-21 01:46:07,799 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-21 01:46:07,802 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-21 01:46:07,803 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-21 01:46:07,807 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-21 01:46:07,808 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,814 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-21 01:46:07,818 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-21 01:46:07,818 - INFO - app - Completed stale cache cleanup task
2025-07-21 01:46:07,828 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,843 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,855 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,868 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,880 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,892 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,906 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,918 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,931 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,943 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,955 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,964 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-21 01:46:07,975 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-21 01:46:08,038 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-21 01:46:08,050 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-21 01:46:08,068 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-21 01:46:08,080 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-21 01:46:08,095 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-21 01:46:08,105 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:46:08,107 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-21 01:46:08,486 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2033.11513465962917850859386', 'margin': '3249.78', 'free_margin': '-5282.89513465962917850859386', 'profit_loss': '-21848.54513465962917850859386', 'margin_level': '-62.56162369943901367195914370', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-21848.54513465962917850859386', 'current_price': '96.3060000000'}], 'margin_call': False}
2025-07-21 01:46:08,489 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -62.56162369943901367195914370
2025-07-21 01:46:08,489 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:46:08,489 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:46:08,496 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:46:08,496 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:46:08,503 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-21 01:46:08,507 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:46:08,513 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:46:08,514 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:46:08,516 - INFO - app - Cache validation completed
2025-07-21 01:46:08,733 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:46:09,099 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:46:09,101 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:46:09,102 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:46:09,104 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:46:09,104 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3447800000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3447800000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3447700000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3447700000'}], 'margin_call': False}
2025-07-21 01:46:09,106 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:46:09,107 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:46:09,107 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:46:09,130 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,130 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:46:09,152 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,152 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:46:09,177 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,177 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:46:09,310 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:46:09,611 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 5.677325201048291106995924933% which is below threshold 100.0%
2025-07-21 01:46:09,611 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '539.031938015969684666395994', 'margin': '9494.47', 'free_margin': '-8955.438061984030315333604006', 'profit_loss': '-9362.988061984030315333604006', 'margin_level': '5.677325201048291106995924933', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9303.010000000000000000000000', 'current_price': '119239.9000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.52551089457301393964000541', 'current_price': '96.3060000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.452551089457301393964000541', 'current_price': '96.3060000000'}], 'margin_call': True}
2025-07-21 01:46:09,612 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 5.677325201048291106995924933
2025-07-21 01:46:09,646 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:46:09,646 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:46:09,677 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,677 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:46:09,709 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,709 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:46:09,742 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,742 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:46:09,778 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,778 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:46:09,815 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,815 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:46:09,852 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,852 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:46:09,887 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,888 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:46:09,927 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:09,927 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:46:10,080 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:46:10,083 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:46:10,084 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:46:10,086 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:46:10,145 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:46:10,178 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:46:10,208 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:46:10,227 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:46:10,388 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:46:10,390 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:46:10,410 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:46:10,412 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:46:10,412 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:46:10,412 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:46:10,412 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:46:10,415 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:46:10,457 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:46:10,457 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:46:10,462 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:46:10,464 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:46:10,474 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:46:10,523 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:46:10,523 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:46:10,524 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:46:10,533 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.905906054286782714743406181% which is below threshold 100.0%
2025-07-21 01:46:10,533 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '291.245000000000000000000000', 'margin': '5936.62', 'free_margin': '-5645.375000000000000000000000', 'profit_loss': '-6098.375000000000000000000000', 'margin_level': '4.905906054286782714743406181', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6098.375000000000000000000000', 'current_price': '119239.9000000000'}], 'margin_call': True}
2025-07-21 01:46:10,535 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.905906054286782714743406181
2025-07-21 01:46:10,555 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:46:10,555 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:46:10,559 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:46:10,567 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:46:10,567 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:46:10,576 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:46:10,576 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:46:10,712 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:46:11,041 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.59965790230186176049925292% which is below threshold 100.0%
2025-07-21 01:46:11,041 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101952.6900000000000000000000', 'margin': '146484.47', 'free_margin': '-44531.7800000000000000000000', 'profit_loss': '-82393.12000000000000000000000', 'margin_level': '69.59965790230186176049925292', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-133.3000000000000000000000000', 'current_price': '38.4340000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82259.82000000000000000000000', 'current_price': '118992.2000000000'}], 'margin_call': True}
2025-07-21 01:46:11,044 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.59965790230186176049925292
2025-07-21 01:46:11,045 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:46:11,045 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:46:11,074 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:11,074 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:46:11,075 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:46:11,075 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:46:11,081 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:46:11,083 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:46:11,083 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:46:11,105 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:11,105 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:46:11,106 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:46:11,107 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:46:11,107 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:46:11,107 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:46:11,243 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:46:11,244 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:46:11,867 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:46:11,869 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:46:11,870 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:46:11,870 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:46:12,039 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:46:12,040 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:46:12,372 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:46:12,374 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:46:12,374 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:46:12,374 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:46:12,590 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:46:12,591 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:46:12,887 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:46:12,888 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:46:12,888 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:46:12,888 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:46:12,928 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:12,928 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:46:12,956 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:46:15,155 - INFO - app - Application shutdown initiated
2025-07-21 01:46:15,155 - INFO - app - Scheduler shutdown completed
2025-07-21 01:46:15,158 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-21 01:46:17,008 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-21 01:46:17,008 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-21 01:46:17,013 - INFO - app - Redis connection closed
2025-07-21 01:46:17,014 - INFO - app - Application shutdown completed
2025-07-21 01:50:33,267 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:50:33,314 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:50:33,326 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:50:33,327 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:50:33,878 - INFO - app - Application starting up - Trading system initialized
2025-07-21 01:50:33,878 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-21 01:50:33,878 - INFO - app - Environment: PRODUCTION
2025-07-21 01:50:33,935 - INFO - app - Application startup initiated
2025-07-21 01:50:33,935 - INFO - app - Initializing core services...
2025-07-21 01:50:34,018 - INFO - app - Firebase initialized
2025-07-21 01:50:34,018 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-21 01:50:34,036 - INFO - app - Redis initialized
2025-07-21 01:50:34,854 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-21 01:50:34,858 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-21 01:50:34,862 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-21 01:50:34,863 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-21 01:50:34,863 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-21 01:50:34,864 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-21 01:50:34,864 - INFO - app - Scheduler initialized
2025-07-21 01:50:34,867 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-21 01:50:34,867 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-21 01:50:36,158 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-21 01:50:36,175 - INFO - app - Starting stale cache cleanup task
2025-07-21 01:50:36,222 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-21 01:50:36,222 - INFO - app - Background tasks initialized
2025-07-21 01:50:36,222 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:50:36,973 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:50:36,973 - INFO - app - Application startup completed successfully
2025-07-21 01:50:36,979 - INFO - app - Starting cache validation task
2025-07-21 01:50:36,986 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-21 01:50:36,991 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-21 01:50:36,996 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-21 01:50:36,996 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:50:36,996 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:50:36,997 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:50:36,997 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:50:37,037 - INFO - app - Found 24 static orders cache entries to check
2025-07-21 01:50:37,049 - INFO - app - Validating cache for 29 users
2025-07-21 01:50:37,050 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:50:37,050 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:50:37,050 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:50:37,062 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-21 01:50:37,069 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-21 01:50:37,070 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-21 01:50:37,073 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-21 01:50:37,076 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-21 01:50:37,078 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-21 01:50:37,079 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-21 01:50:37,081 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-21 01:50:37,083 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-21 01:50:37,085 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-21 01:50:37,095 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-21 01:50:37,096 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-21 01:50:37,097 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-21 01:50:37,100 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-21 01:50:37,105 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-21 01:50:37,110 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-21 01:50:37,112 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-21 01:50:37,113 - INFO - app - Completed stale cache cleanup task
2025-07-21 01:50:37,147 - INFO - app - Cache validation completed
2025-07-21 01:50:37,297 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:50:37,699 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-1936.18203017693426705910213', 'margin': '3249.78', 'free_margin': '-5185.96203017693426705910213', 'profit_loss': '-21751.61203017693426705910213', 'margin_level': '-59.57886472859499003191299503', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-21751.61203017693426705910213', 'current_price': '96.3200000000'}], 'margin_call': False}
2025-07-21 01:50:37,707 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -59.57886472859499003191299503
2025-07-21 01:50:37,708 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:50:37,708 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:50:37,856 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:50:37,857 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:50:37,894 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:50:37,903 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:50:37,903 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:50:38,171 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:50:38,514 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:50:38,518 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:50:38,521 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:50:38,525 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:50:38,525 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3458600000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3458600000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3458500000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3458500000'}], 'margin_call': False}
2025-07-21 01:50:38,528 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:50:38,530 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:50:38,530 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:50:38,576 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:38,576 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:50:38,619 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:38,619 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:50:38,657 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:38,657 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:50:38,852 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:50:39,226 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.644816193577934725006947118% which is below threshold 100.0%
2025-07-21 01:50:39,226 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '441.000680054398939085367092', 'margin': '9494.47', 'free_margin': '-9053.469319945601060914632908', 'profit_loss': '-9461.019319945601060914632908', 'margin_level': '4.644816193577934725006947118', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9402.090000000000000000000000', 'current_price': '118992.2000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-53.57210904145550992239355332', 'current_price': '96.3200000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.357210904145550992239355332', 'current_price': '96.3200000000'}], 'margin_call': True}
2025-07-21 01:50:39,228 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.644816193577934725006947118
2025-07-21 01:50:39,268 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:50:39,269 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:50:39,300 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:39,300 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:50:39,337 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:39,338 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:50:39,382 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:39,382 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:50:39,439 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:39,439 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:50:39,487 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:39,487 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:50:39,540 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:39,540 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:50:39,620 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:39,620 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:50:39,700 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:39,700 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:50:39,939 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:50:39,970 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:50:39,982 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:50:39,982 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:50:39,996 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:50:40,021 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:50:40,273 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-21 01:50:40,661 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:50:40,662 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:50:40,676 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:50:40,685 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:50:40,695 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:50:40,695 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:50:40,697 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:50:40,697 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:50:40,703 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:50:40,703 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:50:40,706 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:50:40,707 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:50:40,709 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:50:40,709 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:50:40,731 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:50:40,731 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:50:40,734 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:50:40,734 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:50:40,759 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:50:40,812 - INFO - app.core.config - .env file loaded successfully.
2025-07-21 01:50:40,824 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-21 01:50:40,825 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-21 01:50:41,168 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.488665267441742944638531690% which is below threshold 100.0%
2025-07-21 01:50:41,168 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '266.475000000000000000000000', 'margin': '5936.62', 'free_margin': '-5670.145000000000000000000000', 'profit_loss': '-6123.145000000000000000000000', 'margin_level': '4.488665267441742944638531690', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6123.145000000000000000000000', 'current_price': '118992.2000000000'}], 'margin_call': True}
2025-07-21 01:50:41,172 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.488665267441742944638531690
2025-07-21 01:50:41,218 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:50:41,218 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:50:41,436 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:50:41,741 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.67983705030301164348684881% which is below threshold 100.0%
2025-07-21 01:50:41,741 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '102070.1400000000000000000000', 'margin': '146484.47', 'free_margin': '-44414.3300000000000000000000', 'profit_loss': '-82275.67000000000000000000000', 'margin_level': '69.67983705030301164348684881', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.0500000000000000000000000', 'current_price': '38.4790000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82144.62000000000000000000000', 'current_price': '119011.4000000000'}], 'margin_call': True}
2025-07-21 01:50:41,745 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.67983705030301164348684881
2025-07-21 01:50:41,749 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:50:41,750 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:50:41,826 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:41,826 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:50:41,828 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:50:41,829 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:50:41,850 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:50:41,854 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:50:41,854 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:50:41,908 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:41,909 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:50:41,910 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:50:41,910 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:50:41,912 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:50:41,913 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:50:42,659 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:50:42,664 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:50:44,016 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:50:44,029 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:50:44,049 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:50:44,049 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:50:44,087 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 8 symbols for user 4
2025-07-21 01:50:44,088 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDCAD', 'AUDCHF', 'AUDJPY', 'AUDNZD', 'XAGUSD', 'US30', 'JP225', 'D30']
2025-07-21 01:50:44,989 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:50:44,994 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:50:45,337 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:50:45,345 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:50:45,345 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:50:45,345 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:50:45,728 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:50:45,731 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:50:46,087 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:50:46,101 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:50:46,102 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:50:46,102 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:50:46,221 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:46,222 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:50:46,271 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:50:51,984 - INFO - app - Starting stale cache cleanup task
2025-07-21 01:50:51,986 - INFO - app - Found 24 static orders cache entries to check
2025-07-21 01:50:51,989 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-21 01:50:51,992 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-21 01:50:51,995 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-21 01:50:51,998 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-21 01:50:52,002 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-21 01:50:52,007 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-21 01:50:52,009 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-21 01:50:52,012 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-21 01:50:52,017 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-21 01:50:52,019 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-21 01:50:52,028 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-21 01:50:52,030 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-21 01:50:52,033 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-21 01:50:52,036 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-21 01:50:52,041 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-21 01:50:52,046 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-21 01:50:52,048 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-21 01:50:52,048 - INFO - app - Completed stale cache cleanup task
2025-07-21 01:51:16,282 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:51:16,282 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:51:16,283 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:51:16,283 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:51:16,302 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:51:16,302 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:51:16,302 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:51:16,472 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:51:16,804 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2240.21216024574080840065495', 'margin': '3249.78', 'free_margin': '-5489.99216024574080840065495', 'profit_loss': '-22055.64216024574080840065495', 'margin_level': '-68.93427125053821515304589695', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22055.64216024574080840065495', 'current_price': '96.275'}], 'margin_call': False}
2025-07-21 01:51:16,806 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -68.93427125053821515304589695
2025-07-21 01:51:16,807 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:51:16,807 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:51:16,813 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:51:16,813 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:51:16,834 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:51:16,837 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:51:16,837 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:51:17,129 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:51:17,132 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:51:17,442 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:51:17,448 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:51:17,452 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:51:17,456 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:51:17,456 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.346025'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.346025'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3458649999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3458649999999999'}], 'margin_call': False}
2025-07-21 01:51:17,458 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:51:17,458 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:51:17,458 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:51:17,506 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:17,507 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:51:17,551 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:17,552 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:51:17,597 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:17,597 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:51:17,726 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:51:18,047 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.509585836266978543480582181% which is below threshold 100.0%
2025-07-21 01:51:18,047 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '428.161274348617397717200831', 'margin': '9494.47', 'free_margin': '-9066.308725651382602282799169', 'profit_loss': '-9473.858725651382602282799169', 'margin_level': '4.509585836266978543480582181', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9414.410000000000000000000000', 'current_price': '118961.4'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.04429604671145662072651741', 'current_price': '96.313'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.404429604671145662072651741', 'current_price': '96.313'}], 'margin_call': True}
2025-07-21 01:51:18,050 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.509585836266978543480582181
2025-07-21 01:51:18,111 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:51:18,111 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:51:18,198 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:18,198 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:51:18,254 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:18,255 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:51:18,329 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:18,329 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:51:18,403 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:18,403 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:51:18,478 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:18,479 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:51:18,546 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:18,547 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:51:18,623 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:18,624 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:51:18,710 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:18,710 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:51:18,988 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:51:19,335 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.436783893865532912667477454% which is below threshold 100.0%
2025-07-21 01:51:19,336 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '263.395000000000000000000000', 'margin': '5936.62', 'free_margin': '-5673.225000000000000000000000', 'profit_loss': '-6126.225000000000000000000000', 'margin_level': '4.436783893865532912667477454', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6126.225000000000000000000000', 'current_price': '118961.4'}], 'margin_call': True}
2025-07-21 01:51:19,352 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.436783893865532912667477454
2025-07-21 01:51:19,426 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:51:19,426 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:51:19,538 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:51:19,541 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-21 01:51:19,874 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-82576.49500000000000000000000', 'margin': '0.0', 'free_margin': '-82576.49500000000000000000000', 'profit_loss': '-82576.49500000000000000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.875000000000000000000000', 'current_price': '38.4625'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82444.62000000000000000000000', 'current_price': '118961.4'}], 'margin_call': False}
2025-07-21 01:51:19,877 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-21 01:51:19,877 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:51:19,877 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:51:19,943 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:19,944 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:51:19,946 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:51:19,947 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:51:19,969 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:51:19,972 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:51:19,972 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:51:20,012 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:20,013 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:51:20,015 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:51:20,015 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:51:20,018 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:51:20,018 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:51:20,222 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:51:20,225 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:51:20,230 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:51:20,591 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:51:20,594 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:51:20,595 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:51:20,595 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:51:20,847 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:51:20,849 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:51:20,855 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:51:21,207 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:51:21,210 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:51:21,211 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:51:21,211 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:51:21,531 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:51:21,534 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:51:21,542 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:51:21,902 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:51:21,912 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:51:21,914 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:51:21,919 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:51:22,001 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:22,002 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:51:22,044 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:34,871 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:51:35,235 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:51:52,057 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:51:52,057 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:51:52,057 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:51:52,057 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:51:52,072 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:51:52,072 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:51:52,072 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:51:52,196 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:51:52,542 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2213.44493572221169720425451', 'margin': '3249.78', 'free_margin': '-5463.22493572221169720425451', 'profit_loss': '-22028.87493572221169720425451', 'margin_level': '-68.11060858649544575953616891', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22028.87493572221169720425451', 'current_price': '96.279'}], 'margin_call': False}
2025-07-21 01:51:52,545 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -68.11060858649544575953616891
2025-07-21 01:51:52,545 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:51:52,545 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:51:52,552 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:51:52,553 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:51:52,569 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:51:52,571 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:51:52,571 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:51:52,658 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:51:52,660 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:51:52,970 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:51:52,974 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:51:52,977 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:51:52,982 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:51:52,983 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.346025'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.346025'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3458649999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3458649999999999'}], 'margin_call': False}
2025-07-21 01:51:52,986 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:51:52,986 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:51:52,987 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:51:53,052 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:53,052 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:51:53,104 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:53,104 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:51:53,148 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:53,148 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:51:53,283 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:51:53,591 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.394913326386745175288766587% which is below threshold 100.0%
2025-07-21 01:51:53,591 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '417.273727299791604644239357', 'margin': '9494.47', 'free_margin': '-9077.196272700208395355760643', 'profit_loss': '-9484.746272700208395355760643', 'margin_level': '4.394913326386745175288766587', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9425.370000000000000000000000', 'current_price': '118934.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-53.97842972746217759614603914', 'current_price': '96.314'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.397842972746217759614603914', 'current_price': '96.314'}], 'margin_call': True}
2025-07-21 01:51:53,593 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.394913326386745175288766587
2025-07-21 01:51:53,653 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:51:53,653 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:51:53,723 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:53,723 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:51:53,787 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:53,787 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:51:53,853 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:53,853 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:51:53,924 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:53,924 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:51:53,982 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:53,983 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:51:54,030 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:54,031 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:51:54,073 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:54,074 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:51:54,171 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:54,171 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:51:54,341 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:51:54,691 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.474852693957167546516367900% which is below threshold 100.0%
2025-07-21 01:51:54,691 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '265.655000000000000000000000', 'margin': '5936.62', 'free_margin': '-5670.965000000000000000000000', 'profit_loss': '-6123.965000000000000000000000', 'margin_level': '4.474852693957167546516367900', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6123.965000000000000000000000', 'current_price': '118984.0000000000'}], 'margin_call': True}
2025-07-21 01:51:54,713 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.474852693957167546516367900
2025-07-21 01:51:54,759 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:51:54,760 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:51:54,940 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:51:54,943 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-21 01:51:55,305 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-82440.84500000000020000000000', 'margin': '0.0', 'free_margin': '-82440.84500000000020000000000', 'profit_loss': '-82440.84500000000020000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.8250000000002000000000000', 'current_price': '38.463499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82309.02000000000000000000000', 'current_price': '118984.0000000000'}], 'margin_call': False}
2025-07-21 01:51:55,306 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-21 01:51:55,306 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:51:55,306 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:51:55,327 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:55,327 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:51:55,329 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:51:55,329 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:51:55,334 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:51:55,335 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:51:55,335 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:51:55,354 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:55,354 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:51:55,355 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:51:55,355 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:51:55,356 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:51:55,356 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:51:55,602 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:51:55,604 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:51:55,612 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:51:55,934 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:51:55,937 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:51:55,937 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:51:55,938 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:51:56,187 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:51:56,188 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:51:56,192 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:51:56,535 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:51:56,537 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:51:56,538 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:51:56,538 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:51:56,721 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:51:56,722 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:51:56,726 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:51:57,045 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:51:57,048 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:51:57,049 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:51:57,049 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:51:57,099 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:51:57,100 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:51:57,150 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:27,160 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:52:27,160 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:52:27,161 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:52:27,161 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:52:27,171 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:52:27,171 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:52:27,171 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:52:27,528 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:52:27,866 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2253.59550084912617812028498', 'margin': '3249.78', 'free_margin': '-5503.37550084912617812028498', 'profit_loss': '-22069.02550084912617812028498', 'margin_level': '-69.34609422327438097718260867', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-22069.02550084912617812028498', 'current_price': '96.273'}], 'margin_call': False}
2025-07-21 01:52:27,868 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -69.34609422327438097718260867
2025-07-21 01:52:27,868 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:52:27,868 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:52:27,874 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:52:27,874 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:52:27,889 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:52:27,893 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:52:27,893 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:52:28,059 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:52:28,062 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:52:28,381 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:52:28,386 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:52:28,389 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:52:28,393 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:52:28,394 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345855'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345855'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3456949999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3456949999999999'}], 'margin_call': False}
2025-07-21 01:52:28,395 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:52:28,396 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:52:28,396 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:52:28,444 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:28,444 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:52:28,486 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:28,487 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:52:28,528 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:28,528 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:52:28,725 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:52:29,101 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.432352282641084064593881870% which is below threshold 100.0%
2025-07-21 01:52:29,101 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '420.828357769672934187646736', 'margin': '9494.47', 'free_margin': '-9073.641642230327065812353264', 'profit_loss': '-9481.191642230327065812353264', 'margin_level': '4.432352282641084064593881870', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9421.370000000000000000000000', 'current_price': '118944.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-54.38331111847915073850296687', 'current_price': '96.30799999999999'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.438331111847915073850296687', 'current_price': '96.30799999999999'}], 'margin_call': True}
2025-07-21 01:52:29,103 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.432352282641084064593881870
2025-07-21 01:52:29,179 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:52:29,179 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:52:29,241 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:29,241 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:52:29,291 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:29,291 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:52:29,337 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:29,337 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:52:29,381 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:29,381 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:52:29,418 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:29,418 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:52:29,470 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:29,471 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:52:29,526 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:29,526 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:52:29,577 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:29,577 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:52:29,776 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:52:30,119 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.407474286715336336164349411% which is below threshold 100.0%
2025-07-21 01:52:30,119 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '261.655000000000000000000000', 'margin': '5936.62', 'free_margin': '-5674.965000000000000000000000', 'profit_loss': '-6127.965000000000000000000000', 'margin_level': '4.407474286715336336164349411', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6127.965000000000000000000000', 'current_price': '118944.0'}], 'margin_call': True}
2025-07-21 01:52:30,122 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.407474286715336336164349411
2025-07-21 01:52:30,169 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:52:30,169 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:52:30,465 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:52:30,468 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-21 01:52:30,843 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-82680.89500000000000000000000', 'margin': '0.0', 'free_margin': '-82680.89500000000000000000000', 'profit_loss': '-82680.89500000000000000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.875000000000000000000000', 'current_price': '38.4625'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82549.02000000000000000000000', 'current_price': '118944.0'}], 'margin_call': False}
2025-07-21 01:52:30,847 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-21 01:52:30,848 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:52:30,848 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:52:30,922 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:30,922 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:52:30,924 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:52:30,924 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:52:30,944 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:52:30,947 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:52:30,947 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:52:30,991 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:30,992 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:52:30,994 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:52:30,995 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:52:30,997 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:52:30,997 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:52:31,328 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:52:31,330 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:52:31,335 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:52:31,656 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:52:31,658 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:52:31,658 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:52:31,658 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:52:31,781 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:52:31,782 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:52:31,786 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:52:32,142 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:52:32,145 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:52:32,145 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:52:32,145 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:52:32,261 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:52:32,262 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:52:32,267 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:52:32,579 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:52:32,583 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:52:32,583 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:52:32,583 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:52:32,646 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:32,646 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:52:32,696 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:52:34,870 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:52:35,178 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:53:02,698 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:53:02,698 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:53:02,699 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:53:02,699 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:53:02,707 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:53:02,708 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:53:02,708 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:53:02,896 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:53:03,298 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2122.53070790712778048384478', 'margin': '3249.78', 'free_margin': '-5372.31070790712778048384478', 'profit_loss': '-21937.96070790712778048384478', 'margin_level': '-65.31305835801585893456925638', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-21937.96070790712778048384478', 'current_price': '96.292'}], 'margin_call': False}
2025-07-21 01:53:03,300 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -65.31305835801585893456925638
2025-07-21 01:53:03,300 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:53:03,300 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:53:03,306 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:53:03,306 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:53:03,320 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:53:03,323 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:53:03,323 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:53:03,471 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:53:03,474 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:53:03,813 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:53:03,818 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:53:03,821 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:53:03,825 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:53:03,825 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345815'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345815'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345655'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345655'}], 'margin_call': False}
2025-07-21 01:53:03,828 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:53:03,828 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:53:03,828 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:53:03,879 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:03,879 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:53:03,936 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:03,937 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:53:03,984 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:03,984 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:53:04,194 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:53:04,537 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.636899492315139292735358888% which is below threshold 100.0%
2025-07-21 01:53:04,537 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '440.249031228013205606970829', 'margin': '9494.47', 'free_margin': '-9054.220968771986794393029171', 'profit_loss': '-9461.770968771986794393029171', 'margin_level': '4.636899492315139292735358888', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9403.370000000000000000000000', 'current_price': '118989.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-53.09178979271526763002651946', 'current_price': '96.327'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.309178979271526763002651946', 'current_price': '96.327'}], 'margin_call': True}
2025-07-21 01:53:04,540 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.636899492315139292735358888
2025-07-21 01:53:04,602 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:53:04,602 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:53:04,652 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:04,652 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:53:04,708 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:04,708 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:53:04,770 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:04,771 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:53:04,838 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:04,839 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:53:04,905 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:04,906 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:53:04,965 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:04,965 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:53:05,018 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:05,018 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:53:05,109 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:05,110 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:53:05,393 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:53:05,754 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.474010463866644656386967668% which is below threshold 100.0%
2025-07-21 01:53:05,755 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '265.605000000000000000000000', 'margin': '5936.62', 'free_margin': '-5671.015000000000000000000000', 'profit_loss': '-6124.015000000000000000000000', 'margin_level': '4.474010463866644656386967668', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6124.015000000000000000000000', 'current_price': '118983.5'}], 'margin_call': True}
2025-07-21 01:53:05,757 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.474010463866644656386967668
2025-07-21 01:53:05,800 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:53:05,800 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:53:06,050 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:53:06,053 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-21 01:53:06,379 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-82443.89500000000000000000000', 'margin': '0.0', 'free_margin': '-82443.89500000000000000000000', 'profit_loss': '-82443.89500000000000000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.875000000000000000000000', 'current_price': '38.4625'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82312.02000000000000000000000', 'current_price': '118983.5'}], 'margin_call': False}
2025-07-21 01:53:06,389 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-21 01:53:06,389 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:53:06,389 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:53:06,479 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:06,479 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:53:06,480 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:53:06,480 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:53:06,530 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:53:06,539 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:53:06,539 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:53:06,596 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:06,596 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:53:06,600 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:53:06,601 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:53:06,603 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:53:06,604 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:53:06,793 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:53:06,793 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:53:06,798 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:53:07,187 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:53:07,189 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:53:07,189 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:53:07,189 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:53:07,332 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:53:07,333 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:53:07,338 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:53:07,700 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:53:07,702 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:53:07,702 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:53:07,702 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:53:07,920 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:53:07,922 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:53:07,927 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:53:08,313 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:53:08,315 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:53:08,315 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:53:08,315 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:53:08,359 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:08,360 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:53:08,401 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:34,874 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:53:35,246 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:53:38,420 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:53:38,420 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:53:38,420 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:53:38,420 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:53:38,431 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:53:38,431 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:53:38,431 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:53:38,649 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:53:38,959 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2067.81989852523339196319848', 'margin': '3249.78', 'free_margin': '-5317.59989852523339196319848', 'profit_loss': '-21883.24989852523339196319848', 'margin_level': '-63.62953487698346940295030679', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-21883.24989852523339196319848', 'current_price': '96.3'}], 'margin_call': False}
2025-07-21 01:53:38,964 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -63.62953487698346940295030679
2025-07-21 01:53:38,964 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:53:38,964 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:53:39,001 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:53:39,001 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:53:39,021 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:53:39,024 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:53:39,024 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:53:39,210 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:53:39,213 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:53:39,546 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:53:39,548 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:53:39,551 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:53:39,553 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:53:39,554 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345795'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345795'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345635'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345635'}], 'margin_call': False}
2025-07-21 01:53:39,555 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:53:39,555 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:53:39,555 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:53:39,589 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:39,589 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:53:39,624 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:39,625 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:53:39,666 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:39,666 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:53:39,863 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:53:40,265 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.832231078481693265891702949% which is below threshold 100.0%
2025-07-21 01:53:40,266 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '458.794730077120822622107969', 'margin': '9494.47', 'free_margin': '-9035.675269922879177377892031', 'profit_loss': '-9443.225269922879177377892031', 'margin_level': '4.832231078481693265891702949', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9385.570000000000000000000000', 'current_price': '119033.5000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.41388174807197943444730077', 'current_price': '96.337'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.241388174807197943444730077', 'current_price': '96.337'}], 'margin_call': True}
2025-07-21 01:53:40,268 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.832231078481693265891702949
2025-07-21 01:53:40,320 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:53:40,320 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:53:40,387 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:40,387 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:53:40,425 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:40,425 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:53:40,458 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:40,458 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:53:40,494 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:40,495 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:53:40,539 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:40,539 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:53:40,591 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:40,591 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:53:40,624 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:40,624 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:53:40,656 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:40,657 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:53:40,788 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:53:41,085 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.558233472918933669326990779% which is below threshold 100.0%
2025-07-21 01:53:41,085 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '270.605000000000000000000000', 'margin': '5936.62', 'free_margin': '-5666.015000000000000000000000', 'profit_loss': '-6119.015000000000000000000000', 'margin_level': '4.558233472918933669326990779', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6119.015000000000000000000000', 'current_price': '119033.5000000000'}], 'margin_call': True}
2025-07-21 01:53:41,088 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.558233472918933669326990779
2025-07-21 01:53:41,150 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:53:41,150 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:53:41,422 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:53:41,424 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-21 01:53:41,799 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-82143.64500000000030000000000', 'margin': '0.0', 'free_margin': '-82143.64500000000030000000000', 'profit_loss': '-82143.64500000000030000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.6250000000003000000000000', 'current_price': '38.467499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82012.02000000000000000000000', 'current_price': '119033.5000000000'}], 'margin_call': False}
2025-07-21 01:53:41,802 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-21 01:53:41,802 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:53:41,803 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:53:41,874 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:41,874 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:53:41,877 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:53:41,877 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:53:41,891 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:53:41,895 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:53:41,895 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:53:41,932 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:41,932 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:53:41,934 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:53:41,934 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:53:41,935 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:53:41,935 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:53:42,068 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:53:42,069 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:53:42,074 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:53:42,412 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:53:42,419 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:53:42,419 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:53:42,419 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:53:42,681 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:53:42,683 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:53:42,690 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:53:43,027 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:53:43,031 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:53:43,031 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:53:43,031 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:53:43,284 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:53:43,285 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:53:43,290 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:53:43,593 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:53:43,596 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:53:43,596 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:53:43,597 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:53:43,701 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:53:43,701 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:53:43,750 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:13,762 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:54:13,762 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:54:13,762 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:54:13,762 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:54:13,768 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:54:13,768 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:54:13,768 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:54:13,927 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:54:14,262 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '-2112.51680663970021239464820', 'margin': '3249.78', 'free_margin': '-5362.29680663970021239464820', 'profit_loss': '-21927.94680663970021239464820', 'margin_level': '-65.00491746024962343280616534', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-21927.94680663970021239464820', 'current_price': '96.293'}], 'margin_call': False}
2025-07-21 01:54:14,281 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: -65.00491746024962343280616534
2025-07-21 01:54:14,282 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:54:14,282 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:54:14,288 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:54:14,288 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:54:14,313 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:54:14,317 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:54:14,317 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:54:14,457 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:54:14,459 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:54:14,776 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:54:14,779 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:54:14,781 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:54:14,783 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:54:14,784 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345695'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345695'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345535'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345535'}], 'margin_call': False}
2025-07-21 01:54:14,786 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:54:14,786 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:54:14,786 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:54:14,832 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:14,832 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:54:14,874 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:14,874 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:54:14,908 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:14,908 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:54:15,002 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:54:15,388 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.437155164727482209056125629% which is below threshold 100.0%
2025-07-21 01:54:15,388 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '421.284365968501380094171131', 'margin': '9494.47', 'free_margin': '-9073.185634031498619905828869', 'profit_loss': '-9480.735634031498619905828869', 'margin_level': '4.437155164727482209056125629', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9422.930000000000000000000000', 'current_price': '118940.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.55057639227147264166260757', 'current_price': '96.335'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.255057639227147264166260757', 'current_price': '96.335'}], 'margin_call': True}
2025-07-21 01:54:15,391 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.437155164727482209056125629
2025-07-21 01:54:15,426 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:54:15,426 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:54:15,483 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:15,483 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:54:15,513 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:15,513 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:54:15,538 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:15,538 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:54:15,570 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:15,570 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:54:15,607 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:15,608 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:54:15,640 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:15,640 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:54:15,668 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:15,668 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:54:15,696 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:15,696 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:54:15,828 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:54:16,115 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.400904892009257793155027608% which is below threshold 100.0%
2025-07-21 01:54:16,116 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '261.265000000000000000000000', 'margin': '5936.62', 'free_margin': '-5675.355000000000000000000000', 'profit_loss': '-6128.355000000000000000000000', 'margin_level': '4.400904892009257793155027608', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6128.355000000000000000000000', 'current_price': '118940.1'}], 'margin_call': True}
2025-07-21 01:54:16,117 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.400904892009257793155027608
2025-07-21 01:54:16,152 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:54:16,153 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:54:16,289 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:54:16,291 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-21 01:54:16,621 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-82704.04500000000030000000000', 'margin': '0.0', 'free_margin': '-82704.04500000000030000000000', 'profit_loss': '-82704.04500000000030000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.6250000000003000000000000', 'current_price': '38.467499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82572.42000000000000000000000', 'current_price': '118940.1'}], 'margin_call': False}
2025-07-21 01:54:16,637 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-21 01:54:16,637 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:54:16,637 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:54:16,703 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:16,704 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:54:16,705 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:54:16,705 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:54:16,717 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:54:16,719 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:54:16,719 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:54:16,748 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:16,748 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:54:16,749 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:54:16,749 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:54:16,750 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:54:16,750 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:54:16,867 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:54:16,868 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:54:16,872 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:54:17,227 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:54:17,229 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:54:17,230 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:54:17,230 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:54:17,360 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:54:17,361 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:54:17,365 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:54:17,740 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:54:17,743 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:54:17,743 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:54:17,743 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:54:17,873 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:54:17,874 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:54:17,876 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:54:18,178 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:54:18,191 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:54:18,191 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:54:18,191 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:54:18,247 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:18,247 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:54:18,283 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:34,875 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:54:35,250 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:54:48,288 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:54:48,288 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:54:48,289 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:54:48,289 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:54:48,296 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:54:48,296 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:54:48,296 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:54:48,372 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:54:48,679 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '19715.43000000000000', 'margin': '3249.78', 'free_margin': '16465.65000000000000', 'profit_loss': '-100.00000000000000', 'margin_level': '606.6696822554142126543950667', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.30000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-100.00000000000000', 'current_price': '96.3'}], 'margin_call': False}
2025-07-21 01:54:48,681 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 606.6696822554142126543950667
2025-07-21 01:54:48,682 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:54:48,682 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:54:48,687 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:54:48,687 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:54:48,697 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:54:48,698 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:54:48,698 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:54:48,780 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:54:48,781 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:54:49,179 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:54:49,182 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:54:49,186 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:54:49,189 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:54:49,190 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345755'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345755'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3455949999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3455949999999999'}], 'margin_call': False}
2025-07-21 01:54:49,201 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:54:49,201 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:54:49,201 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:54:49,241 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:49,242 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:54:49,356 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:49,356 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:54:49,415 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:49,415 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:54:49,485 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:54:49,897 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.620055002369315690027781656% which is below threshold 100.0%
2025-07-21 01:54:49,897 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '438.649736183453967394980721', 'margin': '9494.47', 'free_margin': '-9055.820263816546032605019279', 'profit_loss': '-9463.370263816546032605019279', 'margin_level': '4.620055002369315690027781656', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9405.570000000000000000000000', 'current_price': '118983.5'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.54569437867821145910843536', 'current_price': '96.335'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.254569437867821145910843536', 'current_price': '96.335'}], 'margin_call': True}
2025-07-21 01:54:49,900 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.620055002369315690027781656
2025-07-21 01:54:49,935 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:54:49,935 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:54:49,968 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:49,968 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:54:50,000 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:50,000 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:54:50,026 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:50,026 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:54:50,058 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:50,059 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:54:50,096 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:50,096 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:54:50,133 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:50,133 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:54:50,180 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:50,181 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:54:50,224 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:50,225 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:54:50,342 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:54:50,712 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.370247716714224592444859196% which is below threshold 100.0%
2025-07-21 01:54:50,712 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '259.445000000000000000000000', 'margin': '5936.62', 'free_margin': '-5677.175000000000000000000000', 'profit_loss': '-6130.175000000000000000000000', 'margin_level': '4.370247716714224592444859196', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6130.175000000000000000000000', 'current_price': '118921.9'}], 'margin_call': True}
2025-07-21 01:54:50,714 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.370247716714224592444859196
2025-07-21 01:54:50,735 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:54:50,735 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:54:50,886 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:54:50,888 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-21 01:54:51,223 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-82813.09500000000030000000000', 'margin': '0.0', 'free_margin': '-82813.09500000000030000000000', 'profit_loss': '-82813.09500000000030000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.4750000000003000000000000', 'current_price': '38.470499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82681.62000000000000000000000', 'current_price': '118921.9'}], 'margin_call': False}
2025-07-21 01:54:51,250 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-21 01:54:51,251 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:54:51,251 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:54:51,306 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:51,306 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:54:51,307 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:54:51,307 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:54:51,326 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:54:51,329 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:54:51,329 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:54:51,370 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:51,370 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:54:51,372 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:54:51,372 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:54:51,373 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:54:51,373 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:54:51,449 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:54:51,450 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:54:51,452 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:54:51,838 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:54:51,843 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:54:51,843 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:54:51,843 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:54:51,998 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:54:51,999 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:54:52,002 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:54:52,362 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:54:52,365 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:54:52,365 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:54:52,365 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:54:52,526 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:54:52,527 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:54:52,531 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:54:52,863 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:54:52,881 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:54:52,881 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:54:52,881 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:54:52,917 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:54:52,917 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:54:52,950 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:22,955 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:55:22,955 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:55:22,955 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:55:22,955 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:55:22,995 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:55:22,995 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:55:22,995 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:55:23,158 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:55:23,491 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '19749.25332050302042252091972', 'margin': '3249.78', 'free_margin': '16499.47332050302042252091972', 'profit_loss': '-66.17667949697957747908027627', 'margin_level': '607.7104702626953339155548905', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.30000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-66.17667949697957747908027627', 'current_price': '96.305'}], 'margin_call': False}
2025-07-21 01:55:23,495 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 607.7104702626953339155548905
2025-07-21 01:55:23,499 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:55:23,500 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:55:23,510 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:55:23,511 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:55:23,525 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:55:23,529 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:55:23,530 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:55:23,636 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:55:23,638 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:55:23,974 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:55:23,977 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:55:23,979 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:55:23,982 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:55:23,983 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345855'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345855'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3456949999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3456949999999999'}], 'margin_call': False}
2025-07-21 01:55:24,004 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:55:24,004 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:55:24,004 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:55:24,038 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,038 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:55:24,065 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,066 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:55:24,102 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,102 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:55:24,271 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:55:24,612 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.623961548504232340864316723% which is below threshold 100.0%
2025-07-21 01:55:24,612 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '439.020642034269788333660292', 'margin': '9494.47', 'free_margin': '-9055.449357965730211666339708', 'profit_loss': '-9462.999357965730211666339708', 'margin_level': '4.623961548504232340864316723', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9405.570000000000000000000000', 'current_price': '118983.5'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.20850724157291969667246173', 'current_price': '96.34'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.220850724157291969667246173', 'current_price': '96.34'}], 'margin_call': True}
2025-07-21 01:55:24,614 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.623961548504232340864316723
2025-07-21 01:55:24,645 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:55:24,645 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:55:24,684 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,684 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:55:24,715 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,715 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:55:24,745 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,746 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:55:24,781 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,782 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:55:24,817 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,817 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:55:24,855 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,856 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:55:24,899 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,899 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:55:24,949 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:24,950 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:55:25,062 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:55:25,426 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.390124346850564799498704650% which is below threshold 100.0%
2025-07-21 01:55:25,427 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '260.625000000000000000000000', 'margin': '5936.62', 'free_margin': '-5675.995000000000000000000000', 'profit_loss': '-6128.995000000000000000000000', 'margin_level': '4.390124346850564799498704650', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6128.995000000000000000000000', 'current_price': '118933.7'}], 'margin_call': True}
2025-07-21 01:55:25,430 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.390124346850564799498704650
2025-07-21 01:55:25,473 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:55:25,473 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:55:25,701 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:55:25,704 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-21 01:55:26,034 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-82742.29500000000030000000000', 'margin': '0.0', 'free_margin': '-82742.29500000000030000000000', 'profit_loss': '-82742.29500000000030000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.4750000000003000000000000', 'current_price': '38.470499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82610.82000000000000000000000', 'current_price': '118933.7'}], 'margin_call': False}
2025-07-21 01:55:26,058 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-21 01:55:26,059 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:55:26,059 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:55:26,114 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:26,114 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:55:26,116 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:55:26,116 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:55:26,133 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:55:26,134 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:55:26,134 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:55:26,179 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:26,179 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:55:26,181 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:55:26,181 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:55:26,183 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:55:26,183 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:55:26,305 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:55:26,306 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:55:26,308 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:55:26,654 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:55:26,658 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-21 01:55:26,658 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:55:26,658 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:55:26,763 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:55:26,764 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:55:26,766 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:55:27,066 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:55:27,069 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:55:27,069 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:55:27,069 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:55:27,151 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:55:27,151 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:55:27,153 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:55:27,475 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:55:27,478 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:55:27,478 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:55:27,478 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:55:27,509 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:27,509 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:55:27,527 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:34,872 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:55:35,255 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:55:37,161 - INFO - app - Starting cache validation task
2025-07-21 01:55:37,170 - INFO - app - Validating cache for 29 users
2025-07-21 01:55:37,177 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,185 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,202 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,214 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,226 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,237 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,251 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,263 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,275 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,287 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,301 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,315 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,329 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,342 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,355 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,367 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,377 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,386 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,401 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,417 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,440 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-21 01:55:37,450 - INFO - app - Cache validation completed
2025-07-21 01:55:57,542 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:55:57,542 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:55:57,542 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:55:57,542 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:55:57,547 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:55:57,547 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:55:57,547 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:55:57,613 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:55:57,993 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21115.60180852143209843140173', 'margin': '3249.78', 'free_margin': '17865.82180852143209843140173', 'profit_loss': '1300.171808521432098431401728', 'margin_level': '649.7548082799891715264233804', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1300.171808521432098431401728', 'current_price': '96.307'}], 'margin_call': False}
2025-07-21 01:55:58,027 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 649.7548082799891715264233804
2025-07-21 01:55:58,029 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:55:58,030 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:55:58,038 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:55:58,038 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:55:58,053 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:55:58,058 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:55:58,059 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:55:58,270 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:55:58,609 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:55:58,613 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:55:58,616 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:55:58,620 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:55:58,620 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345845'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345845'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345685'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345685'}], 'margin_call': False}
2025-07-21 01:55:58,655 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:55:58,659 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:55:58,659 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:55:58,725 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:58,725 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:55:58,768 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:58,768 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:55:58,799 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:58,799 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:55:59,016 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:55:59,427 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.626423641992704826122594573% which is below threshold 100.0%
2025-07-21 01:55:59,427 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '439.254404761904761904761905', 'margin': '9494.47', 'free_margin': '-9055.215595238095238095238095', 'profit_loss': '-9462.765595238095238095238095', 'margin_level': '4.626423641992704826122594573', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9405.490000000000000000000000', 'current_price': '118983.7000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.06872294372294372294372294', 'current_price': '96.342'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.206872294372294372294372294', 'current_price': '96.342'}], 'margin_call': True}
2025-07-21 01:55:59,430 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.626423641992704826122594573
2025-07-21 01:55:59,501 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:55:59,501 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:55:59,564 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:59,564 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:55:59,619 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:59,620 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:55:59,668 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:59,668 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:55:59,704 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:59,704 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:55:59,737 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:59,737 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:55:59,776 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:59,776 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:55:59,811 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:59,811 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:55:59,839 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:55:59,840 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:55:59,907 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:56:00,242 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.474347355902853812438727761% which is below threshold 100.0%
2025-07-21 01:56:00,242 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '265.625000000000000000000000', 'margin': '5936.62', 'free_margin': '-5670.995000000000000000000000', 'profit_loss': '-6123.995000000000000000000000', 'margin_level': '4.474347355902853812438727761', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6123.995000000000000000000000', 'current_price': '118983.7000000000'}], 'margin_call': True}
2025-07-21 01:56:00,244 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.474347355902853812438727761
2025-07-21 01:56:00,272 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:56:00,272 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:56:00,527 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:56:00,856 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.56588299087268411456859557% which is below threshold 100.0%
2025-07-21 01:56:00,857 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101903.2149999999997000000000', 'margin': '146484.47', 'free_margin': '-44581.2550000000003000000000', 'profit_loss': '-82442.59500000000030000000000', 'margin_level': '69.56588299087268411456859557', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.7750000000003000000000000', 'current_price': '38.464499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82310.82000000000000000000000', 'current_price': '118983.7000000000'}], 'margin_call': True}
2025-07-21 01:56:00,860 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.56588299087268411456859557
2025-07-21 01:56:00,862 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:56:00,862 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:56:00,916 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:00,916 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:56:00,918 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:56:00,919 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:56:00,938 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:56:00,941 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:56:00,941 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:56:00,985 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:00,985 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:56:00,986 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:56:00,986 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:56:00,987 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:56:00,987 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:56:01,191 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:56:01,192 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:56:01,573 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:56:01,577 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:56:01,580 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:56:01,580 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:56:01,802 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:56:01,803 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:56:02,101 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:56:02,105 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:56:02,105 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:56:02,105 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:56:02,222 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:56:02,223 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:56:02,596 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:56:02,631 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:56:02,632 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:56:02,632 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:56:02,676 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:02,677 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:56:02,703 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:32,706 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:56:32,706 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:56:32,709 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:56:32,709 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:56:32,719 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:56:32,719 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:56:32,719 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:56:32,862 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:56:33,216 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21108.84711873807816664186474', 'margin': '3249.78', 'free_margin': '17859.06711873807816664186474', 'profit_loss': '1293.417118738078166641864744', 'margin_level': '649.5469576013784984411826259', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1293.417118738078166641864744', 'current_price': '96.306'}], 'margin_call': False}
2025-07-21 01:56:33,220 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 649.5469576013784984411826259
2025-07-21 01:56:33,222 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:56:33,222 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:56:33,229 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:56:33,229 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:56:33,250 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:56:33,253 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:56:33,253 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:56:33,496 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:56:33,830 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:56:33,834 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:56:33,838 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:56:33,843 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:56:33,843 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345815'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345815'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345675'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345675'}], 'margin_call': False}
2025-07-21 01:56:33,846 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:56:33,848 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:56:33,849 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:56:33,920 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:33,920 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:56:33,983 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:33,984 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:56:34,047 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:34,047 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:56:34,293 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:56:34,647 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.365691176357535602467165982% which is below threshold 100.0%
2025-07-21 01:56:34,649 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '414.499239031913310515564334', 'margin': '9494.47', 'free_margin': '-9079.970760968086689484435666', 'profit_loss': '-9487.520760968086689484435666', 'margin_level': '4.365691176357535602467165982', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9430.170000000000000000000000', 'current_price': '118922.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.13705542553335407675969642', 'current_price': '96.341'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.213705542553335407675969642', 'current_price': '96.341'}], 'margin_call': True}
2025-07-21 01:56:34,659 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.365691176357535602467165982
2025-07-21 01:56:34,788 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:56:34,788 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:56:34,831 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:34,831 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:56:34,870 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:56:35,261 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:56:35,268 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:35,268 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:56:35,352 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:35,352 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:56:35,417 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:35,417 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:56:35,461 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:35,461 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:56:35,499 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:35,499 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:56:35,543 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:35,543 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:56:35,586 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:35,586 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:56:35,724 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:56:36,079 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.366541904315923875875498179% which is below threshold 100.0%
2025-07-21 01:56:36,080 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '259.225000000000000000000000', 'margin': '5936.62', 'free_margin': '-5677.395000000000000000000000', 'profit_loss': '-6130.395000000000000000000000', 'margin_level': '4.366541904315923875875498179', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6130.395000000000000000000000', 'current_price': '118919.7'}], 'margin_call': True}
2025-07-21 01:56:36,082 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.366541904315923875875498179
2025-07-21 01:56:36,151 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:56:36,152 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:56:36,311 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:56:36,695 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.30384156081528622112637606% which is below threshold 100.0%
2025-07-21 01:56:36,695 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101519.3649999999997000000000', 'margin': '146484.47', 'free_margin': '-44965.1050000000003000000000', 'profit_loss': '-82826.44500000000030000000000', 'margin_level': '69.30384156081528622112637606', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.6250000000003000000000000', 'current_price': '38.467499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82694.82000000000000000000000', 'current_price': '118919.7'}], 'margin_call': True}
2025-07-21 01:56:36,697 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.30384156081528622112637606
2025-07-21 01:56:36,701 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:56:36,701 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:56:36,777 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:36,777 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:56:36,779 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:56:36,779 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:56:36,804 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:56:36,809 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:56:36,809 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:56:36,865 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:36,866 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:56:36,868 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:56:36,868 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:56:36,870 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:56:36,871 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:56:37,073 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:56:37,074 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:56:37,410 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:56:37,414 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:56:37,419 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:56:37,419 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:56:37,530 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:56:37,531 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:56:37,923 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:56:37,926 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:56:37,927 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:56:37,927 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:56:38,124 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:56:38,126 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:56:38,502 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:56:38,505 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:56:38,505 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:56:38,506 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:56:38,548 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:56:38,549 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:56:38,596 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:08,613 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:57:08,613 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:57:08,613 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:57:08,614 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:57:08,629 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:57:08,630 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:57:08,631 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:57:08,895 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:57:09,257 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21122.33737408855399683445841', 'margin': '3249.78', 'free_margin': '17872.55737408855399683445841', 'profit_loss': '1306.907374088553996834458408', 'margin_level': '649.9620704813419368952500911', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1306.907374088553996834458408', 'current_price': '96.308'}], 'margin_call': False}
2025-07-21 01:57:09,288 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 649.9620704813419368952500911
2025-07-21 01:57:09,290 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:57:09,290 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:57:09,298 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:57:09,299 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:57:09,322 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:57:09,326 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:57:09,326 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:57:09,651 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:57:09,978 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:57:09,981 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:57:09,986 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:57:09,991 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:57:09,991 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345815'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345815'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345655'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345655'}], 'margin_call': False}
2025-07-21 01:57:09,994 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:57:09,996 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:57:09,997 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:57:10,043 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,043 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:57:10,082 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,082 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:57:10,119 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,119 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:57:10,236 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:57:10,567 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.336945062944256299120076792% which is below threshold 100.0%
2025-07-21 01:57:10,568 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '411.769947917723531043065955', 'margin': '9494.47', 'free_margin': '-9082.700052082276468956934045', 'profit_loss': '-9490.250052082276468956934045', 'margin_level': '4.336945062944256299120076792', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9433.050000000000000000000000', 'current_price': '118914.8'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.00004734752406268812185900', 'current_price': '96.343'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.200004734752406268812185900', 'current_price': '96.343'}], 'margin_call': True}
2025-07-21 01:57:10,570 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.336945062944256299120076792
2025-07-21 01:57:10,605 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:57:10,605 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:57:10,638 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,639 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:57:10,701 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,701 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:57:10,764 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,764 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:57:10,830 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,830 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:57:10,888 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,888 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:57:10,959 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:10,960 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:57:11,028 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:11,028 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:57:11,094 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:11,094 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:57:11,382 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:57:11,714 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.358288049428799552607375914% which is below threshold 100.0%
2025-07-21 01:57:11,715 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '258.735000000000000000000000', 'margin': '5936.62', 'free_margin': '-5677.885000000000000000000000', 'profit_loss': '-6130.885000000000000000000000', 'margin_level': '4.358288049428799552607375914', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6130.885000000000000000000000', 'current_price': '118914.8'}], 'margin_call': True}
2025-07-21 01:57:11,719 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.358288049428799552607375914
2025-07-21 01:57:11,781 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:57:11,782 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:57:11,984 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:57:12,330 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.28419784022156068831050827% which is below threshold 100.0%
2025-07-21 01:57:12,330 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101490.5900000000000000000000', 'margin': '146484.47', 'free_margin': '-44993.8800000000000000000000', 'profit_loss': '-82855.22000000000000000000000', 'margin_level': '69.28419784022156068831050827', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.0000000000000000000000000', 'current_price': '38.4800000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82724.22000000000000000000000', 'current_price': '118914.8'}], 'margin_call': True}
2025-07-21 01:57:12,333 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.28419784022156068831050827
2025-07-21 01:57:12,336 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:57:12,336 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:57:12,381 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:12,381 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:57:12,382 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:57:12,382 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:57:12,391 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:57:12,393 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:57:12,394 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:57:12,422 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:12,422 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:57:12,422 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:57:12,423 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:57:12,424 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:57:12,424 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:57:12,523 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:57:12,524 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:57:12,847 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:57:12,850 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:57:12,853 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:57:12,853 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:57:13,149 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:57:13,151 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:57:13,459 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:57:13,462 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:57:13,463 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:57:13,463 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:57:13,678 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:57:13,679 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:57:13,977 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:57:13,980 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:57:13,981 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:57:13,981 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:57:14,026 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:14,027 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:57:14,091 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:34,870 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:57:35,268 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:57:44,129 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:57:44,129 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:57:44,130 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:57:44,130 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:57:44,137 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:57:44,137 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:57:44,137 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:57:44,316 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:57:44,656 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21088.52677288438254611373029', 'margin': '3249.78', 'free_margin': '17838.74677288438254611373029', 'profit_loss': '1273.096772884382546113730291', 'margin_level': '648.9216738635963833279092828', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1273.096772884382546113730291', 'current_price': '96.303'}], 'margin_call': False}
2025-07-21 01:57:44,661 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 648.9216738635963833279092828
2025-07-21 01:57:44,665 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:57:44,666 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:57:44,682 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:57:44,682 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:57:44,694 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:57:44,696 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:57:44,697 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:57:44,777 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:57:45,073 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:57:45,076 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:57:45,079 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:57:45,081 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:57:45,081 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345795'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345795'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345635'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345635'}], 'margin_call': False}
2025-07-21 01:57:45,083 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:57:45,083 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:57:45,084 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:57:45,101 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,101 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:57:45,116 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,116 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:57:45,142 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,142 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:57:45,213 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:57:45,525 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.554141220721789944113940652% which is below threshold 100.0%
2025-07-21 01:57:45,525 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '432.391571959064129706914861', 'margin': '9494.47', 'free_margin': '-9062.078428040935870293085139', 'profit_loss': '-9469.628428040935870293085139', 'margin_level': '4.554141220721789944113940652', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9412.130000000000000000000000', 'current_price': '118967.1000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.27129821903260935735012615', 'current_price': '96.339'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.227129821903260935735012615', 'current_price': '96.339'}], 'margin_call': True}
2025-07-21 01:57:45,528 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.554141220721789944113940652
2025-07-21 01:57:45,562 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:57:45,562 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:57:45,598 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,598 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:57:45,626 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,626 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:57:45,650 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,650 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:57:45,674 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,674 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:57:45,704 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,704 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:57:45,730 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,731 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:57:45,752 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,752 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:57:45,775 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:45,775 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:57:45,840 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:57:46,227 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.446385316897493860142640088% which is below threshold 100.0%
2025-07-21 01:57:46,227 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '263.965000000000000000000000', 'margin': '5936.62', 'free_margin': '-5672.655000000000000000000000', 'profit_loss': '-6125.655000000000000000000000', 'margin_level': '4.446385316897493860142640088', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6125.655000000000000000000000', 'current_price': '118967.1000000000'}], 'margin_call': True}
2025-07-21 01:57:46,230 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.446385316897493860142640088
2025-07-21 01:57:46,263 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:57:46,263 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:57:46,333 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:57:46,737 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.29361863411186182398721175% which is below threshold 100.0%
2025-07-21 01:57:46,749 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101504.3900000000000000000000', 'margin': '146484.47', 'free_margin': '-44980.0800000000000000000000', 'profit_loss': '-82841.42000000000000000000000', 'margin_level': '69.29361863411186182398721175', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.0000000000000000000000000', 'current_price': '38.4800000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82710.42000000000000000000000', 'current_price': '118917.1'}], 'margin_call': True}
2025-07-21 01:57:46,753 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.29361863411186182398721175
2025-07-21 01:57:46,762 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:57:46,762 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:57:46,799 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:46,799 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:57:46,800 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:57:46,800 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:57:46,807 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:57:46,808 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:57:46,808 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:57:46,825 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:46,825 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:57:46,826 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:57:46,826 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:57:46,827 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:57:46,827 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:57:46,897 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:57:46,897 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:57:47,250 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:57:47,253 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:57:47,255 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:57:47,256 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:57:47,336 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:57:47,336 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:57:47,671 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:57:47,675 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:57:47,675 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:57:47,675 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:57:47,788 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:57:47,789 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:57:48,170 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:57:48,251 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:57:48,251 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:57:48,251 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:57:48,298 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:57:48,299 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:57:48,342 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:18,359 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:58:18,359 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:58:18,359 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:58:18,360 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:58:18,368 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:58:18,368 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:58:18,368 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:58:18,451 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:58:18,788 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21101.49229842935477109688237', 'margin': '3249.78', 'free_margin': '17851.71229842935477109688237', 'profit_loss': '1286.062298429354771096882374', 'margin_level': '649.3206401180804476332823259', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1286.062298429354771096882374', 'current_price': '96.305'}], 'margin_call': False}
2025-07-21 01:58:18,791 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 649.3206401180804476332823259
2025-07-21 01:58:18,793 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:58:18,793 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:58:18,797 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:58:18,798 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:58:18,816 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:58:18,819 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:58:18,819 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:58:18,996 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:58:19,308 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:58:19,319 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:58:19,330 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:58:19,334 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:58:19,334 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345325'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345325'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345165'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345165'}], 'margin_call': False}
2025-07-21 01:58:19,358 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:58:19,360 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:58:19,361 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:58:19,389 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,389 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:58:19,406 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,406 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:58:19,421 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,421 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:58:19,485 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:58:19,813 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.209279986831809069298606631% which is below threshold 100.0%
2025-07-21 01:58:19,814 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '399.648825565750062541835417', 'margin': '9494.47', 'free_margin': '-9094.821174434249937458164583', 'profit_loss': '-9502.371174434249937458164583', 'margin_level': '4.209279986831809069298606631', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9444.970000000000000000000000', 'current_price': '118885.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.18288584931812496196780279', 'current_price': '96.34'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.218288584931812496196780279', 'current_price': '96.34'}], 'margin_call': True}
2025-07-21 01:58:19,816 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.209279986831809069298606631
2025-07-21 01:58:19,852 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:58:19,852 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:58:19,879 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,879 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:58:19,896 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,896 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:58:19,915 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,915 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:58:19,934 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,934 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:58:19,950 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,951 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:58:19,969 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,969 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:58:19,991 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:19,991 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:58:20,009 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:20,009 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:58:20,063 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:58:20,426 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.308091136033635300895122140% which is below threshold 100.0%
2025-07-21 01:58:20,426 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '255.755000000000000000000000', 'margin': '5936.62', 'free_margin': '-5680.865000000000000000000000', 'profit_loss': '-6133.865000000000000000000000', 'margin_level': '4.308091136033635300895122140', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6133.865000000000000000000000', 'current_price': '118885.0'}], 'margin_call': True}
2025-07-21 01:58:20,429 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.308091136033635300895122140
2025-07-21 01:58:20,461 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:58:20,461 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:58:20,523 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:58:20,833 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.16119845332409640421267865% which is below threshold 100.0%
2025-07-21 01:58:20,833 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101310.4150000000000000000000', 'margin': '146484.47', 'free_margin': '-45174.0550000000000000000000', 'profit_loss': '-83035.39500000000000000000000', 'margin_level': '69.16119845332409640421267865', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-132.375000000000000000000000', 'current_price': '38.4525'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82903.02000000000000000000000', 'current_price': '118885.0'}], 'margin_call': True}
2025-07-21 01:58:20,848 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.16119845332409640421267865
2025-07-21 01:58:20,851 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:58:20,852 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:58:20,885 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:20,886 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:58:20,886 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:58:20,887 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:58:20,895 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:58:20,897 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:58:20,897 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:58:20,914 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:20,914 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:58:20,915 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:58:20,915 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:58:20,916 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:58:20,916 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:58:20,973 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:58:20,974 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:58:21,334 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:58:21,337 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:58:21,340 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:58:21,340 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:58:21,426 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:58:21,426 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:58:21,858 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:58:21,873 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:58:21,874 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:58:21,874 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:58:21,974 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:58:21,975 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:58:22,371 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:58:22,374 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:58:22,374 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:58:22,374 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:58:22,409 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:22,409 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:58:22,439 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:34,875 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:58:35,282 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 01:58:52,450 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:58:52,450 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:58:52,450 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:58:52,450 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:58:52,456 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:58:52,456 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:58:52,456 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:58:52,572 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:58:52,886 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21087.90478162100765340617140', 'margin': '3249.78', 'free_margin': '17838.12478162100765340617140', 'profit_loss': '1272.474781621007653406171404', 'margin_level': '648.9025343752810237433355919', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1272.474781621007653406171404', 'current_price': '96.303'}], 'margin_call': False}
2025-07-21 01:58:52,895 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 648.9025343752810237433355919
2025-07-21 01:58:52,897 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:58:52,897 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:58:52,904 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:58:52,904 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:58:52,927 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:58:52,930 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:58:52,930 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:58:53,035 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:58:53,400 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:58:53,404 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:58:53,410 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:58:53,416 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:58:53,416 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345205'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345205'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345045'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345045'}], 'margin_call': False}
2025-07-21 01:58:53,419 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:58:53,423 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:58:53,424 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:58:53,476 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:53,476 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:58:53,513 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:53,513 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:58:53,542 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:53,542 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:58:53,669 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:58:53,978 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.157606996558406643445710766% which is below threshold 100.0%
2025-07-21 01:58:53,978 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '394.742749006138951239959975', 'margin': '9494.47', 'free_margin': '-9099.727250993861048760040025', 'profit_loss': '-9507.277250993861048760040025', 'margin_level': '4.157606996558406643445710766', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9449.730000000000000000000000', 'current_price': '118873.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-52.31568272169186250912729535', 'current_price': '96.338'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.231568272169186250912729535', 'current_price': '96.338'}], 'margin_call': True}
2025-07-21 01:58:53,999 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.157606996558406643445710766
2025-07-21 01:58:54,049 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:58:54,050 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:58:54,074 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:54,074 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:58:54,113 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:54,113 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:58:54,145 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:54,145 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:58:54,173 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:54,173 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:58:54,195 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:54,195 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:58:54,222 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:54,222 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:58:54,256 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:54,256 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:58:54,290 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:54,290 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:58:54,383 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:58:54,690 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.372269068931479528755419751% which is below threshold 100.0%
2025-07-21 01:58:54,690 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '259.565000000000000000000000', 'margin': '5936.62', 'free_margin': '-5677.055000000000000000000000', 'profit_loss': '-6130.055000000000000000000000', 'margin_level': '4.372269068931479528755419751', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6130.055000000000000000000000', 'current_price': '118923.1000000000'}], 'margin_call': True}
2025-07-21 01:58:54,703 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.372269068931479528755419751
2025-07-21 01:58:54,727 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:58:54,727 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:58:54,894 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:58:55,243 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.31718768549321303480157316% which is below threshold 100.0%
2025-07-21 01:58:55,243 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101538.9150000000000000000000', 'margin': '146484.47', 'free_margin': '-44945.5550000000000000000000', 'profit_loss': '-82806.89500000000000000000000', 'margin_level': '69.31718768549321303480157316', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-132.475000000000000000000000', 'current_price': '38.4505'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82674.42000000000000000000000', 'current_price': '118923.1000000000'}], 'margin_call': True}
2025-07-21 01:58:55,247 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.31718768549321303480157316
2025-07-21 01:58:55,249 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:58:55,249 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:58:55,290 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:55,290 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:58:55,292 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:58:55,292 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:58:55,310 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:58:55,312 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:58:55,312 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:58:55,347 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:55,347 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:58:55,348 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:58:55,348 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:58:55,350 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:58:55,350 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:58:55,428 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:58:55,429 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:58:55,836 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:58:55,839 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:58:55,840 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:58:55,840 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:58:55,967 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:58:55,968 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:58:56,263 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:58:56,265 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:58:56,265 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:58:56,265 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:58:56,400 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:58:56,401 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:58:56,775 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:58:56,779 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:58:56,780 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:58:56,780 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:58:56,814 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:58:56,814 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:58:56,830 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:11,511 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1192-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '118973.2', 'status': 'OPEN', 'contract_value': '0.01', 'account_type': 'live', 'timestamp': '2025-07-21T08:59:11.511635'}
2025-07-21 01:59:11,839 - INFO - app.core.firebase - Order data (ID: 1192-001) sent to Firebase successfully.
2025-07-21 01:59:13,160 - INFO - app.core.firebase - Order data (ID: 1192-001) deleted from Firebase after 1 seconds.
2025-07-21 01:59:26,839 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:59:26,839 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 01:59:26,839 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 01:59:26,839 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 01:59:26,844 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 01:59:26,844 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 01:59:26,845 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 01:59:26,920 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 01:59:27,256 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21168.92819833827973417884112', 'margin': '3249.78', 'free_margin': '17919.14819833827973417884112', 'profit_loss': '1353.498198338279734178841123', 'margin_level': '651.3957313522232192388051228', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1353.498198338279734178841123', 'current_price': '96.315'}], 'margin_call': False}
2025-07-21 01:59:27,259 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 651.3957313522232192388051228
2025-07-21 01:59:27,261 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 01:59:27,261 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 01:59:27,266 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 01:59:27,266 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 01:59:27,282 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:59:27,296 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 01:59:27,296 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 01:59:27,362 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:59:27,804 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:59:27,807 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:59:27,809 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:59:27,812 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 01:59:27,812 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3452250000000001'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3452250000000001'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345065'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345065'}], 'margin_call': False}
2025-07-21 01:59:27,815 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:59:27,816 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:59:27,817 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 01:59:27,840 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:27,840 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 01:59:27,858 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:27,858 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 01:59:27,875 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:27,875 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 01:59:27,926 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 01:59:28,318 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.377699092171884114586675191% which is below threshold 100.0%
2025-07-21 01:59:28,318 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '415.639326996531885694197500', 'margin': '9494.47', 'free_margin': '-9078.830673003468114305802500', 'profit_loss': '-9486.380673003468114305802500', 'margin_level': '4.377699092171884114586675191', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9429.730000000000000000000000', 'current_price': '118923.1000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-51.50061182133464936891136365', 'current_price': '96.35'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.150061182133464936891136365', 'current_price': '96.35'}], 'margin_call': True}
2025-07-21 01:59:28,320 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.377699092171884114586675191
2025-07-21 01:59:28,351 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 01:59:28,351 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 01:59:28,386 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:28,386 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 01:59:28,412 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:28,412 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 01:59:28,439 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:28,439 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 01:59:28,464 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:28,464 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 01:59:28,486 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:28,486 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 01:59:28,508 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:28,508 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 01:59:28,533 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:28,533 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 01:59:28,553 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:28,553 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 01:59:28,604 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 01:59:28,938 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.372269068931479528755419751% which is below threshold 100.0%
2025-07-21 01:59:28,938 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '259.565000000000000000000000', 'margin': '5936.62', 'free_margin': '-5677.055000000000000000000000', 'profit_loss': '-6130.055000000000000000000000', 'margin_level': '4.372269068931479528755419751', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6130.055000000000000000000000', 'current_price': '118923.1000000000'}], 'margin_call': True}
2025-07-21 01:59:28,959 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.372269068931479528755419751
2025-07-21 01:59:29,015 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 01:59:29,015 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 01:59:29,098 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 01:59:29,442 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.24714613091749589563999515% which is below threshold 100.0%
2025-07-21 01:59:29,443 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101436.3150000000000000000000', 'margin': '146484.47', 'free_margin': '-45048.1550000000000000000000', 'profit_loss': '-82909.49500000000000000000000', 'margin_level': '69.24714613091749589563999515', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-132.475000000000000000000000', 'current_price': '38.4505'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82777.02000000000000000000000', 'current_price': '118906.0000000000'}], 'margin_call': True}
2025-07-21 01:59:29,446 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.24714613091749589563999515
2025-07-21 01:59:29,450 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 01:59:29,450 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 01:59:29,481 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:29,481 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 01:59:29,482 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 01:59:29,483 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 01:59:29,489 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 01:59:29,490 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 01:59:29,490 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 01:59:29,507 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:29,507 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 01:59:29,508 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 01:59:29,508 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 01:59:29,509 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 01:59:29,509 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 01:59:29,562 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 01:59:29,563 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 01:59:29,953 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 01:59:29,956 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 01:59:29,959 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 01:59:29,959 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 01:59:30,066 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 01:59:30,067 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 01:59:30,365 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:59:30,367 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 01:59:30,367 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 01:59:30,367 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 01:59:30,434 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 01:59:30,434 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 01:59:30,771 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 01:59:30,775 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 01:59:30,775 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 01:59:30,775 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 01:59:30,820 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:30,820 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 01:59:30,844 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 01:59:34,871 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 01:59:35,252 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 02:00:00,861 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 02:00:00,861 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 02:00:00,861 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 02:00:00,862 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 02:00:00,871 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 02:00:00,871 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 02:00:00,871 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 02:00:00,979 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 02:00:01,285 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21106.48074863942128925396342', 'margin': '3547.06', 'free_margin': '17559.42074863942128925396342', 'profit_loss': '1291.050748639421289253963425', 'margin_level': '595.0415484553241639344686422', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1292.691748639421289253963425', 'current_price': '96.306'}, {'order_id': '1192-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('118776.10000000'), 'margin': Decimal('297.28000000'), 'contract_value': Decimal('0.01000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('2.38000000'), 'created_at': '2025-07-21T01:59:11', 'profit_loss': '-1.641000000000000000000000', 'current_price': '118850.0'}], 'margin_call': False}
2025-07-21 02:00:01,304 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 595.0415484553241639344686422
2025-07-21 02:00:01,307 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 02:00:01,307 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 02:00:01,315 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 02:00:01,315 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 02:00:01,342 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 02:00:01,346 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 02:00:01,346 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 02:00:01,486 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 02:00:01,809 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 02:00:01,814 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 02:00:01,818 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 02:00:01,822 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 02:00:01,822 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345235'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345235'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345075'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345075'}], 'margin_call': False}
2025-07-21 02:00:01,824 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 02:00:01,826 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 02:00:01,826 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 02:00:01,854 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:01,854 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 02:00:01,870 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:01,870 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 02:00:01,886 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:01,886 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 02:00:01,948 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 02:00:02,317 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.064231658200742516378421407% which is below threshold 100.0%
2025-07-21 02:00:02,317 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '385.877255518372037994794307', 'margin': '9494.47', 'free_margin': '-9108.592744481627962005205693', 'profit_loss': '-9516.142744481627962005205693', 'margin_level': '4.064231658200742516378421407', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9458.970000000000000000000000', 'current_price': '118850.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-51.97522225602542000473244769', 'current_price': '96.343'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.197522225602542000473244769', 'current_price': '96.343'}], 'margin_call': True}
2025-07-21 02:00:02,319 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.064231658200742516378421407
2025-07-21 02:00:02,353 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 02:00:02,354 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 02:00:02,397 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:02,397 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 02:00:02,416 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:02,416 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 02:00:02,438 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:02,438 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 02:00:02,463 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:02,463 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 02:00:02,484 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:02,484 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 02:00:02,503 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:02,504 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 02:00:02,523 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:02,523 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 02:00:02,540 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:02,540 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 02:00:02,593 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 02:00:02,925 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.249135029697032991837105963% which is below threshold 100.0%
2025-07-21 02:00:02,925 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '252.255000000000000000000000', 'margin': '5936.62', 'free_margin': '-5684.365000000000000000000000', 'profit_loss': '-6137.365000000000000000000000', 'margin_level': '4.249135029697032991837105963', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6137.365000000000000000000000', 'current_price': '118850.0'}], 'margin_call': True}
2025-07-21 02:00:02,927 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.249135029697032991837105963
2025-07-21 02:00:02,953 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 02:00:02,953 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 02:00:03,030 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 02:00:03,436 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.01819694606534057842445687% which is below threshold 100.0%
2025-07-21 02:00:03,436 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101100.9400000000000000000000', 'margin': '146484.47', 'free_margin': '-45383.5300000000000000000000', 'profit_loss': '-83244.87000000000000000000000', 'margin_level': '69.01819694606534057842445687', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-131.8500000000000000000000000', 'current_price': '38.4630000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83113.02000000000000000000000', 'current_price': '118850.0'}], 'margin_call': True}
2025-07-21 02:00:03,439 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.01819694606534057842445687
2025-07-21 02:00:03,441 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 02:00:03,441 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 02:00:03,488 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:03,488 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 02:00:03,490 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 02:00:03,490 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 02:00:03,505 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 02:00:03,507 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 02:00:03,507 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 02:00:03,548 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:03,548 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 02:00:03,550 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 02:00:03,550 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 02:00:03,551 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 02:00:03,551 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 02:00:03,621 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 02:00:03,622 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 02:00:03,978 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 02:00:03,982 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 02:00:03,986 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 02:00:03,986 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 02:00:04,093 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 02:00:04,093 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 02:00:04,460 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 02:00:04,464 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 02:00:04,464 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 02:00:04,464 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 02:00:04,548 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 02:00:04,548 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 02:00:04,871 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 02:00:04,904 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 02:00:04,904 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 02:00:04,904 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 02:00:04,937 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:04,938 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 02:00:04,955 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:34,880 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-21 02:00:35,281 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-21 02:00:35,283 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-21 02:00:35,283 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-21 02:00:35,283 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-21 02:00:35,283 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-21 02:00:35,289 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-21 02:00:35,289 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-21 02:00:35,290 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-21 02:00:35,408 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-21 02:00:35,797 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '21140.58245774400302890986289', 'margin': '3547.06', 'free_margin': '17593.52245774400302890986289', 'profit_loss': '1325.152457744003028909862888', 'margin_level': '596.0029561874905704699064264', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('96.10000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'created_at': '2025-07-17T23:14:15', 'profit_loss': '1326.562457744003028909862888', 'current_price': '96.311'}, {'order_id': '1192-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('118776.10000000'), 'margin': Decimal('297.28000000'), 'contract_value': Decimal('0.01000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('2.38000000'), 'created_at': '2025-07-21T01:59:11', 'profit_loss': '-1.410000000000000000000000', 'current_price': '118873.1'}], 'margin_call': False}
2025-07-21 02:00:35,831 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 596.0029561874905704699064264
2025-07-21 02:00:35,833 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-21 02:00:35,834 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-21 02:00:35,845 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-21 02:00:35,845 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-21 02:00:35,864 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 02:00:35,867 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-21 02:00:35,867 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-21 02:00:35,964 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 02:00:36,342 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 02:00:36,344 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 02:00:36,345 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 02:00:36,347 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-21 02:00:36,347 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.345205'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.345205'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.345045'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.345045'}], 'margin_call': False}
2025-07-21 02:00:36,349 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 02:00:36,349 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 02:00:36,350 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-21 02:00:36,371 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:36,371 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-21 02:00:36,389 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:36,389 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-21 02:00:36,404 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:36,404 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-21 02:00:36,457 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-21 02:00:36,814 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.163873427832115961928370736% which is below threshold 100.0%
2025-07-21 02:00:36,815 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '395.337713443491900370500581', 'margin': '9494.47', 'free_margin': '-9099.132286556508099629499419', 'profit_loss': '-9506.682286556508099629499419', 'margin_level': '4.163873427832115961928370736', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9449.730000000000000000000000', 'current_price': '118873.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-51.77480596046190875409038051', 'current_price': '96.346'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-5.177480596046190875409038051', 'current_price': '96.346'}], 'margin_call': True}
2025-07-21 02:00:36,826 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.163873427832115961928370736
2025-07-21 02:00:36,864 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-21 02:00:36,864 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-21 02:00:36,900 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:36,900 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-21 02:00:36,929 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:36,929 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-21 02:00:36,955 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:36,955 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-21 02:00:36,988 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:36,988 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-21 02:00:37,015 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:37,015 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-21 02:00:37,046 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:37,046 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-21 02:00:37,077 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:37,077 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-21 02:00:37,097 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:37,097 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-21 02:00:37,182 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-21 02:00:37,514 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.288046059879190515815396640% which is below threshold 100.0%
2025-07-21 02:00:37,514 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '254.565000000000000000000000', 'margin': '5936.62', 'free_margin': '-5682.055000000000000000000000', 'profit_loss': '-6135.055000000000000000000000', 'margin_level': '4.288046059879190515815396640', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6135.055000000000000000000000', 'current_price': '118873.1'}], 'margin_call': True}
2025-07-21 02:00:37,517 - INFO - app - Starting cache validation task
2025-07-21 02:00:37,519 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.288046059879190515815396640
2025-07-21 02:00:37,524 - INFO - app - Validating cache for 29 users
2025-07-21 02:00:37,533 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,548 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,557 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-21 02:00:37,557 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-21 02:00:37,578 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,589 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,600 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,613 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,621 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,632 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,643 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,653 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,666 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,676 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,685 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,697 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,708 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,724 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,735 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-21 02:00:37,740 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-21 02:00:38,047 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.11242195162395017028084957% which is below threshold 100.0%
2025-07-21 02:00:38,047 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101238.9649999999998000000000', 'margin': '146484.47', 'free_margin': '-45245.5050000000002000000000', 'profit_loss': '-83106.84500000000020000000000', 'margin_level': '69.11242195162395017028084957', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-132.4250000000002000000000000', 'current_price': '38.451499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82974.42000000000000000000000', 'current_price': '118873.1'}], 'margin_call': True}
2025-07-21 02:00:38,050 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.11242195162395017028084957
2025-07-21 02:00:38,051 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-21 02:00:38,051 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-21 02:00:38,067 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-21 02:00:38,085 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-21 02:00:38,510 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-21 02:00:38,511 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:38,511 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-21 02:00:38,512 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-21 02:00:38,512 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-21 02:00:38,520 - INFO - app - Cache validation completed
2025-07-21 02:00:38,524 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-21 02:00:38,525 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-21 02:00:38,525 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-21 02:00:38,550 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:38,550 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-21 02:00:38,551 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-21 02:00:38,551 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-21 02:00:38,552 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-21 02:00:38,552 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-21 02:00:38,656 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-21 02:00:38,657 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-21 02:00:38,977 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-21 02:00:38,979 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-21 02:00:38,981 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-21 02:00:38,982 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-21 02:00:39,109 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-21 02:00:39,110 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-21 02:00:39,409 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 02:00:39,411 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-21 02:00:39,411 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-21 02:00:39,411 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-21 02:00:39,526 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-21 02:00:39,527 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-21 02:00:39,846 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-21 02:00:39,848 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-21 02:00:39,848 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-21 02:00:39,848 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-21 02:00:39,873 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:39,873 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-21 02:00:39,901 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-21 02:00:57,647 - INFO - app - Application shutdown initiated
2025-07-21 02:00:57,647 - INFO - app - Scheduler shutdown completed
2025-07-21 02:00:58,538 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-21 02:00:59,732 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-21 02:00:59,733 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-21 02:00:59,736 - INFO - app - Redis connection closed
2025-07-21 02:00:59,736 - INFO - app - Application shutdown completed
