2025-07-22 03:19:54,675 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:54,708 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:54,718 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:54,719 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:54,997 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:19:54,997 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:19:54,997 - INFO - app - Environment: PRODUCTION
2025-07-22 03:19:55,062 - INFO - app - Application startup initiated
2025-07-22 03:19:55,062 - INFO - app - Initializing core services...
2025-07-22 03:19:55,098 - INFO - app - Firebase initialized
2025-07-22 03:19:55,098 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:19:55,119 - INFO - app - Redis initialized
2025-07-22 03:19:55,986 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:19:55,989 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:19:55,992 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:19:55,992 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:19:55,992 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:19:55,993 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:19:55,993 - INFO - app - Scheduler initialized
2025-07-22 03:19:55,994 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:19:55,995 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:19:56,898 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:19:56,917 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:19:56,956 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:19:56,956 - INFO - app - Background tasks initialized
2025-07-22 03:19:56,956 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:19:57,571 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:19:57,571 - INFO - app - Application startup completed successfully
2025-07-22 03:19:57,572 - INFO - app - Starting cache validation task
2025-07-22 03:19:57,575 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:19:57,578 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:19:57,580 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:19:57,580 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:19:57,580 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:19:57,580 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:19:57,581 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:19:57,620 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 03:19:57,634 - INFO - app - Validating cache for 30 users
2025-07-22 03:19:57,636 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:19:57,636 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:19:57,636 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:19:57,640 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:19:57,652 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:19:57,652 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:19:57,655 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:19:57,659 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:19:57,661 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:19:57,665 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:19:57,666 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:19:57,670 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:19:57,671 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:19:57,673 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:19:57,675 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:19:57,675 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:19:57,675 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:19:57,676 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:19:57,677 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:19:57,679 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:19:57,680 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:19:57,681 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:19:57,684 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:19:57,686 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:19:57,688 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:19:57,691 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:19:57,693 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:19:57,695 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:19:57,695 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:19:57,716 - WARNING - app - User 4: Missing static orders cache, refreshing...
2025-07-22 03:19:57,744 - INFO - app - Cache validation completed
2025-07-22 03:19:57,857 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:19:58,146 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:19:58,148 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:19:58,149 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:19:58,150 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:19:58,151 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3495200000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3495200000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3495100000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3495100000'}], 'margin_call': False}
2025-07-22 03:19:58,152 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:19:58,153 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:19:58,153 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:19:58,176 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,176 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:19:58,194 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,194 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:19:58,216 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,216 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:19:58,436 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:19:58,744 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.975377872009417860507462418% which is below threshold 100.0%
2025-07-22 03:19:58,745 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '187.551659444572575940522867', 'margin': '9494.47', 'free_margin': '-9306.918340555427424059477133', 'profit_loss': '-9714.468340555427424059477133', 'margin_level': '1.975377872009417860507462418', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9639.646000000000000000000000', 'current_price': '118398.3100000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.02030959584311278134284823', 'current_price': '96.1090000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.802030959584311278134284823', 'current_price': '96.1090000000'}], 'margin_call': True}
2025-07-22 03:19:58,746 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 1.975377872009417860507462418
2025-07-22 03:19:58,777 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:19:58,777 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:19:58,799 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,799 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:19:58,822 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,822 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:19:58,845 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,845 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:19:58,869 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,870 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:19:58,891 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,891 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:19:58,917 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,917 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:19:58,940 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,940 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:19:58,963 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,963 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:19:59,131 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:19:59,318 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,325 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,334 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,337 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,345 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,350 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,422 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.488281210520464506739525184% which is below threshold 100.0%
2025-07-22 03:19:59,423 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '207.086000000000000000000000', 'margin': '5936.62', 'free_margin': '-5729.534000000000000000000000', 'profit_loss': '-6182.534000000000000000000000', 'margin_level': '3.488281210520464506739525184', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6182.534000000000000000000000', 'current_price': '118398.3100000000'}], 'margin_call': True}
2025-07-22 03:19:59,425 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.488281210520464506739525184
2025-07-22 03:19:59,484 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:19:59,484 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:19:59,645 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,649 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,662 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,663 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,670 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,674 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,674 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,679 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,679 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,682 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,682 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,682 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,683 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,683 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,686 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,692 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,692 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,702 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,703 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,705 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,705 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,709 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:20:00,005 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.18220709676595751071768905% which is below threshold 100.0%
2025-07-22 03:20:00,005 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98411.50000000000000000000000', 'margin': '146484.47', 'free_margin': '-48072.97000000000000000000000', 'profit_loss': '-85934.31000000000000000000000', 'margin_level': '67.18220709676595751071768905', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.1500000000000000000000000', 'current_price': '38.8770000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85823.16000000000000000000000', 'current_price': '118398.3100000000'}], 'margin_call': True}
2025-07-22 03:20:00,008 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.18220709676595751071768905
2025-07-22 03:20:00,009 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:20:00,009 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:20:00,031 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:00,031 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:20:00,049 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:00,049 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:20:00,067 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:00,067 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:20:00,068 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:00,068 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:20:00,073 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:20:00,074 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:20:00,075 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:20:00,089 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:00,090 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:20:00,090 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:00,090 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:20:00,091 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:00,091 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:20:00,186 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:20:00,186 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:20:00,617 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:20:00,619 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:20:00,620 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:20:00,620 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:20:00,690 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:20:00,691 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:20:00,979 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:20:00,981 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:20:00,982 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:20:00,982 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:20:01,057 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:20:01,057 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:20:01,399 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:20:01,410 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:20:01,410 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:20:01,411 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:20:01,451 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:01,451 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:20:01,480 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:12,572 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:20:12,573 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:20:12,574 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:20:12,575 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:20:12,576 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:20:12,578 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:20:12,580 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:20:12,581 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:20:12,585 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:20:12,586 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:20:12,587 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:20:12,588 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:20:12,589 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:20:12,592 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:20:12,595 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:20:12,596 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:20:12,598 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:20:12,599 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:20:12,601 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:20:12,601 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:20:12,604 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:20:12,606 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:20:12,609 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:20:12,610 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:20:31,492 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:20:31,493 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:20:31,493 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:20:31,493 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:20:31,498 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:20:31,498 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:20:31,498 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:20:31,502 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:20:31,502 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:20:31,511 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:20:31,513 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:20:31,513 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:20:31,563 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:20:31,861 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:20:31,868 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:20:31,873 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:20:31,877 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:20:31,877 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349515'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349515'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3493549999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3493549999999999'}], 'margin_call': False}
2025-07-22 03:20:31,881 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:20:31,883 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:20:31,883 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:20:31,935 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:31,935 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:20:31,960 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:31,960 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:20:31,976 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:31,976 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:20:32,025 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:20:32,323 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.829940466700691002462017985% which is below threshold 100.0%
2025-07-22 03:20:32,323 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '173.743148628757097021455559', 'margin': '9494.47', 'free_margin': '-9320.726851371242902978544441', 'profit_loss': '-9728.276851371242902978544441', 'margin_level': '1.829940466700691002462017985', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9652.486000000000000000000000', 'current_price': '118366.21'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.90077397385718452594949159', 'current_price': '96.096'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.890077397385718452594949159', 'current_price': '96.096'}], 'margin_call': True}
2025-07-22 03:20:32,325 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 1.829940466700691002462017985
2025-07-22 03:20:32,362 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:20:32,363 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:20:32,387 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,387 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:20:32,409 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,409 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:20:32,429 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,430 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:20:32,449 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,449 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:20:32,469 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,469 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:20:32,491 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,491 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:20:32,514 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,515 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:20:32,543 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,543 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:20:32,652 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:20:32,978 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.434210038708894960432030347% which is below threshold 100.0%
2025-07-22 03:20:32,979 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '203.876000000000000000000000', 'margin': '5936.62', 'free_margin': '-5732.744000000000000000000000', 'profit_loss': '-6185.744000000000000000000000', 'margin_level': '3.434210038708894960432030347', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6185.744000000000000000000000', 'current_price': '118366.21'}], 'margin_call': True}
2025-07-22 03:20:32,982 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.434210038708894960432030347
2025-07-22 03:20:33,012 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:20:33,012 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:20:33,105 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:20:33,398 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.05029891564614323962123766% which is below threshold 100.0%
2025-07-22 03:20:33,398 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98218.27500000000000000000000', 'margin': '146484.47', 'free_margin': '-48266.19500000000000000000000', 'profit_loss': '-86127.53500000000000000000000', 'margin_level': '67.05029891564614323962123766', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.775000000000000000000000', 'current_price': '38.8645'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-86015.76000000000000000000000', 'current_price': '118366.21'}], 'margin_call': True}
2025-07-22 03:20:33,403 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.05029891564614323962123766
2025-07-22 03:20:33,405 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:20:33,405 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:20:33,433 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:33,433 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:20:33,464 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:33,464 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:20:33,496 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:33,496 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:20:33,496 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:33,497 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:20:33,512 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:20:33,515 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:20:33,515 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:20:33,541 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:33,542 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:20:33,544 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:33,544 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:20:33,546 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:33,546 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:20:33,663 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:20:33,663 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:20:33,956 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:20:33,958 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:20:33,960 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:20:33,960 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:20:34,049 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:20:34,050 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:20:34,345 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:20:34,347 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:20:34,347 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:20:34,347 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:20:34,461 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:20:34,462 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:20:34,751 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:20:34,752 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:20:34,752 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:20:34,752 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:20:34,785 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:34,785 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:20:34,809 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:56,006 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:20:56,314 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:21:04,810 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:21:04,810 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:21:04,811 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:21:04,811 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:21:04,819 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:21:04,819 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:21:04,819 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:21:04,823 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:21:04,823 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:21:04,834 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:21:04,838 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:21:04,838 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:21:04,965 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:21:05,300 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:05,304 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:05,306 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:05,309 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:05,309 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349405'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349405'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349245'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349245'}], 'margin_call': False}
2025-07-22 03:21:05,311 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:21:05,312 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:21:05,312 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:21:05,342 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:05,342 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:21:05,379 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:05,379 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:21:05,446 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:05,446 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:21:05,569 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:21:05,916 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.164435124579711248888885267% which is below threshold 100.0%
2025-07-22 03:21:05,916 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '205.501643572683310612380545', 'margin': '9494.47', 'free_margin': '-9288.968356427316689387619455', 'profit_loss': '-9696.518356427316689387619455', 'margin_level': '2.164435124579711248888885267', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9620.290000000000000000000000', 'current_price': '118446.7'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.29850584301517217056314051', 'current_price': '96.09'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.929850584301517217056314051', 'current_price': '96.09'}], 'margin_call': True}
2025-07-22 03:21:05,921 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.164435124579711248888885267
2025-07-22 03:21:05,960 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:21:05,960 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:21:06,013 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,014 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:21:06,052 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,053 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:21:06,095 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,095 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:21:06,130 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,130 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:21:06,160 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,161 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:21:06,192 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,192 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:21:06,226 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,226 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:21:06,261 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,261 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:21:06,375 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:21:06,732 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.569792238681269813462879551% which is below threshold 100.0%
2025-07-22 03:21:06,733 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '211.925000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.695000000000000000000000', 'profit_loss': '-6177.695000000000000000000000', 'margin_level': '3.569792238681269813462879551', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.695000000000000000000000', 'current_price': '118446.7'}], 'margin_call': True}
2025-07-22 03:21:06,735 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.569792238681269813462879551
2025-07-22 03:21:06,833 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:21:06,833 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:21:07,764 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:21:08,166 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.38036120825641090144231672% which is below threshold 100.0%
2025-07-22 03:21:08,166 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98701.76499999999975000000000', 'margin': '146484.47', 'free_margin': '-47782.70500000000025000000000', 'profit_loss': '-85644.04500000000025000000000', 'margin_level': '67.38036120825641090144231672', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.2250000000002500000000000', 'current_price': '38.875499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85532.82000000000000000000000', 'current_price': '118446.7'}], 'margin_call': True}
2025-07-22 03:21:08,169 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.38036120825641090144231672
2025-07-22 03:21:08,172 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:21:08,172 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:21:08,230 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:08,230 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:21:08,340 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:08,340 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:21:08,424 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:08,424 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:21:08,430 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:08,430 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:21:08,446 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:21:08,450 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:21:08,451 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:21:08,521 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:08,521 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:21:08,523 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:08,524 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:21:08,526 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:08,526 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:21:08,747 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:21:08,749 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:21:09,100 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:21:09,132 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:21:09,139 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:21:09,139 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:21:09,437 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:21:09,440 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:21:09,806 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:21:09,810 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:21:09,810 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:21:09,811 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:21:09,924 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:21:09,926 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:21:10,317 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:21:10,320 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:21:10,320 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:21:10,320 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:21:10,385 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:10,385 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:21:10,449 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:24,205 - INFO - app - Application shutdown initiated
2025-07-22 03:21:24,206 - INFO - app - Scheduler shutdown completed
2025-07-22 03:21:24,583 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 03:21:25,282 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 03:21:25,282 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 03:21:25,287 - INFO - app - Redis connection closed
2025-07-22 03:21:25,288 - INFO - app - Application shutdown completed
2025-07-22 03:21:27,087 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:27,119 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:27,130 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:27,130 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:43,111 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:43,168 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:43,182 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:43,182 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:53,013 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:53,033 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:53,046 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:53,046 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:53,452 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:21:53,452 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:21:53,452 - INFO - app - Environment: PRODUCTION
2025-07-22 03:21:53,495 - INFO - app - Application startup initiated
2025-07-22 03:21:53,495 - INFO - app - Initializing core services...
2025-07-22 03:21:53,528 - INFO - app - Firebase initialized
2025-07-22 03:21:53,528 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:21:53,549 - INFO - app - Redis initialized
2025-07-22 03:21:54,039 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:21:54,042 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:21:54,045 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:21:54,045 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:21:54,045 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:21:54,046 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:21:54,046 - INFO - app - Scheduler initialized
2025-07-22 03:21:54,047 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:21:54,047 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:21:55,178 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:21:55,187 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:21:55,223 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:21:55,223 - INFO - app - Background tasks initialized
2025-07-22 03:21:55,223 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:21:55,880 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:21:55,880 - INFO - app - Application startup completed successfully
2025-07-22 03:21:55,881 - INFO - app - Starting cache validation task
2025-07-22 03:21:55,885 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:21:55,887 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:21:55,890 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:21:55,890 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:21:55,890 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:21:55,890 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:21:55,890 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:21:55,922 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:21:55,930 - INFO - app - Validating cache for 30 users
2025-07-22 03:21:55,932 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:21:55,932 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:21:55,932 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:21:55,939 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:21:55,951 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:21:55,954 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:21:55,954 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:21:55,961 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:21:55,965 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:21:55,969 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:21:55,970 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:21:55,973 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:21:55,974 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:21:55,977 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:21:55,978 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:21:55,978 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:21:55,979 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:21:55,981 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:21:55,982 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:21:55,984 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:21:55,985 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:21:55,986 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:21:55,990 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:21:55,991 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:21:55,993 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:21:55,994 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:21:55,997 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:21:56,000 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:21:56,002 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:21:56,003 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:21:56,042 - INFO - app - Cache validation completed
2025-07-22 03:21:56,199 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:21:56,524 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:56,529 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:56,535 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:56,540 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:56,540 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3492300000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3492300000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3492200000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3492200000'}], 'margin_call': False}
2025-07-22 03:21:56,544 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:21:56,549 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:21:56,549 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:21:56,604 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:56,605 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:21:56,673 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:56,673 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:21:56,752 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:56,752 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:21:57,095 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:21:57,401 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.388489886720491912708953981% which is below threshold 100.0%
2025-07-22 03:21:57,402 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '226.774455747711088504577823', 'margin': '9494.47', 'free_margin': '-9267.695544252288911495422177', 'profit_loss': '-9675.245544252288911495422177', 'margin_level': '2.388489886720491912708953981', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9600.290000000000000000000000', 'current_price': '118496.7000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.14140386571719226856561546', 'current_price': '96.1070000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.814140386571719226856561546', 'current_price': '96.1070000000'}], 'margin_call': True}
2025-07-22 03:21:57,407 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.388489886720491912708953981
2025-07-22 03:21:57,433 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:21:57,433 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:21:57,457 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,457 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:21:57,481 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,481 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:21:57,503 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,503 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:21:57,530 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,530 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:21:57,555 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,561 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:21:57,587 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,587 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:21:57,612 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,613 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:21:57,637 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,637 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:21:57,777 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:21:57,976 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:57,983 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,004 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,008 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,016 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,018 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,078 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.654015247733558826402902662% which is below threshold 100.0%
2025-07-22 03:21:58,079 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '216.925000000000000000000000', 'margin': '5936.62', 'free_margin': '-5719.695000000000000000000000', 'profit_loss': '-6172.695000000000000000000000', 'margin_level': '3.654015247733558826402902662', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6172.695000000000000000000000', 'current_price': '118496.7000000000'}], 'margin_call': True}
2025-07-22 03:21:58,082 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.654015247733558826402902662
2025-07-22 03:21:58,093 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,126 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:21:58,126 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:21:58,335 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,336 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,361 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,361 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,367 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,367 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,369 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,372 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,380 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,385 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,395 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,396 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,396 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,396 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,403 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,403 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,404 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,404 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,438 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:21:58,449 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,459 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,459 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,746 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.58551947520443634741621416% which is below threshold 100.0%
2025-07-22 03:21:58,746 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '99002.29000000000000000000000', 'margin': '146484.47', 'free_margin': '-47482.18000000000000000000000', 'profit_loss': '-85343.52000000000000000000000', 'margin_level': '67.58551947520443634741621416', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.7000000000000000000000000', 'current_price': '38.8860000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85232.82000000000000000000000', 'current_price': '118496.7000000000'}], 'margin_call': True}
2025-07-22 03:21:58,749 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.58551947520443634741621416
2025-07-22 03:21:58,750 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:21:58,750 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:21:58,767 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:58,768 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:21:58,780 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:58,780 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:21:58,800 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:58,800 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:21:58,801 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:58,801 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:21:58,807 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:21:58,809 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:21:58,809 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:21:58,824 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:58,825 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:21:58,825 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:58,825 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:21:58,826 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:58,826 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:21:58,998 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:21:58,999 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:22:00,116 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:22:00,122 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:22:00,123 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:22:00,123 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:22:00,209 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:22:00,210 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:22:00,592 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:22:00,595 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:22:00,595 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:22:00,595 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:22:00,656 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:22:00,657 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:22:01,002 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:22:01,006 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:22:01,006 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:22:01,006 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:22:01,028 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:01,028 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:22:01,047 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:10,891 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:22:10,893 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:22:10,895 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:22:10,898 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:22:10,900 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:22:10,901 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:22:10,905 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:22:10,906 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:22:10,908 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:22:10,910 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:22:10,912 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:22:10,913 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:22:10,914 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:22:10,915 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:22:10,917 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:22:10,918 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:22:10,919 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:22:10,921 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:22:10,921 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:22:10,922 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:22:10,924 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:22:10,925 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:22:10,926 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:22:10,926 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:22:31,059 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:22:31,059 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:22:31,059 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:22:31,060 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:22:31,069 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:22:31,069 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:22:31,070 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:22:31,077 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:22:31,078 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:22:31,094 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:22:31,098 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:22:31,098 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:22:31,272 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:22:31,623 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:22:31,626 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:22:31,630 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:22:31,633 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:22:31,633 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349385'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349385'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349225'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349225'}], 'margin_call': False}
2025-07-22 03:22:31,636 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:22:31,637 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:22:31,638 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:22:31,683 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:31,684 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:22:31,759 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:31,759 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:22:31,826 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:31,826 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:22:32,026 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:22:32,351 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.172279193760198641318617816% which is below threshold 100.0%
2025-07-22 03:22:32,351 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '206.246396367803931940403773', 'margin': '9494.47', 'free_margin': '-9288.223603632196068059596227', 'profit_loss': '-9695.773603632196068059596227', 'margin_level': '2.172279193760198641318617816', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9620.002000000000000000000000', 'current_price': '118447.42'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.88327602926915278145111523', 'current_price': '96.096'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.888327602926915278145111523', 'current_price': '96.096'}], 'margin_call': True}
2025-07-22 03:22:32,352 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.172279193760198641318617816
2025-07-22 03:22:32,390 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:22:32,390 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:22:32,449 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,449 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:22:32,493 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,493 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:22:32,555 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,555 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:22:32,637 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,637 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:22:32,671 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,671 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:22:32,685 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,685 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:22:32,699 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,699 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:22:32,713 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,713 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:22:32,771 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:22:33,071 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.571005050011622775249215884% which is below threshold 100.0%
2025-07-22 03:22:33,071 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '211.997000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.623000000000000000000000', 'profit_loss': '-6177.623000000000000000000000', 'margin_level': '3.571005050011622775249215884', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.623000000000000000000000', 'current_price': '118447.42'}], 'margin_call': True}
2025-07-22 03:22:33,074 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.571005050011622775249215884
2025-07-22 03:22:33,118 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:22:33,119 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:22:33,195 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:22:33,497 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.38320792641021928809245103% which is below threshold 100.0%
2025-07-22 03:22:33,498 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98705.93499999999975000000000', 'margin': '146484.47', 'free_margin': '-47778.53500000000025000000000', 'profit_loss': '-85639.87500000000025000000000', 'margin_level': '67.38320792641021928809245103', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.3750000000002500000000000', 'current_price': '38.872499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85528.50000000000000000000000', 'current_price': '118447.42'}], 'margin_call': True}
2025-07-22 03:22:33,502 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.38320792641021928809245103
2025-07-22 03:22:33,504 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:22:33,504 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:22:33,539 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:33,539 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:22:33,572 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:33,572 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:22:33,607 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:33,607 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:22:33,608 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:22:33,609 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:22:33,620 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:22:33,622 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:22:33,623 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:22:33,672 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:33,672 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:22:33,674 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:22:33,674 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:22:33,676 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:22:33,676 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:22:33,777 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:22:33,778 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:22:34,085 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:22:34,086 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:22:34,087 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:22:34,087 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:22:34,137 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:22:34,137 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:22:34,437 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:22:34,441 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:22:34,441 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:22:34,442 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:22:34,511 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:22:34,512 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:22:34,830 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:22:34,832 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:22:34,832 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:22:34,832 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:22:34,889 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:34,889 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:22:34,924 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:54,046 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:22:54,350 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:23:04,935 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:23:04,935 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:23:04,935 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:23:04,936 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:23:04,950 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:23:04,951 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:23:04,951 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:23:04,961 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:23:04,961 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:23:04,987 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:23:04,991 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:23:04,991 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:23:05,196 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:23:05,541 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:05,545 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:05,552 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:05,558 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:05,558 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349345'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349345'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3491849999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3491849999999999'}], 'margin_call': False}
2025-07-22 03:23:05,570 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:23:05,572 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:23:05,572 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:23:05,613 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:05,613 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:23:05,646 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:05,646 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:23:05,679 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:05,680 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:23:05,785 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:23:06,132 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.256740329345669942894539611% which is below threshold 100.0%
2025-07-22 03:23:06,132 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '214.265533547625829027139195', 'margin': '9494.47', 'free_margin': '-9280.204466452374170972860805', 'profit_loss': '-9687.754466452374170972860805', 'margin_level': '2.256740329345669942894539611', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9611.686000000000000000000000', 'current_price': '118468.21'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.15315132034015542987345893', 'current_price': '96.092'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.915315132034015542987345893', 'current_price': '96.092'}], 'margin_call': True}
2025-07-22 03:23:06,135 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.256740329345669942894539611
2025-07-22 03:23:06,187 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:23:06,187 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:23:06,232 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,233 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:23:06,292 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,292 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:23:06,336 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,336 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:23:06,382 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,382 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:23:06,425 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,426 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:23:06,478 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,478 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:23:06,534 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,535 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:23:06,587 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,587 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:23:06,801 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:23:07,153 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.606024977175564546829677493% which is below threshold 100.0%
2025-07-22 03:23:07,153 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '214.076000000000000000000000', 'margin': '5936.62', 'free_margin': '-5722.544000000000000000000000', 'profit_loss': '-6175.544000000000000000000000', 'margin_level': '3.606024977175564546829677493', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6175.544000000000000000000000', 'current_price': '118468.21'}], 'margin_call': True}
2025-07-22 03:23:07,155 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.606024977175564546829677493
2025-07-22 03:23:07,212 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:23:07,213 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:23:07,386 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:23:07,388 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-22 03:23:07,765 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-85514.83500000000025000000000', 'margin': '0.0', 'free_margin': '-85514.83500000000025000000000', 'profit_loss': '-85514.83500000000025000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.0750000000002500000000000', 'current_price': '38.878499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85403.76000000000000000000000', 'current_price': '118468.21'}], 'margin_call': False}
2025-07-22 03:23:07,768 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-22 03:23:07,768 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:23:07,768 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:23:07,796 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:07,796 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:23:07,812 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:07,812 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:23:07,848 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:07,848 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:23:07,852 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:07,852 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:23:07,863 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:23:07,864 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:23:07,865 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:23:07,954 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:07,954 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:23:07,955 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:07,956 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:23:07,957 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:07,957 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:23:08,090 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:23:08,091 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:08,095 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:08,483 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:08,485 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:23:08,486 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:23:08,486 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:23:08,605 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:23:08,606 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:23:08,610 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:23:08,993 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:08,996 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:23:08,996 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:23:08,997 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:23:09,100 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:23:09,101 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:23:09,105 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:23:09,412 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:09,413 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:23:09,414 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:23:09,414 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:23:09,445 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:09,446 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:23:09,474 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:39,485 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:23:39,486 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:23:39,486 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:23:39,486 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:23:39,500 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:23:39,501 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:23:39,501 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:23:39,510 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:23:39,511 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:23:39,531 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:23:39,534 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:23:39,535 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:23:39,725 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:23:39,726 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:40,127 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:40,131 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:40,134 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:40,136 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:40,136 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3493650000000001'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3493650000000001'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349205'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349205'}], 'margin_call': False}
2025-07-22 03:23:40,140 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:23:40,141 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:23:40,141 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:23:40,185 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:40,185 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:23:40,247 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:40,247 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:23:40,302 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:40,302 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:23:40,398 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:23:41,065 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.171033538508004124067515691% which is below threshold 100.0%
2025-07-22 03:23:41,066 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '206.128128003580899158353057', 'margin': '9494.47', 'free_margin': '-9288.341871996419100841646943', 'profit_loss': '-9695.891871996419100841646943', 'margin_level': '2.171033538508004124067515691', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9619.966000000000000000000000', 'current_price': '118447.51'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.02351999674463712876994758', 'current_price': '96.094'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.902351999674463712876994758', 'current_price': '96.094'}], 'margin_call': True}
2025-07-22 03:23:41,070 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.171033538508004124067515691
2025-07-22 03:23:41,117 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:23:41,117 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:23:41,150 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,150 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:23:41,181 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,181 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:23:41,211 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,211 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:23:41,240 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,240 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:23:41,270 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,270 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:23:41,292 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,292 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:23:41,307 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,307 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:23:41,339 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,340 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:23:41,461 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:23:41,865 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.571156651427916895472507925% which is below threshold 100.0%
2025-07-22 03:23:41,866 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '212.006000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.614000000000000000000000', 'profit_loss': '-6177.614000000000000000000000', 'margin_level': '3.571156651427916895472507925', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.614000000000000000000000', 'current_price': '118447.51'}], 'margin_call': True}
2025-07-22 03:23:41,869 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.571156651427916895472507925
2025-07-22 03:23:41,899 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:23:41,900 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:23:41,952 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:23:41,953 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-22 03:23:42,275 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-85638.41000000000000000000000', 'margin': '0.0', 'free_margin': '-85638.41000000000000000000000', 'profit_loss': '-85638.41000000000000000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.4500000000000000000000000', 'current_price': '38.8910000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85527.96000000000000000000000', 'current_price': '118447.51'}], 'margin_call': False}
2025-07-22 03:23:42,279 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-22 03:23:42,279 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:23:42,280 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:23:42,315 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:42,315 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:23:42,333 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:42,333 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:23:42,350 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:42,350 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:23:42,350 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:42,350 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:23:42,354 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:23:42,356 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:23:42,356 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:23:42,371 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:42,371 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:23:42,372 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:42,372 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:23:42,374 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:42,374 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:23:42,422 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:23:42,423 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:42,425 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:42,762 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:42,765 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:23:42,765 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:23:42,765 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:23:42,870 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:23:42,871 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:23:42,878 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:23:43,301 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:43,305 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:23:43,306 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:23:43,306 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:23:43,449 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:23:43,449 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:23:43,454 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:23:43,816 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:43,820 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:23:43,820 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:23:43,821 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:23:43,864 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:43,864 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:23:43,900 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:54,056 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:23:54,362 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:23:58,198 - INFO - app - Application shutdown initiated
2025-07-22 03:23:58,200 - INFO - app - Scheduler shutdown completed
2025-07-22 03:23:58,205 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 03:23:58,975 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 03:23:58,975 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 03:23:58,985 - INFO - app - Redis connection closed
2025-07-22 03:23:58,985 - INFO - app - Application shutdown completed
2025-07-22 03:28:31,417 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:31,465 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:31,483 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:31,483 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:32,081 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:28:32,081 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:28:32,081 - INFO - app - Environment: PRODUCTION
2025-07-22 03:28:32,152 - INFO - app - Application startup initiated
2025-07-22 03:28:32,152 - INFO - app - Initializing core services...
2025-07-22 03:28:32,187 - INFO - app - Firebase initialized
2025-07-22 03:28:32,187 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:28:32,208 - INFO - app - Redis initialized
2025-07-22 03:28:33,441 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:28:33,444 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:28:33,446 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:28:33,447 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:28:33,447 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:28:33,447 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:28:33,447 - INFO - app - Scheduler initialized
2025-07-22 03:28:33,449 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:28:33,449 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:28:34,742 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:28:34,749 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:28:34,845 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:28:34,845 - INFO - app - Background tasks initialized
2025-07-22 03:28:34,845 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:28:35,541 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:28:35,542 - INFO - app - Application startup completed successfully
2025-07-22 03:28:35,542 - INFO - app - Starting cache validation task
2025-07-22 03:28:35,545 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:28:35,549 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:28:35,551 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:28:35,551 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:28:35,551 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:28:35,551 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:28:35,551 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:28:35,558 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:28:35,571 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:28:35,571 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:28:35,571 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:28:35,572 - INFO - app - Validating cache for 30 users
2025-07-22 03:28:35,573 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:28:35,583 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,589 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:28:35,589 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:28:35,593 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:28:35,595 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:28:35,604 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:28:35,605 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,607 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:28:35,608 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:28:35,612 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:28:35,613 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:28:35,615 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:28:35,615 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:28:35,616 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:28:35,618 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:28:35,619 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:28:35,619 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:28:35,619 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:28:35,619 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,620 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:28:35,621 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:28:35,624 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:28:35,625 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:28:35,626 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:28:35,627 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:28:35,629 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:28:35,630 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:28:35,632 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:28:35,632 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:28:35,633 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,647 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,656 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,670 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,681 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,691 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,703 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,714 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,726 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,761 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,781 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,799 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,813 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,827 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,839 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,861 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,875 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,883 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:28:36,217 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-22 03:28:36,222 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:28:36,225 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:28:36,227 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:28:36,229 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:28:36,229 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3492900000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3492900000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3492800000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3492800000'}], 'margin_call': False}
2025-07-22 03:28:36,230 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:28:36,231 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:28:36,232 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:28:36,232 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:28:36,243 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-22 03:28:36,267 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,267 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:28:36,267 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-22 03:28:36,280 - INFO - app - Cache validation completed
2025-07-22 03:28:36,298 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,298 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:28:36,334 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,334 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:28:36,521 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:28:36,873 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.381455344966785879648767693% which is below threshold 100.0%
2025-07-22 03:28:36,874 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '226.106563291267995307488354', 'margin': '9494.47', 'free_margin': '-9268.363436708732004692511646', 'profit_loss': '-9675.913436708732004692511646', 'margin_level': '2.381455344966785879648767693', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9601.042000000000000000000000', 'current_price': '118494.8200000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.06494246248364062955604229', 'current_price': '96.1080000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.806494246248364062955604229', 'current_price': '96.1080000000'}], 'margin_call': True}
2025-07-22 03:28:36,877 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.381455344966785879648767693
2025-07-22 03:28:36,907 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:28:36,907 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:28:36,931 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,931 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:28:36,955 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,955 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:28:36,980 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,980 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:28:37,009 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,009 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:28:37,037 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,037 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:28:37,061 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,061 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:28:37,087 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,087 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:28:37,121 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,121 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:28:37,320 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,328 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,334 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,386 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:28:37,389 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,390 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,400 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,718 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,737 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,747 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,752 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,766 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,782 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,790 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,791 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,795 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.650848462593192759516357793% which is below threshold 100.0%
2025-07-22 03:28:37,796 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '216.737000000000000000000000', 'margin': '5936.62', 'free_margin': '-5719.883000000000000000000000', 'profit_loss': '-6172.883000000000000000000000', 'margin_level': '3.650848462593192759516357793', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6172.883000000000000000000000', 'current_price': '118494.8200000000'}], 'margin_call': True}
2025-07-22 03:28:37,797 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,801 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.650848462593192759516357793
2025-07-22 03:28:37,814 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,814 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,820 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,820 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,826 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,827 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,828 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,844 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,844 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,845 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:28:37,845 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:28:37,845 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,858 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,858 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,930 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:28:38,306 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.59195019103390277481292044% which is below threshold 100.0%
2025-07-22 03:28:38,307 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '99011.71000000000000000000000', 'margin': '146484.47', 'free_margin': '-47472.76000000000000000000000', 'profit_loss': '-85334.10000000000000000000000', 'margin_level': '67.59195019103390277481292044', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.4000000000000000000000000', 'current_price': '38.8920000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85223.70000000000000000000000', 'current_price': '118498.2200000000'}], 'margin_call': True}
2025-07-22 03:28:38,311 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.59195019103390277481292044
2025-07-22 03:28:38,314 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:28:38,315 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:28:38,336 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:38,337 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:28:38,350 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:38,350 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:28:38,367 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:38,367 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:28:38,368 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:28:38,368 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:28:38,372 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:28:38,373 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:28:38,373 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:28:38,387 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:38,387 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:28:38,388 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:28:38,388 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:28:38,388 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:28:38,388 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:28:38,455 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:28:38,456 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:28:38,921 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:28:38,928 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:28:38,930 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:28:38,930 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:28:38,990 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:28:38,990 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:28:39,330 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:28:39,333 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:28:39,333 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:28:39,333 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:28:39,405 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:28:39,406 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:28:39,706 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:28:39,709 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:28:39,709 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:28:39,709 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:28:39,732 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:39,732 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:28:39,749 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:50,550 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:28:50,553 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:28:50,556 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:28:50,558 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:28:50,560 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:28:50,562 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:28:50,565 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:28:50,567 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:28:50,571 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:28:50,572 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:28:50,575 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:28:50,577 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:28:50,579 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:28:50,580 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:28:50,582 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:28:50,584 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:28:50,586 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:28:50,587 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:28:50,588 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:28:50,589 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:28:50,590 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:28:50,591 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:28:50,592 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:28:50,592 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:29:09,757 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:29:09,758 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:29:09,758 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:29:09,758 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:29:09,763 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:29:09,763 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:29:09,763 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:29:09,766 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:29:09,766 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:29:09,773 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:29:09,774 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:29:09,774 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:29:09,843 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:29:10,270 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:10,277 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:10,288 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:10,293 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:10,293 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349185'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349185'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349025'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349025'}], 'margin_call': False}
2025-07-22 03:29:10,296 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:29:10,298 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:29:10,298 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:29:10,344 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:10,344 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:29:10,387 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:10,388 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:29:10,427 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:10,427 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:29:10,586 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:29:10,978 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.160011950545364239054182614% which is below threshold 100.0%
2025-07-22 03:29:10,978 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '205.081686640944444067727652', 'margin': '9494.47', 'free_margin': '-9289.388313359055555932272348', 'profit_loss': '-9696.938313359055555932272348', 'margin_level': '2.160011950545364239054182614', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9619.682000000000000000000000', 'current_price': '118448.22'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.23301214459595993842940742', 'current_price': '96.076'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.023301214459595993842940742', 'current_price': '96.076'}], 'margin_call': True}
2025-07-22 03:29:10,981 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.160011950545364239054182614
2025-07-22 03:29:11,027 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:29:11,028 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:29:11,073 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,073 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:29:11,114 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,115 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:29:11,165 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,165 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:29:11,212 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,212 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:29:11,252 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,252 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:29:11,296 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,296 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:29:11,339 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,339 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:29:11,381 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,381 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:29:11,506 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:29:11,897 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.572352618156459399456256254% which is below threshold 100.0%
2025-07-22 03:29:11,897 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '212.077000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.543000000000000000000000', 'profit_loss': '-6177.543000000000000000000000', 'margin_level': '3.572352618156459399456256254', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.543000000000000000000000', 'current_price': '118448.22'}], 'margin_call': True}
2025-07-22 03:29:11,905 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.572352618156459399456256254
2025-07-22 03:29:11,960 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:29:11,960 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:29:12,231 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:29:12,608 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.38682605739707424275078443% which is below threshold 100.0%
2025-07-22 03:29:12,608 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98711.23500000000000000000000', 'margin': '146484.47', 'free_margin': '-47773.23500000000000000000000', 'profit_loss': '-85634.57500000000000000000000', 'margin_level': '67.38682605739707424275078443', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.875000000000000000000000', 'current_price': '38.8825'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85523.70000000000000000000000', 'current_price': '118448.22'}], 'margin_call': True}
2025-07-22 03:29:12,609 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.38682605739707424275078443
2025-07-22 03:29:12,610 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:29:12,611 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:29:12,636 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:12,636 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:29:12,657 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:12,657 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:29:12,682 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:12,682 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:29:12,683 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:12,683 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:29:12,696 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:29:12,698 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:29:12,698 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:29:12,721 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:12,721 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:29:12,721 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:12,721 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:29:12,722 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:12,722 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:29:12,801 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:29:12,802 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:29:13,120 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:29:13,121 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:29:13,122 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:29:13,122 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:29:13,209 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:29:13,210 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:29:13,636 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:29:13,638 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:29:13,638 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:29:13,638 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:29:13,773 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:29:13,774 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:29:14,098 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:29:14,100 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:29:14,101 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:29:14,101 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:29:14,137 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:14,137 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:29:14,161 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:33,450 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:29:33,753 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:29:44,177 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:29:44,178 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:29:44,178 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:29:44,178 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:29:44,190 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:29:44,191 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:29:44,191 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:29:44,197 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:29:44,198 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:29:44,211 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:29:44,213 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:29:44,213 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:29:44,275 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:29:44,603 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:44,628 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:44,637 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:44,643 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:44,643 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349215'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349215'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349055'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349055'}], 'margin_call': False}
2025-07-22 03:29:44,649 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:29:44,652 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:29:44,652 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:29:44,691 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:44,691 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:29:44,707 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:44,708 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:29:44,735 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:44,735 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:29:44,837 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:29:45,184 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.148359278073876552917890130% which is below threshold 100.0%
2025-07-22 03:29:45,185 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '203.975327148940787153823203', 'margin': '9494.47', 'free_margin': '-9290.494672851059212846176797', 'profit_loss': '-9698.044672851059212846176797', 'margin_level': '2.148359278073876552917890130', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9620.562000000000000000000000', 'current_price': '118446.02'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.43879350096292076925163425', 'current_price': '96.073'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.043879350096292076925163425', 'current_price': '96.073'}], 'margin_call': True}
2025-07-22 03:29:45,188 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.148359278073876552917890130
2025-07-22 03:29:45,216 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:29:45,216 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:29:45,246 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,247 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:29:45,277 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,277 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:29:45,319 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,319 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:29:45,337 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,337 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:29:45,358 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,358 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:29:45,376 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,376 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:29:45,412 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,412 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:29:45,444 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,444 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:29:45,592 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:29:45,994 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.582307777826439960785766985% which is below threshold 100.0%
2025-07-22 03:29:45,994 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '212.668000000000000000000000', 'margin': '5936.62', 'free_margin': '-5723.952000000000000000000000', 'profit_loss': '-6176.952000000000000000000000', 'margin_level': '3.582307777826439960785766985', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6176.952000000000000000000000', 'current_price': '118454.13'}], 'margin_call': True}
2025-07-22 03:29:45,999 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.582307777826439960785766985
2025-07-22 03:29:46,052 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:29:46,052 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:29:46,205 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:29:46,608 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.41106753500900129549569316% which is below threshold 100.0%
2025-07-22 03:29:46,609 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98746.74500000000000000000000', 'margin': '146484.47', 'free_margin': '-47737.72500000000000000000000', 'profit_loss': '-85599.06500000000000000000000', 'margin_level': '67.41106753500900129549569316', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.825000000000000000000000', 'current_price': '38.8835'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85488.24000000000000000000000', 'current_price': '118454.13'}], 'margin_call': True}
2025-07-22 03:29:46,617 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.41106753500900129549569316
2025-07-22 03:29:46,620 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:29:46,622 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:29:46,695 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:46,696 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:29:46,760 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:46,761 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:29:46,992 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:46,992 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:29:47,012 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:47,013 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:29:47,084 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:29:47,088 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:29:47,088 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:29:47,127 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:47,127 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:29:47,128 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:47,128 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:29:47,129 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:47,129 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:29:47,225 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:29:47,226 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:29:47,630 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:29:47,633 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:29:47,636 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:29:47,636 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:29:47,734 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:29:47,735 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:29:48,101 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:29:48,107 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:29:48,107 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:29:48,108 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:29:48,174 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:29:48,175 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:29:48,529 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:29:48,533 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:29:48,533 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:29:48,533 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:29:48,593 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:48,593 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:29:48,667 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:18,685 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:30:18,685 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:30:18,686 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:30:18,686 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:30:18,700 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:30:18,700 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:30:18,701 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:30:18,710 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:30:18,710 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:30:18,738 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:30:18,743 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:30:18,743 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:30:18,887 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:30:19,279 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:19,316 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:19,330 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:19,344 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:19,345 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3492250000000001'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3492250000000001'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349065'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349065'}], 'margin_call': False}
2025-07-22 03:30:19,347 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:30:19,349 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:30:19,349 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:30:19,381 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:19,381 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:30:19,417 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:19,417 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:30:19,450 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:19,450 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:30:19,551 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:30:19,851 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.206571063316008617538135862% which is below threshold 100.0%
2025-07-22 03:30:19,851 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '209.502227635219443389573048', 'margin': '9494.47', 'free_margin': '-9284.967772364780556610426952', 'profit_loss': '-9692.517772364780556610426952', 'margin_level': '2.206571063316008617538135862', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9615.406000000000000000000000', 'current_price': '118458.91'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.10161124070959691856995606', 'current_price': '96.078'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.010161124070959691856995606', 'current_price': '96.078'}], 'margin_call': True}
2025-07-22 03:30:19,853 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.206571063316008617538135862
2025-07-22 03:30:19,906 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:30:19,906 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:30:19,958 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:19,958 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:30:20,003 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,003 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:30:20,042 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,042 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:30:20,075 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,075 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:30:20,105 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,105 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:30:20,154 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,154 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:30:20,191 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,191 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:30:20,233 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,234 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:30:20,374 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:30:20,743 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.590359497491838790422833195% which is below threshold 100.0%
2025-07-22 03:30:20,743 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '213.146000000000000000000000', 'margin': '5936.62', 'free_margin': '-5723.474000000000000000000000', 'profit_loss': '-6176.474000000000000000000000', 'margin_level': '3.590359497491838790422833195', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6176.474000000000000000000000', 'current_price': '118458.91'}], 'margin_call': True}
2025-07-22 03:30:20,745 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.590359497491838790422833195
2025-07-22 03:30:20,778 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:30:20,779 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:30:20,931 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:30:21,319 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.43054400237786299120992143% which is below threshold 100.0%
2025-07-22 03:30:21,319 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98775.27500000000000000000000', 'margin': '146484.47', 'free_margin': '-47709.19500000000000000000000', 'profit_loss': '-85570.53500000000000000000000', 'margin_level': '67.43054400237786299120992143', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.975000000000000000000000', 'current_price': '38.8805'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85459.56000000000000000000000', 'current_price': '118458.91'}], 'margin_call': True}
2025-07-22 03:30:21,322 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.43054400237786299120992143
2025-07-22 03:30:21,324 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:30:21,324 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:30:21,372 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:21,373 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:30:21,447 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:21,448 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:30:21,512 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:21,512 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:30:21,513 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:21,513 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:30:21,577 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:30:21,585 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:30:21,585 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:30:21,622 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:21,622 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:30:21,623 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:21,624 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:30:21,624 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:21,625 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:30:21,737 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:30:21,738 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:30:22,032 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:30:22,038 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:30:22,041 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:30:22,042 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:30:22,164 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:30:22,166 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:30:22,704 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:30:22,707 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:30:22,708 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:30:22,708 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:30:22,876 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:30:22,877 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:30:23,194 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:30:23,197 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:30:23,197 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:30:23,197 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:30:23,246 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:23,246 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:30:23,287 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:31,793 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-22 03:30:31,798 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-22 03:30:31,814 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-22 03:30:31,953 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-22 03:30:31,957 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-22 03:30:31,958 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-22 03:30:31,965 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-22 03:30:31,974 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-22 03:30:31,978 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-22 03:30:31,986 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-22 03:30:31,993 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-22 03:30:31,995 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-22 03:30:32,623 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 30
2025-07-22 03:30:32,623 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-22 03:30:33,449 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:30:33,741 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:30:41,090 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 30 by invalidating refresh token.
2025-07-22 03:30:50,817 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 25
2025-07-22 03:30:50,817 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-22 03:30:53,291 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:30:53,292 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:30:53,292 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:30:53,292 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:30:53,302 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:30:53,302 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:30:53,303 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:30:53,310 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:30:53,310 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:30:53,327 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:30:53,331 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:30:53,331 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:30:53,512 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:30:53,891 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:53,895 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:53,899 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:53,903 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:53,904 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349235'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349235'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349075'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349075'}], 'margin_call': False}
2025-07-22 03:30:53,907 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:30:53,909 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:30:53,910 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:30:53,963 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:53,963 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:30:53,995 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:53,995 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:30:54,020 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,020 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:30:54,183 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:30:54,489 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.250792536208083200295235163% which is below threshold 100.0%
2025-07-22 03:30:54,489 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '213.700822112515597027071014', 'margin': '9494.47', 'free_margin': '-9280.769177887484402972928986', 'profit_loss': '-9688.319177887484402972928986', 'margin_level': '2.250792536208083200295235163', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9611.282000000000000000000000', 'current_price': '118469.22'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.03379807953127542993544187', 'current_price': '96.079'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.003379807953127542993544187', 'current_price': '96.079'}], 'margin_call': True}
2025-07-22 03:30:54,493 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.250792536208083200295235163
2025-07-22 03:30:54,612 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:30:54,612 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:30:54,647 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,647 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:30:54,691 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,691 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:30:54,735 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,736 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:30:54,778 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,778 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:30:54,810 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,810 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:30:54,842 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,843 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:30:54,880 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,880 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:30:54,912 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,912 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:30:55,041 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:30:55,336 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.607726281958420784891065960% which is below threshold 100.0%
2025-07-22 03:30:55,336 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '214.177000000000000000000000', 'margin': '5936.62', 'free_margin': '-5722.443000000000000000000000', 'profit_loss': '-6175.443000000000000000000000', 'margin_level': '3.607726281958420784891065960', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'swap': 'None', 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6175.443000000000000000000000', 'current_price': '118469.22'}], 'margin_call': True}
2025-07-22 03:30:55,339 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.607726281958420784891065960
2025-07-22 03:30:55,378 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:30:55,378 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:30:55,545 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:30:55,841 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.47147666916499728606042675% which is below threshold 100.0%
2025-07-22 03:30:55,841 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98835.23499999999970000000000', 'margin': '146484.47', 'free_margin': '-47649.23500000000030000000000', 'profit_loss': '-85510.57500000000030000000000', 'margin_level': '67.47147666916499728606042675', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.8750000000003000000000000', 'current_price': '38.842499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85397.70000000000000000000000', 'current_price': '118469.22'}], 'margin_call': True}
2025-07-22 03:30:55,846 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.47147666916499728606042675
2025-07-22 03:30:55,849 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:30:55,849 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:30:55,871 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:55,871 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:30:55,907 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:55,907 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:30:55,945 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:55,945 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:30:55,948 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:55,948 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:30:55,967 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:30:55,969 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:30:55,969 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:30:56,011 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:56,011 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:30:56,013 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:56,013 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:30:56,014 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:56,014 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:30:56,136 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:30:56,137 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:30:56,456 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:30:56,459 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:30:56,462 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:30:56,462 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:30:56,591 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:30:56,592 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:30:56,891 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:30:56,894 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:30:56,895 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:30:56,895 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:30:57,043 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:30:57,044 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:30:57,358 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:30:57,359 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:30:57,359 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:30:57,359 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:30:57,388 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:57,388 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:30:57,419 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:27,436 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:31:27,436 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:31:27,437 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:31:27,437 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:31:27,445 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:31:27,446 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:31:27,446 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:31:27,454 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:31:27,454 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:31:27,475 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:31:27,479 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:31:27,480 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:31:27,631 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:31:27,983 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:31:27,988 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:31:27,990 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:31:27,991 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:31:27,992 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349215'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349215'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349055'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349055'}], 'margin_call': False}
2025-07-22 03:31:27,994 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:31:27,995 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:31:27,996 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:31:28,037 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,037 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:31:28,085 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,085 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:31:28,133 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,133 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:31:28,275 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:31:28,600 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.145383808812030550700260404% which is below threshold 100.0%
2025-07-22 03:31:28,601 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '203.692822112515597027071014', 'margin': '9494.47', 'free_margin': '-9290.777177887484402972928986', 'profit_loss': '-9698.327177887484402972928986', 'margin_level': '2.145383808812030550700260404', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9621.290000000000000000000000', 'current_price': '118444.2'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.03379807953127542993544187', 'current_price': '96.079'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.003379807953127542993544187', 'current_price': '96.079'}], 'margin_call': True}
2025-07-22 03:31:28,603 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.145383808812030550700260404
2025-07-22 03:31:28,663 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:31:28,663 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:31:28,734 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,734 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:31:28,779 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,779 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:31:28,827 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,827 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:31:28,868 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,868 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:31:28,906 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,907 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:31:28,940 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,940 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:31:28,977 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,977 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:31:29,021 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:29,022 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:31:29,125 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:31:29,438 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.565581088228655362815878395% which is below threshold 100.0%
2025-07-22 03:31:29,439 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '211.675000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.945000000000000000000000', 'profit_loss': '-6177.945000000000000000000000', 'margin_level': '3.565581088228655362815878395', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.945000000000000000000000', 'current_price': '118444.2'}], 'margin_call': True}
2025-07-22 03:31:29,447 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.565581088228655362815878395
2025-07-22 03:31:29,506 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:31:29,507 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:31:29,638 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:31:30,029 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.36896068231669869167700849% which is below threshold 100.0%
2025-07-22 03:31:30,030 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98685.06499999999980000000000', 'margin': '146484.47', 'free_margin': '-47799.40500000000020000000000', 'profit_loss': '-85660.74500000000020000000000', 'margin_level': '67.36896068231669869167700849', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.9250000000002000000000000', 'current_price': '38.841499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85547.82000000000000000000000', 'current_price': '118444.2'}], 'margin_call': True}
2025-07-22 03:31:30,034 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.36896068231669869167700849
2025-07-22 03:31:30,035 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:31:30,035 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:31:30,068 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:30,068 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:31:30,103 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:30,103 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:31:30,144 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:30,145 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:31:30,148 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:31:30,148 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:31:30,177 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:31:30,179 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:31:30,179 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:31:30,219 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:30,219 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:31:30,220 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:31:30,221 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:31:30,222 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:31:30,222 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:31:30,335 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:31:30,339 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:31:30,633 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:31:30,636 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:31:30,638 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:31:30,638 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:31:30,769 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:31:30,770 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:31:31,136 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:31:31,142 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:31:31,142 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:31:31,142 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:31:31,259 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:31:31,260 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:31:31,563 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:31:31,574 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:31:31,574 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:31:31,574 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:31:31,650 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:31,650 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:31:31,683 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:33,453 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:31:33,815 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:31:43,748 - INFO - app - Application shutdown initiated
2025-07-22 03:31:43,757 - INFO - app - Scheduler shutdown completed
2025-07-22 03:31:43,824 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 03:31:46,028 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 03:31:46,028 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 03:31:46,041 - INFO - app - Redis connection closed
2025-07-22 03:31:46,042 - INFO - app - Application shutdown completed
2025-07-22 03:40:09,619 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:09,663 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:09,681 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:09,681 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:10,079 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:40:10,079 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:40:10,079 - INFO - app - Environment: PRODUCTION
2025-07-22 03:40:10,150 - INFO - app - Application startup initiated
2025-07-22 03:40:10,150 - INFO - app - Initializing core services...
2025-07-22 03:40:10,202 - INFO - app - Firebase initialized
2025-07-22 03:40:10,202 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:40:10,234 - INFO - app - Redis initialized
2025-07-22 03:40:10,964 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:40:10,968 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:40:10,974 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:40:10,974 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:40:10,974 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:40:10,975 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:40:10,975 - INFO - app - Scheduler initialized
2025-07-22 03:40:10,977 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:40:10,977 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:40:12,264 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:40:12,272 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:40:12,308 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:40:12,308 - INFO - app - Background tasks initialized
2025-07-22 03:40:12,308 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:40:13,077 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:40:13,078 - INFO - app - Application startup completed successfully
2025-07-22 03:40:13,078 - INFO - app - Starting cache validation task
2025-07-22 03:40:13,081 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:40:13,087 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:40:13,089 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:40:13,089 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:40:13,089 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:40:13,089 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:40:13,089 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:40:13,119 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:40:13,120 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:40:13,120 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:40:13,120 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:40:13,123 - INFO - app - Validating cache for 30 users
2025-07-22 03:40:13,138 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:40:13,154 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,158 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:40:13,159 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:40:13,166 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:40:13,168 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:40:13,171 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:40:13,177 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,178 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:40:13,186 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:40:13,190 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:40:13,192 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:40:13,194 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:40:13,195 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:40:13,196 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:40:13,197 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:40:13,198 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:40:13,198 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:40:13,198 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:40:13,199 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:40:13,200 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:40:13,200 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,201 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:40:13,202 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:40:13,203 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:40:13,205 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:40:13,209 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:40:13,210 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:40:13,211 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:40:13,211 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:40:13,213 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,223 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,235 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,242 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,252 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,260 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,270 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,276 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,285 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,293 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,300 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,309 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,316 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,325 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,335 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,344 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,391 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,408 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:40:13,411 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,718 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:13,720 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:13,721 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:13,722 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,722 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:13,722 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3491500000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3491500000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3491400000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3491400000'}], 'margin_call': False}
2025-07-22 03:40:13,724 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:40:13,726 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:40:13,726 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:40:13,731 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,742 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,748 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:13,748 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:40:13,750 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,764 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,774 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:13,775 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:40:13,780 - INFO - app - Cache validation completed
2025-07-22 03:40:13,803 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:13,803 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:40:14,031 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:40:14,358 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.366476529998692772101292563% which is below threshold 100.0%
2025-07-22 03:40:14,358 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '224.684404197766885639325592', 'margin': '9494.47', 'free_margin': '-9269.785595802233114360674408', 'profit_loss': '-9677.335595802233114360674408', 'margin_level': '2.366476529998692772101292563', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9601.290000000000000000000000', 'current_price': '118494.2000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.13235982021192214606764425', 'current_price': '96.0920000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.913235982021192214606764425', 'current_price': '96.0920000000'}], 'margin_call': True}
2025-07-22 03:40:14,360 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.366476529998692772101292563
2025-07-22 03:40:14,389 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:40:14,389 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:40:14,413 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,413 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:40:14,438 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,438 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:40:14,459 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,459 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:40:14,483 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,483 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:40:14,507 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,507 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:40:14,533 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,533 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:40:14,557 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,557 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:40:14,581 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,581 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:40:14,774 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:40:14,929 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,933 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,935 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,941 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,947 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,947 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,997 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:15,061 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.649804097280944375755901506% which is below threshold 100.0%
2025-07-22 03:40:15,061 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '216.675000000000000000000000', 'margin': '5936.62', 'free_margin': '-5719.945000000000000000000000', 'profit_loss': '-6172.945000000000000000000000', 'margin_level': '3.649804097280944375755901506', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6172.945000000000000000000000', 'current_price': '118494.2000000000'}], 'margin_call': True}
2025-07-22 03:40:15,063 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.649804097280944375755901506
2025-07-22 03:40:15,116 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:40:15,116 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:40:15,234 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,236 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,246 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,257 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,260 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,262 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,263 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,263 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,263 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,267 - INFO - app.core.config - .env file loaded successfully.
t: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,267 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,274 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,274 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,280 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,280 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,283 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,283 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,305 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,319 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,319 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,323 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:40:15,600 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.57418721588711759000800563% which is below threshold 100.0%
2025-07-22 03:40:15,600 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98985.69000000000000000000000', 'margin': '146484.47', 'free_margin': '-47498.78000000000000000000000', 'profit_loss': '-85360.12000000000000000000000', 'margin_level': '67.57418721588711759000800563', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.3000000000000000000000000', 'current_price': '38.8540000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85247.82000000000000000000000', 'current_price': '118494.2000000000'}], 'margin_call': True}
2025-07-22 03:40:15,610 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.57418721588711759000800563
2025-07-22 03:40:15,612 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:40:15,612 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:40:15,634 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:15,634 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:40:15,646 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:15,646 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:40:15,666 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:15,666 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:40:15,667 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:15,667 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:40:15,671 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:40:15,672 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:40:15,672 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:40:15,686 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:15,686 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:40:15,686 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:15,686 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:40:15,687 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:15,687 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:40:15,762 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:40:15,763 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:40:16,183 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:40:16,186 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:40:16,187 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:40:16,187 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:40:16,363 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:40:16,365 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:40:16,664 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:40:16,666 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:40:16,666 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:40:16,666 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:40:16,747 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:40:16,748 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:40:17,037 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:40:17,040 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:40:17,041 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:40:17,041 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:40:17,096 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:17,096 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:40:17,129 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:18,138 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 25 by invalidating refresh token.
2025-07-22 03:40:26,352 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 30
2025-07-22 03:40:26,353 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-22 03:40:28,083 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:40:28,087 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:40:28,091 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:40:28,094 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:40:28,099 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:40:28,104 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:40:28,110 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:40:28,113 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:40:28,120 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:40:28,123 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:40:28,130 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:40:28,134 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:40:28,136 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:40:28,139 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:40:28,143 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:40:28,147 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:40:28,153 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:40:28,157 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:40:28,160 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:40:28,164 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:40:28,169 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:40:28,173 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:40:28,177 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:40:28,177 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:40:47,130 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:40:47,130 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:40:47,131 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:40:47,131 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:40:47,142 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:40:47,142 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:40:47,142 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:40:47,148 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:40:47,149 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:40:47,159 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:40:47,164 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:40:47,164 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:40:47,285 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:40:47,582 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:47,584 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:47,588 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:47,591 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:47,591 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.348695'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.348695'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.348535'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.348535'}], 'margin_call': False}
2025-07-22 03:40:47,593 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:40:47,594 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:40:47,595 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:40:47,639 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:47,639 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:40:47,682 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:47,683 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:40:47,716 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:47,717 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:40:47,827 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:40:48,212 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.171843018374062441103939209% which is below threshold 100.0%
2025-07-22 03:40:48,213 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '301.149683826619846251881177', 'margin': '9494.47', 'free_margin': '-9193.320316173380153748118823', 'profit_loss': '-9600.870316173380153748118823', 'margin_level': '3.171843018374062441103939209', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9524.530000000000000000000000', 'current_price': '118686.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.40028743034559431647165693', 'current_price': '96.088'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.940028743034559431647165693', 'current_price': '96.088'}], 'margin_call': True}
2025-07-22 03:40:48,217 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.171843018374062441103939209
2025-07-22 03:40:48,254 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:40:48,254 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:40:48,317 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,317 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:40:48,363 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,363 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:40:48,412 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,412 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:40:48,452 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,452 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:40:48,485 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,485 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:40:48,502 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,503 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:40:48,519 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,519 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:40:48,540 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,540 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:40:48,694 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:40:49,030 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.973052006023629607419710205% which is below threshold 100.0%
2025-07-22 03:40:49,030 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '235.865000000000000000000000', 'margin': '5936.62', 'free_margin': '-5700.755000000000000000000000', 'profit_loss': '-6153.755000000000000000000000', 'margin_level': '3.973052006023629607419710205', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6153.755000000000000000000000', 'current_price': '118686.1'}], 'margin_call': True}
2025-07-22 03:40:49,032 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.973052006023629607419710205
2025-07-22 03:40:49,073 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:40:49,073 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:40:49,256 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:40:49,632 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.36002137291413874795055066% which is below threshold 100.0%
2025-07-22 03:40:49,633 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100136.8149999999997000000000', 'margin': '146484.47', 'free_margin': '-46347.6550000000003000000000', 'profit_loss': '-84208.99500000000030000000000', 'margin_level': '68.36002137291413874795055066', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.5750000000003000000000000', 'current_price': '38.848499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84096.42000000000000000000000', 'current_price': '118686.1'}], 'margin_call': True}
2025-07-22 03:40:49,635 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.36002137291413874795055066
2025-07-22 03:40:49,642 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:40:49,644 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:40:49,707 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:49,707 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:40:49,742 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:49,742 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:40:49,779 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:49,780 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:40:49,781 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:49,781 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:40:49,794 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:40:49,797 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:40:49,797 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:40:49,836 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:49,836 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:40:49,837 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:49,838 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:40:49,839 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:49,839 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:40:49,998 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:40:49,999 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:40:50,351 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:40:50,358 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:40:50,364 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:40:50,364 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:40:51,791 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:40:51,793 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:40:52,194 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:40:52,200 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:40:52,200 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:40:52,200 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:40:52,329 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:40:52,331 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:40:52,704 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:40:53,012 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:40:53,012 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:40:53,012 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:40:53,062 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:53,063 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:40:53,098 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:10,983 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:41:11,339 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:41:23,111 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:41:23,111 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:41:23,111 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:41:23,112 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:41:23,126 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:41:23,127 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:41:23,127 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:41:23,133 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:41:23,133 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:41:23,148 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:41:23,153 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:41:23,153 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:41:23,314 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:41:23,641 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:23,646 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:23,648 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:23,651 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:23,651 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.348725'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.348725'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.348565'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.348565'}], 'margin_call': False}
2025-07-22 03:41:23,653 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:41:23,654 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:41:23,654 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:41:23,694 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:23,694 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:41:23,719 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:23,719 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:41:23,743 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:23,743 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:41:23,792 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:41:24,109 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.197406342645892650850323030% which is below threshold 100.0%
2025-07-22 03:41:24,110 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '303.576785980611483967188665', 'margin': '9494.47', 'free_margin': '-9190.893214019388516032811335', 'profit_loss': '-9598.443214019388516032811335', 'margin_level': '3.197406342645892650850323030', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9522.250000000000000000000000', 'current_price': '118691.8'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.26655819944410548437394075', 'current_price': '96.09'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.926655819944410548437394075', 'current_price': '96.09'}], 'margin_call': True}
2025-07-22 03:41:24,113 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.197406342645892650850323030
2025-07-22 03:41:24,164 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:41:24,164 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:41:24,240 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,241 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:41:24,351 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,351 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:41:24,389 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,389 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:41:24,424 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,424 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:41:24,455 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,455 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:41:24,500 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,500 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:41:24,529 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,529 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:41:24,565 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,565 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:41:24,698 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:41:25,062 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.982653429055590554894872840% which is below threshold 100.0%
2025-07-22 03:41:25,063 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '236.435000000000000000000000', 'margin': '5936.62', 'free_margin': '-5700.185000000000000000000000', 'profit_loss': '-6153.185000000000000000000000', 'margin_level': '3.982653429055590554894872840', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6153.185000000000000000000000', 'current_price': '118691.8'}], 'margin_call': True}
2025-07-22 03:41:25,070 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.982653429055590554894872840
2025-07-22 03:41:25,119 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:41:25,119 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:41:25,342 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:41:25,685 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.38323202452792435949012206% which is below threshold 100.0%
2025-07-22 03:41:25,685 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100170.8150000000000000000000', 'margin': '146484.47', 'free_margin': '-46313.6550000000000000000000', 'profit_loss': '-84174.99500000000000000000000', 'margin_level': '68.38323202452792435949012206', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.775000000000000000000000', 'current_price': '38.8445'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84062.22000000000000000000000', 'current_price': '118691.8'}], 'margin_call': True}
2025-07-22 03:41:25,688 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.38323202452792435949012206
2025-07-22 03:41:25,690 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:41:25,691 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:41:25,731 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:25,732 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:41:25,755 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:25,756 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:41:25,777 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:25,777 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:41:25,778 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:25,778 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:41:25,782 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:41:25,783 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:41:25,783 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:41:25,802 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:25,802 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:41:25,803 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:25,803 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:41:25,804 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:25,804 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:41:25,852 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:41:25,852 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:41:26,191 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:41:26,195 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:41:26,197 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:41:26,197 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:41:26,442 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:41:26,443 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:41:26,753 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:41:26,771 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:41:26,771 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:41:26,772 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:41:26,944 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:41:26,945 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:41:27,316 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:41:27,319 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:41:27,319 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:41:27,319 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:41:27,370 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:27,371 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:41:27,407 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:54,212 - INFO - app - [BarclaysMarginChecker] User 30: free_margin=10000.0, total_pending_margin=237515.95, num_pending_orders=1
2025-07-22 03:41:54,212 - INFO - app - [BarclaysMarginChecker] Considering cancellation: user 30, order 1194-001, order_margin=237515.95, free_margin=10000.0, total_pending_margin=237515.95
2025-07-22 03:41:54,217 - WARNING - app - [BarclaysMarginChecker] Cancelling order 1194-001 for user 30 (order_margin=237515.95) due to insufficient margin.
2025-07-22 03:41:54,598 - INFO - app - [BarclaysMarginChecker] Created rejected order record: order_id=1194-001, rejected_id=1197-002
2025-07-22 03:41:54,655 - INFO - app - [BarclaysMarginChecker] Successfully cancelled order 1194-001 for user 30
2025-07-22 03:41:57,425 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:41:57,426 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:41:57,426 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:41:57,426 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:41:57,439 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:41:57,439 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:41:57,440 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:41:57,449 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:41:57,449 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:41:57,487 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:41:57,491 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:41:57,491 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:41:57,617 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:41:57,911 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:57,914 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:57,919 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:57,924 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:57,924 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.348705'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.348705'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3485449999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3485449999999999'}], 'margin_call': False}
2025-07-22 03:41:57,928 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:41:57,930 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:41:57,932 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:41:57,995 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:57,996 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:41:58,057 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,057 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:41:58,109 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,109 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:41:58,246 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:41:58,537 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.157898058834456754846570446% which is below threshold 100.0%
2025-07-22 03:41:58,537 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '299.825683826619846251881177', 'margin': '9494.47', 'free_margin': '-9194.644316173380153748118823', 'profit_loss': '-9602.194316173380153748118823', 'margin_level': '3.157898058834456754846570446', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9525.854000000000000000000000', 'current_price': '118682.79'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.40028743034559431647165693', 'current_price': '96.088'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.940028743034559431647165693', 'current_price': '96.088'}], 'margin_call': True}
2025-07-22 03:41:58,540 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.157898058834456754846570446
2025-07-22 03:41:58,609 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:41:58,609 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:41:58,664 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,664 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:41:58,703 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,703 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:41:58,739 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,739 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:41:58,760 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,761 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:41:58,784 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,784 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:41:58,802 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,802 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:41:58,819 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,819 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:41:58,841 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,841 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:41:58,926 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:41:59,207 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.967476442824368074763080676% which is below threshold 100.0%
2025-07-22 03:41:59,207 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '235.534000000000000000000000', 'margin': '5936.62', 'free_margin': '-5701.086000000000000000000000', 'profit_loss': '-6154.086000000000000000000000', 'margin_level': '3.967476442824368074763080676', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6154.086000000000000000000000', 'current_price': '118682.79'}], 'margin_call': True}
2025-07-22 03:41:59,212 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.967476442824368074763080676
2025-07-22 03:41:59,303 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:41:59,303 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:41:59,422 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:41:59,717 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.34636122177320210121933062% which is below threshold 100.0%
2025-07-22 03:41:59,718 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100116.8049999999997000000000', 'margin': '146484.47', 'free_margin': '-46367.6650000000003000000000', 'profit_loss': '-84229.00500000000030000000000', 'margin_level': '68.34636122177320210121933062', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.7250000000003000000000000', 'current_price': '38.845499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84116.28000000000000000000000', 'current_price': '118682.79'}], 'margin_call': True}
2025-07-22 03:41:59,722 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.34636122177320210121933062
2025-07-22 03:41:59,724 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:41:59,724 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:41:59,773 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:59,773 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:41:59,812 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:59,812 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:41:59,844 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:59,844 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:41:59,846 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:59,846 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:41:59,857 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:41:59,860 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:41:59,860 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:41:59,892 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:59,893 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:41:59,894 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:59,894 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:41:59,895 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:59,895 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:42:00,067 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:42:00,068 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:42:00,398 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:42:00,401 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:42:00,404 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:42:00,404 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:42:00,553 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:42:00,554 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:42:00,899 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:42:00,903 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:42:00,904 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:42:00,904 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:42:01,094 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:42:01,095 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:42:01,405 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:42:01,407 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:42:01,407 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:42:01,407 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:42:01,519 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:01,519 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:42:01,560 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:10,985 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:42:11,272 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:42:31,584 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:42:31,584 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:42:31,584 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:42:31,584 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:42:31,619 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:42:31,619 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:42:31,620 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:42:31,632 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:42:31,632 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:42:31,667 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:42:31,685 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:42:31,686 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:42:31,884 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:42:32,250 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:42:32,253 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:42:32,255 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:42:32,256 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:42:32,257 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.348715'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.348715'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.348555'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.348555'}], 'margin_call': False}
2025-07-22 03:42:32,258 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:42:32,259 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:42:32,259 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:42:32,293 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:32,294 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:42:32,325 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:32,325 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:42:32,364 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:32,364 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:42:32,490 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:42:32,854 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.097595263559233259105083664% which is below threshold 100.0%
2025-07-22 03:42:32,854 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '294.100253020052334015754437', 'margin': '9494.47', 'free_margin': '-9200.369746979947665984245563', 'profit_loss': '-9607.919746979947665984245563', 'margin_level': '3.097595263559233259105083664', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9531.654000000000000000000000', 'current_price': '118668.29'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.33249725449787816749596648', 'current_price': '96.089'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.933249725449787816749596648', 'current_price': '96.089'}], 'margin_call': True}
2025-07-22 03:42:32,860 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.097595263559233259105083664
2025-07-22 03:42:32,931 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:42:32,931 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:42:33,023 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,023 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:42:33,087 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,087 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:42:33,143 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,144 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:42:33,204 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,204 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:42:33,275 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,275 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:42:33,331 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,331 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:42:33,383 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,383 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:42:33,441 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,442 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:42:33,635 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:42:33,937 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.943051770199204261010473973% which is below threshold 100.0%
2025-07-22 03:42:33,938 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '234.084000000000000000000000', 'margin': '5936.62', 'free_margin': '-5702.536000000000000000000000', 'profit_loss': '-6155.536000000000000000000000', 'margin_level': '3.943051770199204261010473973', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6155.536000000000000000000000', 'current_price': '118668.29'}], 'margin_call': True}
2025-07-22 03:42:33,945 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.943051770199204261010473973
2025-07-22 03:42:34,022 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:42:34,022 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:42:34,124 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:42:34,488 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.28690099366847557287130847% which is below threshold 100.0%
2025-07-22 03:42:34,489 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100029.7050000000000000000000', 'margin': '146484.47', 'free_margin': '-46454.7650000000000000000000', 'profit_loss': '-84316.10500000000000000000000', 'margin_level': '68.28690099366847557287130847', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.825000000000000000000000', 'current_price': '38.8435'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84203.28000000000000000000000', 'current_price': '118668.29'}], 'margin_call': True}
2025-07-22 03:42:34,492 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.28690099366847557287130847
2025-07-22 03:42:34,498 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:42:34,499 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:42:34,907 - INFO - app - Application shutdown initiated
2025-07-22 03:42:34,907 - INFO - app - Scheduler shutdown completed
2025-07-22 03:42:35,782 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 03:42:36,128 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 03:42:36,128 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 03:42:36,131 - INFO - app - Redis connection closed
2025-07-22 03:42:36,132 - INFO - app - Application shutdown completed
