2025-07-14 22:43:29,218 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 22:43:30,353 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 22:43:30,353 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 22:43:30,353 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 22:43:30,353 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 22:43:34,465 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 22:43:34,465 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 22:43:35,358 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 22:43:40,367 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 22:43:43,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:43:43,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:43:43,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:43:43,451 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:43:47,621 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-14 22:43:47,621 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:43:47,621 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-14 22:43:47,622 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-14 22:43:47,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDCAD
2025-07-14 22:43:47,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:47,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('900')], HighestMarginPerLot=900
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=9.00
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 10, Symbol AUDJPY
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95777'), Decimal('658.76335'), Decimal('658.70886')], HighestMarginPerLot=95777
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=1915.54
2025-07-14 22:43:47,686 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 1924.54
2025-07-14 22:43:47,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 11, Symbol AUDJPY
2025-07-14 22:43:47,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:43:47,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717'), Decimal('655.714237')], HighestMarginPerLot=96717
2025-07-14 22:43:47,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-14 22:43:47,744 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-14 22:43:48,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-14 22:43:48,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-14 22:43:48,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-14 22:43:48,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-14 22:43:48,027 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-14 22:43:48,140 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 19, Symbol AUDJPY
2025-07-14 22:43:48,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 19, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 19, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.751744')], HighestMarginPerLot=654.751744
2025-07-14 22:43:48,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 19, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:43:48,141 - INFO - orders - [TOTAL_USER_MARGIN] User 19 total margin across all symbols: 6.55
2025-07-14 22:43:48,164 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol EURUSD
2025-07-14 22:43:48,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180')], HighestMarginPerLot=1180
2025-07-14 22:43:48,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=11.80
2025-07-14 22:43:48,204 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 18.38
2025-07-14 22:43:48,314 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDSGD
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.353812')], HighestMarginPerLot=780.353812
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDSGD: CalculatedTotalMargin=7.80
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=4.00000000, TotalSellQty=0, NetQty=4.00000000, IsHedged=False
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24466.1075')], HighestMarginPerLot=24466.1075
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=97864.43
2025-07-14 22:43:48,565 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 97915.37
2025-07-14 22:43:48,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-14 22:43:48,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-14 22:43:48,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:43:48,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-14 22:43:48,624 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 19.76
2025-07-14 22:43:48,643 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-14 22:43:49,274 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-14 22:44:37,516 - INFO - orders - Starting update_user_static_orders for user 11, user_type live
2025-07-14 22:44:37,516 - INFO - orders - Using order model: UserOrder
2025-07-14 22:44:37,949 - INFO - orders - Fetched 2 open orders for user 11
2025-07-14 22:44:38,047 - INFO - orders - Fetched 0 pending orders for user 11
2025-07-14 22:44:38,048 - INFO - orders - Updated static orders cache for user 11 with 2 open orders and 0 pending orders
2025-07-14 22:44:38,190 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 11, Symbol AUDJPY
2025-07-14 22:44:38,190 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:44:38,190 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717'), Decimal('655.714237')], HighestMarginPerLot=96717
2025-07-14 22:44:38,190 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-14 22:44:38,190 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-14 22:44:38,193 - INFO - orders - User 11: Updated balance/margin cache after static orders update - balance=14420.65000000, margin=967.17
2025-07-14 22:44:38,325 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 11, Symbol AUDJPY
2025-07-14 22:44:38,325 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:44:38,326 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717'), Decimal('655.714237')], HighestMarginPerLot=96717
2025-07-14 22:44:38,326 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-14 22:44:38,326 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-14 22:45:36,439 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-14 22:45:41,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:41,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-14 22:45:41,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:41,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-14 22:45:41,108 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 19.76
2025-07-14 22:45:55,038 - INFO - orders - Order close request received - Order ID: 9615167363, User ID: 1, Close Price: 96.608
2025-07-14 22:45:55,038 - INFO - orders - Request to close order 9615167363 for user 1 (user_type: demo) with price 96.608. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-14 22:45:55,477 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-14 22:45:55,717 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:55,717 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-14 22:45:55,717 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.18
2025-07-14 22:45:55,896 - INFO - orders - Existing entry commission for order 9615167363: 0.10000000
2025-07-14 22:45:55,896 - INFO - orders - Commission calculation for order 9615167363: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-14 22:45:55,896 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -153.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 9615167363)
2025-07-14 22:45:55,896 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:45:57,956 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:45:57,956 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:45:57,956 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:45:57,967 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5730000000'), 'o': Decimal('147.5690000000')}
2025-07-14 22:45:57,967 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5730000000
2025-07-14 22:45:57,967 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -153.000000000000000000000000 JPY / 147.5730000000 = -1.036775019820698908336890895 USD
2025-07-14 22:45:58,603 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=17024.33000000, margin=13.18
2025-07-14 22:45:58,603 - INFO - orders - Setting user data cache for user 1 with wallet_balance=17024.33000000, margin=13.18
2025-07-14 22:45:58,606 - INFO - orders - User data cache updated for user 1
2025-07-14 22:45:58,609 - INFO - orders - Balance/margin cache updated for user 1: balance=17024.33000000, margin=13.18
2025-07-14 22:45:58,609 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-14 22:45:58,609 - INFO - orders - Using order model: DemoUserOrder
2025-07-14 22:45:58,723 - INFO - orders - Fetched 2 open orders for user 1
2025-07-14 22:45:58,824 - INFO - orders - Fetched 0 pending orders for user 1
2025-07-14 22:45:58,826 - INFO - orders - Updated static orders cache for user 1 with 2 open orders and 0 pending orders
2025-07-14 22:45:58,927 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:58,928 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:45:58,928 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:58,928 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.18
2025-07-14 22:45:58,928 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.18
2025-07-14 22:45:58,932 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=17024.33000000, margin=13.18
2025-07-14 22:45:58,933 - INFO - orders - Publishing order update for user 1
2025-07-14 22:45:58,934 - INFO - orders - Publishing user data update for user 1
2025-07-14 22:45:58,935 - INFO - orders - Publishing market data trigger
2025-07-14 22:45:59,625 - INFO - orders - Order close request received - Order ID: 9418776886, User ID: 1, Close Price: 96.61
2025-07-14 22:45:59,625 - INFO - orders - Request to close order 9418776886 for user 1 (user_type: demo) with price 96.61. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-14 22:45:59,857 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.18
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:45:59,978 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104')], HighestMarginPerLot=658.782104
2025-07-14 22:45:59,978 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.59
2025-07-14 22:46:00,157 - INFO - orders - Existing entry commission for order 9418776886: 0.10000000
2025-07-14 22:46:00,157 - INFO - orders - Commission calculation for order 9418776886: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-14 22:46:00,157 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -157.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 9418776886)
2025-07-14 22:46:00,157 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:46:00,158 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:46:00,158 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:46:00,159 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:46:00,159 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5760000000'), 'o': Decimal('147.5720000000')}
2025-07-14 22:46:00,159 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5760000000
2025-07-14 22:46:00,159 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -157.000000000000000000000000 JPY / 147.5760000000 = -1.063858621998156881877812110 USD
2025-07-14 22:46:01,052 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=17023.07000000, margin=6.59
2025-07-14 22:46:01,053 - INFO - orders - Setting user data cache for user 1 with wallet_balance=17023.07000000, margin=6.59
2025-07-14 22:46:01,054 - INFO - orders - User data cache updated for user 1
2025-07-14 22:46:01,056 - INFO - orders - Balance/margin cache updated for user 1: balance=17023.07000000, margin=6.59
2025-07-14 22:46:01,056 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-14 22:46:01,056 - INFO - orders - Using order model: DemoUserOrder
2025-07-14 22:46:01,090 - INFO - orders - Fetched 1 open orders for user 1
2025-07-14 22:46:01,124 - INFO - orders - Fetched 0 pending orders for user 1
2025-07-14 22:46:01,126 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 0 pending orders
2025-07-14 22:46:01,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:01,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:01,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104')], HighestMarginPerLot=658.782104
2025-07-14 22:46:01,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.59
2025-07-14 22:46:01,160 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.59
2025-07-14 22:46:01,164 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=17023.07000000, margin=6.59
2025-07-14 22:46:01,164 - INFO - orders - Publishing order update for user 1
2025-07-14 22:46:01,164 - INFO - orders - Publishing user data update for user 1
2025-07-14 22:46:01,165 - INFO - orders - Publishing market data trigger
2025-07-14 22:46:01,897 - INFO - orders - Order close request received - Order ID: 2227099351, User ID: 1, Close Price: 96.605
2025-07-14 22:46:01,897 - INFO - orders - Request to close order 2227099351 for user 1 (user_type: demo) with price 96.605. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-14 22:46:02,615 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-14 22:46:02,852 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:02,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:02,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104')], HighestMarginPerLot=658.782104
2025-07-14 22:46:02,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.59
2025-07-14 22:46:02,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-14 22:46:02,918 - INFO - orders - Existing entry commission for order 2227099351: 0.10000000
2025-07-14 22:46:02,918 - INFO - orders - Commission calculation for order 2227099351: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -162.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 2227099351)
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:46:02,919 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5770000000'), 'o': Decimal('147.5710000000')}
2025-07-14 22:46:02,919 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5770000000
2025-07-14 22:46:02,919 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -162.000000000000000000000000 JPY / 147.5770000000 = -1.097732031414109244665496656 USD
2025-07-14 22:46:03,524 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=17021.77000000, margin=0
2025-07-14 22:46:03,524 - INFO - orders - Setting user data cache for user 1 with wallet_balance=17021.77000000, margin=0
2025-07-14 22:46:03,525 - INFO - orders - User data cache updated for user 1
2025-07-14 22:46:03,528 - INFO - orders - Balance/margin cache updated for user 1: balance=17021.77000000, margin=0
2025-07-14 22:46:03,528 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-14 22:46:03,528 - INFO - orders - Using order model: DemoUserOrder
2025-07-14 22:46:03,570 - INFO - orders - Fetched 0 open orders for user 1
2025-07-14 22:46:03,637 - INFO - orders - Fetched 0 pending orders for user 1
2025-07-14 22:46:03,638 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 0 pending orders
2025-07-14 22:46:03,702 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=17021.77000000, margin=0.0
2025-07-14 22:46:03,702 - INFO - orders - Publishing order update for user 1
2025-07-14 22:46:03,703 - INFO - orders - Publishing user data update for user 1
2025-07-14 22:46:03,704 - INFO - orders - Publishing market data trigger
2025-07-14 22:46:14,969 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-14 22:46:15,452 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.6620000000', 'o': '96.6560000000'}
2025-07-14 22:46:15,453 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.6620000000, ask=96.67166620000000
2025-07-14 22:46:15,453 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.6620000000, ask=96.67166620000000
2025-07-14 22:46:15,453 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 966.72 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5750000000'), 'o': Decimal('147.5720000000')}
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5750000000
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 966.72 JPY / 147.5750000000 = 6.550703032356428934440115196 USD
2025-07-14 22:46:15,454 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 96.67166620000000, Margin: 6.550703032356428934440115196, Commission: 0.10
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.550703032356428934440115196
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.550703032356428934440115196
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.0703032356428934440115196')], HighestMarginPerLot=655.0703032356428934440115196
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.55, AdditionalMargin: 6.55, OpenOrders: 0
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.550703032356428934440115196
2025-07-14 22:46:15,733 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=17021.77000000, margin=6.55000000 (was 0E-8)
2025-07-14 22:46:15,733 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-14 22:46:15,733 - INFO - orders - [PERF] Order processing: 0.7628s
2025-07-14 22:46:16,231 - INFO - orders - [PERF] Order creation: 0.4976s
2025-07-14 22:46:16,231 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-14 22:46:16,231 - INFO - orders - [PERF] TOTAL place_order: 1.2629s
2025-07-14 22:46:16,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:16,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:16,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303')], HighestMarginPerLot=655.070303
2025-07-14 22:46:16,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:16,744 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-14 22:46:17,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:17,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:17,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303')], HighestMarginPerLot=655.070303
2025-07-14 22:46:17,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:17,009 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-14 22:46:17,011 - INFO - orders - Background balance/margin cache updated for user 1: balance=17021.77000000, margin=6.55
2025-07-14 22:46:17,810 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-14 22:46:25,065 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: SELL
2025-07-14 22:46:25,595 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.6620000000', 'o': '96.6560000000'}
2025-07-14 22:46:25,596 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.6620000000, ask=96.67166620000000
2025-07-14 22:46:25,596 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.6620000000, ask=96.67166620000000
2025-07-14 22:46:25,597 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 966.62 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-14 22:46:25,597 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:46:25,598 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:46:25,598 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:46:25,598 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:46:25,599 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5750000000'), 'o': Decimal('147.5720000000')}
2025-07-14 22:46:25,599 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5750000000
2025-07-14 22:46:25,600 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 966.62 JPY / 147.5750000000 = 6.550025410808063696425546332 USD
2025-07-14 22:46:25,600 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 96.6620000000, Margin: 6.550025410808063696425546332, Commission: 0.10
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: SELL, Quantity: 0.01, FullMargin: 6.550025410808063696425546332
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=6.550025410808063696425546332
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:46:25,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:25,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:25,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303')], HighestMarginPerLot=655.070303
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01, NetQty=0.01000000, IsHedged=True
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.0025410808063696425546332')], HighestMarginPerLot=655.070303
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:25,601 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:46:25,601 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: SELL, MarginBefore: 6.55, MarginAfter: 6.55, AdditionalMargin: 0.0, OpenOrders: 1
2025-07-14 22:46:25,601 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=6.550025410808063696425546332
2025-07-14 22:46:25,961 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=17021.77000000, margin=6.55000000 (was 6.55000000)
2025-07-14 22:46:25,961 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-14 22:46:25,961 - INFO - orders - [PERF] Order processing: 0.8950s
2025-07-14 22:46:26,197 - INFO - orders - [PERF] Order creation: 0.2360s
2025-07-14 22:46:26,197 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-14 22:46:26,197 - INFO - orders - [PERF] TOTAL place_order: 1.1359s
2025-07-14 22:46:26,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:26,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:46:26,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.002541')], HighestMarginPerLot=655.070303
2025-07-14 22:46:26,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:26,392 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-14 22:46:26,535 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:26,535 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:46:26,535 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.002541')], HighestMarginPerLot=655.070303
2025-07-14 22:46:26,535 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:26,535 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-14 22:46:26,537 - INFO - orders - Background balance/margin cache updated for user 1: balance=17021.77000000, margin=6.55
2025-07-14 22:46:27,123 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-14 22:47:10,867 - INFO - orders - Order placement request received - User: 1, Symbol: BTCUSD, Type: BUY
2025-07-14 22:47:11,731 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117131.4000000000', 'o': '117131.3000000000'}
2025-07-14 22:47:11,732 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117131.4000000000, ask=117143.11314000000000
2025-07-14 22:47:11,732 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117131.4000000000, ask=117143.11314000000000
2025-07-14 22:47:11,732 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.29, Price: 117143.11314000000000, Margin: 16985.75, Commission: 67.94
2025-07-14 22:47:11,732 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.29, FullMargin: 16985.75
2025-07-14 22:47:11,732 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 22:47:11,733 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.29, Margin=16985.75
2025-07-14 22:47:11,733 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 22:47:11,733 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:47:11,735 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol BTCUSD. Returning zero margin.
2025-07-14 22:47:11,735 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol BTCUSD
2025-07-14 22:47:11,736 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: TotalBuyQty=0.29, TotalSellQty=0, NetQty=0.29, IsHedged=False
2025-07-14 22:47:11,736 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58571.55172413793103448275862')], HighestMarginPerLot=58571.55172413793103448275862
2025-07-14 22:47:11,736 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol BTCUSD: CalculatedTotalMargin=16985.75
2025-07-14 22:47:11,736 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:47:11,736 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 16985.75, AdditionalMargin: 16985.75, OpenOrders: 0
2025-07-14 22:47:11,737 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.29, Margin=16985.75
2025-07-14 22:47:12,063 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=17021.77000000, margin=16992.30000000 (was 6.55000000)
2025-07-14 22:47:12,064 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-14 22:47:12,064 - INFO - orders - [PERF] Order processing: 1.1920s
2025-07-14 22:47:12,314 - INFO - orders - [PERF] Order creation: 0.2497s
2025-07-14 22:47:12,314 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-14 22:47:12,315 - INFO - orders - [PERF] TOTAL place_order: 1.4485s
2025-07-14 22:47:12,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:47:12,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:47:12,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.002541')], HighestMarginPerLot=655.070303
2025-07-14 22:47:12,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:47:12,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol BTCUSD
2025-07-14 22:47:12,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: TotalBuyQty=0.29000000, TotalSellQty=0, NetQty=0.29000000, IsHedged=False
2025-07-14 22:47:12,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58571.55172413793103448275862')], HighestMarginPerLot=58571.55172413793103448275862
2025-07-14 22:47:12,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol BTCUSD: CalculatedTotalMargin=16985.75
2025-07-14 22:47:12,504 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 16992.30
2025-07-14 22:47:12,806 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:47:12,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:47:12,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.002541')], HighestMarginPerLot=655.070303
2025-07-14 22:47:12,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:47:12,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol BTCUSD
2025-07-14 22:47:12,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: TotalBuyQty=0.29000000, TotalSellQty=0, NetQty=0.29000000, IsHedged=False
2025-07-14 22:47:12,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58571.55172413793103448275862')], HighestMarginPerLot=58571.55172413793103448275862
2025-07-14 22:47:12,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol BTCUSD: CalculatedTotalMargin=16985.75
2025-07-14 22:47:12,830 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 16992.30
2025-07-14 22:47:12,843 - INFO - orders - Background balance/margin cache updated for user 1: balance=17021.77000000, margin=16992.30
2025-07-14 22:47:13,545 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:48:49,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:48:49,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:48:49,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:48:49,363 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:48:49,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-14 22:48:49,699 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-14 22:48:49,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 10, Symbol AUDUSD
2025-07-14 22:48:49,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDUSD: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-14 22:48:49,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDUSD: AllMarginsPerLot=[Decimal('655'), Decimal('655'), Decimal('655')], HighestMarginPerLot=655
2025-07-14 22:48:49,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDUSD: CalculatedTotalMargin=19.65
2025-07-14 22:48:49,792 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 19.65
2025-07-14 22:48:50,756 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-14 22:48:50,756 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-14 22:48:50,756 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-14 22:48:50,756 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-14 22:48:50,756 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-14 22:48:51,065 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 19, Symbol AUDJPY
2025-07-14 22:48:51,066 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 19, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,066 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 19, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.751744')], HighestMarginPerLot=654.751744
2025-07-14 22:48:51,066 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 19, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:48:51,066 - INFO - orders - [TOTAL_USER_MARGIN] User 19 total margin across all symbols: 6.55
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol EURUSD
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180')], HighestMarginPerLot=1180
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=11.80
2025-07-14 22:48:51,267 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 18.38
2025-07-14 22:48:51,883 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-14 22:48:51,883 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-14 22:48:51,883 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDSGD
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.353812')], HighestMarginPerLot=780.353812
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDSGD: CalculatedTotalMargin=7.80
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=4.00000000, TotalSellQty=0, NetQty=4.00000000, IsHedged=False
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24466.1075')], HighestMarginPerLot=24466.1075
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=97864.43
2025-07-14 22:48:51,884 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 97915.37
2025-07-14 22:49:52,649 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:49:59,566 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:50:22,565 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:50:27,862 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:50:27,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:50:27,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:50:27,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:50:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:50:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:50:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:50:27,868 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:50:27,868 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:51:31,700 - INFO - orders - Order placement request received - User: 4, Symbol: BTCUSD, Type: BUY
2025-07-14 22:51:32,197 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117174.9000000000', 'o': '117174.8000000000'}
2025-07-14 22:51:32,198 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117174.9000000000, ask=117186.61749000000000
2025-07-14 22:51:32,198 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117174.9000000000, ask=117186.61749000000000
2025-07-14 22:51:32,198 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.28, Price: 117186.61749000000000, Margin: 8203.06, Commission: 65.62
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 4, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.28, FullMargin: 8203.06
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 2
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.28, Margin=8203.06
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 2 existing orders + 1 new order
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol BTCUSD
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.29000000, TotalSellQty=0.01000000, NetQty=0.29000000, IsHedged=True
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449'), Decimal('29296.64285714285714285714286')], HighestMarginPerLot=29449
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=8540.21
2025-07-14 22:51:32,199 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:51:32,199 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 4, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 294.49, MarginAfter: 8540.21, AdditionalMargin: 8245.72, OpenOrders: 2
2025-07-14 22:51:32,200 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.28, Margin=8203.06
2025-07-14 22:51:32,200 - INFO - orders - [PERF] Order processing: 0.4910s
2025-07-14 22:51:32,819 - INFO - orders - [PERF] Order creation: 0.6196s
2025-07-14 22:51:32,820 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-14 22:51:32,820 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-14 22:51:32,820 - INFO - orders - [PERF] TOTAL place_order: 1.1200s
2025-07-14 22:51:33,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:51:33,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:33,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:51:33,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:51:33,753 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:51:33,952 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:51:33,954 - INFO - orders - Background balance/margin cache updated for user 4: balance=8728.66000000, margin=350.62
2025-07-14 22:51:34,979 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-14 22:51:35,274 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 4
2025-07-14 22:52:26,143 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 22:52:27,452 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 22:52:27,452 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 22:52:27,452 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 22:52:27,453 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 22:52:31,527 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 22:52:31,527 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 22:52:32,455 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 22:52:37,451 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 22:52:42,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:52:42,790 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:52:42,790 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 22:52:42,790 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 22:52:42,790 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 22:52:43,366 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:53:11,691 - INFO - orders - Order placement request received - User: 4, Symbol: BTCUSD, Type: BUY
2025-07-14 22:53:12,103 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117213.0000000000', 'o': '117212.9000000000'}
2025-07-14 22:53:12,103 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117213.0000000000, ask=117224.72130000000000
2025-07-14 22:53:12,103 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117213.0000000000, ask=117224.72130000000000
2025-07-14 22:53:12,103 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.26, Price: 117224.72130000000000, Margin: 7619.61, Commission: 60.96
2025-07-14 22:53:12,104 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 4, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.26, FullMargin: 7619.61
2025-07-14 22:53:12,104 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 22:53:12,104 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.26, Margin=7619.61
2025-07-14 22:53:12,105 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 22:53:12,105 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:53:12,105 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 4, Symbol BTCUSD. Returning zero margin.
2025-07-14 22:53:12,105 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:53:12,106 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26, TotalSellQty=0, NetQty=0.26, IsHedged=False
2025-07-14 22:53:12,106 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29306.19230769230769230769231')], HighestMarginPerLot=29306.19230769230769230769231
2025-07-14 22:53:12,106 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7619.61
2025-07-14 22:53:12,106 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:53:12,106 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 4, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 7619.61, AdditionalMargin: 7619.61, OpenOrders: 0
2025-07-14 22:53:12,106 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.26, Margin=7619.61
2025-07-14 22:53:12,107 - INFO - orders - [PERF] Order processing: 0.4146s
2025-07-14 22:53:12,136 - INFO - orders - [PERF] Order creation: 0.0289s
2025-07-14 22:53:12,136 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-14 22:53:12,136 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-14 22:53:12,136 - INFO - orders - [PERF] TOTAL place_order: 0.4462s
2025-07-14 22:53:12,153 - INFO - orders - Background balance/margin cache updated for user 4: balance=8728.66000000, margin=0.0
2025-07-14 22:53:12,167 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-14 22:53:12,480 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 4
2025-07-14 22:54:49,601 - INFO - orders - Order 1000057-001 transitioning to OPEN. Calculating margin.
2025-07-14 22:54:49,601 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-14 22:54:49,602 - INFO - orders - Using group_name: Group B for order 1000057-001
2025-07-14 22:54:49,963 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-14 22:54:49,963 - INFO - orders - Using user's leverage from cache: 200.00
2025-07-14 22:54:49,963 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117161.8000000000', 'o': '117161.7000000000'}
2025-07-14 22:54:49,963 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117161.8000000000, ask=117173.51618000000000
2025-07-14 22:54:49,964 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117161.8000000000, ask=117173.51618000000000
2025-07-14 22:54:49,964 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.26000000, Price: 117173.51618000000000, Margin: 7616.28, Commission: 60.93
2025-07-14 22:54:49,964 - INFO - orders - New margin calculated: 7616.28, contract_value: 0.26
2025-07-14 22:54:49,964 - INFO - orders - [MARGIN] Final stored margin (USD): 7616.28
2025-07-14 22:54:49,964 - INFO - orders - Recalculating total hedged margin for user 4 on symbol BTCUSD
2025-07-14 22:54:49,965 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 4, Symbol BTCUSD. Returning zero margin.
2025-07-14 22:54:49,965 - INFO - orders - Old total margin for BTCUSD: 0.0
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 22:54:49,966 - INFO - orders - New total margin for BTCUSD: 7616.28
2025-07-14 22:54:49,966 - INFO - orders - Margin change for user 4: 7616.28
2025-07-14 22:54:49,969 - INFO - orders - User 4 margin updated from 297.78000000 to 7914.06000000
2025-07-14 22:54:49,991 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 22:54:49,991 - INFO - orders - Using order model: UserOrder
2025-07-14 22:54:49,993 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 22:54:49,994 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 22:54:49,995 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 22:54:49,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:54:49,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 22:54:49,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 22:54:49,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 22:54:49,997 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 22:54:49,999 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 22:56:29,572 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:56:31,667 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:56:31,667 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 22:56:31,668 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 22:56:31,668 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 22:56:31,668 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 22:56:47,516 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:56:50,088 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:56:50,088 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 22:56:50,088 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 22:56:50,088 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 22:56:50,088 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 22:57:47,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 22:57:47,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 22:57:47,337 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 22:57:47,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:57:47,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:57:47,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 22:57:47,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 22:57:47,342 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 22:59:58,662 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 23:00:01,180 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:00:01,180 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:00:01,180 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:00:01,180 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:00:01,180 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 23:02:47,476 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 23:02:47,481 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 23:02:47,482 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 23:02:47,482 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 23:02:47,482 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 23:02:47,482 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 23:03:41,453 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 23:03:43,140 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:03:43,140 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:03:43,140 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:03:43,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:03:43,141 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:04:21,208 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 23:04:24,057 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:04:24,058 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:04:24,058 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:04:24,058 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:04:24,058 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:04:27,128 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:04:27,129 - INFO - orders - Using order model: UserOrder
2025-07-14 23:04:27,178 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:04:27,222 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:04:27,246 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:04:27,266 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:04:27,266 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:04:27,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:04:27,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:04:27,274 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:04:27,330 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:05:27,021 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:05:27,021 - INFO - orders - Using order model: UserOrder
2025-07-14 23:05:27,024 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:05:27,027 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:05:27,029 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:05:27,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:05:27,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:05:27,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:05:27,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:05:27,036 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:05:27,037 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:07:26,960 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 23:07:28,145 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 23:07:28,146 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 23:07:28,146 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 23:07:28,146 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 23:07:32,236 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 23:07:32,236 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 23:07:33,134 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 23:07:38,144 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 23:07:51,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:07:51,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:07:51,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:07:51,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:07:51,805 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:08:27,923 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:08:27,923 - INFO - orders - Using order model: UserOrder
2025-07-14 23:08:27,929 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:08:27,934 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:08:27,936 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:08:27,942 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:08:27,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:08:27,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:08:27,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:08:27,943 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:08:27,946 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:11:41,104 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 23:11:42,298 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 23:11:42,299 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 23:11:42,299 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 23:11:42,299 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 23:11:46,372 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 23:11:46,372 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 23:11:47,506 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 23:11:52,299 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 23:12:06,801 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 23:12:06,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 23:12:06,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 23:12:06,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 23:12:06,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 23:12:06,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 23:12:06,803 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 23:12:06,803 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 23:12:06,803 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 23:12:06,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 23:12:06,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 23:12:06,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 23:12:06,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 23:12:06,901 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 23:12:07,000 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:12:07,000 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:12:07,000 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:12:07,000 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:12:07,000 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:12:42,049 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:12:42,049 - INFO - orders - Using order model: UserOrder
2025-07-14 23:12:42,062 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:12:42,066 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:12:42,068 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:12:42,073 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:12:42,073 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:12:42,073 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:12:42,073 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:12:42,073 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:12:42,077 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:13:42,059 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:13:42,059 - INFO - orders - Using order model: UserOrder
2025-07-14 23:13:42,067 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:13:42,071 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:13:42,072 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:13:42,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:13:42,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:13:42,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:13:42,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:13:42,077 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:13:42,080 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:14:42,079 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:14:42,080 - INFO - orders - Using order model: UserOrder
2025-07-14 23:14:42,086 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:14:42,091 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:14:42,093 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:14:42,101 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:14:42,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:14:42,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:14:42,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:14:42,103 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:14:42,107 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:15:18,766 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:15:18,766 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:15:18,766 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:15:18,766 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:15:18,766 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:15:22,465 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:15:22,465 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:15:22,465 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:15:22,466 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:15:22,466 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:15:37,336 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 23:15:41,904 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:15:41,904 - INFO - orders - Using order model: UserOrder
2025-07-14 23:15:41,908 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:15:41,910 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:15:41,911 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:15:41,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:15:41,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:15:41,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:15:41,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:15:41,915 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:15:41,917 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:15:52,728 - INFO - orders - Order placement request received - User: 14, Symbol: AUDCHF, Type: BUY
2025-07-14 23:15:53,211 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5219700000', 'o': '0.5219100000'}
2025-07-14 23:15:53,212 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5219700000, ask=0.52202219700000
2025-07-14 23:15:53,212 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5219700000, ask=0.52202219700000
2025-07-14 23:15:53,216 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5220.22 CHF to USD for margin_calculation (user_id: 14, position: None)
2025-07-14 23:15:53,217 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-14 23:15:53,219 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 23:15:53,219 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-14 23:15:53,219 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-14 23:15:53,221 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7964800000'), 'o': Decimal('0.7964500000')}
2025-07-14 23:15:53,222 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7964800000
2025-07-14 23:15:53,222 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5220.22 CHF / 0.7964800000 = 6554.113097629570108477300121 USD
2025-07-14 23:15:53,222 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: BUY, Qty: 10, Price: 0.52202219700000, Margin: 6554.113097629570108477300121, Commission: 100.00
2025-07-14 23:15:53,222 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 14, Symbol: AUDCHF, OrderType: BUY, Quantity: 10, FullMargin: 6554.113097629570108477300121
2025-07-14 23:15:53,222 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 23:15:53,223 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=10, Margin=6554.113097629570108477300121
2025-07-14 23:15:53,223 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 23:15:53,223 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 23:15:53,224 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol AUDCHF. Returning zero margin.
2025-07-14 23:15:53,224 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol AUDCHF
2025-07-14 23:15:53,224 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDCHF: TotalBuyQty=10, TotalSellQty=0, NetQty=10, IsHedged=False
2025-07-14 23:15:53,224 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.4113097629570108477300121')], HighestMarginPerLot=655.4113097629570108477300121
2025-07-14 23:15:53,224 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDCHF: CalculatedTotalMargin=6554.11
2025-07-14 23:15:53,226 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 23:15:53,226 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 14, Symbol: AUDCHF, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6554.11, AdditionalMargin: 6554.11, OpenOrders: 0
2025-07-14 23:15:53,226 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=10, Margin=6554.113097629570108477300121
2025-07-14 23:15:53,226 - INFO - orders - [PERF] Order processing: 0.4937s
2025-07-14 23:15:53,261 - INFO - orders - [PERF] Order creation: 0.0345s
2025-07-14 23:15:53,261 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-14 23:15:53,262 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-14 23:15:53,262 - INFO - orders - [PERF] TOTAL place_order: 0.5406s
2025-07-14 23:15:53,339 - INFO - orders - Background balance/margin cache updated for user 14: balance=10000.00000000, margin=0.0
2025-07-14 23:15:53,371 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-14 23:15:53,766 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 14
2025-07-14 23:16:36,348 - INFO - orders - Order placement request received - User: 14, Symbol: AUDCHF, Type: BUY
2025-07-14 23:16:36,747 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5220000000', 'o': '0.5219400000'}
2025-07-14 23:16:36,747 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5220000000, ask=0.52205220000000
2025-07-14 23:16:36,747 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5220000000, ask=0.52205220000000
2025-07-14 23:16:36,751 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5220.52 CHF to USD for margin_calculation (user_id: 14, position: None)
2025-07-14 23:16:36,752 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-14 23:16:36,753 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 23:16:36,753 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-14 23:16:36,753 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-14 23:16:36,755 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7964300000'), 'o': Decimal('0.7964200000')}
2025-07-14 23:16:36,755 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7964300000
2025-07-14 23:16:36,755 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5220.52 CHF / 0.7964300000 = 6554.901246813907060256394159 USD
2025-07-14 23:16:36,755 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: BUY, Qty: 10, Price: 0.52205220000000, Margin: 6554.901246813907060256394159, Commission: 100.00
2025-07-14 23:16:36,755 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 14, Symbol: AUDCHF, OrderType: BUY, Quantity: 10, FullMargin: 6554.901246813907060256394159
2025-07-14 23:16:36,755 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 23:16:36,756 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=10, Margin=6554.901246813907060256394159
2025-07-14 23:16:36,756 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 23:16:36,756 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 23:16:36,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol AUDCHF. Returning zero margin.
2025-07-14 23:16:36,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol AUDCHF
2025-07-14 23:16:36,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDCHF: TotalBuyQty=10, TotalSellQty=0, NetQty=10, IsHedged=False
2025-07-14 23:16:36,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.4901246813907060256394159')], HighestMarginPerLot=655.4901246813907060256394159
2025-07-14 23:16:36,758 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDCHF: CalculatedTotalMargin=6554.90
2025-07-14 23:16:36,759 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 23:16:36,759 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 14, Symbol: AUDCHF, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6554.90, AdditionalMargin: 6554.90, OpenOrders: 0
2025-07-14 23:16:36,759 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=10, Margin=6554.901246813907060256394159
2025-07-14 23:16:36,760 - INFO - orders - [PERF] Order processing: 0.4087s
2025-07-14 23:16:36,781 - INFO - orders - [PERF] Order creation: 0.0208s
2025-07-14 23:16:36,781 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-14 23:16:36,781 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-14 23:16:36,781 - INFO - orders - [PERF] TOTAL place_order: 0.4353s
2025-07-14 23:16:36,827 - INFO - orders - Background balance/margin cache updated for user 14: balance=10000.00000000, margin=0.0
2025-07-14 23:16:36,839 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-14 23:16:37,182 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 14
2025-07-14 23:16:42,048 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:16:42,048 - INFO - orders - Using order model: UserOrder
2025-07-14 23:16:42,053 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:16:42,057 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:16:42,058 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:16:42,062 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:16:42,063 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:16:42,063 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:16:42,063 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:16:42,063 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:16:42,065 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:16:46,651 - INFO - orders - Pending order placement request received - User ID: 14, Symbol: AUDCHF, Type: BUY_LIMIT, Quantity: 10
2025-07-14 23:16:46,718 - INFO - orders - Calculated contract_value for pending order: 1000000.00000000 (contract_size: 100000.00000000 * quantity: 10)
2025-07-14 23:16:46,722 - INFO - orders - [DEBUG] User data from cache: {'id': 14, 'email': 'cursordemo3@gmail.com', 'account_number': 'DB7JG', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('10000.00000000'), 'margin': Decimal('0E-8'), 'user_type': 'live', 'first_name': None, 'last_name': None, 'country': 'India', 'phone_number': Decimal('918618025298')}
2025-07-14 23:16:46,722 - INFO - orders - [DEBUG] Group name: Standard
2025-07-14 23:16:46,724 - INFO - orders - User 14 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-14 23:16:46,730 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCHF: contract_size=100000.00000000, profit_currency=CHF, digit=5.00000
2025-07-14 23:16:47,170 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5219700000', 'o': '0.5218900000'}
2025-07-14 23:16:47,178 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5219700000, ask=0.52202219700000
2025-07-14 23:16:47,179 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5219700000, ask=0.52202219700000
2025-07-14 23:16:47,182 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5220.22 CHF to USD for margin_calculation (user_id: 14, position: None)
2025-07-14 23:16:47,182 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-14 23:16:47,183 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 23:16:47,183 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-14 23:16:47,183 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-14 23:16:47,188 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7964900000'), 'o': Decimal('0.7964900000')}
2025-07-14 23:16:47,188 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7964900000
2025-07-14 23:16:47,188 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5220.22 CHF / 0.7964900000 = 6554.030810179663272608570101 USD
2025-07-14 23:16:47,188 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: BUY_LIMIT, Qty: 10, Price: 0.52202219700000, Margin: 6554.030810179663272608570101, Commission: 100.00
2025-07-14 23:16:47,189 - INFO - orders - Calculated initial margin: 6554.030810179663272608570101, commission: 100.00 for pending order 1000068-001
2025-07-14 23:16:47,264 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '1000068-001', 'order_company_name': 'AUDCHF', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('10'), 'order_price': Decimal('0.51'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1000069-005', 'takeprofit_id': '1000070-006', 'order_user_id': 14, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('1000000.00000000'), 'margin': Decimal('6554.030810179663272608570101'), 'commission': Decimal('100.00'), 'open_time': None}
2025-07-14 23:16:47,265 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-14 23:16:47,265 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 14 at price 0.51
2025-07-14 23:16:47,265 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '1000068-001', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 14, 'order_company_name': 'AUDCHF', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('0.51'), 'order_quantity': Decimal('10'), 'contract_value': Decimal('1000000.00000000'), 'margin': Decimal('6554.030810179663272608570101'), 'commission': Decimal('100.00'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1000069-005', 'takeprofit_id': '1000070-006', 'close_id': None}
2025-07-14 23:16:47,321 - INFO - orders - Order 1000068-001 verified in database on attempt 1 before adding to Redis.
2025-07-14 23:16:47,326 - INFO - orders - Skipping Redis storage for Barclays user pending order 1000068-001
2025-07-14 23:16:47,360 - INFO - orders - [PERF] TOTAL place_order: 0.7092s
2025-07-14 23:16:47,408 - INFO - orders - Background balance/margin cache updated for user 14: balance=10000.00000000, margin=0.0
2025-07-14 23:16:47,433 - INFO - orders - [BARCLAYS] barclays_push called for user 14, is_barclays_live_user=True
2025-07-14 23:16:55,909 - INFO - orders - Pending order placement request received - User ID: 14, Symbol: AUDCHF, Type: SELL_STOP, Quantity: 10
2025-07-14 23:16:55,943 - INFO - orders - Calculated contract_value for pending order: 1000000.00000000 (contract_size: 100000.00000000 * quantity: 10)
2025-07-14 23:16:55,944 - INFO - orders - [DEBUG] User data from cache: {'id': 14, 'email': 'cursordemo3@gmail.com', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'DB7JG', 'wallet_balance': Decimal('10000.00000000'), 'margin': Decimal('0.0')}
2025-07-14 23:16:55,944 - INFO - orders - [DEBUG] Group name: Standard
2025-07-14 23:16:55,945 - INFO - orders - User 14 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-14 23:16:55,948 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCHF: contract_size=100000.00000000, profit_currency=CHF, digit=5.00000
2025-07-14 23:16:56,330 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5219400000', 'o': '0.5218800000'}
2025-07-14 23:16:56,330 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5219400000, ask=0.52199219400000
2025-07-14 23:16:56,330 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5219400000, ask=0.52199219400000
2025-07-14 23:16:56,332 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5219.40 CHF to USD for margin_calculation (user_id: 14, position: None)
2025-07-14 23:16:56,332 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-14 23:16:56,333 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 23:16:56,333 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-14 23:16:56,333 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-14 23:16:56,335 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7965000000'), 'o': Decimal('0.7964800000')}
2025-07-14 23:16:56,335 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7965000000
2025-07-14 23:16:56,335 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5219.40 CHF / 0.7965000000 = 6552.919020715630885122410546 USD
2025-07-14 23:16:56,335 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: SELL_STOP, Qty: 10, Price: 0.5219400000, Margin: 6552.919020715630885122410546, Commission: 100.00
2025-07-14 23:16:56,335 - INFO - orders - Calculated initial margin: 6552.919020715630885122410546, commission: 100.00 for pending order 1000071-001
2025-07-14 23:16:56,395 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '1000071-001', 'order_company_name': 'AUDCHF', 'order_type': 'SELL_STOP', 'order_quantity': Decimal('10'), 'order_price': Decimal('0.51'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1000072-005', 'takeprofit_id': '1000073-006', 'order_user_id': 14, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('1000000.00000000'), 'margin': Decimal('6552.919020715630885122410546'), 'commission': Decimal('100.00'), 'open_time': None}
2025-07-14 23:16:56,396 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-14 23:16:56,396 - INFO - orders - Placing PENDING order: SELL_STOP for user 14 at price 0.51
2025-07-14 23:16:56,396 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '1000071-001', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 14, 'order_company_name': 'AUDCHF', 'order_type': 'SELL_STOP', 'order_price': Decimal('0.51'), 'order_quantity': Decimal('10'), 'contract_value': Decimal('1000000.00000000'), 'margin': Decimal('6552.919020715630885122410546'), 'commission': Decimal('100.00'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1000072-005', 'takeprofit_id': '1000073-006', 'close_id': None}
2025-07-14 23:16:56,432 - INFO - orders - Order 1000071-001 verified in database on attempt 1 before adding to Redis.
2025-07-14 23:16:56,505 - INFO - orders - Skipping Redis storage for Barclays user pending order 1000071-001
2025-07-14 23:16:56,604 - INFO - orders - [PERF] TOTAL place_order: 0.6955s
2025-07-14 23:16:56,672 - INFO - orders - Background balance/margin cache updated for user 14: balance=10000.00000000, margin=0.0
2025-07-14 23:16:56,696 - INFO - orders - [BARCLAYS] barclays_push called for user 14, is_barclays_live_user=True
2025-07-14 23:17:03,336 - INFO - orders - Order placement request received - User: 14, Symbol: AUDCHF, Type: BUY
2025-07-14 23:17:03,785 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5218800000', 'o': '0.5218000000'}
2025-07-14 23:17:03,786 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5218800000, ask=0.52193218800000
2025-07-14 23:17:03,786 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5218800000, ask=0.52193218800000
2025-07-14 23:17:03,798 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5219.32 CHF to USD for margin_calculation (user_id: 14, position: None)
2025-07-14 23:17:03,798 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-14 23:17:03,809 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 23:17:03,809 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-14 23:17:03,809 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-14 23:17:03,814 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7965000000'), 'o': Decimal('0.7964700000')}
2025-07-14 23:17:03,814 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7965000000
2025-07-14 23:17:03,814 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5219.32 CHF / 0.7965000000 = 6552.818581293157564344005022 USD
2025-07-14 23:17:03,814 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: BUY, Qty: 10, Price: 0.52193218800000, Margin: 6552.818581293157564344005022, Commission: 100.00
2025-07-14 23:17:03,815 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 14, Symbol: AUDCHF, OrderType: BUY, Quantity: 10, FullMargin: 6552.818581293157564344005022
2025-07-14 23:17:03,815 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 23:17:03,815 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=10, Margin=6552.818581293157564344005022
2025-07-14 23:17:03,815 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 23:17:03,816 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 23:17:03,817 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol AUDCHF. Returning zero margin.
2025-07-14 23:17:03,817 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol AUDCHF
2025-07-14 23:17:03,817 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDCHF: TotalBuyQty=10, TotalSellQty=0, NetQty=10, IsHedged=False
2025-07-14 23:17:03,818 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.2818581293157564344005022')], HighestMarginPerLot=655.2818581293157564344005022
2025-07-14 23:17:03,818 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDCHF: CalculatedTotalMargin=6552.82
2025-07-14 23:17:03,822 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 23:17:03,822 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 14, Symbol: AUDCHF, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6552.82, AdditionalMargin: 6552.82, OpenOrders: 0
2025-07-14 23:17:03,823 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=10, Margin=6552.818581293157564344005022
2025-07-14 23:17:03,823 - INFO - orders - [PERF] Order processing: 0.4839s
2025-07-14 23:17:03,878 - INFO - orders - [PERF] Order creation: 0.0546s
2025-07-14 23:17:03,878 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-14 23:17:03,878 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-14 23:17:03,879 - INFO - orders - [PERF] TOTAL place_order: 0.5432s
2025-07-14 23:17:03,982 - INFO - orders - Background balance/margin cache updated for user 14: balance=10000.00000000, margin=0.0
2025-07-14 23:17:04,001 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-14 23:17:04,305 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 14
2025-07-14 23:17:07,165 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 23:17:07,165 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 23:17:07,165 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 23:17:07,165 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 23:17:07,165 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 23:17:07,165 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 23:17:07,166 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 23:17:07,166 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 23:17:07,166 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 23:17:07,177 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 23:17:07,177 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 23:17:07,177 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 23:17:07,177 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 23:17:07,177 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 23:31:36,487 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 23:31:37,802 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 23:31:37,802 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 23:31:37,802 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 23:31:37,803 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 23:31:41,909 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 23:31:41,909 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 23:31:42,806 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 23:31:47,805 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 23:31:48,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:31:48,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:31:48,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:31:48,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:31:48,950 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:32:02,103 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 23:32:02,103 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 23:32:02,103 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 23:32:02,103 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 23:32:02,103 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 23:32:02,103 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 23:32:02,103 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 23:32:02,103 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 23:32:02,103 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 23:32:02,142 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 23:32:02,143 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 23:32:02,143 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 23:32:02,143 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 23:32:02,143 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 23:32:37,666 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:32:37,666 - INFO - orders - Using order model: UserOrder
2025-07-14 23:32:37,675 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:32:37,682 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:32:37,685 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:32:37,694 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:32:37,695 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:32:37,695 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:32:37,695 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:32:37,695 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:32:37,707 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:33:32,349 - INFO - orders - Service provider order info request for order_id: 1000074-001, symbol: AUDCHF
2025-07-14 23:33:37,321 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:33:37,321 - INFO - orders - Using order model: UserOrder
2025-07-14 23:33:37,327 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:33:37,333 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:33:37,334 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:33:37,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:33:37,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:33:37,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:33:37,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:33:37,338 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:33:37,341 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:34:37,516 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:34:37,516 - INFO - orders - Using order model: UserOrder
2025-07-14 23:34:37,521 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:34:37,527 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:34:37,529 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:34:37,534 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:34:37,534 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:34:37,534 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:34:37,534 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:34:37,534 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:34:37,541 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:35:37,469 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:35:37,469 - INFO - orders - Using order model: UserOrder
2025-07-14 23:35:37,478 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:35:37,487 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:35:37,493 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:35:37,502 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:35:37,502 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:35:37,502 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:35:37,502 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:35:37,502 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:35:37,510 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:36:37,514 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:36:37,514 - INFO - orders - Using order model: UserOrder
2025-07-14 23:36:37,523 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:36:37,529 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:36:37,531 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:36:37,538 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:36:37,538 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:36:37,538 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:36:37,538 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:36:37,538 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:36:37,548 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:37:02,487 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 23:37:02,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 23:37:02,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 23:37:02,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 23:37:02,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 23:37:02,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 23:37:02,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 23:37:02,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 23:37:02,488 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 23:37:02,502 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 23:37:02,502 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 23:37:02,502 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 23:37:02,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 23:37:02,503 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 23:37:37,335 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:37:37,336 - INFO - orders - Using order model: UserOrder
2025-07-14 23:37:37,340 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:37:37,344 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:37:37,344 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:37:37,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:37:37,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:37:37,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:37:37,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:37:37,348 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:37:37,352 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:38:37,377 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:38:37,377 - INFO - orders - Using order model: UserOrder
2025-07-14 23:38:37,381 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:38:37,384 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:38:37,385 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:38:37,390 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:38:37,390 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:38:37,390 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:38:37,390 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:38:37,390 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:38:37,392 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:39:11,805 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 23:39:12,973 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 23:39:12,974 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 23:39:12,974 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 23:39:12,975 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 23:39:17,059 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 23:39:17,059 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 23:39:17,964 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 23:39:22,967 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 23:39:51,416 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 23:39:52,383 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 23:39:52,392 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 23:39:52,403 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 23:39:52,404 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 23:39:56,481 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 23:39:56,482 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 23:39:57,389 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 23:40:02,396 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 23:40:43,761 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 23:40:44,828 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 23:40:44,834 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 23:40:44,835 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 23:40:44,835 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 23:40:48,949 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 23:40:48,950 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 23:40:58,169 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 23:40:59,145 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 23:40:59,146 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 23:40:59,146 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 23:40:59,146 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 23:41:03,246 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 23:41:03,247 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 23:41:04,147 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 23:41:09,147 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 23:41:59,087 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:41:59,087 - INFO - orders - Using order model: UserOrder
2025-07-14 23:41:59,091 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:41:59,095 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:41:59,095 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:41:59,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:41:59,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:41:59,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:41:59,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:41:59,100 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:41:59,102 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:42:21,779 - INFO - orders - Service provider order info request for order_id: 1000074-001, symbol: AUDCHF
2025-07-14 23:42:21,798 - INFO - orders - [CACHE HIT] Group-symbol settings for group 'Standard', symbol 'AUDCHF' found in Redis cache.
2025-07-14 23:42:59,086 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:42:59,086 - INFO - orders - Using order model: UserOrder
2025-07-14 23:42:59,092 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:42:59,096 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:42:59,097 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:42:59,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:42:59,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:42:59,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:42:59,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:42:59,102 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:42:59,105 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:43:55,492 - INFO - orders - Order placement request received - User: 14, Symbol: BTCUSD, Type: BUY
2025-07-14 23:43:55,915 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117067.9000000000', 'o': '117067.8000000000'}
2025-07-14 23:43:55,915 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117067.9000000000, ask=117079.60679000000000
2025-07-14 23:43:55,916 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117067.9000000000, ask=117079.60679000000000
2025-07-14 23:43:55,916 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.35, Price: 117079.60679000000000, Margin: 8195.57, Commission: 204.89
2025-07-14 23:43:55,917 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 14, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.35, FullMargin: 8195.57
2025-07-14 23:43:55,917 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 23:43:55,917 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.35, Margin=8195.57
2025-07-14 23:43:55,917 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 23:43:55,917 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 23:43:55,917 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-14 23:43:55,917 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-14 23:43:55,918 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.35, TotalSellQty=0, NetQty=0.35, IsHedged=False
2025-07-14 23:43:55,918 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23415.91428571428571428571429')], HighestMarginPerLot=23415.91428571428571428571429
2025-07-14 23:43:55,918 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=8195.57
2025-07-14 23:43:55,918 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 23:43:55,919 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 14, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 8195.57, AdditionalMargin: 8195.57, OpenOrders: 0
2025-07-14 23:43:55,919 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.35, Margin=8195.57
2025-07-14 23:43:55,919 - INFO - orders - [PERF] Order processing: 0.4255s
2025-07-14 23:43:55,942 - INFO - orders - [PERF] Order creation: 0.0228s
2025-07-14 23:43:55,943 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-14 23:43:55,943 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-14 23:43:55,943 - INFO - orders - [PERF] TOTAL place_order: 0.4533s
2025-07-14 23:43:56,001 - INFO - orders - Background balance/margin cache updated for user 14: balance=10000.00000000, margin=0.0
2025-07-14 23:43:56,017 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-14 23:43:56,377 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 14
2025-07-14 23:43:59,092 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:43:59,093 - INFO - orders - Using order model: UserOrder
2025-07-14 23:43:59,100 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:43:59,107 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:43:59,109 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:43:59,117 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:43:59,117 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:43:59,117 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:43:59,118 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:43:59,118 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:43:59,123 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:44:34,735 - INFO - orders - Service provider order info request for order_id: 1000084-001, symbol: BTCUSD
2025-07-14 23:44:34,748 - INFO - orders - [CACHE HIT] Group-symbol settings for group 'Standard', symbol 'BTCUSD' found in Redis cache.
2025-07-14 23:45:00,175 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:45:00,175 - INFO - orders - Using order model: UserOrder
2025-07-14 23:45:00,205 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:45:00,216 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:45:00,220 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:45:00,233 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:45:00,233 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:45:00,233 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:45:00,234 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:45:00,234 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:45:00,251 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:45:37,020 - INFO - orders - Order 1000084-001 transitioning to OPEN. Calculating margin.
2025-07-14 23:45:37,020 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-14 23:45:37,031 - INFO - orders - Using group_name: Standard for order 1000084-001
2025-07-14 23:45:37,553 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-14 23:45:37,554 - INFO - orders - Using user's leverage from cache: 100.00
2025-07-14 23:45:37,554 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116945.4000000000', 'o': '116945.3000000000'}
2025-07-14 23:45:37,554 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116945.4000000000, ask=116957.09454000000000
2025-07-14 23:45:37,555 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116945.4000000000, ask=116957.09454000000000
2025-07-14 23:45:37,555 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.35000000, Price: 116957.09454000000000, Margin: 8187.00, Commission: 204.67
2025-07-14 23:45:37,555 - INFO - orders - New margin calculated: 8187.00, contract_value: 0.35
2025-07-14 23:45:37,555 - INFO - orders - [MARGIN] Final stored margin (USD): 8187.00
2025-07-14 23:45:37,555 - INFO - orders - Recalculating total hedged margin for user 14 on symbol BTCUSD
2025-07-14 23:45:37,561 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-14 23:45:37,562 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-14 23:45:37,562 - INFO - orders - Old total margin for BTCUSD: 0.0
2025-07-14 23:45:37,562 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-14 23:45:37,562 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.35000000, TotalSellQty=0, NetQty=0.35000000, IsHedged=False
2025-07-14 23:45:37,563 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23391.42857142857142857142857')], HighestMarginPerLot=23391.42857142857142857142857
2025-07-14 23:45:37,563 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=8187.00
2025-07-14 23:45:37,563 - INFO - orders - New total margin for BTCUSD: 8187.00
2025-07-14 23:45:37,563 - INFO - orders - Margin change for user 14: 8187.00
2025-07-14 23:45:37,572 - INFO - orders - User 14 margin updated from 0 to 8187.00
2025-07-14 23:45:37,667 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-14 23:45:37,667 - INFO - orders - Using order model: UserOrder
2025-07-14 23:45:37,673 - INFO - orders - Fetched 1 open orders for user 14
2025-07-14 23:45:37,679 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-14 23:45:37,683 - INFO - orders - Updated static orders cache for user 14 with 1 open orders and 0 pending orders
2025-07-14 23:45:37,694 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-14 23:45:37,695 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.35000000, TotalSellQty=0, NetQty=0.35000000, IsHedged=False
2025-07-14 23:45:37,695 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23391.42857142857142857142857')], HighestMarginPerLot=23391.42857142857142857142857
2025-07-14 23:45:37,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=8187.00
2025-07-14 23:45:37,696 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 8187.00
2025-07-14 23:45:37,707 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=10000.00000000, margin=8187.00
2025-07-14 23:45:59,198 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:45:59,198 - INFO - orders - Using order model: UserOrder
2025-07-14 23:45:59,211 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:45:59,218 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:45:59,219 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:45:59,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:45:59,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:45:59,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:45:59,230 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:45:59,230 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:45:59,238 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:46:11,112 - INFO - orders - Order close request received - Order ID: 1000084-001, User ID: 14, Close Price: 116934.6
2025-07-14 23:46:11,112 - INFO - orders - Request to close order 1000084-001 for user 14 (user_type: live) with price 116934.6. Frontend provided type: BUY, company: BTCUSD, status: CLOSED, frontend_status: CLOSED.
2025-07-14 23:46:11,133 - INFO - orders - User group: Standard, sending_orders setting: barclays
2025-07-14 23:46:11,134 - INFO - orders - Live user 14 from group 'Standard' has 'sending_orders' set to 'barclays'. Pushing close request to Firebase and skipping local DB update.
2025-07-14 23:46:11,159 - INFO - orders - [FIREBASE_CLOSE_REQUEST] Preparing to send payload for user-initiated close: {'order_id': '1000084-001', 'close_price': '116934.6', 'user_id': 14, 'order_type': 'BUY', 'order_company_name': 'BTCUSD', 'order_quantity': '0.35000000', 'contract_value': '0.35000000', 'order_status': 'CLOSED', 'status': 'CLOSED', 'action': 'close_order', 'close_id': '1000088-003'}
2025-07-14 23:46:17,033 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 23:46:17,034 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 23:46:17,035 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 23:46:17,035 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 23:46:17,035 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 23:46:17,035 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 23:46:17,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 23:46:17,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 23:46:17,036 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 23:46:17,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 23:46:17,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 23:46:17,062 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 23:46:17,062 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 23:46:17,062 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 23:46:46,864 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 0E-24 USD to USD for PnL (user_id: 14, position: 1000084-001)
2025-07-14 23:46:46,864 - INFO - orders - [CURRENCY_CONVERT] Currency is already USD, no conversion needed
2025-07-14 23:46:46,870 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-14 23:46:46,870 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.35000000, TotalSellQty=0, NetQty=0.35000000, IsHedged=False
2025-07-14 23:46:46,871 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23391.42857142857142857142857')], HighestMarginPerLot=23391.42857142857142857142857
2025-07-14 23:46:46,871 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=8187.00
2025-07-14 23:46:46,871 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-14 23:46:47,012 - INFO - orders - Balance/margin cache updated for user 14: balance=9795.33000000, margin=0E-8
2025-07-14 23:46:47,012 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-14 23:46:47,012 - INFO - orders - Using order model: UserOrder
2025-07-14 23:46:47,018 - INFO - orders - Fetched 0 open orders for user 14
2025-07-14 23:46:47,024 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-14 23:46:47,025 - INFO - orders - Updated static orders cache for user 14 with 0 open orders and 0 pending orders
2025-07-14 23:46:47,037 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9795.33000000, margin=0.0
2025-07-14 23:46:59,321 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:46:59,322 - INFO - orders - Using order model: UserOrder
2025-07-14 23:46:59,329 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:46:59,334 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:46:59,336 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:46:59,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:46:59,344 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:46:59,344 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:46:59,344 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:46:59,344 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:46:59,348 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:47:07,603 - INFO - orders - [get_closed_orders] user_type: live
2025-07-14 23:47:22,100 - INFO - orders - Pending order placement request received - User ID: 14, Symbol: BTCUSD, Type: BUY_LIMIT, Quantity: 0.35
2025-07-14 23:47:22,133 - INFO - orders - Calculated contract_value for pending order: 0.3500000000 (contract_size: 1.00000000 * quantity: 0.35)
2025-07-14 23:47:22,136 - INFO - orders - [DEBUG] User data from cache: {'id': 14, 'email': 'cursordemo3@gmail.com', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'DB7JG', 'wallet_balance': Decimal('9795.33000000'), 'margin': Decimal('0E-8'), 'first_name': None, 'last_name': None, 'country': 'India', 'phone_number': Decimal('918618025298')}
2025-07-14 23:47:22,136 - INFO - orders - [DEBUG] Group name: Standard
2025-07-14 23:47:22,138 - INFO - orders - User 14 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-14 23:47:22,145 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-14 23:47:22,504 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116902.0000000000', 'o': '116901.9000000000'}
2025-07-14 23:47:22,504 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116902.0000000000, ask=116913.69020000000000
2025-07-14 23:47:22,504 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116902.0000000000, ask=116913.69020000000000
2025-07-14 23:47:22,505 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY_LIMIT, Qty: 0.35, Price: 116913.69020000000000, Margin: 8183.96, Commission: 204.60
2025-07-14 23:47:22,505 - INFO - orders - Calculated initial margin: 8183.96, commission: 204.60 for pending order 1000093-001
2025-07-14 23:47:22,575 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '1000093-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('0.35'), 'order_price': Decimal('1123'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1000094-005', 'takeprofit_id': '1000095-006', 'order_user_id': 14, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('0.3500000000'), 'margin': Decimal('8183.96'), 'commission': Decimal('204.60'), 'open_time': None}
2025-07-14 23:47:22,575 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-14 23:47:22,575 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 14 at price 1123
2025-07-14 23:47:22,576 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '1000093-001', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 14, 'order_company_name': 'BTCUSD', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('1123'), 'order_quantity': Decimal('0.35'), 'contract_value': Decimal('0.3500000000'), 'margin': Decimal('8183.96'), 'commission': Decimal('204.60'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1000094-005', 'takeprofit_id': '1000095-006', 'close_id': None}
2025-07-14 23:47:22,617 - INFO - orders - Order 1000093-001 verified in database on attempt 1 before adding to Redis.
2025-07-14 23:47:22,622 - INFO - orders - Skipping Redis storage for Barclays user pending order 1000093-001
2025-07-14 23:47:22,664 - INFO - orders - [PERF] TOTAL place_order: 0.5641s
2025-07-14 23:47:22,739 - INFO - orders - Background balance/margin cache updated for user 14: balance=9795.33000000, margin=0.0
2025-07-14 23:47:22,756 - INFO - orders - [BARCLAYS] barclays_push called for user 14, is_barclays_live_user=True
2025-07-14 23:47:59,377 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:47:59,378 - INFO - orders - Using order model: UserOrder
2025-07-14 23:47:59,386 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:47:59,393 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:47:59,395 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:47:59,402 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:47:59,402 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:47:59,403 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:47:59,403 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:47:59,403 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:47:59,408 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:48:29,524 - INFO - orders - Service provider update request received: {"order_id":"1000093-001","order_status":"PENDING","status":"PENDING"}
2025-07-14 23:48:29,537 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-14 23:48:29,538 - INFO - orders - Update fields: {'order_id': '1000093-001', 'order_status': 'PENDING', 'status': 'PENDING'}
2025-07-14 23:48:29,538 - INFO - orders - Processing regular update for order 1000093-001
2025-07-14 23:48:29,569 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-14 23:48:29,578 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-14 23:48:29,578 - INFO - orders - Using order model: UserOrder
2025-07-14 23:48:29,585 - INFO - orders - Fetched 0 open orders for user 14
2025-07-14 23:48:29,590 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-14 23:48:29,591 - INFO - orders - Updated static orders cache for user 14 with 0 open orders and 1 pending orders
2025-07-14 23:48:29,598 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9795.33000000, margin=0.0
2025-07-14 23:48:58,989 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:48:58,990 - INFO - orders - Using order model: UserOrder
2025-07-14 23:48:58,994 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:48:58,998 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:48:58,999 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:48:59,004 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:48:59,004 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:48:59,004 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:48:59,004 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:48:59,005 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:48:59,008 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:49:13,191 - INFO - orders - [get_closed_orders] user_type: live
2025-07-14 23:49:13,714 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 23:49:14,754 - INFO - orders - [get_closed_orders] user_type: live
2025-07-15 00:13:58,700 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-15 00:13:59,965 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-15 00:13:59,965 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-15 00:13:59,965 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-15 00:13:59,965 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-15 00:14:04,077 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-15 00:14:04,077 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-15 00:14:04,971 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-15 00:14:09,967 - INFO - orders - Starting the users with orders cache updater task.
2025-07-15 00:14:10,842 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 00:14:10,843 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 00:14:10,844 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 00:14:10,844 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 00:14:10,844 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 00:14:23,395 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 00:14:23,395 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 00:14:23,395 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 00:14:23,395 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 00:14:23,395 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 00:14:23,395 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 00:14:23,395 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 00:14:23,395 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 00:14:23,395 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 00:14:23,415 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 00:14:23,415 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 00:14:23,415 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 00:14:23,415 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 00:14:23,415 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 00:14:49,942 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-15 00:14:59,501 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 00:14:59,502 - INFO - orders - Using order model: UserOrder
2025-07-15 00:14:59,509 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 00:14:59,512 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 00:14:59,513 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 00:14:59,517 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 00:14:59,517 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 00:14:59,517 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 00:14:59,517 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 00:14:59,517 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 00:14:59,520 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 00:15:08,877 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-15 00:15:22,191 - INFO - orders - Order placement request received - User: 11, Symbol: AUDCAD, Type: BUY
2025-07-15 00:15:22,593 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8975200000', 'o': '0.8974500000'}
2025-07-15 00:15:22,593 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8975200000, ask=0.89760975200000
2025-07-15 00:15:22,593 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8975200000, ask=0.89760975200000
2025-07-15 00:15:22,594 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.98 CAD to USD for margin_calculation (user_id: 11, position: None)
2025-07-15 00:15:22,594 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-15 00:15:22,595 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-15 00:15:22,596 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-15 00:15:22,596 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-15 00:15:22,598 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3702300000'), 'o': Decimal('1.3702000000')}
2025-07-15 00:15:22,598 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3702300000
2025-07-15 00:15:22,598 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.98 CAD / 1.3702300000 = 6.553644278697736876290841684 USD
2025-07-15 00:15:22,598 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: BUY, Qty: 0.01, Price: 0.89760975200000, Margin: 6.553644278697736876290841684, Commission: 0.10
2025-07-15 00:15:22,598 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 11, Symbol: AUDCAD, OrderType: BUY, Quantity: 0.01, FullMargin: 6.553644278697736876290841684
2025-07-15 00:15:22,598 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-15 00:15:22,598 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.553644278697736876290841684
2025-07-15 00:15:22,598 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-15 00:15:22,598 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-15 00:15:22,598 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 11, Symbol AUDCAD. Returning zero margin.
2025-07-15 00:15:22,599 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDCAD
2025-07-15 00:15:22,599 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDCAD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-15 00:15:22,599 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.3644278697736876290841684')], HighestMarginPerLot=655.3644278697736876290841684
2025-07-15 00:15:22,599 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDCAD: CalculatedTotalMargin=6.55
2025-07-15 00:15:22,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-15 00:15:22,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 11, Symbol: AUDCAD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.55, AdditionalMargin: 6.55, OpenOrders: 0
2025-07-15 00:15:22,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.553644278697736876290841684
2025-07-15 00:15:22,624 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 11: balance=99998.61000000, margin=6.55000000 (was 0E-8)
2025-07-15 00:15:22,625 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 11
2025-07-15 00:15:22,625 - INFO - orders - [PERF] Order processing: 0.4311s
2025-07-15 00:15:22,647 - INFO - orders - [PERF] Order creation: 0.0227s
2025-07-15 00:15:22,648 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-15 00:15:22,648 - INFO - orders - [PERF] TOTAL place_order: 0.4608s
2025-07-15 00:15:22,684 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDCAD
2025-07-15 00:15:22,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 00:15:22,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.364428')], HighestMarginPerLot=655.364428
2025-07-15 00:15:22,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDCAD: CalculatedTotalMargin=6.55
2025-07-15 00:15:22,685 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 6.55
2025-07-15 00:15:22,706 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDCAD
2025-07-15 00:15:22,707 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 00:15:22,707 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.364428')], HighestMarginPerLot=655.364428
2025-07-15 00:15:22,707 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDCAD: CalculatedTotalMargin=6.55
2025-07-15 00:15:22,707 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 6.55
2025-07-15 00:15:22,712 - INFO - orders - Background balance/margin cache updated for user 11: balance=99998.61000000, margin=6.55
2025-07-15 00:15:23,312 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 11
2025-07-15 00:15:59,600 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 00:15:59,600 - INFO - orders - Using order model: UserOrder
2025-07-15 00:15:59,613 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 00:15:59,619 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 00:15:59,621 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 00:15:59,625 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 00:15:59,625 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 00:15:59,625 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 00:15:59,626 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 00:15:59,626 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 00:15:59,630 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 00:16:59,506 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 00:16:59,507 - INFO - orders - Using order model: UserOrder
2025-07-15 00:16:59,514 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 00:16:59,519 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 00:16:59,521 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 00:16:59,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 00:16:59,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 00:16:59,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 00:16:59,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 00:16:59,528 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 00:16:59,535 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:28:09,432 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-15 01:28:10,939 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-15 01:28:10,940 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-15 01:28:10,940 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-15 01:28:10,941 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-15 01:28:15,011 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-15 01:28:15,011 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-15 01:28:15,953 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-15 01:28:20,953 - INFO - orders - Starting the users with orders cache updater task.
2025-07-15 01:28:21,855 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:28:21,856 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:28:21,856 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:28:21,856 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:28:21,856 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:28:32,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 01:28:32,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:28:32,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 01:28:32,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 01:28:32,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 01:28:32,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 01:28:32,978 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 01:28:32,978 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 01:28:32,978 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 01:28:32,990 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 01:28:32,990 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 01:28:32,990 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 01:28:32,990 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 01:28:32,990 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 01:29:10,395 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:29:10,395 - INFO - orders - Using order model: UserOrder
2025-07-15 01:29:10,408 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:29:10,413 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:29:10,416 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:29:10,429 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:29:10,429 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:29:10,429 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:29:10,430 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:29:10,430 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:29:10,444 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:30:10,351 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:30:10,351 - INFO - orders - Using order model: UserOrder
2025-07-15 01:30:10,356 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:30:10,359 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:30:10,360 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:30:10,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:30:10,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:30:10,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:30:10,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:30:10,365 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:30:10,368 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:31:10,358 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:31:10,359 - INFO - orders - Using order model: UserOrder
2025-07-15 01:31:10,363 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:31:10,368 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:31:10,370 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:31:10,374 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:31:10,374 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:31:10,375 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:31:10,375 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:31:10,375 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:31:10,379 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:32:10,236 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:32:10,236 - INFO - orders - Using order model: UserOrder
2025-07-15 01:32:10,243 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:32:10,247 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:32:10,249 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:32:10,254 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:32:10,254 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:32:10,254 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:32:10,255 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:32:10,255 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:32:10,258 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:33:10,368 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:33:10,368 - INFO - orders - Using order model: UserOrder
2025-07-15 01:33:10,373 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:33:10,377 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:33:10,378 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:33:10,383 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:33:10,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:33:10,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:33:10,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:33:10,384 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:33:10,388 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:33:16,590 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-15 01:33:33,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 01:33:33,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:33:33,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 01:33:33,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 01:33:33,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 01:33:33,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 01:33:33,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 01:33:33,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 01:33:33,541 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 01:33:33,551 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 01:33:33,551 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 01:33:33,551 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 01:33:33,552 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 01:33:33,552 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 01:34:10,370 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:34:10,370 - INFO - orders - Using order model: UserOrder
2025-07-15 01:34:10,375 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:34:10,379 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:34:10,382 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:34:10,388 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:34:10,389 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:34:10,389 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:34:10,389 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:34:10,389 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:34:10,393 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:35:10,274 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:35:10,274 - INFO - orders - Using order model: UserOrder
2025-07-15 01:35:10,279 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:35:10,283 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:35:10,284 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:35:10,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:35:10,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:35:10,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:35:10,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:35:10,288 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:35:10,291 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:35:14,180 - INFO - orders - Order placement request received - User: 14, Symbol: BTCUSD, Type: BUY
2025-07-15 01:35:14,683 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116815.0000000000', 'o': '116814.9000000000'}
2025-07-15 01:35:14,684 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116815.0000000000, ask=116826.68150000000000
2025-07-15 01:35:14,684 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116815.0000000000, ask=116826.68150000000000
2025-07-15 01:35:14,684 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.01, Price: 116826.68150000000000, Margin: 233.65, Commission: 5.84
2025-07-15 01:35:14,685 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 14, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.01, FullMargin: 233.65
2025-07-15 01:35:14,685 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-15 01:35:14,685 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=233.65
2025-07-15 01:35:14,685 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-15 01:35:14,686 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-15 01:35:14,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:35:14,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:35:14,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-15 01:35:14,687 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23365')], HighestMarginPerLot=23365
2025-07-15 01:35:14,687 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.65
2025-07-15 01:35:14,689 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-15 01:35:14,689 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 14, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 233.65, AdditionalMargin: 233.65, OpenOrders: 0
2025-07-15 01:35:14,689 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=233.65
2025-07-15 01:35:14,689 - INFO - orders - [PERF] Order processing: 0.5078s
2025-07-15 01:35:14,718 - INFO - orders - [PERF] Order creation: 0.0281s
2025-07-15 01:35:14,718 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-15 01:35:14,718 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-15 01:35:14,718 - INFO - orders - [PERF] TOTAL place_order: 0.5423s
2025-07-15 01:35:14,757 - INFO - orders - Background balance/margin cache updated for user 14: balance=9795.33000000, margin=0.0
2025-07-15 01:35:14,781 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-15 01:35:15,136 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 14
2025-07-15 01:36:10,135 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:36:10,135 - INFO - orders - Using order model: UserOrder
2025-07-15 01:36:10,139 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:36:10,142 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:36:10,143 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:36:10,146 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:36:10,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:36:10,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:36:10,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:36:10,147 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:36:10,149 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:37:10,337 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:37:10,337 - INFO - orders - Using order model: UserOrder
2025-07-15 01:37:10,344 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:37:10,347 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:37:10,348 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:37:10,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:37:10,354 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:37:10,354 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:37:10,354 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:37:10,354 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:37:10,359 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:37:11,321 - INFO - orders - Order 1000109-001 transitioning to OPEN. Calculating margin.
2025-07-15 01:37:11,321 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-15 01:37:11,323 - INFO - orders - Using group_name: Standard for order 1000109-001
2025-07-15 01:37:11,809 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-15 01:37:11,812 - INFO - orders - Using user's leverage from cache: 100.00
2025-07-15 01:37:11,812 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116781.6000000000', 'o': '116781.5000000000'}
2025-07-15 01:37:11,813 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116781.6000000000, ask=116793.27816000000000
2025-07-15 01:37:11,813 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116781.6000000000, ask=116793.27816000000000
2025-07-15 01:37:11,814 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.01000000, Price: 116793.27816000000000, Margin: 233.59, Commission: 5.84
2025-07-15 01:37:11,814 - INFO - orders - New margin calculated: 233.59, contract_value: 0.01
2025-07-15 01:37:11,814 - INFO - orders - [MARGIN] Final stored margin (USD): 233.59
2025-07-15 01:37:11,814 - INFO - orders - Recalculating total hedged margin for user 14 on symbol BTCUSD
2025-07-15 01:37:11,823 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-15 01:37:11,823 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:37:11,823 - INFO - orders - Old total margin for BTCUSD: 0.0
2025-07-15 01:37:11,823 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:37:11,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:37:11,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23359')], HighestMarginPerLot=23359
2025-07-15 01:37:11,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.59
2025-07-15 01:37:11,824 - INFO - orders - New total margin for BTCUSD: 233.59
2025-07-15 01:37:11,824 - INFO - orders - Margin change for user 14: 233.59
2025-07-15 01:37:11,835 - INFO - orders - User 14 margin updated from 0 to 233.59
2025-07-15 01:37:11,916 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-15 01:37:11,916 - INFO - orders - Using order model: UserOrder
2025-07-15 01:37:11,922 - INFO - orders - Fetched 1 open orders for user 14
2025-07-15 01:37:11,927 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-15 01:37:11,928 - INFO - orders - Updated static orders cache for user 14 with 1 open orders and 1 pending orders
2025-07-15 01:37:11,935 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:37:11,935 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:37:11,935 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23359')], HighestMarginPerLot=23359
2025-07-15 01:37:11,936 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.59
2025-07-15 01:37:11,936 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 233.59
2025-07-15 01:37:11,940 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9795.33000000, margin=233.59
2025-07-15 01:37:47,382 - INFO - orders - Add stoploss request received - Order ID: 1000109-001, User ID: 14
2025-07-15 01:37:47,437 - INFO - orders - Generated stoploss_id: 1000112-005 for order 1000109-001
2025-07-15 01:37:47,440 - INFO - orders - User 14 is_barclays_live_user: True
2025-07-15 01:37:47,440 - INFO - orders - Barclays user detected. Sending stoploss request to Firebase for order 1000109-001
2025-07-15 01:37:47,778 - INFO - orders - Stoploss request sent to Firebase for order 1000109-001
2025-07-15 01:38:10,382 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:38:10,382 - INFO - orders - Using order model: UserOrder
2025-07-15 01:38:10,386 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:38:10,389 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:38:10,390 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:38:10,393 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:38:10,394 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:38:10,394 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:38:10,394 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:38:10,394 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:38:10,396 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:38:32,123 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 130.049000000000000000000000 USD to USD for PnL (user_id: 14, position: 1000109-001)
2025-07-15 01:38:32,123 - INFO - orders - [CURRENCY_CONVERT] Currency is already USD, no conversion needed
2025-07-15 01:38:32,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:38:32,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:38:32,126 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23359')], HighestMarginPerLot=23359
2025-07-15 01:38:32,126 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.59
2025-07-15 01:38:32,126 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:38:32,179 - INFO - orders - Balance/margin cache updated for user 14: balance=9919.54000000, margin=0E-8
2025-07-15 01:38:32,179 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-15 01:38:32,179 - INFO - orders - Using order model: UserOrder
2025-07-15 01:38:32,181 - INFO - orders - Fetched 0 open orders for user 14
2025-07-15 01:38:32,182 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-15 01:38:32,183 - INFO - orders - Updated static orders cache for user 14 with 0 open orders and 1 pending orders
2025-07-15 01:38:32,186 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9919.54000000, margin=0.0
2025-07-15 01:38:33,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 01:38:33,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:38:33,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 01:38:33,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 01:38:33,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 01:38:33,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 01:38:33,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 01:38:33,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 01:38:33,720 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 01:38:33,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 01:38:33,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 01:38:33,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 01:38:33,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 01:38:33,726 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 01:38:34,122 - INFO - orders - [get_closed_orders] user_type: live
2025-07-15 01:39:10,283 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:39:10,283 - INFO - orders - Using order model: UserOrder
2025-07-15 01:39:10,285 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:39:10,286 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:39:10,287 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:39:10,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:39:10,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:39:10,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:39:10,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:39:10,288 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:39:10,290 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:45:06,191 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-15 01:45:07,530 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-15 01:45:07,530 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-15 01:45:07,530 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-15 01:45:07,530 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-15 01:45:11,675 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-15 01:45:11,675 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-15 01:45:12,520 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-15 01:45:17,522 - INFO - orders - Starting the users with orders cache updater task.
2025-07-15 01:45:18,592 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:45:18,592 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:45:18,592 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:45:18,592 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:45:18,592 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:45:33,360 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 01:45:33,360 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:45:33,360 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 01:45:33,360 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 01:45:33,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 01:45:33,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 01:45:33,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 01:45:33,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 01:45:33,361 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 01:45:33,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 01:45:33,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 01:45:33,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 01:45:33,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 01:45:33,392 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 01:46:06,932 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:46:06,933 - INFO - orders - Using order model: UserOrder
2025-07-15 01:46:06,935 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:46:06,937 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:46:06,939 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:46:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:46:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:46:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:46:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:46:06,941 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:46:06,945 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:46:29,542 - INFO - orders - Order placement request received - User: 14, Symbol: BTCUSD, Type: BUY
2025-07-15 01:46:29,894 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116817.1000000000', 'o': '116817.0000000000'}
2025-07-15 01:46:29,894 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116817.1000000000, ask=116828.78171000000000
2025-07-15 01:46:29,894 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116817.1000000000, ask=116828.78171000000000
2025-07-15 01:46:29,894 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.01, Price: 116828.78171000000000, Margin: 233.66, Commission: 5.84
2025-07-15 01:46:29,894 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 14, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.01, FullMargin: 233.66
2025-07-15 01:46:29,894 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-15 01:46:29,894 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=233.66
2025-07-15 01:46:29,894 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-15 01:46:29,895 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-15 01:46:29,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:46:29,896 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:46:29,896 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-15 01:46:29,896 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23366')], HighestMarginPerLot=23366
2025-07-15 01:46:29,896 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.66
2025-07-15 01:46:29,897 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-15 01:46:29,897 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 14, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 233.66, AdditionalMargin: 233.66, OpenOrders: 0
2025-07-15 01:46:29,898 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=233.66
2025-07-15 01:46:29,898 - INFO - orders - [PERF] Order processing: 0.3534s
2025-07-15 01:46:29,914 - INFO - orders - [PERF] Order creation: 0.0158s
2025-07-15 01:46:29,914 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-15 01:46:29,914 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-15 01:46:29,914 - INFO - orders - [PERF] TOTAL place_order: 0.3727s
2025-07-15 01:46:29,929 - INFO - orders - Background balance/margin cache updated for user 14: balance=9919.54000000, margin=0.0
2025-07-15 01:46:29,942 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-15 01:46:30,242 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 14
2025-07-15 01:47:01,107 - INFO - orders - Order 1000119-001 transitioning to OPEN. Calculating margin.
2025-07-15 01:47:01,107 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-15 01:47:01,108 - INFO - orders - Using group_name: Standard for order 1000119-001
2025-07-15 01:47:01,479 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-15 01:47:01,480 - INFO - orders - Using user's leverage from cache: 100.00
2025-07-15 01:47:01,480 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116825.3000000000', 'o': '116825.2000000000'}
2025-07-15 01:47:01,480 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116825.3000000000, ask=116836.98253000000000
2025-07-15 01:47:01,480 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116825.3000000000, ask=116836.98253000000000
2025-07-15 01:47:01,481 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.01000000, Price: 116836.98253000000000, Margin: 233.67, Commission: 5.84
2025-07-15 01:47:01,481 - INFO - orders - New margin calculated: 233.67, contract_value: 0.01
2025-07-15 01:47:01,481 - INFO - orders - [MARGIN] Final stored margin (USD): 233.67
2025-07-15 01:47:01,481 - INFO - orders - Recalculating total hedged margin for user 14 on symbol BTCUSD
2025-07-15 01:47:01,487 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-15 01:47:01,487 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:47:01,488 - INFO - orders - Old total margin for BTCUSD: 0.0
2025-07-15 01:47:01,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:47:01,489 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:47:01,489 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23367')], HighestMarginPerLot=23367
2025-07-15 01:47:01,489 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.67
2025-07-15 01:47:01,490 - INFO - orders - New total margin for BTCUSD: 233.67
2025-07-15 01:47:01,490 - INFO - orders - Margin change for user 14: 233.67
2025-07-15 01:47:01,503 - INFO - orders - User 14 margin updated from 0 to 233.67
2025-07-15 01:47:01,578 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-15 01:47:01,579 - INFO - orders - Using order model: UserOrder
2025-07-15 01:47:01,583 - INFO - orders - Fetched 1 open orders for user 14
2025-07-15 01:47:01,588 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-15 01:47:01,589 - INFO - orders - Updated static orders cache for user 14 with 1 open orders and 1 pending orders
2025-07-15 01:47:01,595 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:47:01,596 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:47:01,596 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23367')], HighestMarginPerLot=23367
2025-07-15 01:47:01,596 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.67
2025-07-15 01:47:01,596 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 233.67
2025-07-15 01:47:01,601 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9919.54000000, margin=233.67
2025-07-15 01:47:07,037 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:47:07,037 - INFO - orders - Using order model: UserOrder
2025-07-15 01:47:07,045 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:47:07,052 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:47:07,054 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:47:07,058 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:47:07,059 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:47:07,059 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:47:07,059 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:47:07,059 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:47:07,065 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:47:13,180 - INFO - orders - Add takeprofit request received - Order ID: 1000119-001, User ID: 14
2025-07-15 01:47:13,207 - INFO - orders - Generated takeprofit_id: 1000121-006 for order 1000119-001
2025-07-15 01:47:13,209 - INFO - orders - User 14 is_barclays_live_user: True
2025-07-15 01:47:13,210 - INFO - orders - Barclays user detected. Sending takeprofit request to Firebase for order 1000119-001
2025-07-15 01:47:13,558 - INFO - orders - Takeprofit request sent to Firebase for order 1000119-001
2025-07-15 01:48:07,286 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:48:07,286 - INFO - orders - Using order model: UserOrder
2025-07-15 01:48:07,292 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:48:07,297 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:48:07,298 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:48:07,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:48:07,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:48:07,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:48:07,307 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:48:07,307 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:48:07,312 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:48:09,790 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 0E-24 USD to USD for PnL (user_id: 14, position: 1000119-001)
2025-07-15 01:48:09,790 - INFO - orders - [CURRENCY_CONVERT] Currency is already USD, no conversion needed
2025-07-15 01:48:09,794 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:48:09,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:48:09,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23367')], HighestMarginPerLot=23367
2025-07-15 01:48:09,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.67
2025-07-15 01:48:09,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:48:09,877 - INFO - orders - Balance/margin cache updated for user 14: balance=9913.70000000, margin=0E-8
2025-07-15 01:48:09,878 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-15 01:48:09,878 - INFO - orders - Using order model: UserOrder
2025-07-15 01:48:09,880 - INFO - orders - Fetched 0 open orders for user 14
2025-07-15 01:48:09,883 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-15 01:48:09,884 - INFO - orders - Updated static orders cache for user 14 with 0 open orders and 1 pending orders
2025-07-15 01:48:09,892 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9913.70000000, margin=0.0
2025-07-15 01:48:11,972 - INFO - orders - [get_closed_orders] user_type: live
2025-07-15 01:48:18,575 - INFO - orders - Order placement request received - User: 14, Symbol: BTCUSD, Type: BUY
2025-07-15 01:48:19,044 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116814.7000000000', 'o': '116814.6000000000'}
2025-07-15 01:48:19,044 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116814.7000000000, ask=116826.38147000000000
2025-07-15 01:48:19,044 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116814.7000000000, ask=116826.38147000000000
2025-07-15 01:48:19,044 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.01, Price: 116826.38147000000000, Margin: 233.65, Commission: 5.84
2025-07-15 01:48:19,045 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 14, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.01, FullMargin: 233.65
2025-07-15 01:48:19,045 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-15 01:48:19,045 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=233.65
2025-07-15 01:48:19,045 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-15 01:48:19,045 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-15 01:48:19,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:48:19,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:48:19,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-15 01:48:19,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23365')], HighestMarginPerLot=23365
2025-07-15 01:48:19,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.65
2025-07-15 01:48:19,047 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-15 01:48:19,047 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 14, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 233.65, AdditionalMargin: 233.65, OpenOrders: 0
2025-07-15 01:48:19,048 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=233.65
2025-07-15 01:48:19,048 - INFO - orders - [PERF] Order processing: 0.4716s
2025-07-15 01:48:19,066 - INFO - orders - [PERF] Order creation: 0.0182s
2025-07-15 01:48:19,067 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-15 01:48:19,067 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-15 01:48:19,067 - INFO - orders - [PERF] TOTAL place_order: 0.4922s
2025-07-15 01:48:19,098 - INFO - orders - Background balance/margin cache updated for user 14: balance=9913.70000000, margin=0.0
2025-07-15 01:48:19,114 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-15 01:48:19,505 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 14
2025-07-15 01:49:00,549 - INFO - orders - Order 1000126-001 transitioning to OPEN. Calculating margin.
2025-07-15 01:49:00,549 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-15 01:49:00,550 - INFO - orders - Using group_name: Standard for order 1000126-001
2025-07-15 01:49:00,874 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-15 01:49:00,874 - INFO - orders - Using user's leverage from cache: 100.00
2025-07-15 01:49:00,874 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116766.5000000000', 'o': '116766.4000000000'}
2025-07-15 01:49:00,874 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116766.5000000000, ask=116778.17665000000000
2025-07-15 01:49:00,875 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116766.5000000000, ask=116778.17665000000000
2025-07-15 01:49:00,875 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.01000000, Price: 116778.17665000000000, Margin: 233.56, Commission: 5.84
2025-07-15 01:49:00,875 - INFO - orders - New margin calculated: 233.56, contract_value: 0.01
2025-07-15 01:49:00,875 - INFO - orders - [MARGIN] Final stored margin (USD): 233.56
2025-07-15 01:49:00,875 - INFO - orders - Recalculating total hedged margin for user 14 on symbol BTCUSD
2025-07-15 01:49:00,878 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-15 01:49:00,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:49:00,878 - INFO - orders - Old total margin for BTCUSD: 0.0
2025-07-15 01:49:00,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:49:00,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:49:00,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23356')], HighestMarginPerLot=23356
2025-07-15 01:49:00,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.56
2025-07-15 01:49:00,878 - INFO - orders - New total margin for BTCUSD: 233.56
2025-07-15 01:49:00,878 - INFO - orders - Margin change for user 14: 233.56
2025-07-15 01:49:00,881 - INFO - orders - User 14 margin updated from 0 to 233.56
2025-07-15 01:49:00,935 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-15 01:49:00,935 - INFO - orders - Using order model: UserOrder
2025-07-15 01:49:00,937 - INFO - orders - Fetched 1 open orders for user 14
2025-07-15 01:49:00,940 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-15 01:49:00,940 - INFO - orders - Updated static orders cache for user 14 with 1 open orders and 1 pending orders
2025-07-15 01:49:00,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:49:00,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:49:00,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23356')], HighestMarginPerLot=23356
2025-07-15 01:49:00,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.56
2025-07-15 01:49:00,944 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 233.56
2025-07-15 01:49:00,946 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9913.70000000, margin=233.56
2025-07-15 01:49:07,063 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:49:07,065 - INFO - orders - Using order model: UserOrder
2025-07-15 01:49:07,068 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:49:07,071 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:49:07,071 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:49:07,073 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:49:07,074 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:49:07,074 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:49:07,074 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:49:07,074 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:49:07,075 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:49:07,555 - INFO - orders - Order close request received - Order ID: 1000126-001, User ID: 14, Close Price: 116716.4
2025-07-15 01:49:07,555 - INFO - orders - Request to close order 1000126-001 for user 14 (user_type: live) with price 116716.4. Frontend provided type: BUY, company: BTCUSD, status: CLOSED, frontend_status: CLOSED.
2025-07-15 01:49:07,575 - INFO - orders - User group: Standard, sending_orders setting: barclays
2025-07-15 01:49:07,575 - INFO - orders - Live user 14 from group 'Standard' has 'sending_orders' set to 'barclays'. Pushing close request to Firebase and skipping local DB update.
2025-07-15 01:49:07,580 - INFO - orders - [FIREBASE_CLOSE_REQUEST] Preparing to send payload for user-initiated close: {'order_id': '1000126-001', 'close_price': '116716.4', 'user_id': 14, 'order_type': 'BUY', 'order_company_name': 'BTCUSD', 'order_quantity': '0.01000000', 'contract_value': '0.01000000', 'order_status': 'CLOSED', 'status': 'CLOSED', 'action': 'close_order', 'close_id': '1000128-003'}
2025-07-15 01:50:07,070 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 01:50:07,071 - INFO - orders - Using order model: UserOrder
2025-07-15 01:50:07,074 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 01:50:07,077 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 01:50:07,077 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 01:50:07,081 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 01:50:07,081 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 01:50:07,081 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 01:50:07,081 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 01:50:07,081 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 01:50:07,083 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 01:50:16,454 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 0E-24 USD to USD for PnL (user_id: 14, position: 1000126-001)
2025-07-15 01:50:16,455 - INFO - orders - [CURRENCY_CONVERT] Currency is already USD, no conversion needed
2025-07-15 01:50:16,457 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 01:50:16,457 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 01:50:16,457 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23356')], HighestMarginPerLot=23356
2025-07-15 01:50:16,457 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.56
2025-07-15 01:50:16,457 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 01:50:16,547 - INFO - orders - Balance/margin cache updated for user 14: balance=9907.86000000, margin=0E-8
2025-07-15 01:50:16,547 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-15 01:50:16,547 - INFO - orders - Using order model: UserOrder
2025-07-15 01:50:16,549 - INFO - orders - Fetched 0 open orders for user 14
2025-07-15 01:50:16,551 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-15 01:50:16,552 - INFO - orders - Updated static orders cache for user 14 with 0 open orders and 1 pending orders
2025-07-15 01:50:16,556 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9907.86000000, margin=0.0
2025-07-15 01:50:18,173 - INFO - orders - [get_closed_orders] user_type: live
2025-07-15 02:01:13,691 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-15 02:01:15,102 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-15 02:01:15,102 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-15 02:01:15,102 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-15 02:01:15,102 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-15 02:01:19,203 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-15 02:01:19,203 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-15 02:01:20,113 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-15 02:01:25,115 - INFO - orders - Starting the users with orders cache updater task.
2025-07-15 02:01:26,025 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:01:26,025 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:01:26,025 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:01:26,025 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:01:26,026 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:01:39,448 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 02:01:39,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 02:01:39,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 02:01:39,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 02:01:39,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 02:01:39,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 02:01:39,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 02:01:39,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 02:01:39,450 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 02:01:39,486 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 02:01:39,486 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 02:01:39,487 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 02:01:39,487 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 02:01:39,487 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 02:01:41,186 - INFO - orders - Order placement request received - User: 14, Symbol: BTCUSD, Type: BUY
2025-07-15 02:01:41,635 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116770.6000000000', 'o': '116770.5000000000'}
2025-07-15 02:01:41,636 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116770.6000000000, ask=116782.27706000000000
2025-07-15 02:01:41,636 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116770.6000000000, ask=116782.27706000000000
2025-07-15 02:01:41,636 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.01, Price: 116782.27706000000000, Margin: 233.56, Commission: 5.84
2025-07-15 02:01:41,636 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 14, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.01, FullMargin: 233.56
2025-07-15 02:01:41,636 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-15 02:01:41,637 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=233.56
2025-07-15 02:01:41,637 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-15 02:01:41,637 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-15 02:01:41,639 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 02:01:41,639 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 02:01:41,640 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-15 02:01:41,640 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23356')], HighestMarginPerLot=23356
2025-07-15 02:01:41,640 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.56
2025-07-15 02:01:41,641 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-15 02:01:41,642 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 14, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 233.56, AdditionalMargin: 233.56, OpenOrders: 0
2025-07-15 02:01:41,642 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=233.56
2025-07-15 02:01:41,642 - INFO - orders - [PERF] Order processing: 0.4515s
2025-07-15 02:01:41,677 - INFO - orders - [PERF] Order creation: 0.0347s
2025-07-15 02:01:41,677 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-15 02:01:41,677 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-15 02:01:41,678 - INFO - orders - [PERF] TOTAL place_order: 0.4928s
2025-07-15 02:01:41,738 - INFO - orders - Background balance/margin cache updated for user 14: balance=9907.86000000, margin=0.0
2025-07-15 02:01:41,782 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-15 02:01:42,089 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 14
2025-07-15 02:02:14,515 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:02:14,515 - INFO - orders - Using order model: UserOrder
2025-07-15 02:02:14,520 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:02:14,523 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:02:14,524 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:02:14,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:02:14,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:02:14,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:02:14,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:02:14,530 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:02:14,533 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:03:10,185 - INFO - orders - Order 1000133-001 transitioning to OPEN. Calculating margin.
2025-07-15 02:03:10,185 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-15 02:03:10,186 - INFO - orders - Using group_name: Standard for order 1000133-001
2025-07-15 02:03:10,586 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-15 02:03:10,604 - INFO - orders - Using user's leverage from cache: 100.00
2025-07-15 02:03:10,604 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116805.0000000000', 'o': '116804.9000000000'}
2025-07-15 02:03:10,605 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116805.0000000000, ask=116816.68050000000000
2025-07-15 02:03:10,605 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116805.0000000000, ask=116816.68050000000000
2025-07-15 02:03:10,605 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.01000000, Price: 116816.68050000000000, Margin: 233.63, Commission: 5.84
2025-07-15 02:03:10,605 - INFO - orders - New margin calculated: 233.63, contract_value: 0.01
2025-07-15 02:03:10,605 - INFO - orders - [MARGIN] Final stored margin (USD): 233.63
2025-07-15 02:03:10,605 - INFO - orders - Recalculating total hedged margin for user 14 on symbol BTCUSD
2025-07-15 02:03:10,610 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-15 02:03:10,610 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 02:03:10,610 - INFO - orders - Old total margin for BTCUSD: 0.0
2025-07-15 02:03:10,610 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 02:03:10,611 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 02:03:10,611 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23363')], HighestMarginPerLot=23363
2025-07-15 02:03:10,611 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.63
2025-07-15 02:03:10,611 - INFO - orders - New total margin for BTCUSD: 233.63
2025-07-15 02:03:10,611 - INFO - orders - Margin change for user 14: 233.63
2025-07-15 02:03:10,618 - INFO - orders - User 14 margin updated from 0 to 233.63
2025-07-15 02:03:10,667 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-15 02:03:10,667 - INFO - orders - Using order model: UserOrder
2025-07-15 02:03:10,670 - INFO - orders - Fetched 1 open orders for user 14
2025-07-15 02:03:10,674 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-15 02:03:10,675 - INFO - orders - Updated static orders cache for user 14 with 1 open orders and 1 pending orders
2025-07-15 02:03:10,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 02:03:10,681 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 02:03:10,681 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23363')], HighestMarginPerLot=23363
2025-07-15 02:03:10,681 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.63
2025-07-15 02:03:10,681 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 233.63
2025-07-15 02:03:10,685 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9907.86000000, margin=233.63
2025-07-15 02:03:14,715 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:03:14,715 - INFO - orders - Using order model: UserOrder
2025-07-15 02:03:14,719 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:03:14,722 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:03:14,723 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:03:14,727 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:03:14,727 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:03:14,727 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:03:14,727 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:03:14,727 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:03:14,729 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:03:18,784 - INFO - orders - Add stoploss request received - Order ID: 1000133-001, User ID: 14
2025-07-15 02:03:18,817 - INFO - orders - Generated stoploss_id: 1000136-005 for order 1000133-001
2025-07-15 02:03:18,820 - INFO - orders - User 14 is_barclays_live_user: True
2025-07-15 02:03:18,820 - INFO - orders - Barclays user detected. Sending stoploss request to Firebase for order 1000133-001
2025-07-15 02:03:19,176 - INFO - orders - Stoploss request sent to Firebase for order 1000133-001
2025-07-15 02:03:58,712 - INFO - orders - Add takeprofit request received - Order ID: 1000133-001, User ID: 14
2025-07-15 02:03:58,758 - INFO - orders - Generated takeprofit_id: 1000137-006 for order 1000133-001
2025-07-15 02:03:58,760 - INFO - orders - User 14 is_barclays_live_user: True
2025-07-15 02:03:58,762 - INFO - orders - Barclays user detected. Sending takeprofit request to Firebase for order 1000133-001
2025-07-15 02:03:59,215 - INFO - orders - Takeprofit request sent to Firebase for order 1000133-001
2025-07-15 02:04:14,737 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:04:14,737 - INFO - orders - Using order model: UserOrder
2025-07-15 02:04:14,748 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:04:14,759 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:04:14,766 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:04:14,778 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:04:14,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:04:14,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:04:14,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:04:14,779 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:04:14,785 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:05:14,420 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:05:14,420 - INFO - orders - Using order model: UserOrder
2025-07-15 02:05:14,424 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:05:14,427 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:05:14,428 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:05:14,433 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:05:14,433 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:05:14,433 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:05:14,433 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:05:14,433 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:05:14,436 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:05:23,270 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 0E-24 USD to USD for PnL (user_id: 14, position: 1000133-001)
2025-07-15 02:05:23,270 - INFO - orders - [CURRENCY_CONVERT] Currency is already USD, no conversion needed
2025-07-15 02:05:23,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-15 02:05:23,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 02:05:23,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23363')], HighestMarginPerLot=23363
2025-07-15 02:05:23,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=233.63
2025-07-15 02:05:23,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 14, Symbol BTCUSD. Returning zero margin.
2025-07-15 02:05:23,360 - INFO - orders - Balance/margin cache updated for user 14: balance=9902.02000000, margin=0E-8
2025-07-15 02:05:23,360 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-15 02:05:23,361 - INFO - orders - Using order model: UserOrder
2025-07-15 02:05:23,364 - INFO - orders - Fetched 0 open orders for user 14
2025-07-15 02:05:23,368 - INFO - orders - Fetched 1 pending orders for user 14
2025-07-15 02:05:23,369 - INFO - orders - Updated static orders cache for user 14 with 0 open orders and 1 pending orders
2025-07-15 02:05:23,377 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=0.0
2025-07-15 02:05:27,053 - INFO - orders - [get_closed_orders] user_type: live
2025-07-15 02:23:04,519 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-15 02:23:06,935 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-15 02:23:06,967 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-15 02:23:06,967 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-15 02:23:06,969 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-15 02:23:11,098 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-15 02:23:11,098 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-15 02:23:11,940 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-15 02:23:16,938 - INFO - orders - Starting the users with orders cache updater task.
2025-07-15 02:23:19,999 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:23:19,999 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:23:19,999 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:23:19,999 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:23:19,999 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:23:28,785 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 02:23:28,785 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 02:23:28,785 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 02:23:28,785 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 02:23:28,785 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 02:23:28,785 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 02:23:28,785 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 02:23:28,785 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 02:23:28,786 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 02:23:28,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 02:23:28,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 02:23:28,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 02:23:28,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 02:23:28,825 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 02:24:05,939 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:24:05,939 - INFO - orders - Using order model: UserOrder
2025-07-15 02:24:05,943 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:24:05,946 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:24:05,947 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:24:05,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:24:05,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:24:05,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:24:05,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:24:05,951 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:24:05,954 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:25:05,490 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:25:05,490 - INFO - orders - Using order model: UserOrder
2025-07-15 02:25:05,495 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:25:05,499 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:25:05,503 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:25:05,514 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:25:05,515 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:25:05,515 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:25:05,515 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:25:05,515 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:25:05,523 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:26:05,321 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:26:05,321 - INFO - orders - Using order model: UserOrder
2025-07-15 02:26:05,326 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:26:05,329 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:26:05,331 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:26:05,335 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:26:05,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:26:05,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:26:05,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:26:05,337 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:26:05,373 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:27:05,447 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:27:05,447 - INFO - orders - Using order model: UserOrder
2025-07-15 02:27:05,462 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:27:05,468 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:27:05,471 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:27:05,485 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:27:05,485 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:27:05,485 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:27:05,485 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:27:05,485 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:27:05,496 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:28:05,340 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:28:05,341 - INFO - orders - Using order model: UserOrder
2025-07-15 02:28:05,344 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:28:05,347 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:28:05,349 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:28:05,352 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:28:05,352 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:28:05,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:28:05,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:28:05,353 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:28:05,355 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:28:29,101 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 02:28:29,101 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 02:28:29,101 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 02:28:29,101 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 02:28:29,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 02:28:29,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 02:28:29,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 02:28:29,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 02:28:29,102 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 02:28:29,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 02:28:29,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 02:28:29,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 02:28:29,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 02:28:29,114 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 02:29:05,441 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:29:05,441 - INFO - orders - Using order model: UserOrder
2025-07-15 02:29:05,444 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:29:05,446 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:29:05,447 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:29:05,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:29:05,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:29:05,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:29:05,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:29:05,451 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:29:05,453 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:30:05,447 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:30:05,447 - INFO - orders - Using order model: UserOrder
2025-07-15 02:30:05,452 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:30:05,454 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:30:05,455 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:30:05,459 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:30:05,459 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:30:05,459 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:30:05,459 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:30:05,459 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:30:05,462 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:31:05,457 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:31:05,457 - INFO - orders - Using order model: UserOrder
2025-07-15 02:31:05,460 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:31:05,462 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:31:05,462 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:31:05,465 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:31:05,465 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:31:05,465 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:31:05,465 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:31:05,465 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:31:05,468 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:32:05,257 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:32:05,257 - INFO - orders - Using order model: UserOrder
2025-07-15 02:32:05,261 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:32:05,263 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:32:05,264 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:32:05,266 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:32:05,266 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:32:05,266 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:32:05,266 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:32:05,266 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:32:05,269 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:32:40,065 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-15 02:32:41,270 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-15 02:32:41,270 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-15 02:32:41,270 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-15 02:32:41,270 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-15 02:32:45,359 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-15 02:32:45,359 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-15 02:32:46,277 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-15 02:32:51,275 - INFO - orders - Starting the users with orders cache updater task.
2025-07-15 02:33:41,001 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:33:41,001 - INFO - orders - Using order model: UserOrder
2025-07-15 02:33:41,005 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:33:41,009 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:33:41,011 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:33:41,015 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:33:41,015 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:33:41,015 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:33:41,015 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:33:41,016 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:33:41,019 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:34:41,109 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:34:41,109 - INFO - orders - Using order model: UserOrder
2025-07-15 02:34:41,120 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:34:41,127 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:34:41,130 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:34:41,136 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:34:41,136 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:34:41,136 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:34:41,136 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:34:41,136 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:34:41,140 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:35:41,059 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:35:41,059 - INFO - orders - Using order model: UserOrder
2025-07-15 02:35:41,071 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:35:41,078 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:35:41,083 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:35:41,092 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:35:41,093 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:35:41,093 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:35:41,093 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:35:41,093 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:35:41,099 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:36:41,444 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:36:41,445 - INFO - orders - Using order model: UserOrder
2025-07-15 02:36:41,452 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:36:41,455 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:36:41,458 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:36:41,472 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:36:41,472 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:36:41,472 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:36:41,473 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:36:41,473 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:36:41,481 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:37:41,004 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:37:41,004 - INFO - orders - Using order model: UserOrder
2025-07-15 02:37:41,010 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:37:41,013 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:37:41,015 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:37:41,019 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:37:41,019 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:37:41,019 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:37:41,020 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:37:41,020 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:37:41,022 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:37:55,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 02:37:55,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 02:37:55,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 02:37:55,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 02:37:55,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 02:37:55,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 02:37:55,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 02:37:55,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 02:37:55,385 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 02:37:55,431 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 02:37:55,432 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 02:37:55,432 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 02:37:55,432 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 02:37:55,432 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 02:38:41,213 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:38:41,215 - INFO - orders - Using order model: UserOrder
2025-07-15 02:38:41,232 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:38:41,270 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:38:41,272 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:38:41,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:38:41,299 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:38:41,299 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:38:41,305 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:38:41,305 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:38:41,320 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:39:40,854 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:39:40,854 - INFO - orders - Using order model: UserOrder
2025-07-15 02:39:40,856 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:39:40,857 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:39:40,858 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:39:40,860 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:39:40,861 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:39:40,861 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:39:40,861 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:39:40,861 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:39:40,864 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:40:41,041 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:40:41,041 - INFO - orders - Using order model: UserOrder
2025-07-15 02:40:41,045 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:40:41,048 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:40:41,050 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:40:41,054 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:40:41,055 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:40:41,055 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:40:41,055 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:40:41,055 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:40:41,061 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:40:58,454 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-15 02:41:00,080 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-15 02:41:00,080 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-15 02:41:00,081 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-15 02:41:00,081 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-15 02:41:04,179 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-15 02:41:04,179 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-15 02:41:05,095 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-15 02:41:10,089 - INFO - orders - Starting the users with orders cache updater task.
2025-07-15 02:41:26,954 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-15 02:41:27,883 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-15 02:41:27,883 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-15 02:41:27,883 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-15 02:41:27,883 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-15 02:41:32,010 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-15 02:41:32,010 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-15 02:41:32,892 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-15 02:41:37,883 - INFO - orders - Starting the users with orders cache updater task.
2025-07-15 02:42:28,017 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:42:28,017 - INFO - orders - Using order model: UserOrder
2025-07-15 02:42:28,022 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:42:28,026 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:42:28,027 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:42:28,032 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:42:28,032 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:42:28,032 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:42:28,032 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:42:28,032 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:42:28,035 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:43:27,845 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:43:27,846 - INFO - orders - Using order model: UserOrder
2025-07-15 02:43:27,852 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:43:27,855 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:43:27,856 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:43:27,861 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:43:27,862 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:43:27,862 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:43:27,862 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:43:27,862 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:43:27,866 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:44:27,951 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:44:27,951 - INFO - orders - Using order model: UserOrder
2025-07-15 02:44:27,958 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:44:27,962 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:44:27,963 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:44:27,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:44:27,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:44:27,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:44:27,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:44:27,968 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:44:27,974 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:45:27,852 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:45:27,852 - INFO - orders - Using order model: UserOrder
2025-07-15 02:45:27,856 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:45:27,859 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:45:27,861 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:45:27,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:45:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:45:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:45:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:45:27,866 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:45:27,869 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:46:27,864 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:46:27,864 - INFO - orders - Using order model: UserOrder
2025-07-15 02:46:27,869 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:46:27,873 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:46:27,875 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:46:27,880 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:46:27,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:46:27,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:46:27,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:46:27,881 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:46:27,885 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:46:42,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-15 02:46:42,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-15 02:46:42,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-15 02:46:42,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-15 02:46:42,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-15 02:46:42,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-15 02:46:42,782 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-15 02:46:42,782 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-15 02:46:42,782 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-15 02:46:42,800 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-15 02:46:42,801 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-15 02:46:42,801 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-15 02:46:42,801 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-15 02:46:42,801 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-15 02:47:27,862 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:47:27,862 - INFO - orders - Using order model: UserOrder
2025-07-15 02:47:27,866 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:47:27,868 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:47:27,869 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:47:27,873 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:47:27,873 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:47:27,873 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:47:27,873 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:47:27,873 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:47:27,876 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-15 02:48:27,878 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-15 02:48:27,878 - INFO - orders - Using order model: UserOrder
2025-07-15 02:48:27,884 - INFO - orders - Fetched 1 open orders for user 4
2025-07-15 02:48:27,888 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-15 02:48:27,889 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-15 02:48:27,894 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-15 02:48:27,894 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-15 02:48:27,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-15 02:48:27,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-15 02:48:27,895 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-15 02:48:27,900 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
