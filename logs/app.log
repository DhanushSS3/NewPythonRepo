2025-07-10 21:09:54,312 - INFO - app - Application shutdown initiated
2025-07-10 21:09:54,312 - INFO - app - Scheduler shutdown completed
2025-07-10 21:09:54,365 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 21:09:55,842 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 21:09:55,842 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 21:09:55,845 - INFO - app - Redis connection closed
2025-07-10 21:09:55,846 - INFO - app - Application shutdown completed
2025-07-10 21:10:00,688 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 21:10:00,704 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:10:00,717 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:10:00,717 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:10:00,989 - INFO - app - Application starting up - Trading system initialized
2025-07-10 21:10:00,989 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 21:10:00,989 - INFO - app - Environment: PRODUCTION
2025-07-10 21:10:01,041 - INFO - app - Application startup initiated
2025-07-10 21:10:01,041 - INFO - app - Initializing core services...
2025-07-10 21:10:01,072 - INFO - app - Firebase initialized
2025-07-10 21:10:01,072 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 21:10:03,111 - INFO - app - Redis initialized
2025-07-10 21:10:03,115 - INFO - app - Scheduler initialized
2025-07-10 21:10:03,117 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 21:10:03,118 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 21:10:04,224 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 21:10:04,225 - INFO - app - Starting stale cache cleanup task
2025-07-10 21:10:08,288 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 21:10:08,288 - INFO - app - Background tasks initialized
2025-07-10 21:10:08,913 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 21:10:08,913 - INFO - app - Application startup completed successfully
2025-07-10 21:10:08,914 - INFO - app - Starting cache validation task
2025-07-10 21:10:08,916 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-10 21:10:08,916 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:10:08,931 - INFO - app - Validating cache for 10 users
2025-07-10 21:10:08,931 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:10:10,958 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 21:10:15,013 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 21:10:17,046 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 21:10:17,046 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:10:21,118 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 21:10:21,120 - INFO - app - [BarclaysMarginChecker] Skipping user 4: no dynamic_portfolio in cache.
2025-07-10 21:10:21,136 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 21:10:21,138 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:10:21,151 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 21:10:21,151 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:10:21,151 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 21:10:21,152 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 21:10:21,152 - INFO - app - Completed stale cache cleanup task
2025-07-10 21:10:21,154 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:10:21,159 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:10:23,926 - INFO - app - Starting stale cache cleanup task
2025-07-10 21:10:25,276 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 21:10:25,279 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 21:10:25,281 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 21:10:25,283 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 21:10:25,286 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 21:10:25,287 - INFO - app - Cache validation completed
2025-07-10 21:10:27,321 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 21:10:27,325 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 21:10:27,325 - INFO - app - Completed stale cache cleanup task
2025-07-10 21:10:28,287 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 21:10:28,287 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 21:10:28,451 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:10:28,457 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:10:28,465 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:10:28,465 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:10:28,470 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:10:28,470 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:11:03,627 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:11:03,656 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:11:03,680 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:11:03,683 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:11:03,702 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:11:21,171 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:11:21,172 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:11:21,178 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:11:21,180 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:11:21,185 - INFO - app - [BarclaysMarginChecker] User 4: free_margin=476.31046069915885, total_pending_margin=1317.9967803, pending_orders=3, margin=5800.0
2025-07-10 21:11:21,185 - WARNING - app - [BarclaysMarginChecker] Cancelling order 9627043752 for user 4 (order_margin=6.54835538) due to insufficient margin.
2025-07-10 21:11:21,228 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '9627043752', 'cancel_id': '9931262237', 'user_id': '4', 'order_type': 'SELL_LIMIT', 'timestamp': '2025-07-11T04:11:21.228077', 'status': 'PENDING', 'order_quantity': '0.01000000', 'order_status': 'CANCELLED', 'contract_value': '1000.00000000', 'cancel_message': 'Auto-cancelled due to insufficient margin', 'account_type': 'live'}
2025-07-10 21:11:21,617 - INFO - app.core.firebase - Order data (ID: 9627043752) sent to Firebase successfully.
2025-07-10 21:11:21,631 - ERROR - app - Error in barclays_pending_order_margin_checker loop: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\main.py", line 1274, in barclays_pending_order_margin_checker
    db_user = await get_user_by_id(db, user_id=user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 21:12:03,507 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:12:03,518 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:12:03,529 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:12:03,530 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:12:03,536 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:12:21,638 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:12:21,638 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:12:21,641 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:12:21,642 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:12:21,644 - INFO - app - [BarclaysMarginChecker] User 4: free_margin=476.4567289020801, total_pending_margin=1311.44842492, pending_orders=2, margin=5800.0
2025-07-10 21:12:21,644 - WARNING - app - [BarclaysMarginChecker] Cancelling order 3128757828 for user 4 (order_margin=655.71792971) due to insufficient margin.
2025-07-10 21:12:21,660 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '3128757828', 'cancel_id': '2745333630', 'user_id': '4', 'order_type': 'SELL_LIMIT', 'timestamp': '2025-07-11T04:12:21.660258', 'status': 'PENDING', 'order_quantity': '1.00000000', 'order_status': 'CANCELLED', 'contract_value': '100000.00000000', 'cancel_message': 'Auto-cancelled due to insufficient margin', 'account_type': 'live'}
2025-07-10 21:12:22,031 - INFO - app.core.firebase - Order data (ID: 3128757828) sent to Firebase successfully.
2025-07-10 21:12:22,045 - ERROR - app - Error in barclays_pending_order_margin_checker loop: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\main.py", line 1274, in barclays_pending_order_margin_checker
    db_user = await get_user_by_id(db, user_id=user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 21:13:03,514 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:13:03,523 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:13:03,530 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:13:03,532 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:13:03,539 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:13:22,050 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:13:22,050 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:13:22,055 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:13:22,057 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:13:22,061 - INFO - app - [BarclaysMarginChecker] User 4: free_margin=476.5106929454053, total_pending_margin=655.73049521, pending_orders=1, margin=5800.0
2025-07-10 21:13:22,061 - WARNING - app - [BarclaysMarginChecker] Cancelling order 5045010173 for user 4 (order_margin=655.73049521) due to insufficient margin.
2025-07-10 21:13:22,083 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '5045010173', 'cancel_id': '4485370031', 'user_id': '4', 'order_type': 'SELL_LIMIT', 'timestamp': '2025-07-11T04:13:22.083646', 'status': 'PENDING', 'order_quantity': '1.00000000', 'order_status': 'CANCELLED', 'contract_value': '100000.00000000', 'cancel_message': 'Auto-cancelled due to insufficient margin', 'account_type': 'live'}
2025-07-10 21:13:22,445 - INFO - app.core.firebase - Order data (ID: 5045010173) sent to Firebase successfully.
2025-07-10 21:13:22,458 - ERROR - app - Error in barclays_pending_order_margin_checker loop: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\main.py", line 1274, in barclays_pending_order_margin_checker
    db_user = await get_user_by_id(db, user_id=user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 21:13:43,387 - INFO - app - Application shutdown initiated
2025-07-10 21:13:43,388 - INFO - app - Scheduler shutdown completed
2025-07-10 21:13:43,534 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 21:13:44,157 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 21:13:44,157 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 21:13:44,159 - INFO - app - Redis connection closed
2025-07-10 21:13:44,160 - INFO - app - Application shutdown completed
2025-07-10 21:13:45,963 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 21:13:45,978 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:13:45,988 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:13:45,989 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:13:46,267 - INFO - app - Application starting up - Trading system initialized
2025-07-10 21:13:46,267 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 21:13:46,267 - INFO - app - Environment: PRODUCTION
2025-07-10 21:13:46,317 - INFO - app - Application startup initiated
2025-07-10 21:13:46,317 - INFO - app - Initializing core services...
2025-07-10 21:13:46,347 - INFO - app - Firebase initialized
2025-07-10 21:13:46,348 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 21:13:48,389 - INFO - app - Redis initialized
2025-07-10 21:13:48,396 - INFO - app - Scheduler initialized
2025-07-10 21:13:48,399 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 21:13:48,400 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 21:13:49,388 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 21:13:49,390 - INFO - app - Starting stale cache cleanup task
2025-07-10 21:13:53,441 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 21:13:53,441 - INFO - app - Background tasks initialized
2025-07-10 21:13:54,085 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 21:13:54,086 - INFO - app - Application startup completed successfully
2025-07-10 21:13:54,086 - INFO - app - Starting cache validation task
2025-07-10 21:13:54,088 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-10 21:13:54,088 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:13:54,110 - INFO - app - Validating cache for 10 users
2025-07-10 21:13:54,111 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:13:56,121 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 21:14:00,177 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 21:14:02,204 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:14:02,204 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 21:14:02,206 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 21:14:02,209 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 21:14:02,218 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:14:02,239 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 21:14:02,243 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:14:04,279 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 21:14:04,282 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:14:04,284 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 21:14:04,284 - INFO - app - Completed stale cache cleanup task
2025-07-10 21:14:04,292 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:14:04,294 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 21:14:04,317 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:14:06,366 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 21:14:06,375 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 21:14:08,460 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 21:14:09,087 - INFO - app - Starting stale cache cleanup task
2025-07-10 21:14:10,514 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 21:14:10,523 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 21:14:10,528 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 21:14:10,533 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 21:14:10,535 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 21:14:10,554 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 21:14:10,560 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 21:14:10,562 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 21:14:10,562 - INFO - app - Completed stale cache cleanup task
2025-07-10 21:14:10,568 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 21:14:10,596 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 21:14:10,624 - INFO - app - Cache validation completed
2025-07-10 21:14:11,756 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 21:14:11,961 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:14:11,962 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:14:11,976 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:14:11,976 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:14:11,979 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:14:11,979 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:14:48,889 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:14:48,910 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:14:48,927 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:14:48,931 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:14:48,945 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:15:04,328 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:15:04,328 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:15:04,333 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:15:04,335 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:15:04,338 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:15:04,339 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:15:04,340 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:15:04,341 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:15:04,345 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:15:11,891 - INFO - app - Application shutdown initiated
2025-07-10 21:15:11,891 - INFO - app - Scheduler shutdown completed
2025-07-10 21:15:12,224 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 21:15:14,256 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 21:15:14,257 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 21:15:14,259 - INFO - app - Redis connection closed
2025-07-10 21:15:14,259 - INFO - app - Application shutdown completed
2025-07-10 21:22:43,489 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 21:22:43,524 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:22:43,542 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:22:43,542 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:22:43,981 - INFO - app - Application starting up - Trading system initialized
2025-07-10 21:22:43,981 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 21:22:43,981 - INFO - app - Environment: PRODUCTION
2025-07-10 21:22:44,054 - INFO - app - Application startup initiated
2025-07-10 21:22:44,054 - INFO - app - Initializing core services...
2025-07-10 21:22:44,141 - INFO - app - Firebase initialized
2025-07-10 21:22:44,141 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 21:22:46,180 - INFO - app - Redis initialized
2025-07-10 21:22:46,191 - INFO - app - Scheduler initialized
2025-07-10 21:22:46,196 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 21:22:46,197 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 21:22:47,353 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 21:22:47,371 - INFO - app - Starting stale cache cleanup task
2025-07-10 21:22:51,478 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 21:22:51,478 - INFO - app - Background tasks initialized
2025-07-10 21:22:52,196 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 21:22:52,196 - INFO - app - Application startup completed successfully
2025-07-10 21:22:52,197 - INFO - app - Starting cache validation task
2025-07-10 21:22:52,200 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-10 21:22:52,200 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:22:52,219 - INFO - app - Validating cache for 10 users
2025-07-10 21:22:52,219 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:22:54,242 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 21:22:56,275 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 21:22:58,294 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 21:23:00,353 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 21:23:00,354 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:23:00,360 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 21:23:00,361 - INFO - app - [BarclaysMarginChecker] Skipping user 4: no dynamic_portfolio in cache.
2025-07-10 21:23:02,417 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:23:02,417 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 21:23:02,441 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:23:02,443 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 21:23:02,444 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 21:23:02,450 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:23:02,451 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 21:23:02,451 - INFO - app - Completed stale cache cleanup task
2025-07-10 21:23:02,469 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:23:04,494 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 4 by invalidating refresh token.
2025-07-10 21:23:04,507 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 21:23:04,560 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 21:23:06,620 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 21:23:06,679 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 21:23:06,742 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 21:23:06,778 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 21:23:06,802 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 21:23:06,822 - INFO - app - Cache validation completed
2025-07-10 21:23:07,197 - INFO - app - Starting stale cache cleanup task
2025-07-10 21:23:07,199 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 21:23:07,200 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 21:23:07,201 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 21:23:07,203 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 21:23:07,204 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 21:23:07,206 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 21:23:07,207 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 21:23:07,208 - INFO - app - Completed stale cache cleanup task
2025-07-10 21:23:08,062 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 21:23:08,066 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 21:23:08,313 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:23:08,314 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 21:23:08,327 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:23:08,327 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:23:08,328 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 21:23:08,328 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 21:23:46,572 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:23:46,592 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:23:46,610 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:23:46,613 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:23:46,630 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:24:02,471 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:24:02,471 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:24:02,482 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:24:02,483 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:24:02,488 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:24:02,489 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:24:02,491 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:24:02,495 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 21:24:02,501 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:24:46,665 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:24:46,679 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:24:46,692 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:24:46,695 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:24:46,708 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:25:02,503 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:25:02,503 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:25:02,527 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:25:02,529 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:25:02,535 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:25:02,537 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:25:02,538 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:25:02,539 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:25:02,546 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:25:46,587 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:25:46,610 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:25:46,626 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:25:46,630 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:25:46,650 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:26:02,561 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:26:02,562 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:26:02,572 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:26:02,574 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:26:02,579 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:26:02,582 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:26:02,586 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:26:02,587 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:26:02,591 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:26:46,605 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:26:46,628 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:26:46,647 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:26:46,650 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:26:46,669 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:27:02,606 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:27:02,606 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:27:02,612 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:27:02,614 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:27:02,618 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:27:02,619 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:27:02,619 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:27:02,620 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:27:02,624 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:27:46,597 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:27:46,616 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:27:46,632 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:27:46,635 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:27:46,649 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:28:02,635 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:28:02,636 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:28:02,644 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:28:02,646 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:28:02,651 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:28:02,653 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:28:02,656 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:28:02,659 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:28:02,664 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:28:06,843 - INFO - app - Starting cache validation task
2025-07-10 21:28:06,851 - INFO - app - Validating cache for 10 users
2025-07-10 21:28:06,853 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 21:28:06,863 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 21:28:06,867 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 21:28:06,876 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 21:28:06,886 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 21:28:06,898 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 21:28:06,912 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 21:28:06,921 - INFO - app - Cache validation completed
2025-07-10 21:28:25,681 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '4497093422', 'user_id': '9', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '96.809', 'status': 'OPEN', 'contract_value': '1000.0', 'account_type': 'live', 'timestamp': '2025-07-11T04:28:25.681341'}
2025-07-10 21:28:26,090 - INFO - app.core.firebase - Order data (ID: 4497093422) sent to Firebase successfully.
2025-07-10 21:28:46,596 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:28:46,611 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:28:46,627 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:28:46,630 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:28:46,641 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:29:02,665 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:29:02,666 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:29:02,672 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:29:02,676 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:29:02,681 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:29:02,682 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:29:02,683 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:29:02,684 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:29:02,691 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:29:46,622 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:29:46,651 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:29:46,674 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:29:46,679 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:29:46,697 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:30:02,698 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:30:02,698 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:30:02,704 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:30:02,706 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:30:02,711 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:30:02,712 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:30:02,713 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:30:02,714 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 21:30:02,719 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:30:46,617 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:30:47,057 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:30:47,111 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:30:47,118 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:30:47,134 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:31:01,445 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '9190132347', 'user_id': '9', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '0.13', 'price': '116551.4', 'status': 'OPEN', 'contract_value': '0.13', 'account_type': 'live', 'timestamp': '2025-07-11T04:31:01.445106'}
2025-07-10 21:31:01,755 - INFO - app.core.firebase - Order data (ID: 9190132347) sent to Firebase successfully.
2025-07-10 21:31:02,723 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:31:02,723 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:31:02,730 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:31:02,732 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:31:02,736 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:31:02,737 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:31:02,740 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:31:02,744 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 21:31:02,749 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:31:46,622 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:31:47,027 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:31:47,037 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:31:47,040 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:31:47,050 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:32:02,765 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:32:02,766 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:32:02,774 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:32:02,776 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:32:02,780 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:32:02,782 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:32:02,783 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:32:02,787 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 21:32:02,790 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:32:46,626 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:32:47,023 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:32:47,033 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:32:47,036 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:32:47,045 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:32:56,548 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '3333380822', 'order_company_name': 'AUDCAD', 'order_price': '0.89', 'contract_value': '300000.0', 'order_quantity': '3.0', 'order_type': 'BUY_LIMIT', 'order_status': 'PENDING-PROCESSING', 'status': 'PENDING', 'action': 'place_pending_order', 'account_type': 'live', 'timestamp': '2025-07-11T04:32:56.548670'}
2025-07-10 21:32:56,848 - INFO - app.core.firebase - Order data (ID: 3333380822) sent to Firebase successfully.
2025-07-10 21:33:02,792 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:33:02,792 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:33:02,801 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:33:02,803 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:33:02,808 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:33:02,809 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:33:02,810 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:33:02,814 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 21:33:02,818 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:33:06,927 - INFO - app - Starting cache validation task
2025-07-10 21:33:06,932 - INFO - app - Validating cache for 10 users
2025-07-10 21:33:06,933 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 21:33:06,944 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 21:33:06,950 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 21:33:06,952 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 21:33:06,957 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 21:33:06,962 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 21:33:06,967 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 21:33:06,972 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 21:33:06,976 - INFO - app - Cache validation completed
2025-07-10 21:33:07,213 - INFO - app - Starting stale cache cleanup task
2025-07-10 21:33:07,213 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 21:33:07,214 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 21:33:07,215 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 21:33:07,217 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 21:33:07,218 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 21:33:07,219 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 21:33:07,219 - INFO - app - Completed stale cache cleanup task
2025-07-10 21:33:46,564 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:33:46,937 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 99.09782221041662839619455580% which is below threshold 100.0%
2025-07-10 21:33:46,942 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:33:46,951 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:33:46,952 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:33:46,961 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:34:02,820 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:34:02,820 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:34:02,824 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:34:02,825 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:34:02,827 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:34:02,828 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:34:02,829 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:34:02,830 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 21:34:02,833 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:34:46,624 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:34:47,035 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:34:47,053 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:34:47,057 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:34:47,073 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:35:02,848 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:35:02,848 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:35:02,856 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:35:02,858 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:35:02,863 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:35:02,864 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:35:02,865 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:35:02,869 - INFO - app - [BarclaysMarginChecker] User 9: free_margin=813.7629115891383, total_pending_margin=1974.06022178, pending_orders=1, margin=7579.96
2025-07-10 21:35:02,870 - WARNING - app - [BarclaysMarginChecker] Cancelling order 3333380822 for user 9 (order_margin=1974.06022178) due to insufficient margin.
2025-07-10 21:35:02,928 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '3333380822', 'cancel_id': '1920503271', 'user_id': '9', 'order_type': 'BUY_LIMIT', 'timestamp': '2025-07-11T04:35:02.928046', 'status': 'CANCELLED', 'order_quantity': '3.00000000', 'order_status': 'CANCELLED-PROCESSING', 'contract_value': '300000.00000000', 'cancel_message': 'Auto-cancelled due to insufficient margin', 'account_type': 'live'}
2025-07-10 21:35:03,316 - INFO - app.core.firebase - Order data (ID: 3333380822) sent to Firebase successfully.
2025-07-10 21:35:03,441 - INFO - app - [BarclaysMarginChecker] After cancelling order 3333380822: new free_margin=813.7629115891383, new total_pending_margin=0
2025-07-10 21:35:03,457 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:35:46,633 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 21:35:46,946 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 21:35:46,954 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 21:35:46,956 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 21:35:46,963 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 21:36:03,459 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 21:36:03,460 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 21:36:03,464 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 21:36:03,466 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 21:36:03,469 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 21:36:03,470 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 21:36:03,471 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 21:36:03,475 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 21:36:03,478 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 21:36:13,341 - INFO - app - Application shutdown initiated
2025-07-10 21:36:13,342 - INFO - app - Scheduler shutdown completed
2025-07-10 21:36:13,540 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 21:36:14,918 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 21:36:14,918 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 21:36:14,922 - INFO - app - Redis connection closed
2025-07-10 21:36:14,922 - INFO - app - Application shutdown completed
2025-07-10 22:58:24,554 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 22:58:24,605 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 22:58:24,627 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 22:58:24,627 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 22:58:25,547 - INFO - app - Application starting up - Trading system initialized
2025-07-10 22:58:25,547 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 22:58:25,548 - INFO - app - Environment: PRODUCTION
2025-07-10 22:58:25,679 - INFO - app - Application startup initiated
2025-07-10 22:58:25,679 - INFO - app - Initializing core services...
2025-07-10 22:58:25,818 - INFO - app - Firebase initialized
2025-07-10 22:58:25,818 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 22:58:27,876 - INFO - app - Redis initialized
2025-07-10 22:58:27,912 - INFO - app - Scheduler initialized
2025-07-10 22:58:27,922 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 22:58:27,925 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 22:58:29,260 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 22:58:29,316 - INFO - app - Starting stale cache cleanup task
2025-07-10 22:58:33,413 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 22:58:33,413 - INFO - app - Background tasks initialized
2025-07-10 22:58:34,139 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 22:58:34,139 - INFO - app - Application startup completed successfully
2025-07-10 22:58:34,139 - INFO - app - Starting cache validation task
2025-07-10 22:58:34,141 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-10 22:58:34,142 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 22:58:34,183 - INFO - app - Validating cache for 10 users
2025-07-10 22:58:34,187 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 22:58:36,183 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 22:58:38,222 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 22:58:42,311 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 22:58:42,314 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 22:58:42,325 - INFO - app - [BarclaysMarginChecker] Skipping user 4: no dynamic_portfolio in cache.
2025-07-10 22:58:42,327 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 22:58:42,337 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 22:58:42,338 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 22:58:42,346 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 22:58:42,347 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 22:58:42,351 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 22:58:42,357 - INFO - app - [BarclaysMarginChecker] Skipping user 9: no dynamic_portfolio in cache.
2025-07-10 22:58:42,358 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 22:58:42,358 - INFO - app - Completed stale cache cleanup task
2025-07-10 22:58:42,378 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 22:58:44,428 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 22:58:44,477 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 22:58:44,486 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 22:58:44,542 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 22:58:44,567 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 22:58:44,605 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 22:58:44,631 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 22:58:46,103 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 22:58:46,108 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 22:58:46,358 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 22:58:46,362 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 22:58:46,380 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 22:58:46,380 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 22:58:46,385 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 22:58:46,385 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 22:58:46,694 - INFO - app - Cache validation completed
2025-07-10 22:58:49,153 - INFO - app - Starting stale cache cleanup task
2025-07-10 22:58:49,153 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 22:58:49,155 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 22:58:49,155 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 22:58:49,157 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 22:58:49,158 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 22:58:49,158 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 22:58:49,159 - INFO - app - Completed stale cache cleanup task
2025-07-10 22:59:28,382 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 22:59:28,862 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 22:59:28,903 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 22:59:28,909 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 22:59:28,940 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 22:59:42,384 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 22:59:42,384 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 22:59:42,417 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 22:59:42,420 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 22:59:42,445 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 22:59:42,449 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 22:59:42,454 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 22:59:42,466 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 22:59:42,478 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:00:28,366 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:00:28,764 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:00:28,785 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:00:28,789 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:00:28,806 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:00:42,494 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:00:42,494 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:00:42,531 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:00:42,533 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:00:42,538 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:00:42,540 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:00:42,542 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:00:42,545 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:00:42,551 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:01:28,374 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:01:28,769 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:01:28,790 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:01:28,794 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:01:28,812 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:01:42,559 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:01:42,559 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:01:42,568 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:01:42,571 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:01:42,578 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:01:42,579 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:01:42,581 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:01:42,585 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:01:42,591 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:02:21,811 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 9
2025-07-10 23:02:21,812 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-10 23:02:28,366 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:02:28,771 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:02:28,790 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:02:28,795 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:02:28,810 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:02:30,612 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 9
2025-07-10 23:02:30,612 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-10 23:02:42,601 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:02:42,601 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:02:42,609 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:02:42,611 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:02:42,615 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:02:42,617 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:02:42,619 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:02:42,622 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:02:42,628 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:03:28,382 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:03:28,892 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:03:28,931 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:03:28,938 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:03:28,973 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:03:42,643 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:03:42,644 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:03:42,657 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:03:42,660 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:03:42,668 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:03:42,670 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:03:42,672 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:03:42,679 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:03:42,688 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:03:46,709 - INFO - app - Starting cache validation task
2025-07-10 23:03:46,715 - INFO - app - Validating cache for 10 users
2025-07-10 23:03:46,716 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,731 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,740 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,749 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,754 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,763 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,772 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,783 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,790 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 23:03:46,799 - INFO - app - Cache validation completed
2025-07-10 23:04:28,382 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:04:28,781 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:04:28,795 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:04:28,797 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:04:28,808 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:04:42,692 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:04:42,692 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:04:42,713 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:04:42,715 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:04:42,721 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:04:42,723 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:04:42,725 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:04:42,729 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:04:42,734 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:04:55,395 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 9 by invalidating refresh token.
2025-07-10 23:05:16,940 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 9
2025-07-10 23:05:16,940 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-10 23:05:28,288 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:05:30,742 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:05:30,793 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:05:30,801 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:05:30,823 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:05:42,735 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:05:42,736 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:05:42,742 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:05:42,743 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:05:42,749 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:05:42,750 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:05:42,751 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:05:42,754 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:05:42,757 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:06:25,117 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1609256580', 'user_id': '9', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': '0.01', 'price': '96.57000000000001', 'status': 'OPEN', 'contract_value': '1000.0', 'account_type': 'live', 'timestamp': '2025-07-11T06:06:25.117449'}
2025-07-10 23:06:25,509 - INFO - app.core.firebase - Order data (ID: 1609256580) sent to Firebase successfully.
2025-07-10 23:06:28,300 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:06:28,703 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:06:28,738 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:06:28,742 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:06:28,757 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:06:42,762 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:06:42,763 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:06:42,773 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:06:42,775 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:06:42,781 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:06:42,782 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:06:42,784 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:06:42,789 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:06:42,795 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:07:28,302 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:07:28,758 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:07:28,842 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:07:28,847 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:07:28,866 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:07:42,804 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:07:42,804 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:07:42,811 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:07:42,812 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:07:42,816 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:07:42,818 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:07:42,819 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:07:42,821 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:07:42,823 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:08:28,402 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:08:28,809 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:08:28,823 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:08:28,825 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:08:28,832 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:08:42,825 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:08:42,825 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:08:42,833 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:08:42,835 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:08:42,840 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:08:42,841 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:08:42,843 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:08:42,846 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:08:42,851 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:08:46,815 - INFO - app - Starting cache validation task
2025-07-10 23:08:46,820 - INFO - app - Validating cache for 10 users
2025-07-10 23:08:46,821 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 23:08:46,833 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 23:08:46,847 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:08:46,852 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 23:08:46,866 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 23:08:46,877 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 23:08:46,889 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 23:08:46,899 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 23:08:46,910 - INFO - app - Cache validation completed
2025-07-10 23:08:49,173 - INFO - app - Starting stale cache cleanup task
2025-07-10 23:08:49,175 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 23:08:49,177 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 23:08:49,178 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 23:08:49,180 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 23:08:49,182 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 23:08:49,183 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 23:08:49,183 - INFO - app - Completed stale cache cleanup task
2025-07-10 23:09:28,991 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:09:29,366 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:09:29,379 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:09:29,382 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:09:29,390 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:09:42,866 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:09:42,867 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:09:42,874 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:09:42,876 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:09:42,881 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:09:42,882 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:09:42,884 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:09:42,888 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:09:42,893 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:10:28,361 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:10:28,795 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:10:28,812 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:10:28,815 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:10:28,829 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:10:42,905 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:10:42,905 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:10:42,915 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:10:42,918 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:10:42,922 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:10:42,924 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:10:42,926 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:10:42,929 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:10:42,933 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:11:28,688 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:11:29,108 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:11:29,127 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:11:29,131 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:11:29,147 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:11:42,946 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:11:42,946 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:11:42,953 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:11:42,957 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:11:42,961 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:11:42,962 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:11:42,964 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:11:42,967 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:11:42,972 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:12:28,299 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:12:28,724 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:12:28,761 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:12:28,765 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:12:28,781 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:12:42,976 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:12:42,977 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:12:42,984 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:12:42,986 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:12:42,993 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:12:42,996 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:12:42,998 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:12:43,001 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:12:43,006 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:13:28,398 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:13:28,808 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:13:28,830 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:13:28,834 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:13:28,854 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:13:43,021 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:13:43,021 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:13:43,033 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:13:43,035 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:13:43,040 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:13:43,042 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:13:43,043 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:13:43,047 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:13:43,053 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:13:46,924 - INFO - app - Starting cache validation task
2025-07-10 23:13:46,932 - INFO - app - Validating cache for 10 users
2025-07-10 23:13:46,937 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 23:13:46,957 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 23:13:46,971 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:13:46,976 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 23:13:46,986 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 23:13:46,996 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 23:13:47,007 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 23:13:47,018 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 23:13:47,027 - INFO - app - Cache validation completed
2025-07-10 23:14:28,466 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:14:28,916 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:14:28,936 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:14:28,940 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:14:28,956 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:14:43,056 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:14:43,056 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:14:43,065 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:14:43,066 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:14:43,071 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:14:43,072 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:14:43,073 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:14:43,079 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:14:43,083 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:15:28,363 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:15:28,820 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:15:28,836 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:15:28,839 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:15:28,854 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:15:43,097 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:15:43,097 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:15:43,103 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:15:43,104 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:15:43,110 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:15:43,111 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:15:43,112 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:15:43,116 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:15:43,123 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:16:28,424 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:16:28,826 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:16:28,843 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:16:28,847 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:16:28,862 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:16:43,132 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:16:43,132 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:16:43,141 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:16:43,143 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:16:43,148 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:16:43,150 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:16:43,151 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:16:43,156 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:16:43,161 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:17:28,439 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:17:28,829 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:17:28,848 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:17:28,851 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:17:28,864 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:17:43,178 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:17:43,178 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:17:43,187 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:17:43,188 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:17:43,195 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:17:43,197 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:17:43,198 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:17:43,202 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:17:43,209 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:18:28,330 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:18:28,733 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:18:28,744 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:18:28,745 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:18:28,752 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:18:43,217 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:18:43,217 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:18:43,226 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:18:43,227 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:18:43,231 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:18:43,232 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:18:43,234 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:18:43,236 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:18:43,238 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:18:47,030 - INFO - app - Starting cache validation task
2025-07-10 23:18:47,036 - INFO - app - Validating cache for 10 users
2025-07-10 23:18:47,037 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 23:18:47,045 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 23:18:47,048 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:18:47,050 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 23:18:47,055 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 23:18:47,057 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 23:18:47,061 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 23:18:47,064 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 23:18:47,067 - INFO - app - Cache validation completed
2025-07-10 23:18:49,197 - INFO - app - Starting stale cache cleanup task
2025-07-10 23:18:49,199 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 23:18:49,202 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 23:18:49,203 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 23:18:49,204 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 23:18:49,205 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 23:18:49,207 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 23:18:49,207 - INFO - app - Completed stale cache cleanup task
2025-07-10 23:19:28,335 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:19:28,739 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:19:28,751 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:19:28,753 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:19:28,762 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:19:43,254 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:19:43,255 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:19:43,263 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:19:43,264 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:19:43,269 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:19:43,271 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:19:43,272 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:19:43,276 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:19:43,279 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:20:28,338 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:20:28,743 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:20:28,755 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:20:28,757 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:20:28,765 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:20:43,294 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:20:43,294 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:20:43,300 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:20:43,302 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:20:43,306 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:20:43,308 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:20:43,310 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:20:43,312 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:20:43,315 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:21:28,341 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:21:28,748 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:21:28,762 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:21:28,765 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:21:28,773 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:21:43,326 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:21:43,326 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:21:43,334 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:21:43,335 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:21:43,338 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:21:43,339 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:21:43,340 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:21:43,342 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:21:43,344 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:22:28,261 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:22:28,650 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:22:28,663 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:22:28,667 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:22:28,676 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:22:43,346 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:22:43,346 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:22:43,354 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:22:43,356 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:22:43,360 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:22:43,361 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:22:43,362 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:22:43,364 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:22:43,366 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:23:28,410 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:23:28,860 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:23:28,874 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:23:28,878 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:23:28,888 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:23:37,590 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '2722667079', 'order_company_name': 'AUDJPY', 'order_price': '91.0', 'contract_value': '1000.0', 'order_quantity': '0.01', 'order_type': 'BUY_LIMIT', 'order_status': 'PENDING-PROCESSING', 'status': 'PENDING', 'action': 'place_pending_order', 'account_type': 'live', 'timestamp': '2025-07-11T06:23:37.589971'}
2025-07-10 23:23:37,965 - INFO - app.core.firebase - Order data (ID: 2722667079) sent to Firebase successfully.
2025-07-10 23:23:43,375 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:23:43,376 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:23:43,385 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:23:43,387 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:23:43,392 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:23:43,394 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:23:43,396 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:23:43,400 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:23:43,407 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:23:47,076 - INFO - app - Starting cache validation task
2025-07-10 23:23:47,085 - INFO - app - Validating cache for 10 users
2025-07-10 23:23:47,087 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 23:23:47,102 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 23:23:47,110 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:23:47,115 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 23:23:47,127 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 23:23:47,137 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 23:23:47,146 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 23:23:47,152 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 23:23:47,161 - INFO - app - Cache validation completed
2025-07-10 23:24:28,406 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:24:28,762 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:24:28,777 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:24:28,780 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:24:28,794 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:24:43,408 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:24:43,409 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:24:43,413 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:24:43,414 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:24:43,416 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:24:43,417 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:24:43,417 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:24:43,419 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:24:43,422 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:25:28,347 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:25:28,753 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:25:28,771 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:25:28,774 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:25:28,794 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:25:43,424 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:25:43,424 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:25:43,435 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:25:43,438 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:25:43,445 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:25:43,446 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:25:43,448 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:25:43,454 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:25:43,459 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:26:28,455 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:26:28,859 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:26:28,868 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:26:28,872 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:26:28,878 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:26:43,460 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:26:43,460 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:26:43,464 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:26:43,464 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:26:43,468 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:26:43,468 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:26:43,469 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:26:43,474 - INFO - app - [BarclaysMarginChecker] User 9: free_margin=1035.7298847161987, total_pending_margin=6.60242494, pending_orders=1, margin=7579.96
2025-07-10 23:26:43,474 - INFO - app - [BarclaysMarginChecker] User 9: No cancellation needed.
2025-07-10 23:26:43,477 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:27:28,337 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:27:28,813 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:27:28,819 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:27:28,822 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:27:28,843 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:27:43,480 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:27:43,481 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:27:43,488 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:27:43,489 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:27:43,500 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:27:43,502 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:27:43,505 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:27:43,512 - INFO - app - [BarclaysMarginChecker] User 9: free_margin=1031.7066929487137, total_pending_margin=6.60242494, pending_orders=1, margin=7579.96
2025-07-10 23:27:43,512 - INFO - app - [BarclaysMarginChecker] User 9: No cancellation needed.
2025-07-10 23:27:43,518 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:28:28,287 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 23:28:28,702 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:28:29,115 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:28:29,126 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:28:29,127 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:28:29,133 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:28:35,870 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '4123941836', 'order_company_name': 'BTCUSD', 'order_price': '118205.15', 'contract_value': '1.0', 'order_quantity': '1.0', 'order_type': 'BUY_LIMIT', 'order_status': 'PENDING-PROCESSING', 'status': 'PENDING', 'action': 'place_pending_order', 'account_type': 'live', 'timestamp': '2025-07-11T06:28:35.870735'}
2025-07-10 23:28:36,273 - INFO - app.core.firebase - Order data (ID: 4123941836) sent to Firebase successfully.
2025-07-10 23:28:43,520 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:28:43,521 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:28:43,536 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:28:43,538 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:28:43,542 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:28:43,543 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:28:43,544 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:28:43,547 - INFO - app - [BarclaysMarginChecker] User 9: free_margin=1029.6894199452547, total_pending_margin=6.60242494, pending_orders=1, margin=7579.96
2025-07-10 23:28:43,548 - INFO - app - [BarclaysMarginChecker] User 9: No cancellation needed.
2025-07-10 23:28:43,552 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:28:47,165 - INFO - app - Starting cache validation task
2025-07-10 23:28:47,173 - INFO - app - Validating cache for 10 users
2025-07-10 23:28:47,173 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 23:28:47,182 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 23:28:47,188 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:28:47,191 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 23:28:47,196 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 23:28:47,200 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 23:28:47,204 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 23:28:47,208 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 23:28:47,212 - INFO - app - Cache validation completed
2025-07-10 23:28:49,213 - INFO - app - Starting stale cache cleanup task
2025-07-10 23:28:49,214 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 23:28:49,217 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 23:28:49,218 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 23:28:49,220 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 23:28:49,222 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 23:28:49,223 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 23:28:49,223 - INFO - app - Completed stale cache cleanup task
2025-07-10 23:29:28,290 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:29:28,674 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:29:28,691 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:29:28,694 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:29:28,708 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:29:43,554 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:29:43,554 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:29:43,562 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:29:43,563 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:29:43,567 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:29:43,568 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:29:43,569 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:29:43,572 - INFO - app - [BarclaysMarginChecker] User 9: free_margin=1025.1946434805104, total_pending_margin=6.60242494, pending_orders=1, margin=7579.96
2025-07-10 23:29:43,572 - INFO - app - [BarclaysMarginChecker] User 9: No cancellation needed.
2025-07-10 23:29:43,577 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:30:28,421 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:30:28,820 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:30:28,839 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:30:28,840 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:30:28,847 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:30:43,581 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:30:43,581 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:30:43,589 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:30:43,591 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:30:43,594 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:30:43,596 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:30:43,597 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:30:43,599 - INFO - app - [BarclaysMarginChecker] User 9: free_margin=1025.1740034652487, total_pending_margin=59090.56242494, pending_orders=2, margin=7579.96
2025-07-10 23:30:43,599 - WARNING - app - [BarclaysMarginChecker] Cancelling order 2722667079 for user 9 (order_margin=6.60242494) due to insufficient margin.
2025-07-10 23:30:43,623 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '2722667079', 'cancel_id': '6001142216', 'user_id': '9', 'order_type': 'BUY_LIMIT', 'timestamp': '2025-07-11T06:30:43.623275', 'status': 'CANCELLED', 'order_quantity': '0.01000000', 'order_status': 'CANCELLED-PROCESSING', 'contract_value': '1000.00000000', 'cancel_message': 'Auto-cancelled due to insufficient margin', 'account_type': 'live'}
2025-07-10 23:30:43,912 - INFO - app.core.firebase - Order data (ID: 2722667079) sent to Firebase successfully.
2025-07-10 23:30:43,942 - INFO - app - [BarclaysMarginChecker] After cancelling order 2722667079: new free_margin=1025.1740034652487, new total_pending_margin=59083.96
2025-07-10 23:30:43,942 - WARNING - app - [BarclaysMarginChecker] Cancelling order 4123941836 for user 9 (order_margin=59083.96) due to insufficient margin.
2025-07-10 23:30:43,953 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '4123941836', 'cancel_id': '9427894187', 'user_id': '9', 'order_type': 'BUY_LIMIT', 'timestamp': '2025-07-11T06:30:43.953369', 'status': 'CANCELLED', 'order_quantity': '1.00000000', 'order_status': 'CANCELLED-PROCESSING', 'contract_value': '1.00000000', 'cancel_message': 'Auto-cancelled due to insufficient margin', 'account_type': 'live'}
2025-07-10 23:30:44,274 - INFO - app.core.firebase - Order data (ID: 4123941836) sent to Firebase successfully.
2025-07-10 23:30:44,311 - INFO - app - [BarclaysMarginChecker] After cancelling order 4123941836: new free_margin=1025.1740034652487, new total_pending_margin=0
2025-07-10 23:30:44,314 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:31:28,316 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:31:28,826 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:31:28,842 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:31:28,845 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:31:28,852 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:31:35,329 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 9
2025-07-10 23:31:35,330 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 9
2025-07-10 23:31:35,331 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 9
2025-07-10 23:31:35,332 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 9
2025-07-10 23:31:35,338 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 9 using refresh token.
2025-07-10 23:31:35,339 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 9 using refresh token.
2025-07-10 23:31:44,325 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:31:44,325 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:31:44,334 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:31:44,335 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:31:44,339 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:31:44,340 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:31:44,341 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:31:44,344 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:31:44,348 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:32:28,437 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:32:28,834 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:32:28,854 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:32:28,859 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:32:28,872 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:32:44,359 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:32:44,360 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:32:44,368 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:32:44,370 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:32:44,375 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:32:44,376 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:32:44,378 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:32:44,381 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:32:44,385 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:33:28,368 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:33:28,752 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:33:28,767 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:33:28,771 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:33:28,784 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:33:44,397 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:33:44,397 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:33:44,456 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:33:46,501 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:33:46,507 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:33:46,511 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:33:46,521 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:33:46,528 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:33:46,539 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:33:47,220 - INFO - app - Starting cache validation task
2025-07-10 23:33:47,230 - INFO - app - Validating cache for 10 users
2025-07-10 23:33:47,232 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 23:33:47,255 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 23:33:47,270 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:33:47,275 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 23:33:47,289 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 23:33:47,300 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 23:33:47,313 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 23:33:47,324 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 23:33:47,333 - INFO - app - Cache validation completed
2025-07-10 23:34:28,322 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:34:28,730 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:34:28,745 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:34:28,749 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:34:28,764 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:34:46,544 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:34:46,545 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:34:46,556 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:34:46,558 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:34:46,563 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:34:46,566 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:34:46,567 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:34:46,572 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:34:46,578 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:35:28,285 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:35:28,643 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:35:28,673 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:35:28,675 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:35:28,686 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:35:46,580 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:35:46,581 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:35:46,590 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:35:46,592 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:35:46,598 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:35:46,599 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:35:46,600 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:35:46,605 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:35:46,611 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:36:28,337 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:36:28,752 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:36:28,765 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:36:28,768 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:36:28,780 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:36:46,614 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:36:46,614 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:36:46,623 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:36:46,625 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:36:46,630 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:36:46,632 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:36:46,634 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:36:46,638 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:36:46,643 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:37:28,355 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:37:28,753 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:37:28,761 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:37:28,761 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:37:28,767 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:37:46,644 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:37:46,644 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:37:46,647 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:37:46,648 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:37:46,650 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:37:46,651 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:37:46,652 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:37:46,654 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:37:46,656 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:38:28,355 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:38:28,764 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:38:28,779 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:38:28,781 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:38:28,793 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:38:46,671 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:38:46,671 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:38:46,678 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:38:46,679 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:38:46,683 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:38:46,684 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:38:46,684 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:38:46,686 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:38:46,689 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:38:47,350 - INFO - app - Starting cache validation task
2025-07-10 23:38:47,354 - INFO - app - Validating cache for 10 users
2025-07-10 23:38:47,354 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 23:38:47,360 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 23:38:47,363 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:38:47,365 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 23:38:47,369 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 23:38:47,372 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 23:38:47,375 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 23:38:47,378 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 23:38:47,380 - INFO - app - Cache validation completed
2025-07-10 23:38:49,230 - INFO - app - Starting stale cache cleanup task
2025-07-10 23:38:49,231 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 23:38:49,233 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 23:38:49,234 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 23:38:49,236 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 23:38:49,238 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 23:38:49,238 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 23:38:49,239 - INFO - app - Completed stale cache cleanup task
2025-07-10 23:39:28,253 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:39:28,565 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:39:28,573 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:39:28,575 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:39:28,581 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:39:46,702 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:39:46,702 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:39:46,711 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:39:46,712 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:39:46,716 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:39:46,717 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:39:46,718 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:39:46,720 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:39:46,723 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:40:28,261 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:40:28,588 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 23:40:28,621 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:40:28,623 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:40:28,633 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:40:46,730 - INFO - app - [BarclaysMarginChecker] --- Loop iteration end (after sleep) ---
2025-07-10 23:40:46,730 - INFO - app - [BarclaysMarginChecker] --- Loop iteration start ---
2025-07-10 23:40:46,737 - INFO - app - [BarclaysMarginChecker] Checking 4 live users.
2025-07-10 23:40:46,738 - INFO - app - [BarclaysMarginChecker] User 4 group: Standard, sending_orders: barclays
2025-07-10 23:40:46,742 - INFO - app - [BarclaysMarginChecker] User 4: no pending orders.
2025-07-10 23:40:46,743 - INFO - app - [BarclaysMarginChecker] User 8 group: string, sending_orders: None
2025-07-10 23:40:46,744 - INFO - app - [BarclaysMarginChecker] User 9 group: Group B, sending_orders: barclays
2025-07-10 23:40:46,746 - INFO - app - [BarclaysMarginChecker] User 9: no pending orders.
2025-07-10 23:40:46,749 - INFO - app - [BarclaysMarginChecker] Skipping user 11: no user_data in cache.
2025-07-10 23:40:57,584 - INFO - app - Application shutdown initiated
2025-07-10 23:40:57,585 - INFO - app - Scheduler shutdown completed
2025-07-10 23:40:57,765 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 23:40:58,377 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 23:40:58,378 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 23:40:58,380 - INFO - app - Redis connection closed
2025-07-10 23:40:58,382 - INFO - app - Application shutdown completed
2025-07-10 23:41:00,730 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 23:41:00,759 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 23:41:00,770 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 23:41:00,771 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-10 23:41:01,203 - INFO - app - Application starting up - Trading system initialized
2025-07-10 23:41:01,203 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 23:41:01,203 - INFO - app - Environment: PRODUCTION
2025-07-10 23:41:01,247 - INFO - app - Application startup initiated
2025-07-10 23:41:01,247 - INFO - app - Initializing core services...
2025-07-10 23:41:01,280 - INFO - app - Firebase initialized
2025-07-10 23:41:01,281 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 23:41:03,334 - INFO - app - Redis initialized
2025-07-10 23:41:03,341 - INFO - app - Scheduler initialized
2025-07-10 23:41:03,343 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 23:41:03,344 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 23:41:04,211 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 23:41:04,212 - INFO - app - Starting stale cache cleanup task
2025-07-10 23:41:08,270 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 23:41:08,270 - INFO - app - Background tasks initialized
2025-07-10 23:41:08,893 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 23:41:08,893 - INFO - app - Application startup completed successfully
2025-07-10 23:41:08,894 - INFO - app - Starting cache validation task
2025-07-10 23:41:08,901 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-10 23:41:09,191 - INFO - app - Validating cache for 28 users
2025-07-10 23:41:10,980 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 23:41:17,122 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 23:41:17,132 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 23:41:17,155 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 23:41:17,174 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 23:41:17,189 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 23:41:17,189 - INFO - app - Completed stale cache cleanup task
2025-07-10 23:41:17,218 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 23:41:17,294 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-10 23:41:17,403 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-10 23:41:17,472 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-10 23:41:17,541 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-10 23:41:18,248 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 23:41:18,299 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 23:41:18,428 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 23:41:18,447 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 23:41:18,448 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-10 23:41:18,487 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 23:41:18,505 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 23:41:18,505 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-10 23:41:19,625 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-10 23:41:19,682 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-10 23:41:19,744 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-10 23:41:19,804 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-10 23:41:19,866 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-10 23:41:19,925 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-10 23:41:19,999 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-10 23:41:20,081 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-10 23:41:22,130 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-10 23:41:22,216 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-10 23:41:22,282 - WARNING - app - User 11: Missing static orders cache, refreshing...
2025-07-10 23:41:22,490 - INFO - app - Cache validation completed
2025-07-10 23:41:23,900 - INFO - app - Starting stale cache cleanup task
2025-07-10 23:41:23,903 - INFO - app - Found 9 static orders cache entries to check
2025-07-10 23:41:23,905 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 23:41:23,906 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 23:41:23,907 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 23:41:23,909 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 23:41:23,910 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-10 23:41:23,910 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 23:41:23,911 - INFO - app - Completed stale cache cleanup task
2025-07-10 23:42:04,036 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-10 23:42:04,043 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:42:06,636 - WARNING - app - No group settings found for group Elite. Skipping portfolio update for user 19.
2025-07-10 23:42:07,045 - WARNING - app - No group settings found for group VIP. Skipping portfolio update for user 22.
2025-07-10 23:42:07,531 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:42:07,545 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:42:07,588 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:42:07,667 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-10 23:42:23,590 - INFO - app - [BarclaysMarginChecker] User 10: No cancellation needed.
2025-07-10 23:43:03,969 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-10 23:43:03,985 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 23:43:06,581 - WARNING - app - No group settings found for group Elite. Skipping portfolio update for user 19.
2025-07-10 23:43:07,030 - WARNING - app - No group settings found for group VIP. Skipping portfolio update for user 22.
2025-07-10 23:43:07,552 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 23:43:07,569 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 23:43:07,632 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 23:43:07,632 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-10 23:43:24,786 - INFO - app - [BarclaysMarginChecker] User 10: No cancellation needed.
2025-07-10 23:43:42,591 - INFO - app - Application shutdown initiated
2025-07-10 23:43:42,591 - INFO - app - Scheduler shutdown completed
2025-07-10 23:43:42,739 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 23:43:44,860 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 23:43:44,861 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 23:43:44,873 - INFO - app - Redis connection closed
2025-07-10 23:43:44,873 - INFO - app - Application shutdown completed
2025-07-11 00:00:52,168 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-11 00:00:52,190 - INFO - app.core.config - .env file loaded successfully.
2025-07-11 00:00:52,204 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-11 00:00:52,204 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-11 00:00:52,578 - INFO - app - Application starting up - Trading system initialized
2025-07-11 00:00:52,578 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-11 00:00:52,578 - INFO - app - Environment: PRODUCTION
2025-07-11 00:00:52,623 - INFO - app - Application startup initiated
2025-07-11 00:00:52,623 - INFO - app - Initializing core services...
2025-07-11 00:00:52,706 - INFO - app - Firebase initialized
2025-07-11 00:00:52,706 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-11 00:00:54,742 - INFO - app - Redis initialized
2025-07-11 00:00:54,749 - INFO - app - Scheduler initialized
2025-07-11 00:00:54,752 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-11 00:00:54,752 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-11 00:00:55,646 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-11 00:00:55,647 - INFO - app - Starting stale cache cleanup task
2025-07-11 00:00:59,749 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-11 00:00:59,749 - INFO - app - Background tasks initialized
2025-07-11 00:01:00,418 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-11 00:01:00,419 - INFO - app - Application startup completed successfully
2025-07-11 00:01:00,419 - INFO - app - Starting cache validation task
2025-07-11 00:01:00,427 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-11 00:01:00,921 - INFO - app - Validating cache for 28 users
2025-07-11 00:01:01,205 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 9
2025-07-11 00:01:01,206 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 9
2025-07-11 00:01:02,458 - INFO - app - Found 0 static orders cache entries to check
2025-07-11 00:01:02,459 - INFO - app - Completed stale cache cleanup task
2025-07-11 00:01:02,492 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 9
2025-07-11 00:01:04,478 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-11 00:01:04,479 - WARNING - app.api.v1.endpoints.users - Refresh token validation failed for user ID 9. Data found: False, User ID match: False
2025-07-11 00:01:04,479 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: Invalid or expired refresh token
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 312, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Invalid or expired refresh token
2025-07-11 00:01:06,506 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 12 symbols for user 9
2025-07-11 00:01:06,507 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'CADJPY', 'CHFJPY', 'EURCAD', 'EURJPY', 'EURUSD', 'GBPUSD', 'NZDJPY', 'NZDUSD', 'USDCAD', 'USDCHF', 'USDJPY']
2025-07-11 00:01:06,515 - WARNING - app.api.v1.endpoints.users - Refresh token validation failed for user ID 9. Data found: False, User ID match: False
2025-07-11 00:01:06,516 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: Invalid or expired refresh token
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 312, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Invalid or expired refresh token
2025-07-11 00:01:06,525 - WARNING - app.api.v1.endpoints.users - Refresh token validation failed for user ID 9. Data found: False, User ID match: False
2025-07-11 00:01:06,525 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: Invalid or expired refresh token
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 312, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Invalid or expired refresh token
2025-07-11 00:01:10,301 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 9
2025-07-11 00:01:12,711 - WARNING - app.api.v1.endpoints.users - Refresh token validation failed for user ID 9. Data found: False, User ID match: False
2025-07-11 00:01:12,711 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: Invalid or expired refresh token
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 312, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Invalid or expired refresh token
2025-07-11 00:01:12,733 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-11 00:01:12,822 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-11 00:01:12,960 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,042 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,144 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,242 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,326 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,422 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,497 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,574 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,692 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,785 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,868 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-11 00:01:13,943 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-11 00:01:14,027 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-11 00:01:14,115 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-11 00:01:14,190 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-11 00:01:14,307 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-11 00:01:14,389 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-11 00:01:14,494 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-11 00:01:14,589 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-11 00:01:14,680 - WARNING - app - User 4: Missing static orders cache, refreshing...
2025-07-11 00:01:14,942 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-11 00:01:15,030 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-11 00:01:15,108 - WARNING - app - User 9: Missing static orders cache, refreshing...
2025-07-11 00:01:15,392 - WARNING - app - User 10: Missing static orders cache, refreshing...
2025-07-11 00:01:15,421 - INFO - app - Starting stale cache cleanup task
2025-07-11 00:01:15,422 - INFO - app - Found 2 static orders cache entries to check
2025-07-11 00:01:15,423 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-11 00:01:15,424 - INFO - app - Completed stale cache cleanup task
2025-07-11 00:01:15,609 - WARNING - app - User 11: Missing static orders cache, refreshing...
2025-07-11 00:01:15,858 - INFO - app - Cache validation completed
2025-07-11 00:01:22,281 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 9 by invalidating refresh token.
2025-07-11 00:01:30,900 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-11 00:01:30,901 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-11 00:01:54,839 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:01:54,920 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-11 00:01:54,923 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-11 00:01:55,426 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:01:55,427 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:01:55,427 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDTRY
2025-07-11 00:01:55,431 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:01:55,433 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:01:55,475 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 13.
2025-07-11 00:01:55,598 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 17.
2025-07-11 00:01:55,600 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 18.
2025-07-11 00:01:55,603 - WARNING - app - No group settings found for group Elite. Skipping portfolio update for user 19.
2025-07-11 00:01:55,981 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDCAD
2025-07-11 00:01:55,981 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:01:55,981 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:01:55,990 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 21.
2025-07-11 00:01:55,996 - WARNING - app - No group settings found for group VIP. Skipping portfolio update for user 22.
2025-07-11 00:01:55,998 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 23.
2025-07-11 00:01:56,001 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 24.
2025-07-11 00:01:56,002 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 25.
2025-07-11 00:01:56,096 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 1.
2025-07-11 00:01:56,210 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-11 00:01:56,339 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-11 00:01:56,340 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:01:56,462 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-11 00:01:56,576 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-11 00:01:56,577 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 9.
2025-07-11 00:01:56,578 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:01:56,579 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:02:01,719 - INFO - app - Application shutdown initiated
2025-07-11 00:02:01,719 - INFO - app - Scheduler shutdown completed
2025-07-11 00:02:01,720 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-11 00:02:02,673 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-11 00:02:02,674 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-11 00:02:02,678 - INFO - app - Redis connection closed
2025-07-11 00:02:02,679 - INFO - app - Application shutdown completed
2025-07-11 00:03:18,522 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-11 00:03:18,535 - INFO - app.core.config - .env file loaded successfully.
2025-07-11 00:03:18,553 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-11 00:03:18,553 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-11 00:03:18,900 - INFO - app - Application starting up - Trading system initialized
2025-07-11 00:03:18,900 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-11 00:03:18,900 - INFO - app - Environment: PRODUCTION
2025-07-11 00:03:18,944 - INFO - app - Application startup initiated
2025-07-11 00:03:18,944 - INFO - app - Initializing core services...
2025-07-11 00:03:18,987 - INFO - app - Firebase initialized
2025-07-11 00:03:18,987 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-11 00:03:21,064 - INFO - app - Redis initialized
2025-07-11 00:03:21,068 - INFO - app - Scheduler initialized
2025-07-11 00:03:21,070 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-11 00:03:21,071 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-11 00:03:22,051 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-11 00:03:22,054 - INFO - app - Starting stale cache cleanup task
2025-07-11 00:03:26,115 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-11 00:03:26,115 - INFO - app - Background tasks initialized
2025-07-11 00:03:27,042 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-11 00:03:27,043 - INFO - app - Application startup completed successfully
2025-07-11 00:03:27,043 - INFO - app - Starting cache validation task
2025-07-11 00:03:27,050 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-11 00:03:27,489 - INFO - app - Validating cache for 28 users
2025-07-11 00:03:29,110 - INFO - app - Found 0 static orders cache entries to check
2025-07-11 00:03:29,110 - INFO - app - Completed stale cache cleanup task
2025-07-11 00:03:31,149 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-11 00:03:37,307 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-11 00:03:37,353 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-11 00:03:37,444 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-11 00:03:37,530 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-11 00:03:37,617 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-11 00:03:37,709 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-11 00:03:37,800 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-11 00:03:37,970 - WARNING - app - User 14: Missing static orders cache, refreshing...
2025-07-11 00:03:38,096 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,181 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,267 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,359 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,440 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,523 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,608 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,693 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,776 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,865 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-11 00:03:38,951 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-11 00:03:42,048 - INFO - app - Starting stale cache cleanup task
2025-07-11 00:03:43,136 - INFO - app - Found 1 static orders cache entries to check
2025-07-11 00:03:43,141 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-11 00:03:43,141 - INFO - app - Completed stale cache cleanup task
2025-07-11 00:03:43,146 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-11 00:03:43,234 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-11 00:03:43,339 - WARNING - app - User 4: Missing static orders cache, refreshing...
2025-07-11 00:03:43,669 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-11 00:03:43,742 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-11 00:03:43,815 - WARNING - app - User 9: Missing static orders cache, refreshing...
2025-07-11 00:03:44,048 - WARNING - app - User 10: Missing static orders cache, refreshing...
2025-07-11 00:03:44,252 - WARNING - app - User 11: Missing static orders cache, refreshing...
2025-07-11 00:03:44,456 - INFO - app - Cache validation completed
2025-07-11 00:04:21,157 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:04:21,234 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-11 00:04:21,237 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-11 00:04:21,639 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:04:21,640 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:04:21,640 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDTRY
2025-07-11 00:04:21,643 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:04:21,645 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:04:21,720 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 13.
2025-07-11 00:04:21,860 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 17.
2025-07-11 00:04:21,861 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 18.
2025-07-11 00:04:21,862 - WARNING - app - No group settings found for group Elite. Skipping portfolio update for user 19.
2025-07-11 00:04:22,250 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDCAD
2025-07-11 00:04:22,251 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:04:22,251 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:04:22,269 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 21.
2025-07-11 00:04:22,271 - WARNING - app - No group settings found for group VIP. Skipping portfolio update for user 22.
2025-07-11 00:04:22,274 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 23.
2025-07-11 00:04:22,277 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 24.
2025-07-11 00:04:22,281 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 25.
2025-07-11 00:04:22,396 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 1.
2025-07-11 00:04:22,518 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-11 00:04:22,635 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-11 00:04:22,636 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:04:22,822 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-11 00:04:22,930 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-11 00:04:22,933 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 9.
2025-07-11 00:04:22,935 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:04:22,937 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:04:31,856 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-11 00:04:31,856 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-11 00:04:39,458 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-11 00:04:39,459 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-11 00:05:22,811 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:05:22,925 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-11 00:05:22,927 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-11 00:05:23,340 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:05:23,340 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:05:23,340 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDTRY
2025-07-11 00:05:23,348 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:05:23,350 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:05:23,380 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 13.
2025-07-11 00:05:23,448 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 17.
2025-07-11 00:05:23,449 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 18.
2025-07-11 00:05:23,451 - WARNING - app - No group settings found for group Elite. Skipping portfolio update for user 19.
2025-07-11 00:05:23,784 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDCAD
2025-07-11 00:05:23,784 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:05:23,784 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:05:23,789 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 21.
2025-07-11 00:05:23,792 - WARNING - app - No group settings found for group VIP. Skipping portfolio update for user 22.
2025-07-11 00:05:23,794 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 23.
2025-07-11 00:05:23,796 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 24.
2025-07-11 00:05:23,798 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 25.
2025-07-11 00:05:23,800 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 1.
2025-07-11 00:05:23,801 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-11 00:05:23,803 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-11 00:05:23,805 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:05:23,806 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-11 00:05:23,806 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-11 00:05:23,808 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 9.
2025-07-11 00:05:23,809 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:05:23,810 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:06:21,209 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:06:21,309 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-11 00:06:21,312 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-11 00:06:21,684 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:06:21,684 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:06:21,684 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDTRY
2025-07-11 00:06:21,687 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:06:21,689 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:06:21,723 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 13.
2025-07-11 00:06:21,784 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 17.
2025-07-11 00:06:21,784 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 18.
2025-07-11 00:06:21,785 - WARNING - app - No group settings found for group Elite. Skipping portfolio update for user 19.
2025-07-11 00:06:22,114 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDCAD
2025-07-11 00:06:22,114 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:06:22,114 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:06:22,121 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 21.
2025-07-11 00:06:22,131 - WARNING - app - No group settings found for group VIP. Skipping portfolio update for user 22.
2025-07-11 00:06:22,133 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 23.
2025-07-11 00:06:22,134 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 24.
2025-07-11 00:06:22,135 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 25.
2025-07-11 00:06:22,138 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 1.
2025-07-11 00:06:22,139 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-11 00:06:22,141 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-11 00:06:22,143 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:06:22,144 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-11 00:06:22,150 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-11 00:06:22,153 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 9.
2025-07-11 00:06:22,154 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:06:22,155 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:07:21,217 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:07:21,314 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-11 00:07:21,317 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-11 00:07:21,705 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:07:21,705 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:07:21,705 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDTRY
2025-07-11 00:07:21,708 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:07:21,710 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:07:21,750 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 13.
2025-07-11 00:07:21,832 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 17.
2025-07-11 00:07:21,833 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 18.
2025-07-11 00:07:21,835 - WARNING - app - No group settings found for group Elite. Skipping portfolio update for user 19.
2025-07-11 00:07:22,188 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDCAD
2025-07-11 00:07:22,188 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:07:22,188 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:07:22,200 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 21.
2025-07-11 00:07:22,202 - WARNING - app - No group settings found for group VIP. Skipping portfolio update for user 22.
2025-07-11 00:07:22,203 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 23.
2025-07-11 00:07:22,205 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 24.
2025-07-11 00:07:22,208 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 25.
2025-07-11 00:07:22,209 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 1.
2025-07-11 00:07:22,210 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-11 00:07:22,211 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-11 00:07:22,212 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:07:22,213 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-11 00:07:22,213 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-11 00:07:22,214 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 9.
2025-07-11 00:07:22,215 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:07:22,216 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:07:34,701 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 14 by invalidating refresh token.
2025-07-11 00:07:43,465 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-11 00:07:43,465 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-11 00:07:52,903 - INFO - app - Application shutdown initiated
2025-07-11 00:07:52,904 - INFO - app - Scheduler shutdown completed
2025-07-11 00:07:52,906 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-11 00:07:54,263 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-11 00:07:54,263 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-11 00:07:54,268 - INFO - app - Redis connection closed
2025-07-11 00:07:54,269 - INFO - app - Application shutdown completed
2025-07-11 00:09:19,988 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-11 00:09:20,003 - INFO - app.core.config - .env file loaded successfully.
2025-07-11 00:09:20,023 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-11 00:09:20,023 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-11 00:09:20,296 - INFO - app - Application starting up - Trading system initialized
2025-07-11 00:09:20,296 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-11 00:09:20,296 - INFO - app - Environment: PRODUCTION
2025-07-11 00:09:20,340 - INFO - app - Application startup initiated
2025-07-11 00:09:20,340 - INFO - app - Initializing core services...
2025-07-11 00:09:20,404 - INFO - app - Firebase initialized
2025-07-11 00:09:20,404 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-11 00:09:22,432 - INFO - app - Redis initialized
2025-07-11 00:09:22,436 - INFO - app - Scheduler initialized
2025-07-11 00:09:22,438 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-11 00:09:22,438 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-11 00:09:23,590 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-11 00:09:23,592 - INFO - app - Starting stale cache cleanup task
2025-07-11 00:09:27,695 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-11 00:09:27,695 - INFO - app - Background tasks initialized
2025-07-11 00:09:28,282 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-11 00:09:28,282 - INFO - app - Application startup completed successfully
2025-07-11 00:09:28,282 - INFO - app - Starting cache validation task
2025-07-11 00:09:28,289 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-11 00:09:28,555 - INFO - app - Validating cache for 28 users
2025-07-11 00:09:30,376 - INFO - app - Found 0 static orders cache entries to check
2025-07-11 00:09:30,377 - INFO - app - Completed stale cache cleanup task
2025-07-11 00:09:32,413 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-11 00:09:36,563 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-11 00:09:36,608 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-11 00:09:36,668 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-11 00:09:36,758 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-11 00:09:36,834 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-11 00:09:36,903 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-11 00:09:40,994 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,076 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,143 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,224 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,299 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,382 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,469 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,542 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,655 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,721 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,783 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,853 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,923 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-11 00:09:41,989 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-11 00:09:42,055 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-11 00:09:42,135 - WARNING - app - User 4: Missing static orders cache, refreshing...
2025-07-11 00:09:42,373 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-11 00:09:42,450 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-11 00:09:42,526 - WARNING - app - User 9: Missing static orders cache, refreshing...
2025-07-11 00:09:42,756 - WARNING - app - User 10: Missing static orders cache, refreshing...
2025-07-11 00:09:42,953 - WARNING - app - User 11: Missing static orders cache, refreshing...
2025-07-11 00:09:43,191 - INFO - app - Cache validation completed
2025-07-11 00:09:43,287 - INFO - app - Starting stale cache cleanup task
2025-07-11 00:09:43,288 - INFO - app - Found 4 static orders cache entries to check
2025-07-11 00:09:43,288 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-11 00:09:43,289 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-11 00:09:43,290 - INFO - app - Completed stale cache cleanup task
2025-07-11 00:10:05,941 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-11 00:10:05,942 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-11 00:10:22,561 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:10:22,664 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-11 00:10:22,666 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-11 00:10:23,096 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:10:23,097 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDNOK
2025-07-11 00:10:23,097 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol USDTRY
2025-07-11 00:10:25,128 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:10:25,130 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:10:25,168 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 13.
2025-07-11 00:10:25,261 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 17.
2025-07-11 00:10:25,262 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 18.
2025-07-11 00:10:25,263 - WARNING - app - No group settings found for group Elite. Skipping portfolio update for user 19.
2025-07-11 00:10:25,618 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDCAD
2025-07-11 00:10:25,618 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:10:25,619 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol EURUSD
2025-07-11 00:10:25,625 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 21.
2025-07-11 00:10:25,625 - WARNING - app - No group settings found for group VIP. Skipping portfolio update for user 22.
2025-07-11 00:10:25,626 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 23.
2025-07-11 00:10:25,626 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 24.
2025-07-11 00:10:25,627 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 25.
2025-07-11 00:10:25,713 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 1.
2025-07-11 00:10:25,833 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-11 00:10:25,964 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-11 00:10:25,966 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 4.
2025-07-11 00:10:26,101 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-11 00:10:26,248 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-11 00:10:26,250 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 9.
2025-07-11 00:10:26,250 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 10.
2025-07-11 00:10:26,251 - WARNING - app - No group settings found for group Group B. Skipping portfolio update for user 11.
2025-07-11 00:11:08,246 - INFO - app - Application shutdown initiated
2025-07-11 00:11:08,247 - INFO - app - Scheduler shutdown completed
2025-07-11 00:11:08,248 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-11 00:11:08,969 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-11 00:11:08,970 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-11 00:11:08,975 - INFO - app - Redis connection closed
2025-07-11 00:11:08,975 - INFO - app - Application shutdown completed
2025-07-11 00:11:14,182 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-11 00:11:14,195 - INFO - app.core.config - .env file loaded successfully.
2025-07-11 00:11:14,206 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-11 00:11:14,206 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-11 00:11:14,480 - INFO - app - Application starting up - Trading system initialized
2025-07-11 00:11:14,480 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-11 00:11:14,481 - INFO - app - Environment: PRODUCTION
2025-07-11 00:11:14,534 - INFO - app - Application startup initiated
2025-07-11 00:11:14,534 - INFO - app - Initializing core services...
2025-07-11 00:11:14,565 - INFO - app - Firebase initialized
2025-07-11 00:11:14,565 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-11 00:11:16,611 - INFO - app - Redis initialized
2025-07-11 00:11:16,617 - INFO - app - Scheduler initialized
2025-07-11 00:11:16,619 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-11 00:11:16,620 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-11 00:11:17,782 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-11 00:11:17,793 - INFO - app - Starting stale cache cleanup task
2025-07-11 00:11:21,872 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-11 00:11:21,872 - INFO - app - Background tasks initialized
2025-07-11 00:11:22,485 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-11 00:11:22,486 - INFO - app - Application startup completed successfully
2025-07-11 00:11:22,486 - INFO - app - Starting cache validation task
2025-07-11 00:11:22,490 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-11 00:11:22,715 - INFO - app - Validating cache for 28 users
2025-07-11 00:11:24,525 - INFO - app - Found 5 static orders cache entries to check
2025-07-11 00:11:26,585 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-11 00:11:30,665 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-11 00:11:32,714 - WARNING - app - User 5: Missing static orders cache, refreshing...
2025-07-11 00:11:32,718 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-11 00:11:32,718 - INFO - app - Completed stale cache cleanup task
2025-07-11 00:11:32,868 - WARNING - app - User 8: Missing static orders cache, refreshing...
2025-07-11 00:11:33,016 - WARNING - app - User 12: Missing static orders cache, refreshing...
2025-07-11 00:11:33,129 - WARNING - app - User 13: Missing static orders cache, refreshing...
2025-07-11 00:11:33,248 - WARNING - app - User 16: Missing static orders cache, refreshing...
2025-07-11 00:11:33,357 - WARNING - app - User 17: Missing static orders cache, refreshing...
2025-07-11 00:11:33,461 - WARNING - app - User 18: Missing static orders cache, refreshing...
2025-07-11 00:11:33,565 - WARNING - app - User 19: Missing static orders cache, refreshing...
2025-07-11 00:11:33,680 - WARNING - app - User 20: Missing static orders cache, refreshing...
2025-07-11 00:11:33,682 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-11 00:11:33,791 - WARNING - app - User 21: Missing static orders cache, refreshing...
2025-07-11 00:11:33,849 - INFO - app.core.config - .env file loaded successfully.
2025-07-11 00:11:33,867 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-11 00:11:33,867 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-11 00:11:33,901 - WARNING - app - User 22: Missing static orders cache, refreshing...
2025-07-11 00:11:34,009 - WARNING - app - User 23: Missing static orders cache, refreshing...
2025-07-11 00:11:34,133 - WARNING - app - User 24: Missing static orders cache, refreshing...
2025-07-11 00:11:34,260 - WARNING - app - User 25: Missing static orders cache, refreshing...
2025-07-11 00:11:34,366 - WARNING - app - User 1: Missing static orders cache, refreshing...
2025-07-11 00:11:34,480 - WARNING - app - User 2: Missing static orders cache, refreshing...
2025-07-11 00:11:34,595 - WARNING - app - User 3: Missing static orders cache, refreshing...
2025-07-11 00:11:34,726 - WARNING - app - User 6: Missing static orders cache, refreshing...
2025-07-11 00:11:34,859 - INFO - app - Cache validation completed
2025-07-11 00:11:37,456 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-11 00:11:37,456 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-11 00:11:37,488 - INFO - app - Starting stale cache cleanup task
2025-07-11 00:11:37,490 - INFO - app - Found 23 static orders cache entries to check
2025-07-11 00:11:37,491 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-11 00:11:37,495 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-11 00:11:37,500 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-11 00:11:37,504 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-11 00:11:37,504 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-11 00:11:37,505 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-11 00:11:37,509 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-11 00:11:37,510 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-11 00:11:37,510 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-11 00:11:37,516 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-11 00:11:37,518 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-11 00:11:37,518 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-11 00:11:37,519 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-11 00:11:37,520 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-11 00:11:37,523 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-11 00:11:37,523 - INFO - app - Completed stale cache cleanup task
2025-07-11 00:11:56,607 - INFO - app - Application shutdown initiated
2025-07-11 00:11:56,607 - INFO - app - Scheduler shutdown completed
2025-07-11 00:11:56,968 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-11 00:11:57,990 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-11 00:11:57,990 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-11 00:11:57,992 - INFO - app - Redis connection closed
2025-07-11 00:11:57,992 - INFO - app - Application shutdown completed
