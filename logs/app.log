2025-07-13 23:33:48,780 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:33:48,793 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:33:48,804 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:33:48,804 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:33:49,110 - INFO - app - Application starting up - Trading system initialized
2025-07-13 23:33:49,110 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-13 23:33:49,110 - INFO - app - Environment: PRODUCTION
2025-07-13 23:33:49,158 - INFO - app - Application startup initiated
2025-07-13 23:33:49,158 - INFO - app - Initializing core services...
2025-07-13 23:33:49,193 - INFO - app - Firebase initialized
2025-07-13 23:33:49,193 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-13 23:33:51,252 - INFO - app - Redis initialized
2025-07-13 23:33:51,257 - INFO - app - Scheduler initialized
2025-07-13 23:33:51,259 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:33:51,260 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-13 23:33:52,408 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:33:52,429 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:33:56,489 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-13 23:33:56,489 - INFO - app - Background tasks initialized
2025-07-13 23:33:57,132 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-13 23:33:57,132 - INFO - app - Application startup completed successfully
2025-07-13 23:33:57,132 - INFO - app - Starting cache validation task
2025-07-13 23:33:57,136 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-13 23:33:57,139 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-13 23:33:57,188 - INFO - app - Validating cache for 31 users
2025-07-13 23:33:59,176 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:34:01,211 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-13 23:34:07,348 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:34:07,356 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:34:07,378 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:34:07,380 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-13 23:34:07,382 - WARNING - app - Found stale cache entry for user 26, will be refreshed on next access
2025-07-13 23:34:07,389 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:34:07,392 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-13 23:34:07,393 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:34:07,396 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:34:07,404 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:34:07,408 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:34:07,414 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:34:07,418 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:34:07,421 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-13 23:34:07,422 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:34:07,428 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:34:07,435 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:34:07,439 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:34:07,446 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:34:07,447 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-13 23:34:07,449 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:34:07,456 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:34:07,473 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-13 23:34:07,489 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-13 23:34:09,555 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-13 23:34:09,570 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-13 23:34:09,592 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-13 23:34:09,608 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-13 23:34:11,656 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-13 23:34:11,679 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-13 23:34:12,140 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:34:13,741 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,743 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:34:13,755 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:34:13,758 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:34:13,768 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:34:13,769 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,770 - WARNING - app - Found stale cache entry for user 26, will be refreshed on next access
2025-07-13 23:34:13,773 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:34:13,777 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:34:13,779 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:34:13,783 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:34:13,785 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:34:13,785 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,788 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:34:13,792 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:34:13,795 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:34:13,799 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:34:13,807 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:34:13,810 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:34:13,811 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,817 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:34:13,820 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:34:13,824 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:34:13,828 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,836 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,844 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,882 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,892 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,903 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,913 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-13 23:34:13,931 - INFO - app - Cache validation completed
2025-07-13 23:34:15,185 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:34:15,202 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:34:15,240 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:34:15,247 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:34:15,284 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:34:15,374 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:34:15,383 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:34:15,476 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:34:15,501 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:34:15,502 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:34:15,516 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:34:15,542 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:34:15,542 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:34:15,543 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:34:15,552 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:34:15,569 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:34:15,569 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:34:15,578 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:34:15,578 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:34:15,597 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:34:15,611 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:34:15,611 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:34:15,646 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:34:15,655 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:34:15,663 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:34:15,663 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:34:15,671 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:34:15,671 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:34:35,374 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '5893584612', 'user_id': '26', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '1.3', 'price': '122227.4', 'status': 'OPEN', 'contract_value': '1.3', 'account_type': 'live', 'timestamp': '2025-07-14T06:34:35.374737'}
2025-07-13 23:34:35,724 - INFO - app.core.firebase - Order data (ID: 5893584612) sent to Firebase successfully.
2025-07-13 23:34:51,306 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:34:51,312 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:34:52,927 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:34:52,937 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:34:52,998 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:34:52,999 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:35:51,296 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:35:51,301 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:35:51,746 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.30469396250506184496894300% which is below threshold 100.0%
2025-07-13 23:35:52,215 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:35:52,232 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:35:52,259 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:35:52,260 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:36:51,291 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:36:51,295 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:36:51,807 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.64174125579064051886152774% which is below threshold 100.0%
2025-07-13 23:36:52,219 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:36:52,224 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:36:52,241 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:36:52,241 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:37:00,972 - INFO - app - Application shutdown initiated
2025-07-13 23:37:00,972 - INFO - app - Scheduler shutdown completed
2025-07-13 23:37:01,364 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-13 23:37:03,187 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-13 23:37:03,187 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-13 23:37:03,191 - INFO - app - Redis connection closed
2025-07-13 23:37:03,192 - INFO - app - Application shutdown completed
2025-07-13 23:37:04,974 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:37:04,987 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:37:05,001 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:37:05,001 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:37:05,288 - INFO - app - Application starting up - Trading system initialized
2025-07-13 23:37:05,288 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-13 23:37:05,288 - INFO - app - Environment: PRODUCTION
2025-07-13 23:37:05,334 - INFO - app - Application startup initiated
2025-07-13 23:37:05,334 - INFO - app - Initializing core services...
2025-07-13 23:37:05,370 - INFO - app - Firebase initialized
2025-07-13 23:37:05,370 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-13 23:37:07,411 - INFO - app - Redis initialized
2025-07-13 23:37:07,419 - INFO - app - Scheduler initialized
2025-07-13 23:37:07,423 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:37:07,424 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-13 23:37:08,402 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:37:08,418 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:37:12,494 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-13 23:37:12,504 - INFO - app - Background tasks initialized
2025-07-13 23:37:13,313 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-13 23:37:13,313 - INFO - app - Application startup completed successfully
2025-07-13 23:37:13,314 - INFO - app - Starting cache validation task
2025-07-13 23:37:13,316 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-13 23:37:13,319 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-13 23:37:13,359 - INFO - app - Validating cache for 31 users
2025-07-13 23:37:15,365 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:37:19,439 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:37:21,491 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:37:21,521 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:37:21,531 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:37:21,535 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:37:23,598 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:37:23,607 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:37:23,609 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:37:23,613 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:37:23,617 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:37:23,622 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:37:23,625 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:37:23,636 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:37:23,640 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:37:23,648 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:37:23,652 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:37:23,654 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:37:25,788 - INFO - app - Cache validation completed
2025-07-13 23:37:28,327 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:37:29,948 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:37:29,954 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:37:29,955 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:37:29,958 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:37:31,974 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:37:31,979 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:37:31,983 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:37:31,991 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:37:31,993 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:37:31,997 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:37:31,999 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:37:32,002 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:37:32,004 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:37:32,009 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:37:32,011 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:37:32,013 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:37:32,017 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:37:32,021 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:37:33,407 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:37:33,458 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:37:33,521 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:37:33,536 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:37:33,550 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:37:33,555 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:37:33,564 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:37:33,689 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:37:33,709 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:37:33,709 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:37:33,747 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:37:33,757 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:37:33,764 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:37:33,764 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:37:33,780 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:37:33,780 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:37:33,785 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:37:33,793 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:37:33,805 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:37:33,806 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:37:33,812 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:37:33,813 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:37:33,818 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:37:33,834 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:37:33,838 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:37:33,838 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:37:33,847 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:37:33,847 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:37:47,526 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 26
2025-07-13 23:37:47,527 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 26
2025-07-13 23:37:47,533 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 26 using refresh token.
2025-07-13 23:38:07,437 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:38:07,439 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:38:07,995 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.34437064630202923740532737% which is below threshold 100.0%
2025-07-13 23:38:10,455 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:38:12,535 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:38:12,590 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:38:12,591 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:39:07,470 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:39:07,478 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:39:07,913 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.23229424052502856186337565% which is below threshold 100.0%
2025-07-13 23:39:08,336 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:39:08,341 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:39:08,350 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:39:08,351 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:40:07,453 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:40:07,457 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:40:07,940 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.16562105022703180962491532% which is below threshold 100.0%
2025-07-13 23:40:08,321 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:40:08,366 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:40:08,385 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:40:08,386 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:41:07,449 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:41:07,451 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:41:07,908 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.00895950492560385804620178% which is below threshold 100.0%
2025-07-13 23:41:08,319 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:41:08,348 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:41:08,368 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:41:08,369 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:42:07,440 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:42:07,442 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:42:07,912 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.21347849356976567472859544% which is below threshold 100.0%
2025-07-13 23:42:08,323 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:42:08,330 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:42:08,343 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:42:08,343 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:42:25,794 - INFO - app - Starting cache validation task
2025-07-13 23:42:25,803 - INFO - app - Validating cache for 31 users
2025-07-13 23:42:25,804 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,810 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,812 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,817 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,821 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,826 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,830 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,833 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,836 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,839 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,842 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,845 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,848 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,850 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,853 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,855 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,860 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,863 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,867 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,872 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,879 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,883 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,887 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,890 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-13 23:42:25,895 - INFO - app - Cache validation completed
2025-07-13 23:43:07,470 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:43:07,475 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:43:08,120 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.21347849356976567472859544% which is below threshold 100.0%
2025-07-13 23:43:08,535 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:43:08,545 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:43:08,562 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:43:08,563 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:43:31,290 - INFO - app - Application shutdown initiated
2025-07-13 23:43:31,290 - INFO - app - Scheduler shutdown completed
2025-07-13 23:43:31,555 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-13 23:43:42,904 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-13 23:43:42,904 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-13 23:43:42,908 - INFO - app - Redis connection closed
2025-07-13 23:43:42,908 - INFO - app - Application shutdown completed
2025-07-13 23:46:51,676 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:46:51,689 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:46:51,699 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:46:51,699 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:46:51,952 - INFO - app - Application starting up - Trading system initialized
2025-07-13 23:46:51,952 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-13 23:46:51,952 - INFO - app - Environment: PRODUCTION
2025-07-13 23:46:51,999 - INFO - app - Application startup initiated
2025-07-13 23:46:51,999 - INFO - app - Initializing core services...
2025-07-13 23:46:52,033 - INFO - app - Firebase initialized
2025-07-13 23:46:52,033 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-13 23:46:54,097 - INFO - app - Redis initialized
2025-07-13 23:46:54,102 - INFO - app - Scheduler initialized
2025-07-13 23:46:54,105 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:46:54,105 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-13 23:46:55,173 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:46:55,175 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:46:59,260 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-13 23:46:59,260 - INFO - app - Background tasks initialized
2025-07-13 23:46:59,950 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-13 23:46:59,950 - INFO - app - Application startup completed successfully
2025-07-13 23:46:59,951 - INFO - app - Starting cache validation task
2025-07-13 23:46:59,955 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-13 23:46:59,961 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-13 23:47:00,005 - INFO - app - Validating cache for 31 users
2025-07-13 23:47:01,986 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:47:06,031 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:47:08,086 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:47:08,114 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:47:08,127 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:47:08,132 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:47:08,138 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:47:08,146 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:47:08,150 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:47:08,162 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:47:08,176 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:47:08,191 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:47:08,201 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:47:08,232 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:47:08,245 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:47:08,265 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:47:08,269 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:47:08,276 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:47:10,446 - INFO - app - Cache validation completed
2025-07-13 23:47:14,173 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:47:14,197 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:47:14,215 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:47:14,229 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:47:14,231 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:47:14,242 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:47:14,286 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:47:14,443 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:47:14,471 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:47:14,471 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:47:14,477 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:47:14,496 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:47:14,501 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:47:14,502 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:47:14,504 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:47:14,504 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:47:14,511 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:47:14,511 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:47:14,527 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:47:14,527 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:47:14,529 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:47:14,529 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:47:14,532 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:47:14,554 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:47:14,555 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:47:14,556 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:47:14,576 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:47:14,576 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:47:14,951 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:47:14,951 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:47:14,952 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:47:14,952 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:47:14,953 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:47:14,953 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:47:14,953 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:47:14,953 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:47:14,954 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:47:14,954 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:47:14,954 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:47:14,954 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:47:14,955 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:47:14,955 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:47:14,955 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:47:14,956 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:47:14,956 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:47:14,956 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:47:14,956 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:47:54,143 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:47:54,152 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:47:54,837 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 24.93328747912726398587371613% which is below threshold 100.0%
2025-07-13 23:47:55,386 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:47:55,400 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:47:55,445 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:47:55,447 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:48:54,121 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:48:54,123 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:48:54,614 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 25.01591315053950535981340317% which is below threshold 100.0%
2025-07-13 23:48:54,983 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:48:54,990 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:48:55,001 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:48:55,002 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:48:55,545 - INFO - app - Application shutdown initiated
2025-07-13 23:48:55,546 - INFO - app - Scheduler shutdown completed
2025-07-13 23:48:55,966 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-13 23:48:56,582 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-13 23:48:56,582 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-13 23:48:56,585 - INFO - app - Redis connection closed
2025-07-13 23:48:56,586 - INFO - app - Application shutdown completed
2025-07-13 23:48:58,931 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:48:58,953 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:48:58,965 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:48:58,965 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:48:59,365 - INFO - app - Application starting up - Trading system initialized
2025-07-13 23:48:59,365 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-13 23:48:59,365 - INFO - app - Environment: PRODUCTION
2025-07-13 23:48:59,419 - INFO - app - Application startup initiated
2025-07-13 23:48:59,419 - INFO - app - Initializing core services...
2025-07-13 23:48:59,454 - INFO - app - Firebase initialized
2025-07-13 23:48:59,454 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-13 23:49:01,496 - INFO - app - Redis initialized
2025-07-13 23:49:01,501 - INFO - app - Scheduler initialized
2025-07-13 23:49:01,503 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:49:01,503 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-13 23:49:02,528 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:49:02,534 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:49:06,611 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-13 23:49:06,611 - INFO - app - Background tasks initialized
2025-07-13 23:49:07,437 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-13 23:49:07,439 - INFO - app - Application startup completed successfully
2025-07-13 23:49:07,439 - INFO - app - Starting cache validation task
2025-07-13 23:49:07,442 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-13 23:49:07,444 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-13 23:49:07,464 - INFO - app - Validating cache for 31 users
2025-07-13 23:49:09,496 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:49:11,520 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-13 23:49:13,567 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:49:13,581 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:49:15,665 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:49:15,671 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-13 23:49:15,673 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:49:15,678 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:49:15,683 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:49:15,684 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-13 23:49:15,691 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:49:15,696 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:49:15,701 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:49:15,708 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:49:15,713 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:49:15,718 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-13 23:49:15,719 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:49:15,733 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:49:17,784 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:49:17,800 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:49:17,803 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:49:17,805 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-13 23:49:17,807 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:49:17,833 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-13 23:49:21,949 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-13 23:49:21,979 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-13 23:49:22,001 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-13 23:49:22,051 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-13 23:49:22,073 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-13 23:49:22,454 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:49:24,101 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:49:24,112 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:49:24,115 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:49:24,122 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,131 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:49:24,144 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:49:24,152 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:49:24,159 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:49:24,162 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,168 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:49:24,171 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:49:24,174 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:49:24,177 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:49:24,179 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:49:24,181 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:49:24,183 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,185 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:49:24,188 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:49:24,193 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:49:24,196 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:49:24,197 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:49:24,200 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,214 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,230 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,246 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,264 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,282 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,300 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,308 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,364 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,385 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-13 23:49:24,425 - INFO - app - Cache validation completed
2025-07-13 23:49:25,686 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:49:25,758 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:49:25,791 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:49:25,808 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:49:25,811 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:49:25,836 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:49:25,864 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:49:26,001 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:49:26,029 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:49:26,030 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:49:26,080 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:49:26,102 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:49:26,103 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:49:26,120 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:49:26,130 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:49:26,148 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:49:26,148 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:49:26,152 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:49:26,159 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:49:26,160 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:49:26,181 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:49:26,181 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:49:26,189 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:49:26,199 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:49:26,205 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:49:26,205 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:49:26,209 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:49:26,209 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:49:48,567 - INFO - app - Application shutdown initiated
2025-07-13 23:49:48,568 - INFO - app - Scheduler shutdown completed
2025-07-13 23:49:48,962 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-13 23:49:49,213 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-13 23:49:49,214 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-13 23:49:49,215 - INFO - app - Redis connection closed
2025-07-13 23:49:49,215 - INFO - app - Application shutdown completed
2025-07-13 23:49:51,215 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:49:51,235 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:49:51,250 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:49:51,250 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:49:51,576 - INFO - app - Application starting up - Trading system initialized
2025-07-13 23:49:51,576 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-13 23:49:51,576 - INFO - app - Environment: PRODUCTION
2025-07-13 23:49:51,629 - INFO - app - Application startup initiated
2025-07-13 23:49:51,629 - INFO - app - Initializing core services...
2025-07-13 23:49:51,666 - INFO - app - Firebase initialized
2025-07-13 23:49:51,667 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-13 23:49:53,730 - INFO - app - Redis initialized
2025-07-13 23:49:53,735 - INFO - app - Scheduler initialized
2025-07-13 23:49:53,739 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:49:53,740 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-13 23:49:54,742 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:49:54,762 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:49:58,845 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-13 23:49:58,845 - INFO - app - Background tasks initialized
2025-07-13 23:49:59,598 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-13 23:49:59,598 - INFO - app - Application startup completed successfully
2025-07-13 23:49:59,598 - INFO - app - Starting cache validation task
2025-07-13 23:49:59,601 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-13 23:49:59,605 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-13 23:49:59,661 - INFO - app - Validating cache for 31 users
2025-07-13 23:50:01,632 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:50:07,756 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:50:07,763 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:50:07,821 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:50:07,843 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:50:07,849 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:50:07,857 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:50:07,871 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:50:07,876 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:50:07,880 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:50:07,885 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:50:07,890 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:50:07,898 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:50:07,916 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:50:07,926 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:50:07,940 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:50:07,944 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:50:07,950 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:50:10,159 - INFO - app - Cache validation completed
2025-07-13 23:50:12,018 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:50:12,038 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:50:12,046 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:50:12,076 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:50:12,080 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:50:12,104 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:50:12,392 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:50:12,393 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:50:12,395 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:50:12,397 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:50:12,412 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:50:12,412 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:50:12,417 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:50:12,417 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:50:12,419 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:50:12,419 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:50:12,420 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:50:12,425 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:50:12,445 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:50:12,445 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:50:12,461 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:50:12,461 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:50:12,464 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:50:12,465 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:50:12,495 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:50:12,510 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:50:12,510 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:50:14,605 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:50:16,565 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:50:16,597 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:50:16,617 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:50:16,629 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:50:16,635 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:50:16,640 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:50:16,644 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:50:16,653 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:50:16,656 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:50:16,659 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:50:16,663 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:50:16,668 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:50:18,719 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:50:18,760 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:50:18,771 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:50:18,785 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:50:18,793 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:50:18,799 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:50:53,753 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:50:53,755 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:50:54,441 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 24.94719477035506698940811890% which is below threshold 100.0%
2025-07-13 23:50:54,455 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '5039189090', 'order_id': '5893584612', 'user_id': '26', 'symbol': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'close', 'order_quantity': '1.30000000', 'contract_value': '1.30000000', 'timestamp': '2025-07-14T06:50:54.455228', 'account_type': 'live'}
2025-07-13 23:50:54,849 - INFO - app.core.firebase - Order data (ID: 5893584612) sent to Firebase successfully.
2025-07-13 23:50:55,364 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:50:55,368 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:50:55,384 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:50:55,384 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:51:53,757 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:51:53,760 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:51:54,255 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 24.94719477035506698940811890% which is below threshold 100.0%
2025-07-13 23:51:54,260 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '2173521967', 'order_id': '5893584612', 'user_id': '26', 'symbol': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'close', 'order_quantity': '1.30000000', 'contract_value': '1.30000000', 'timestamp': '2025-07-14T06:51:54.260743', 'account_type': 'live'}
2025-07-13 23:51:54,559 - INFO - app.core.firebase - Order data (ID: 5893584612) sent to Firebase successfully.
2025-07-13 23:51:54,925 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:51:54,929 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:51:54,938 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:51:54,938 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:51:57,091 - INFO - app - Application shutdown initiated
2025-07-13 23:51:57,092 - INFO - app - Scheduler shutdown completed
2025-07-13 23:51:57,495 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-13 23:51:59,774 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-13 23:51:59,774 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-13 23:51:59,779 - INFO - app - Redis connection closed
2025-07-13 23:51:59,780 - INFO - app - Application shutdown completed
2025-07-13 23:52:02,018 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:52:02,030 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:52:02,040 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:52:02,040 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:52:02,413 - INFO - app - Application starting up - Trading system initialized
2025-07-13 23:52:02,413 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-13 23:52:02,413 - INFO - app - Environment: PRODUCTION
2025-07-13 23:52:02,473 - INFO - app - Application startup initiated
2025-07-13 23:52:02,473 - INFO - app - Initializing core services...
2025-07-13 23:52:02,506 - INFO - app - Firebase initialized
2025-07-13 23:52:02,506 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-13 23:52:04,544 - INFO - app - Redis initialized
2025-07-13 23:52:04,550 - INFO - app - Scheduler initialized
2025-07-13 23:52:04,554 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:52:04,556 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-13 23:52:05,608 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:52:05,622 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:52:09,734 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-13 23:52:09,734 - INFO - app - Background tasks initialized
2025-07-13 23:52:10,423 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-13 23:52:10,423 - INFO - app - Application startup completed successfully
2025-07-13 23:52:10,423 - INFO - app - Starting cache validation task
2025-07-13 23:52:10,428 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-13 23:52:10,432 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-13 23:52:10,465 - INFO - app - Validating cache for 31 users
2025-07-13 23:52:12,482 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:52:18,603 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:52:18,617 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:52:18,657 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:52:18,665 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:52:18,670 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:52:18,678 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:52:18,685 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:52:18,688 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:52:18,693 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:52:18,699 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:52:18,704 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:52:18,707 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:52:18,717 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:52:18,721 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:52:18,729 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:52:18,732 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:52:18,738 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:52:22,978 - INFO - app - Cache validation completed
2025-07-13 23:52:25,435 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:52:27,153 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:52:27,164 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:52:27,169 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:52:27,180 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:52:27,185 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:52:27,188 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:52:29,219 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:52:29,228 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:52:29,231 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:52:29,233 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:52:29,237 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:52:29,240 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:52:29,243 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:52:29,253 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:52:29,256 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:52:29,263 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:52:29,267 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:52:29,270 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:52:32,929 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:52:32,959 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:52:32,981 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:52:33,008 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:52:33,025 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:52:33,034 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:52:33,190 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:52:33,213 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:52:33,214 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:52:33,229 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:52:33,253 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:52:33,254 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:52:33,266 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:52:33,282 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:52:33,284 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:52:33,290 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:52:33,291 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:52:33,306 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:52:33,306 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:52:33,307 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:52:33,307 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:52:33,310 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:52:33,311 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:52:33,327 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:52:33,327 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:52:33,328 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:52:33,328 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:53:04,571 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:53:04,574 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:53:05,100 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 24.93165132721811069134025698% which is below threshold 100.0%
2025-07-13 23:53:05,108 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1773824319', 'order_id': '5893584612', 'user_id': '26', 'symbol': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '1.30000000', 'contract_value': '1.30000000', 'timestamp': '2025-07-14T06:53:05.108260', 'account_type': 'live'}
2025-07-13 23:53:05,509 - INFO - app.core.firebase - Order data (ID: 5893584612) sent to Firebase successfully.
2025-07-13 23:53:05,926 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:53:05,935 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:53:05,942 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:53:05,942 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:54:04,570 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:54:04,572 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:54:05,060 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 24.90670001060352294970500496% which is below threshold 100.0%
2025-07-13 23:54:05,104 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '5540636405', 'order_id': '5893584612', 'user_id': '26', 'symbol': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '1.30000000', 'contract_value': '1.30000000', 'timestamp': '2025-07-14T06:54:05.104368', 'account_type': 'live'}
2025-07-13 23:54:05,416 - INFO - app.core.firebase - Order data (ID: 5893584612) sent to Firebase successfully.
2025-07-13 23:54:05,418 - INFO - app - Application shutdown initiated
2025-07-13 23:54:05,418 - INFO - app - Scheduler shutdown completed
2025-07-13 23:54:05,456 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-13 23:54:05,541 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-13 23:54:05,541 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-13 23:54:05,542 - INFO - app - Redis connection closed
2025-07-13 23:54:05,542 - INFO - app - Application shutdown completed
2025-07-13 23:54:07,545 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:54:07,558 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:54:07,568 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:54:07,569 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:54:07,879 - INFO - app - Application starting up - Trading system initialized
2025-07-13 23:54:07,880 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-13 23:54:07,880 - INFO - app - Environment: PRODUCTION
2025-07-13 23:54:07,927 - INFO - app - Application startup initiated
2025-07-13 23:54:07,927 - INFO - app - Initializing core services...
2025-07-13 23:54:07,959 - INFO - app - Firebase initialized
2025-07-13 23:54:07,959 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-13 23:54:10,007 - INFO - app - Redis initialized
2025-07-13 23:54:10,010 - INFO - app - Scheduler initialized
2025-07-13 23:54:10,012 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:54:10,013 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-13 23:54:10,806 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:54:10,817 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:54:14,913 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-13 23:54:14,913 - INFO - app - Background tasks initialized
2025-07-13 23:54:15,513 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-13 23:54:15,513 - INFO - app - Application startup completed successfully
2025-07-13 23:54:15,514 - INFO - app - Starting cache validation task
2025-07-13 23:54:15,515 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-13 23:54:15,516 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-13 23:54:15,551 - INFO - app - Validating cache for 31 users
2025-07-13 23:54:17,567 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:54:19,609 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-13 23:54:21,672 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:54:21,684 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:54:25,770 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:54:25,786 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-13 23:54:25,788 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:54:25,797 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:54:25,802 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-13 23:54:25,805 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:54:25,817 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:54:25,824 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:54:25,834 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:54:25,843 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:54:25,854 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:54:25,859 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-13 23:54:25,859 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:54:25,874 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:54:25,881 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:54:25,893 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:54:25,902 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:54:25,904 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-13 23:54:25,908 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:54:25,935 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-13 23:54:27,988 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,023 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,048 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,067 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,079 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,090 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,104 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,122 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,133 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,147 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,160 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,172 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,186 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,201 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,219 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,230 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,248 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,260 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-13 23:54:28,361 - INFO - app - Cache validation completed
2025-07-13 23:54:30,334 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:54:30,349 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:54:30,369 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:54:30,374 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:54:30,413 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:54:30,436 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:54:30,504 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:54:30,528 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:54:30,726 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:54:30,734 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:54:30,756 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:54:30,758 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:54:30,758 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:54:30,761 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:54:30,768 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:54:30,768 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:54:30,782 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:54:30,783 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:54:30,802 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:54:30,802 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:54:30,812 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:54:30,826 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:54:30,838 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:54:30,838 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:54:30,850 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:54:30,850 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:54:30,881 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:54:30,894 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:54:30,894 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:54:32,227 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:54:32,233 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:54:32,234 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:54:32,235 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:54:32,235 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:54:32,236 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:54:32,236 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:54:32,237 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:54:32,237 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:54:32,237 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:54:32,238 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:54:32,238 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:54:32,238 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:54:32,239 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:54:32,239 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:54:32,240 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:54:32,240 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:54:32,240 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:55:02,136 - INFO - app - Application shutdown initiated
2025-07-13 23:55:02,136 - INFO - app - Scheduler shutdown completed
2025-07-13 23:55:02,489 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-13 23:55:02,831 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-13 23:55:02,831 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-13 23:55:02,834 - INFO - app - Redis connection closed
2025-07-13 23:55:02,835 - INFO - app - Application shutdown completed
2025-07-13 23:55:04,989 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:55:05,003 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:55:05,014 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:55:05,014 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:55:05,341 - INFO - app - Application starting up - Trading system initialized
2025-07-13 23:55:05,341 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-13 23:55:05,342 - INFO - app - Environment: PRODUCTION
2025-07-13 23:55:05,404 - INFO - app - Application startup initiated
2025-07-13 23:55:05,405 - INFO - app - Initializing core services...
2025-07-13 23:55:05,438 - INFO - app - Firebase initialized
2025-07-13 23:55:05,439 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-13 23:55:07,487 - INFO - app - Redis initialized
2025-07-13 23:55:07,492 - INFO - app - Scheduler initialized
2025-07-13 23:55:07,493 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:55:07,494 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-13 23:55:08,600 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-13 23:55:08,613 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:55:12,695 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-13 23:55:12,695 - INFO - app - Background tasks initialized
2025-07-13 23:55:13,318 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-13 23:55:13,318 - INFO - app - Application startup completed successfully
2025-07-13 23:55:13,319 - INFO - app - Starting cache validation task
2025-07-13 23:55:13,321 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-13 23:55:13,323 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-13 23:55:13,369 - INFO - app - Validating cache for 31 users
2025-07-13 23:55:15,364 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:55:21,517 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:55:21,524 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:55:21,555 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:55:21,570 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:55:21,576 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:55:21,584 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:55:21,596 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:55:21,603 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:55:21,610 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:55:21,618 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:55:21,625 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:55:21,634 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:55:21,644 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:55:21,648 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:55:21,659 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:55:21,663 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:55:21,666 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:55:25,891 - INFO - app - Cache validation completed
2025-07-13 23:55:28,321 - INFO - app - Starting stale cache cleanup task
2025-07-13 23:55:30,089 - INFO - app - Found 24 static orders cache entries to check
2025-07-13 23:55:30,104 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-13 23:55:30,123 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-13 23:55:30,148 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-13 23:55:30,163 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-13 23:55:30,170 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-13 23:55:30,175 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-13 23:55:30,200 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-13 23:55:30,212 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-13 23:55:30,218 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-13 23:55:30,228 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-13 23:55:30,241 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-13 23:55:30,254 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-13 23:55:30,261 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-13 23:55:30,266 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-13 23:55:30,274 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-13 23:55:30,278 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-13 23:55:30,280 - INFO - app - Completed stale cache cleanup task
2025-07-13 23:55:32,288 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:55:32,351 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:55:32,359 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:55:32,408 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:55:32,428 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:55:32,429 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:55:32,444 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-13 23:55:32,734 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:55:32,735 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:55:32,772 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:55:32,772 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:55:32,782 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:55:32,799 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:55:32,800 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:55:32,828 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:55:32,829 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:55:32,836 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:55:32,872 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:55:32,883 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:55:32,902 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:55:32,903 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:55:32,909 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:55:32,909 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:55:32,925 - INFO - app.core.config - .env file loaded successfully.
2025-07-13 23:55:32,927 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:55:32,927 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:55:32,945 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-13 23:55:32,945 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-13 23:56:07,519 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-13 23:56:07,522 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-13 23:56:08,059 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 24.88788426364826006257022474% which is below threshold 100.0%
2025-07-13 23:56:08,069 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '6534416337', 'order_id': '5893584612', 'user_id': '26', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '1.30000000', 'contract_value': '1.30000000', 'timestamp': '2025-07-14T06:56:08.069894', 'account_type': 'live'}
2025-07-13 23:56:08,367 - INFO - app.core.firebase - Order data (ID: 5893584612) sent to Firebase successfully.
2025-07-13 23:56:08,737 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-13 23:56:08,744 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-13 23:56:08,770 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-13 23:56:08,771 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-13 23:56:33,782 - INFO - app - Application shutdown initiated
2025-07-13 23:56:33,783 - INFO - app - Scheduler shutdown completed
2025-07-13 23:56:34,102 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-13 23:56:34,612 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-13 23:56:34,612 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-13 23:56:34,614 - INFO - app - Redis connection closed
2025-07-13 23:56:34,615 - INFO - app - Application shutdown completed
