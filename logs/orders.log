2025-07-18 04:47:26,467 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-18 04:47:27,593 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-18 04:47:27,593 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-18 04:47:27,593 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-18 04:47:27,593 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-18 04:47:27,640 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-18 04:47:27,640 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-18 04:47:29,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDCAD
2025-07-18 04:47:29,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-18 04:47:29,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993'), Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:47:29,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:47:29,338 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:47:33,420 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-18 04:47:33,491 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:47:33,968 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:47:33,968 - INFO - orders - Using order model: UserOrder
2025-07-18 04:47:33,971 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:47:33,972 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:47:33,973 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:47:33,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:47:33,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:47:33,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:47:33,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:47:33,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:47:33,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:47:33,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:47:33,976 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:47:33,976 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:47:33,978 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:47:34,577 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:47:34,577 - INFO - orders - Using order model: UserOrder
2025-07-18 04:47:34,578 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:47:34,582 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:47:34,583 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:47:34,588 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:47:34,588 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:47:34,588 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:47:34,588 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:47:34,588 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:47:34,590 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:47:37,597 - INFO - orders - Starting the users with orders cache updater task.
2025-07-18 04:47:54,405 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:47:56,676 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:47:58,974 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:06,046 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:12,333 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:48:12,333 - INFO - orders - Using order model: UserOrder
2025-07-18 04:48:12,338 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:48:12,341 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:48:12,343 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:48:12,347 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:48:12,347 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:48:12,347 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:48:12,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:48:12,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:48:12,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:48:12,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:48:12,348 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:48:12,348 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:48:12,356 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:48:12,807 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:13,267 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:48:13,267 - INFO - orders - Using order model: UserOrder
2025-07-18 04:48:13,272 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:48:13,276 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:48:13,279 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:48:13,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:48:13,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:48:13,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:48:13,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:48:13,287 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:48:13,295 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:48:18,745 - INFO - orders - Order close request received - Order ID: 1127-001, User ID: 1, Close Price: 0.89519
2025-07-18 04:48:18,746 - INFO - orders - Request to close order 1127-001 for user 1 (user_type: demo) with price 0.89519. Frontend provided type: SELL, company: AUDCAD, status: CLOSED, frontend_status: CLOSED.
2025-07-18 04:48:18,809 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-18 04:48:18,850 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDCAD
2025-07-18 04:48:18,851 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-18 04:48:18,851 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993'), Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:48:18,851 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:48:18,852 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:48:18,852 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:48:18,852 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:48:18,852 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:48:18,860 - INFO - orders - Existing entry commission for order 1127-001: 0.10000000
2025-07-18 04:48:18,861 - INFO - orders - Commission calculation for order 1127-001: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-18 04:48:18,861 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.020000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 1127-001)
2025-07-18 04:48:18,861 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:48:18,863 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:48:18,863 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:48:18,863 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:48:18,865 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723500000'), 'o': Decimal('1.3723500000')}
2025-07-18 04:48:18,865 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723500000
2025-07-18 04:48:18,865 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.020000000000000000000000 CAD / 1.3723500000 = -0.01457354173498014354938608955 USD
2025-07-18 04:48:18,928 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=16449.76000000, margin=6.52
2025-07-18 04:48:18,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:48:18,969 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:48:18,969 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:48:18,969 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:48:18,970 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:48:18,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:48:18,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:48:18,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:48:18,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:48:18,997 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:48:19,006 - INFO - orders - Background balance/margin cache updated for user 1: balance=16449.76000000, margin=6.52
2025-07-18 04:48:19,898 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:48:19,983 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:20,611 - INFO - orders - Order close request received - Order ID: 1126-001, User ID: 1, Close Price: 0.89516
2025-07-18 04:48:20,612 - INFO - orders - Request to close order 1126-001 for user 1 (user_type: demo) with price 0.89516. Frontend provided type: BUY, company: AUDCAD, status: CLOSED, frontend_status: CLOSED.
2025-07-18 04:48:20,647 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-18 04:48:20,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:48:20,663 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:48:20,663 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.165993')], HighestMarginPerLot=652.165993
2025-07-18 04:48:20,663 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:48:20,663 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:48:20,675 - INFO - orders - Existing entry commission for order 1126-001: 0.10000000
2025-07-18 04:48:20,675 - INFO - orders - Commission calculation for order 1126-001: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-18 04:48:20,675 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 0.020000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 1126-001)
2025-07-18 04:48:20,676 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:48:20,678 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:48:20,678 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:48:20,679 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:48:20,682 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723500000'), 'o': Decimal('1.3723500000')}
2025-07-18 04:48:20,682 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723500000
2025-07-18 04:48:20,682 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 0.020000000000000000000000 CAD / 1.3723500000 = 0.01457354173498014354938608955 USD
2025-07-18 04:48:20,743 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=16449.57000000, margin=0
2025-07-18 04:48:20,843 - INFO - orders - Background balance/margin cache updated for user 1: balance=16449.57000000, margin=0.0
2025-07-18 04:48:20,869 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:48:24,667 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:26,888 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:29,102 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDCAD, Type: SELL_LIMIT, Quantity: 0.01
2025-07-18 04:48:29,193 - INFO - orders - Validating pending order price: Order type=SELL_LIMIT, Order price=0.89523, Current buy price=0.89524, Current sell price=0.89517
2025-07-18 04:48:29,255 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-07-18 04:48:29,258 - INFO - orders - [DEBUG] User data from cache: {'id': 1, 'email': 'dhanush777ss@gmail.com', 'account_number': '5O42G', 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('16449.97000000'), 'margin': Decimal('6.52000000'), 'user_type': 'demo', 'first_name': None, 'last_name': None, 'country': None, 'phone_number': Decimal('8618025298')}
2025-07-18 04:48:29,259 - INFO - orders - [DEBUG] Group name: Group B
2025-07-18 04:48:29,264 - INFO - orders - User 1 is_barclays_live_user: False (user_type: demo, sending_orders_normalized: barclays)
2025-07-18 04:48:29,271 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCAD: contract_size=100000.00000000, profit_currency=CAD, digit=5.00000
2025-07-18 04:48:29,665 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8952200000', 'o': '0.8951500000'}
2025-07-18 04:48:29,665 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8952200000, ask=0.89530952200000
2025-07-18 04:48:29,666 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8952200000, ask=0.89530952200000
2025-07-18 04:48:29,671 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.95 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:48:29,672 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:48:29,676 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:48:29,677 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:48:29,677 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:48:29,681 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723000000'), 'o': Decimal('1.3722700000')}
2025-07-18 04:48:29,681 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723000000
2025-07-18 04:48:29,681 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.95 CAD / 1.3723000000 = 6.521897544268745901042046200 USD
2025-07-18 04:48:29,682 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: SELL_LIMIT, Qty: 0.01, Price: 0.8952200000, Margin: 6.521897544268745901042046200, Commission: 0.10
2025-07-18 04:48:29,682 - INFO - orders - Calculated initial margin: 6.521897544268745901042046200, commission: 0.10 for pending order 1136-001
2025-07-18 04:48:29,701 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:29,719 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '1136-001', 'order_company_name': 'AUDCAD', 'order_type': 'SELL_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89523'), 'user_type': 'demo', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1137-005', 'takeprofit_id': '1138-006', 'order_user_id': 1, 'order_status': 'PENDING', 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.521897544268745901042046200'), 'commission': Decimal('0.10'), 'open_time': None}
2025-07-18 04:48:29,720 - INFO - orders - Placing PENDING order: SELL_LIMIT for user 1 at price 0.89523
2025-07-18 04:48:29,720 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '1136-001', 'order_status': 'PENDING', 'order_user_id': 1, 'order_company_name': 'AUDCAD', 'order_type': 'SELL_LIMIT', 'order_price': Decimal('0.89523'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.521897544268745901042046200'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1137-005', 'takeprofit_id': '1138-006', 'close_id': None}
2025-07-18 04:48:29,758 - INFO - orders - Order 1136-001 verified in database on attempt 1 before adding to Redis.
2025-07-18 04:48:29,765 - INFO - orders - Pending order 1136-001 added to Redis for non-Barclays user or demo user.
2025-07-18 04:48:29,806 - INFO - orders - [PERF] TOTAL place_order: 0.7152s
2025-07-18 04:48:29,870 - INFO - orders - Background balance/margin cache updated for user 1: balance=16449.57000000, margin=0.0
2025-07-18 04:48:36,489 - INFO - orders - [PENDING_CHECK] Found 1 matching SELL_LIMIT orders for AUDCAD at price 0.89525
2025-07-18 04:48:36,492 - INFO - orders - [PENDING_ORDER] Starting execution of order 1136-001 for user 1
2025-07-18 04:48:36,493 - INFO - orders - [PENDING_ORDER] Order 1136-001: Placed at 0.89523000, Triggered at 0.89525
2025-07-18 04:48:36,493 - INFO - orders - [PENDING_ORDER] Order 1136-001: Type SELL_LIMIT -> SELL
2025-07-18 04:48:36,498 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCAD: contract_size=100000.00000000, profit_currency=CAD, digit=5.00000
2025-07-18 04:48:36,823 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8952500000', 'o': '0.8951800000'}
2025-07-18 04:48:36,823 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8952500000, ask=0.89533952500000
2025-07-18 04:48:36,823 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8952500000, ask=0.89533952500000
2025-07-18 04:48:36,826 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.95 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-18 04:48:36,826 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:48:36,829 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:48:36,829 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:48:36,829 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:48:36,832 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723400000'), 'o': Decimal('1.3723100000')}
2025-07-18 04:48:36,832 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723400000
2025-07-18 04:48:36,832 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.95 CAD / 1.3723400000 = 6.521707448591456927583543437 USD
2025-07-18 04:48:36,832 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: SELL, Qty: 0.01000000, Price: 0.8952500000, Margin: 6.521707448591456927583543437, Commission: 0.10
2025-07-18 04:48:36,847 - INFO - orders - [PENDING_ORDER] Total user margin: 0.0
2025-07-18 04:48:36,865 - INFO - orders - [PENDING_ORDER] Updated user 1 total margin to 0.0 (includes all symbols)
2025-07-18 04:48:36,888 - INFO - orders - [PENDING_ORDER] Order 1136-001 status is OPEN, margin/commission updated
2025-07-18 04:48:36,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:48:36,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-18 04:48:36,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.170745')], HighestMarginPerLot=652.170745
2025-07-18 04:48:36,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:48:36,940 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.52
2025-07-18 04:48:36,948 - WARNING - orders - [PENDING_ORDER] Cache verification failed for user 1, retrying...
2025-07-18 04:48:36,950 - INFO - orders - [PENDING_ORDER] Successfully executed order 1136-001 for user 1
2025-07-18 04:48:36,950 - INFO - orders - [PENDING_ORDER] Order 1136-001: Final price=0.8952500000, margin=6.521707448591456927583543437, commission=0.10
2025-07-18 04:48:36,950 - INFO - orders - [PENDING_ORDER_SUMMARY] Order 1136-001 executed: SELL_LIMIT -> SELL, Placed: 0.89523000, Triggered: 0.89525, Margin: 6.521707448591456927583543437, Commission: 0.10, AdditionalMargin: None
2025-07-18 04:48:38,379 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:42,949 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:48:46,410 - INFO - orders - Order close request received - Order ID: 1136-001, User ID: 1, Close Price: 0.8952
2025-07-18 04:48:46,411 - INFO - orders - Request to close order 1136-001 for user 1 (user_type: demo) with price 0.8952. Frontend provided type: SELL, company: AUDCAD, status: CLOSED, frontend_status: CLOSED.
2025-07-18 04:48:46,446 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-18 04:48:46,462 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-18 04:48:46,462 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-18 04:48:46,462 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('652.170745')], HighestMarginPerLot=652.170745
2025-07-18 04:48:46,462 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.52
2025-07-18 04:48:46,463 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-18 04:48:46,470 - INFO - orders - Existing entry commission for order 1136-001: 0.10000000
2025-07-18 04:48:46,470 - INFO - orders - Commission calculation for order 1136-001: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-18 04:48:46,470 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 0.050000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 1136-001)
2025-07-18 04:48:46,471 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:48:46,473 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:48:46,473 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:48:46,473 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:48:46,476 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3723400000'), 'o': Decimal('1.3723100000')}
2025-07-18 04:48:46,476 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3723400000
2025-07-18 04:48:46,476 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 0.050000000000000000000000 CAD / 1.3723400000 = 0.03643411982453327892504772870 USD
2025-07-18 04:48:46,537 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=16449.41000000, margin=0
2025-07-18 04:48:46,623 - INFO - orders - Background balance/margin cache updated for user 1: balance=16449.41000000, margin=0.0
2025-07-18 04:48:46,643 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-18 04:48:47,801 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:48:47,802 - INFO - orders - Using order model: UserOrder
2025-07-18 04:48:47,809 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:48:47,814 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:48:47,815 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:48:47,820 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:48:47,820 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:48:47,820 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:48:47,820 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:48:47,820 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:48:47,820 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:48:47,821 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:48:47,821 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:48:47,821 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:48:47,825 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:48:48,623 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:48:48,624 - INFO - orders - Using order model: UserOrder
2025-07-18 04:48:48,632 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:48:48,647 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:48:48,650 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:48:48,656 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:48:48,657 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:48:48,657 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:48:48,657 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:48:48,657 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:48:48,665 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:52:02,221 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-18 04:52:03,463 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-18 04:52:03,463 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-18 04:52:03,463 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-18 04:52:03,464 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-18 04:52:03,501 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-18 04:52:03,502 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-18 04:52:04,133 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:52:04,133 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:52:04,133 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:52:04,133 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:52:04,133 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:52:04,252 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-18 04:52:04,252 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.35000000, TotalSellQty=0, NetQty=0.35000000, IsHedged=False
2025-07-18 04:52:04,252 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23633.37142857142857142857143')], HighestMarginPerLot=23633.37142857142857142857143
2025-07-18 04:52:04,252 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=8271.68
2025-07-18 04:52:04,252 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 8271.68
2025-07-18 04:52:04,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-18 04:52:04,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 04:52:04,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-18 04:52:04,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-18 04:52:04,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-18 04:52:04,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-18 04:52:04,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-18 04:52:04,414 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-18 04:52:04,414 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-18 04:52:09,099 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-18 04:52:09,571 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:52:09,571 - INFO - orders - Using order model: UserOrder
2025-07-18 04:52:09,572 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:52:09,574 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:52:09,575 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:52:09,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:52:09,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:52:09,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:52:09,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:52:09,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:52:09,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:52:09,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:52:09,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:52:09,577 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:52:09,579 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:52:10,056 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:52:10,056 - INFO - orders - Using order model: UserOrder
2025-07-18 04:52:10,057 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:52:10,058 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:52:10,059 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:52:10,062 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:52:10,062 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:52:10,063 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:52:10,063 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:52:10,063 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:52:10,064 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:52:13,463 - INFO - orders - Starting the users with orders cache updater task.
2025-07-18 04:52:18,071 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:52:20,420 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:52:24,970 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-18 04:52:25,527 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:52:25,527 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:52:25,527 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:52:25,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:52:25,528 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:52:34,150 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:52:36,455 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:52:38,778 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:52:41,102 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:52:46,469 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:52:46,469 - INFO - orders - Using order model: UserOrder
2025-07-18 04:52:46,472 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:52:46,474 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:52:46,475 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:52:46,479 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:52:46,479 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:52:46,479 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:52:46,479 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:52:46,479 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:52:46,479 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:52:46,480 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:52:46,480 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:52:46,480 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:52:46,485 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:52:47,122 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:52:47,122 - INFO - orders - Using order model: UserOrder
2025-07-18 04:52:47,125 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:52:47,127 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:52:47,128 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:52:47,131 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:52:47,131 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:52:47,132 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:52:47,132 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:52:47,132 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:52:47,135 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:52:50,411 - INFO - orders - Pending order placement request received - User ID: 4, Symbol: AUDCAD, Type: SELL_LIMIT, Quantity: 0.01
2025-07-18 04:52:50,433 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-07-18 04:52:50,435 - INFO - orders - [DEBUG] User data from cache: {'id': 4, 'email': 'dhanush777ss@gmail.com', 'account_number': 'DYY5A', 'group_name': 'Group B', 'leverage': Decimal('200.00'), 'wallet_balance': Decimal('19815.43000000'), 'margin': Decimal('11163.84000000'), 'user_type': 'live', 'first_name': None, 'last_name': None, 'country': 'string', 'phone_number': Decimal('8618025298')}
2025-07-18 04:52:50,435 - INFO - orders - [DEBUG] Group name: Group B
2025-07-18 04:52:50,436 - INFO - orders - User 4 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-18 04:52:50,440 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCAD: contract_size=100000.00000000, profit_currency=CAD, digit=5.00000
2025-07-18 04:52:50,774 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8951600000', 'o': '0.8951100000'}
2025-07-18 04:52:50,774 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8951600000, ask=0.89524951600000
2025-07-18 04:52:50,775 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8951600000, ask=0.89524951600000
2025-07-18 04:52:50,777 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 4.48 CAD to USD for margin_calculation (user_id: 4, position: None)
2025-07-18 04:52:50,778 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-18 04:52:50,780 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-18 04:52:50,780 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-18 04:52:50,780 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-18 04:52:50,782 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3722800000'), 'o': Decimal('1.3722500000')}
2025-07-18 04:52:50,782 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3722800000
2025-07-18 04:52:50,782 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 4.48 CAD / 1.3722800000 = 3.264639869414405223423791063 USD
2025-07-18 04:52:50,782 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: SELL_LIMIT, Qty: 0.01, Price: 0.8951600000, Margin: 3.264639869414405223423791063, Commission: 0.10
2025-07-18 04:52:50,783 - INFO - orders - Calculated initial margin: 3.264639869414405223423791063, commission: 0.10 for pending order 1142-001
2025-07-18 04:52:50,807 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '1142-001', 'order_company_name': 'AUDCAD', 'order_type': 'SELL_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89518'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1143-005', 'takeprofit_id': '1144-006', 'order_user_id': 4, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('3.264639869414405223423791063'), 'commission': Decimal('0.10'), 'open_time': None}
2025-07-18 04:52:50,808 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-18 04:52:50,808 - INFO - orders - Placing PENDING order: SELL_LIMIT for user 4 at price 0.89518
2025-07-18 04:52:50,808 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '1142-001', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'SELL_LIMIT', 'order_price': Decimal('0.89518'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('3.264639869414405223423791063'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1143-005', 'takeprofit_id': '1144-006', 'close_id': None}
2025-07-18 04:52:50,852 - INFO - orders - Order 1142-001 verified in database on attempt 1 before adding to Redis.
2025-07-18 04:52:50,855 - INFO - orders - Skipping Redis storage for Barclays user pending order 1142-001
2025-07-18 04:52:50,860 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:52:50,860 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:52:50,860 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:52:50,861 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:52:50,861 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:52:50,879 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:52:50,880 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:52:50,880 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:52:50,880 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:52:50,880 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:52:50,893 - INFO - orders - [PERF] TOTAL place_order: 0.4825s
2025-07-18 04:52:50,910 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:52:50,910 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:52:50,911 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:52:50,911 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:52:50,911 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:52:50,934 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:52:50,934 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:52:50,934 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:52:50,934 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:52:50,934 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:52:50,944 - INFO - orders - Background balance/margin cache updated for user 4: balance=19815.43000000, margin=3249.78
2025-07-18 04:52:51,495 - INFO - orders - [BARCLAYS] barclays_push called for user 4, is_barclays_live_user=True
2025-07-18 04:53:09,590 - INFO - orders - Service provider update request received: {"order_id":"1053-001","order_status":"PENDING","status":"PENDING"}
2025-07-18 04:53:09,602 - ERROR - orders - Order not found with provided identifier '1053-001' in request: {"order_id":"1053-001","order_status":"PENDING","status":"PENDING"}
2025-07-18 04:53:09,602 - ERROR - orders - Error in service provider update endpoint: 404: Order not found with provided ID
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 4135, in service_provider_order_update
    raise HTTPException(status_code=404, detail="Order not found with provided ID")
fastapi.exceptions.HTTPException: 404: Order not found with provided ID
2025-07-18 04:53:13,226 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:15,522 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:17,840 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:23,627 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:23,684 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:24,153 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:53:24,153 - INFO - orders - Using order model: UserOrder
2025-07-18 04:53:24,155 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:53:24,158 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:53:24,160 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:53:24,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:53:24,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:53:24,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:53:24,164 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:53:24,164 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:53:24,164 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:53:24,164 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:53:24,164 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:53:24,164 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:53:24,168 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:53:24,981 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:53:24,981 - INFO - orders - Using order model: UserOrder
2025-07-18 04:53:24,985 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:53:24,989 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:53:24,991 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:53:24,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:53:24,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:53:24,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:53:24,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:53:24,996 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:53:24,999 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:53:31,611 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:36,040 - INFO - orders - Service provider update request received: {"order_id":"1142-001","order_status":"PENDING","status":"PENDING"}
2025-07-18 04:53:36,053 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-18 04:53:36,053 - INFO - orders - Update fields: {'order_id': '1142-001', 'order_status': 'PENDING', 'status': 'PENDING'}
2025-07-18 04:53:36,054 - INFO - orders - Processing regular update for order 1142-001
2025-07-18 04:53:36,078 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 4767, in service_provider_order_update
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-18 04:53:36,080 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-18 04:53:36,080 - INFO - orders - Using order model: UserOrder
2025-07-18 04:53:36,085 - INFO - orders - Fetched 1 open orders for user 4
2025-07-18 04:53:36,088 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-18 04:53:36,090 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 1 pending orders
2025-07-18 04:53:36,094 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 04:53:36,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 04:53:36,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 04:53:36,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 04:53:36,095 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 04:53:36,100 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=19815.43000000, margin=3249.78
2025-07-18 04:53:38,655 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:41,019 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:43,246 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:53:45,546 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 04:54:01,999 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 04:54:01,999 - INFO - orders - Using order model: UserOrder
2025-07-18 04:54:02,003 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 04:54:02,005 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 04:54:02,006 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 04:54:02,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 04:54:02,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 04:54:02,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 04:54:02,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 04:54:02,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 04:54:02,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 04:54:02,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 04:54:02,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 04:54:02,009 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 04:54:02,011 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 04:54:02,895 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 04:54:02,895 - INFO - orders - Using order model: UserOrder
2025-07-18 04:54:02,896 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 04:54:02,898 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 04:54:02,898 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 04:54:02,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 04:54:02,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 04:54:02,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 04:54:02,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 04:54:02,901 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 04:54:02,903 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 04:54:08,513 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:07:18,751 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-18 05:07:19,945 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-18 05:07:19,945 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-18 05:07:19,945 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-18 05:07:19,946 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-18 05:07:19,979 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-18 05:07:19,979 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-18 05:07:20,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 05:07:20,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 05:07:20,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 05:07:20,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 05:07:20,691 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 05:07:20,722 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-18 05:07:20,722 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.35000000, TotalSellQty=0, NetQty=0.35000000, IsHedged=False
2025-07-18 05:07:20,722 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23633.37142857142857142857143')], HighestMarginPerLot=23633.37142857142857142857143
2025-07-18 05:07:20,722 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=8271.68
2025-07-18 05:07:20,722 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 8271.68
2025-07-18 05:07:20,769 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 05:07:20,769 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 05:07:20,769 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 05:07:20,769 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 05:07:20,769 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 05:07:20,769 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 05:07:20,769 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 05:07:20,769 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 05:07:20,769 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 05:07:20,840 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 05:07:20,840 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 05:07:20,840 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 05:07:20,840 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 05:07:20,840 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 05:07:20,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-18 05:07:20,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-18 05:07:20,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-18 05:07:20,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-18 05:07:20,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-18 05:07:20,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-18 05:07:20,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-18 05:07:20,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-18 05:07:20,864 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-18 05:07:25,091 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-18 05:07:25,545 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-18 05:07:25,545 - INFO - orders - Using order model: UserOrder
2025-07-18 05:07:25,554 - INFO - orders - Fetched 1 open orders for user 4
2025-07-18 05:07:25,557 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-18 05:07:25,561 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-18 05:07:25,571 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 05:07:25,572 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 05:07:25,572 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 05:07:25,572 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 05:07:25,572 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 05:07:25,581 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=19815.43000000, margin=3249.78
2025-07-18 05:07:25,591 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 05:07:25,591 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 05:07:25,591 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 05:07:25,591 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 05:07:25,591 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 05:07:26,510 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 05:07:26,511 - INFO - orders - Using order model: UserOrder
2025-07-18 05:07:26,515 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 05:07:26,519 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 05:07:26,522 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 05:07:26,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 05:07:26,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 05:07:26,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 05:07:26,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 05:07:26,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 05:07:26,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 05:07:26,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 05:07:26,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 05:07:26,529 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 05:07:26,532 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 05:07:26,532 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 05:07:26,532 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 05:07:26,532 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 05:07:26,532 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 05:07:26,537 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 05:07:27,310 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 05:07:27,310 - INFO - orders - Using order model: UserOrder
2025-07-18 05:07:27,311 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 05:07:27,313 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 05:07:27,314 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 05:07:27,318 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 05:07:27,318 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 05:07:27,318 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 05:07:27,318 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 05:07:27,318 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 05:07:27,321 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 05:07:29,945 - INFO - orders - Starting the users with orders cache updater task.
2025-07-18 05:07:31,661 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:07:40,852 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:07:45,429 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:07:47,707 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:07:49,970 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:10:25,766 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-18 05:10:26,715 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-18 05:10:26,715 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-18 05:10:26,715 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-18 05:10:26,715 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-18 05:10:26,753 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-18 05:10:26,753 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-18 05:10:31,836 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-18 05:10:32,489 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-18 05:10:32,489 - INFO - orders - Using order model: UserOrder
2025-07-18 05:10:32,491 - INFO - orders - Fetched 3 open orders for user 14
2025-07-18 05:10:32,493 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-18 05:10:32,494 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-18 05:10:32,497 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-18 05:10:32,497 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-18 05:10:32,497 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-18 05:10:32,497 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-18 05:10:32,497 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-18 05:10:32,497 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-18 05:10:32,497 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-18 05:10:32,497 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-18 05:10:32,497 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-18 05:10:32,500 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-18 05:10:32,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-18 05:10:32,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-18 05:10:32,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('324.977540855')], HighestMarginPerLot=324.977540855
2025-07-18 05:10:32,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3249.78
2025-07-18 05:10:32,530 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 3249.78
2025-07-18 05:10:33,031 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-18 05:10:33,031 - INFO - orders - Using order model: UserOrder
2025-07-18 05:10:33,034 - INFO - orders - Fetched 1 open orders for user 25
2025-07-18 05:10:33,035 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-18 05:10:33,036 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-18 05:10:33,039 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-18 05:10:33,040 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-18 05:10:33,040 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-18 05:10:33,040 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-18 05:10:33,040 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-18 05:10:33,042 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-18 05:10:35,848 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-18 05:10:36,705 - INFO - orders - Starting the users with orders cache updater task.
2025-07-18 05:10:40,212 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:10:42,509 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:10:44,815 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
2025-07-18 05:11:03,463 - INFO - orders - [SLTP_CHECK] Skipping SL/TP execution for Barclays live user 25 order 1031-001 (handled by service provider)
