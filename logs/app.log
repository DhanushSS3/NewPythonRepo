2025-07-16 03:34:33,592 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:34:33,653 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:34:33,676 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:34:33,676 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:34:34,530 - INFO - app - Application starting up - Trading system initialized
2025-07-16 03:34:34,531 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-16 03:34:34,531 - INFO - app - Environment: DEVELOPMENT
2025-07-16 03:34:34,647 - INFO - app - Application startup initiated
2025-07-16 03:34:34,647 - INFO - app - Initializing core services...
2025-07-16 03:34:34,757 - INFO - app - Firebase initialized
2025-07-16 03:34:34,757 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-16 03:34:36,808 - INFO - app - Redis initialized
2025-07-16 03:34:36,843 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-16 03:34:36,844 - INFO - app - [AUTO-CUTOFF] Scheduled update_all_users_dynamic_portfolio job to run every 1 minute.
2025-07-16 03:34:36,846 - INFO - app - Scheduler initialized
2025-07-16 03:34:36,850 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-16 03:34:36,851 - DEBUG - app.firebase_stream - Successfully got running event loop in process_firebase_events task.
2025-07-16 03:34:36,851 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-16 03:34:38,001 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-16 03:34:38,020 - DEBUG - app.firebase_stream - Firebase listener triggered (1). Event Type: put, Path: /. Timestamp: 1752662078.0202258
2025-07-16 03:34:38,022 - DEBUG - app.firebase_stream - Prepared batch update for 48 symbols from root path for queue. Preview: {'AUDCAD': {'b': '0.8950000000', 'o': '0.8949700000'}, 'AUDCHF': {'b': '0.5228700000', 'o': '0.5228200000'}, 'AUDJPY': {'b': '96.9740000000', 'o': '96.9690000000'}, 'AUDNZD': {'b': '1.0000000000', 'o'
2025-07-16 03:34:38,023 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'AUDCAD': {'b': '0.8950000000', 'o': '0.8949700000'}, 'AUDCHF': {'b': '0.5228700000', 'o': '0.5228200000'}, 'AUDJPY': {'b': '96.9740000000', 'o': '96.9690000000'}, 'AUDNZD': {'b': '1.0000000000', 'o'...
2025-07-16 03:34:38,023 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type put at path /.
2025-07-16 03:34:38,024 - INFO - app - Starting stale cache cleanup task
2025-07-16 03:34:38,520 - DEBUG - app.firebase_stream - Firebase listener triggered (2). Event Type: patch, Path: /. Timestamp: 1752662078.520663
2025-07-16 03:34:38,521 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0610000000', 'o': '13.0584000000'}, 'GBPAUD': {'b': '2.0539100000', 'o': '2.0537400000'}, 'BTCUSD': {'b': '118986.5300000000', 'o': '118986.5300000000'}, 'USDJPY': {'b': '148.6740
2025-07-16 03:34:38,521 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0610000000', 'o': '13.0584000000'}, 'GBPAUD': {'b': '2.0539100000', 'o': '2.0537400000'}, 'BTCUSD': {'b': '118986.5300000000', 'o': '118986.5300000000'}, 'USDJPY': {'b': '148.6740...
2025-07-16 03:34:38,521 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:40,981 - DEBUG - app.firebase_stream - Firebase listener triggered (3). Event Type: patch, Path: /. Timestamp: 1752662080.981499
2025-07-16 03:34:40,982 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0670000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3380000000'}, 'GBPAUD': {'b': '2.0539100000', 'o': '2.0537300000'}, 'BTCUSD': {'b': '118976.000000000
2025-07-16 03:34:40,982 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0670000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3380000000'}, 'GBPAUD': {'b': '2.0539100000', 'o': '2.0537300000'}, 'BTCUSD': {'b': '118976.000000000...
2025-07-16 03:34:40,982 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:42,150 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-16 03:34:42,150 - INFO - app - Background tasks initialized
2025-07-16 03:34:42,809 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-16 03:34:42,809 - INFO - app - Application startup completed successfully
2025-07-16 03:34:42,810 - INFO - app - Starting cache validation task
2025-07-16 03:34:42,815 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-16 03:34:42,815 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:42,820 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-16 03:34:42,894 - INFO - app - Validating cache for 30 users
2025-07-16 03:34:42,897 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:43,263 - DEBUG - app.firebase_stream - Firebase listener triggered (4). Event Type: patch, Path: /. Timestamp: 1752662083.2630248
2025-07-16 03:34:43,263 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0607000000', 'o': '13.0581000000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3440000000', 'o': '88.3360000000'}, 'GBPAUD': {'b': '2.0539100000',
2025-07-16 03:34:43,264 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 3. Data preview: {'GBPSEK': {'b': '13.0607000000', 'o': '13.0581000000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3440000000', 'o': '88.3360000000'}, 'GBPAUD': {'b': '2.0539100000',...
2025-07-16 03:34:43,264 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:43,913 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:43,917 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:44,850 - INFO - app - Found 24 static orders cache entries to check
2025-07-16 03:34:44,924 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:44,929 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:45,586 - DEBUG - app.firebase_stream - Firebase listener triggered (5). Event Type: patch, Path: /. Timestamp: 1752662085.5867994
2025-07-16 03:34:45,587 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0608000000', 'o': '13.0582000000'}, 'GBPAUD': {'b': '2.0539600000', 'o': '2.0537800000'}, 'BTCUSD': {'b': '118962.4000000000', 'o': '118962.3000000000'}, 'USDJPY': {'b': '148.6690
2025-07-16 03:34:45,587 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 2. Data preview: {'GBPSEK': {'b': '13.0608000000', 'o': '13.0582000000'}, 'GBPAUD': {'b': '2.0539600000', 'o': '2.0537800000'}, 'BTCUSD': {'b': '118962.4000000000', 'o': '118962.3000000000'}, 'USDJPY': {'b': '148.6690...
2025-07-16 03:34:45,587 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:45,938 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:45,943 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:46,876 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-16 03:34:46,950 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:46,955 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:47,905 - DEBUG - app.firebase_stream - Firebase listener triggered (6). Event Type: patch, Path: /. Timestamp: 1752662087.9051073
2025-07-16 03:34:47,905 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0609000000', 'o': '13.0583000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3370000000'}, 'GBPAUD': {'b': '2.0539600000', 'o': '2.0538000000'}, 'BTCUSD': {'b': '118976.000000000
2025-07-16 03:34:47,906 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 3. Data preview: {'GBPSEK': {'b': '13.0609000000', 'o': '13.0583000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3370000000'}, 'GBPAUD': {'b': '2.0539600000', 'o': '2.0538000000'}, 'BTCUSD': {'b': '118976.000000000...
2025-07-16 03:34:47,906 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:47,958 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:47,962 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:48,908 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-16 03:34:48,971 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:48,984 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:49,989 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:49,995 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:50,200 - DEBUG - app.firebase_stream - Firebase listener triggered (7). Event Type: patch, Path: /. Timestamp: 1752662090.2007089
2025-07-16 03:34:50,202 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0720000000', 'o': '38.0670000000'}, 'BTCUSD': {'b': '118951.7000000000', 'o': '118951.6000000000'}, 'USDJPY': {'b': '148.6680000000', 'o': '148.6630000000'}, 'AUDJPY': {'b': '96.9
2025-07-16 03:34:50,202 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 2. Data preview: {'XAGUSD': {'b': '38.0720000000', 'o': '38.0670000000'}, 'BTCUSD': {'b': '118951.7000000000', 'o': '118951.6000000000'}, 'USDJPY': {'b': '148.6680000000', 'o': '148.6630000000'}, 'AUDJPY': {'b': '96.9...
2025-07-16 03:34:50,203 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:50,948 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-16 03:34:50,986 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-16 03:34:50,998 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:51,002 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:52,010 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:52,016 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:52,444 - DEBUG - app.firebase_stream - Firebase listener triggered (8). Event Type: patch, Path: /. Timestamp: 1752662092.4446418
2025-07-16 03:34:52,445 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0615000000', 'o': '13.0590400000'}, 'XAGUSD': {'b': '38.0730000000', 'o': '38.0680000000'}, 'NZDJPY': {'b': '88.3450000000', 'o': '88.3360000000'}, 'GBPAUD': {'b': '2.0539300000',
2025-07-16 03:34:52,445 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0615000000', 'o': '13.0590400000'}, 'XAGUSD': {'b': '38.0730000000', 'o': '38.0680000000'}, 'NZDJPY': {'b': '88.3450000000', 'o': '88.3360000000'}, 'GBPAUD': {'b': '2.0539300000',...
2025-07-16 03:34:52,445 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:53,027 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:53,033 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:53,036 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-16 03:34:53,051 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-16 03:34:53,057 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-16 03:34:53,064 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-16 03:34:53,070 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-16 03:34:53,070 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-16 03:34:53,091 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-16 03:34:53,099 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-16 03:34:53,114 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-16 03:34:53,120 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-16 03:34:53,141 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-16 03:34:53,146 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-16 03:34:53,147 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-16 03:34:53,179 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-16 03:34:53,182 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-16 03:34:53,190 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-16 03:34:53,191 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-16 03:34:53,196 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-16 03:34:53,196 - INFO - app - Completed stale cache cleanup task
2025-07-16 03:34:54,047 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:54,051 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:54,805 - DEBUG - app.firebase_stream - Firebase listener triggered (9). Event Type: patch, Path: /. Timestamp: 1752662094.8056417
2025-07-16 03:34:54,806 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3440000000', 'o': '88.3350000000'}, 'GBPAUD': {'b': '2.0539300000', 'o': '2.0537800000'}, 'BTCUSD': {'b': '118956.3300000000', 'o': '118956.3300000000'}, 'USDJPY': {'b': '148.6660
2025-07-16 03:34:54,806 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3440000000', 'o': '88.3350000000'}, 'GBPAUD': {'b': '2.0539300000', 'o': '2.0537800000'}, 'BTCUSD': {'b': '118956.3300000000', 'o': '118956.3300000000'}, 'USDJPY': {'b': '148.6660...
2025-07-16 03:34:54,807 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:55,064 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:55,068 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:55,280 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-16 03:34:55,311 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-16 03:34:56,084 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:56,089 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:57,057 - DEBUG - app.firebase_stream - Firebase listener triggered (10). Event Type: patch, Path: /. Timestamp: 1752662097.0572083
2025-07-16 03:34:57,057 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0613000000', 'o': '13.0590400000'}, 'GBPAUD': {'b': '2.0539300000', 'o': '2.0538400000'}, 'BTCUSD': {'b': '118965.2000000000', 'o': '118965.1000000000'}, 'USDJPY': {'b': '148.6680
2025-07-16 03:34:57,058 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0613000000', 'o': '13.0590400000'}, 'GBPAUD': {'b': '2.0539300000', 'o': '2.0538400000'}, 'BTCUSD': {'b': '118965.2000000000', 'o': '118965.1000000000'}, 'USDJPY': {'b': '148.6680...
2025-07-16 03:34:57,058 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:57,108 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:57,112 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:57,440 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-16 03:34:57,481 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-16 03:34:57,819 - INFO - app - Starting stale cache cleanup task
2025-07-16 03:34:58,116 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:58,121 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:59,131 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:34:59,135 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:34:59,407 - DEBUG - app.firebase_stream - Firebase listener triggered (11). Event Type: patch, Path: /. Timestamp: 1752662099.4070508
2025-07-16 03:34:59,407 - DEBUG - app.firebase_stream - Prepared batch update for 20 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0539300000', 'o': '2.0538100000'}, 'BTCUSD': {'b': '118968.2000000000', 'o': '118968.1000000000'}, 'USDJPY': {'b': '148.6670000000', 'o': '148.6630000000'}, 'USDCNH': {'b': '7.1828
2025-07-16 03:34:59,407 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPAUD': {'b': '2.0539300000', 'o': '2.0538100000'}, 'BTCUSD': {'b': '118968.2000000000', 'o': '118968.1000000000'}, 'USDJPY': {'b': '148.6670000000', 'o': '148.6630000000'}, 'USDCNH': {'b': '7.1828...
2025-07-16 03:34:59,407 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:34:59,538 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-16 03:34:59,544 - INFO - app - Found 24 static orders cache entries to check
2025-07-16 03:34:59,581 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-16 03:34:59,593 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-16 03:34:59,611 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-16 03:34:59,616 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-16 03:34:59,617 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-16 03:34:59,621 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-16 03:34:59,624 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-16 03:34:59,627 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-16 03:34:59,634 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-16 03:34:59,638 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-16 03:34:59,640 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-16 03:34:59,643 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-16 03:34:59,647 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-16 03:35:00,142 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:00,146 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:01,156 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:01,160 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:01,638 - DEBUG - app.firebase_stream - Firebase listener triggered (12). Event Type: patch, Path: /. Timestamp: 1752662101.638268
2025-07-16 03:35:01,638 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0617000000', 'o': '13.0591000000'}, 'XAGUSD': {'b': '38.0720000000', 'o': '38.0680000000'}, 'GBPAUD': {'b': '2.0539300000', 'o': '2.0537900000'}, 'USDJPY': {'b': '148.6660000000',
2025-07-16 03:35:01,638 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0617000000', 'o': '13.0591000000'}, 'XAGUSD': {'b': '38.0720000000', 'o': '38.0680000000'}, 'GBPAUD': {'b': '2.0539300000', 'o': '2.0537900000'}, 'USDJPY': {'b': '148.6660000000',...
2025-07-16 03:35:01,638 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:01,678 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-16 03:35:01,702 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-16 03:35:01,744 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-16 03:35:01,755 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-16 03:35:01,758 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-16 03:35:01,768 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-16 03:35:01,778 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-16 03:35:01,778 - INFO - app - Completed stale cache cleanup task
2025-07-16 03:35:01,793 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-16 03:35:01,824 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-16 03:35:01,844 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-16 03:35:01,870 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-16 03:35:01,894 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-16 03:35:01,986 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-16 03:35:02,025 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-16 03:35:02,064 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-16 03:35:02,096 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-16 03:35:02,132 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-16 03:35:02,160 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-16 03:35:02,170 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:02,181 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:02,212 - INFO - app - Cache validation completed
2025-07-16 03:35:03,197 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:03,200 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:03,914 - DEBUG - app.firebase_stream - Firebase listener triggered (13). Event Type: patch, Path: /. Timestamp: 1752662103.9149044
2025-07-16 03:35:03,915 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0650000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3440000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0539900000', 'o': '2.0538400000'}, 'USDJPY': {'b': '148.6700000000',
2025-07-16 03:35:03,915 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0650000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3440000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0539900000', 'o': '2.0538400000'}, 'USDJPY': {'b': '148.6700000000',...
2025-07-16 03:35:03,915 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:04,204 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:04,208 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:04,348 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:35:04,374 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:35:04,400 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:35:04,418 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:35:04,429 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:35:04,437 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:35:04,490 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:35:04,797 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:35:04,826 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:35:04,827 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:35:04,830 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:35:04,839 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:35:04,847 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:35:04,849 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:35:04,851 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:35:04,860 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:35:04,860 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:35:04,866 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:35:04,866 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:35:04,869 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:35:04,869 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:35:04,877 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:35:04,877 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:35:04,878 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:35:04,879 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:35:04,879 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:35:04,908 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:35:04,908 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:35:05,210 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:05,216 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:06,219 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:06,224 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:06,276 - DEBUG - app.firebase_stream - Firebase listener triggered (14). Event Type: patch, Path: /. Timestamp: 1752662106.276301
2025-07-16 03:35:06,277 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0619000000', 'o': '13.0593700000'}, 'XAGUSD': {'b': '38.0640000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3480000000', 'o': '88.3400000000'}, 'GBPAUD': {'b': '2.0540000000',
2025-07-16 03:35:06,278 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0619000000', 'o': '13.0593700000'}, 'XAGUSD': {'b': '38.0640000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3480000000', 'o': '88.3400000000'}, 'GBPAUD': {'b': '2.0540000000',...
2025-07-16 03:35:06,278 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:07,232 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:07,236 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:08,242 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:08,246 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:08,536 - DEBUG - app.firebase_stream - Firebase listener triggered (15). Event Type: patch, Path: /. Timestamp: 1752662108.536336
2025-07-16 03:35:08,557 - DEBUG - app.firebase_stream - Prepared batch update for 35 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0631000000', 'o': '13.0605000000'}, 'XAGUSD': {'b': '38.0670000000', 'o': '38.0600000000'}, 'NZDJPY': {'b': '88.3490000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0541000000',
2025-07-16 03:35:08,557 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0631000000', 'o': '13.0605000000'}, 'XAGUSD': {'b': '38.0670000000', 'o': '38.0600000000'}, 'NZDJPY': {'b': '88.3490000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0541000000',...
2025-07-16 03:35:08,557 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:09,248 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:09,252 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:10,265 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:10,269 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:10,896 - DEBUG - app.firebase_stream - Firebase listener triggered (16). Event Type: patch, Path: /. Timestamp: 1752662110.8960001
2025-07-16 03:35:10,896 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0640000000', 'o': '38.0590000000'}, 'NZDJPY': {'b': '88.3470000000', 'o': '88.3390000000'}, 'GBPAUD': {'b': '2.0541200000', 'o': '2.0539400000'}, 'BTCUSD': {'b': '118965.400000000
2025-07-16 03:35:10,897 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0640000000', 'o': '38.0590000000'}, 'NZDJPY': {'b': '88.3470000000', 'o': '88.3390000000'}, 'GBPAUD': {'b': '2.0541200000', 'o': '2.0539400000'}, 'BTCUSD': {'b': '118965.400000000...
2025-07-16 03:35:10,898 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:11,274 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:11,295 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:12,306 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:12,310 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:13,134 - DEBUG - app.firebase_stream - Firebase listener triggered (17). Event Type: patch, Path: /. Timestamp: 1752662113.1340225
2025-07-16 03:35:13,134 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0660000000', 'o': '38.0590000000'}, 'GBPAUD': {'b': '2.0540000000', 'o': '2.0539300000'}, 'BTCUSD': {'b': '118968.2000000000', 'o': '118968.1000000000'}, 'USDJPY': {'b': '148.6710
2025-07-16 03:35:13,134 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0660000000', 'o': '38.0590000000'}, 'GBPAUD': {'b': '2.0540000000', 'o': '2.0539300000'}, 'BTCUSD': {'b': '118968.2000000000', 'o': '118968.1000000000'}, 'USDJPY': {'b': '148.6710...
2025-07-16 03:35:13,135 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:13,312 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:13,315 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:14,325 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:14,329 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:15,336 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:15,340 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:15,494 - DEBUG - app.firebase_stream - Firebase listener triggered (18). Event Type: patch, Path: /. Timestamp: 1752662115.4948723
2025-07-16 03:35:15,495 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0580000000'}, 'GBPAUD': {'b': '2.0541200000', 'o': '2.0539400000'}, 'BTCUSD': {'b': '118971.4000000000', 'o': '118971.3000000000'}, 'EURZAR': {'b': '20.81312
2025-07-16 03:35:15,496 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0580000000'}, 'GBPAUD': {'b': '2.0541200000', 'o': '2.0539400000'}, 'BTCUSD': {'b': '118971.4000000000', 'o': '118971.3000000000'}, 'EURZAR': {'b': '20.81312...
2025-07-16 03:35:15,496 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:16,356 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:16,360 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:17,362 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:17,366 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:17,734 - DEBUG - app.firebase_stream - Firebase listener triggered (19). Event Type: patch, Path: /. Timestamp: 1752662117.7347853
2025-07-16 03:35:17,735 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0570000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3380000000'}, 'USDJPY': {'b': '148.6730000000', 'o': '148.6670000000'}, 'EURNZD': {'b': '1.9550900000
2025-07-16 03:35:17,735 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0570000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3380000000'}, 'USDJPY': {'b': '148.6730000000', 'o': '148.6670000000'}, 'EURNZD': {'b': '1.9550900000...
2025-07-16 03:35:17,735 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:18,371 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:18,376 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:19,382 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:19,384 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:20,093 - DEBUG - app.firebase_stream - Firebase listener triggered (20). Event Type: patch, Path: /. Timestamp: 1752662120.0936284
2025-07-16 03:35:20,094 - DEBUG - app.firebase_stream - Prepared batch update for 18 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0610000000', 'o': '38.0540000000'}, 'GBPAUD': {'b': '2.0541100000', 'o': '2.0539600000'}, 'BTCUSD': {'b': '118972.3900000000', 'o': '118972.3900000000'}, 'USDJPY': {'b': '148.6720
2025-07-16 03:35:20,094 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0610000000', 'o': '38.0540000000'}, 'GBPAUD': {'b': '2.0541100000', 'o': '2.0539600000'}, 'BTCUSD': {'b': '118972.3900000000', 'o': '118972.3900000000'}, 'USDJPY': {'b': '148.6720...
2025-07-16 03:35:20,094 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:20,391 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:20,394 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:21,407 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:21,411 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:22,318 - DEBUG - app.firebase_stream - Firebase listener triggered (21). Event Type: patch, Path: /. Timestamp: 1752662122.3185284
2025-07-16 03:35:22,319 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0620000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0541200000', 'o': '2.0539300000'}, 'BTCUSD': {'b': '118971.400000000
2025-07-16 03:35:22,319 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0620000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0541200000', 'o': '2.0539300000'}, 'BTCUSD': {'b': '118971.400000000...
2025-07-16 03:35:22,320 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:22,415 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:22,419 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:23,426 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:23,433 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:24,448 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:24,451 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:24,706 - DEBUG - app.firebase_stream - Firebase listener triggered (22). Event Type: patch, Path: /. Timestamp: 1752662124.7067556
2025-07-16 03:35:24,707 - DEBUG - app.firebase_stream - Prepared batch update for 34 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0570000000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3450000000'}, 'GBPAUD': {'b': '2.0541300000', 'o': '2.0539900000'}, 'USDJPY': {'b': '148.6710000000',
2025-07-16 03:35:24,708 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0570000000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3450000000'}, 'GBPAUD': {'b': '2.0541300000', 'o': '2.0539900000'}, 'USDJPY': {'b': '148.6710000000',...
2025-07-16 03:35:24,708 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:25,454 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:25,457 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:26,467 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:26,471 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:26,930 - DEBUG - app.firebase_stream - Firebase listener triggered (23). Event Type: patch, Path: /. Timestamp: 1752662126.9303453
2025-07-16 03:35:26,930 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0629000000', 'o': '13.0603000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0541200000',
2025-07-16 03:35:26,931 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0629000000', 'o': '13.0603000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0541200000',...
2025-07-16 03:35:26,931 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:27,478 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:27,481 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:28,492 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:28,496 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:29,200 - DEBUG - app.firebase_stream - Firebase listener triggered (24). Event Type: patch, Path: /. Timestamp: 1752662129.2004151
2025-07-16 03:35:29,201 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0620000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3450000000'}, 'GBPAUD': {'b': '2.0541400000', 'o': '2.0540600000'}, 'USDJPY': {'b': '148.6720000000',
2025-07-16 03:35:29,201 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0620000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3460000000', 'o': '88.3450000000'}, 'GBPAUD': {'b': '2.0541400000', 'o': '2.0540600000'}, 'USDJPY': {'b': '148.6720000000',...
2025-07-16 03:35:29,201 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:29,506 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:29,510 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:30,515 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:30,519 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:31,527 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:31,534 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:31,574 - DEBUG - app.firebase_stream - Firebase listener triggered (25). Event Type: patch, Path: /. Timestamp: 1752662131.5739484
2025-07-16 03:35:31,574 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0615000000'}, 'XAGUSD': {'b': '38.0570000000', 'o': '38.0510000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0542200000',
2025-07-16 03:35:31,575 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0615000000'}, 'XAGUSD': {'b': '38.0570000000', 'o': '38.0510000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0542200000',...
2025-07-16 03:35:31,576 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:32,541 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:32,546 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:33,563 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:33,567 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:33,820 - DEBUG - app.firebase_stream - Firebase listener triggered (26). Event Type: patch, Path: /. Timestamp: 1752662133.8202696
2025-07-16 03:35:33,820 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614000000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'GBPAUD': {'b': '2.0541200000', 'o': '2.0539600000'}, 'EURNZD': {'b': '1.9550800000', '
2025-07-16 03:35:33,821 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614000000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'GBPAUD': {'b': '2.0541200000', 'o': '2.0539600000'}, 'EURNZD': {'b': '1.9550800000', '...
2025-07-16 03:35:33,821 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:34,576 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:34,581 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:35,583 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:35,589 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:36,142 - DEBUG - app.firebase_stream - Firebase listener triggered (27). Event Type: patch, Path: /. Timestamp: 1752662136.142688
2025-07-16 03:35:36,143 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0580000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0542900000', 'o': '2.0541600000'}, 'USDJPY': {'b': '148.6730000000',
2025-07-16 03:35:36,145 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0580000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0542900000', 'o': '2.0541600000'}, 'USDJPY': {'b': '148.6730000000',...
2025-07-16 03:35:36,146 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:36,599 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:36,604 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:36,851 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-16 03:35:36,852 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-16 03:35:36,893 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-16 03:35:36,894 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-16 03:35:36,894 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-16 03:35:36,894 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (live) from cache/DB...
2025-07-16 03:35:36,895 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:36,922 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:35:36,925 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:35:36,925 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:35:36,929 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:35:36,929 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:36,929 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-16 03:35:36,929 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (live) from cache/DB...
2025-07-16 03:35:36,935 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-16 03:35:36,935 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-16 03:35:36,935 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 8 (live) from cache/DB...
2025-07-16 03:35:36,936 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:35:36,944 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 8.
2025-07-16 03:35:36,944 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-16 03:35:36,944 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (live) from cache/DB...
2025-07-16 03:35:36,945 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:35:36,966 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:35:36,971 - DEBUG - app - [AUTO-CUTOFF] User 9 has 1 open orders.
2025-07-16 03:35:36,971 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:35:36,974 - DEBUG - app - [AUTO-CUTOFF] User 9 has 0 pending orders.
2025-07-16 03:35:36,974 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 1
2025-07-16 03:35:37,049 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.52299'), 'sell': Decimal('0.52274')}, 'GBPNOK': {'buy': Decimal('13.797799999999999'), 'sell': Decimal('13.795200000000001')}, 'AUDJPY': {'buy': Decimal('96.993'), 'sell': Decimal('96.957')}, 'EURJPY': {'buy': Decimal('172.73299999999998'), 'sell': Decimal('172.70000000000002')}, 'XAGUSD': {'buy': Decimal('38.073'), 'sell': Decimal('38.038')}, 'EURCAD': {'buy': Decimal('1.594175'), 'sell': Decimal('1.593915')}, 'GBPUSD': {'buy': Decimal('1.3400450000000002'), 'sell': Decimal('1.339885')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.749369999999999'), 'sell': Decimal('9.74821')}, 'JP225': {'buy': Decimal('39561.79'), 'sell': Decimal('39557.79')}, 'GBPSEK': {'buy': Decimal('13.0642'), 'sell': Decimal('13.061200000000001')}, 'EURUSD': {'buy': Decimal('1.161885'), 'sell': Decimal('1.161665')}, 'AUDCAD': {'buy': Decimal('0.8951'), 'sell': Decimal('0.89488')}, 'D30': {'buy': Decimal('24129.12'), 'sell': Decimal('24128.12')}, 'CHFSGD': {'buy': Decimal('1.603005'), 'sell': Decimal('1.602545')}, 'USDJPY': {'buy': Decimal('148.683'), 'sell': Decimal('148.65900000000002')}, 'EURNOK': {'buy': Decimal('11.962585'), 'sell': Decimal('11.960635')}, 'AUDUSD': {'buy': Decimal('0.652425'), 'sell': Decimal('0.652165')}, 'EURCHF': {'buy': Decimal('0.93141'), 'sell': Decimal('0.93106')}, 'GBPAUD': {'buy': Decimal('2.054415'), 'sell': Decimal('2.054035')}, 'EURGBP': {'buy': Decimal('0.86717'), 'sell': Decimal('0.86685')}, 'EURNZD': {'buy': Decimal('1.9552450000000001'), 'sell': Decimal('1.954715')}, 'EURSEK': {'buy': Decimal('11.326595000000001'), 'sell': Decimal('11.324494999999999')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58438'), 'sell': Decimal('0.58405')}, 'USDCHF': {'buy': Decimal('0.8017000000000001'), 'sell': Decimal('0.80146')}, 'USDCNH': {'buy': Decimal('7.183115'), 'sell': Decimal('7.182685')}, 'NZDUSD': {'buy': Decimal('0.59437'), 'sell': Decimal('0.59415')}, 'NZDJPY': {'buy': Decimal('88.366'), 'sell': Decimal('88.328')}, 'EURSGD': {'buy': Decimal('1.4927700000000002'), 'sell': Decimal('1.4923799999999998')}, 'CADJPY': {'buy': Decimal('108.371'), 'sell': Decimal('108.336')}, 'USDCZK': {'buy': Decimal('21.2425'), 'sell': Decimal('21.177500000000002')}, 'US30': {'buy': Decimal('44043.5'), 'sell': Decimal('44041.4')}, 'GBPNZD': {'buy': Decimal('2.255045'), 'sell': Decimal('2.254585')}, 'CHFJPY': {'buy': Decimal('185.49499999999998'), 'sell': Decimal('185.455')}, 'BTCUSD': {'buy': Decimal('119021.4'), 'sell': Decimal('118921.3')}, 'USDSGD': {'buy': Decimal('1.2848849999999998'), 'sell': Decimal('1.284585')}, 'NOKSEK': {'buy': Decimal('0.947165'), 'sell': Decimal('0.9465049999999999')}, 'EURPLN': {'buy': Decimal('4.25655'), 'sell': Decimal('4.25558')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78126'), 'sell': Decimal('1.78087')}, 'SGDJPY': {'buy': Decimal('115.746'), 'sell': Decimal('115.697')}, 'EURZAR': {'buy': Decimal('20.81435'), 'sell': Decimal('20.806459999999998')}, 'USDTRY': {'buy': Decimal('40.260165'), 'sell': Decimal('40.257755')}, 'USDNOK': {'buy': Decimal('10.29689'), 'sell': Decimal('10.29522')}, 'USDZAR': {'buy': Decimal('17.915474999999997'), 'sell': Decimal('17.909955')}, 'NZDCAD': {'buy': Decimal('0.8154899999999999'), 'sell': Decimal('0.81521')}, 'USDCAD': {'buy': Decimal('1.3722400000000001'), 'sell': Decimal('1.3719599999999998')}}
2025-07-16 03:35:37,049 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:35:37,050 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:35:37,387 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141921.60000000, Current=118921.3, Quantity=0.41000000, Contract Size=1.00000000, PnL=-9430.123000000000000000000000, PnL USD=-9430.123000000000000000000000, Commission=244.35000000, Final PnL=-9674.473000000000000000000000
2025-07-16 03:35:37,387 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.226836858656259849466994022% which is below threshold 100.0%
2025-07-16 03:35:37,387 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '9794.75000000', 'equity': '120.277000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9683.553000000000000000000000', 'profit_loss': '-9674.473000000000000000000000', 'margin_level': '1.226836858656259849466994022', 'positions': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9674.473000000000000000000000', 'current_price': '118921.3'}], 'margin_call': True}
2025-07-16 03:35:37,388 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '9794.75000000', 'equity': '120.277000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9683.553000000000000000000000', 'profit_loss': '-9674.473000000000000000000000', 'margin_level': '1.226836858656259849466994022', 'positions_with_pnl': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9674.473000000000000000000000', 'current_price': '118921.3'}], 'margin_call': True}
2025-07-16 03:35:37,389 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 1.226836858656259849466994022
2025-07-16 03:35:37,427 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:35:37,428 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-16 03:35:37,428 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (live) from cache/DB...
2025-07-16 03:35:37,430 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:37,468 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:35:37,472 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:35:37,473 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:35:37,476 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 pending orders.
2025-07-16 03:35:37,476 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:37,476 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-16 03:35:37,476 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (live) from cache/DB...
2025-07-16 03:35:37,477 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:37,490 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:35:37,493 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 open orders.
2025-07-16 03:35:37,493 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:35:37,495 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:35:37,495 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:37,495 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-16 03:35:37,495 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (live) from cache/DB...
2025-07-16 03:35:37,495 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:35:37,507 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:35:37,509 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:35:37,509 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:35:37,512 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:35:37,512 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:37,512 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-16 03:35:37,512 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (live) from cache/DB...
2025-07-16 03:35:37,513 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:37,524 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:35:37,526 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:35:37,526 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:35:37,529 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:35:37,529 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:37,529 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-16 03:35:37,529 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 14 (live) from cache/DB...
2025-07-16 03:35:37,530 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:35:37,540 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 14...
2025-07-16 03:35:37,544 - DEBUG - app - [AUTO-CUTOFF] User 14 has 3 open orders.
2025-07-16 03:35:37,544 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 14...
2025-07-16 03:35:37,548 - DEBUG - app - [AUTO-CUTOFF] User 14 has 0 pending orders.
2025-07-16 03:35:37,548 - DEBUG - app - [AUTO-CUTOFF] User 14 total positions for portfolio calculation: 3
2025-07-16 03:35:37,587 - DEBUG - app - [AUTO-CUTOFF] User 14 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.52299'), 'sell': Decimal('0.52274')}, 'GBPNOK': {'buy': Decimal('13.797799999999999'), 'sell': Decimal('13.795200000000001')}, 'AUDJPY': {'buy': Decimal('96.993'), 'sell': Decimal('96.957')}, 'EURJPY': {'buy': Decimal('172.73299999999998'), 'sell': Decimal('172.70000000000002')}, 'XAGUSD': {'buy': Decimal('38.073'), 'sell': Decimal('38.038')}, 'EURCAD': {'buy': Decimal('1.594175'), 'sell': Decimal('1.593915')}, 'GBPUSD': {'buy': Decimal('1.3400450000000002'), 'sell': Decimal('1.339885')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.749369999999999'), 'sell': Decimal('9.74821')}, 'JP225': {'buy': Decimal('39561.79'), 'sell': Decimal('39557.79')}, 'GBPSEK': {'buy': Decimal('13.0642'), 'sell': Decimal('13.061200000000001')}, 'EURUSD': {'buy': Decimal('1.161885'), 'sell': Decimal('1.161665')}, 'AUDCAD': {'buy': Decimal('0.8951'), 'sell': Decimal('0.89488')}, 'D30': {'buy': Decimal('24129.12'), 'sell': Decimal('24128.12')}, 'CHFSGD': {'buy': Decimal('1.603005'), 'sell': Decimal('1.602545')}, 'USDJPY': {'buy': Decimal('148.683'), 'sell': Decimal('148.65900000000002')}, 'EURNOK': {'buy': Decimal('11.962585'), 'sell': Decimal('11.960635')}, 'AUDUSD': {'buy': Decimal('0.652425'), 'sell': Decimal('0.652165')}, 'EURCHF': {'buy': Decimal('0.93141'), 'sell': Decimal('0.93106')}, 'GBPAUD': {'buy': Decimal('2.054415'), 'sell': Decimal('2.054035')}, 'EURGBP': {'buy': Decimal('0.86717'), 'sell': Decimal('0.86685')}, 'EURNZD': {'buy': Decimal('1.9552450000000001'), 'sell': Decimal('1.954715')}, 'EURSEK': {'buy': Decimal('11.326595000000001'), 'sell': Decimal('11.324494999999999')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58438'), 'sell': Decimal('0.58405')}, 'USDCHF': {'buy': Decimal('0.8017000000000001'), 'sell': Decimal('0.80146')}, 'USDCNH': {'buy': Decimal('7.183115'), 'sell': Decimal('7.182685')}, 'NZDUSD': {'buy': Decimal('0.59437'), 'sell': Decimal('0.59415')}, 'NZDJPY': {'buy': Decimal('88.366'), 'sell': Decimal('88.328')}, 'EURSGD': {'buy': Decimal('1.4927700000000002'), 'sell': Decimal('1.4923799999999998')}, 'CADJPY': {'buy': Decimal('108.371'), 'sell': Decimal('108.336')}, 'USDCZK': {'buy': Decimal('21.2425'), 'sell': Decimal('21.177500000000002')}, 'US30': {'buy': Decimal('44043.5'), 'sell': Decimal('44041.4')}, 'GBPNZD': {'buy': Decimal('2.255045'), 'sell': Decimal('2.254585')}, 'CHFJPY': {'buy': Decimal('185.49499999999998'), 'sell': Decimal('185.455')}, 'BTCUSD': {'buy': Decimal('119021.4'), 'sell': Decimal('118921.3')}, 'USDSGD': {'buy': Decimal('1.2848849999999998'), 'sell': Decimal('1.284585')}, 'NOKSEK': {'buy': Decimal('0.947165'), 'sell': Decimal('0.9465049999999999')}, 'EURPLN': {'buy': Decimal('4.25655'), 'sell': Decimal('4.25558')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78126'), 'sell': Decimal('1.78087')}, 'SGDJPY': {'buy': Decimal('115.746'), 'sell': Decimal('115.697')}, 'EURZAR': {'buy': Decimal('20.81435'), 'sell': Decimal('20.806459999999998')}, 'USDTRY': {'buy': Decimal('40.260165'), 'sell': Decimal('40.257755')}, 'USDNOK': {'buy': Decimal('10.29689'), 'sell': Decimal('10.29522')}, 'USDZAR': {'buy': Decimal('17.915474999999997'), 'sell': Decimal('17.909955')}, 'NZDCAD': {'buy': Decimal('0.8154899999999999'), 'sell': Decimal('0.81521')}, 'USDCAD': {'buy': Decimal('1.3722400000000001'), 'sell': Decimal('1.3719599999999998')}}
2025-07-16 03:35:37,587 - DEBUG - app - [AUTO-CUTOFF] User 14 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:35:37,587 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-16 03:35:37,899 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141908.50000000, Current=118921.3, Quantity=0.40000000, Contract Size=1.00000000, PnL=-9194.880000000000000000000000, PnL USD=-9194.880000000000000000000000, Commission=235.57000000, Final PnL=-9430.450000000000000000000000
2025-07-16 03:35:37,900 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:37,902 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.957, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-1400.000000000000000000000000, PnL USD=-9.416639201468995715429163332, Commission=1.00000000, Final PnL=-10.41663920146899571542916333
2025-07-16 03:35:37,904 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.957, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-140.000000000000000000000000, PnL USD=-0.9416639201468995715429163332, Commission=0.10000000, Final PnL=-1.041663920146899571542916333
2025-07-16 03:35:37,904 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.846101961229895978533061045% which is below threshold 100.0%
2025-07-16 03:35:37,904 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '460.111696878384104713027921', 'margin': '9494.47000000', 'free_margin': '-9034.358303121615895286972079', 'profit_loss': '-9441.908303121615895286972079', 'margin_level': '4.846101961229895978533061045', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9430.450000000000000000000000', 'current_price': '118921.3'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.41663920146899571542916333', 'current_price': '96.957'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.041663920146899571542916333', 'current_price': '96.957'}], 'margin_call': True}
2025-07-16 03:35:37,904 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 14: {'balance': '9902.02000000', 'equity': '460.111696878384104713027921', 'margin': '9494.47000000', 'free_margin': '-9034.358303121615895286972079', 'profit_loss': '-9441.908303121615895286972079', 'margin_level': '4.846101961229895978533061045', 'positions_with_pnl': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9430.450000000000000000000000', 'current_price': '118921.3'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.41663920146899571542916333', 'current_price': '96.957'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.041663920146899571542916333', 'current_price': '96.957'}], 'margin_call': True}
2025-07-16 03:35:37,905 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:37,906 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.846101961229895978533061045
2025-07-16 03:35:37,941 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-16 03:35:37,941 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-16 03:35:37,941 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 16 (live) from cache/DB...
2025-07-16 03:35:37,942 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:35:37,976 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 16...
2025-07-16 03:35:37,980 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 open orders.
2025-07-16 03:35:37,981 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 16...
2025-07-16 03:35:37,984 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 pending orders.
2025-07-16 03:35:37,984 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:37,984 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-16 03:35:37,984 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 17 (live) from cache/DB...
2025-07-16 03:35:37,986 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:38,009 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 17...
2025-07-16 03:35:38,013 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 open orders.
2025-07-16 03:35:38,013 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 17...
2025-07-16 03:35:38,016 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 pending orders.
2025-07-16 03:35:38,016 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:38,017 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-16 03:35:38,017 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 18 (live) from cache/DB...
2025-07-16 03:35:38,018 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:38,043 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 18...
2025-07-16 03:35:38,046 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 open orders.
2025-07-16 03:35:38,046 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 18...
2025-07-16 03:35:38,050 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 pending orders.
2025-07-16 03:35:38,050 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:38,050 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-16 03:35:38,050 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 19 (live) from cache/DB...
2025-07-16 03:35:38,051 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Elite...
2025-07-16 03:35:38,075 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 19...
2025-07-16 03:35:38,078 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 open orders.
2025-07-16 03:35:38,078 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 19...
2025-07-16 03:35:38,081 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 pending orders.
2025-07-16 03:35:38,081 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:38,081 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-16 03:35:38,081 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 20 (live) from cache/DB...
2025-07-16 03:35:38,082 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:35:38,101 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 20...
2025-07-16 03:35:38,104 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 open orders.
2025-07-16 03:35:38,104 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 20...
2025-07-16 03:35:38,107 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 pending orders.
2025-07-16 03:35:38,107 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:38,107 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-16 03:35:38,107 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 21 (live) from cache/DB...
2025-07-16 03:35:38,108 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:38,122 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 21...
2025-07-16 03:35:38,125 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 open orders.
2025-07-16 03:35:38,125 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 21...
2025-07-16 03:35:38,127 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 pending orders.
2025-07-16 03:35:38,127 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:38,127 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-16 03:35:38,127 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 22 (live) from cache/DB...
2025-07-16 03:35:38,128 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group VIP...
2025-07-16 03:35:38,141 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 22...
2025-07-16 03:35:38,143 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 open orders.
2025-07-16 03:35:38,143 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 22...
2025-07-16 03:35:38,146 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 pending orders.
2025-07-16 03:35:38,147 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:38,147 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-16 03:35:38,147 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 23 (live) from cache/DB...
2025-07-16 03:35:38,147 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:38,160 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 23...
2025-07-16 03:35:38,163 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 open orders.
2025-07-16 03:35:38,163 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 23...
2025-07-16 03:35:38,165 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 pending orders.
2025-07-16 03:35:38,165 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:38,165 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-16 03:35:38,165 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 25 (live) from cache/DB...
2025-07-16 03:35:38,166 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:38,180 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 25...
2025-07-16 03:35:38,183 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 open orders.
2025-07-16 03:35:38,183 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 25...
2025-07-16 03:35:38,185 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 pending orders.
2025-07-16 03:35:38,185 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:38,185 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-16 03:35:38,185 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 26 (live) from cache/DB...
2025-07-16 03:35:38,186 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Royal+...
2025-07-16 03:35:38,199 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 26...
2025-07-16 03:35:38,202 - DEBUG - app - [AUTO-CUTOFF] User 26 has 2 open orders.
2025-07-16 03:35:38,202 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 26...
2025-07-16 03:35:38,204 - DEBUG - app - [AUTO-CUTOFF] User 26 has 0 pending orders.
2025-07-16 03:35:38,204 - DEBUG - app - [AUTO-CUTOFF] User 26 total positions for portfolio calculation: 2
2025-07-16 03:35:38,243 - DEBUG - app - [AUTO-CUTOFF] User 26 adjusted market prices: {'EURSGD': {'buy': Decimal('1.49276'), 'sell': Decimal('1.4923899999999999')}, 'USDCNH': {'buy': Decimal('7.1831000000000005'), 'sell': Decimal('7.1827')}, 'BTCUSD': {'buy': Decimal('119021.4'), 'sell': Decimal('118921.3')}, 'USDSEK': {'buy': Decimal('9.749345'), 'sell': Decimal('9.748235')}, 'AUDJPY': {'buy': Decimal('96.9905'), 'sell': Decimal('96.95949999999999')}, 'EURNOK': {'buy': Decimal('11.962585'), 'sell': Decimal('11.960635')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDCHF': {'buy': Decimal('0.80169'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.26015'), 'sell': Decimal('40.25777')}, 'NZDCAD': {'buy': Decimal('0.81548'), 'sell': Decimal('0.81522')}, 'GBPAUD': {'buy': Decimal('2.05439'), 'sell': Decimal('2.0540599999999998')}, 'EURCHF': {'buy': Decimal('0.9314'), 'sell': Decimal('0.93107')}, 'EURNZD': {'buy': Decimal('1.9552200000000002'), 'sell': Decimal('1.95474')}, 'USDCZK': {'buy': Decimal('21.241'), 'sell': Decimal('21.179000000000002')}, 'EURCAD': {'buy': Decimal('1.594175'), 'sell': Decimal('1.593915')}, 'EURSEK': {'buy': Decimal('11.326595000000001'), 'sell': Decimal('11.324494999999999')}, 'CHFSGD': {'buy': Decimal('1.603005'), 'sell': Decimal('1.602545')}, 'EURGBP': {'buy': Decimal('0.8671599999999999'), 'sell': Decimal('0.8668600000000001')}, 'NZDJPY': {'buy': Decimal('88.3635'), 'sell': Decimal('88.3305')}, 'AUDUSD': {'buy': Decimal('0.652425'), 'sell': Decimal('0.652165')}, 'EURAUD': {'buy': Decimal('1.781255'), 'sell': Decimal('1.780875')}, 'GBPNZD': {'buy': Decimal('2.25502'), 'sell': Decimal('2.25461')}, 'GBPSEK': {'buy': Decimal('13.064175'), 'sell': Decimal('13.061225')}, 'SGDJPY': {'buy': Decimal('115.746'), 'sell': Decimal('115.697')}, 'EURZAR': {'buy': Decimal('20.814325'), 'sell': Decimal('20.806485')}, 'NOKSEK': {'buy': Decimal('0.947165'), 'sell': Decimal('0.9465049999999999')}, 'USDNOK': {'buy': Decimal('10.296865'), 'sell': Decimal('10.295245')}, 'USDJPY': {'buy': Decimal('148.6805'), 'sell': Decimal('148.66150000000002')}, 'USDZAR': {'buy': Decimal('17.91546'), 'sell': Decimal('17.909969999999998')}, 'AUDCAD': {'buy': Decimal('0.8950750000000001'), 'sell': Decimal('0.894905')}, 'EURUSD': {'buy': Decimal('1.1618600000000001'), 'sell': Decimal('1.16169')}, 'NZDUSD': {'buy': Decimal('0.59437'), 'sell': Decimal('0.59415')}, 'EURJPY': {'buy': Decimal('172.732'), 'sell': Decimal('172.701')}, 'CHFJPY': {'buy': Decimal('185.49249999999998'), 'sell': Decimal('185.4575')}, 'USDCAD': {'buy': Decimal('1.37223'), 'sell': Decimal('1.37197')}, 'AUDCHF': {'buy': Decimal('0.522965'), 'sell': Decimal('0.5227649999999999')}, 'GBPNOK': {'buy': Decimal('13.797775'), 'sell': Decimal('13.795225')}, 'US30': {'buy': Decimal('44043.5'), 'sell': Decimal('44041.4')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'USDSGD': {'buy': Decimal('1.28487'), 'sell': Decimal('1.2846')}, 'XAGUSD': {'buy': Decimal('38.0705'), 'sell': Decimal('38.040499999999994')}, 'D30': {'buy': Decimal('24129.12'), 'sell': Decimal('24128.12')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'JP225': {'buy': Decimal('39561.79'), 'sell': Decimal('39557.79')}, 'CADCHF': {'buy': Decimal('0.584365'), 'sell': Decimal('0.584065')}, 'GBPUSD': {'buy': Decimal('1.34003'), 'sell': Decimal('1.3399')}, 'CADJPY': {'buy': Decimal('108.3695'), 'sell': Decimal('108.33749999999999')}, 'EURPLN': {'buy': Decimal('4.25655'), 'sell': Decimal('4.25558')}}
2025-07-16 03:35:38,243 - DEBUG - app - [AUTO-CUTOFF] User 26 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:35:38,244 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-16 03:35:38,429 - DEBUG - app.firebase_stream - Firebase listener triggered (28). Event Type: patch, Path: /. Timestamp: 1752662138.429323
2025-07-16 03:35:38,429 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0580000000', 'o': '38.0520000000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541300000'}, 'USDJPY': {'b': '148.6730000000',
2025-07-16 03:35:38,430 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0580000000', 'o': '38.0520000000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541300000'}, 'USDJPY': {'b': '148.6730000000',...
2025-07-16 03:35:38,430 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:38,618 - DEBUG - app.services.portfolio_calculator - Position calculation for XAGUSD: Type=BUY, Entry=41.09800000, Current=38.040499999999994, Quantity=0.01000000, Contract Size=5000.00000000, PnL=-152.8750000000003000000000000, PnL USD=-152.8750000000003000000000000, Commission=0.10000000, Final PnL=-152.9750000000003000000000000
2025-07-16 03:35:38,619 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=132091.90000000, Current=118921.3, Quantity=6.00000000, Contract Size=1.00000000, PnL=-79023.60000000000000000000000, PnL USD=-79023.60000000000000000000000, Commission=3661.62000000, Final PnL=-82685.22000000000000000000000
2025-07-16 03:35:38,619 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.29582023268405155850309593% which is below threshold 100.0%
2025-07-16 03:35:38,619 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101507.6149999999997000000000', 'margin': '146484.47000000', 'free_margin': '-44976.8550000000003000000000', 'profit_loss': '-82838.19500000000030000000000', 'margin_level': '69.29582023268405155850309593', 'positions': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-152.9750000000003000000000000', 'current_price': '38.040499999999994'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-82685.22000000000000000000000', 'current_price': '118921.3'}], 'margin_call': True}
2025-07-16 03:35:38,619 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 26: {'balance': '184345.81000000', 'equity': '101507.6149999999997000000000', 'margin': '146484.47000000', 'free_margin': '-44976.8550000000003000000000', 'profit_loss': '-82838.19500000000030000000000', 'margin_level': '69.29582023268405155850309593', 'positions_with_pnl': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-152.9750000000003000000000000', 'current_price': '38.040499999999994'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-82685.22000000000000000000000', 'current_price': '118921.3'}], 'margin_call': True}
2025-07-16 03:35:38,621 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.29582023268405155850309593
2025-07-16 03:35:38,625 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-16 03:35:38,626 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-16 03:35:38,626 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 1 (demo) from cache/DB...
2025-07-16 03:35:38,637 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:38,717 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 1...
2025-07-16 03:35:38,723 - DEBUG - app - [AUTO-CUTOFF] User 1 has 2 open orders.
2025-07-16 03:35:38,723 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 1...
2025-07-16 03:35:38,732 - DEBUG - app - [AUTO-CUTOFF] User 1 has 1 pending orders.
2025-07-16 03:35:38,732 - DEBUG - app - [AUTO-CUTOFF] User 1 total positions for portfolio calculation: 3
2025-07-16 03:35:38,806 - DEBUG - app - [AUTO-CUTOFF] User 1 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618600000000001'), 'sell': Decimal('1.16169')}, 'USDZAR': {'buy': Decimal('17.91545'), 'sell': Decimal('17.909979999999997')}, 'SGDJPY': {'buy': Decimal('115.7435'), 'sell': Decimal('115.6995')}, 'GBPAUD': {'buy': Decimal('2.05444'), 'sell': Decimal('2.05401')}, 'USDNOK': {'buy': Decimal('10.29684'), 'sell': Decimal('10.29527')}, 'NZDCAD': {'buy': Decimal('0.8155399999999999'), 'sell': Decimal('0.81516')}, 'GBPNZD': {'buy': Decimal('2.25507'), 'sell': Decimal('2.25456')}, 'US30': {'buy': Decimal('44043.5'), 'sell': Decimal('44041.4')}, 'CHFJPY': {'buy': Decimal('185.49499999999998'), 'sell': Decimal('185.455')}, 'CADJPY': {'buy': Decimal('108.3695'), 'sell': Decimal('108.33749999999999')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.80142')}, 'USDTRY': {'buy': Decimal('40.26014'), 'sell': Decimal('40.257780000000004')}, 'GBPSEK': {'buy': Decimal('13.06415'), 'sell': Decimal('13.061250000000001')}, 'GBPNOK': {'buy': Decimal('13.797749999999999'), 'sell': Decimal('13.795250000000001')}, 'USDCNH': {'buy': Decimal('7.18309'), 'sell': Decimal('7.18271')}, 'EURCHF': {'buy': Decimal('0.93141'), 'sell': Decimal('0.93106')}, 'XAGUSD': {'buy': Decimal('38.073'), 'sell': Decimal('38.038')}, 'BTCUSD': {'buy': Decimal('119021.4'), 'sell': Decimal('118921.3')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96256'), 'sell': Decimal('11.96066')}, 'USDCAD': {'buy': Decimal('1.3722800000000002'), 'sell': Decimal('1.3719199999999998')}, 'NOKSEK': {'buy': Decimal('0.947115'), 'sell': Decimal('0.9465549999999999')}, 'CADCHF': {'buy': Decimal('0.584365'), 'sell': Decimal('0.584065')}, 'GBPUSD': {'buy': Decimal('1.34007'), 'sell': Decimal('1.33986')}, 'CHFSGD': {'buy': Decimal('1.602975'), 'sell': Decimal('1.602575')}, 'EURGBP': {'buy': Decimal('0.86718'), 'sell': Decimal('0.86684')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.02799999999999'), 'sell': Decimal('96.922')}, 'EURJPY': {'buy': Decimal('172.73049999999998'), 'sell': Decimal('172.70250000000001')}, 'AUDCHF': {'buy': Decimal('0.5230899999999999'), 'sell': Decimal('0.52264')}, 'EURZAR': {'buy': Decimal('20.81435'), 'sell': Decimal('20.806459999999998')}, 'USDCZK': {'buy': Decimal('21.245'), 'sell': Decimal('21.175')}, 'D30': {'buy': Decimal('24128.62'), 'sell': Decimal('24128.62')}, 'AUDUSD': {'buy': Decimal('0.65245'), 'sell': Decimal('0.65214')}, 'EURSEK': {'buy': Decimal('11.32657'), 'sell': Decimal('11.32452')}, 'NZDJPY': {'buy': Decimal('88.3635'), 'sell': Decimal('88.3305')}, 'USDSGD': {'buy': Decimal('1.28491'), 'sell': Decimal('1.28456')}, 'EURSGD': {'buy': Decimal('1.492745'), 'sell': Decimal('1.492405')}, 'NZDUSD': {'buy': Decimal('0.59442'), 'sell': Decimal('0.5941')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.256539999999999'), 'sell': Decimal('4.255590000000001')}, 'AUDCAD': {'buy': Decimal('0.895'), 'sell': Decimal('0.89498')}, 'EURCAD': {'buy': Decimal('1.59415'), 'sell': Decimal('1.59394')}, 'EURNZD': {'buy': Decimal('1.955195'), 'sell': Decimal('1.954765')}, 'USDSEK': {'buy': Decimal('9.749319999999999'), 'sell': Decimal('9.74826')}, 'USDJPY': {'buy': Decimal('148.723'), 'sell': Decimal('148.619')}, 'EURAUD': {'buy': Decimal('1.7812700000000001'), 'sell': Decimal('1.7808599999999999')}, 'JP225': {'buy': Decimal('39561.79'), 'sell': Decimal('39557.79')}}
2025-07-16 03:35:38,807 - DEBUG - app - [AUTO-CUTOFF] User 1 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:35:38,807 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-16 03:35:39,129 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:39,130 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=96.66800000, Current=96.922, Quantity=0.01000000, Contract Size=100000.00000000, PnL=254.000000000000000000000000, PnL USD=1.708447397980803508370719633, Commission=0.10000000, Final PnL=1.608447397980803508370719633
2025-07-16 03:35:39,132 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=SELL, Entry=96.56000000, Current=97.02799999999999, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-467.9999999999900000000000000, PnL USD=-3.147847961633854163163452678, Commission=0.10000000, Final PnL=-3.247847961633854163163452678
2025-07-16 03:35:39,132 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17011.54000000', 'equity': '17009.90059943634694934520727', 'margin': '6.54000000', 'free_margin': '17003.36059943634694934520727', 'profit_loss': '-1.639400563653050654792733045', 'margin_level': '260090.2232329716658921285515', 'positions': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.608447397980803508370719633', 'current_price': '96.922'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.247847961633854163163452678', 'current_price': '97.02799999999999'}], 'margin_call': False}
2025-07-16 03:35:39,132 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 1: {'balance': '17011.54000000', 'equity': '17009.90059943634694934520727', 'margin': '6.54000000', 'free_margin': '17003.36059943634694934520727', 'profit_loss': '-1.639400563653050654792733045', 'margin_level': '260090.2232329716658921285515', 'positions_with_pnl': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.608447397980803508370719633', 'current_price': '96.922'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.247847961633854163163452678', 'current_price': '97.02799999999999'}], 'margin_call': False}
2025-07-16 03:35:39,134 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:39,134 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 260090.2232329716658921285515
2025-07-16 03:35:39,135 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-16 03:35:39,135 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-16 03:35:39,135 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 2 (demo) from cache/DB...
2025-07-16 03:35:39,136 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-16 03:35:39,136 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-16 03:35:39,136 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 3 (demo) from cache/DB...
2025-07-16 03:35:39,137 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:35:39,145 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 3.
2025-07-16 03:35:39,145 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-16 03:35:39,146 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (demo) from cache/DB...
2025-07-16 03:35:39,146 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:39,166 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:35:39,170 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:35:39,170 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:35:39,174 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:35:39,174 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:39,174 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-16 03:35:39,174 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (demo) from cache/DB...
2025-07-16 03:35:39,175 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-16 03:35:39,175 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-16 03:35:39,175 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 6 (demo) from cache/DB...
2025-07-16 03:35:39,176 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-16 03:35:39,176 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-16 03:35:39,176 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (demo) from cache/DB...
2025-07-16 03:35:39,177 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:39,201 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:35:39,207 - DEBUG - app - [AUTO-CUTOFF] User 9 has 28 open orders.
2025-07-16 03:35:39,208 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:35:39,213 - DEBUG - app - [AUTO-CUTOFF] User 9 has 6 pending orders.
2025-07-16 03:35:39,213 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 34
2025-07-16 03:35:39,271 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618600000000001'), 'sell': Decimal('1.16169')}, 'USDZAR': {'buy': Decimal('17.91545'), 'sell': Decimal('17.91001')}, 'SGDJPY': {'buy': Decimal('115.7425'), 'sell': Decimal('115.6985')}, 'GBPAUD': {'buy': Decimal('2.05446'), 'sell': Decimal('2.0539799999999997')}, 'USDNOK': {'buy': Decimal('10.296859999999999'), 'sell': Decimal('10.295350000000001')}, 'NZDCAD': {'buy': Decimal('0.81552'), 'sell': Decimal('0.81513')}, 'GBPNZD': {'buy': Decimal('2.25507'), 'sell': Decimal('2.25454')}, 'US30': {'buy': Decimal('44040.0'), 'sell': Decimal('44037.9')}, 'CHFJPY': {'buy': Decimal('185.49499999999998'), 'sell': Decimal('185.44500000000002')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.3385')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.8014100000000001')}, 'USDTRY': {'buy': Decimal('40.26014'), 'sell': Decimal('40.257780000000004')}, 'GBPSEK': {'buy': Decimal('13.06415'), 'sell': Decimal('13.061250000000001')}, 'GBPNOK': {'buy': Decimal('13.79725'), 'sell': Decimal('13.79495')}, 'USDCNH': {'buy': Decimal('7.1830799999999995'), 'sell': Decimal('7.1827000000000005')}, 'EURCHF': {'buy': Decimal('0.93143'), 'sell': Decimal('0.9310700000000001')}, 'XAGUSD': {'buy': Decimal('38.073'), 'sell': Decimal('38.037')}, 'BTCUSD': {'buy': Decimal('119021.4'), 'sell': Decimal('118921.3')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96242'), 'sell': Decimal('11.96075')}, 'USDCAD': {'buy': Decimal('1.3722800000000002'), 'sell': Decimal('1.37194')}, 'NOKSEK': {'buy': Decimal('0.947115'), 'sell': Decimal('0.9465549999999999')}, 'CADCHF': {'buy': Decimal('0.5843750000000001'), 'sell': Decimal('0.584065')}, 'GBPUSD': {'buy': Decimal('1.34007'), 'sell': Decimal('1.33986')}, 'CHFSGD': {'buy': Decimal('1.602975'), 'sell': Decimal('1.602575')}, 'EURGBP': {'buy': Decimal('0.8672'), 'sell': Decimal('0.86685')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.02799999999999'), 'sell': Decimal('96.922')}, 'EURJPY': {'buy': Decimal('172.7355'), 'sell': Decimal('172.7055')}, 'AUDCHF': {'buy': Decimal('0.5230899999999999'), 'sell': Decimal('0.52264')}, 'EURZAR': {'buy': Decimal('20.81445'), 'sell': Decimal('20.80755')}, 'USDCZK': {'buy': Decimal('21.245'), 'sell': Decimal('21.175')}, 'D30': {'buy': Decimal('24128.62'), 'sell': Decimal('24128.62')}, 'AUDUSD': {'buy': Decimal('0.65245'), 'sell': Decimal('0.65214')}, 'EURSEK': {'buy': Decimal('11.326559999999999'), 'sell': Decimal('11.324670000000001')}, 'NZDJPY': {'buy': Decimal('88.3655'), 'sell': Decimal('88.33149999999999')}, 'USDSGD': {'buy': Decimal('1.2849000000000002'), 'sell': Decimal('1.28456')}, 'EURSGD': {'buy': Decimal('1.492735'), 'sell': Decimal('1.492385')}, 'NZDUSD': {'buy': Decimal('0.59442'), 'sell': Decimal('0.59409')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25662'), 'sell': Decimal('4.25567')}, 'AUDCAD': {'buy': Decimal('0.895'), 'sell': Decimal('0.89497')}, 'EURCAD': {'buy': Decimal('1.59415'), 'sell': Decimal('1.59394')}, 'EURNZD': {'buy': Decimal('1.9552049999999999'), 'sell': Decimal('1.954815')}, 'USDSEK': {'buy': Decimal('9.748999999999999'), 'sell': Decimal('9.74821')}, 'USDJPY': {'buy': Decimal('148.723'), 'sell': Decimal('148.618')}, 'EURAUD': {'buy': Decimal('1.7812700000000001'), 'sell': Decimal('1.78087')}, 'JP225': {'buy': Decimal('39560.05'), 'sell': Decimal('39556.05')}}
2025-07-16 03:35:39,272 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:35:39,272 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:35:39,641 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=BUY, Entry=0.64743000, Current=0.65214, Quantity=0.10000000, Contract Size=100000.00000000, PnL=47.100000000000000000000000, PnL USD=47.100000000000000000000000, Commission=1.00000000, Final PnL=46.100000000000000000000000
2025-07-16 03:35:39,641 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=SELL, Entry=0.64707000, Current=0.65245, Quantity=0.22000000, Contract Size=100000.00000000, PnL=-118.360000000000000000000000, PnL USD=-118.360000000000000000000000, Commission=2.20000000, Final PnL=-120.560000000000000000000000
2025-07-16 03:35:39,642 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=BUY, Entry=1.57561500, Current=1.602575, Quantity=0.10000000, Contract Size=100000.00000000, PnL=269.600000000000000000000000, PnL USD=209.8462735940844522280599338, Commission=1.00000000, Final PnL=208.8462735940844522280599338
2025-07-16 03:35:39,644 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=SELL, Entry=1.57505500, Current=1.602975, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-279.200000000000000000000000, PnL USD=-217.3185444639034831679315042, Commission=1.00000000, Final PnL=-218.3185444639034831679315042
2025-07-16 03:35:39,645 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=SELL, Entry=106.24150000, Current=108.3735, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-31980.00000000000000000000000, PnL USD=-215.1029440449846306995890310, Commission=0E-8, Final PnL=-215.1029440449846306995890310
2025-07-16 03:35:39,646 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=BUY, Entry=106.27050000, Current=108.3385, Quantity=0.15000000, Contract Size=100000.00000000, PnL=31020.00000000000000000000000, PnL USD=208.6458200211201764947233190, Commission=0E-8, Final PnL=208.6458200211201764947233190
2025-07-16 03:35:39,646 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77481000, Current=1.78087, Quantity=0.22000000, Contract Size=100000.00000000, PnL=133.320000000000000000000000, PnL USD=86.96463600000000000000000000, Commission=2.20000000, Final PnL=84.76463600000000000000000000
2025-07-16 03:35:39,646 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77439000, Current=1.7812700000000001, Quantity=0.21000000, Contract Size=100000.00000000, PnL=-144.4800000000021000000000000, PnL USD=-94.24430400000136983000000000, Commission=2.10000000, Final PnL=-96.34430400000136983000000000
2025-07-16 03:35:39,647 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=BUY, Entry=178.15500000, Current=185.44500000000002, Quantity=0.10000000, Contract Size=100000.00000000, PnL=72900.00000000020000000000000, PnL USD=490.3378555622083364161616433, Commission=1.00000000, Final PnL=489.3378555622083364161616433
2025-07-16 03:35:39,648 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=SELL, Entry=178.09500000, Current=185.49499999999998, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-73999.99999999980000000000000, PnL USD=-497.7366435062169997242269948, Commission=1.00000000, Final PnL=-498.7366435062169997242269948
2025-07-16 03:35:39,649 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77480000, Current=1.78087, Quantity=0.05000000, Contract Size=100000.00000000, PnL=30.350000000000000000000000, PnL USD=19.79730500000000000000000000, Commission=0.50000000, Final PnL=19.29730500000000000000000000
2025-07-16 03:35:39,649 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77442000, Current=1.7812700000000001, Quantity=0.05000000, Contract Size=100000.00000000, PnL=-34.25000000000050000000000000, PnL USD=-22.34127500000032615000000000, Commission=0.50000000, Final PnL=-22.84127500000032615000000000
2025-07-16 03:35:39,649 - DEBUG - app.services.portfolio_calculator - Position calculation for EURGBP: Type=SELL, Entry=0.85403000, Current=0.8672, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-131.700000000000000000000000, PnL USD=-176.4740490000000000000000000, Commission=1.00000000, Final PnL=-177.4740490000000000000000000
2025-07-16 03:35:39,650 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=BUY, Entry=167.26050000, Current=172.7055, Quantity=0.10000000, Contract Size=100000.00000000, PnL=54450.00000000000000000000000, PnL USD=366.2400032285620119322271024, Commission=1.00000000, Final PnL=365.2400032285620119322271024
2025-07-16 03:35:39,651 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=SELL, Entry=167.23150000, Current=172.7355, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-55040.00000000000000000000000, PnL USD=-370.2084440348953744123008213, Commission=1.00000000, Final PnL=-371.2084440348953744123008213
2025-07-16 03:35:39,651 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=SELL, Entry=1.91952500, Current=1.9552049999999999, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-356.7999999999990000000000000, PnL USD=-212.0355359999994057300000000, Commission=1.00000000, Final PnL=-213.0355359999994057300000000
2025-07-16 03:35:39,651 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=BUY, Entry=1.92063500, Current=1.954815, Quantity=0.10000000, Contract Size=100000.00000000, PnL=341.800000000000000000000000, PnL USD=203.1214860000000000000000000, Commission=1.00000000, Final PnL=202.1214860000000000000000000
2025-07-16 03:35:39,651 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34376000, Current=1.34007, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-24, PnL USD=0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:35:39,651 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34361000, Current=1.34007, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-24, PnL USD=0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:35:39,652 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34379000, Current=1.33986, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:35:39,652 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34378000, Current=1.33986, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:35:39,652 - DEBUG - app.services.portfolio_calculator - Position calculation for NZDJPY: Type=BUY, Entry=87.10150000, Current=88.33149999999999, Quantity=0.01000000, Contract Size=100000.00000000, PnL=1229.999999999990000000000000, PnL USD=8.273190155576264688275611577, Commission=0.10000000, Final PnL=8.173190155576264688275611577
2025-07-16 03:35:39,653 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=SELL, Entry=0.81771000, Current=0.80174, Quantity=0.15000000, Contract Size=100000.00000000, PnL=239.550000000000000000000000, PnL USD=298.8435484474606719145697925, Commission=1.50000000, Final PnL=297.3435484474606719145697925
2025-07-16 03:35:39,654 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=BUY, Entry=0.81805000, Current=0.8014100000000001, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-249.5999999999985000000000000, PnL USD=-311.3811300041149465437443082, Commission=1.50000000, Final PnL=-312.8811300041149465437443082
2025-07-16 03:35:39,655 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.04973000, Current=10.295350000000001, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2456.200000000010000000000000, PnL USD=238.5433723168493472640642694, Commission=1.00000000, Final PnL=237.5433723168493472640642694
2025-07-16 03:35:39,656 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.05023000, Current=10.295350000000001, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2451.200000000010000000000000, PnL USD=238.0577779590673092051208839, Commission=1.00000000, Final PnL=237.0577779590673092051208839
2025-07-16 03:35:39,657 - DEBUG - app.services.portfolio_calculator - Position calculation for USDSGD: Type=SELL, Entry=1.28795000, Current=1.2849000000000002, Quantity=0.31000000, Contract Size=100000.00000000, PnL=94.54999999999380000000000000, PnL USD=73.59408445222323409223584355, Commission=3.10000000, Final PnL=70.49408445222323409223584355
2025-07-16 03:35:39,658 - DEBUG - app.services.portfolio_calculator - Position calculation for USDTRY: Type=SELL, Entry=39.56087000, Current=40.26014, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-6992.700000000000000000000000, PnL USD=-173.6885677318846825346951154, Commission=1.00000000, Final PnL=-174.6885677318846825346951154
2025-07-16 03:35:39,659 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '98181.73000000', 'equity': '98225.50391495115058544295062', 'margin': '1917.31000000', 'free_margin': '96308.19391495115058544295062', 'profit_loss': '43.7739149511505854429506246', 'margin_level': '5123.089323841796610117453652', 'positions': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.100000000000000000000000', 'current_price': '0.65214'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-120.560000000000000000000000', 'current_price': '0.65245'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.8462735940844522280599338', 'current_price': '1.602575'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-218.3185444639034831679315042', 'current_price': '1.602975'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-215.1029440449846306995890310', 'current_price': '108.3735'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.6458200211201764947233190', 'current_price': '108.3385'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '84.76463600000000000000000000', 'current_price': '1.78087'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-96.34430400000136983000000000', 'current_price': '1.7812700000000001'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '489.3378555622083364161616433', 'current_price': '185.44500000000002'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-498.7366435062169997242269948', 'current_price': '185.49499999999998'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '19.29730500000000000000000000', 'current_price': '1.78087'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.84127500000032615000000000', 'current_price': '1.7812700000000001'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-177.4740490000000000000000000', 'current_price': '0.8672'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '365.2400032285620119322271024', 'current_price': '172.7055'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-371.2084440348953744123008213', 'current_price': '172.7355'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-213.0355359999994057300000000', 'current_price': '1.9552049999999999'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '202.1214860000000000000000000', 'current_price': '1.954815'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34007'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34007'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33986'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33986'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.173190155576264688275611577', 'current_price': '88.33149999999999'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '297.3435484474606719145697925', 'current_price': '0.80174'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-312.8811300041149465437443082', 'current_price': '0.8014100000000001'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.5433723168493472640642694', 'current_price': '10.295350000000001'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.0577779590673092051208839', 'current_price': '10.295350000000001'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '70.49408445222323409223584355', 'current_price': '1.2849000000000002'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.6885677318846825346951154', 'current_price': '40.26014'}], 'margin_call': False}
2025-07-16 03:35:39,659 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '98181.73000000', 'equity': '98225.50391495115058544295062', 'margin': '1917.31000000', 'free_margin': '96308.19391495115058544295062', 'profit_loss': '43.7739149511505854429506246', 'margin_level': '5123.089323841796610117453652', 'positions_with_pnl': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.100000000000000000000000', 'current_price': '0.65214'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-120.560000000000000000000000', 'current_price': '0.65245'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.8462735940844522280599338', 'current_price': '1.602575'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-218.3185444639034831679315042', 'current_price': '1.602975'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-215.1029440449846306995890310', 'current_price': '108.3735'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.6458200211201764947233190', 'current_price': '108.3385'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '84.76463600000000000000000000', 'current_price': '1.78087'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-96.34430400000136983000000000', 'current_price': '1.7812700000000001'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '489.3378555622083364161616433', 'current_price': '185.44500000000002'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-498.7366435062169997242269948', 'current_price': '185.49499999999998'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '19.29730500000000000000000000', 'current_price': '1.78087'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.84127500000032615000000000', 'current_price': '1.7812700000000001'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-177.4740490000000000000000000', 'current_price': '0.8672'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '365.2400032285620119322271024', 'current_price': '172.7055'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-371.2084440348953744123008213', 'current_price': '172.7355'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-213.0355359999994057300000000', 'current_price': '1.9552049999999999'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '202.1214860000000000000000000', 'current_price': '1.954815'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34007'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34007'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33986'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33986'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.173190155576264688275611577', 'current_price': '88.33149999999999'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '297.3435484474606719145697925', 'current_price': '0.80174'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-312.8811300041149465437443082', 'current_price': '0.8014100000000001'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.5433723168493472640642694', 'current_price': '10.295350000000001'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.0577779590673092051208839', 'current_price': '10.295350000000001'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '70.49408445222323409223584355', 'current_price': '1.2849000000000002'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.6885677318846825346951154', 'current_price': '40.26014'}], 'margin_call': False}
2025-07-16 03:35:39,661 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 5123.089323841796610117453652
2025-07-16 03:35:39,662 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:35:39,662 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-16 03:35:39,662 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (demo) from cache/DB...
2025-07-16 03:35:39,663 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:39,685 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:35:39,689 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:35:39,690 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:35:39,694 - DEBUG - app - [AUTO-CUTOFF] User 10 has 1 pending orders.
2025-07-16 03:35:39,694 - DEBUG - app - [AUTO-CUTOFF] User 10 total positions for portfolio calculation: 1
2025-07-16 03:35:39,772 - DEBUG - app - [AUTO-CUTOFF] User 10 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618600000000001'), 'sell': Decimal('1.16169')}, 'USDZAR': {'buy': Decimal('17.91545'), 'sell': Decimal('17.91001')}, 'SGDJPY': {'buy': Decimal('115.7425'), 'sell': Decimal('115.6985')}, 'GBPAUD': {'buy': Decimal('2.05446'), 'sell': Decimal('2.0539799999999997')}, 'USDNOK': {'buy': Decimal('10.296859999999999'), 'sell': Decimal('10.295350000000001')}, 'NZDCAD': {'buy': Decimal('0.81552'), 'sell': Decimal('0.81513')}, 'GBPNZD': {'buy': Decimal('2.25507'), 'sell': Decimal('2.25454')}, 'US30': {'buy': Decimal('44040.0'), 'sell': Decimal('44037.9')}, 'CHFJPY': {'buy': Decimal('185.49499999999998'), 'sell': Decimal('185.44500000000002')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.3385')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.8014100000000001')}, 'USDTRY': {'buy': Decimal('40.26014'), 'sell': Decimal('40.257780000000004')}, 'GBPSEK': {'buy': Decimal('13.06415'), 'sell': Decimal('13.061250000000001')}, 'GBPNOK': {'buy': Decimal('13.79725'), 'sell': Decimal('13.79495')}, 'USDCNH': {'buy': Decimal('7.1830799999999995'), 'sell': Decimal('7.1827000000000005')}, 'EURCHF': {'buy': Decimal('0.93143'), 'sell': Decimal('0.9310700000000001')}, 'XAGUSD': {'buy': Decimal('38.073'), 'sell': Decimal('38.037')}, 'BTCUSD': {'buy': Decimal('119021.4'), 'sell': Decimal('118921.3')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96242'), 'sell': Decimal('11.96075')}, 'USDCAD': {'buy': Decimal('1.3722800000000002'), 'sell': Decimal('1.37194')}, 'NOKSEK': {'buy': Decimal('0.947115'), 'sell': Decimal('0.9465549999999999')}, 'CADCHF': {'buy': Decimal('0.5843750000000001'), 'sell': Decimal('0.584065')}, 'GBPUSD': {'buy': Decimal('1.34007'), 'sell': Decimal('1.33986')}, 'CHFSGD': {'buy': Decimal('1.602975'), 'sell': Decimal('1.602575')}, 'EURGBP': {'buy': Decimal('0.8672'), 'sell': Decimal('0.86685')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.02799999999999'), 'sell': Decimal('96.922')}, 'EURJPY': {'buy': Decimal('172.7355'), 'sell': Decimal('172.7055')}, 'AUDCHF': {'buy': Decimal('0.5230899999999999'), 'sell': Decimal('0.52264')}, 'EURZAR': {'buy': Decimal('20.81445'), 'sell': Decimal('20.80755')}, 'USDCZK': {'buy': Decimal('21.245'), 'sell': Decimal('21.175')}, 'D30': {'buy': Decimal('24128.62'), 'sell': Decimal('24128.62')}, 'AUDUSD': {'buy': Decimal('0.65245'), 'sell': Decimal('0.65214')}, 'EURSEK': {'buy': Decimal('11.326559999999999'), 'sell': Decimal('11.324670000000001')}, 'NZDJPY': {'buy': Decimal('88.3655'), 'sell': Decimal('88.33149999999999')}, 'USDSGD': {'buy': Decimal('1.2849000000000002'), 'sell': Decimal('1.28456')}, 'EURSGD': {'buy': Decimal('1.492735'), 'sell': Decimal('1.492385')}, 'NZDUSD': {'buy': Decimal('0.59442'), 'sell': Decimal('0.59409')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25662'), 'sell': Decimal('4.25567')}, 'AUDCAD': {'buy': Decimal('0.895'), 'sell': Decimal('0.89497')}, 'EURCAD': {'buy': Decimal('1.59415'), 'sell': Decimal('1.59394')}, 'EURNZD': {'buy': Decimal('1.9552049999999999'), 'sell': Decimal('1.954815')}, 'USDSEK': {'buy': Decimal('9.748999999999999'), 'sell': Decimal('9.74821')}, 'USDJPY': {'buy': Decimal('148.723'), 'sell': Decimal('148.618')}, 'EURAUD': {'buy': Decimal('1.7812700000000001'), 'sell': Decimal('1.78087')}, 'JP225': {'buy': Decimal('39560.05'), 'sell': Decimal('39556.05')}}
2025-07-16 03:35:39,772 - DEBUG - app - [AUTO-CUTOFF] User 10 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:35:39,772 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-16 03:35:40,154 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions': [], 'margin_call': False}
2025-07-16 03:35:40,154 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions_with_pnl': [], 'margin_call': False}
2025-07-16 03:35:40,155 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:40,156 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 25371.71974522292993630573248
2025-07-16 03:35:40,157 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-16 03:35:40,157 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-16 03:35:40,158 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (demo) from cache/DB...
2025-07-16 03:35:40,159 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:40,160 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:40,185 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:35:40,188 - DEBUG - app - [AUTO-CUTOFF] User 11 has 1 open orders.
2025-07-16 03:35:40,188 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:35:40,192 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:35:40,192 - DEBUG - app - [AUTO-CUTOFF] User 11 total positions for portfolio calculation: 1
2025-07-16 03:35:40,258 - DEBUG - app - [AUTO-CUTOFF] User 11 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618600000000001'), 'sell': Decimal('1.16169')}, 'USDZAR': {'buy': Decimal('17.91545'), 'sell': Decimal('17.91001')}, 'SGDJPY': {'buy': Decimal('115.7425'), 'sell': Decimal('115.6985')}, 'GBPAUD': {'buy': Decimal('2.05446'), 'sell': Decimal('2.0539799999999997')}, 'USDNOK': {'buy': Decimal('10.296859999999999'), 'sell': Decimal('10.295350000000001')}, 'NZDCAD': {'buy': Decimal('0.81552'), 'sell': Decimal('0.81513')}, 'GBPNZD': {'buy': Decimal('2.25507'), 'sell': Decimal('2.25454')}, 'US30': {'buy': Decimal('44040.0'), 'sell': Decimal('44037.9')}, 'CHFJPY': {'buy': Decimal('185.49499999999998'), 'sell': Decimal('185.44500000000002')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.3385')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.8014100000000001')}, 'USDTRY': {'buy': Decimal('40.26014'), 'sell': Decimal('40.257780000000004')}, 'GBPSEK': {'buy': Decimal('13.06415'), 'sell': Decimal('13.061250000000001')}, 'GBPNOK': {'buy': Decimal('13.79725'), 'sell': Decimal('13.79495')}, 'USDCNH': {'buy': Decimal('7.1830799999999995'), 'sell': Decimal('7.1827000000000005')}, 'EURCHF': {'buy': Decimal('0.93143'), 'sell': Decimal('0.9310700000000001')}, 'XAGUSD': {'buy': Decimal('38.073'), 'sell': Decimal('38.037')}, 'BTCUSD': {'buy': Decimal('119021.4'), 'sell': Decimal('118921.3')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96242'), 'sell': Decimal('11.96075')}, 'USDCAD': {'buy': Decimal('1.3722800000000002'), 'sell': Decimal('1.37194')}, 'NOKSEK': {'buy': Decimal('0.947115'), 'sell': Decimal('0.9465549999999999')}, 'CADCHF': {'buy': Decimal('0.5843750000000001'), 'sell': Decimal('0.584065')}, 'GBPUSD': {'buy': Decimal('1.34007'), 'sell': Decimal('1.33986')}, 'CHFSGD': {'buy': Decimal('1.602975'), 'sell': Decimal('1.602575')}, 'EURGBP': {'buy': Decimal('0.8672'), 'sell': Decimal('0.86685')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.02799999999999'), 'sell': Decimal('96.922')}, 'EURJPY': {'buy': Decimal('172.7355'), 'sell': Decimal('172.7055')}, 'AUDCHF': {'buy': Decimal('0.5230899999999999'), 'sell': Decimal('0.52264')}, 'EURZAR': {'buy': Decimal('20.81445'), 'sell': Decimal('20.80755')}, 'USDCZK': {'buy': Decimal('21.245'), 'sell': Decimal('21.175')}, 'D30': {'buy': Decimal('24128.62'), 'sell': Decimal('24128.62')}, 'AUDUSD': {'buy': Decimal('0.65245'), 'sell': Decimal('0.65214')}, 'EURSEK': {'buy': Decimal('11.326559999999999'), 'sell': Decimal('11.324670000000001')}, 'NZDJPY': {'buy': Decimal('88.3655'), 'sell': Decimal('88.33149999999999')}, 'USDSGD': {'buy': Decimal('1.2849000000000002'), 'sell': Decimal('1.28456')}, 'EURSGD': {'buy': Decimal('1.492735'), 'sell': Decimal('1.492385')}, 'NZDUSD': {'buy': Decimal('0.59442'), 'sell': Decimal('0.59409')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25662'), 'sell': Decimal('4.25567')}, 'AUDCAD': {'buy': Decimal('0.895'), 'sell': Decimal('0.89497')}, 'EURCAD': {'buy': Decimal('1.59415'), 'sell': Decimal('1.59394')}, 'EURNZD': {'buy': Decimal('1.9552049999999999'), 'sell': Decimal('1.954815')}, 'USDSEK': {'buy': Decimal('9.748999999999999'), 'sell': Decimal('9.74821')}, 'USDJPY': {'buy': Decimal('148.723'), 'sell': Decimal('148.618')}, 'EURAUD': {'buy': Decimal('1.7812700000000001'), 'sell': Decimal('1.78087')}, 'JP225': {'buy': Decimal('39560.05'), 'sell': Decimal('39556.05')}}
2025-07-16 03:35:40,258 - DEBUG - app - [AUTO-CUTOFF] User 11 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:35:40,258 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-16 03:35:40,564 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDCAD: Type=BUY, Entry=0.89752000, Current=0.89497, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-2.550000000000000000000000, PnL USD=-1.858424493306027854503582022, Commission=0.10000000, Final PnL=-1.958424493306027854503582022
2025-07-16 03:35:40,564 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '99998.61000000', 'equity': '99996.65157550669397214549642', 'margin': '6.55', 'free_margin': '99990.10157550669397214549642', 'profit_loss': '-1.958424493306027854503582022', 'margin_level': '1526666.436267277770567106816', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.958424493306027854503582022', 'current_price': '0.89497'}], 'margin_call': False}
2025-07-16 03:35:40,564 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 11: {'balance': '99998.61000000', 'equity': '99996.65157550669397214549642', 'margin': '6.55', 'free_margin': '99990.10157550669397214549642', 'profit_loss': '-1.958424493306027854503582022', 'margin_level': '1526666.436267277770567106816', 'positions_with_pnl': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.958424493306027854503582022', 'current_price': '0.89497'}], 'margin_call': False}
2025-07-16 03:35:40,565 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 1526666.436267277770567106816
2025-07-16 03:35:40,566 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-16 03:35:40,566 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-16 03:35:40,566 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (demo) from cache/DB...
2025-07-16 03:35:40,567 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:40,592 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:35:40,596 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:35:40,596 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:35:40,599 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:35:40,599 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:40,599 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-16 03:35:40,599 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (demo) from cache/DB...
2025-07-16 03:35:40,600 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:35:40,623 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:35:40,627 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:35:40,627 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:35:40,629 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:35:40,629 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:35:40,673 - DEBUG - app.firebase_stream - Firebase listener triggered (29). Event Type: patch, Path: /. Timestamp: 1752662140.6729815
2025-07-16 03:35:40,673 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0542800000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6720000000', 'o': '148.6680000000'}, 'USDCNH': {'b': '7.1829400000', 'o': '7.1828600000'}, 'CADCHF': {'b': '0.5842600000', '
2025-07-16 03:35:40,673 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPAUD': {'b': '2.0542800000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6720000000', 'o': '148.6680000000'}, 'USDCNH': {'b': '7.1829400000', 'o': '7.1828600000'}, 'CADCHF': {'b': '0.5842600000', '...
2025-07-16 03:35:40,674 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:41,167 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:41,170 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:42,185 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:42,189 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:43,033 - DEBUG - app.firebase_stream - Firebase listener triggered (30). Event Type: patch, Path: /. Timestamp: 1752662143.0329962
2025-07-16 03:35:43,033 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614700000'}, 'XAGUSD': {'b': '38.0590000000', 'o': '38.0520000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0543300000',
2025-07-16 03:35:43,033 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614700000'}, 'XAGUSD': {'b': '38.0590000000', 'o': '38.0520000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0543300000',...
2025-07-16 03:35:43,034 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:43,191 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:43,196 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:44,200 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:44,204 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:45,209 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:45,214 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:45,280 - DEBUG - app.firebase_stream - Firebase listener triggered (31). Event Type: patch, Path: /. Timestamp: 1752662145.280377
2025-07-16 03:35:45,280 - DEBUG - app.firebase_stream - Prepared batch update for 15 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0639000000', 'o': '13.0614700000'}, 'XAGUSD': {'b': '38.0580000000', 'o': '38.0520000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6740000000',
2025-07-16 03:35:45,281 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0639000000', 'o': '13.0614700000'}, 'XAGUSD': {'b': '38.0580000000', 'o': '38.0520000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6740000000',...
2025-07-16 03:35:45,281 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:46,226 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:46,231 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:47,245 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:47,249 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:47,738 - DEBUG - app.firebase_stream - Firebase listener triggered (32). Event Type: patch, Path: /. Timestamp: 1752662147.738161
2025-07-16 03:35:47,738 - DEBUG - app.firebase_stream - Prepared batch update for 19 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614700000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6730000000',
2025-07-16 03:35:47,738 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614700000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6730000000',...
2025-07-16 03:35:47,739 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:48,259 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:48,263 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:49,280 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:49,284 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:49,888 - DEBUG - app.firebase_stream - Firebase listener triggered (33). Event Type: patch, Path: /. Timestamp: 1752662149.8885803
2025-07-16 03:35:49,889 - DEBUG - app.firebase_stream - Prepared batch update for 17 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0590000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6730000000',
2025-07-16 03:35:49,889 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0590000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6730000000',...
2025-07-16 03:35:49,889 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:50,287 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:50,291 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:51,307 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:51,313 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:52,151 - DEBUG - app.firebase_stream - Firebase listener triggered (34). Event Type: patch, Path: /. Timestamp: 1752662152.1513948
2025-07-16 03:35:52,179 - DEBUG - app.firebase_stream - Prepared batch update for 19 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614900000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6740000000', 'o': '148.6700000000'}, 'CADCHF': {'b': '0.5842500000',
2025-07-16 03:35:52,181 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614900000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6740000000', 'o': '148.6700000000'}, 'CADCHF': {'b': '0.5842500000',...
2025-07-16 03:35:52,181 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:52,322 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:52,326 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:53,341 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:53,345 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:54,350 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:54,354 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:54,498 - DEBUG - app.firebase_stream - Firebase listener triggered (35). Event Type: patch, Path: /. Timestamp: 1752662154.498597
2025-07-16 03:35:54,499 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0639000000', 'o': '13.0614900000'}, 'NZDJPY': {'b': '88.3490000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0543000000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6760000000',
2025-07-16 03:35:54,499 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0639000000', 'o': '13.0614900000'}, 'NZDJPY': {'b': '88.3490000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0543000000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6760000000',...
2025-07-16 03:35:54,499 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:55,361 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:55,366 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:56,376 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:56,381 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:56,768 - DEBUG - app.firebase_stream - Firebase listener triggered (36). Event Type: patch, Path: /. Timestamp: 1752662156.768646
2025-07-16 03:35:56,769 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'XAGUSD': {'b': '38.0580000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0543500000',
2025-07-16 03:35:56,771 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'XAGUSD': {'b': '38.0580000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0543500000',...
2025-07-16 03:35:56,772 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:57,392 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:57,397 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:58,413 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:58,417 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:35:59,003 - DEBUG - app.firebase_stream - Firebase listener triggered (37). Event Type: patch, Path: /. Timestamp: 1752662159.0034862
2025-07-16 03:35:59,003 - DEBUG - app.firebase_stream - Prepared batch update for 17 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0647000000', 'o': '13.0621000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541800000'}, 'USDJPY': {'b': '148.6740000000', 'o': '148.6700000000'}, 'EURNZD': {'b': '1.9549100000',
2025-07-16 03:35:59,004 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0647000000', 'o': '13.0621000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541800000'}, 'USDJPY': {'b': '148.6740000000', 'o': '148.6700000000'}, 'EURNZD': {'b': '1.9549100000',...
2025-07-16 03:35:59,004 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:35:59,425 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:35:59,430 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:00,448 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:00,452 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:01,368 - DEBUG - app.firebase_stream - Firebase listener triggered (38). Event Type: patch, Path: /. Timestamp: 1752662161.368538
2025-07-16 03:36:01,369 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542300000', 'o': '2.0541800000'}, 'USDJPY': {'b': '148.6780000000',
2025-07-16 03:36:01,369 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542300000', 'o': '2.0541800000'}, 'USDJPY': {'b': '148.6780000000',...
2025-07-16 03:36:01,369 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:01,456 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:01,463 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:02,482 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:02,485 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:03,503 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:03,507 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:03,617 - DEBUG - app.firebase_stream - Firebase listener triggered (39). Event Type: patch, Path: /. Timestamp: 1752662163.6168
2025-07-16 03:36:03,617 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0639000000', 'o': '13.0614900000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3650000000'}, 'GBPAUD': {'b': '2.0542300000', 'o': '2.0540800000'}, 'USDJPY': {'b': '148.6810000000',
2025-07-16 03:36:03,617 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0639000000', 'o': '13.0614900000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3650000000'}, 'GBPAUD': {'b': '2.0542300000', 'o': '2.0540800000'}, 'USDJPY': {'b': '148.6810000000',...
2025-07-16 03:36:03,618 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:04,520 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:04,525 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:05,532 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:05,536 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:05,888 - DEBUG - app.firebase_stream - Firebase listener triggered (40). Event Type: patch, Path: /. Timestamp: 1752662165.8883562
2025-07-16 03:36:05,888 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616500000'}, 'XAGUSD': {'b': '38.0610000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3750000000', 'o': '88.3660000000'}, 'GBPAUD': {'b': '2.0542200000',
2025-07-16 03:36:05,890 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616500000'}, 'XAGUSD': {'b': '38.0610000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3750000000', 'o': '88.3660000000'}, 'GBPAUD': {'b': '2.0542200000',...
2025-07-16 03:36:05,890 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:06,549 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:06,554 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:07,556 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:07,560 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:08,227 - DEBUG - app.firebase_stream - Firebase listener triggered (41). Event Type: patch, Path: /. Timestamp: 1752662168.2277155
2025-07-16 03:36:08,228 - DEBUG - app.firebase_stream - Prepared batch update for 35 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0616500000'}, 'XAGUSD': {'b': '38.0610000000', 'o': '38.0560000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0540800000'}, 'USDJPY': {'b': '148.6780000000',
2025-07-16 03:36:08,229 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0616500000'}, 'XAGUSD': {'b': '38.0610000000', 'o': '38.0560000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0540800000'}, 'USDJPY': {'b': '148.6780000000',...
2025-07-16 03:36:08,229 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:08,573 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:08,578 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:09,596 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:09,601 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:10,475 - DEBUG - app.firebase_stream - Firebase listener triggered (42). Event Type: patch, Path: /. Timestamp: 1752662170.475691
2025-07-16 03:36:10,476 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0617600000'}, 'XAGUSD': {'b': '38.0590000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3760000000', 'o': '88.3670000000'}, 'GBPAUD': {'b': '2.0542300000',
2025-07-16 03:36:10,476 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0617600000'}, 'XAGUSD': {'b': '38.0590000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3760000000', 'o': '88.3670000000'}, 'GBPAUD': {'b': '2.0542300000',...
2025-07-16 03:36:10,476 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:10,604 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:10,608 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:11,617 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:11,620 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:12,626 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:12,629 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:12,829 - DEBUG - app.firebase_stream - Firebase listener triggered (43). Event Type: patch, Path: /. Timestamp: 1752662172.8292618
2025-07-16 03:36:12,829 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0617600000'}, 'XAGUSD': {'b': '38.0590000000', 'o': '38.0570000000'}, 'GBPAUD': {'b': '2.0542200000', 'o': '2.0540600000'}, 'USDJPY': {'b': '148.6920000000',
2025-07-16 03:36:12,830 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0617600000'}, 'XAGUSD': {'b': '38.0590000000', 'o': '38.0570000000'}, 'GBPAUD': {'b': '2.0542200000', 'o': '2.0540600000'}, 'USDJPY': {'b': '148.6920000000',...
2025-07-16 03:36:12,830 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:13,641 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:13,644 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:14,651 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:14,654 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:15,089 - DEBUG - app.firebase_stream - Firebase listener triggered (44). Event Type: patch, Path: /. Timestamp: 1752662175.0897102
2025-07-16 03:36:15,090 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0617600000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540400000'}, 'USDJPY': {'b': '148.6910000000',
2025-07-16 03:36:15,091 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0617600000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540400000'}, 'USDJPY': {'b': '148.6910000000',...
2025-07-16 03:36:15,091 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:15,663 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:15,666 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:16,675 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:16,678 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:17,443 - DEBUG - app.firebase_stream - Firebase listener triggered (45). Event Type: patch, Path: /. Timestamp: 1752662177.4439452
2025-07-16 03:36:17,444 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0639000000', 'o': '13.0613700000'}, 'NZDJPY': {'b': '88.3760000000', 'o': '88.3680000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540100000'}, 'USDJPY': {'b': '148.6940000000',
2025-07-16 03:36:17,444 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0639000000', 'o': '13.0613700000'}, 'NZDJPY': {'b': '88.3760000000', 'o': '88.3680000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540100000'}, 'USDJPY': {'b': '148.6940000000',...
2025-07-16 03:36:17,444 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:17,680 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:17,682 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:18,697 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:18,700 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:19,622 - DEBUG - app.firebase_stream - Firebase listener triggered (46). Event Type: patch, Path: /. Timestamp: 1752662179.6227071
2025-07-16 03:36:19,623 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0647000000', 'o': '13.0621000000'}, 'NZDJPY': {'b': '88.3780000000', 'o': '88.3690000000'}, 'GBPAUD': {'b': '2.0541700000', 'o': '2.0540000000'}, 'USDJPY': {'b': '148.6950000000',
2025-07-16 03:36:19,623 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0647000000', 'o': '13.0621000000'}, 'NZDJPY': {'b': '88.3780000000', 'o': '88.3690000000'}, 'GBPAUD': {'b': '2.0541700000', 'o': '2.0540000000'}, 'USDJPY': {'b': '148.6950000000',...
2025-07-16 03:36:19,624 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:19,704 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:19,718 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:20,743 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:20,746 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:21,748 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:21,751 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:21,954 - DEBUG - app.firebase_stream - Firebase listener triggered (47). Event Type: patch, Path: /. Timestamp: 1752662181.954463
2025-07-16 03:36:21,954 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3820000000', 'o': '88.3740000000'}, 'BTCUSD': {'b': '118968.2000000000', 'o': '118968.1000000000'}, 'USDJPY': {'b': '148.68
2025-07-16 03:36:21,955 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3820000000', 'o': '88.3740000000'}, 'BTCUSD': {'b': '118968.2000000000', 'o': '118968.1000000000'}, 'USDJPY': {'b': '148.68...
2025-07-16 03:36:21,955 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:22,753 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:22,756 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:23,764 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:23,767 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:24,196 - DEBUG - app.firebase_stream - Firebase listener triggered (48). Event Type: patch, Path: /. Timestamp: 1752662184.196626
2025-07-16 03:36:24,196 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0646000000', 'o': '13.0620000000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3800000000', 'o': '88.3710000000'}, 'GBPAUD': {'b': '2.0541600000',
2025-07-16 03:36:24,197 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0646000000', 'o': '13.0620000000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'NZDJPY': {'b': '88.3800000000', 'o': '88.3710000000'}, 'GBPAUD': {'b': '2.0541600000',...
2025-07-16 03:36:24,197 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:24,779 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:24,783 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:25,796 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:25,800 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:26,556 - DEBUG - app.firebase_stream - Firebase listener triggered (49). Event Type: patch, Path: /. Timestamp: 1752662186.5566206
2025-07-16 03:36:26,557 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623000000'}, 'XAGUSD': {'b': '38.0620000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3770000000', 'o': '88.3700000000'}, 'GBPAUD': {'b': '2.0542100000',
2025-07-16 03:36:26,557 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623000000'}, 'XAGUSD': {'b': '38.0620000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3770000000', 'o': '88.3700000000'}, 'GBPAUD': {'b': '2.0542100000',...
2025-07-16 03:36:26,557 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:26,802 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:26,805 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:27,811 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:27,815 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:28,814 - DEBUG - app.firebase_stream - Firebase listener triggered (50). Event Type: patch, Path: /. Timestamp: 1752662188.814851
2025-07-16 03:36:28,815 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0648000000', 'o': '13.0622000000'}, 'NZDJPY': {'b': '88.3770000000', 'o': '88.3690000000'}, 'GBPAUD': {'b': '2.0542500000', 'o': '2.0541100000'}, 'USDJPY': {'b': '148.6890000000',
2025-07-16 03:36:28,816 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0648000000', 'o': '13.0622000000'}, 'NZDJPY': {'b': '88.3770000000', 'o': '88.3690000000'}, 'GBPAUD': {'b': '2.0542500000', 'o': '2.0541100000'}, 'USDJPY': {'b': '148.6890000000',...
2025-07-16 03:36:28,817 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:28,821 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:28,843 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:29,867 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:29,870 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:30,873 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:30,876 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:31,160 - DEBUG - app.firebase_stream - Firebase listener triggered (51). Event Type: patch, Path: /. Timestamp: 1752662191.1600652
2025-07-16 03:36:31,160 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0647000000', 'o': '13.0621000000'}, 'XAGUSD': {'b': '38.0610000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3770000000', 'o': '88.3680000000'}, 'GBPAUD': {'b': '2.0541700000',
2025-07-16 03:36:31,161 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0647000000', 'o': '13.0621000000'}, 'XAGUSD': {'b': '38.0610000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3770000000', 'o': '88.3680000000'}, 'GBPAUD': {'b': '2.0541700000',...
2025-07-16 03:36:31,161 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:31,880 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:31,883 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:32,888 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:32,891 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:33,418 - DEBUG - app.firebase_stream - Firebase listener triggered (52). Event Type: patch, Path: /. Timestamp: 1752662193.4187174
2025-07-16 03:36:33,419 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0645000000', 'o': '13.0620100000'}, 'NZDJPY': {'b': '88.3700000000', 'o': '88.3630000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0541200000'}, 'BTCUSD': {'b': '118968.300000000
2025-07-16 03:36:33,419 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0645000000', 'o': '13.0620100000'}, 'NZDJPY': {'b': '88.3700000000', 'o': '88.3630000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0541200000'}, 'BTCUSD': {'b': '118968.300000000...
2025-07-16 03:36:33,420 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:33,907 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:33,911 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:34,918 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:34,921 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:35,762 - DEBUG - app.firebase_stream - Firebase listener triggered (53). Event Type: patch, Path: /. Timestamp: 1752662195.7625558
2025-07-16 03:36:35,762 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623400000'}, 'GBPAUD': {'b': '2.0542700000', 'o': '2.0541100000'}, 'CADCHF': {'b': '0.5842900000', 'o': '0.5842400000'}, 'EURNZD': {'b': '1.9548900000', 'o'
2025-07-16 03:36:35,763 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623400000'}, 'GBPAUD': {'b': '2.0542700000', 'o': '2.0541100000'}, 'CADCHF': {'b': '0.5842900000', 'o': '0.5842400000'}, 'EURNZD': {'b': '1.9548900000', 'o'...
2025-07-16 03:36:35,763 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:35,923 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:35,925 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:36,851 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-16 03:36:36,851 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-16 03:36:36,860 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-16 03:36:36,860 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-16 03:36:36,860 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-16 03:36:36,860 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (live) from cache/DB...
2025-07-16 03:36:36,861 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:36,881 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:36:36,885 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:36:36,885 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:36:36,888 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:36:36,888 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:36,888 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-16 03:36:36,888 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (live) from cache/DB...
2025-07-16 03:36:36,893 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-16 03:36:36,893 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-16 03:36:36,893 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 8 (live) from cache/DB...
2025-07-16 03:36:36,894 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:36:36,903 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 8.
2025-07-16 03:36:36,904 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-16 03:36:36,904 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (live) from cache/DB...
2025-07-16 03:36:36,904 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:36:36,927 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:36:36,928 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:36,932 - DEBUG - app - [AUTO-CUTOFF] User 9 has 1 open orders.
2025-07-16 03:36:36,932 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:36:36,933 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:36,935 - DEBUG - app - [AUTO-CUTOFF] User 9 has 0 pending orders.
2025-07-16 03:36:36,935 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 1
2025-07-16 03:36:37,013 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.52305'), 'sell': Decimal('0.52281')}, 'GBPNOK': {'buy': Decimal('13.798499999999999'), 'sell': Decimal('13.796100000000001')}, 'AUDJPY': {'buy': Decimal('97.012'), 'sell': Decimal('96.977')}, 'EURJPY': {'buy': Decimal('172.75799999999998'), 'sell': Decimal('172.72400000000002')}, 'XAGUSD': {'buy': Decimal('38.076'), 'sell': Decimal('38.043')}, 'EURCAD': {'buy': Decimal('1.5941349999999999'), 'sell': Decimal('1.593885')}, 'GBPUSD': {'buy': Decimal('1.340125'), 'sell': Decimal('1.3399649999999999')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.74902'), 'sell': Decimal('9.74804')}, 'JP225': {'buy': Decimal('39574.29'), 'sell': Decimal('39570.29')}, 'GBPSEK': {'buy': Decimal('13.0651'), 'sell': Decimal('13.062140000000001')}, 'EURUSD': {'buy': Decimal('1.161905'), 'sell': Decimal('1.161665')}, 'AUDCAD': {'buy': Decimal('0.89515'), 'sell': Decimal('0.89492')}, 'D30': {'buy': Decimal('24130.02'), 'sell': Decimal('24129.02')}, 'CHFSGD': {'buy': Decimal('1.6029049999999998'), 'sell': Decimal('1.6024450000000001')}, 'USDJPY': {'buy': Decimal('148.7'), 'sell': Decimal('148.675')}, 'EURNOK': {'buy': Decimal('11.962825'), 'sell': Decimal('11.961105')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652215')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.9311200000000001')}, 'GBPAUD': {'buy': Decimal('2.054395'), 'sell': Decimal('2.053985')}, 'EURGBP': {'buy': Decimal('0.8671300000000001'), 'sell': Decimal('0.86681')}, 'EURNZD': {'buy': Decimal('1.955065'), 'sell': Decimal('1.954545')}, 'EURSEK': {'buy': Decimal('11.326885'), 'sell': Decimal('11.324805')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58443'), 'sell': Decimal('0.5841')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.8015')}, 'USDCNH': {'buy': Decimal('7.183025'), 'sell': Decimal('7.182665')}, 'NZDUSD': {'buy': Decimal('0.59442'), 'sell': Decimal('0.59421')}, 'NZDJPY': {'buy': Decimal('88.385'), 'sell': Decimal('88.348')}, 'EURSGD': {'buy': Decimal('1.49276'), 'sell': Decimal('1.49237')}, 'CADJPY': {'buy': Decimal('108.389'), 'sell': Decimal('108.35300000000001')}, 'USDCZK': {'buy': Decimal('21.2415'), 'sell': Decimal('21.1765')}, 'US30': {'buy': Decimal('44044.5'), 'sell': Decimal('44042.4')}, 'GBPNZD': {'buy': Decimal('2.254995'), 'sell': Decimal('2.254515')}, 'CHFJPY': {'buy': Decimal('185.505'), 'sell': Decimal('185.465')}, 'BTCUSD': {'buy': Decimal('119018.3'), 'sell': Decimal('118918.2')}, 'USDSGD': {'buy': Decimal('1.2848849999999998'), 'sell': Decimal('1.284585')}, 'NOKSEK': {'buy': Decimal('0.947125'), 'sell': Decimal('0.946495')}, 'EURPLN': {'buy': Decimal('4.2565800000000005'), 'sell': Decimal('4.25561')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78109'), 'sell': Decimal('1.78076')}, 'SGDJPY': {'buy': Decimal('115.763'), 'sell': Decimal('115.71')}, 'EURZAR': {'buy': Decimal('20.813370000000003'), 'sell': Decimal('20.80651')}, 'USDTRY': {'buy': Decimal('40.2594700000'), 'sell': Decimal('40.2579300000')}, 'USDNOK': {'buy': Decimal('10.2967'), 'sell': Decimal('10.29566')}, 'USDZAR': {'buy': Decimal('17.915225'), 'sell': Decimal('17.909295')}, 'NZDCAD': {'buy': Decimal('0.81553'), 'sell': Decimal('0.81526')}, 'USDCAD': {'buy': Decimal('1.3722'), 'sell': Decimal('1.37194')}}
2025-07-16 03:36:37,013 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:36:37,013 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:36:37,403 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141921.60000000, Current=118918.2, Quantity=0.41000000, Contract Size=1.00000000, PnL=-9431.394000000000000000000000, PnL USD=-9431.394000000000000000000000, Commission=244.35000000, Final PnL=-9675.744000000000000000000000
2025-07-16 03:36:37,403 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.213872537569500899138397953% which is below threshold 100.0%
2025-07-16 03:36:37,403 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '9794.75000000', 'equity': '119.006000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9684.824000000000000000000000', 'profit_loss': '-9675.744000000000000000000000', 'margin_level': '1.213872537569500899138397953', 'positions': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9675.744000000000000000000000', 'current_price': '118918.2'}], 'margin_call': True}
2025-07-16 03:36:37,404 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '9794.75000000', 'equity': '119.006000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9684.824000000000000000000000', 'profit_loss': '-9675.744000000000000000000000', 'margin_level': '1.213872537569500899138397953', 'positions_with_pnl': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9675.744000000000000000000000', 'current_price': '118918.2'}], 'margin_call': True}
2025-07-16 03:36:37,404 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 1.213872537569500899138397953
2025-07-16 03:36:37,430 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:36:37,430 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-16 03:36:37,431 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (live) from cache/DB...
2025-07-16 03:36:37,431 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:37,464 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:36:37,467 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:36:37,467 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:36:37,470 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 pending orders.
2025-07-16 03:36:37,470 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:37,470 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-16 03:36:37,470 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (live) from cache/DB...
2025-07-16 03:36:37,471 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:37,495 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:36:37,499 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 open orders.
2025-07-16 03:36:37,499 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:36:37,502 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:36:37,502 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:37,502 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-16 03:36:37,502 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (live) from cache/DB...
2025-07-16 03:36:37,503 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:36:37,525 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:36:37,528 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:36:37,528 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:36:37,531 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:36:37,531 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:37,531 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-16 03:36:37,531 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (live) from cache/DB...
2025-07-16 03:36:37,532 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:37,555 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:36:37,558 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:36:37,558 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:36:37,561 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:36:37,561 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:37,562 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-16 03:36:37,562 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 14 (live) from cache/DB...
2025-07-16 03:36:37,562 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:36:37,585 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 14...
2025-07-16 03:36:37,589 - DEBUG - app - [AUTO-CUTOFF] User 14 has 3 open orders.
2025-07-16 03:36:37,590 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 14...
2025-07-16 03:36:37,593 - DEBUG - app - [AUTO-CUTOFF] User 14 has 0 pending orders.
2025-07-16 03:36:37,593 - DEBUG - app - [AUTO-CUTOFF] User 14 total positions for portfolio calculation: 3
2025-07-16 03:36:37,670 - DEBUG - app - [AUTO-CUTOFF] User 14 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.52305'), 'sell': Decimal('0.52281')}, 'GBPNOK': {'buy': Decimal('13.798499999999999'), 'sell': Decimal('13.796100000000001')}, 'AUDJPY': {'buy': Decimal('97.012'), 'sell': Decimal('96.977')}, 'EURJPY': {'buy': Decimal('172.75799999999998'), 'sell': Decimal('172.72400000000002')}, 'XAGUSD': {'buy': Decimal('38.076'), 'sell': Decimal('38.043')}, 'EURCAD': {'buy': Decimal('1.5941349999999999'), 'sell': Decimal('1.593885')}, 'GBPUSD': {'buy': Decimal('1.340125'), 'sell': Decimal('1.3399649999999999')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.74902'), 'sell': Decimal('9.74804')}, 'JP225': {'buy': Decimal('39574.29'), 'sell': Decimal('39570.29')}, 'GBPSEK': {'buy': Decimal('13.0651'), 'sell': Decimal('13.062140000000001')}, 'EURUSD': {'buy': Decimal('1.161905'), 'sell': Decimal('1.161665')}, 'AUDCAD': {'buy': Decimal('0.89515'), 'sell': Decimal('0.89492')}, 'D30': {'buy': Decimal('24130.02'), 'sell': Decimal('24129.02')}, 'CHFSGD': {'buy': Decimal('1.6029049999999998'), 'sell': Decimal('1.6024450000000001')}, 'USDJPY': {'buy': Decimal('148.7'), 'sell': Decimal('148.675')}, 'EURNOK': {'buy': Decimal('11.962825'), 'sell': Decimal('11.961105')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652215')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.9311200000000001')}, 'GBPAUD': {'buy': Decimal('2.054395'), 'sell': Decimal('2.053985')}, 'EURGBP': {'buy': Decimal('0.8671300000000001'), 'sell': Decimal('0.86681')}, 'EURNZD': {'buy': Decimal('1.955065'), 'sell': Decimal('1.954545')}, 'EURSEK': {'buy': Decimal('11.326885'), 'sell': Decimal('11.324805')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58443'), 'sell': Decimal('0.5841')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.8015')}, 'USDCNH': {'buy': Decimal('7.183025'), 'sell': Decimal('7.182665')}, 'NZDUSD': {'buy': Decimal('0.59442'), 'sell': Decimal('0.59421')}, 'NZDJPY': {'buy': Decimal('88.385'), 'sell': Decimal('88.348')}, 'EURSGD': {'buy': Decimal('1.49276'), 'sell': Decimal('1.49237')}, 'CADJPY': {'buy': Decimal('108.389'), 'sell': Decimal('108.35300000000001')}, 'USDCZK': {'buy': Decimal('21.2415'), 'sell': Decimal('21.1765')}, 'US30': {'buy': Decimal('44044.5'), 'sell': Decimal('44042.4')}, 'GBPNZD': {'buy': Decimal('2.254995'), 'sell': Decimal('2.254515')}, 'CHFJPY': {'buy': Decimal('185.505'), 'sell': Decimal('185.465')}, 'BTCUSD': {'buy': Decimal('119018.3'), 'sell': Decimal('118918.2')}, 'USDSGD': {'buy': Decimal('1.2848849999999998'), 'sell': Decimal('1.284585')}, 'NOKSEK': {'buy': Decimal('0.947125'), 'sell': Decimal('0.946495')}, 'EURPLN': {'buy': Decimal('4.2565800000000005'), 'sell': Decimal('4.25561')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78109'), 'sell': Decimal('1.78076')}, 'SGDJPY': {'buy': Decimal('115.763'), 'sell': Decimal('115.71')}, 'EURZAR': {'buy': Decimal('20.813370000000003'), 'sell': Decimal('20.80651')}, 'USDTRY': {'buy': Decimal('40.2594700000'), 'sell': Decimal('40.2579300000')}, 'USDNOK': {'buy': Decimal('10.2967'), 'sell': Decimal('10.29566')}, 'USDZAR': {'buy': Decimal('17.915225'), 'sell': Decimal('17.909295')}, 'NZDCAD': {'buy': Decimal('0.81553'), 'sell': Decimal('0.81526')}, 'USDCAD': {'buy': Decimal('1.3722'), 'sell': Decimal('1.37194')}}
2025-07-16 03:36:37,670 - DEBUG - app - [AUTO-CUTOFF] User 14 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:36:37,671 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-16 03:36:38,007 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141908.50000000, Current=118918.2, Quantity=0.40000000, Contract Size=1.00000000, PnL=-9196.120000000000000000000000, PnL USD=-9196.120000000000000000000000, Commission=235.57000000, Final PnL=-9431.690000000000000000000000
2025-07-16 03:36:38,007 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:38,008 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.977, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-1200.000000000000000000000000, PnL USD=-8.070482211312125899522496469, Commission=1.00000000, Final PnL=-9.070482211312125899522496469
2025-07-16 03:36:38,010 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.977, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-120.000000000000000000000000, PnL USD=-0.8070482211312125899522496469, Commission=0.10000000, Final PnL=-0.9070482211312125899522496469
2025-07-16 03:36:38,010 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.848637886765208184453953238% which is below threshold 100.0%
2025-07-16 03:36:38,010 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '460.352469567556661510525254', 'margin': '9494.47000000', 'free_margin': '-9034.117530432443338489474746', 'profit_loss': '-9441.667530432443338489474746', 'margin_level': '4.848637886765208184453953238', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9431.690000000000000000000000', 'current_price': '118918.2'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9.070482211312125899522496469', 'current_price': '96.977'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-0.9070482211312125899522496469', 'current_price': '96.977'}], 'margin_call': True}
2025-07-16 03:36:38,010 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 14: {'balance': '9902.02000000', 'equity': '460.352469567556661510525254', 'margin': '9494.47000000', 'free_margin': '-9034.117530432443338489474746', 'profit_loss': '-9441.667530432443338489474746', 'margin_level': '4.848637886765208184453953238', 'positions_with_pnl': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9431.690000000000000000000000', 'current_price': '118918.2'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9.070482211312125899522496469', 'current_price': '96.977'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-0.9070482211312125899522496469', 'current_price': '96.977'}], 'margin_call': True}
2025-07-16 03:36:38,011 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:38,012 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.848637886765208184453953238
2025-07-16 03:36:38,041 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-16 03:36:38,042 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-16 03:36:38,042 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 16 (live) from cache/DB...
2025-07-16 03:36:38,043 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:36:38,074 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 16...
2025-07-16 03:36:38,078 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 open orders.
2025-07-16 03:36:38,078 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 16...
2025-07-16 03:36:38,081 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 pending orders.
2025-07-16 03:36:38,081 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,081 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-16 03:36:38,081 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 17 (live) from cache/DB...
2025-07-16 03:36:38,082 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:38,104 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 17...
2025-07-16 03:36:38,107 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 open orders.
2025-07-16 03:36:38,107 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 17...
2025-07-16 03:36:38,110 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 pending orders.
2025-07-16 03:36:38,110 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,116 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-16 03:36:38,116 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 18 (live) from cache/DB...
2025-07-16 03:36:38,126 - DEBUG - app.firebase_stream - Firebase listener triggered (54). Event Type: patch, Path: /. Timestamp: 1752662198.1267586
2025-07-16 03:36:38,127 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3740000000', 'o': '88.3660000000'}, 'GBPAUD': {'b': '2.0542000000', 'o': '2.0540600000'}, 'USDJPY': {'b': '148.6890000000', 'o': '148.6840000000'}, 'CADCHF': {'b': '0.5843000000',
2025-07-16 03:36:38,127 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:38,128 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3740000000', 'o': '88.3660000000'}, 'GBPAUD': {'b': '2.0542000000', 'o': '2.0540600000'}, 'USDJPY': {'b': '148.6890000000', 'o': '148.6840000000'}, 'CADCHF': {'b': '0.5843000000',...
2025-07-16 03:36:38,128 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:38,233 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 18...
2025-07-16 03:36:38,236 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 open orders.
2025-07-16 03:36:38,237 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 18...
2025-07-16 03:36:38,240 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 pending orders.
2025-07-16 03:36:38,240 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,240 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-16 03:36:38,240 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 19 (live) from cache/DB...
2025-07-16 03:36:38,241 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Elite...
2025-07-16 03:36:38,264 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 19...
2025-07-16 03:36:38,268 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 open orders.
2025-07-16 03:36:38,268 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 19...
2025-07-16 03:36:38,271 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 pending orders.
2025-07-16 03:36:38,271 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,271 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-16 03:36:38,271 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 20 (live) from cache/DB...
2025-07-16 03:36:38,272 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:36:38,293 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 20...
2025-07-16 03:36:38,297 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 open orders.
2025-07-16 03:36:38,298 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 20...
2025-07-16 03:36:38,301 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 pending orders.
2025-07-16 03:36:38,301 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,301 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-16 03:36:38,301 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 21 (live) from cache/DB...
2025-07-16 03:36:38,302 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:38,324 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 21...
2025-07-16 03:36:38,328 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 open orders.
2025-07-16 03:36:38,328 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 21...
2025-07-16 03:36:38,331 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 pending orders.
2025-07-16 03:36:38,331 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,331 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-16 03:36:38,331 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 22 (live) from cache/DB...
2025-07-16 03:36:38,332 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group VIP...
2025-07-16 03:36:38,355 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 22...
2025-07-16 03:36:38,359 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 open orders.
2025-07-16 03:36:38,359 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 22...
2025-07-16 03:36:38,362 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 pending orders.
2025-07-16 03:36:38,362 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,362 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-16 03:36:38,362 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 23 (live) from cache/DB...
2025-07-16 03:36:38,363 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:38,382 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 23...
2025-07-16 03:36:38,385 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 open orders.
2025-07-16 03:36:38,386 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 23...
2025-07-16 03:36:38,388 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 pending orders.
2025-07-16 03:36:38,388 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,388 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-16 03:36:38,388 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 25 (live) from cache/DB...
2025-07-16 03:36:38,389 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:38,410 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 25...
2025-07-16 03:36:38,413 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 open orders.
2025-07-16 03:36:38,413 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 25...
2025-07-16 03:36:38,418 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 pending orders.
2025-07-16 03:36:38,418 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:38,418 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-16 03:36:38,418 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 26 (live) from cache/DB...
2025-07-16 03:36:38,419 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Royal+...
2025-07-16 03:36:38,443 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 26...
2025-07-16 03:36:38,447 - DEBUG - app - [AUTO-CUTOFF] User 26 has 2 open orders.
2025-07-16 03:36:38,447 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 26...
2025-07-16 03:36:38,451 - DEBUG - app - [AUTO-CUTOFF] User 26 has 0 pending orders.
2025-07-16 03:36:38,451 - DEBUG - app - [AUTO-CUTOFF] User 26 total positions for portfolio calculation: 2
2025-07-16 03:36:38,507 - DEBUG - app - [AUTO-CUTOFF] User 26 adjusted market prices: {'EURSGD': {'buy': Decimal('1.49274'), 'sell': Decimal('1.49238')}, 'USDCNH': {'buy': Decimal('7.18301'), 'sell': Decimal('7.1826799999999995')}, 'BTCUSD': {'buy': Decimal('119018.3'), 'sell': Decimal('118918.2')}, 'USDSEK': {'buy': Decimal('9.748885000000001'), 'sell': Decimal('9.748395')}, 'AUDJPY': {'buy': Decimal('97.0145'), 'sell': Decimal('96.98349999999999')}, 'EURNOK': {'buy': Decimal('11.962825'), 'sell': Decimal('11.961105')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.80152')}, 'USDTRY': {'buy': Decimal('40.2594700000'), 'sell': Decimal('40.2579300000')}, 'NZDCAD': {'buy': Decimal('0.81555'), 'sell': Decimal('0.8152999999999999')}, 'GBPAUD': {'buy': Decimal('2.0543'), 'sell': Decimal('2.05396')}, 'EURCHF': {'buy': Decimal('0.93147'), 'sell': Decimal('0.93113')}, 'EURNZD': {'buy': Decimal('1.955'), 'sell': Decimal('1.95457')}, 'USDCZK': {'buy': Decimal('21.24'), 'sell': Decimal('21.178')}, 'EURCAD': {'buy': Decimal('1.5941049999999999'), 'sell': Decimal('1.593855')}, 'EURSEK': {'buy': Decimal('11.326885'), 'sell': Decimal('11.324805')}, 'CHFSGD': {'buy': Decimal('1.6029049999999998'), 'sell': Decimal('1.6024450000000001')}, 'EURGBP': {'buy': Decimal('0.86712'), 'sell': Decimal('0.8668100000000001')}, 'NZDJPY': {'buy': Decimal('88.3865'), 'sell': Decimal('88.3535')}, 'AUDUSD': {'buy': Decimal('0.6525150000000001'), 'sell': Decimal('0.652245')}, 'EURAUD': {'buy': Decimal('1.781015'), 'sell': Decimal('1.780665')}, 'GBPNZD': {'buy': Decimal('2.25489'), 'sell': Decimal('2.2544999999999997')}, 'GBPSEK': {'buy': Decimal('13.065075'), 'sell': Decimal('13.062165')}, 'SGDJPY': {'buy': Decimal('115.759'), 'sell': Decimal('115.71')}, 'EURZAR': {'buy': Decimal('20.813345'), 'sell': Decimal('20.806535')}, 'NOKSEK': {'buy': Decimal('0.947125'), 'sell': Decimal('0.946495')}, 'USDNOK': {'buy': Decimal('10.296865'), 'sell': Decimal('10.295874999999999')}, 'USDJPY': {'buy': Decimal('148.6965'), 'sell': Decimal('148.6765')}, 'USDZAR': {'buy': Decimal('17.91536'), 'sell': Decimal('17.909319999999997')}, 'AUDCAD': {'buy': Decimal('0.895155'), 'sell': Decimal('0.894975')}, 'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.16167')}, 'NZDUSD': {'buy': Decimal('0.59442'), 'sell': Decimal('0.59421')}, 'EURJPY': {'buy': Decimal('172.756'), 'sell': Decimal('172.725')}, 'CHFJPY': {'buy': Decimal('185.5025'), 'sell': Decimal('185.4575')}, 'USDCAD': {'buy': Decimal('1.37217'), 'sell': Decimal('1.37195')}, 'AUDCHF': {'buy': Decimal('0.523065'), 'sell': Decimal('0.5228649999999999')}, 'GBPNOK': {'buy': Decimal('13.798475'), 'sell': Decimal('13.796125')}, 'US30': {'buy': Decimal('44044.0'), 'sell': Decimal('44041.9')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'USDSGD': {'buy': Decimal('1.2848600000000001'), 'sell': Decimal('1.28459')}, 'XAGUSD': {'buy': Decimal('38.0735'), 'sell': Decimal('38.0455')}, 'D30': {'buy': Decimal('24130.02'), 'sell': Decimal('24129.02')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}, 'CADCHF': {'buy': Decimal('0.5844250000000001'), 'sell': Decimal('0.584125')}, 'GBPUSD': {'buy': Decimal('1.34012'), 'sell': Decimal('1.33999')}, 'CADJPY': {'buy': Decimal('108.3875'), 'sell': Decimal('108.3545')}, 'EURPLN': {'buy': Decimal('4.2565800000000005'), 'sell': Decimal('4.25561')}}
2025-07-16 03:36:38,507 - DEBUG - app - [AUTO-CUTOFF] User 26 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:36:38,507 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-16 03:36:38,825 - DEBUG - app.services.portfolio_calculator - Position calculation for XAGUSD: Type=BUY, Entry=41.09800000, Current=38.0455, Quantity=0.01000000, Contract Size=5000.00000000, PnL=-152.625000000000000000000000, PnL USD=-152.625000000000000000000000, Commission=0.10000000, Final PnL=-152.725000000000000000000000
2025-07-16 03:36:38,825 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=132091.90000000, Current=118918.2, Quantity=6.00000000, Contract Size=1.00000000, PnL=-79042.20000000000000000000000, PnL USD=-79042.20000000000000000000000, Commission=3661.62000000, Final PnL=-82703.82000000000000000000000
2025-07-16 03:36:38,825 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.28329330747484699231256392% which is below threshold 100.0%
2025-07-16 03:36:38,825 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101489.2650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-44995.2050000000000000000000', 'profit_loss': '-82856.54500000000000000000000', 'margin_level': '69.28329330747484699231256392', 'positions': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-152.725000000000000000000000', 'current_price': '38.0455'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-82703.82000000000000000000000', 'current_price': '118918.2'}], 'margin_call': True}
2025-07-16 03:36:38,826 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 26: {'balance': '184345.81000000', 'equity': '101489.2650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-44995.2050000000000000000000', 'profit_loss': '-82856.54500000000000000000000', 'margin_level': '69.28329330747484699231256392', 'positions_with_pnl': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-152.725000000000000000000000', 'current_price': '38.0455'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-82703.82000000000000000000000', 'current_price': '118918.2'}], 'margin_call': True}
2025-07-16 03:36:38,826 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.28329330747484699231256392
2025-07-16 03:36:38,827 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-16 03:36:38,827 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-16 03:36:38,827 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 1 (demo) from cache/DB...
2025-07-16 03:36:38,828 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:38,847 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 1...
2025-07-16 03:36:38,852 - DEBUG - app - [AUTO-CUTOFF] User 1 has 2 open orders.
2025-07-16 03:36:38,853 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 1...
2025-07-16 03:36:38,858 - DEBUG - app - [AUTO-CUTOFF] User 1 has 1 pending orders.
2025-07-16 03:36:38,859 - DEBUG - app - [AUTO-CUTOFF] User 1 total positions for portfolio calculation: 3
2025-07-16 03:36:38,924 - DEBUG - app - [AUTO-CUTOFF] User 1 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.16167')}, 'USDZAR': {'buy': Decimal('17.91535'), 'sell': Decimal('17.909329999999997')}, 'SGDJPY': {'buy': Decimal('115.7565'), 'sell': Decimal('115.71249999999999')}, 'GBPAUD': {'buy': Decimal('2.05435'), 'sell': Decimal('2.05391')}, 'USDNOK': {'buy': Decimal('10.29684'), 'sell': Decimal('10.2959')}, 'NZDCAD': {'buy': Decimal('0.81561'), 'sell': Decimal('0.81524')}, 'GBPNZD': {'buy': Decimal('2.25494'), 'sell': Decimal('2.25445')}, 'US30': {'buy': Decimal('44044.0'), 'sell': Decimal('44041.9')}, 'CHFJPY': {'buy': Decimal('185.505'), 'sell': Decimal('185.455')}, 'CADJPY': {'buy': Decimal('108.3875'), 'sell': Decimal('108.3545')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.2594700000'), 'sell': Decimal('40.2579300000')}, 'GBPSEK': {'buy': Decimal('13.06505'), 'sell': Decimal('13.062190000000001')}, 'GBPNOK': {'buy': Decimal('13.798449999999999'), 'sell': Decimal('13.79615')}, 'USDCNH': {'buy': Decimal('7.183'), 'sell': Decimal('7.18269')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.9311200000000001')}, 'XAGUSD': {'buy': Decimal('38.076'), 'sell': Decimal('38.043')}, 'BTCUSD': {'buy': Decimal('119018.3'), 'sell': Decimal('118918.2')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.9628'), 'sell': Decimal('11.96113')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.3719')}, 'NOKSEK': {'buy': Decimal('0.947075'), 'sell': Decimal('0.946545')}, 'CADCHF': {'buy': Decimal('0.5844250000000001'), 'sell': Decimal('0.584125')}, 'GBPUSD': {'buy': Decimal('1.34016'), 'sell': Decimal('1.33995')}, 'CHFSGD': {'buy': Decimal('1.6028749999999998'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.86714'), 'sell': Decimal('0.8667900000000001')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.05199999999999'), 'sell': Decimal('96.946')}, 'EURJPY': {'buy': Decimal('172.75449999999998'), 'sell': Decimal('172.72650000000002')}, 'AUDCHF': {'buy': Decimal('0.5231899999999999'), 'sell': Decimal('0.52274')}, 'EURZAR': {'buy': Decimal('20.813370000000003'), 'sell': Decimal('20.80651')}, 'USDCZK': {'buy': Decimal('21.244'), 'sell': Decimal('21.174')}, 'D30': {'buy': Decimal('24129.52'), 'sell': Decimal('24129.52')}, 'AUDUSD': {'buy': Decimal('0.65254'), 'sell': Decimal('0.65222')}, 'EURSEK': {'buy': Decimal('11.32686'), 'sell': Decimal('11.32483')}, 'NZDJPY': {'buy': Decimal('88.3865'), 'sell': Decimal('88.3535')}, 'USDSGD': {'buy': Decimal('1.2849000000000002'), 'sell': Decimal('1.2845499999999999')}, 'EURSGD': {'buy': Decimal('1.4927249999999999'), 'sell': Decimal('1.4923950000000001')}, 'NZDUSD': {'buy': Decimal('0.5944699999999999'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25657'), 'sell': Decimal('4.25562')}, 'AUDCAD': {'buy': Decimal('0.89508'), 'sell': Decimal('0.89505')}, 'EURCAD': {'buy': Decimal('1.59408'), 'sell': Decimal('1.59388')}, 'EURNZD': {'buy': Decimal('1.954975'), 'sell': Decimal('1.954595')}, 'USDSEK': {'buy': Decimal('9.74886'), 'sell': Decimal('9.748420000000001')}, 'USDJPY': {'buy': Decimal('148.739'), 'sell': Decimal('148.634')}, 'EURAUD': {'buy': Decimal('1.7810300000000001'), 'sell': Decimal('1.7806499999999998')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}}
2025-07-16 03:36:38,924 - DEBUG - app - [AUTO-CUTOFF] User 1 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:36:38,924 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-16 03:36:39,236 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=96.66800000, Current=96.946, Quantity=0.01000000, Contract Size=100000.00000000, PnL=278.000000000000000000000000, PnL USD=1.869674286598201615452387197, Commission=0.10000000, Final PnL=1.769674286598201615452387197
2025-07-16 03:36:39,236 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:39,239 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=SELL, Entry=96.56000000, Current=97.05199999999999, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-491.9999999999900000000000000, PnL USD=-3.308919960454303949855066616, Commission=0.10000000, Final PnL=-3.408919960454303949855066616
2025-07-16 03:36:39,240 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17011.54000000', 'equity': '17009.90075432614389766559732', 'margin': '6.54000000', 'free_margin': '17003.36075432614389766559732', 'profit_loss': '-1.639245673856102334402679419', 'margin_level': '260090.2256013171849795962893', 'positions': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.769674286598201615452387197', 'current_price': '96.946'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.408919960454303949855066616', 'current_price': '97.05199999999999'}], 'margin_call': False}
2025-07-16 03:36:39,240 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 1: {'balance': '17011.54000000', 'equity': '17009.90075432614389766559732', 'margin': '6.54000000', 'free_margin': '17003.36075432614389766559732', 'profit_loss': '-1.639245673856102334402679419', 'margin_level': '260090.2256013171849795962893', 'positions_with_pnl': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.769674286598201615452387197', 'current_price': '96.946'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.408919960454303949855066616', 'current_price': '97.05199999999999'}], 'margin_call': False}
2025-07-16 03:36:39,241 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:39,242 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 260090.2256013171849795962893
2025-07-16 03:36:39,243 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-16 03:36:39,243 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-16 03:36:39,243 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 2 (demo) from cache/DB...
2025-07-16 03:36:39,243 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-16 03:36:39,243 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-16 03:36:39,243 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 3 (demo) from cache/DB...
2025-07-16 03:36:39,244 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:36:39,251 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 3.
2025-07-16 03:36:39,251 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-16 03:36:39,251 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (demo) from cache/DB...
2025-07-16 03:36:39,252 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:39,277 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:36:39,282 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:36:39,282 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:36:39,286 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:36:39,286 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:39,286 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-16 03:36:39,286 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (demo) from cache/DB...
2025-07-16 03:36:39,287 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-16 03:36:39,288 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-16 03:36:39,288 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 6 (demo) from cache/DB...
2025-07-16 03:36:39,288 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-16 03:36:39,289 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-16 03:36:39,289 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (demo) from cache/DB...
2025-07-16 03:36:39,290 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:39,315 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:36:39,321 - DEBUG - app - [AUTO-CUTOFF] User 9 has 28 open orders.
2025-07-16 03:36:39,321 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:36:39,327 - DEBUG - app - [AUTO-CUTOFF] User 9 has 6 pending orders.
2025-07-16 03:36:39,327 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 34
2025-07-16 03:36:39,401 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.16167')}, 'USDZAR': {'buy': Decimal('17.91535'), 'sell': Decimal('17.909329999999997')}, 'SGDJPY': {'buy': Decimal('115.7565'), 'sell': Decimal('115.71249999999999')}, 'GBPAUD': {'buy': Decimal('2.05435'), 'sell': Decimal('2.05391')}, 'USDNOK': {'buy': Decimal('10.29684'), 'sell': Decimal('10.2959')}, 'NZDCAD': {'buy': Decimal('0.81561'), 'sell': Decimal('0.81524')}, 'GBPNZD': {'buy': Decimal('2.25494'), 'sell': Decimal('2.25445')}, 'US30': {'buy': Decimal('44044.0'), 'sell': Decimal('44041.9')}, 'CHFJPY': {'buy': Decimal('185.505'), 'sell': Decimal('185.455')}, 'CADJPY': {'buy': Decimal('108.3875'), 'sell': Decimal('108.3545')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.2594700000'), 'sell': Decimal('40.2579300000')}, 'GBPSEK': {'buy': Decimal('13.06505'), 'sell': Decimal('13.062190000000001')}, 'GBPNOK': {'buy': Decimal('13.798449999999999'), 'sell': Decimal('13.79615')}, 'USDCNH': {'buy': Decimal('7.183'), 'sell': Decimal('7.18269')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.9311200000000001')}, 'XAGUSD': {'buy': Decimal('38.076'), 'sell': Decimal('38.043')}, 'BTCUSD': {'buy': Decimal('119018.3'), 'sell': Decimal('118918.2')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.9628'), 'sell': Decimal('11.96113')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.3719')}, 'NOKSEK': {'buy': Decimal('0.947075'), 'sell': Decimal('0.946545')}, 'CADCHF': {'buy': Decimal('0.5844250000000001'), 'sell': Decimal('0.584125')}, 'GBPUSD': {'buy': Decimal('1.34016'), 'sell': Decimal('1.33995')}, 'CHFSGD': {'buy': Decimal('1.6028749999999998'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.86714'), 'sell': Decimal('0.8667900000000001')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.05199999999999'), 'sell': Decimal('96.946')}, 'EURJPY': {'buy': Decimal('172.75449999999998'), 'sell': Decimal('172.72650000000002')}, 'AUDCHF': {'buy': Decimal('0.5231899999999999'), 'sell': Decimal('0.52274')}, 'EURZAR': {'buy': Decimal('20.813370000000003'), 'sell': Decimal('20.80651')}, 'USDCZK': {'buy': Decimal('21.244'), 'sell': Decimal('21.174')}, 'D30': {'buy': Decimal('24129.52'), 'sell': Decimal('24129.52')}, 'AUDUSD': {'buy': Decimal('0.65254'), 'sell': Decimal('0.65222')}, 'EURSEK': {'buy': Decimal('11.32686'), 'sell': Decimal('11.32483')}, 'NZDJPY': {'buy': Decimal('88.3865'), 'sell': Decimal('88.3535')}, 'USDSGD': {'buy': Decimal('1.2849000000000002'), 'sell': Decimal('1.2845499999999999')}, 'EURSGD': {'buy': Decimal('1.4927249999999999'), 'sell': Decimal('1.4923950000000001')}, 'NZDUSD': {'buy': Decimal('0.5944699999999999'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25657'), 'sell': Decimal('4.25562')}, 'AUDCAD': {'buy': Decimal('0.89508'), 'sell': Decimal('0.89505')}, 'EURCAD': {'buy': Decimal('1.59408'), 'sell': Decimal('1.59388')}, 'EURNZD': {'buy': Decimal('1.954975'), 'sell': Decimal('1.954595')}, 'USDSEK': {'buy': Decimal('9.74886'), 'sell': Decimal('9.748420000000001')}, 'USDJPY': {'buy': Decimal('148.739'), 'sell': Decimal('148.634')}, 'EURAUD': {'buy': Decimal('1.7810300000000001'), 'sell': Decimal('1.7806499999999998')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}}
2025-07-16 03:36:39,401 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:36:39,402 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:36:39,747 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=BUY, Entry=0.64743000, Current=0.65222, Quantity=0.10000000, Contract Size=100000.00000000, PnL=47.900000000000000000000000, PnL USD=47.900000000000000000000000, Commission=1.00000000, Final PnL=46.900000000000000000000000
2025-07-16 03:36:39,747 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=SELL, Entry=0.64707000, Current=0.65254, Quantity=0.22000000, Contract Size=100000.00000000, PnL=-120.340000000000000000000000, PnL USD=-120.340000000000000000000000, Commission=2.20000000, Final PnL=-122.540000000000000000000000
2025-07-16 03:36:39,750 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=BUY, Entry=1.57561500, Current=1.602475, Quantity=0.10000000, Contract Size=100000.00000000, PnL=268.600000000000000000000000, PnL USD=209.0679120451449698384899786, Commission=1.00000000, Final PnL=208.0679120451449698384899786
2025-07-16 03:36:39,751 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=SELL, Entry=1.57505500, Current=1.6028749999999998, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-278.1999999999980000000000000, PnL USD=-216.5401829149624440552636700, Commission=1.00000000, Final PnL=-217.5401829149624440552636700
2025-07-16 03:36:39,751 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=SELL, Entry=106.24150000, Current=108.3875, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-32190.00000000000000000000000, PnL USD=-216.4921413150939208683897262, Commission=0E-8, Final PnL=-216.4921413150939208683897262
2025-07-16 03:36:39,752 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=BUY, Entry=106.27050000, Current=108.3545, Quantity=0.15000000, Contract Size=100000.00000000, PnL=31260.00000000000000000000000, PnL USD=210.2374755361862679821641144, Commission=0E-8, Final PnL=210.2374755361862679821641144
2025-07-16 03:36:39,752 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77481000, Current=1.7806499999999998, Quantity=0.22000000, Contract Size=100000.00000000, PnL=128.4799999999956000000000000, PnL USD=83.81906719999712948400000000, Commission=2.20000000, Final PnL=81.61906719999712948400000000
2025-07-16 03:36:39,752 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77439000, Current=1.7810300000000001, Quantity=0.21000000, Contract Size=100000.00000000, PnL=-139.4400000000021000000000000, PnL USD=-90.96926160000137001900000000, Commission=2.10000000, Final PnL=-93.06926160000137001900000000
2025-07-16 03:36:39,753 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=BUY, Entry=178.15500000, Current=185.455, Quantity=0.10000000, Contract Size=100000.00000000, PnL=73000.00000000000000000000000, PnL USD=490.9576364088802803166340482, Commission=1.00000000, Final PnL=489.9576364088802803166340482
2025-07-16 03:36:39,753 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=SELL, Entry=178.09500000, Current=185.505, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-74100.00000000000000000000000, PnL USD=-498.3556281903839557734600408, Commission=1.00000000, Final PnL=-499.3556281903839557734600408
2025-07-16 03:36:39,753 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77480000, Current=1.7806499999999998, Quantity=0.05000000, Contract Size=100000.00000000, PnL=29.24999999999900000000000000, PnL USD=19.08240749999934761000000000, Commission=0.50000000, Final PnL=18.58240749999934761000000000
2025-07-16 03:36:39,753 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77442000, Current=1.7810300000000001, Quantity=0.05000000, Contract Size=100000.00000000, PnL=-33.05000000000050000000000000, PnL USD=-21.56148950000032619500000000, Commission=0.50000000, Final PnL=-22.06148950000032619500000000
2025-07-16 03:36:39,754 - DEBUG - app.services.portfolio_calculator - Position calculation for EURGBP: Type=SELL, Entry=0.85403000, Current=0.86714, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-131.100000000000000000000000, PnL USD=-175.6818660000000000000000000, Commission=1.00000000, Final PnL=-176.6818660000000000000000000
2025-07-16 03:36:39,754 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=BUY, Entry=167.26050000, Current=172.72650000000002, Quantity=0.10000000, Contract Size=100000.00000000, PnL=54660.00000000020000000000000, PnL USD=367.6129370699930727895136829, Commission=1.00000000, Final PnL=366.6129370699930727895136829
2025-07-16 03:36:39,755 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=SELL, Entry=167.23150000, Current=172.75449999999998, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-55229.99999999980000000000000, PnL USD=-371.4464419022241053474029686, Commission=1.00000000, Final PnL=-372.4464419022241053474029686
2025-07-16 03:36:39,755 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=SELL, Entry=1.91952500, Current=1.954975, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-354.500000000000000000000000, PnL USD=-210.6864400000000000000000000, Commission=1.00000000, Final PnL=-211.6864400000000000000000000
2025-07-16 03:36:39,755 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=BUY, Entry=1.92063500, Current=1.954595, Quantity=0.10000000, Contract Size=100000.00000000, PnL=339.600000000000000000000000, PnL USD=201.8310720000000000000000000, Commission=1.00000000, Final PnL=200.8310720000000000000000000
2025-07-16 03:36:39,755 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34376000, Current=1.34016, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-24, PnL USD=0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:36:39,755 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34361000, Current=1.34016, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-24, PnL USD=0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:36:39,756 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34379000, Current=1.33995, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:36:39,756 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34378000, Current=1.33995, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:36:39,756 - DEBUG - app.services.portfolio_calculator - Position calculation for NZDJPY: Type=BUY, Entry=87.10150000, Current=88.3535, Quantity=0.01000000, Contract Size=100000.00000000, PnL=1252.000000000000000000000000, PnL USD=8.420259736766001519951038745, Commission=0.10000000, Final PnL=8.320259736766001519951038745
2025-07-16 03:36:39,759 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=SELL, Entry=0.81771000, Current=0.80179, Quantity=0.15000000, Contract Size=100000.00000000, PnL=238.800000000000000000000000, PnL USD=297.8893268798962127638341400, Commission=1.50000000, Final PnL=296.3893268798962127638341400
2025-07-16 03:36:39,760 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=BUY, Entry=0.81805000, Current=0.80147, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-248.700000000000000000000000, PnL USD=-310.2390100294396487201237463, Commission=1.50000000, Final PnL=-311.7390100294396487201237463
2025-07-16 03:36:39,761 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.04973000, Current=10.2959, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2461.700000000000000000000000, PnL USD=239.0779904901016253845914784, Commission=1.00000000, Final PnL=238.0779904901016253845914784
2025-07-16 03:36:39,761 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.05023000, Current=10.2959, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2456.700000000000000000000000, PnL USD=238.5923951891102340180874538, Commission=1.00000000, Final PnL=237.5923951891102340180874538
2025-07-16 03:36:39,762 - DEBUG - app.services.portfolio_calculator - Position calculation for USDSGD: Type=SELL, Entry=1.28795000, Current=1.2849000000000002, Quantity=0.31000000, Contract Size=100000.00000000, PnL=94.54999999999380000000000000, PnL USD=73.59408445222323409223584355, Commission=3.10000000, Final PnL=70.49408445222323409223584355
2025-07-16 03:36:39,762 - DEBUG - app.services.portfolio_calculator - Position calculation for USDTRY: Type=SELL, Entry=39.56087000, Current=40.2594700000, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-6986.000000000000000000000000, PnL USD=-173.5243906588934230877853086, Commission=1.00000000, Final PnL=-174.5243906588934230877853086
2025-07-16 03:36:39,763 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '98181.73000000', 'equity': '98227.27571239729918173307632', 'margin': '1917.31000000', 'free_margin': '96309.96571239729918173307632', 'profit_loss': '45.5457123972991817330763180', 'margin_level': '5123.181734429867845144138210', 'positions': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.900000000000000000000000', 'current_price': '0.65222'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-122.540000000000000000000000', 'current_price': '0.65254'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.0679120451449698384899786', 'current_price': '1.602475'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.5401829149624440552636700', 'current_price': '1.6028749999999998'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-216.4921413150939208683897262', 'current_price': '108.3875'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '210.2374755361862679821641144', 'current_price': '108.3545'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '81.61906719999712948400000000', 'current_price': '1.7806499999999998'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-93.06926160000137001900000000', 'current_price': '1.7810300000000001'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '489.9576364088802803166340482', 'current_price': '185.455'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-499.3556281903839557734600408', 'current_price': '185.505'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.58240749999934761000000000', 'current_price': '1.7806499999999998'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.06148950000032619500000000', 'current_price': '1.7810300000000001'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-176.6818660000000000000000000', 'current_price': '0.86714'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '366.6129370699930727895136829', 'current_price': '172.72650000000002'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-372.4464419022241053474029686', 'current_price': '172.75449999999998'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.6864400000000000000000000', 'current_price': '1.954975'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '200.8310720000000000000000000', 'current_price': '1.954595'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34016'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34016'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33995'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33995'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.320259736766001519951038745', 'current_price': '88.3535'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '296.3893268798962127638341400', 'current_price': '0.80179'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.7390100294396487201237463', 'current_price': '0.80147'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.0779904901016253845914784', 'current_price': '10.2959'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.5923951891102340180874538', 'current_price': '10.2959'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '70.49408445222323409223584355', 'current_price': '1.2849000000000002'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.5243906588934230877853086', 'current_price': '40.2594700000'}], 'margin_call': False}
2025-07-16 03:36:39,763 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '98181.73000000', 'equity': '98227.27571239729918173307632', 'margin': '1917.31000000', 'free_margin': '96309.96571239729918173307632', 'profit_loss': '45.5457123972991817330763180', 'margin_level': '5123.181734429867845144138210', 'positions_with_pnl': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.900000000000000000000000', 'current_price': '0.65222'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-122.540000000000000000000000', 'current_price': '0.65254'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.0679120451449698384899786', 'current_price': '1.602475'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.5401829149624440552636700', 'current_price': '1.6028749999999998'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-216.4921413150939208683897262', 'current_price': '108.3875'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '210.2374755361862679821641144', 'current_price': '108.3545'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '81.61906719999712948400000000', 'current_price': '1.7806499999999998'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-93.06926160000137001900000000', 'current_price': '1.7810300000000001'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '489.9576364088802803166340482', 'current_price': '185.455'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-499.3556281903839557734600408', 'current_price': '185.505'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.58240749999934761000000000', 'current_price': '1.7806499999999998'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.06148950000032619500000000', 'current_price': '1.7810300000000001'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-176.6818660000000000000000000', 'current_price': '0.86714'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '366.6129370699930727895136829', 'current_price': '172.72650000000002'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-372.4464419022241053474029686', 'current_price': '172.75449999999998'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.6864400000000000000000000', 'current_price': '1.954975'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '200.8310720000000000000000000', 'current_price': '1.954595'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34016'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34016'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33995'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33995'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.320259736766001519951038745', 'current_price': '88.3535'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '296.3893268798962127638341400', 'current_price': '0.80179'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.7390100294396487201237463', 'current_price': '0.80147'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.0779904901016253845914784', 'current_price': '10.2959'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.5923951891102340180874538', 'current_price': '10.2959'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '70.49408445222323409223584355', 'current_price': '1.2849000000000002'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.5243906588934230877853086', 'current_price': '40.2594700000'}], 'margin_call': False}
2025-07-16 03:36:39,764 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 5123.181734429867845144138210
2025-07-16 03:36:39,765 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:36:39,765 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-16 03:36:39,765 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (demo) from cache/DB...
2025-07-16 03:36:39,765 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:39,784 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:36:39,788 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:36:39,788 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:36:39,792 - DEBUG - app - [AUTO-CUTOFF] User 10 has 1 pending orders.
2025-07-16 03:36:39,792 - DEBUG - app - [AUTO-CUTOFF] User 10 total positions for portfolio calculation: 1
2025-07-16 03:36:39,860 - DEBUG - app - [AUTO-CUTOFF] User 10 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.16167')}, 'USDZAR': {'buy': Decimal('17.91535'), 'sell': Decimal('17.909329999999997')}, 'SGDJPY': {'buy': Decimal('115.7565'), 'sell': Decimal('115.71249999999999')}, 'GBPAUD': {'buy': Decimal('2.05435'), 'sell': Decimal('2.05391')}, 'USDNOK': {'buy': Decimal('10.29684'), 'sell': Decimal('10.2959')}, 'NZDCAD': {'buy': Decimal('0.81561'), 'sell': Decimal('0.81524')}, 'GBPNZD': {'buy': Decimal('2.25494'), 'sell': Decimal('2.25445')}, 'US30': {'buy': Decimal('44044.0'), 'sell': Decimal('44041.9')}, 'CHFJPY': {'buy': Decimal('185.505'), 'sell': Decimal('185.455')}, 'CADJPY': {'buy': Decimal('108.3875'), 'sell': Decimal('108.3545')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.2594700000'), 'sell': Decimal('40.2579300000')}, 'GBPSEK': {'buy': Decimal('13.06505'), 'sell': Decimal('13.062190000000001')}, 'GBPNOK': {'buy': Decimal('13.798449999999999'), 'sell': Decimal('13.79615')}, 'USDCNH': {'buy': Decimal('7.183'), 'sell': Decimal('7.18269')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.9311200000000001')}, 'XAGUSD': {'buy': Decimal('38.076'), 'sell': Decimal('38.043')}, 'BTCUSD': {'buy': Decimal('119018.3'), 'sell': Decimal('118918.2')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.9628'), 'sell': Decimal('11.96113')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.3719')}, 'NOKSEK': {'buy': Decimal('0.947075'), 'sell': Decimal('0.946545')}, 'CADCHF': {'buy': Decimal('0.5844250000000001'), 'sell': Decimal('0.584125')}, 'GBPUSD': {'buy': Decimal('1.34016'), 'sell': Decimal('1.33995')}, 'CHFSGD': {'buy': Decimal('1.6028749999999998'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.86714'), 'sell': Decimal('0.8667900000000001')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.05199999999999'), 'sell': Decimal('96.946')}, 'EURJPY': {'buy': Decimal('172.75449999999998'), 'sell': Decimal('172.72650000000002')}, 'AUDCHF': {'buy': Decimal('0.5231899999999999'), 'sell': Decimal('0.52274')}, 'EURZAR': {'buy': Decimal('20.813370000000003'), 'sell': Decimal('20.80651')}, 'USDCZK': {'buy': Decimal('21.244'), 'sell': Decimal('21.174')}, 'D30': {'buy': Decimal('24129.52'), 'sell': Decimal('24129.52')}, 'AUDUSD': {'buy': Decimal('0.65254'), 'sell': Decimal('0.65222')}, 'EURSEK': {'buy': Decimal('11.32686'), 'sell': Decimal('11.32483')}, 'NZDJPY': {'buy': Decimal('88.3865'), 'sell': Decimal('88.3535')}, 'USDSGD': {'buy': Decimal('1.2849000000000002'), 'sell': Decimal('1.2845499999999999')}, 'EURSGD': {'buy': Decimal('1.4927249999999999'), 'sell': Decimal('1.4923950000000001')}, 'NZDUSD': {'buy': Decimal('0.5944699999999999'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25657'), 'sell': Decimal('4.25562')}, 'AUDCAD': {'buy': Decimal('0.89508'), 'sell': Decimal('0.89505')}, 'EURCAD': {'buy': Decimal('1.59408'), 'sell': Decimal('1.59388')}, 'EURNZD': {'buy': Decimal('1.954975'), 'sell': Decimal('1.954595')}, 'USDSEK': {'buy': Decimal('9.74886'), 'sell': Decimal('9.748420000000001')}, 'USDJPY': {'buy': Decimal('148.739'), 'sell': Decimal('148.634')}, 'EURAUD': {'buy': Decimal('1.7810300000000001'), 'sell': Decimal('1.7806499999999998')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}}
2025-07-16 03:36:39,860 - DEBUG - app - [AUTO-CUTOFF] User 10 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:36:39,860 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-16 03:36:40,262 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions': [], 'margin_call': False}
2025-07-16 03:36:40,263 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions_with_pnl': [], 'margin_call': False}
2025-07-16 03:36:40,263 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:40,264 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 25371.71974522292993630573248
2025-07-16 03:36:40,266 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-16 03:36:40,266 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-16 03:36:40,266 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (demo) from cache/DB...
2025-07-16 03:36:40,267 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:40,268 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:40,292 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:36:40,296 - DEBUG - app - [AUTO-CUTOFF] User 11 has 1 open orders.
2025-07-16 03:36:40,296 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:36:40,301 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:36:40,302 - DEBUG - app - [AUTO-CUTOFF] User 11 total positions for portfolio calculation: 1
2025-07-16 03:36:40,396 - DEBUG - app.firebase_stream - Firebase listener triggered (55). Event Type: patch, Path: /. Timestamp: 1752662200.3962164
2025-07-16 03:36:40,396 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3700000000', 'o': '88.3670000000'}, 'GBPAUD': {'b': '2.0542400000', 'o': '2.0540700000'}, 'USDJPY': {'b': '148.6830000000', 'o': '148.6830000000'}, 'CADCHF': {'b': '0.5842900000',
2025-07-16 03:36:40,397 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3700000000', 'o': '88.3670000000'}, 'GBPAUD': {'b': '2.0542400000', 'o': '2.0540700000'}, 'USDJPY': {'b': '148.6830000000', 'o': '148.6830000000'}, 'CADCHF': {'b': '0.5842900000',...
2025-07-16 03:36:40,398 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:40,486 - DEBUG - app - [AUTO-CUTOFF] User 11 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.16167')}, 'USDZAR': {'buy': Decimal('17.91535'), 'sell': Decimal('17.909329999999997')}, 'SGDJPY': {'buy': Decimal('115.7565'), 'sell': Decimal('115.71249999999999')}, 'GBPAUD': {'buy': Decimal('2.05435'), 'sell': Decimal('2.05391')}, 'USDNOK': {'buy': Decimal('10.29684'), 'sell': Decimal('10.2959')}, 'NZDCAD': {'buy': Decimal('0.81561'), 'sell': Decimal('0.81524')}, 'GBPNZD': {'buy': Decimal('2.25494'), 'sell': Decimal('2.25445')}, 'US30': {'buy': Decimal('44044.0'), 'sell': Decimal('44041.9')}, 'CHFJPY': {'buy': Decimal('185.505'), 'sell': Decimal('185.455')}, 'CADJPY': {'buy': Decimal('108.3875'), 'sell': Decimal('108.3545')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.2594700000'), 'sell': Decimal('40.2579300000')}, 'GBPSEK': {'buy': Decimal('13.06505'), 'sell': Decimal('13.062190000000001')}, 'GBPNOK': {'buy': Decimal('13.798449999999999'), 'sell': Decimal('13.79615')}, 'USDCNH': {'buy': Decimal('7.183'), 'sell': Decimal('7.18269')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.9311200000000001')}, 'XAGUSD': {'buy': Decimal('38.076'), 'sell': Decimal('38.043')}, 'BTCUSD': {'buy': Decimal('119018.3'), 'sell': Decimal('118918.2')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.9628'), 'sell': Decimal('11.96113')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.3719')}, 'NOKSEK': {'buy': Decimal('0.947075'), 'sell': Decimal('0.946545')}, 'CADCHF': {'buy': Decimal('0.5844250000000001'), 'sell': Decimal('0.584125')}, 'GBPUSD': {'buy': Decimal('1.34016'), 'sell': Decimal('1.33995')}, 'CHFSGD': {'buy': Decimal('1.6028749999999998'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.86714'), 'sell': Decimal('0.8667900000000001')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.05199999999999'), 'sell': Decimal('96.946')}, 'EURJPY': {'buy': Decimal('172.75449999999998'), 'sell': Decimal('172.72650000000002')}, 'AUDCHF': {'buy': Decimal('0.5231899999999999'), 'sell': Decimal('0.52274')}, 'EURZAR': {'buy': Decimal('20.813370000000003'), 'sell': Decimal('20.80651')}, 'USDCZK': {'buy': Decimal('21.244'), 'sell': Decimal('21.174')}, 'D30': {'buy': Decimal('24129.52'), 'sell': Decimal('24129.52')}, 'AUDUSD': {'buy': Decimal('0.65254'), 'sell': Decimal('0.65222')}, 'EURSEK': {'buy': Decimal('11.32686'), 'sell': Decimal('11.32483')}, 'NZDJPY': {'buy': Decimal('88.3865'), 'sell': Decimal('88.3535')}, 'USDSGD': {'buy': Decimal('1.2849000000000002'), 'sell': Decimal('1.2845499999999999')}, 'EURSGD': {'buy': Decimal('1.4927249999999999'), 'sell': Decimal('1.4923950000000001')}, 'NZDUSD': {'buy': Decimal('0.5944699999999999'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25657'), 'sell': Decimal('4.25562')}, 'AUDCAD': {'buy': Decimal('0.89508'), 'sell': Decimal('0.89505')}, 'EURCAD': {'buy': Decimal('1.59408'), 'sell': Decimal('1.59388')}, 'EURNZD': {'buy': Decimal('1.954975'), 'sell': Decimal('1.954595')}, 'USDSEK': {'buy': Decimal('9.74886'), 'sell': Decimal('9.748420000000001')}, 'USDJPY': {'buy': Decimal('148.739'), 'sell': Decimal('148.634')}, 'EURAUD': {'buy': Decimal('1.7810300000000001'), 'sell': Decimal('1.7806499999999998')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}}
2025-07-16 03:36:40,486 - DEBUG - app - [AUTO-CUTOFF] User 11 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:36:40,486 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-16 03:36:40,873 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDCAD: Type=BUY, Entry=0.89752000, Current=0.89505, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-2.470000000000000000000000, PnL USD=-1.800212818681398772648426454, Commission=0.10000000, Final PnL=-1.900212818681398772648426454
2025-07-16 03:36:40,874 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '99998.61000000', 'equity': '99996.70978718131860122735157', 'margin': '6.55', 'free_margin': '99990.15978718131860122735157', 'profit_loss': '-1.900212818681398772648426454', 'margin_level': '1526667.324995134635133242009', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.900212818681398772648426454', 'current_price': '0.89505'}], 'margin_call': False}
2025-07-16 03:36:40,874 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 11: {'balance': '99998.61000000', 'equity': '99996.70978718131860122735157', 'margin': '6.55', 'free_margin': '99990.15978718131860122735157', 'profit_loss': '-1.900212818681398772648426454', 'margin_level': '1526667.324995134635133242009', 'positions_with_pnl': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.900212818681398772648426454', 'current_price': '0.89505'}], 'margin_call': False}
2025-07-16 03:36:40,875 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 1526667.324995134635133242009
2025-07-16 03:36:40,876 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-16 03:36:40,876 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-16 03:36:40,876 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (demo) from cache/DB...
2025-07-16 03:36:40,877 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:40,895 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:36:40,899 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:36:40,899 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:36:40,902 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:36:40,902 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:40,903 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-16 03:36:40,903 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (demo) from cache/DB...
2025-07-16 03:36:40,904 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:36:40,923 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:36:40,926 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:36:40,926 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:36:40,929 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:36:40,929 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:36:41,273 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:41,276 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:42,285 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:42,289 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:42,741 - DEBUG - app.firebase_stream - Firebase listener triggered (56). Event Type: patch, Path: /. Timestamp: 1752662202.741706
2025-07-16 03:36:42,742 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3700000000', 'o': '88.3630000000'}, 'GBPAUD': {'b': '2.0541700000', 'o': '2.0540000000'}, 'USDJPY': {'b': '148.6900000000',
2025-07-16 03:36:42,742 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0630000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3700000000', 'o': '88.3630000000'}, 'GBPAUD': {'b': '2.0541700000', 'o': '2.0540000000'}, 'USDJPY': {'b': '148.6900000000',...
2025-07-16 03:36:42,743 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:43,295 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:43,298 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:44,313 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:44,316 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:44,987 - DEBUG - app.firebase_stream - Firebase listener triggered (57). Event Type: patch, Path: /. Timestamp: 1752662204.9869852
2025-07-16 03:36:44,987 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0620000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540100000'}, 'USDJPY': {'b': '148.6660000000', 'o': '148.6660000000'}, 'USDCNH': {'b': '7.1828000000',
2025-07-16 03:36:44,987 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0620000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540100000'}, 'USDJPY': {'b': '148.6660000000', 'o': '148.6660000000'}, 'USDCNH': {'b': '7.1828000000',...
2025-07-16 03:36:44,988 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:45,323 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:45,342 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:46,351 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:46,355 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:47,347 - DEBUG - app.firebase_stream - Firebase listener triggered (58). Event Type: patch, Path: /. Timestamp: 1752662207.3476684
2025-07-16 03:36:47,348 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0628400000'}, 'XAGUSD': {'b': '38.0680000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3600000000'}, 'USDJPY': {'b': '148.6680000000
2025-07-16 03:36:47,349 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0628400000'}, 'XAGUSD': {'b': '38.0680000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3600000000'}, 'USDJPY': {'b': '148.6680000000...
2025-07-16 03:36:47,349 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:47,360 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:47,374 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:48,394 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:48,397 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:49,409 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:49,430 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:49,603 - DEBUG - app.firebase_stream - Firebase listener triggered (59). Event Type: patch, Path: /. Timestamp: 1752662209.6034555
2025-07-16 03:36:49,604 - DEBUG - app.firebase_stream - Prepared batch update for 34 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0652000000', 'o': '13.0626000000'}, 'XAGUSD': {'b': '38.0660000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3560000000'}, 'GBPAUD': {'b': '2.0542200000',
2025-07-16 03:36:49,605 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0652000000', 'o': '13.0626000000'}, 'XAGUSD': {'b': '38.0660000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3560000000'}, 'GBPAUD': {'b': '2.0542200000',...
2025-07-16 03:36:49,606 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:50,443 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:50,447 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:51,450 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:51,454 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:51,860 - DEBUG - app.firebase_stream - Firebase listener triggered (60). Event Type: patch, Path: /. Timestamp: 1752662211.859989
2025-07-16 03:36:51,860 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627000000'}, 'XAGUSD': {'b': '38.0670000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3650000000', 'o': '88.3560000000'}, 'GBPAUD': {'b': '2.0542200000',
2025-07-16 03:36:51,861 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627000000'}, 'XAGUSD': {'b': '38.0670000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3650000000', 'o': '88.3560000000'}, 'GBPAUD': {'b': '2.0542200000',...
2025-07-16 03:36:51,862 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:52,459 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:52,465 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:53,480 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:53,485 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:54,206 - DEBUG - app.firebase_stream - Firebase listener triggered (61). Event Type: patch, Path: /. Timestamp: 1752662214.2064726
2025-07-16 03:36:54,207 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0628400000'}, 'XAGUSD': {'b': '38.0660000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0542100000',
2025-07-16 03:36:54,207 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0628400000'}, 'XAGUSD': {'b': '38.0660000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0542100000',...
2025-07-16 03:36:54,207 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:54,495 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:54,498 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:55,515 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:55,517 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:56,463 - DEBUG - app.firebase_stream - Firebase listener triggered (62). Event Type: patch, Path: /. Timestamp: 1752662216.4636765
2025-07-16 03:36:56,464 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0625800000'}, 'GBPAUD': {'b': '2.0542200000', 'o': '2.0540600000'}, 'USDJPY': {'b': '148.6670000000', 'o': '148.6630000000'}, 'USDCNH': {'b': '7.1827600000',
2025-07-16 03:36:56,465 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0625800000'}, 'GBPAUD': {'b': '2.0542200000', 'o': '2.0540600000'}, 'USDJPY': {'b': '148.6670000000', 'o': '148.6630000000'}, 'USDCNH': {'b': '7.1827600000',...
2025-07-16 03:36:56,466 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:56,522 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:56,530 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:57,553 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:57,557 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:58,560 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:58,565 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:36:58,721 - DEBUG - app.firebase_stream - Firebase listener triggered (63). Event Type: patch, Path: /. Timestamp: 1752662218.721285
2025-07-16 03:36:58,722 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0624000000'}, 'XAGUSD': {'b': '38.0670000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542100000',
2025-07-16 03:36:58,723 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0624000000'}, 'XAGUSD': {'b': '38.0670000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542100000',...
2025-07-16 03:36:58,723 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:36:59,573 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:36:59,580 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:00,590 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:00,593 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:01,068 - DEBUG - app.firebase_stream - Firebase listener triggered (64). Event Type: patch, Path: /. Timestamp: 1752662221.0683692
2025-07-16 03:37:01,069 - DEBUG - app.firebase_stream - Prepared batch update for 34 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0650000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3690000000', 'o': '88.3610000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540300000'}, 'BTCUSD': {'b': '118971.300000000
2025-07-16 03:37:01,070 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0650000000', 'o': '38.0580000000'}, 'NZDJPY': {'b': '88.3690000000', 'o': '88.3610000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540300000'}, 'BTCUSD': {'b': '118971.300000000...
2025-07-16 03:37:01,070 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:01,598 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:01,602 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:02,607 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:02,609 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:03,322 - DEBUG - app.firebase_stream - Firebase listener triggered (65). Event Type: patch, Path: /. Timestamp: 1752662223.3223624
2025-07-16 03:37:03,323 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623300000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3680000000', 'o': '88.3600000000'}, 'GBPAUD': {'b': '2.0541700000',
2025-07-16 03:37:03,324 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623300000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3680000000', 'o': '88.3600000000'}, 'GBPAUD': {'b': '2.0541700000',...
2025-07-16 03:37:03,325 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:03,618 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:03,622 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:04,636 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:04,640 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:05,653 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:05,684 - DEBUG - app.firebase_stream - Firebase listener triggered (66). Event Type: patch, Path: /. Timestamp: 1752662225.684919
2025-07-16 03:37:05,685 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0624000000'}, 'XAGUSD': {'b': '38.0680000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3680000000', 'o': '88.3590000000'}, 'GBPAUD': {'b': '2.0542000000',
2025-07-16 03:37:05,687 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0624000000'}, 'XAGUSD': {'b': '38.0680000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3680000000', 'o': '88.3590000000'}, 'GBPAUD': {'b': '2.0542000000',...
2025-07-16 03:37:05,688 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:05,691 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:06,734 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:06,741 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:07,746 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:07,749 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:07,937 - DEBUG - app.firebase_stream - Firebase listener triggered (67). Event Type: patch, Path: /. Timestamp: 1752662227.937035
2025-07-16 03:37:07,938 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0650000000', 'o': '38.0600000000'}, 'NZDJPY': {'b': '88.3670000000', 'o': '88.3610000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540000000'}, 'USDJPY': {'b': '148.6720000000',
2025-07-16 03:37:07,938 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0650000000', 'o': '38.0600000000'}, 'NZDJPY': {'b': '88.3670000000', 'o': '88.3610000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540000000'}, 'USDJPY': {'b': '148.6720000000',...
2025-07-16 03:37:07,939 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:08,756 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:08,761 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:09,777 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:09,780 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:10,179 - DEBUG - app.firebase_stream - Firebase listener triggered (68). Event Type: patch, Path: /. Timestamp: 1752662230.179568
2025-07-16 03:37:10,179 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623300000'}, 'NZDJPY': {'b': '88.3700000000', 'o': '88.3610000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540400000'}, 'USDJPY': {'b': '148.6760000000',
2025-07-16 03:37:10,180 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623300000'}, 'NZDJPY': {'b': '88.3700000000', 'o': '88.3610000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540400000'}, 'USDJPY': {'b': '148.6760000000',...
2025-07-16 03:37:10,180 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:10,789 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:10,792 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:11,795 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:11,799 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:12,425 - DEBUG - app.firebase_stream - Firebase listener triggered (69). Event Type: patch, Path: /. Timestamp: 1752662232.4252224
2025-07-16 03:37:12,425 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0651000000', 'o': '13.0625000000'}, 'XAGUSD': {'b': '38.0660000000', 'o': '38.0600000000'}, 'GBPAUD': {'b': '2.0542000000', 'o': '2.0540200000'}, 'EURNZD': {'b': '1.9547900000', '
2025-07-16 03:37:12,425 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0651000000', 'o': '13.0625000000'}, 'XAGUSD': {'b': '38.0660000000', 'o': '38.0600000000'}, 'GBPAUD': {'b': '2.0542000000', 'o': '2.0540200000'}, 'EURNZD': {'b': '1.9547900000', '...
2025-07-16 03:37:12,425 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:12,811 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:12,814 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:13,819 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:13,822 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:14,718 - DEBUG - app.firebase_stream - Firebase listener triggered (70). Event Type: patch, Path: /. Timestamp: 1752662234.7187724
2025-07-16 03:37:14,719 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627000000'}, 'XAGUSD': {'b': '38.0680000000', 'o': '38.0610000000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3610000000'}, 'GBPAUD': {'b': '2.0542400000',
2025-07-16 03:37:14,719 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627000000'}, 'XAGUSD': {'b': '38.0680000000', 'o': '38.0610000000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3610000000'}, 'GBPAUD': {'b': '2.0542400000',...
2025-07-16 03:37:14,720 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:14,826 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:14,832 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:15,838 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:15,842 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:16,846 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:16,851 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:17,026 - DEBUG - app.firebase_stream - Firebase listener triggered (71). Event Type: patch, Path: /. Timestamp: 1752662237.026533
2025-07-16 03:37:17,027 - DEBUG - app.firebase_stream - Prepared batch update for 34 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0628000000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0542500000',
2025-07-16 03:37:17,027 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0628000000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0542500000',...
2025-07-16 03:37:17,028 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:17,860 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:17,863 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:18,869 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:18,875 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:19,402 - DEBUG - app.firebase_stream - Firebase listener triggered (72). Event Type: patch, Path: /. Timestamp: 1752662239.402801
2025-07-16 03:37:19,416 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0542300000', 'o': '2.0540700000'}, 'BTCUSD': {'b': '118933.340000000
2025-07-16 03:37:19,417 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0542300000', 'o': '2.0540700000'}, 'BTCUSD': {'b': '118933.340000000...
2025-07-16 03:37:19,417 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:19,893 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:19,899 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:20,903 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:20,906 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:21,927 - DEBUG - app.firebase_stream - Firebase listener triggered (73). Event Type: patch, Path: /. Timestamp: 1752662241.9275403
2025-07-16 03:37:21,927 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:21,928 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627700000'}, 'XAGUSD': {'b': '38.0670000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3560000000'}, 'GBPAUD': {'b': '2.0542500000',
2025-07-16 03:37:21,929 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627700000'}, 'XAGUSD': {'b': '38.0670000000', 'o': '38.0620000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3560000000'}, 'GBPAUD': {'b': '2.0542500000',...
2025-07-16 03:37:21,929 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:21,933 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:22,957 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:22,960 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:23,964 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:23,968 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:23,997 - DEBUG - app.firebase_stream - Firebase listener triggered (74). Event Type: patch, Path: /. Timestamp: 1752662243.997703
2025-07-16 03:37:23,998 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0628000000'}, 'XAGUSD': {'b': '38.0700000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3650000000', 'o': '88.3580000000'}, 'GBPAUD': {'b': '2.0542500000',
2025-07-16 03:37:23,998 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0628000000'}, 'XAGUSD': {'b': '38.0700000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3650000000', 'o': '88.3580000000'}, 'GBPAUD': {'b': '2.0542500000',...
2025-07-16 03:37:23,998 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:24,981 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:24,986 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:25,996 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:25,999 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:26,210 - DEBUG - app.firebase_stream - Firebase listener triggered (75). Event Type: patch, Path: /. Timestamp: 1752662246.2100847
2025-07-16 03:37:26,210 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3560000000'}, 'GBPAUD': {'b': '2.0542400000', 'o': '2.0540600000'}, 'BTCUSD': {'b': '118945.500000000
2025-07-16 03:37:26,211 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3560000000'}, 'GBPAUD': {'b': '2.0542400000', 'o': '2.0540600000'}, 'BTCUSD': {'b': '118945.500000000...
2025-07-16 03:37:26,211 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:27,001 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:27,004 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:28,017 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:28,020 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:28,611 - DEBUG - app.firebase_stream - Firebase listener triggered (76). Event Type: patch, Path: /. Timestamp: 1752662248.6111138
2025-07-16 03:37:28,611 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0650000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3580000000'}, 'GBPAUD': {'b': '2.0542300000', 'o': '2.0540700000'}, 'BTCUSD': {'b': '118955.420000000
2025-07-16 03:37:28,612 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0650000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3580000000'}, 'GBPAUD': {'b': '2.0542300000', 'o': '2.0540700000'}, 'BTCUSD': {'b': '118955.420000000...
2025-07-16 03:37:28,612 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:29,023 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:29,026 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:30,030 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:30,034 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:30,870 - DEBUG - app.firebase_stream - Firebase listener triggered (77). Event Type: patch, Path: /. Timestamp: 1752662250.8706574
2025-07-16 03:37:30,871 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627700000'}, 'NZDJPY': {'b': '88.3630000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0543000000', 'o': '2.0541100000'}, 'BTCUSD': {'b': '118958.900000000
2025-07-16 03:37:30,872 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627700000'}, 'NZDJPY': {'b': '88.3630000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0543000000', 'o': '2.0541100000'}, 'BTCUSD': {'b': '118958.900000000...
2025-07-16 03:37:30,873 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:31,036 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:31,039 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:32,041 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:32,045 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:33,054 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:33,058 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:33,115 - DEBUG - app.firebase_stream - Firebase listener triggered (78). Event Type: patch, Path: /. Timestamp: 1752662253.1155143
2025-07-16 03:37:33,117 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0658000000', 'o': '13.0632000000'}, 'XAGUSD': {'b': '38.0700000000', 'o': '38.0650000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0542900000',
2025-07-16 03:37:33,118 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0658000000', 'o': '13.0632000000'}, 'XAGUSD': {'b': '38.0700000000', 'o': '38.0650000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0542900000',...
2025-07-16 03:37:33,118 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:34,067 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:34,073 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:35,085 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:35,088 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:35,472 - DEBUG - app.firebase_stream - Firebase listener triggered (79). Event Type: patch, Path: /. Timestamp: 1752662255.4719818
2025-07-16 03:37:35,472 - DEBUG - app.firebase_stream - Prepared batch update for 20 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3670000000', 'o': '88.3580000000'}, 'GBPAUD': {'b': '2.0543000000', 'o': '2.0541300000'}, 'CADCHF': {'b': '0.5843300000', 'o': '0.5842900000'}, 'EURNZD': {'b': '1.9547500000', 'o'
2025-07-16 03:37:35,473 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3670000000', 'o': '88.3580000000'}, 'GBPAUD': {'b': '2.0543000000', 'o': '2.0541300000'}, 'CADCHF': {'b': '0.5843300000', 'o': '0.5842900000'}, 'EURNZD': {'b': '1.9547500000', 'o'...
2025-07-16 03:37:35,474 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:36,093 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:36,100 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:36,849 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-16 03:37:36,849 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-16 03:37:36,857 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-16 03:37:36,858 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-16 03:37:36,858 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-16 03:37:36,858 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (live) from cache/DB...
2025-07-16 03:37:36,859 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:36,878 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:37:36,882 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:37:36,882 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:37:36,888 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:37:36,889 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:36,889 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-16 03:37:36,889 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (live) from cache/DB...
2025-07-16 03:37:36,898 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-16 03:37:36,899 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-16 03:37:36,899 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 8 (live) from cache/DB...
2025-07-16 03:37:36,900 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:37:36,913 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 8.
2025-07-16 03:37:36,914 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-16 03:37:36,914 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (live) from cache/DB...
2025-07-16 03:37:36,915 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:37:36,962 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:37:36,970 - DEBUG - app - [AUTO-CUTOFF] User 9 has 1 open orders.
2025-07-16 03:37:36,970 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:37:36,977 - DEBUG - app - [AUTO-CUTOFF] User 9 has 0 pending orders.
2025-07-16 03:37:36,977 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 1
2025-07-16 03:37:37,067 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.52311'), 'sell': Decimal('0.52285')}, 'GBPNOK': {'buy': Decimal('13.8009'), 'sell': Decimal('13.7981')}, 'AUDJPY': {'buy': Decimal('97.005'), 'sell': Decimal('96.969')}, 'EURJPY': {'buy': Decimal('172.73299999999998'), 'sell': Decimal('172.698')}, 'XAGUSD': {'buy': Decimal('38.085'), 'sell': Decimal('38.05')}, 'EURCAD': {'buy': Decimal('1.594055'), 'sell': Decimal('1.5938050000000001')}, 'GBPUSD': {'buy': Decimal('1.340185'), 'sell': Decimal('1.340025')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.749609999999999'), 'sell': Decimal('9.74829')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}, 'GBPSEK': {'buy': Decimal('13.065999999999999'), 'sell': Decimal('13.063')}, 'EURUSD': {'buy': Decimal('1.161855'), 'sell': Decimal('1.161645')}, 'AUDCAD': {'buy': Decimal('0.89523'), 'sell': Decimal('0.89497')}, 'D30': {'buy': Decimal('24130.02'), 'sell': Decimal('24129.02')}, 'CHFSGD': {'buy': Decimal('1.602825'), 'sell': Decimal('1.6023450000000001')}, 'USDJPY': {'buy': Decimal('148.67999999999998'), 'sell': Decimal('148.657')}, 'EURNOK': {'buy': Decimal('11.963885000000001'), 'sell': Decimal('11.962164999999999')}, 'AUDUSD': {'buy': Decimal('0.652495'), 'sell': Decimal('0.652235')}, 'EURCHF': {'buy': Decimal('0.93151'), 'sell': Decimal('0.93115')}, 'GBPAUD': {'buy': Decimal('2.054425'), 'sell': Decimal('2.0540049999999996')}, 'EURGBP': {'buy': Decimal('0.86706'), 'sell': Decimal('0.86675')}, 'EURNZD': {'buy': Decimal('1.954925'), 'sell': Decimal('1.954415')}, 'EURSEK': {'buy': Decimal('11.326805'), 'sell': Decimal('11.324605')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58447'), 'sell': Decimal('0.58415')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80155')}, 'USDCNH': {'buy': Decimal('7.182855'), 'sell': Decimal('7.182505000000001')}, 'NZDUSD': {'buy': Decimal('0.59445'), 'sell': Decimal('0.59422')}, 'NZDJPY': {'buy': Decimal('88.382'), 'sell': Decimal('88.343')}, 'EURSGD': {'buy': Decimal('1.4927100000000002'), 'sell': Decimal('1.4923199999999999')}, 'CADJPY': {'buy': Decimal('108.377'), 'sell': Decimal('108.342')}, 'USDCZK': {'buy': Decimal('21.2425'), 'sell': Decimal('21.177500000000002')}, 'US30': {'buy': Decimal('44049.5'), 'sell': Decimal('44047.4')}, 'GBPNZD': {'buy': Decimal('2.2550350000000003'), 'sell': Decimal('2.254515')}, 'CHFJPY': {'buy': Decimal('185.475'), 'sell': Decimal('185.435')}, 'BTCUSD': {'buy': Decimal('119008.9'), 'sell': Decimal('118908.8')}, 'USDSGD': {'buy': Decimal('1.2848849999999998'), 'sell': Decimal('1.284585')}, 'NOKSEK': {'buy': Decimal('0.9470350000000001'), 'sell': Decimal('0.946395')}, 'EURPLN': {'buy': Decimal('4.2565800000000005'), 'sell': Decimal('4.25561')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78101'), 'sell': Decimal('1.78063')}, 'SGDJPY': {'buy': Decimal('115.744'), 'sell': Decimal('115.696')}, 'EURZAR': {'buy': Decimal('20.81239'), 'sell': Decimal('20.80604')}, 'USDTRY': {'buy': Decimal('40.259645'), 'sell': Decimal('40.258005000000004')}, 'USDNOK': {'buy': Decimal('10.29835'), 'sell': Decimal('10.29659')}, 'USDZAR': {'buy': Decimal('17.915474999999997'), 'sell': Decimal('17.909915')}, 'NZDCAD': {'buy': Decimal('0.81562'), 'sell': Decimal('0.81532')}, 'USDCAD': {'buy': Decimal('1.3721700000000001'), 'sell': Decimal('1.37194')}}
2025-07-16 03:37:37,067 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:37:37,067 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:37:37,396 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141921.60000000, Current=118908.8, Quantity=0.41000000, Contract Size=1.00000000, PnL=-9435.248000000000000000000000, PnL USD=-9435.248000000000000000000000, Commission=244.35000000, Final PnL=-9679.598000000000000000000000
2025-07-16 03:37:37,397 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.174561370403199565883945356% which is below threshold 100.0%
2025-07-16 03:37:37,397 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '9794.75000000', 'equity': '115.152000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9688.678000000000000000000000', 'profit_loss': '-9679.598000000000000000000000', 'margin_level': '1.174561370403199565883945356', 'positions': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9679.598000000000000000000000', 'current_price': '118908.8'}], 'margin_call': True}
2025-07-16 03:37:37,397 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '9794.75000000', 'equity': '115.152000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9688.678000000000000000000000', 'profit_loss': '-9679.598000000000000000000000', 'margin_level': '1.174561370403199565883945356', 'positions_with_pnl': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9679.598000000000000000000000', 'current_price': '118908.8'}], 'margin_call': True}
2025-07-16 03:37:37,397 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:37,398 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 1.174561370403199565883945356
2025-07-16 03:37:37,402 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:37,425 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:37:37,425 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-16 03:37:37,425 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (live) from cache/DB...
2025-07-16 03:37:37,426 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:37,460 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:37:37,464 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:37:37,464 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:37:37,467 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 pending orders.
2025-07-16 03:37:37,467 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:37,467 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-16 03:37:37,467 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (live) from cache/DB...
2025-07-16 03:37:37,468 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:37,493 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:37:37,496 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 open orders.
2025-07-16 03:37:37,496 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:37:37,499 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:37:37,500 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:37,500 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-16 03:37:37,500 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (live) from cache/DB...
2025-07-16 03:37:37,500 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:37:37,522 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:37:37,526 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:37:37,526 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:37:37,529 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:37:37,529 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:37,529 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-16 03:37:37,529 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (live) from cache/DB...
2025-07-16 03:37:37,530 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:37,546 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:37:37,548 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:37:37,548 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:37:37,551 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:37:37,551 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:37,551 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-16 03:37:37,551 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 14 (live) from cache/DB...
2025-07-16 03:37:37,551 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:37:37,565 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 14...
2025-07-16 03:37:37,567 - DEBUG - app - [AUTO-CUTOFF] User 14 has 3 open orders.
2025-07-16 03:37:37,567 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 14...
2025-07-16 03:37:37,569 - DEBUG - app - [AUTO-CUTOFF] User 14 has 0 pending orders.
2025-07-16 03:37:37,570 - DEBUG - app - [AUTO-CUTOFF] User 14 total positions for portfolio calculation: 3
2025-07-16 03:37:37,622 - DEBUG - app - [AUTO-CUTOFF] User 14 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.52311'), 'sell': Decimal('0.52285')}, 'GBPNOK': {'buy': Decimal('13.8009'), 'sell': Decimal('13.7981')}, 'AUDJPY': {'buy': Decimal('97.005'), 'sell': Decimal('96.969')}, 'EURJPY': {'buy': Decimal('172.73299999999998'), 'sell': Decimal('172.698')}, 'XAGUSD': {'buy': Decimal('38.085'), 'sell': Decimal('38.05')}, 'EURCAD': {'buy': Decimal('1.594055'), 'sell': Decimal('1.5938050000000001')}, 'GBPUSD': {'buy': Decimal('1.340185'), 'sell': Decimal('1.340025')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.749609999999999'), 'sell': Decimal('9.74829')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}, 'GBPSEK': {'buy': Decimal('13.065999999999999'), 'sell': Decimal('13.063')}, 'EURUSD': {'buy': Decimal('1.161855'), 'sell': Decimal('1.161645')}, 'AUDCAD': {'buy': Decimal('0.89523'), 'sell': Decimal('0.89497')}, 'D30': {'buy': Decimal('24130.02'), 'sell': Decimal('24129.02')}, 'CHFSGD': {'buy': Decimal('1.602825'), 'sell': Decimal('1.6023450000000001')}, 'USDJPY': {'buy': Decimal('148.67999999999998'), 'sell': Decimal('148.657')}, 'EURNOK': {'buy': Decimal('11.963885000000001'), 'sell': Decimal('11.962164999999999')}, 'AUDUSD': {'buy': Decimal('0.652495'), 'sell': Decimal('0.652235')}, 'EURCHF': {'buy': Decimal('0.93151'), 'sell': Decimal('0.93115')}, 'GBPAUD': {'buy': Decimal('2.054425'), 'sell': Decimal('2.0540049999999996')}, 'EURGBP': {'buy': Decimal('0.86706'), 'sell': Decimal('0.86675')}, 'EURNZD': {'buy': Decimal('1.954925'), 'sell': Decimal('1.954415')}, 'EURSEK': {'buy': Decimal('11.326805'), 'sell': Decimal('11.324605')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58447'), 'sell': Decimal('0.58415')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80155')}, 'USDCNH': {'buy': Decimal('7.182855'), 'sell': Decimal('7.182505000000001')}, 'NZDUSD': {'buy': Decimal('0.59445'), 'sell': Decimal('0.59422')}, 'NZDJPY': {'buy': Decimal('88.382'), 'sell': Decimal('88.343')}, 'EURSGD': {'buy': Decimal('1.4927100000000002'), 'sell': Decimal('1.4923199999999999')}, 'CADJPY': {'buy': Decimal('108.377'), 'sell': Decimal('108.342')}, 'USDCZK': {'buy': Decimal('21.2425'), 'sell': Decimal('21.177500000000002')}, 'US30': {'buy': Decimal('44049.5'), 'sell': Decimal('44047.4')}, 'GBPNZD': {'buy': Decimal('2.2550350000000003'), 'sell': Decimal('2.254515')}, 'CHFJPY': {'buy': Decimal('185.475'), 'sell': Decimal('185.435')}, 'BTCUSD': {'buy': Decimal('119008.9'), 'sell': Decimal('118908.8')}, 'USDSGD': {'buy': Decimal('1.2848849999999998'), 'sell': Decimal('1.284585')}, 'NOKSEK': {'buy': Decimal('0.9470350000000001'), 'sell': Decimal('0.946395')}, 'EURPLN': {'buy': Decimal('4.2565800000000005'), 'sell': Decimal('4.25561')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78101'), 'sell': Decimal('1.78063')}, 'SGDJPY': {'buy': Decimal('115.744'), 'sell': Decimal('115.696')}, 'EURZAR': {'buy': Decimal('20.81239'), 'sell': Decimal('20.80604')}, 'USDTRY': {'buy': Decimal('40.259645'), 'sell': Decimal('40.258005000000004')}, 'USDNOK': {'buy': Decimal('10.29835'), 'sell': Decimal('10.29659')}, 'USDZAR': {'buy': Decimal('17.915474999999997'), 'sell': Decimal('17.909915')}, 'NZDCAD': {'buy': Decimal('0.81562'), 'sell': Decimal('0.81532')}, 'USDCAD': {'buy': Decimal('1.3721700000000001'), 'sell': Decimal('1.37194')}}
2025-07-16 03:37:37,623 - DEBUG - app - [AUTO-CUTOFF] User 14 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:37:37,623 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-16 03:37:37,730 - DEBUG - app.firebase_stream - Firebase listener triggered (80). Event Type: patch, Path: /. Timestamp: 1752662257.7304413
2025-07-16 03:37:37,730 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0700000000', 'o': '38.0660000000'}, 'NZDJPY': {'b': '88.3630000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0542800000', 'o': '2.0540900000'}, 'CADCHF': {'b': '0.5843300000', '
2025-07-16 03:37:37,731 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0700000000', 'o': '38.0660000000'}, 'NZDJPY': {'b': '88.3630000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0542800000', 'o': '2.0540900000'}, 'CADCHF': {'b': '0.5843300000', '...
2025-07-16 03:37:37,731 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:37,921 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141908.50000000, Current=118908.8, Quantity=0.40000000, Contract Size=1.00000000, PnL=-9199.880000000000000000000000, PnL USD=-9199.880000000000000000000000, Commission=235.57000000, Final PnL=-9435.450000000000000000000000
2025-07-16 03:37:37,922 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.969, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-1280.000000000000000000000000, PnL USD=-8.609672428869307863052397928, Commission=1.00000000, Final PnL=-9.609672428869307863052397928
2025-07-16 03:37:37,925 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.969, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-128.000000000000000000000000, PnL USD=-0.8609672428869307863052397928, Commission=0.10000000, Final PnL=-0.9609672428869307863052397928
2025-07-16 03:37:37,926 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.802788995365131085259549633% which is below threshold 100.0%
2025-07-16 03:37:37,926 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '455.999360328243761350642362', 'margin': '9494.47000000', 'free_margin': '-9038.470639671756238649357638', 'profit_loss': '-9446.020639671756238649357638', 'margin_level': '4.802788995365131085259549633', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9435.450000000000000000000000', 'current_price': '118908.8'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9.609672428869307863052397928', 'current_price': '96.969'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-0.9609672428869307863052397928', 'current_price': '96.969'}], 'margin_call': True}
2025-07-16 03:37:37,926 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 14: {'balance': '9902.02000000', 'equity': '455.999360328243761350642362', 'margin': '9494.47000000', 'free_margin': '-9038.470639671756238649357638', 'profit_loss': '-9446.020639671756238649357638', 'margin_level': '4.802788995365131085259549633', 'positions_with_pnl': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9435.450000000000000000000000', 'current_price': '118908.8'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9.609672428869307863052397928', 'current_price': '96.969'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-0.9609672428869307863052397928', 'current_price': '96.969'}], 'margin_call': True}
2025-07-16 03:37:37,939 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.802788995365131085259549633
2025-07-16 03:37:38,009 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-16 03:37:38,010 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-16 03:37:38,010 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 16 (live) from cache/DB...
2025-07-16 03:37:38,010 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:37:38,035 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 16...
2025-07-16 03:37:38,039 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 open orders.
2025-07-16 03:37:38,039 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 16...
2025-07-16 03:37:38,042 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 pending orders.
2025-07-16 03:37:38,042 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,043 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-16 03:37:38,043 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 17 (live) from cache/DB...
2025-07-16 03:37:38,043 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:38,066 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 17...
2025-07-16 03:37:38,069 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 open orders.
2025-07-16 03:37:38,069 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 17...
2025-07-16 03:37:38,072 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 pending orders.
2025-07-16 03:37:38,072 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,072 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-16 03:37:38,072 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 18 (live) from cache/DB...
2025-07-16 03:37:38,073 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:38,093 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 18...
2025-07-16 03:37:38,097 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 open orders.
2025-07-16 03:37:38,097 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 18...
2025-07-16 03:37:38,101 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 pending orders.
2025-07-16 03:37:38,101 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,101 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-16 03:37:38,101 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 19 (live) from cache/DB...
2025-07-16 03:37:38,102 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Elite...
2025-07-16 03:37:38,127 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 19...
2025-07-16 03:37:38,130 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 open orders.
2025-07-16 03:37:38,130 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 19...
2025-07-16 03:37:38,132 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 pending orders.
2025-07-16 03:37:38,132 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,132 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-16 03:37:38,132 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 20 (live) from cache/DB...
2025-07-16 03:37:38,133 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:37:38,153 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 20...
2025-07-16 03:37:38,158 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 open orders.
2025-07-16 03:37:38,158 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 20...
2025-07-16 03:37:38,162 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 pending orders.
2025-07-16 03:37:38,162 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,162 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-16 03:37:38,162 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 21 (live) from cache/DB...
2025-07-16 03:37:38,162 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:38,193 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 21...
2025-07-16 03:37:38,200 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 open orders.
2025-07-16 03:37:38,200 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 21...
2025-07-16 03:37:38,205 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 pending orders.
2025-07-16 03:37:38,205 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,206 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-16 03:37:38,206 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 22 (live) from cache/DB...
2025-07-16 03:37:38,208 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group VIP...
2025-07-16 03:37:38,242 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 22...
2025-07-16 03:37:38,246 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 open orders.
2025-07-16 03:37:38,246 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 22...
2025-07-16 03:37:38,251 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 pending orders.
2025-07-16 03:37:38,251 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,251 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-16 03:37:38,251 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 23 (live) from cache/DB...
2025-07-16 03:37:38,252 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:38,277 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 23...
2025-07-16 03:37:38,281 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 open orders.
2025-07-16 03:37:38,281 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 23...
2025-07-16 03:37:38,285 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 pending orders.
2025-07-16 03:37:38,285 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,285 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-16 03:37:38,285 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 25 (live) from cache/DB...
2025-07-16 03:37:38,287 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:38,313 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 25...
2025-07-16 03:37:38,317 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 open orders.
2025-07-16 03:37:38,317 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 25...
2025-07-16 03:37:38,319 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 pending orders.
2025-07-16 03:37:38,319 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:38,319 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-16 03:37:38,319 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 26 (live) from cache/DB...
2025-07-16 03:37:38,320 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Royal+...
2025-07-16 03:37:38,334 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 26...
2025-07-16 03:37:38,337 - DEBUG - app - [AUTO-CUTOFF] User 26 has 2 open orders.
2025-07-16 03:37:38,337 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 26...
2025-07-16 03:37:38,340 - DEBUG - app - [AUTO-CUTOFF] User 26 has 0 pending orders.
2025-07-16 03:37:38,340 - DEBUG - app - [AUTO-CUTOFF] User 26 total positions for portfolio calculation: 2
2025-07-16 03:37:38,373 - DEBUG - app - [AUTO-CUTOFF] User 26 adjusted market prices: {'EURSGD': {'buy': Decimal('1.4927300000000001'), 'sell': Decimal('1.49236')}, 'USDCNH': {'buy': Decimal('7.182840000000001'), 'sell': Decimal('7.18252')}, 'BTCUSD': {'buy': Decimal('119008.9'), 'sell': Decimal('118908.8')}, 'USDSEK': {'buy': Decimal('9.749555'), 'sell': Decimal('9.748135')}, 'AUDJPY': {'buy': Decimal('97.00450000000001'), 'sell': Decimal('96.9735')}, 'EURNOK': {'buy': Decimal('11.963995'), 'sell': Decimal('11.962275')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDCHF': {'buy': Decimal('0.8017799999999999'), 'sell': Decimal('0.80155')}, 'USDTRY': {'buy': Decimal('40.25991'), 'sell': Decimal('40.25802')}, 'NZDCAD': {'buy': Decimal('0.8156100000000001'), 'sell': Decimal('0.81533')}, 'GBPAUD': {'buy': Decimal('2.05438'), 'sell': Decimal('2.0539899999999998')}, 'EURCHF': {'buy': Decimal('0.93149'), 'sell': Decimal('0.9311699999999999')}, 'EURNZD': {'buy': Decimal('1.9549400000000001'), 'sell': Decimal('1.95447')}, 'USDCZK': {'buy': Decimal('21.241'), 'sell': Decimal('21.179000000000002')}, 'EURCAD': {'buy': Decimal('1.594075'), 'sell': Decimal('1.593825')}, 'EURSEK': {'buy': Decimal('11.326805'), 'sell': Decimal('11.324684999999999')}, 'CHFSGD': {'buy': Decimal('1.602825'), 'sell': Decimal('1.602365')}, 'EURGBP': {'buy': Decimal('0.86705'), 'sell': Decimal('0.8667600000000001')}, 'NZDJPY': {'buy': Decimal('88.3755'), 'sell': Decimal('88.3415')}, 'AUDUSD': {'buy': Decimal('0.6525150000000001'), 'sell': Decimal('0.6522549999999999')}, 'EURAUD': {'buy': Decimal('1.780995'), 'sell': Decimal('1.780615')}, 'GBPNZD': {'buy': Decimal('2.2550100000000004'), 'sell': Decimal('2.2545599999999997')}, 'GBPSEK': {'buy': Decimal('13.065975'), 'sell': Decimal('13.063025')}, 'SGDJPY': {'buy': Decimal('115.744'), 'sell': Decimal('115.696')}, 'EURZAR': {'buy': Decimal('20.813635'), 'sell': Decimal('20.807325')}, 'NOKSEK': {'buy': Decimal('0.9470350000000001'), 'sell': Decimal('0.946395')}, 'USDNOK': {'buy': Decimal('10.297975000000001'), 'sell': Decimal('10.296854999999999')}, 'USDJPY': {'buy': Decimal('148.67749999999998'), 'sell': Decimal('148.6595')}, 'USDZAR': {'buy': Decimal('17.91546'), 'sell': Decimal('17.90986')}, 'AUDCAD': {'buy': Decimal('0.895175'), 'sell': Decimal('0.8949849999999999')}, 'EURUSD': {'buy': Decimal('1.1618400000000002'), 'sell': Decimal('1.1616799999999998')}, 'NZDUSD': {'buy': Decimal('0.59446'), 'sell': Decimal('0.59421')}, 'EURJPY': {'buy': Decimal('172.73100000000002'), 'sell': Decimal('172.701')}, 'CHFJPY': {'buy': Decimal('185.4725'), 'sell': Decimal('185.4375')}, 'USDCAD': {'buy': Decimal('1.37216'), 'sell': Decimal('1.37195')}, 'AUDCHF': {'buy': Decimal('0.523085'), 'sell': Decimal('0.522875')}, 'GBPNOK': {'buy': Decimal('13.800875000000001'), 'sell': Decimal('13.798525')}, 'US30': {'buy': Decimal('44049.5'), 'sell': Decimal('44047.4')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'USDSGD': {'buy': Decimal('1.28487'), 'sell': Decimal('1.2846')}, 'XAGUSD': {'buy': Decimal('38.0825'), 'sell': Decimal('38.0535')}, 'D30': {'buy': Decimal('24132.02'), 'sell': Decimal('24131.02')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34018'), 'sell': Decimal('1.34005')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.34349999999999')}, 'EURPLN': {'buy': Decimal('4.256530000000001'), 'sell': Decimal('4.25556')}}
2025-07-16 03:37:38,373 - DEBUG - app - [AUTO-CUTOFF] User 26 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:37:38,373 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-16 03:37:38,730 - DEBUG - app.services.portfolio_calculator - Position calculation for XAGUSD: Type=BUY, Entry=41.09800000, Current=38.0535, Quantity=0.01000000, Contract Size=5000.00000000, PnL=-152.225000000000000000000000, PnL USD=-152.225000000000000000000000, Commission=0.10000000, Final PnL=-152.325000000000000000000000
2025-07-16 03:37:38,731 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=132091.90000000, Current=118908.8, Quantity=6.00000000, Contract Size=1.00000000, PnL=-79098.60000000000000000000000, PnL USD=-79098.60000000000000000000000, Commission=3661.62000000, Final PnL=-82760.22000000000000000000000
2025-07-16 03:37:38,731 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.24506399893449455768246286% which is below threshold 100.0%
2025-07-16 03:37:38,731 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101433.2650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45051.2050000000000000000000', 'profit_loss': '-82912.54500000000000000000000', 'margin_level': '69.24506399893449455768246286', 'positions': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-152.325000000000000000000000', 'current_price': '38.0535'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-82760.22000000000000000000000', 'current_price': '118908.8'}], 'margin_call': True}
2025-07-16 03:37:38,731 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 26: {'balance': '184345.81000000', 'equity': '101433.2650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45051.2050000000000000000000', 'profit_loss': '-82912.54500000000000000000000', 'margin_level': '69.24506399893449455768246286', 'positions_with_pnl': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-152.325000000000000000000000', 'current_price': '38.0535'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-82760.22000000000000000000000', 'current_price': '118908.8'}], 'margin_call': True}
2025-07-16 03:37:38,732 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:38,733 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.24506399893449455768246286
2025-07-16 03:37:38,734 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-16 03:37:38,734 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-16 03:37:38,734 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 1 (demo) from cache/DB...
2025-07-16 03:37:38,735 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:38,736 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:38,761 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 1...
2025-07-16 03:37:38,767 - DEBUG - app - [AUTO-CUTOFF] User 1 has 2 open orders.
2025-07-16 03:37:38,768 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 1...
2025-07-16 03:37:38,774 - DEBUG - app - [AUTO-CUTOFF] User 1 has 1 pending orders.
2025-07-16 03:37:38,774 - DEBUG - app - [AUTO-CUTOFF] User 1 total positions for portfolio calculation: 3
2025-07-16 03:37:38,834 - DEBUG - app - [AUTO-CUTOFF] User 1 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618400000000002'), 'sell': Decimal('1.1616799999999998')}, 'USDZAR': {'buy': Decimal('17.91545'), 'sell': Decimal('17.909869999999998')}, 'SGDJPY': {'buy': Decimal('115.7415'), 'sell': Decimal('115.6985')}, 'GBPAUD': {'buy': Decimal('2.05443'), 'sell': Decimal('2.05394')}, 'USDNOK': {'buy': Decimal('10.29795'), 'sell': Decimal('10.29688')}, 'NZDCAD': {'buy': Decimal('0.81567'), 'sell': Decimal('0.81527')}, 'GBPNZD': {'buy': Decimal('2.2550600000000003'), 'sell': Decimal('2.25451')}, 'US30': {'buy': Decimal('44049.5'), 'sell': Decimal('44047.4')}, 'CHFJPY': {'buy': Decimal('185.475'), 'sell': Decimal('185.435')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.34349999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.259899999999995'), 'sell': Decimal('40.258030000000005')}, 'GBPSEK': {'buy': Decimal('13.065949999999999'), 'sell': Decimal('13.06305')}, 'GBPNOK': {'buy': Decimal('13.80085'), 'sell': Decimal('13.79855')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.182530000000001')}, 'EURCHF': {'buy': Decimal('0.9315'), 'sell': Decimal('0.93116')}, 'XAGUSD': {'buy': Decimal('38.085'), 'sell': Decimal('38.051')}, 'BTCUSD': {'buy': Decimal('119008.9'), 'sell': Decimal('118908.8')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96397'), 'sell': Decimal('11.9623')}, 'USDCAD': {'buy': Decimal('1.3722100000000002'), 'sell': Decimal('1.3719')}, 'NOKSEK': {'buy': Decimal('0.9469850000000001'), 'sell': Decimal('0.946445')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34022'), 'sell': Decimal('1.34001')}, 'CHFSGD': {'buy': Decimal('1.602795'), 'sell': Decimal('1.602395')}, 'EURGBP': {'buy': Decimal('0.86707'), 'sell': Decimal('0.8667400000000001')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.042'), 'sell': Decimal('96.936')}, 'EURJPY': {'buy': Decimal('172.7295'), 'sell': Decimal('172.70250000000001')}, 'AUDCHF': {'buy': Decimal('0.52321'), 'sell': Decimal('0.52275')}, 'EURZAR': {'buy': Decimal('20.813660000000002'), 'sell': Decimal('20.807299999999998')}, 'USDCZK': {'buy': Decimal('21.245'), 'sell': Decimal('21.175')}, 'D30': {'buy': Decimal('24131.52'), 'sell': Decimal('24131.52')}, 'AUDUSD': {'buy': Decimal('0.65254'), 'sell': Decimal('0.65223')}, 'EURSEK': {'buy': Decimal('11.32678'), 'sell': Decimal('11.32471')}, 'NZDJPY': {'buy': Decimal('88.3755'), 'sell': Decimal('88.3415')}, 'USDSGD': {'buy': Decimal('1.28491'), 'sell': Decimal('1.28456')}, 'EURSGD': {'buy': Decimal('1.492715'), 'sell': Decimal('1.492375')}, 'NZDUSD': {'buy': Decimal('0.59451'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25652'), 'sell': Decimal('4.2555700000000005')}, 'AUDCAD': {'buy': Decimal('0.8951'), 'sell': Decimal('0.89506')}, 'EURCAD': {'buy': Decimal('1.59405'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.954915'), 'sell': Decimal('1.954495')}, 'USDSEK': {'buy': Decimal('9.74953'), 'sell': Decimal('9.74816')}, 'USDJPY': {'buy': Decimal('148.72'), 'sell': Decimal('148.617')}, 'EURAUD': {'buy': Decimal('1.7810100000000002'), 'sell': Decimal('1.7806')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}}
2025-07-16 03:37:38,834 - DEBUG - app - [AUTO-CUTOFF] User 1 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:37:38,834 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-16 03:37:39,148 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=96.66800000, Current=96.936, Quantity=0.01000000, Contract Size=100000.00000000, PnL=268.000000000000000000000000, PnL USD=1.802650164794511333826595816, Commission=0.10000000, Final PnL=1.702650164794511333826595816
2025-07-16 03:37:39,148 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=SELL, Entry=96.56000000, Current=97.042, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-482.000000000000000000000000, PnL USD=-3.242079773996098742180668595, Commission=0.10000000, Final PnL=-3.342079773996098742180668595
2025-07-16 03:37:39,149 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17011.54000000', 'equity': '17009.90057039079841259164593', 'margin': '6.54000000', 'free_margin': '17003.36057039079841259164593', 'profit_loss': '-1.639429609201587408354072779', 'margin_level': '260090.2227888501286328997849', 'positions': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.702650164794511333826595816', 'current_price': '96.936'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.342079773996098742180668595', 'current_price': '97.042'}], 'margin_call': False}
2025-07-16 03:37:39,149 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 1: {'balance': '17011.54000000', 'equity': '17009.90057039079841259164593', 'margin': '6.54000000', 'free_margin': '17003.36057039079841259164593', 'profit_loss': '-1.639429609201587408354072779', 'margin_level': '260090.2227888501286328997849', 'positions_with_pnl': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.702650164794511333826595816', 'current_price': '96.936'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.342079773996098742180668595', 'current_price': '97.042'}], 'margin_call': False}
2025-07-16 03:37:39,149 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 260090.2227888501286328997849
2025-07-16 03:37:39,150 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-16 03:37:39,151 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-16 03:37:39,151 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 2 (demo) from cache/DB...
2025-07-16 03:37:39,151 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-16 03:37:39,151 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-16 03:37:39,151 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 3 (demo) from cache/DB...
2025-07-16 03:37:39,152 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:37:39,159 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 3.
2025-07-16 03:37:39,160 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-16 03:37:39,160 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (demo) from cache/DB...
2025-07-16 03:37:39,161 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:39,179 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:37:39,183 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:37:39,183 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:37:39,186 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:37:39,186 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:39,187 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-16 03:37:39,187 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (demo) from cache/DB...
2025-07-16 03:37:39,187 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-16 03:37:39,188 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-16 03:37:39,188 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 6 (demo) from cache/DB...
2025-07-16 03:37:39,189 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-16 03:37:39,189 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-16 03:37:39,189 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (demo) from cache/DB...
2025-07-16 03:37:39,190 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:39,209 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:37:39,215 - DEBUG - app - [AUTO-CUTOFF] User 9 has 28 open orders.
2025-07-16 03:37:39,215 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:37:39,218 - DEBUG - app - [AUTO-CUTOFF] User 9 has 6 pending orders.
2025-07-16 03:37:39,218 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 34
2025-07-16 03:37:39,246 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618400000000002'), 'sell': Decimal('1.1616799999999998')}, 'USDZAR': {'buy': Decimal('17.91545'), 'sell': Decimal('17.909869999999998')}, 'SGDJPY': {'buy': Decimal('115.7415'), 'sell': Decimal('115.6985')}, 'GBPAUD': {'buy': Decimal('2.05443'), 'sell': Decimal('2.05394')}, 'USDNOK': {'buy': Decimal('10.29795'), 'sell': Decimal('10.29688')}, 'NZDCAD': {'buy': Decimal('0.81567'), 'sell': Decimal('0.81527')}, 'GBPNZD': {'buy': Decimal('2.2550600000000003'), 'sell': Decimal('2.25451')}, 'US30': {'buy': Decimal('44049.5'), 'sell': Decimal('44047.4')}, 'CHFJPY': {'buy': Decimal('185.475'), 'sell': Decimal('185.435')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.34349999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.259899999999995'), 'sell': Decimal('40.258030000000005')}, 'GBPSEK': {'buy': Decimal('13.065949999999999'), 'sell': Decimal('13.06305')}, 'GBPNOK': {'buy': Decimal('13.80085'), 'sell': Decimal('13.79855')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.182530000000001')}, 'EURCHF': {'buy': Decimal('0.9315'), 'sell': Decimal('0.93116')}, 'XAGUSD': {'buy': Decimal('38.085'), 'sell': Decimal('38.051')}, 'BTCUSD': {'buy': Decimal('119008.9'), 'sell': Decimal('118908.8')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96397'), 'sell': Decimal('11.9623')}, 'USDCAD': {'buy': Decimal('1.3722100000000002'), 'sell': Decimal('1.3719')}, 'NOKSEK': {'buy': Decimal('0.9469850000000001'), 'sell': Decimal('0.946445')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34022'), 'sell': Decimal('1.34001')}, 'CHFSGD': {'buy': Decimal('1.602795'), 'sell': Decimal('1.602395')}, 'EURGBP': {'buy': Decimal('0.86707'), 'sell': Decimal('0.8667400000000001')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.042'), 'sell': Decimal('96.936')}, 'EURJPY': {'buy': Decimal('172.7295'), 'sell': Decimal('172.70250000000001')}, 'AUDCHF': {'buy': Decimal('0.52321'), 'sell': Decimal('0.52275')}, 'EURZAR': {'buy': Decimal('20.813660000000002'), 'sell': Decimal('20.807299999999998')}, 'USDCZK': {'buy': Decimal('21.245'), 'sell': Decimal('21.175')}, 'D30': {'buy': Decimal('24131.52'), 'sell': Decimal('24131.52')}, 'AUDUSD': {'buy': Decimal('0.65254'), 'sell': Decimal('0.65223')}, 'EURSEK': {'buy': Decimal('11.32678'), 'sell': Decimal('11.32471')}, 'NZDJPY': {'buy': Decimal('88.3755'), 'sell': Decimal('88.3415')}, 'USDSGD': {'buy': Decimal('1.28491'), 'sell': Decimal('1.28456')}, 'EURSGD': {'buy': Decimal('1.492715'), 'sell': Decimal('1.492375')}, 'NZDUSD': {'buy': Decimal('0.59451'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25652'), 'sell': Decimal('4.2555700000000005')}, 'AUDCAD': {'buy': Decimal('0.8951'), 'sell': Decimal('0.89506')}, 'EURCAD': {'buy': Decimal('1.59405'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.954915'), 'sell': Decimal('1.954495')}, 'USDSEK': {'buy': Decimal('9.74953'), 'sell': Decimal('9.74816')}, 'USDJPY': {'buy': Decimal('148.72'), 'sell': Decimal('148.617')}, 'EURAUD': {'buy': Decimal('1.7810100000000002'), 'sell': Decimal('1.7806')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}}
2025-07-16 03:37:39,247 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:37:39,247 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:37:39,652 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=BUY, Entry=0.64743000, Current=0.65223, Quantity=0.10000000, Contract Size=100000.00000000, PnL=48.000000000000000000000000, PnL USD=48.000000000000000000000000, Commission=1.00000000, Final PnL=47.000000000000000000000000
2025-07-16 03:37:39,652 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=SELL, Entry=0.64707000, Current=0.65254, Quantity=0.22000000, Contract Size=100000.00000000, PnL=-120.340000000000000000000000, PnL USD=-120.340000000000000000000000, Commission=2.20000000, Final PnL=-122.540000000000000000000000
2025-07-16 03:37:39,653 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=BUY, Entry=1.57561500, Current=1.602395, Quantity=0.10000000, Contract Size=100000.00000000, PnL=267.800000000000000000000000, PnL USD=208.4436003611569476011083782, Commission=1.00000000, Final PnL=207.4436003611569476011083782
2025-07-16 03:37:39,654 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=SELL, Entry=1.57505500, Current=1.602795, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-277.400000000000000000000000, PnL USD=-215.9158130701453968056290669, Commission=1.00000000, Final PnL=-216.9158130701453968056290669
2025-07-16 03:37:39,654 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=SELL, Entry=106.24150000, Current=108.3735, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-31980.00000000000000000000000, PnL USD=-215.1072845900316136409497545, Commission=0E-8, Final PnL=-215.1072845900316136409497545
2025-07-16 03:37:39,655 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=BUY, Entry=106.27050000, Current=108.34349999999999, Quantity=0.15000000, Contract Size=100000.00000000, PnL=31094.99999999985000000000000, PnL USD=209.1545032622576848052734244, Commission=0E-8, Final PnL=209.1545032622576848052734244
2025-07-16 03:37:39,656 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77481000, Current=1.7806, Quantity=0.22000000, Contract Size=100000.00000000, PnL=127.380000000000000000000000, PnL USD=83.10143820000000000000000000, Commission=2.20000000, Final PnL=80.90143820000000000000000000
2025-07-16 03:37:39,656 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77439000, Current=1.7810100000000002, Quantity=0.21000000, Contract Size=100000.00000000, PnL=-139.0200000000042000000000000, PnL USD=-90.69525780000274003800000000, Commission=2.10000000, Final PnL=-92.79525780000274003800000000
2025-07-16 03:37:39,657 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=BUY, Entry=178.15500000, Current=185.435, Quantity=0.10000000, Contract Size=100000.00000000, PnL=72800.00000000000000000000000, PnL USD=489.6751193919418847111051322, Commission=1.00000000, Final PnL=488.6751193919418847111051322
2025-07-16 03:37:39,658 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=SELL, Entry=178.09500000, Current=185.475, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-73800.00000000000000000000000, PnL USD=-496.4014259769960314791148181, Commission=1.00000000, Final PnL=-497.4014259769960314791148181
2025-07-16 03:37:39,658 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77480000, Current=1.7806, Quantity=0.05000000, Contract Size=100000.00000000, PnL=29.000000000000000000000000, PnL USD=18.91931000000000000000000000, Commission=0.50000000, Final PnL=18.41931000000000000000000000
2025-07-16 03:37:39,658 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77442000, Current=1.7810100000000002, Quantity=0.05000000, Contract Size=100000.00000000, PnL=-32.95000000000100000000000000, PnL USD=-21.49625050000065239000000000, Commission=0.50000000, Final PnL=-21.99625050000065239000000000
2025-07-16 03:37:39,658 - DEBUG - app.services.portfolio_calculator - Position calculation for EURGBP: Type=SELL, Entry=0.85403000, Current=0.86707, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-130.400000000000000000000000, PnL USD=-174.7516480000000000000000000, Commission=1.00000000, Final PnL=-175.7516480000000000000000000
2025-07-16 03:37:39,659 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=BUY, Entry=167.26050000, Current=172.70250000000001, Quantity=0.10000000, Contract Size=100000.00000000, PnL=54420.00000000010000000000000, PnL USD=366.0456043586473397457456111, Commission=1.00000000, Final PnL=365.0456043586473397457456111
2025-07-16 03:37:39,660 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=SELL, Entry=167.23150000, Current=172.7295, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-54980.00000000000000000000000, PnL USD=-369.8123360462769893051725298, Commission=1.00000000, Final PnL=-370.8123360462769893051725298
2025-07-16 03:37:39,660 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=SELL, Entry=1.91952500, Current=1.954915, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-353.900000000000000000000000, PnL USD=-210.3440040000000000000000000, Commission=1.00000000, Final PnL=-211.3440040000000000000000000
2025-07-16 03:37:39,660 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=BUY, Entry=1.92063500, Current=1.954495, Quantity=0.10000000, Contract Size=100000.00000000, PnL=338.600000000000000000000000, PnL USD=201.2502960000000000000000000, Commission=1.00000000, Final PnL=200.2502960000000000000000000
2025-07-16 03:37:39,660 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34376000, Current=1.34022, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-24, PnL USD=0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:37:39,660 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34361000, Current=1.34022, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-24, PnL USD=0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:37:39,660 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34379000, Current=1.34001, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:37:39,660 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34378000, Current=1.34001, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:37:39,661 - DEBUG - app.services.portfolio_calculator - Position calculation for NZDJPY: Type=BUY, Entry=87.10150000, Current=88.3415, Quantity=0.01000000, Contract Size=100000.00000000, PnL=1240.000000000000000000000000, PnL USD=8.340620165467141992332010493, Commission=0.10000000, Final PnL=8.240620165467141992332010493
2025-07-16 03:37:39,662 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=SELL, Entry=0.81771000, Current=0.8018299999999999, Quantity=0.15000000, Contract Size=100000.00000000, PnL=238.2000000000015000000000000, PnL USD=297.1260353258176579183714200, Commission=1.50000000, Final PnL=295.6260353258176579183714200
2025-07-16 03:37:39,662 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=BUY, Entry=0.81805000, Current=0.8015, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-248.250000000000000000000000, PnL USD=-309.6622093603432791138608921, Commission=1.50000000, Final PnL=-311.1622093603432791138608921
2025-07-16 03:37:39,663 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.04973000, Current=10.29688, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2471.500000000000000000000000, PnL USD=240.0038843436673059648952441, Commission=1.00000000, Final PnL=239.0038843436673059648952441
2025-07-16 03:37:39,664 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.05023000, Current=10.29688, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2466.500000000000000000000000, PnL USD=239.5183413852540603529897308, Commission=1.00000000, Final PnL=238.5183413852540603529897308
2025-07-16 03:37:39,664 - DEBUG - app.services.portfolio_calculator - Position calculation for USDSGD: Type=SELL, Entry=1.28795000, Current=1.28491, Quantity=0.31000000, Contract Size=100000.00000000, PnL=94.240000000000000000000000, PnL USD=73.35222142656994302437809396, Commission=3.10000000, Final PnL=70.25222142656994302437809396
2025-07-16 03:37:39,665 - DEBUG - app.services.portfolio_calculator - Position calculation for USDTRY: Type=SELL, Entry=39.56087000, Current=40.259899999999995, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-6990.299999999950000000000000, PnL USD=-173.6299902508075683530076565, Commission=1.00000000, Final PnL=-174.6299902508075683530076565
2025-07-16 03:37:39,665 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '98181.73000000', 'equity': '98229.80475462617569499046433', 'margin': '1917.31000000', 'free_margin': '96312.49475462617569499046433', 'profit_loss': '48.0747546261756949904643274', 'margin_level': '5123.313640184747155910648999', 'positions': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '47.000000000000000000000000', 'current_price': '0.65223'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-122.540000000000000000000000', 'current_price': '0.65254'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '207.4436003611569476011083782', 'current_price': '1.602395'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-216.9158130701453968056290669', 'current_price': '1.602795'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-215.1072845900316136409497545', 'current_price': '108.3735'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '209.1545032622576848052734244', 'current_price': '108.34349999999999'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '80.90143820000000000000000000', 'current_price': '1.7806'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-92.79525780000274003800000000', 'current_price': '1.7810100000000002'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '488.6751193919418847111051322', 'current_price': '185.435'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-497.4014259769960314791148181', 'current_price': '185.475'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.41931000000000000000000000', 'current_price': '1.7806'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-21.99625050000065239000000000', 'current_price': '1.7810100000000002'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-175.7516480000000000000000000', 'current_price': '0.86707'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '365.0456043586473397457456111', 'current_price': '172.70250000000001'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-370.8123360462769893051725298', 'current_price': '172.7295'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.3440040000000000000000000', 'current_price': '1.954915'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '200.2502960000000000000000000', 'current_price': '1.954495'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34022'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34022'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34001'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34001'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.240620165467141992332010493', 'current_price': '88.3415'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '295.6260353258176579183714200', 'current_price': '0.8018299999999999'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.1622093603432791138608921', 'current_price': '0.8015'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '239.0038843436673059648952441', 'current_price': '10.29688'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.5183413852540603529897308', 'current_price': '10.29688'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '70.25222142656994302437809396', 'current_price': '1.28491'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.6299902508075683530076565', 'current_price': '40.259899999999995'}], 'margin_call': False}
2025-07-16 03:37:39,666 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '98181.73000000', 'equity': '98229.80475462617569499046433', 'margin': '1917.31000000', 'free_margin': '96312.49475462617569499046433', 'profit_loss': '48.0747546261756949904643274', 'margin_level': '5123.313640184747155910648999', 'positions_with_pnl': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '47.000000000000000000000000', 'current_price': '0.65223'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-122.540000000000000000000000', 'current_price': '0.65254'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '207.4436003611569476011083782', 'current_price': '1.602395'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-216.9158130701453968056290669', 'current_price': '1.602795'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-215.1072845900316136409497545', 'current_price': '108.3735'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '209.1545032622576848052734244', 'current_price': '108.34349999999999'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '80.90143820000000000000000000', 'current_price': '1.7806'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-92.79525780000274003800000000', 'current_price': '1.7810100000000002'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '488.6751193919418847111051322', 'current_price': '185.435'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-497.4014259769960314791148181', 'current_price': '185.475'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.41931000000000000000000000', 'current_price': '1.7806'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-21.99625050000065239000000000', 'current_price': '1.7810100000000002'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-175.7516480000000000000000000', 'current_price': '0.86707'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '365.0456043586473397457456111', 'current_price': '172.70250000000001'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-370.8123360462769893051725298', 'current_price': '172.7295'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.3440040000000000000000000', 'current_price': '1.954915'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '200.2502960000000000000000000', 'current_price': '1.954495'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34022'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34022'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34001'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34001'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.240620165467141992332010493', 'current_price': '88.3415'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '295.6260353258176579183714200', 'current_price': '0.8018299999999999'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.1622093603432791138608921', 'current_price': '0.8015'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '239.0038843436673059648952441', 'current_price': '10.29688'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.5183413852540603529897308', 'current_price': '10.29688'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '70.25222142656994302437809396', 'current_price': '1.28491'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.6299902508075683530076565', 'current_price': '40.259899999999995'}], 'margin_call': False}
2025-07-16 03:37:39,667 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 5123.313640184747155910648999
2025-07-16 03:37:39,667 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:37:39,667 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-16 03:37:39,668 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (demo) from cache/DB...
2025-07-16 03:37:39,668 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:39,694 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:37:39,699 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:37:39,699 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:37:39,704 - DEBUG - app - [AUTO-CUTOFF] User 10 has 1 pending orders.
2025-07-16 03:37:39,705 - DEBUG - app - [AUTO-CUTOFF] User 10 total positions for portfolio calculation: 1
2025-07-16 03:37:39,738 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:39,742 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:39,773 - DEBUG - app - [AUTO-CUTOFF] User 10 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618400000000002'), 'sell': Decimal('1.1616799999999998')}, 'USDZAR': {'buy': Decimal('17.91545'), 'sell': Decimal('17.909869999999998')}, 'SGDJPY': {'buy': Decimal('115.7415'), 'sell': Decimal('115.6985')}, 'GBPAUD': {'buy': Decimal('2.05443'), 'sell': Decimal('2.05394')}, 'USDNOK': {'buy': Decimal('10.29795'), 'sell': Decimal('10.29688')}, 'NZDCAD': {'buy': Decimal('0.81567'), 'sell': Decimal('0.81527')}, 'GBPNZD': {'buy': Decimal('2.2550600000000003'), 'sell': Decimal('2.25451')}, 'US30': {'buy': Decimal('44049.5'), 'sell': Decimal('44047.4')}, 'CHFJPY': {'buy': Decimal('185.475'), 'sell': Decimal('185.435')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.34349999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.259899999999995'), 'sell': Decimal('40.258030000000005')}, 'GBPSEK': {'buy': Decimal('13.065949999999999'), 'sell': Decimal('13.06305')}, 'GBPNOK': {'buy': Decimal('13.80085'), 'sell': Decimal('13.79855')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.182530000000001')}, 'EURCHF': {'buy': Decimal('0.9315'), 'sell': Decimal('0.93116')}, 'XAGUSD': {'buy': Decimal('38.085'), 'sell': Decimal('38.051')}, 'BTCUSD': {'buy': Decimal('119008.9'), 'sell': Decimal('118908.8')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96397'), 'sell': Decimal('11.9623')}, 'USDCAD': {'buy': Decimal('1.3722100000000002'), 'sell': Decimal('1.3719')}, 'NOKSEK': {'buy': Decimal('0.9469850000000001'), 'sell': Decimal('0.946445')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34022'), 'sell': Decimal('1.34001')}, 'CHFSGD': {'buy': Decimal('1.602795'), 'sell': Decimal('1.602395')}, 'EURGBP': {'buy': Decimal('0.86707'), 'sell': Decimal('0.8667400000000001')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.042'), 'sell': Decimal('96.936')}, 'EURJPY': {'buy': Decimal('172.7295'), 'sell': Decimal('172.70250000000001')}, 'AUDCHF': {'buy': Decimal('0.52321'), 'sell': Decimal('0.52275')}, 'EURZAR': {'buy': Decimal('20.813660000000002'), 'sell': Decimal('20.807299999999998')}, 'USDCZK': {'buy': Decimal('21.245'), 'sell': Decimal('21.175')}, 'D30': {'buy': Decimal('24131.52'), 'sell': Decimal('24131.52')}, 'AUDUSD': {'buy': Decimal('0.65254'), 'sell': Decimal('0.65223')}, 'EURSEK': {'buy': Decimal('11.32678'), 'sell': Decimal('11.32471')}, 'NZDJPY': {'buy': Decimal('88.3755'), 'sell': Decimal('88.3415')}, 'USDSGD': {'buy': Decimal('1.28491'), 'sell': Decimal('1.28456')}, 'EURSGD': {'buy': Decimal('1.492715'), 'sell': Decimal('1.492375')}, 'NZDUSD': {'buy': Decimal('0.59451'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25652'), 'sell': Decimal('4.2555700000000005')}, 'AUDCAD': {'buy': Decimal('0.8951'), 'sell': Decimal('0.89506')}, 'EURCAD': {'buy': Decimal('1.59405'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.954915'), 'sell': Decimal('1.954495')}, 'USDSEK': {'buy': Decimal('9.74953'), 'sell': Decimal('9.74816')}, 'USDJPY': {'buy': Decimal('148.72'), 'sell': Decimal('148.617')}, 'EURAUD': {'buy': Decimal('1.7810100000000002'), 'sell': Decimal('1.7806')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}}
2025-07-16 03:37:39,773 - DEBUG - app - [AUTO-CUTOFF] User 10 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:37:39,773 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-16 03:37:40,080 - DEBUG - app.firebase_stream - Firebase listener triggered (81). Event Type: patch, Path: /. Timestamp: 1752662260.080378
2025-07-16 03:37:40,081 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions': [], 'margin_call': False}
2025-07-16 03:37:40,082 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0659000000', 'o': '13.0633000000'}, 'XAGUSD': {'b': '38.0660000000', 'o': '38.0600000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0542500000',
2025-07-16 03:37:40,082 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions_with_pnl': [], 'margin_call': False}
2025-07-16 03:37:40,083 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0659000000', 'o': '13.0633000000'}, 'XAGUSD': {'b': '38.0660000000', 'o': '38.0600000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0542500000',...
2025-07-16 03:37:40,084 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:40,085 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 25371.71974522292993630573248
2025-07-16 03:37:40,090 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-16 03:37:40,090 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-16 03:37:40,090 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (demo) from cache/DB...
2025-07-16 03:37:40,105 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:40,187 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:37:40,191 - DEBUG - app - [AUTO-CUTOFF] User 11 has 1 open orders.
2025-07-16 03:37:40,191 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:37:40,195 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:37:40,195 - DEBUG - app - [AUTO-CUTOFF] User 11 total positions for portfolio calculation: 1
2025-07-16 03:37:40,267 - DEBUG - app - [AUTO-CUTOFF] User 11 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618400000000002'), 'sell': Decimal('1.1616799999999998')}, 'USDZAR': {'buy': Decimal('17.91545'), 'sell': Decimal('17.909869999999998')}, 'SGDJPY': {'buy': Decimal('115.7415'), 'sell': Decimal('115.6985')}, 'GBPAUD': {'buy': Decimal('2.05443'), 'sell': Decimal('2.05394')}, 'USDNOK': {'buy': Decimal('10.29795'), 'sell': Decimal('10.29688')}, 'NZDCAD': {'buy': Decimal('0.81567'), 'sell': Decimal('0.81527')}, 'GBPNZD': {'buy': Decimal('2.2550600000000003'), 'sell': Decimal('2.25451')}, 'US30': {'buy': Decimal('44049.5'), 'sell': Decimal('44047.4')}, 'CHFJPY': {'buy': Decimal('185.475'), 'sell': Decimal('185.435')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.34349999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.259899999999995'), 'sell': Decimal('40.258030000000005')}, 'GBPSEK': {'buy': Decimal('13.065949999999999'), 'sell': Decimal('13.06305')}, 'GBPNOK': {'buy': Decimal('13.80085'), 'sell': Decimal('13.79855')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.182530000000001')}, 'EURCHF': {'buy': Decimal('0.9315'), 'sell': Decimal('0.93116')}, 'XAGUSD': {'buy': Decimal('38.085'), 'sell': Decimal('38.051')}, 'BTCUSD': {'buy': Decimal('119008.9'), 'sell': Decimal('118908.8')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96397'), 'sell': Decimal('11.9623')}, 'USDCAD': {'buy': Decimal('1.3722100000000002'), 'sell': Decimal('1.3719')}, 'NOKSEK': {'buy': Decimal('0.9469850000000001'), 'sell': Decimal('0.946445')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34022'), 'sell': Decimal('1.34001')}, 'CHFSGD': {'buy': Decimal('1.602795'), 'sell': Decimal('1.602395')}, 'EURGBP': {'buy': Decimal('0.86707'), 'sell': Decimal('0.8667400000000001')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.042'), 'sell': Decimal('96.936')}, 'EURJPY': {'buy': Decimal('172.7295'), 'sell': Decimal('172.70250000000001')}, 'AUDCHF': {'buy': Decimal('0.52321'), 'sell': Decimal('0.52275')}, 'EURZAR': {'buy': Decimal('20.813660000000002'), 'sell': Decimal('20.807299999999998')}, 'USDCZK': {'buy': Decimal('21.245'), 'sell': Decimal('21.175')}, 'D30': {'buy': Decimal('24131.52'), 'sell': Decimal('24131.52')}, 'AUDUSD': {'buy': Decimal('0.65254'), 'sell': Decimal('0.65223')}, 'EURSEK': {'buy': Decimal('11.32678'), 'sell': Decimal('11.32471')}, 'NZDJPY': {'buy': Decimal('88.3755'), 'sell': Decimal('88.3415')}, 'USDSGD': {'buy': Decimal('1.28491'), 'sell': Decimal('1.28456')}, 'EURSGD': {'buy': Decimal('1.492715'), 'sell': Decimal('1.492375')}, 'NZDUSD': {'buy': Decimal('0.59451'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25652'), 'sell': Decimal('4.2555700000000005')}, 'AUDCAD': {'buy': Decimal('0.8951'), 'sell': Decimal('0.89506')}, 'EURCAD': {'buy': Decimal('1.59405'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.954915'), 'sell': Decimal('1.954495')}, 'USDSEK': {'buy': Decimal('9.74953'), 'sell': Decimal('9.74816')}, 'USDJPY': {'buy': Decimal('148.72'), 'sell': Decimal('148.617')}, 'EURAUD': {'buy': Decimal('1.7810100000000002'), 'sell': Decimal('1.7806')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}}
2025-07-16 03:37:40,268 - DEBUG - app - [AUTO-CUTOFF] User 11 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:37:40,268 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-16 03:37:40,574 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDCAD: Type=BUY, Entry=0.89752000, Current=0.89506, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-2.460000000000000000000000, PnL USD=-1.792924507674591490168068452, Commission=0.10000000, Final PnL=-1.892924507674591490168068452
2025-07-16 03:37:40,575 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '99998.61000000', 'equity': '99996.71707549232540850983193', 'margin': '6.55', 'free_margin': '99990.16707549232540850983193', 'profit_loss': '-1.892924507674591490168068452', 'margin_level': '1526667.436267058403183356213', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.892924507674591490168068452', 'current_price': '0.89506'}], 'margin_call': False}
2025-07-16 03:37:40,575 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 11: {'balance': '99998.61000000', 'equity': '99996.71707549232540850983193', 'margin': '6.55', 'free_margin': '99990.16707549232540850983193', 'profit_loss': '-1.892924507674591490168068452', 'margin_level': '1526667.436267058403183356213', 'positions_with_pnl': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.892924507674591490168068452', 'current_price': '0.89506'}], 'margin_call': False}
2025-07-16 03:37:40,576 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 1526667.436267058403183356213
2025-07-16 03:37:40,578 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-16 03:37:40,578 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-16 03:37:40,578 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (demo) from cache/DB...
2025-07-16 03:37:40,579 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:40,605 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:37:40,609 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:37:40,609 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:37:40,615 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:37:40,615 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:40,615 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-16 03:37:40,615 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (demo) from cache/DB...
2025-07-16 03:37:40,617 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:37:40,640 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:37:40,645 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:37:40,645 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:37:40,647 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:37:40,647 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:37:40,752 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:40,755 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:41,759 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:41,762 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:42,330 - DEBUG - app.firebase_stream - Firebase listener triggered (82). Event Type: patch, Path: /. Timestamp: 1752662262.3302279
2025-07-16 03:37:42,330 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0658000000', 'o': '13.0632000000'}, 'XAGUSD': {'b': '38.0700000000', 'o': '38.0650000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542500000',
2025-07-16 03:37:42,331 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0658000000', 'o': '13.0632000000'}, 'XAGUSD': {'b': '38.0700000000', 'o': '38.0650000000'}, 'NZDJPY': {'b': '88.3660000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542500000',...
2025-07-16 03:37:42,331 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:42,767 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:42,770 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:43,788 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:43,791 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:44,707 - DEBUG - app.firebase_stream - Firebase listener triggered (83). Event Type: patch, Path: /. Timestamp: 1752662264.7076948
2025-07-16 03:37:44,708 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0640000000'}, 'XAGUSD': {'b': '38.0650000000', 'o': '38.0600000000'}, 'NZDJPY': {'b': '88.3630000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0543100000',
2025-07-16 03:37:44,710 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0640000000'}, 'XAGUSD': {'b': '38.0650000000', 'o': '38.0600000000'}, 'NZDJPY': {'b': '88.3630000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0543100000',...
2025-07-16 03:37:44,710 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:44,799 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:44,805 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:45,826 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:45,829 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:46,834 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:46,838 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:46,930 - DEBUG - app.firebase_stream - Firebase listener triggered (84). Event Type: patch, Path: /. Timestamp: 1752662266.9304745
2025-07-16 03:37:46,930 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'CADCHF': {'b': '0.5843500000', 'o': '0.5842900000'}, 'EURNZD': {'b': '1.9546700000', 'o': '1.9545400000'}, 'EURZAR': {'b': '20.8126500000', 'o':
2025-07-16 03:37:46,931 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'CADCHF': {'b': '0.5843500000', 'o': '0.5842900000'}, 'EURNZD': {'b': '1.9546700000', 'o': '1.9545400000'}, 'EURZAR': {'b': '20.8126500000', 'o':...
2025-07-16 03:37:46,931 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:47,846 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:47,849 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:48,853 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:48,861 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:49,201 - DEBUG - app.firebase_stream - Firebase listener triggered (85). Event Type: patch, Path: /. Timestamp: 1752662269.201731
2025-07-16 03:37:49,202 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3630000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6730000000', 'o': '148.6710000000'}, 'USDCNH': {'b': '7.1827200000',
2025-07-16 03:37:49,203 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'NZDJPY': {'b': '88.3630000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6730000000', 'o': '148.6710000000'}, 'USDCNH': {'b': '7.1827200000',...
2025-07-16 03:37:49,203 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:49,873 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:49,876 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:50,883 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:50,887 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:51,444 - DEBUG - app.firebase_stream - Firebase listener triggered (86). Event Type: patch, Path: /. Timestamp: 1752662271.4447212
2025-07-16 03:37:51,445 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0667000000', 'o': '13.0641600000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541600000'}, 'BTCUSD': {'b': '118960.300000000
2025-07-16 03:37:51,445 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0667000000', 'o': '13.0641600000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541600000'}, 'BTCUSD': {'b': '118960.300000000...
2025-07-16 03:37:51,446 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:51,902 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:51,906 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:52,911 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:52,914 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:53,813 - DEBUG - app.firebase_stream - Firebase listener triggered (87). Event Type: patch, Path: /. Timestamp: 1752662273.8136032
2025-07-16 03:37:53,814 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3650000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0540900000'}, 'BTCUSD': {'b': '118958.900000000
2025-07-16 03:37:53,814 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3650000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0540900000'}, 'BTCUSD': {'b': '118958.900000000...
2025-07-16 03:37:53,815 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:53,917 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:53,919 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:54,924 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:54,928 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:55,943 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:55,947 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:56,042 - DEBUG - app.firebase_stream - Firebase listener triggered (88). Event Type: patch, Path: /. Timestamp: 1752662276.0429468
2025-07-16 03:37:56,043 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0640000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0541000000'}, 'CADCHF': {'b': '0.5843500000', '
2025-07-16 03:37:56,044 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0640000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3570000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0541000000'}, 'CADCHF': {'b': '0.5843500000', '...
2025-07-16 03:37:56,044 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:56,960 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:56,964 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:57,969 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:57,973 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:58,421 - DEBUG - app.firebase_stream - Firebase listener triggered (89). Event Type: patch, Path: /. Timestamp: 1752662278.421324
2025-07-16 03:37:58,421 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0641600000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0542700000', 'o': '2.0540900000'}, 'BTCUSD': {'b': '118951.090000000
2025-07-16 03:37:58,422 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0641600000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0542700000', 'o': '2.0540900000'}, 'BTCUSD': {'b': '118951.090000000...
2025-07-16 03:37:58,423 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:37:58,986 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:37:58,990 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:37:59,998 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:00,001 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:00,656 - DEBUG - app.firebase_stream - Firebase listener triggered (90). Event Type: patch, Path: /. Timestamp: 1752662280.6559844
2025-07-16 03:38:00,656 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0700000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3550000000'}, 'BTCUSD': {'b': '118942.6000000000', 'o': '118942.5000000000'}, 'USDJPY': {'b': '148.67
2025-07-16 03:38:00,656 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0700000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3550000000'}, 'BTCUSD': {'b': '118942.6000000000', 'o': '118942.5000000000'}, 'USDJPY': {'b': '148.67...
2025-07-16 03:38:00,656 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:01,011 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:01,015 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:02,021 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:02,026 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:03,042 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:03,046 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:03,125 - DEBUG - app.firebase_stream - Firebase listener triggered (91). Event Type: patch, Path: /. Timestamp: 1752662283.1258318
2025-07-16 03:38:03,126 - DEBUG - app.firebase_stream - Prepared batch update for 34 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3610000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0540400000', 'o': '2.0538700000'}, 'BTCUSD': {'b': '118960.300000000
2025-07-16 03:38:03,126 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3610000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0540400000', 'o': '2.0538700000'}, 'BTCUSD': {'b': '118960.300000000...
2025-07-16 03:38:03,127 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:04,063 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:04,066 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:05,082 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:05,085 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:05,459 - DEBUG - app.firebase_stream - Firebase listener triggered (92). Event Type: patch, Path: /. Timestamp: 1752662285.45991
2025-07-16 03:38:05,460 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0541700000', 'o': '2.0540100000'}, 'BTCUSD': {'b': '118932.880000000
2025-07-16 03:38:05,461 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3640000000', 'o': '88.3550000000'}, 'GBPAUD': {'b': '2.0541700000', 'o': '2.0540100000'}, 'BTCUSD': {'b': '118932.880000000...
2025-07-16 03:38:05,461 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:06,094 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:06,098 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:07,109 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:07,114 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:07,726 - DEBUG - app.firebase_stream - Firebase listener triggered (93). Event Type: patch, Path: /. Timestamp: 1752662287.7262106
2025-07-16 03:38:07,726 - DEBUG - app.firebase_stream - Prepared batch update for 38 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0656000000', 'o': '13.0630000000'}, 'XAGUSD': {'b': '38.0700000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0542300000',
2025-07-16 03:38:07,727 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0656000000', 'o': '13.0630000000'}, 'XAGUSD': {'b': '38.0700000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0542300000',...
2025-07-16 03:38:07,727 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:08,124 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:08,129 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:09,139 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:09,142 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:10,084 - DEBUG - app.firebase_stream - Firebase listener triggered (94). Event Type: patch, Path: /. Timestamp: 1752662290.0844817
2025-07-16 03:38:10,085 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3560000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0542000000', 'o': '2.0540500000'}, 'BTCUSD': {'b': '118905.1000000000', 'o': '118905.0000000000'}, 'USDJPY': {'b': '148.6630
2025-07-16 03:38:10,086 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3560000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0542000000', 'o': '2.0540500000'}, 'BTCUSD': {'b': '118905.1000000000', 'o': '118905.0000000000'}, 'USDJPY': {'b': '148.6630...
2025-07-16 03:38:10,087 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:10,148 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:10,159 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:11,182 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:11,185 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:12,197 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:12,200 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:12,319 - DEBUG - app.firebase_stream - Firebase listener triggered (95). Event Type: patch, Path: /. Timestamp: 1752662292.3198845
2025-07-16 03:38:12,320 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540200000'}, 'EURNZD': {'b': '1.9547400000', '
2025-07-16 03:38:12,320 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540200000'}, 'EURNZD': {'b': '1.9547400000', '...
2025-07-16 03:38:12,320 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:13,214 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:13,217 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:14,227 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:14,231 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:14,589 - DEBUG - app.firebase_stream - Firebase listener triggered (96). Event Type: patch, Path: /. Timestamp: 1752662294.5891683
2025-07-16 03:38:14,589 - DEBUG - app.firebase_stream - Prepared batch update for 22 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0650000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540700000'}, 'USDJPY': {'b': '148.6630000000', 'o': '148.6600000000'}, 'CADCHF': {'b': '0.5843400000',
2025-07-16 03:38:14,590 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0690000000', 'o': '38.0650000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540700000'}, 'USDJPY': {'b': '148.6630000000', 'o': '148.6600000000'}, 'CADCHF': {'b': '0.5843400000',...
2025-07-16 03:38:14,590 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:15,239 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:15,242 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:16,255 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:16,259 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:16,935 - DEBUG - app.firebase_stream - Firebase listener triggered (97). Event Type: patch, Path: /. Timestamp: 1752662296.9351087
2025-07-16 03:38:16,935 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627000000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3570000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0542100000',
2025-07-16 03:38:16,935 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627000000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0640000000'}, 'NZDJPY': {'b': '88.3570000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0542100000',...
2025-07-16 03:38:16,936 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:17,264 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:17,267 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:18,280 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:18,284 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:19,291 - DEBUG - app.firebase_stream - Firebase listener triggered (98). Event Type: patch, Path: /. Timestamp: 1752662299.291942
2025-07-16 03:38:19,292 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0628000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3480000000'}, 'CADCHF': {'b': '0.5843400000', 'o': '0.5842800000'}, 'EURNZD': {'b': '1.9546400000', '
2025-07-16 03:38:19,292 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0628000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3480000000'}, 'CADCHF': {'b': '0.5843400000', 'o': '0.5842800000'}, 'EURNZD': {'b': '1.9546400000', '...
2025-07-16 03:38:19,292 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:19,294 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:19,310 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:20,332 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:20,337 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:21,355 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:21,358 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:21,548 - DEBUG - app.firebase_stream - Firebase listener triggered (99). Event Type: patch, Path: /. Timestamp: 1752662301.5484865
2025-07-16 03:38:21,549 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3570000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540300000'}, 'BTCUSD': {'b': '118912.5300000000', 'o': '118912.5300000000'}, 'CADCHF': {'b': '0.584340
2025-07-16 03:38:21,549 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3570000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540300000'}, 'BTCUSD': {'b': '118912.5300000000', 'o': '118912.5300000000'}, 'CADCHF': {'b': '0.584340...
2025-07-16 03:38:21,550 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:22,373 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:22,378 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:23,391 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:23,395 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:23,792 - DEBUG - app.firebase_stream - Firebase listener triggered (100). Event Type: patch, Path: /. Timestamp: 1752662303.7924633
2025-07-16 03:38:23,792 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3540000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540500000'}, 'BTCUSD': {'b': '118913.6000000000', 'o': '118913.5000000000'}, 'CADCHF': {'b': '0.584330
2025-07-16 03:38:23,793 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3540000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0541900000', 'o': '2.0540500000'}, 'BTCUSD': {'b': '118913.6000000000', 'o': '118913.5000000000'}, 'CADCHF': {'b': '0.584330...
2025-07-16 03:38:23,793 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:24,402 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:24,405 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:25,423 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:25,426 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:26,154 - DEBUG - app.firebase_stream - Firebase listener triggered (101). Event Type: patch, Path: /. Timestamp: 1752662306.1543489
2025-07-16 03:38:26,154 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0629900000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3450000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540200000'}, 'USDJPY': {'b': '148.6610000000',
2025-07-16 03:38:26,155 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0629900000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3450000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540200000'}, 'USDJPY': {'b': '148.6610000000',...
2025-07-16 03:38:26,155 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:26,432 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:26,436 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:27,455 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:27,459 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:28,397 - DEBUG - app.firebase_stream - Firebase listener triggered (102). Event Type: patch, Path: /. Timestamp: 1752662308.3975503
2025-07-16 03:38:28,398 - DEBUG - app.firebase_stream - Prepared batch update for 22 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0629900000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0650000000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0541900000',
2025-07-16 03:38:28,399 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0629900000'}, 'XAGUSD': {'b': '38.0690000000', 'o': '38.0650000000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0541900000',...
2025-07-16 03:38:28,399 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:28,464 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:28,469 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:29,480 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:29,483 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:30,487 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:30,494 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:30,781 - DEBUG - app.firebase_stream - Firebase listener triggered (103). Event Type: patch, Path: /. Timestamp: 1752662310.7813041
2025-07-16 03:38:30,781 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0629900000'}, 'XAGUSD': {'b': '38.0680000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0541800000',
2025-07-16 03:38:30,782 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0629900000'}, 'XAGUSD': {'b': '38.0680000000', 'o': '38.0630000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0541800000',...
2025-07-16 03:38:30,783 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:31,512 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:31,515 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:32,519 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:32,523 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:33,019 - DEBUG - app.firebase_stream - Firebase listener triggered (104). Event Type: patch, Path: /. Timestamp: 1752662313.0194404
2025-07-16 03:38:33,039 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540300000'}, 'BTCUSD': {'b': '118911.300000000
2025-07-16 03:38:33,039 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0541800000', 'o': '2.0540300000'}, 'BTCUSD': {'b': '118911.300000000...
2025-07-16 03:38:33,040 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:33,541 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:33,544 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:34,549 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:34,553 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:35,389 - DEBUG - app.firebase_stream - Firebase listener triggered (105). Event Type: patch, Path: /. Timestamp: 1752662315.3892064
2025-07-16 03:38:35,390 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0629900000'}, 'XAGUSD': {'b': '38.0650000000', 'o': '38.0630000000'}, 'GBPAUD': {'b': '2.0542200000', 'o': '2.0540700000'}, 'BTCUSD': {'b': '118890.500000000
2025-07-16 03:38:35,391 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0654000000', 'o': '13.0629900000'}, 'XAGUSD': {'b': '38.0650000000', 'o': '38.0630000000'}, 'GBPAUD': {'b': '2.0542200000', 'o': '2.0540700000'}, 'BTCUSD': {'b': '118890.500000000...
2025-07-16 03:38:35,392 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:35,557 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:35,559 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:36,570 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:36,577 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:36,850 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-16 03:38:36,850 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-16 03:38:36,888 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-16 03:38:36,888 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-16 03:38:36,888 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-16 03:38:36,888 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (live) from cache/DB...
2025-07-16 03:38:36,889 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:36,911 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:38:36,914 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:38:36,914 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:38:36,917 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:38:36,917 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:36,917 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-16 03:38:36,918 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (live) from cache/DB...
2025-07-16 03:38:36,923 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-16 03:38:36,923 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-16 03:38:36,923 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 8 (live) from cache/DB...
2025-07-16 03:38:36,924 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:38:36,932 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 8.
2025-07-16 03:38:36,933 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-16 03:38:36,933 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (live) from cache/DB...
2025-07-16 03:38:36,934 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:38:36,955 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:38:36,959 - DEBUG - app - [AUTO-CUTOFF] User 9 has 1 open orders.
2025-07-16 03:38:36,959 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:38:36,961 - DEBUG - app - [AUTO-CUTOFF] User 9 has 0 pending orders.
2025-07-16 03:38:36,962 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 1
2025-07-16 03:38:37,042 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.5230899999999999'), 'sell': Decimal('0.52283')}, 'GBPNOK': {'buy': Decimal('13.799999999999999'), 'sell': Decimal('13.797600000000001')}, 'AUDJPY': {'buy': Decimal('96.996'), 'sell': Decimal('96.96')}, 'EURJPY': {'buy': Decimal('172.71599999999998'), 'sell': Decimal('172.681')}, 'XAGUSD': {'buy': Decimal('38.08'), 'sell': Decimal('38.048')}, 'EURCAD': {'buy': Decimal('1.594015'), 'sell': Decimal('1.593745')}, 'GBPUSD': {'buy': Decimal('1.340105'), 'sell': Decimal('1.339945')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.74992'), 'sell': Decimal('9.748940000000001')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}, 'GBPSEK': {'buy': Decimal('13.0656'), 'sell': Decimal('13.06279')}, 'EURUSD': {'buy': Decimal('1.161815'), 'sell': Decimal('1.161595')}, 'AUDCAD': {'buy': Decimal('0.8950500000'), 'sell': Decimal('0.8950200000')}, 'D30': {'buy': Decimal('24131.3'), 'sell': Decimal('24130.3')}, 'CHFSGD': {'buy': Decimal('1.6029049999999998'), 'sell': Decimal('1.6024450000000001')}, 'USDJPY': {'buy': Decimal('148.67'), 'sell': Decimal('148.649')}, 'EURNOK': {'buy': Decimal('11.963595'), 'sell': Decimal('11.961875')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652215')}, 'EURCHF': {'buy': Decimal('0.93145'), 'sell': Decimal('0.93109')}, 'GBPAUD': {'buy': Decimal('2.054345'), 'sell': Decimal('2.0539449999999997')}, 'EURGBP': {'buy': Decimal('0.86709'), 'sell': Decimal('0.86678')}, 'EURNZD': {'buy': Decimal('1.954935'), 'sell': Decimal('1.954415')}, 'EURSEK': {'buy': Decimal('11.326935'), 'sell': Decimal('11.324855')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58446'), 'sell': Decimal('0.5841299999999999')}, 'USDCHF': {'buy': Decimal('0.8017700000000001'), 'sell': Decimal('0.80153')}, 'USDCNH': {'buy': Decimal('7.182865'), 'sell': Decimal('7.182495')}, 'NZDUSD': {'buy': Decimal('0.59443'), 'sell': Decimal('0.59422')}, 'NZDJPY': {'buy': Decimal('88.37'), 'sell': Decimal('88.332')}, 'EURSGD': {'buy': Decimal('1.49272'), 'sell': Decimal('1.4923099999999998')}, 'CADJPY': {'buy': Decimal('108.36999999999999'), 'sell': Decimal('108.334')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'US30': {'buy': Decimal('44051.5'), 'sell': Decimal('44049.5')}, 'GBPNZD': {'buy': Decimal('2.254945'), 'sell': Decimal('2.2544649999999997')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.425')}, 'BTCUSD': {'buy': Decimal('118940.5'), 'sell': Decimal('118840.4')}, 'USDSGD': {'buy': Decimal('1.2849249999999999'), 'sell': Decimal('1.284635')}, 'NOKSEK': {'buy': Decimal('0.947095'), 'sell': Decimal('0.946445')}, 'EURPLN': {'buy': Decimal('4.25666'), 'sell': Decimal('4.2556899999999995')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.7810000000000001'), 'sell': Decimal('1.78061')}, 'SGDJPY': {'buy': Decimal('115.734'), 'sell': Decimal('115.684')}, 'EURZAR': {'buy': Decimal('20.81353'), 'sell': Decimal('20.806669999999997')}, 'USDTRY': {'buy': Decimal('40.259945'), 'sell': Decimal('40.257975')}, 'USDNOK': {'buy': Decimal('10.298129999999999'), 'sell': Decimal('10.29716')}, 'USDZAR': {'buy': Decimal('17.915775'), 'sell': Decimal('17.910545000000003')}, 'NZDCAD': {'buy': Decimal('0.81553'), 'sell': Decimal('0.81526')}, 'USDCAD': {'buy': Decimal('1.37218'), 'sell': Decimal('1.3719299999999999')}}
2025-07-16 03:38:37,042 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:38:37,042 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:38:37,403 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141921.60000000, Current=118840.4, Quantity=0.41000000, Contract Size=1.00000000, PnL=-9463.292000000000000000000000, PnL USD=-9463.292000000000000000000000, Commission=244.35000000, Final PnL=-9707.642000000000000000000000
2025-07-16 03:38:37,404 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.8885098986824536941175030575% which is below threshold 100.0%
2025-07-16 03:38:37,404 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '9794.75000000', 'equity': '87.108000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9716.722000000000000000000000', 'profit_loss': '-9707.642000000000000000000000', 'margin_level': '0.8885098986824536941175030575', 'positions': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9707.642000000000000000000000', 'current_price': '118840.4'}], 'margin_call': True}
2025-07-16 03:38:37,404 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '9794.75000000', 'equity': '87.108000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9716.722000000000000000000000', 'profit_loss': '-9707.642000000000000000000000', 'margin_level': '0.8885098986824536941175030575', 'positions_with_pnl': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9707.642000000000000000000000', 'current_price': '118840.4'}], 'margin_call': True}
2025-07-16 03:38:37,405 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.8885098986824536941175030575
2025-07-16 03:38:37,442 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:38:37,442 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-16 03:38:37,442 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (live) from cache/DB...
2025-07-16 03:38:37,443 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:37,485 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:38:37,490 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:38:37,490 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:38:37,494 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 pending orders.
2025-07-16 03:38:37,494 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:37,494 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-16 03:38:37,495 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (live) from cache/DB...
2025-07-16 03:38:37,495 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:37,521 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:38:37,525 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 open orders.
2025-07-16 03:38:37,525 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:38:37,528 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:38:37,528 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:37,528 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-16 03:38:37,528 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (live) from cache/DB...
2025-07-16 03:38:37,529 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:38:37,553 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:38:37,556 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:38:37,557 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:38:37,559 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:38:37,560 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:37,560 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-16 03:38:37,560 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (live) from cache/DB...
2025-07-16 03:38:37,561 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:37,581 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:37,584 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:37,586 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:38:37,589 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:38:37,589 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:38:37,592 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:38:37,592 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:37,592 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-16 03:38:37,592 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 14 (live) from cache/DB...
2025-07-16 03:38:37,593 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:38:37,617 - DEBUG - app.firebase_stream - Firebase listener triggered (106). Event Type: patch, Path: /. Timestamp: 1752662317.6172056
2025-07-16 03:38:37,617 - DEBUG - app.firebase_stream - Prepared batch update for 19 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'XAGUSD': {'b': '38.0650000000', 'o': '38.0610000000'}, 'NZDJPY': {'b': '88.3540000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0542200000',
2025-07-16 03:38:37,619 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'XAGUSD': {'b': '38.0650000000', 'o': '38.0610000000'}, 'NZDJPY': {'b': '88.3540000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0542200000',...
2025-07-16 03:38:37,619 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:37,650 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 14...
2025-07-16 03:38:37,659 - DEBUG - app - [AUTO-CUTOFF] User 14 has 3 open orders.
2025-07-16 03:38:37,659 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 14...
2025-07-16 03:38:37,667 - DEBUG - app - [AUTO-CUTOFF] User 14 has 0 pending orders.
2025-07-16 03:38:37,668 - DEBUG - app - [AUTO-CUTOFF] User 14 total positions for portfolio calculation: 3
2025-07-16 03:38:37,772 - DEBUG - app - [AUTO-CUTOFF] User 14 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.5230899999999999'), 'sell': Decimal('0.52283')}, 'GBPNOK': {'buy': Decimal('13.799999999999999'), 'sell': Decimal('13.797600000000001')}, 'AUDJPY': {'buy': Decimal('96.996'), 'sell': Decimal('96.96')}, 'EURJPY': {'buy': Decimal('172.71599999999998'), 'sell': Decimal('172.681')}, 'XAGUSD': {'buy': Decimal('38.08'), 'sell': Decimal('38.048')}, 'EURCAD': {'buy': Decimal('1.594015'), 'sell': Decimal('1.593745')}, 'GBPUSD': {'buy': Decimal('1.340105'), 'sell': Decimal('1.339945')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.74992'), 'sell': Decimal('9.748940000000001')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}, 'GBPSEK': {'buy': Decimal('13.0656'), 'sell': Decimal('13.06279')}, 'EURUSD': {'buy': Decimal('1.161815'), 'sell': Decimal('1.161595')}, 'AUDCAD': {'buy': Decimal('0.8950500000'), 'sell': Decimal('0.8950200000')}, 'D30': {'buy': Decimal('24131.3'), 'sell': Decimal('24130.3')}, 'CHFSGD': {'buy': Decimal('1.6029049999999998'), 'sell': Decimal('1.6024450000000001')}, 'USDJPY': {'buy': Decimal('148.67'), 'sell': Decimal('148.649')}, 'EURNOK': {'buy': Decimal('11.963595'), 'sell': Decimal('11.961875')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652215')}, 'EURCHF': {'buy': Decimal('0.93145'), 'sell': Decimal('0.93109')}, 'GBPAUD': {'buy': Decimal('2.054345'), 'sell': Decimal('2.0539449999999997')}, 'EURGBP': {'buy': Decimal('0.86709'), 'sell': Decimal('0.86678')}, 'EURNZD': {'buy': Decimal('1.954935'), 'sell': Decimal('1.954415')}, 'EURSEK': {'buy': Decimal('11.326935'), 'sell': Decimal('11.324855')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58446'), 'sell': Decimal('0.5841299999999999')}, 'USDCHF': {'buy': Decimal('0.8017700000000001'), 'sell': Decimal('0.80153')}, 'USDCNH': {'buy': Decimal('7.182865'), 'sell': Decimal('7.182495')}, 'NZDUSD': {'buy': Decimal('0.59443'), 'sell': Decimal('0.59422')}, 'NZDJPY': {'buy': Decimal('88.37'), 'sell': Decimal('88.332')}, 'EURSGD': {'buy': Decimal('1.49272'), 'sell': Decimal('1.4923099999999998')}, 'CADJPY': {'buy': Decimal('108.36999999999999'), 'sell': Decimal('108.334')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'US30': {'buy': Decimal('44051.5'), 'sell': Decimal('44049.5')}, 'GBPNZD': {'buy': Decimal('2.254945'), 'sell': Decimal('2.2544649999999997')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.425')}, 'BTCUSD': {'buy': Decimal('118940.5'), 'sell': Decimal('118840.4')}, 'USDSGD': {'buy': Decimal('1.2849249999999999'), 'sell': Decimal('1.284635')}, 'NOKSEK': {'buy': Decimal('0.947095'), 'sell': Decimal('0.946445')}, 'EURPLN': {'buy': Decimal('4.25666'), 'sell': Decimal('4.2556899999999995')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.7810000000000001'), 'sell': Decimal('1.78061')}, 'SGDJPY': {'buy': Decimal('115.734'), 'sell': Decimal('115.684')}, 'EURZAR': {'buy': Decimal('20.81353'), 'sell': Decimal('20.806669999999997')}, 'USDTRY': {'buy': Decimal('40.259945'), 'sell': Decimal('40.257975')}, 'USDNOK': {'buy': Decimal('10.298129999999999'), 'sell': Decimal('10.29716')}, 'USDZAR': {'buy': Decimal('17.915775'), 'sell': Decimal('17.910545000000003')}, 'NZDCAD': {'buy': Decimal('0.81553'), 'sell': Decimal('0.81526')}, 'USDCAD': {'buy': Decimal('1.37218'), 'sell': Decimal('1.3719299999999999')}}
2025-07-16 03:38:37,772 - DEBUG - app - [AUTO-CUTOFF] User 14 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:38:37,772 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-16 03:38:38,120 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141908.50000000, Current=118840.4, Quantity=0.40000000, Contract Size=1.00000000, PnL=-9227.240000000000000000000000, PnL USD=-9227.240000000000000000000000, Commission=235.57000000, Final PnL=-9462.810000000000000000000000
2025-07-16 03:38:38,122 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.96, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-1370.000000000000000000000000, PnL USD=-9.215411935640101167733950385, Commission=1.00000000, Final PnL=-10.21541193564010116773395038
2025-07-16 03:38:38,123 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.96, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-137.000000000000000000000000, PnL USD=-0.9215411935640101167733950385, Commission=0.10000000, Final PnL=-1.021541193564010116773395038
2025-07-16 03:38:38,123 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.507603340373879623775657356% which is below threshold 100.0%
2025-07-16 03:38:38,123 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '427.973046870795888715492655', 'margin': '9494.47000000', 'free_margin': '-9066.496953129204111284507345', 'profit_loss': '-9474.046953129204111284507345', 'margin_level': '4.507603340373879623775657356', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9462.810000000000000000000000', 'current_price': '118840.4'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.21541193564010116773395038', 'current_price': '96.96'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.021541193564010116773395038', 'current_price': '96.96'}], 'margin_call': True}
2025-07-16 03:38:38,123 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 14: {'balance': '9902.02000000', 'equity': '427.973046870795888715492655', 'margin': '9494.47000000', 'free_margin': '-9066.496953129204111284507345', 'profit_loss': '-9474.046953129204111284507345', 'margin_level': '4.507603340373879623775657356', 'positions_with_pnl': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9462.810000000000000000000000', 'current_price': '118840.4'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.21541193564010116773395038', 'current_price': '96.96'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.021541193564010116773395038', 'current_price': '96.96'}], 'margin_call': True}
2025-07-16 03:38:38,125 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.507603340373879623775657356
2025-07-16 03:38:38,152 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-16 03:38:38,152 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-16 03:38:38,152 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 16 (live) from cache/DB...
2025-07-16 03:38:38,153 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:38:38,169 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 16...
2025-07-16 03:38:38,173 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 open orders.
2025-07-16 03:38:38,173 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 16...
2025-07-16 03:38:38,176 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 pending orders.
2025-07-16 03:38:38,176 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,176 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-16 03:38:38,176 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 17 (live) from cache/DB...
2025-07-16 03:38:38,177 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:38,198 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 17...
2025-07-16 03:38:38,201 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 open orders.
2025-07-16 03:38:38,201 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 17...
2025-07-16 03:38:38,204 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 pending orders.
2025-07-16 03:38:38,204 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,204 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-16 03:38:38,204 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 18 (live) from cache/DB...
2025-07-16 03:38:38,207 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:38,235 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 18...
2025-07-16 03:38:38,238 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 open orders.
2025-07-16 03:38:38,239 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 18...
2025-07-16 03:38:38,241 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 pending orders.
2025-07-16 03:38:38,241 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,242 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-16 03:38:38,242 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 19 (live) from cache/DB...
2025-07-16 03:38:38,242 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Elite...
2025-07-16 03:38:38,264 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 19...
2025-07-16 03:38:38,267 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 open orders.
2025-07-16 03:38:38,267 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 19...
2025-07-16 03:38:38,270 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 pending orders.
2025-07-16 03:38:38,270 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,270 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-16 03:38:38,270 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 20 (live) from cache/DB...
2025-07-16 03:38:38,270 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:38:38,289 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 20...
2025-07-16 03:38:38,292 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 open orders.
2025-07-16 03:38:38,292 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 20...
2025-07-16 03:38:38,294 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 pending orders.
2025-07-16 03:38:38,294 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,294 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-16 03:38:38,294 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 21 (live) from cache/DB...
2025-07-16 03:38:38,294 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:38,316 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 21...
2025-07-16 03:38:38,319 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 open orders.
2025-07-16 03:38:38,319 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 21...
2025-07-16 03:38:38,323 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 pending orders.
2025-07-16 03:38:38,323 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,323 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-16 03:38:38,323 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 22 (live) from cache/DB...
2025-07-16 03:38:38,324 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group VIP...
2025-07-16 03:38:38,351 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 22...
2025-07-16 03:38:38,355 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 open orders.
2025-07-16 03:38:38,355 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 22...
2025-07-16 03:38:38,358 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 pending orders.
2025-07-16 03:38:38,358 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,358 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-16 03:38:38,358 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 23 (live) from cache/DB...
2025-07-16 03:38:38,358 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:38,384 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 23...
2025-07-16 03:38:38,387 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 open orders.
2025-07-16 03:38:38,388 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 23...
2025-07-16 03:38:38,391 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 pending orders.
2025-07-16 03:38:38,391 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,391 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-16 03:38:38,391 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 25 (live) from cache/DB...
2025-07-16 03:38:38,392 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:38,417 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 25...
2025-07-16 03:38:38,424 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 open orders.
2025-07-16 03:38:38,425 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 25...
2025-07-16 03:38:38,431 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 pending orders.
2025-07-16 03:38:38,431 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:38,431 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-16 03:38:38,432 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 26 (live) from cache/DB...
2025-07-16 03:38:38,433 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Royal+...
2025-07-16 03:38:38,458 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 26...
2025-07-16 03:38:38,489 - DEBUG - app - [AUTO-CUTOFF] User 26 has 2 open orders.
2025-07-16 03:38:38,490 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 26...
2025-07-16 03:38:38,500 - DEBUG - app - [AUTO-CUTOFF] User 26 has 0 pending orders.
2025-07-16 03:38:38,500 - DEBUG - app - [AUTO-CUTOFF] User 26 total positions for portfolio calculation: 2
2025-07-16 03:38:38,562 - DEBUG - app - [AUTO-CUTOFF] User 26 adjusted market prices: {'EURSGD': {'buy': Decimal('1.49271'), 'sell': Decimal('1.4923199999999999')}, 'USDCNH': {'buy': Decimal('7.182840000000001'), 'sell': Decimal('7.18249')}, 'BTCUSD': {'buy': Decimal('118961.3'), 'sell': Decimal('118861.2')}, 'USDSEK': {'buy': Decimal('9.749895'), 'sell': Decimal('9.748845')}, 'AUDJPY': {'buy': Decimal('96.9935'), 'sell': Decimal('96.96249999999999')}, 'EURNOK': {'buy': Decimal('11.963595'), 'sell': Decimal('11.961875')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDCHF': {'buy': Decimal('0.80176'), 'sell': Decimal('0.80154')}, 'USDTRY': {'buy': Decimal('40.259930000000004'), 'sell': Decimal('40.25799')}, 'NZDCAD': {'buy': Decimal('0.8155100000000001'), 'sell': Decimal('0.81526')}, 'GBPAUD': {'buy': Decimal('2.05432'), 'sell': Decimal('2.05394')}, 'EURCHF': {'buy': Decimal('0.9314600000000001'), 'sell': Decimal('0.93112')}, 'EURNZD': {'buy': Decimal('1.9549100000000001'), 'sell': Decimal('1.95444')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'EURCAD': {'buy': Decimal('1.594015'), 'sell': Decimal('1.593745')}, 'EURSEK': {'buy': Decimal('11.326895'), 'sell': Decimal('11.324785')}, 'CHFSGD': {'buy': Decimal('1.6029049999999998'), 'sell': Decimal('1.6024450000000001')}, 'EURGBP': {'buy': Decimal('0.86708'), 'sell': Decimal('0.86678')}, 'NZDJPY': {'buy': Decimal('88.3665'), 'sell': Decimal('88.33449999999999')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652215')}, 'EURAUD': {'buy': Decimal('1.780995'), 'sell': Decimal('1.780615')}, 'GBPNZD': {'buy': Decimal('2.2549400000000004'), 'sell': Decimal('2.25453')}, 'GBPSEK': {'buy': Decimal('13.065675'), 'sell': Decimal('13.062725')}, 'SGDJPY': {'buy': Decimal('115.733'), 'sell': Decimal('115.68299999999999')}, 'EURZAR': {'buy': Decimal('20.813505'), 'sell': Decimal('20.806694999999998')}, 'NOKSEK': {'buy': Decimal('0.947095'), 'sell': Decimal('0.946445')}, 'USDNOK': {'buy': Decimal('10.298105'), 'sell': Decimal('10.297184999999999')}, 'USDJPY': {'buy': Decimal('148.67149999999998'), 'sell': Decimal('148.6505')}, 'USDZAR': {'buy': Decimal('17.915760000000002'), 'sell': Decimal('17.91056')}, 'AUDCAD': {'buy': Decimal('0.8950500000'), 'sell': Decimal('0.8950200000')}, 'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616')}, 'NZDUSD': {'buy': Decimal('0.59443'), 'sell': Decimal('0.59421')}, 'EURJPY': {'buy': Decimal('172.715'), 'sell': Decimal('172.682')}, 'CHFJPY': {'buy': Decimal('185.46249999999998'), 'sell': Decimal('185.41750000000002')}, 'USDCAD': {'buy': Decimal('1.37217'), 'sell': Decimal('1.37194')}, 'AUDCHF': {'buy': Decimal('0.523055'), 'sell': Decimal('0.522845')}, 'GBPNOK': {'buy': Decimal('13.799975'), 'sell': Decimal('13.797625')}, 'US30': {'buy': Decimal('44051.5'), 'sell': Decimal('44049.5')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'USDSGD': {'buy': Decimal('1.28491'), 'sell': Decimal('1.2846499999999998')}, 'XAGUSD': {'buy': Decimal('38.0775'), 'sell': Decimal('38.0485')}, 'D30': {'buy': Decimal('24131.3'), 'sell': Decimal('24130.3')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'JP225': {'buy': Decimal('39569.7900000000'), 'sell': Decimal('39569.7900000000')}, 'CADCHF': {'buy': Decimal('0.584445'), 'sell': Decimal('0.5841449999999999')}, 'GBPUSD': {'buy': Decimal('1.3400999999999998'), 'sell': Decimal('1.33997')}, 'CADJPY': {'buy': Decimal('108.3685'), 'sell': Decimal('108.3355')}, 'EURPLN': {'buy': Decimal('4.25666'), 'sell': Decimal('4.2556899999999995')}}
2025-07-16 03:38:38,562 - DEBUG - app - [AUTO-CUTOFF] User 26 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:38:38,562 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-16 03:38:38,910 - DEBUG - app.services.portfolio_calculator - Position calculation for XAGUSD: Type=BUY, Entry=41.09800000, Current=38.0485, Quantity=0.01000000, Contract Size=5000.00000000, PnL=-152.475000000000000000000000, PnL USD=-152.475000000000000000000000, Commission=0.10000000, Final PnL=-152.575000000000000000000000
2025-07-16 03:38:38,910 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=132091.90000000, Current=118861.2, Quantity=6.00000000, Contract Size=1.00000000, PnL=-79384.20000000000000000000000, PnL USD=-79384.20000000000000000000000, Commission=3661.62000000, Final PnL=-83045.82000000000000000000000
2025-07-16 03:38:38,910 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 69.04992385882271342484292021% which is below threshold 100.0%
2025-07-16 03:38:38,910 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101147.4150000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45337.0550000000000000000000', 'profit_loss': '-83198.39500000000000000000000', 'margin_level': '69.04992385882271342484292021', 'positions': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-152.575000000000000000000000', 'current_price': '38.0485'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-83045.82000000000000000000000', 'current_price': '118861.2'}], 'margin_call': True}
2025-07-16 03:38:38,910 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 26: {'balance': '184345.81000000', 'equity': '101147.4150000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45337.0550000000000000000000', 'profit_loss': '-83198.39500000000000000000000', 'margin_level': '69.04992385882271342484292021', 'positions_with_pnl': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-152.575000000000000000000000', 'current_price': '38.0485'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-83045.82000000000000000000000', 'current_price': '118861.2'}], 'margin_call': True}
2025-07-16 03:38:38,911 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:38,912 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.04992385882271342484292021
2025-07-16 03:38:38,913 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-16 03:38:38,914 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-16 03:38:38,914 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 1 (demo) from cache/DB...
2025-07-16 03:38:38,914 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:38,915 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:38,938 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 1...
2025-07-16 03:38:38,944 - DEBUG - app - [AUTO-CUTOFF] User 1 has 2 open orders.
2025-07-16 03:38:38,944 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 1...
2025-07-16 03:38:38,949 - DEBUG - app - [AUTO-CUTOFF] User 1 has 1 pending orders.
2025-07-16 03:38:38,949 - DEBUG - app - [AUTO-CUTOFF] User 1 total positions for portfolio calculation: 3
2025-07-16 03:38:39,043 - DEBUG - app - [AUTO-CUTOFF] User 1 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616')}, 'USDZAR': {'buy': Decimal('17.915750000000003'), 'sell': Decimal('17.91057')}, 'SGDJPY': {'buy': Decimal('115.7305'), 'sell': Decimal('115.68549999999999')}, 'GBPAUD': {'buy': Decimal('2.05437'), 'sell': Decimal('2.05389')}, 'USDNOK': {'buy': Decimal('10.298079999999999'), 'sell': Decimal('10.29721')}, 'NZDCAD': {'buy': Decimal('0.81557'), 'sell': Decimal('0.8152')}, 'GBPNZD': {'buy': Decimal('2.2549900000000003'), 'sell': Decimal('2.25448')}, 'US30': {'buy': Decimal('44051.5'), 'sell': Decimal('44049.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3685'), 'sell': Decimal('108.3355')}, 'USDCHF': {'buy': Decimal('0.80181'), 'sell': Decimal('0.80149')}, 'USDTRY': {'buy': Decimal('40.25992'), 'sell': Decimal('40.258')}, 'GBPSEK': {'buy': Decimal('13.06565'), 'sell': Decimal('13.062750000000001')}, 'GBPNOK': {'buy': Decimal('13.799949999999999'), 'sell': Decimal('13.79765')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.1825')}, 'EURCHF': {'buy': Decimal('0.93147'), 'sell': Decimal('0.93111')}, 'XAGUSD': {'buy': Decimal('38.08'), 'sell': Decimal('38.046')}, 'BTCUSD': {'buy': Decimal('118961.3'), 'sell': Decimal('118861.2')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.963569999999999'), 'sell': Decimal('11.9619')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.3718899999999998')}, 'NOKSEK': {'buy': Decimal('0.947045'), 'sell': Decimal('0.946495')}, 'CADCHF': {'buy': Decimal('0.584445'), 'sell': Decimal('0.5841449999999999')}, 'GBPUSD': {'buy': Decimal('1.3401399999999999'), 'sell': Decimal('1.33993')}, 'CHFSGD': {'buy': Decimal('1.6028749999999998'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.8671'), 'sell': Decimal('0.86676')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.03099999999999'), 'sell': Decimal('96.925')}, 'EURJPY': {'buy': Decimal('172.71349999999998'), 'sell': Decimal('172.6835')}, 'AUDCHF': {'buy': Decimal('0.52318'), 'sell': Decimal('0.5227200000000001')}, 'EURZAR': {'buy': Decimal('20.81353'), 'sell': Decimal('20.806669999999997')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'D30': {'buy': Decimal('24130.8'), 'sell': Decimal('24130.8')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65219')}, 'EURSEK': {'buy': Decimal('11.32687'), 'sell': Decimal('11.324810000000001')}, 'NZDJPY': {'buy': Decimal('88.3665'), 'sell': Decimal('88.33449999999999')}, 'USDSGD': {'buy': Decimal('1.28495'), 'sell': Decimal('1.2846099999999998')}, 'EURSGD': {'buy': Decimal('1.4926949999999999'), 'sell': Decimal('1.492335')}, 'NZDUSD': {'buy': Decimal('0.59448'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25665'), 'sell': Decimal('4.2557')}, 'AUDCAD': {'buy': Decimal('0.8950500000'), 'sell': Decimal('0.8950200000')}, 'EURCAD': {'buy': Decimal('1.59399'), 'sell': Decimal('1.59377')}, 'EURNZD': {'buy': Decimal('1.954885'), 'sell': Decimal('1.9544650000000001')}, 'USDSEK': {'buy': Decimal('9.74987'), 'sell': Decimal('9.74887')}, 'USDJPY': {'buy': Decimal('148.714'), 'sell': Decimal('148.60799999999998')}, 'EURAUD': {'buy': Decimal('1.7810100000000002'), 'sell': Decimal('1.7806')}, 'JP225': {'buy': Decimal('39569.7900000000'), 'sell': Decimal('39569.7900000000')}}
2025-07-16 03:38:39,043 - DEBUG - app - [AUTO-CUTOFF] User 1 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:38:39,043 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-16 03:38:39,350 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=96.66800000, Current=96.925, Quantity=0.01000000, Contract Size=100000.00000000, PnL=257.000000000000000000000000, PnL USD=1.728730560189420438034762955, Commission=0.10000000, Final PnL=1.628730560189420438034762955
2025-07-16 03:38:39,350 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=SELL, Entry=96.56000000, Current=97.03099999999999, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-470.9999999999900000000000000, PnL USD=-3.168218264004668245170316956, Commission=0.10000000, Final PnL=-3.268218264004668245170316956
2025-07-16 03:38:39,351 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17011.54000000', 'equity': '17009.90051229618475219286445', 'margin': '6.54000000', 'free_margin': '17003.36051229618475219286445', 'profit_loss': '-1.639487703815247807135554001', 'margin_level': '260090.2219005532836726737683', 'positions': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.628730560189420438034762955', 'current_price': '96.925'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.268218264004668245170316956', 'current_price': '97.03099999999999'}], 'margin_call': False}
2025-07-16 03:38:39,351 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 1: {'balance': '17011.54000000', 'equity': '17009.90051229618475219286445', 'margin': '6.54000000', 'free_margin': '17003.36051229618475219286445', 'profit_loss': '-1.639487703815247807135554001', 'margin_level': '260090.2219005532836726737683', 'positions_with_pnl': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.628730560189420438034762955', 'current_price': '96.925'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.268218264004668245170316956', 'current_price': '97.03099999999999'}], 'margin_call': False}
2025-07-16 03:38:39,352 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 260090.2219005532836726737683
2025-07-16 03:38:39,352 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-16 03:38:39,353 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-16 03:38:39,353 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 2 (demo) from cache/DB...
2025-07-16 03:38:39,354 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-16 03:38:39,354 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-16 03:38:39,354 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 3 (demo) from cache/DB...
2025-07-16 03:38:39,354 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:38:39,365 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 3.
2025-07-16 03:38:39,366 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-16 03:38:39,366 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (demo) from cache/DB...
2025-07-16 03:38:39,367 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:39,391 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:38:39,394 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:38:39,394 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:38:39,397 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:38:39,397 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:39,398 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-16 03:38:39,398 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (demo) from cache/DB...
2025-07-16 03:38:39,398 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-16 03:38:39,398 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-16 03:38:39,399 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 6 (demo) from cache/DB...
2025-07-16 03:38:39,399 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-16 03:38:39,399 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-16 03:38:39,399 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (demo) from cache/DB...
2025-07-16 03:38:39,400 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:39,424 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:38:39,429 - DEBUG - app - [AUTO-CUTOFF] User 9 has 28 open orders.
2025-07-16 03:38:39,429 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:38:39,432 - DEBUG - app - [AUTO-CUTOFF] User 9 has 6 pending orders.
2025-07-16 03:38:39,433 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 34
2025-07-16 03:38:39,497 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616')}, 'USDZAR': {'buy': Decimal('17.915750000000003'), 'sell': Decimal('17.91057')}, 'SGDJPY': {'buy': Decimal('115.7305'), 'sell': Decimal('115.68549999999999')}, 'GBPAUD': {'buy': Decimal('2.05437'), 'sell': Decimal('2.05389')}, 'USDNOK': {'buy': Decimal('10.298079999999999'), 'sell': Decimal('10.29721')}, 'NZDCAD': {'buy': Decimal('0.81557'), 'sell': Decimal('0.8152')}, 'GBPNZD': {'buy': Decimal('2.2549900000000003'), 'sell': Decimal('2.25448')}, 'US30': {'buy': Decimal('44051.5'), 'sell': Decimal('44049.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3685'), 'sell': Decimal('108.3355')}, 'USDCHF': {'buy': Decimal('0.80181'), 'sell': Decimal('0.80149')}, 'USDTRY': {'buy': Decimal('40.25992'), 'sell': Decimal('40.258')}, 'GBPSEK': {'buy': Decimal('13.06565'), 'sell': Decimal('13.062750000000001')}, 'GBPNOK': {'buy': Decimal('13.799949999999999'), 'sell': Decimal('13.79765')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.1825')}, 'EURCHF': {'buy': Decimal('0.93147'), 'sell': Decimal('0.93111')}, 'XAGUSD': {'buy': Decimal('38.08'), 'sell': Decimal('38.046')}, 'BTCUSD': {'buy': Decimal('118961.3'), 'sell': Decimal('118861.2')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.963569999999999'), 'sell': Decimal('11.9619')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.3718899999999998')}, 'NOKSEK': {'buy': Decimal('0.947045'), 'sell': Decimal('0.946495')}, 'CADCHF': {'buy': Decimal('0.584445'), 'sell': Decimal('0.5841449999999999')}, 'GBPUSD': {'buy': Decimal('1.3401399999999999'), 'sell': Decimal('1.33993')}, 'CHFSGD': {'buy': Decimal('1.6028749999999998'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.8671'), 'sell': Decimal('0.86676')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.03099999999999'), 'sell': Decimal('96.925')}, 'EURJPY': {'buy': Decimal('172.71349999999998'), 'sell': Decimal('172.6835')}, 'AUDCHF': {'buy': Decimal('0.52318'), 'sell': Decimal('0.5227200000000001')}, 'EURZAR': {'buy': Decimal('20.81353'), 'sell': Decimal('20.806669999999997')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'D30': {'buy': Decimal('24130.8'), 'sell': Decimal('24130.8')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65219')}, 'EURSEK': {'buy': Decimal('11.32687'), 'sell': Decimal('11.324810000000001')}, 'NZDJPY': {'buy': Decimal('88.3665'), 'sell': Decimal('88.33449999999999')}, 'USDSGD': {'buy': Decimal('1.28495'), 'sell': Decimal('1.2846099999999998')}, 'EURSGD': {'buy': Decimal('1.4926949999999999'), 'sell': Decimal('1.492335')}, 'NZDUSD': {'buy': Decimal('0.59448'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25665'), 'sell': Decimal('4.2557')}, 'AUDCAD': {'buy': Decimal('0.8950500000'), 'sell': Decimal('0.8950200000')}, 'EURCAD': {'buy': Decimal('1.59399'), 'sell': Decimal('1.59377')}, 'EURNZD': {'buy': Decimal('1.954885'), 'sell': Decimal('1.9544650000000001')}, 'USDSEK': {'buy': Decimal('9.74987'), 'sell': Decimal('9.74887')}, 'USDJPY': {'buy': Decimal('148.714'), 'sell': Decimal('148.60799999999998')}, 'EURAUD': {'buy': Decimal('1.7810100000000002'), 'sell': Decimal('1.7806')}, 'JP225': {'buy': Decimal('39569.7900000000'), 'sell': Decimal('39569.7900000000')}}
2025-07-16 03:38:39,497 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:38:39,497 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:38:39,859 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=BUY, Entry=0.64743000, Current=0.65219, Quantity=0.10000000, Contract Size=100000.00000000, PnL=47.600000000000000000000000, PnL USD=47.600000000000000000000000, Commission=1.00000000, Final PnL=46.600000000000000000000000
2025-07-16 03:38:39,860 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=SELL, Entry=0.64707000, Current=0.65249, Quantity=0.22000000, Contract Size=100000.00000000, PnL=-119.240000000000000000000000, PnL USD=-119.240000000000000000000000, Commission=2.20000000, Final PnL=-121.440000000000000000000000
2025-07-16 03:38:39,861 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=BUY, Entry=1.57561500, Current=1.602475, Quantity=0.10000000, Contract Size=100000.00000000, PnL=268.600000000000000000000000, PnL USD=209.0597758405977584059775841, Commission=1.00000000, Final PnL=208.0597758405977584059775841
2025-07-16 03:38:39,874 - DEBUG - app.firebase_stream - Firebase listener triggered (107). Event Type: patch, Path: /. Timestamp: 1752662319.8749356
2025-07-16 03:38:39,875 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=SELL, Entry=1.57505500, Current=1.6028749999999998, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-278.1999999999980000000000000, PnL USD=-216.5317559153160024906600249, Commission=1.00000000, Final PnL=-217.5317559153160024906600249
2025-07-16 03:38:39,876 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0657000000', 'o': '13.0631300000'}, 'XAGUSD': {'b': '38.0560000000', 'o': '38.0520000000'}, 'GBPAUD': {'b': '2.0542400000', 'o': '2.0540600000'}, 'BTCUSD': {'b': '118872.420000000
2025-07-16 03:38:39,877 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0657000000', 'o': '13.0631300000'}, 'XAGUSD': {'b': '38.0560000000', 'o': '38.0520000000'}, 'GBPAUD': {'b': '2.0542400000', 'o': '2.0540600000'}, 'BTCUSD': {'b': '118872.420000000...
2025-07-16 03:38:39,877 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:39,878 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=SELL, Entry=106.24150000, Current=108.3685, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-31905.00000000000000000000000, PnL USD=-214.6114728515309691653661949, Commission=0E-8, Final PnL=-214.6114728515309691653661949
2025-07-16 03:38:39,879 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=BUY, Entry=106.27050000, Current=108.3355, Quantity=0.15000000, Contract Size=100000.00000000, PnL=30975.00000000000000000000000, PnL USD=208.3557552601840391755905936, Commission=0E-8, Final PnL=208.3557552601840391755905936
2025-07-16 03:38:39,880 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77481000, Current=1.7806, Quantity=0.22000000, Contract Size=100000.00000000, PnL=127.380000000000000000000000, PnL USD=83.09506920000000000000000000, Commission=2.20000000, Final PnL=80.89506920000000000000000000
2025-07-16 03:38:39,880 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77439000, Current=1.7810100000000002, Quantity=0.21000000, Contract Size=100000.00000000, PnL=-139.0200000000042000000000000, PnL USD=-90.68830680000273982800000000, Commission=2.10000000, Final PnL=-92.78830680000273982800000000
2025-07-16 03:38:39,886 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=BUY, Entry=178.15500000, Current=185.41500000000002, Quantity=0.10000000, Contract Size=100000.00000000, PnL=72600.00000000020000000000000, PnL USD=488.3495668083745896787386321, Commission=1.00000000, Final PnL=487.3495668083745896787386321
2025-07-16 03:38:39,896 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=SELL, Entry=178.09500000, Current=185.46499999999997, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-73699.99999999970000000000000, PnL USD=-495.7488026691041543346068988, Commission=1.00000000, Final PnL=-496.7488026691041543346068988
2025-07-16 03:38:39,897 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77480000, Current=1.7806, Quantity=0.05000000, Contract Size=100000.00000000, PnL=29.000000000000000000000000, PnL USD=18.91786000000000000000000000, Commission=0.50000000, Final PnL=18.41786000000000000000000000
2025-07-16 03:38:39,897 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77442000, Current=1.7810100000000002, Quantity=0.05000000, Contract Size=100000.00000000, PnL=-32.95000000000100000000000000, PnL USD=-21.49460300000065234000000000, Commission=0.50000000, Final PnL=-21.99460300000065234000000000
2025-07-16 03:38:39,897 - DEBUG - app.services.portfolio_calculator - Position calculation for EURGBP: Type=SELL, Entry=0.85403000, Current=0.8671, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-130.700000000000000000000000, PnL USD=-175.1432280000000000000000000, Commission=1.00000000, Final PnL=-176.1432280000000000000000000
2025-07-16 03:38:39,903 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=BUY, Entry=167.26050000, Current=172.6835, Quantity=0.10000000, Contract Size=100000.00000000, PnL=54230.00000000000000000000000, PnL USD=364.7823279341333476833665178, Commission=1.00000000, Final PnL=363.7823279341333476833665178
2025-07-16 03:38:39,909 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=SELL, Entry=167.23150000, Current=172.71349999999998, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-54819.99999999980000000000000, PnL USD=-368.7510089867069364472905344, Commission=1.00000000, Final PnL=-369.7510089867069364472905344
2025-07-16 03:38:39,910 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=SELL, Entry=1.91952500, Current=1.954885, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-353.600000000000000000000000, PnL USD=-210.1550880000000000000000000, Commission=1.00000000, Final PnL=-211.1550880000000000000000000
2025-07-16 03:38:39,910 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=BUY, Entry=1.92063500, Current=1.9544650000000001, Quantity=0.10000000, Contract Size=100000.00000000, PnL=338.3000000000010000000000000, PnL USD=201.0618390000005943300000000, Commission=1.00000000, Final PnL=200.0618390000005943300000000
2025-07-16 03:38:39,911 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34376000, Current=1.3401399999999999, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-32, PnL USD=0E-32, Commission=2.50000000, Final PnL=-2.500000000000000000000000000
2025-07-16 03:38:39,911 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34361000, Current=1.3401399999999999, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-32, PnL USD=0E-32, Commission=2.50000000, Final PnL=-2.500000000000000000000000000
2025-07-16 03:38:39,911 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34379000, Current=1.33993, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:38:39,912 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34378000, Current=1.33993, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:38:39,914 - DEBUG - app.services.portfolio_calculator - Position calculation for NZDJPY: Type=BUY, Entry=87.10150000, Current=88.33449999999999, Quantity=0.01000000, Contract Size=100000.00000000, PnL=1232.999999999990000000000000, PnL USD=8.293870742076023785180003229, Commission=0.10000000, Final PnL=8.193870742076023785180003229
2025-07-16 03:38:39,917 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=SELL, Entry=0.81771000, Current=0.80181, Quantity=0.15000000, Contract Size=100000.00000000, PnL=238.500000000000000000000000, PnL USD=297.5076715814684529601077764, Commission=1.50000000, Final PnL=296.0076715814684529601077764
2025-07-16 03:38:39,918 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:39,921 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=BUY, Entry=0.81805000, Current=0.80149, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-248.400000000000000000000000, PnL USD=-309.8570466282463887433575331, Commission=1.50000000, Final PnL=-311.3570466282463887433575331
2025-07-16 03:38:39,926 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.04973000, Current=10.29721, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2474.800000000000000000000000, PnL USD=240.3213088519190357627006724, Commission=1.00000000, Final PnL=239.3213088519190357627006724
2025-07-16 03:38:39,929 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.05023000, Current=10.29721, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2469.800000000000000000000000, PnL USD=239.8357720229794870400509619, Commission=1.00000000, Final PnL=238.8357720229794870400509619
2025-07-16 03:38:39,930 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:39,935 - DEBUG - app.services.portfolio_calculator - Position calculation for USDSGD: Type=SELL, Entry=1.28795000, Current=1.28495, Quantity=0.31000000, Contract Size=100000.00000000, PnL=93.000000000000000000000000, PnL USD=72.38480697384806973848069738, Commission=3.10000000, Final PnL=69.28480697384806973848069738
2025-07-16 03:38:39,940 - DEBUG - app.services.portfolio_calculator - Position calculation for USDTRY: Type=SELL, Entry=39.56087000, Current=40.25992, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-6990.500000000000000000000000, PnL USD=-173.6348717342399124485808041, Commission=1.00000000, Final PnL=-174.6348717342399124485808041
2025-07-16 03:38:39,941 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '98181.73000000', 'equity': '98228.73943963043364276233145', 'margin': '1917.31000000', 'free_margin': '96311.42943963043364276233145', 'profit_loss': '47.0094396304336427623314487', 'margin_level': '5123.258077182637843789597480', 'positions': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.600000000000000000000000', 'current_price': '0.65219'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-121.440000000000000000000000', 'current_price': '0.65249'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.0597758405977584059775841', 'current_price': '1.602475'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.5317559153160024906600249', 'current_price': '1.6028749999999998'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-214.6114728515309691653661949', 'current_price': '108.3685'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.3557552601840391755905936', 'current_price': '108.3355'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '80.89506920000000000000000000', 'current_price': '1.7806'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-92.78830680000273982800000000', 'current_price': '1.7810100000000002'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '487.3495668083745896787386321', 'current_price': '185.41500000000002'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-496.7488026691041543346068988', 'current_price': '185.46499999999997'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.41786000000000000000000000', 'current_price': '1.7806'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-21.99460300000065234000000000', 'current_price': '1.7810100000000002'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-176.1432280000000000000000000', 'current_price': '0.8671'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '363.7823279341333476833665178', 'current_price': '172.6835'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-369.7510089867069364472905344', 'current_price': '172.71349999999998'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.1550880000000000000000000', 'current_price': '1.954885'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '200.0618390000005943300000000', 'current_price': '1.9544650000000001'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000000', 'current_price': '1.3401399999999999'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000000', 'current_price': '1.3401399999999999'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33993'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33993'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.193870742076023785180003229', 'current_price': '88.33449999999999'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '296.0076715814684529601077764', 'current_price': '0.80181'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.3570466282463887433575331', 'current_price': '0.80149'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '239.3213088519190357627006724', 'current_price': '10.29721'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.8357720229794870400509619', 'current_price': '10.29721'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '69.28480697384806973848069738', 'current_price': '1.28495'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.6348717342399124485808041', 'current_price': '40.25992'}], 'margin_call': False}
2025-07-16 03:38:39,942 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '98181.73000000', 'equity': '98228.73943963043364276233145', 'margin': '1917.31000000', 'free_margin': '96311.42943963043364276233145', 'profit_loss': '47.0094396304336427623314487', 'margin_level': '5123.258077182637843789597480', 'positions_with_pnl': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.600000000000000000000000', 'current_price': '0.65219'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-121.440000000000000000000000', 'current_price': '0.65249'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.0597758405977584059775841', 'current_price': '1.602475'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.5317559153160024906600249', 'current_price': '1.6028749999999998'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-214.6114728515309691653661949', 'current_price': '108.3685'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.3557552601840391755905936', 'current_price': '108.3355'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '80.89506920000000000000000000', 'current_price': '1.7806'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-92.78830680000273982800000000', 'current_price': '1.7810100000000002'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '487.3495668083745896787386321', 'current_price': '185.41500000000002'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-496.7488026691041543346068988', 'current_price': '185.46499999999997'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.41786000000000000000000000', 'current_price': '1.7806'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-21.99460300000065234000000000', 'current_price': '1.7810100000000002'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-176.1432280000000000000000000', 'current_price': '0.8671'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '363.7823279341333476833665178', 'current_price': '172.6835'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-369.7510089867069364472905344', 'current_price': '172.71349999999998'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.1550880000000000000000000', 'current_price': '1.954885'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '200.0618390000005943300000000', 'current_price': '1.9544650000000001'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000000', 'current_price': '1.3401399999999999'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000000', 'current_price': '1.3401399999999999'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33993'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33993'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.193870742076023785180003229', 'current_price': '88.33449999999999'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '296.0076715814684529601077764', 'current_price': '0.80181'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.3570466282463887433575331', 'current_price': '0.80149'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '239.3213088519190357627006724', 'current_price': '10.29721'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.8357720229794870400509619', 'current_price': '10.29721'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '69.28480697384806973848069738', 'current_price': '1.28495'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.6348717342399124485808041', 'current_price': '40.25992'}], 'margin_call': False}
2025-07-16 03:38:39,955 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 5123.258077182637843789597480
2025-07-16 03:38:39,960 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:38:39,960 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-16 03:38:39,960 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (demo) from cache/DB...
2025-07-16 03:38:39,962 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:40,005 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:38:40,009 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:38:40,009 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:38:40,012 - DEBUG - app - [AUTO-CUTOFF] User 10 has 1 pending orders.
2025-07-16 03:38:40,012 - DEBUG - app - [AUTO-CUTOFF] User 10 total positions for portfolio calculation: 1
2025-07-16 03:38:40,071 - DEBUG - app - [AUTO-CUTOFF] User 10 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616')}, 'USDZAR': {'buy': Decimal('17.915750000000003'), 'sell': Decimal('17.91057')}, 'SGDJPY': {'buy': Decimal('115.7305'), 'sell': Decimal('115.68549999999999')}, 'GBPAUD': {'buy': Decimal('2.05437'), 'sell': Decimal('2.05389')}, 'USDNOK': {'buy': Decimal('10.298079999999999'), 'sell': Decimal('10.29721')}, 'NZDCAD': {'buy': Decimal('0.81557'), 'sell': Decimal('0.8152')}, 'GBPNZD': {'buy': Decimal('2.2549900000000003'), 'sell': Decimal('2.25448')}, 'US30': {'buy': Decimal('44051.5'), 'sell': Decimal('44049.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3685'), 'sell': Decimal('108.3355')}, 'USDCHF': {'buy': Decimal('0.80181'), 'sell': Decimal('0.80149')}, 'USDTRY': {'buy': Decimal('40.25992'), 'sell': Decimal('40.258')}, 'GBPSEK': {'buy': Decimal('13.06565'), 'sell': Decimal('13.062750000000001')}, 'GBPNOK': {'buy': Decimal('13.799949999999999'), 'sell': Decimal('13.79765')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.1825')}, 'EURCHF': {'buy': Decimal('0.93147'), 'sell': Decimal('0.93111')}, 'XAGUSD': {'buy': Decimal('38.08'), 'sell': Decimal('38.046')}, 'BTCUSD': {'buy': Decimal('118961.3'), 'sell': Decimal('118861.2')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.963569999999999'), 'sell': Decimal('11.9619')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.3718899999999998')}, 'NOKSEK': {'buy': Decimal('0.947045'), 'sell': Decimal('0.946495')}, 'CADCHF': {'buy': Decimal('0.584445'), 'sell': Decimal('0.5841449999999999')}, 'GBPUSD': {'buy': Decimal('1.3401399999999999'), 'sell': Decimal('1.33993')}, 'CHFSGD': {'buy': Decimal('1.6028749999999998'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.8671'), 'sell': Decimal('0.86676')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.03099999999999'), 'sell': Decimal('96.925')}, 'EURJPY': {'buy': Decimal('172.71349999999998'), 'sell': Decimal('172.6835')}, 'AUDCHF': {'buy': Decimal('0.52318'), 'sell': Decimal('0.5227200000000001')}, 'EURZAR': {'buy': Decimal('20.81353'), 'sell': Decimal('20.806669999999997')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'D30': {'buy': Decimal('24130.8'), 'sell': Decimal('24130.8')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65219')}, 'EURSEK': {'buy': Decimal('11.32687'), 'sell': Decimal('11.324810000000001')}, 'NZDJPY': {'buy': Decimal('88.3665'), 'sell': Decimal('88.33449999999999')}, 'USDSGD': {'buy': Decimal('1.28495'), 'sell': Decimal('1.2846099999999998')}, 'EURSGD': {'buy': Decimal('1.4926949999999999'), 'sell': Decimal('1.492335')}, 'NZDUSD': {'buy': Decimal('0.59448'), 'sell': Decimal('0.59416')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25665'), 'sell': Decimal('4.2557')}, 'AUDCAD': {'buy': Decimal('0.8950500000'), 'sell': Decimal('0.8950200000')}, 'EURCAD': {'buy': Decimal('1.59399'), 'sell': Decimal('1.59377')}, 'EURNZD': {'buy': Decimal('1.954885'), 'sell': Decimal('1.9544650000000001')}, 'USDSEK': {'buy': Decimal('9.74987'), 'sell': Decimal('9.74887')}, 'USDJPY': {'buy': Decimal('148.714'), 'sell': Decimal('148.60799999999998')}, 'EURAUD': {'buy': Decimal('1.7810100000000002'), 'sell': Decimal('1.7806')}, 'JP225': {'buy': Decimal('39569.7900000000'), 'sell': Decimal('39569.7900000000')}}
2025-07-16 03:38:40,071 - DEBUG - app - [AUTO-CUTOFF] User 10 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:38:40,071 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-16 03:38:40,477 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions': [], 'margin_call': False}
2025-07-16 03:38:40,477 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions_with_pnl': [], 'margin_call': False}
2025-07-16 03:38:40,478 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 25371.71974522292993630573248
2025-07-16 03:38:40,479 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-16 03:38:40,480 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-16 03:38:40,480 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (demo) from cache/DB...
2025-07-16 03:38:40,481 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:40,531 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:38:40,536 - DEBUG - app - [AUTO-CUTOFF] User 11 has 1 open orders.
2025-07-16 03:38:40,537 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:38:40,542 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:38:40,542 - DEBUG - app - [AUTO-CUTOFF] User 11 total positions for portfolio calculation: 1
2025-07-16 03:38:40,610 - DEBUG - app - [AUTO-CUTOFF] User 11 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16178'), 'sell': Decimal('1.1616')}, 'USDZAR': {'buy': Decimal('17.915750000000003'), 'sell': Decimal('17.91057')}, 'SGDJPY': {'buy': Decimal('115.7305'), 'sell': Decimal('115.68549999999999')}, 'GBPAUD': {'buy': Decimal('2.05439'), 'sell': Decimal('2.05391')}, 'USDNOK': {'buy': Decimal('10.29829'), 'sell': Decimal('10.297220000000001')}, 'NZDCAD': {'buy': Decimal('0.81557'), 'sell': Decimal('0.8152')}, 'GBPNZD': {'buy': Decimal('2.255'), 'sell': Decimal('2.25448')}, 'US30': {'buy': Decimal('44051.5'), 'sell': Decimal('44049.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3685'), 'sell': Decimal('108.3355')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015100000000001')}, 'USDTRY': {'buy': Decimal('40.25966'), 'sell': Decimal('40.25782')}, 'GBPSEK': {'buy': Decimal('13.06585'), 'sell': Decimal('13.06298')}, 'GBPNOK': {'buy': Decimal('13.79985'), 'sell': Decimal('13.797550000000001')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.1825')}, 'EURCHF': {'buy': Decimal('0.93145'), 'sell': Decimal('0.93111')}, 'XAGUSD': {'buy': Decimal('38.071'), 'sell': Decimal('38.037')}, 'BTCUSD': {'buy': Decimal('118922.42'), 'sell': Decimal('118812.42')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96347'), 'sell': Decimal('11.9618')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.3718899999999998')}, 'NOKSEK': {'buy': Decimal('0.947045'), 'sell': Decimal('0.946495')}, 'CADCHF': {'buy': Decimal('0.584445'), 'sell': Decimal('0.5841449999999999')}, 'GBPUSD': {'buy': Decimal('1.3401399999999999'), 'sell': Decimal('1.33993')}, 'CHFSGD': {'buy': Decimal('1.602855'), 'sell': Decimal('1.6024450000000001')}, 'EURGBP': {'buy': Decimal('0.86708'), 'sell': Decimal('0.86675')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.03099999999999'), 'sell': Decimal('96.925')}, 'EURJPY': {'buy': Decimal('172.7115'), 'sell': Decimal('172.6815')}, 'AUDCHF': {'buy': Decimal('0.52318'), 'sell': Decimal('0.52273')}, 'EURZAR': {'buy': Decimal('20.812990000000003'), 'sell': Decimal('20.80613')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'D30': {'buy': Decimal('24130.8'), 'sell': Decimal('24130.8')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65219')}, 'EURSEK': {'buy': Decimal('11.32685'), 'sell': Decimal('11.325050000000001')}, 'NZDJPY': {'buy': Decimal('88.3665'), 'sell': Decimal('88.33449999999999')}, 'USDSGD': {'buy': Decimal('1.28496'), 'sell': Decimal('1.2846099999999998')}, 'EURSGD': {'buy': Decimal('1.492665'), 'sell': Decimal('1.492335')}, 'NZDUSD': {'buy': Decimal('0.59448'), 'sell': Decimal('0.5941500000000001')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.256609999999999'), 'sell': Decimal('4.255660000000001')}, 'AUDCAD': {'buy': Decimal('0.8950500000'), 'sell': Decimal('0.8950200000')}, 'EURCAD': {'buy': Decimal('1.5939699999999999'), 'sell': Decimal('1.59376')}, 'EURNZD': {'buy': Decimal('1.9548649999999999'), 'sell': Decimal('1.954445')}, 'USDSEK': {'buy': Decimal('9.750029999999999'), 'sell': Decimal('9.7491')}, 'USDJPY': {'buy': Decimal('148.71'), 'sell': Decimal('148.60899999999998')}, 'EURAUD': {'buy': Decimal('1.78096'), 'sell': Decimal('1.7805799999999998')}, 'JP225': {'buy': Decimal('39569.7900000000'), 'sell': Decimal('39569.7900000000')}}
2025-07-16 03:38:40,611 - DEBUG - app - [AUTO-CUTOFF] User 11 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:38:40,611 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-16 03:38:40,944 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDCAD: Type=BUY, Entry=0.89752000, Current=0.8950200000, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-2.50000000000000000000000000, PnL USD=-1.822064471929274745457593271, Commission=0.10000000, Final PnL=-1.922064471929274745457593271
2025-07-16 03:38:40,944 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '99998.61000000', 'equity': '99996.68793552807072525454241', 'margin': '6.55', 'free_margin': '99990.13793552807072525454241', 'profit_loss': '-1.922064471929274745457593271', 'margin_level': '1526666.991382107950003886144', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.922064471929274745457593271', 'current_price': '0.8950200000'}], 'margin_call': False}
2025-07-16 03:38:40,944 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 11: {'balance': '99998.61000000', 'equity': '99996.68793552807072525454241', 'margin': '6.55', 'free_margin': '99990.13793552807072525454241', 'profit_loss': '-1.922064471929274745457593271', 'margin_level': '1526666.991382107950003886144', 'positions_with_pnl': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.922064471929274745457593271', 'current_price': '0.8950200000'}], 'margin_call': False}
2025-07-16 03:38:40,945 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 1526666.991382107950003886144
2025-07-16 03:38:40,946 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-16 03:38:40,946 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-16 03:38:40,946 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (demo) from cache/DB...
2025-07-16 03:38:40,947 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:40,950 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:40,954 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:40,969 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:38:40,973 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:38:40,973 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:38:40,976 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:38:40,976 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:40,976 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-16 03:38:40,976 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (demo) from cache/DB...
2025-07-16 03:38:40,978 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:38:41,002 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:38:41,007 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:38:41,008 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:38:41,011 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:38:41,012 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:38:41,970 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:41,973 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:42,197 - DEBUG - app.firebase_stream - Firebase listener triggered (108). Event Type: patch, Path: /. Timestamp: 1752662322.197413
2025-07-16 03:38:42,198 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0510000000'}, 'NZDJPY': {'b': '88.3540000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0542300000',
2025-07-16 03:38:42,198 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0510000000'}, 'NZDJPY': {'b': '88.3540000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0542300000',...
2025-07-16 03:38:42,199 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:42,987 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:42,990 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:44,007 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:44,010 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:44,686 - DEBUG - app.firebase_stream - Firebase listener triggered (109). Event Type: patch, Path: /. Timestamp: 1752662324.6864047
2025-07-16 03:38:44,686 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0510000000', 'o': '38.0440000000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542300000'}, 'USDJPY': {'b': '148.6600000000',
2025-07-16 03:38:44,686 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0510000000', 'o': '38.0440000000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542300000'}, 'USDJPY': {'b': '148.6600000000',...
2025-07-16 03:38:44,687 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:45,026 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:45,029 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:46,034 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:46,041 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:46,948 - DEBUG - app.firebase_stream - Firebase listener triggered (110). Event Type: patch, Path: /. Timestamp: 1752662326.9485319
2025-07-16 03:38:46,949 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0672000000', 'o': '13.0647400000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544300000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118851.100000000
2025-07-16 03:38:46,950 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0672000000', 'o': '13.0647400000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544300000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118851.100000000...
2025-07-16 03:38:46,951 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:47,047 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:47,057 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:48,075 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:48,078 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:49,082 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:49,085 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:49,292 - DEBUG - app.firebase_stream - Firebase listener triggered (111). Event Type: patch, Path: /. Timestamp: 1752662329.2925112
2025-07-16 03:38:49,293 - DEBUG - app.firebase_stream - Prepared batch update for 18 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3530000000', 'o': '88.3450000000'}, 'BTCUSD': {'b': '118873.2000000000', 'o': '118873.1000000000'}, 'CADCHF': {'b': '0.5843400000', 'o': '0.5842800000'}, 'EURZAR': {'b': '20.81301
2025-07-16 03:38:49,294 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3530000000', 'o': '88.3450000000'}, 'BTCUSD': {'b': '118873.2000000000', 'o': '118873.1000000000'}, 'CADCHF': {'b': '0.5843400000', 'o': '0.5842800000'}, 'EURZAR': {'b': '20.81301...
2025-07-16 03:38:49,294 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:50,093 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:50,096 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:51,102 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:51,106 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:51,543 - DEBUG - app.firebase_stream - Firebase listener triggered (112). Event Type: patch, Path: /. Timestamp: 1752662331.5436192
2025-07-16 03:38:51,544 - DEBUG - app.firebase_stream - Prepared batch update for 17 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3520000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542700000'}, 'BTCUSD': {'b': '118851.1000000000', 'o': '118851.0000000000'}, 'USDJPY': {'b': '148.6570
2025-07-16 03:38:51,544 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3520000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542700000'}, 'BTCUSD': {'b': '118851.1000000000', 'o': '118851.0000000000'}, 'USDJPY': {'b': '148.6570...
2025-07-16 03:38:51,544 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:52,123 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:52,127 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:53,137 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:53,140 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:53,797 - DEBUG - app.firebase_stream - Firebase listener triggered (113). Event Type: patch, Path: /. Timestamp: 1752662333.7971973
2025-07-16 03:38:53,797 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0670000000', 'o': '13.0647400000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3440000000'}, 'USDJPY': {'b': '148.6570000000', 'o': '148.6520000000'}, 'EURNZD': {'b': '1.9547200000
2025-07-16 03:38:53,798 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0670000000', 'o': '13.0647400000'}, 'NZDJPY': {'b': '88.3530000000', 'o': '88.3440000000'}, 'USDJPY': {'b': '148.6570000000', 'o': '148.6520000000'}, 'EURNZD': {'b': '1.9547200000...
2025-07-16 03:38:53,798 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:54,155 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:54,158 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:55,164 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:55,169 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:56,157 - DEBUG - app.firebase_stream - Firebase listener triggered (114). Event Type: patch, Path: /. Timestamp: 1752662336.15717
2025-07-16 03:38:56,157 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0470000000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0542700000'}, 'BTCUSD': {'b': '118846.680000000
2025-07-16 03:38:56,158 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0470000000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0542700000'}, 'BTCUSD': {'b': '118846.680000000...
2025-07-16 03:38:56,158 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:56,182 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:56,194 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:57,212 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:57,217 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:58,227 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:58,233 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:38:58,407 - DEBUG - app.firebase_stream - Firebase listener triggered (115). Event Type: patch, Path: /. Timestamp: 1752662338.4077268
2025-07-16 03:38:58,408 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0668000000', 'o': '13.0647500000'}, 'XAGUSD': {'b': '38.0520000000', 'o': '38.0450000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544500000',
2025-07-16 03:38:58,408 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0668000000', 'o': '13.0647500000'}, 'XAGUSD': {'b': '38.0520000000', 'o': '38.0450000000'}, 'NZDJPY': {'b': '88.3510000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544500000',...
2025-07-16 03:38:58,408 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:38:59,239 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:38:59,242 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:00,257 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:00,260 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:00,761 - DEBUG - app.firebase_stream - Firebase listener triggered (116). Event Type: patch, Path: /. Timestamp: 1752662340.7615554
2025-07-16 03:39:00,761 - DEBUG - app.firebase_stream - Prepared batch update for 19 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0670000000', 'o': '13.0647400000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0480000000'}, 'BTCUSD': {'b': '118835.9900000000', 'o': '118835.9900000000'}, 'CADCHF': {'b': '0.5843
2025-07-16 03:39:00,762 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0670000000', 'o': '13.0647400000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0480000000'}, 'BTCUSD': {'b': '118835.9900000000', 'o': '118835.9900000000'}, 'CADCHF': {'b': '0.5843...
2025-07-16 03:39:00,763 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:01,263 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:01,266 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:02,278 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:02,281 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:03,028 - DEBUG - app.firebase_stream - Firebase listener triggered (117). Event Type: patch, Path: /. Timestamp: 1752662343.028586
2025-07-16 03:39:03,029 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3510000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543100000'}, 'BTCUSD': {'b': '118844.6400000000', 'o': '118844.6400000000'}, 'EURNZD': {'b': '1.954760
2025-07-16 03:39:03,029 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3510000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543100000'}, 'BTCUSD': {'b': '118844.6400000000', 'o': '118844.6400000000'}, 'EURNZD': {'b': '1.954760...
2025-07-16 03:39:03,030 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:03,293 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:03,296 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:04,312 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:04,316 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:05,268 - DEBUG - app.firebase_stream - Firebase listener triggered (118). Event Type: patch, Path: /. Timestamp: 1752662345.268357
2025-07-16 03:39:05,269 - DEBUG - app.firebase_stream - Prepared batch update for 22 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0667000000', 'o': '13.0641000000'}, 'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0544600000',
2025-07-16 03:39:05,270 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0667000000', 'o': '13.0641000000'}, 'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0544600000',...
2025-07-16 03:39:05,270 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:05,327 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:05,342 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:06,358 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:06,361 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:07,378 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:07,381 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:07,624 - DEBUG - app.firebase_stream - Firebase listener triggered (119). Event Type: patch, Path: /. Timestamp: 1752662347.624794
2025-07-16 03:39:07,625 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3510000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543000000'}, 'CADCHF': {'b': '0.5843400000', 'o': '0.5842800000'}, 'EURNZD': {'b': '1.9546400000', 'o'
2025-07-16 03:39:07,626 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'NZDJPY': {'b': '88.3510000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543000000'}, 'CADCHF': {'b': '0.5843400000', 'o': '0.5842800000'}, 'EURNZD': {'b': '1.9546400000', 'o'...
2025-07-16 03:39:07,626 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:08,382 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:08,385 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:09,396 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:09,399 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:09,886 - DEBUG - app.firebase_stream - Firebase listener triggered (120). Event Type: patch, Path: /. Timestamp: 1752662349.886147
2025-07-16 03:39:09,887 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0665000000', 'o': '13.0643300000'}, 'NZDJPY': {'b': '88.3570000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543100000'}, 'USDCNH': {'b': '7.1826600000', '
2025-07-16 03:39:09,887 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0665000000', 'o': '13.0643300000'}, 'NZDJPY': {'b': '88.3570000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543100000'}, 'USDCNH': {'b': '7.1826600000', '...
2025-07-16 03:39:09,888 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:10,416 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:10,419 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:11,434 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:11,438 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:12,128 - DEBUG - app.firebase_stream - Firebase listener triggered (121). Event Type: patch, Path: /. Timestamp: 1752662352.1281476
2025-07-16 03:39:12,128 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0667000000', 'o': '13.0641000000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0544600000', 'o': '2.0543000000'}, 'BTCUSD': {'b': '118848.300000000
2025-07-16 03:39:12,129 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0667000000', 'o': '13.0641000000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0544600000', 'o': '2.0543000000'}, 'BTCUSD': {'b': '118848.300000000...
2025-07-16 03:39:12,129 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:12,453 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:12,457 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:13,472 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:13,475 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:14,427 - DEBUG - app.firebase_stream - Firebase listener triggered (122). Event Type: patch, Path: /. Timestamp: 1752662354.4274073
2025-07-16 03:39:14,427 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542500000'}, 'BTCUSD': {'b': '118844.640000000
2025-07-16 03:39:14,428 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542500000'}, 'BTCUSD': {'b': '118844.640000000...
2025-07-16 03:39:14,428 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:14,485 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:14,497 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:15,511 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:15,514 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:16,528 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:16,532 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:16,739 - DEBUG - app.firebase_stream - Firebase listener triggered (123). Event Type: patch, Path: /. Timestamp: 1752662356.7397754
2025-07-16 03:39:16,740 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0664000000', 'o': '13.0639000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0544000000', 'o': '2.0542300000'}, 'EURNZD': {'b': '1.9546200000', '
2025-07-16 03:39:16,740 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0664000000', 'o': '13.0639000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0544000000', 'o': '2.0542300000'}, 'EURNZD': {'b': '1.9546200000', '...
2025-07-16 03:39:16,741 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:17,537 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:17,543 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:18,558 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:18,561 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:19,091 - DEBUG - app.firebase_stream - Firebase listener triggered (124). Event Type: patch, Path: /. Timestamp: 1752662359.0915885
2025-07-16 03:39:19,091 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0662000000', 'o': '13.0639000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0543900000', 'o': '2.0542100000'}, 'BTCUSD': {'b': '118848.300000000
2025-07-16 03:39:19,092 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0662000000', 'o': '13.0639000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0543900000', 'o': '2.0542100000'}, 'BTCUSD': {'b': '118848.300000000...
2025-07-16 03:39:19,093 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:19,568 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:19,574 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:20,584 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:20,589 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:21,347 - DEBUG - app.firebase_stream - Firebase listener triggered (125). Event Type: patch, Path: /. Timestamp: 1752662361.347731
2025-07-16 03:39:21,348 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0661000000', 'o': '13.0635000000'}, 'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0543400000',
2025-07-16 03:39:21,348 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0661000000', 'o': '13.0635000000'}, 'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0543400000',...
2025-07-16 03:39:21,348 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:21,592 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:21,596 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:22,609 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:22,613 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:23,601 - DEBUG - app.firebase_stream - Firebase listener triggered (126). Event Type: patch, Path: /. Timestamp: 1752662363.6009934
2025-07-16 03:39:23,601 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3560000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0543400000', 'o': '2.0542000000'}, 'USDJPY': {'b': '148.6570000000', 'o': '148.6510000000'}, 'EURNZD': {'b': '1.9546500000',
2025-07-16 03:39:23,601 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3560000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0543400000', 'o': '2.0542000000'}, 'USDJPY': {'b': '148.6570000000', 'o': '148.6510000000'}, 'EURNZD': {'b': '1.9546500000',...
2025-07-16 03:39:23,602 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:23,620 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:23,636 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:24,654 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:24,658 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:25,663 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:25,668 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:25,952 - DEBUG - app.firebase_stream - Firebase listener triggered (127). Event Type: patch, Path: /. Timestamp: 1752662365.9520068
2025-07-16 03:39:25,952 - DEBUG - app.firebase_stream - Prepared batch update for 20 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3570000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0543500000', 'o': '2.0542100000'}, 'BTCUSD': {'b': '118848.0000000000', 'o': '118847.9000000000'}, 'CADCHF': {'b': '0.584340
2025-07-16 03:39:25,953 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3570000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0543500000', 'o': '2.0542100000'}, 'BTCUSD': {'b': '118848.0000000000', 'o': '118847.9000000000'}, 'CADCHF': {'b': '0.584340...
2025-07-16 03:39:25,953 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:26,678 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:26,685 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:27,691 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:27,695 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:28,206 - DEBUG - app.firebase_stream - Firebase listener triggered (128). Event Type: patch, Path: /. Timestamp: 1752662368.2062585
2025-07-16 03:39:28,206 - DEBUG - app.firebase_stream - Prepared batch update for 22 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0543500000', 'o': '2.0541800000'}, 'BTCUSD': {'b': '118846.850000000
2025-07-16 03:39:28,207 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3560000000', 'o': '88.3470000000'}, 'GBPAUD': {'b': '2.0543500000', 'o': '2.0541800000'}, 'BTCUSD': {'b': '118846.850000000...
2025-07-16 03:39:28,207 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:28,710 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:28,714 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:29,727 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:29,731 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:30,555 - DEBUG - app.firebase_stream - Firebase listener triggered (129). Event Type: patch, Path: /. Timestamp: 1752662370.555028
2025-07-16 03:39:30,555 - DEBUG - app.firebase_stream - Prepared batch update for 12 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3560000000', 'o': '88.3490000000'}, 'BTCUSD': {'b': '118836.9000000000', 'o': '118836.8000000000'}, 'EURNZD': {'b': '1.9546400000', 'o': '1.9544600000'}, 'EURZAR': {'b': '20.81759
2025-07-16 03:39:30,555 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3560000000', 'o': '88.3490000000'}, 'BTCUSD': {'b': '118836.9000000000', 'o': '118836.8000000000'}, 'EURNZD': {'b': '1.9546400000', 'o': '1.9544600000'}, 'EURZAR': {'b': '20.81759...
2025-07-16 03:39:30,556 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:30,743 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:30,749 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:31,765 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:31,769 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:32,784 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:32,789 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:32,811 - DEBUG - app.firebase_stream - Firebase listener triggered (130). Event Type: patch, Path: /. Timestamp: 1752662372.8113997
2025-07-16 03:39:32,811 - DEBUG - app.firebase_stream - Prepared batch update for 18 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0661000000', 'o': '13.0636300000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0543500000', 'o': '2.0542100000'}, 'CADCHF': {'b': '0.5843300000', '
2025-07-16 03:39:32,812 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0661000000', 'o': '13.0636300000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0543500000', 'o': '2.0542100000'}, 'CADCHF': {'b': '0.5843300000', '...
2025-07-16 03:39:32,812 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:33,793 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:33,797 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:34,814 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:34,818 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:35,067 - DEBUG - app.firebase_stream - Firebase listener triggered (131). Event Type: patch, Path: /. Timestamp: 1752662375.0672512
2025-07-16 03:39:35,067 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0662000000', 'o': '13.0636300000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0544600000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118862.100000000
2025-07-16 03:39:35,068 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0662000000', 'o': '13.0636300000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3430000000'}, 'GBPAUD': {'b': '2.0544600000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118862.100000000...
2025-07-16 03:39:35,068 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:35,821 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:35,825 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:36,830 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:36,834 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:36,847 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-16 03:39:36,847 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-16 03:39:36,891 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-16 03:39:36,892 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-16 03:39:36,892 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-16 03:39:36,892 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (live) from cache/DB...
2025-07-16 03:39:36,893 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:36,918 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:39:36,923 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:39:36,923 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:39:36,927 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:39:36,927 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:36,927 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-16 03:39:36,927 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (live) from cache/DB...
2025-07-16 03:39:36,934 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-16 03:39:36,934 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-16 03:39:36,934 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 8 (live) from cache/DB...
2025-07-16 03:39:36,935 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:39:36,944 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 8.
2025-07-16 03:39:36,944 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-16 03:39:36,944 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (live) from cache/DB...
2025-07-16 03:39:36,945 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:39:36,964 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:39:36,968 - DEBUG - app - [AUTO-CUTOFF] User 9 has 1 open orders.
2025-07-16 03:39:36,968 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:39:36,971 - DEBUG - app - [AUTO-CUTOFF] User 9 has 0 pending orders.
2025-07-16 03:39:36,971 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 1
2025-07-16 03:39:37,023 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.5231'), 'sell': Decimal('0.52285')}, 'GBPNOK': {'buy': Decimal('13.8009'), 'sell': Decimal('13.7985')}, 'AUDJPY': {'buy': Decimal('96.989'), 'sell': Decimal('96.953')}, 'EURJPY': {'buy': Decimal('172.70899999999997'), 'sell': Decimal('172.67200000000003')}, 'XAGUSD': {'buy': Decimal('38.068'), 'sell': Decimal('38.033')}, 'EURCAD': {'buy': Decimal('1.5939949999999998'), 'sell': Decimal('1.593745')}, 'GBPUSD': {'buy': Decimal('1.3402150000000002'), 'sell': Decimal('1.340055')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.749699999999999'), 'sell': Decimal('9.74867')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}, 'GBPSEK': {'buy': Decimal('13.0664'), 'sell': Decimal('13.06343')}, 'EURUSD': {'buy': Decimal('1.1617950000000001'), 'sell': Decimal('1.1615849999999999')}, 'AUDCAD': {'buy': Decimal('0.89512'), 'sell': Decimal('0.8949')}, 'D30': {'buy': Decimal('24133.05'), 'sell': Decimal('24132.05')}, 'CHFSGD': {'buy': Decimal('1.602885'), 'sell': Decimal('1.602375')}, 'USDJPY': {'buy': Decimal('148.666'), 'sell': Decimal('148.64100000000002')}, 'EURNOK': {'buy': Decimal('11.963485'), 'sell': Decimal('11.961765')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652195')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93111')}, 'GBPAUD': {'buy': Decimal('2.0545850000000003'), 'sell': Decimal('2.0541549999999997')}, 'EURGBP': {'buy': Decimal('0.867'), 'sell': Decimal('0.86669')}, 'EURNZD': {'buy': Decimal('1.954865'), 'sell': Decimal('1.9543949999999999')}, 'EURSEK': {'buy': Decimal('11.326455000000001'), 'sell': Decimal('11.324435')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58448'), 'sell': Decimal('0.58414')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.8015399999999999')}, 'USDCNH': {'buy': Decimal('7.182874999999999'), 'sell': Decimal('7.182485000000001')}, 'NZDUSD': {'buy': Decimal('0.59446'), 'sell': Decimal('0.5942500000000001')}, 'NZDJPY': {'buy': Decimal('88.367'), 'sell': Decimal('88.328')}, 'EURSGD': {'buy': Decimal('1.49269'), 'sell': Decimal('1.4923')}, 'CADJPY': {'buy': Decimal('108.36399999999999'), 'sell': Decimal('108.33')}, 'USDCZK': {'buy': Decimal('21.2445'), 'sell': Decimal('21.1795')}, 'US30': {'buy': Decimal('44053.01'), 'sell': Decimal('44051.0')}, 'GBPNZD': {'buy': Decimal('2.2550950000000003'), 'sell': Decimal('2.254645')}, 'CHFJPY': {'buy': Decimal('185.45499999999998'), 'sell': Decimal('185.405')}, 'BTCUSD': {'buy': Decimal('118912.1'), 'sell': Decimal('118802.1')}, 'USDSGD': {'buy': Decimal('1.284935'), 'sell': Decimal('1.2846250000000001')}, 'NOKSEK': {'buy': Decimal('0.9470550000000001'), 'sell': Decimal('0.946415')}, 'EURPLN': {'buy': Decimal('4.2568'), 'sell': Decimal('4.25583')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78102'), 'sell': Decimal('1.78066')}, 'SGDJPY': {'buy': Decimal('115.731'), 'sell': Decimal('115.678')}, 'EURZAR': {'buy': Decimal('20.81738'), 'sell': Decimal('20.81193')}, 'USDTRY': {'buy': Decimal('40.2595100000'), 'sell': Decimal('40.2579700000')}, 'USDNOK': {'buy': Decimal('10.298179999999999'), 'sell': Decimal('10.29701')}, 'USDZAR': {'buy': Decimal('17.920814999999997'), 'sell': Decimal('17.915515000000003')}, 'NZDCAD': {'buy': Decimal('0.81557'), 'sell': Decimal('0.81533')}, 'USDCAD': {'buy': Decimal('1.37219'), 'sell': Decimal('1.3719299999999999')}}
2025-07-16 03:39:37,023 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:39:37,023 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:39:37,413 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141921.60000000, Current=118802.1, Quantity=0.41000000, Contract Size=1.00000000, PnL=-9478.995000000000000000000000, PnL USD=-9478.995000000000000000000000, Commission=244.35000000, Final PnL=-9723.345000000000000000000000
2025-07-16 03:39:37,413 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7283378026750769852190419459% which is below threshold 100.0%
2025-07-16 03:39:37,413 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '9794.75000000', 'equity': '71.405000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9732.425000000000000000000000', 'profit_loss': '-9723.345000000000000000000000', 'margin_level': '0.7283378026750769852190419459', 'positions': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9723.345000000000000000000000', 'current_price': '118802.1'}], 'margin_call': True}
2025-07-16 03:39:37,413 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '9794.75000000', 'equity': '71.405000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9732.425000000000000000000000', 'profit_loss': '-9723.345000000000000000000000', 'margin_level': '0.7283378026750769852190419459', 'positions_with_pnl': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9723.345000000000000000000000', 'current_price': '118802.1'}], 'margin_call': True}
2025-07-16 03:39:37,425 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.7283378026750769852190419459
2025-07-16 03:39:37,426 - DEBUG - app.firebase_stream - Firebase listener triggered (132). Event Type: patch, Path: /. Timestamp: 1752662377.4268186
2025-07-16 03:39:37,427 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3450000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118868.700000000
2025-07-16 03:39:37,429 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3450000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118868.700000000...
2025-07-16 03:39:37,429 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:37,587 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:39:37,587 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-16 03:39:37,587 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (live) from cache/DB...
2025-07-16 03:39:37,589 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:37,621 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:39:37,624 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:39:37,624 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:39:37,628 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 pending orders.
2025-07-16 03:39:37,628 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:37,628 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-16 03:39:37,628 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (live) from cache/DB...
2025-07-16 03:39:37,628 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:37,647 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:39:37,650 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 open orders.
2025-07-16 03:39:37,650 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:39:37,654 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:39:37,654 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:37,654 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-16 03:39:37,654 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (live) from cache/DB...
2025-07-16 03:39:37,655 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:39:37,674 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:39:37,677 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:39:37,677 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:39:37,682 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:39:37,682 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:37,682 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-16 03:39:37,682 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (live) from cache/DB...
2025-07-16 03:39:37,683 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:37,704 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:39:37,708 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:39:37,708 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:39:37,714 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:39:37,714 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:37,714 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-16 03:39:37,714 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 14 (live) from cache/DB...
2025-07-16 03:39:37,716 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:39:37,750 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 14...
2025-07-16 03:39:37,757 - DEBUG - app - [AUTO-CUTOFF] User 14 has 3 open orders.
2025-07-16 03:39:37,757 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 14...
2025-07-16 03:39:37,761 - DEBUG - app - [AUTO-CUTOFF] User 14 has 0 pending orders.
2025-07-16 03:39:37,761 - DEBUG - app - [AUTO-CUTOFF] User 14 total positions for portfolio calculation: 3
2025-07-16 03:39:37,837 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:37,842 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:37,847 - DEBUG - app - [AUTO-CUTOFF] User 14 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.5231'), 'sell': Decimal('0.52285')}, 'GBPNOK': {'buy': Decimal('13.8009'), 'sell': Decimal('13.7985')}, 'AUDJPY': {'buy': Decimal('96.989'), 'sell': Decimal('96.953')}, 'EURJPY': {'buy': Decimal('172.70899999999997'), 'sell': Decimal('172.67200000000003')}, 'XAGUSD': {'buy': Decimal('38.068'), 'sell': Decimal('38.033')}, 'EURCAD': {'buy': Decimal('1.5939949999999998'), 'sell': Decimal('1.593745')}, 'GBPUSD': {'buy': Decimal('1.3402150000000002'), 'sell': Decimal('1.340055')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.749699999999999'), 'sell': Decimal('9.74867')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}, 'GBPSEK': {'buy': Decimal('13.0664'), 'sell': Decimal('13.06343')}, 'EURUSD': {'buy': Decimal('1.1617950000000001'), 'sell': Decimal('1.1615849999999999')}, 'AUDCAD': {'buy': Decimal('0.89512'), 'sell': Decimal('0.8949')}, 'D30': {'buy': Decimal('24133.05'), 'sell': Decimal('24132.05')}, 'CHFSGD': {'buy': Decimal('1.602885'), 'sell': Decimal('1.602375')}, 'USDJPY': {'buy': Decimal('148.666'), 'sell': Decimal('148.64100000000002')}, 'EURNOK': {'buy': Decimal('11.963485'), 'sell': Decimal('11.961765')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652195')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93111')}, 'GBPAUD': {'buy': Decimal('2.0545850000000003'), 'sell': Decimal('2.0541549999999997')}, 'EURGBP': {'buy': Decimal('0.867'), 'sell': Decimal('0.86669')}, 'EURNZD': {'buy': Decimal('1.954915'), 'sell': Decimal('1.9543949999999999')}, 'EURSEK': {'buy': Decimal('11.326455000000001'), 'sell': Decimal('11.324435')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58447'), 'sell': Decimal('0.58414')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.8015399999999999')}, 'USDCNH': {'buy': Decimal('7.1828449999999995'), 'sell': Decimal('7.182495')}, 'NZDUSD': {'buy': Decimal('0.59446'), 'sell': Decimal('0.5942500000000001')}, 'NZDJPY': {'buy': Decimal('88.367'), 'sell': Decimal('88.33')}, 'EURSGD': {'buy': Decimal('1.49269'), 'sell': Decimal('1.4923')}, 'CADJPY': {'buy': Decimal('108.365'), 'sell': Decimal('108.33')}, 'USDCZK': {'buy': Decimal('21.2445'), 'sell': Decimal('21.1795')}, 'US30': {'buy': Decimal('44053.01'), 'sell': Decimal('44051.0')}, 'GBPNZD': {'buy': Decimal('2.2551050000000004'), 'sell': Decimal('2.2546649999999997')}, 'CHFJPY': {'buy': Decimal('185.45499999999998'), 'sell': Decimal('185.41500000000002')}, 'BTCUSD': {'buy': Decimal('118918.7'), 'sell': Decimal('118818.6')}, 'USDSGD': {'buy': Decimal('1.284935'), 'sell': Decimal('1.284635')}, 'NOKSEK': {'buy': Decimal('0.9470550000000001'), 'sell': Decimal('0.946415')}, 'EURPLN': {'buy': Decimal('4.25674'), 'sell': Decimal('4.25577')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78101'), 'sell': Decimal('1.78067')}, 'SGDJPY': {'buy': Decimal('115.731'), 'sell': Decimal('115.679')}, 'EURZAR': {'buy': Decimal('20.81738'), 'sell': Decimal('20.81193')}, 'USDTRY': {'buy': Decimal('40.2595100000'), 'sell': Decimal('40.2579700000')}, 'USDNOK': {'buy': Decimal('10.29804'), 'sell': Decimal('10.29687')}, 'USDZAR': {'buy': Decimal('17.920685'), 'sell': Decimal('17.915515000000003')}, 'NZDCAD': {'buy': Decimal('0.81553'), 'sell': Decimal('0.81525')}, 'USDCAD': {'buy': Decimal('1.37218'), 'sell': Decimal('1.37192')}}
2025-07-16 03:39:37,848 - DEBUG - app - [AUTO-CUTOFF] User 14 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:39:37,848 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-16 03:39:38,229 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=141908.50000000, Current=118818.6, Quantity=0.40000000, Contract Size=1.00000000, PnL=-9235.960000000000000000000000, PnL USD=-9235.960000000000000000000000, Commission=235.57000000, Final PnL=-9471.530000000000000000000000
2025-07-16 03:39:38,230 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.953, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-1440.000000000000000000000000, PnL USD=-9.686728509252843794775893500, Commission=1.00000000, Final PnL=-10.68672850925284379477589350
2025-07-16 03:39:38,231 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=97.09700000, Current=96.953, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-144.000000000000000000000000, PnL USD=-0.9686728509252843794775893500, Commission=0.10000000, Final PnL=-1.068672850925284379477589350
2025-07-16 03:39:38,231 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.410299876031225248231302190% which is below threshold 100.0%
2025-07-16 03:39:38,231 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '418.734598639821871825746517', 'margin': '9494.47000000', 'free_margin': '-9075.735401360178128174253483', 'profit_loss': '-9483.285401360178128174253483', 'margin_level': '4.410299876031225248231302190', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9471.530000000000000000000000', 'current_price': '118818.6'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.68672850925284379477589350', 'current_price': '96.953'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.068672850925284379477589350', 'current_price': '96.953'}], 'margin_call': True}
2025-07-16 03:39:38,231 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 14: {'balance': '9902.02000000', 'equity': '418.734598639821871825746517', 'margin': '9494.47000000', 'free_margin': '-9075.735401360178128174253483', 'profit_loss': '-9483.285401360178128174253483', 'margin_level': '4.410299876031225248231302190', 'positions_with_pnl': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9471.530000000000000000000000', 'current_price': '118818.6'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.68672850925284379477589350', 'current_price': '96.953'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.068672850925284379477589350', 'current_price': '96.953'}], 'margin_call': True}
2025-07-16 03:39:38,232 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.410299876031225248231302190
2025-07-16 03:39:38,260 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-16 03:39:38,260 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-16 03:39:38,260 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 16 (live) from cache/DB...
2025-07-16 03:39:38,260 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:39:38,282 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 16...
2025-07-16 03:39:38,289 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 open orders.
2025-07-16 03:39:38,289 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 16...
2025-07-16 03:39:38,294 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 pending orders.
2025-07-16 03:39:38,295 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,295 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-16 03:39:38,295 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 17 (live) from cache/DB...
2025-07-16 03:39:38,296 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:38,333 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 17...
2025-07-16 03:39:38,336 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 open orders.
2025-07-16 03:39:38,336 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 17...
2025-07-16 03:39:38,339 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 pending orders.
2025-07-16 03:39:38,339 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,339 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-16 03:39:38,339 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 18 (live) from cache/DB...
2025-07-16 03:39:38,340 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:38,361 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 18...
2025-07-16 03:39:38,364 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 open orders.
2025-07-16 03:39:38,364 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 18...
2025-07-16 03:39:38,366 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 pending orders.
2025-07-16 03:39:38,366 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,366 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-16 03:39:38,366 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 19 (live) from cache/DB...
2025-07-16 03:39:38,367 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Elite...
2025-07-16 03:39:38,382 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 19...
2025-07-16 03:39:38,384 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 open orders.
2025-07-16 03:39:38,384 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 19...
2025-07-16 03:39:38,387 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 pending orders.
2025-07-16 03:39:38,387 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,387 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-16 03:39:38,387 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 20 (live) from cache/DB...
2025-07-16 03:39:38,387 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:39:38,399 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 20...
2025-07-16 03:39:38,402 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 open orders.
2025-07-16 03:39:38,402 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 20...
2025-07-16 03:39:38,404 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 pending orders.
2025-07-16 03:39:38,404 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,404 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-16 03:39:38,404 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 21 (live) from cache/DB...
2025-07-16 03:39:38,405 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:38,416 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 21...
2025-07-16 03:39:38,418 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 open orders.
2025-07-16 03:39:38,418 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 21...
2025-07-16 03:39:38,420 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 pending orders.
2025-07-16 03:39:38,420 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,420 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-16 03:39:38,420 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 22 (live) from cache/DB...
2025-07-16 03:39:38,421 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group VIP...
2025-07-16 03:39:38,433 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 22...
2025-07-16 03:39:38,435 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 open orders.
2025-07-16 03:39:38,435 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 22...
2025-07-16 03:39:38,437 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 pending orders.
2025-07-16 03:39:38,437 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,437 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-16 03:39:38,437 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 23 (live) from cache/DB...
2025-07-16 03:39:38,437 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:38,452 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 23...
2025-07-16 03:39:38,474 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 open orders.
2025-07-16 03:39:38,474 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 23...
2025-07-16 03:39:38,477 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 pending orders.
2025-07-16 03:39:38,477 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,477 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-16 03:39:38,477 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 25 (live) from cache/DB...
2025-07-16 03:39:38,478 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:38,503 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 25...
2025-07-16 03:39:38,506 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 open orders.
2025-07-16 03:39:38,507 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 25...
2025-07-16 03:39:38,510 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 pending orders.
2025-07-16 03:39:38,510 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:38,510 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-16 03:39:38,510 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 26 (live) from cache/DB...
2025-07-16 03:39:38,510 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Royal+...
2025-07-16 03:39:38,547 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 26...
2025-07-16 03:39:38,551 - DEBUG - app - [AUTO-CUTOFF] User 26 has 2 open orders.
2025-07-16 03:39:38,551 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 26...
2025-07-16 03:39:38,555 - DEBUG - app - [AUTO-CUTOFF] User 26 has 0 pending orders.
2025-07-16 03:39:38,555 - DEBUG - app - [AUTO-CUTOFF] User 26 total positions for portfolio calculation: 2
2025-07-16 03:39:38,607 - DEBUG - app - [AUTO-CUTOFF] User 26 adjusted market prices: {'EURSGD': {'buy': Decimal('1.49268'), 'sell': Decimal('1.49231')}, 'USDCNH': {'buy': Decimal('7.18283'), 'sell': Decimal('7.18251')}, 'BTCUSD': {'buy': Decimal('118918.7'), 'sell': Decimal('118818.6')}, 'USDSEK': {'buy': Decimal('9.749615'), 'sell': Decimal('9.748674999999999')}, 'AUDJPY': {'buy': Decimal('96.9865'), 'sell': Decimal('96.95649999999999')}, 'EURNOK': {'buy': Decimal('11.963315'), 'sell': Decimal('11.961594999999999')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDCHF': {'buy': Decimal('0.8017799999999999'), 'sell': Decimal('0.80155')}, 'USDTRY': {'buy': Decimal('40.2595100000'), 'sell': Decimal('40.2579700000')}, 'NZDCAD': {'buy': Decimal('0.81552'), 'sell': Decimal('0.81526')}, 'GBPAUD': {'buy': Decimal('2.05452'), 'sell': Decimal('2.0541799999999997')}, 'EURCHF': {'buy': Decimal('0.93145'), 'sell': Decimal('0.93112')}, 'EURNZD': {'buy': Decimal('1.95489'), 'sell': Decimal('1.9544199999999998')}, 'USDCZK': {'buy': Decimal('21.243'), 'sell': Decimal('21.181')}, 'EURCAD': {'buy': Decimal('1.5939949999999998'), 'sell': Decimal('1.593745')}, 'EURSEK': {'buy': Decimal('11.326455000000001'), 'sell': Decimal('11.324435')}, 'CHFSGD': {'buy': Decimal('1.602885'), 'sell': Decimal('1.602375')}, 'EURGBP': {'buy': Decimal('0.867'), 'sell': Decimal('0.8667')}, 'NZDJPY': {'buy': Decimal('88.3645'), 'sell': Decimal('88.3325')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652195')}, 'EURAUD': {'buy': Decimal('1.781005'), 'sell': Decimal('1.780675')}, 'GBPNZD': {'buy': Decimal('2.2550800000000004'), 'sell': Decimal('2.2546899999999996')}, 'GBPSEK': {'buy': Decimal('13.066375'), 'sell': Decimal('13.063455')}, 'SGDJPY': {'buy': Decimal('115.731'), 'sell': Decimal('115.679')}, 'EURZAR': {'buy': Decimal('20.817355'), 'sell': Decimal('20.811955')}, 'NOKSEK': {'buy': Decimal('0.9470550000000001'), 'sell': Decimal('0.946415')}, 'USDNOK': {'buy': Decimal('10.298015000000001'), 'sell': Decimal('10.296895')}, 'USDJPY': {'buy': Decimal('148.6645'), 'sell': Decimal('148.6455')}, 'USDZAR': {'buy': Decimal('17.92067'), 'sell': Decimal('17.91553')}, 'AUDCAD': {'buy': Decimal('0.8950950000000001'), 'sell': Decimal('0.894925')}, 'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616199999999999')}, 'NZDUSD': {'buy': Decimal('0.59446'), 'sell': Decimal('0.5942500000000001')}, 'EURJPY': {'buy': Decimal('172.709'), 'sell': Decimal('172.676')}, 'CHFJPY': {'buy': Decimal('185.4525'), 'sell': Decimal('185.41750000000002')}, 'USDCAD': {'buy': Decimal('1.37217'), 'sell': Decimal('1.37193')}, 'AUDCHF': {'buy': Decimal('0.523055'), 'sell': Decimal('0.522845')}, 'GBPNOK': {'buy': Decimal('13.800975000000001'), 'sell': Decimal('13.798625')}, 'US30': {'buy': Decimal('44053.01'), 'sell': Decimal('44051.0')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'USDSGD': {'buy': Decimal('1.28492'), 'sell': Decimal('1.2846499999999998')}, 'XAGUSD': {'buy': Decimal('38.066500000000005'), 'sell': Decimal('38.0355')}, 'D30': {'buy': Decimal('24133.05'), 'sell': Decimal('24132.05')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.3402'), 'sell': Decimal('1.34007')}, 'CADJPY': {'buy': Decimal('108.3635'), 'sell': Decimal('108.33149999999999')}, 'EURPLN': {'buy': Decimal('4.25674'), 'sell': Decimal('4.25577')}}
2025-07-16 03:39:38,608 - DEBUG - app - [AUTO-CUTOFF] User 26 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:39:38,608 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-16 03:39:38,949 - DEBUG - app.services.portfolio_calculator - Position calculation for XAGUSD: Type=BUY, Entry=41.09800000, Current=38.0355, Quantity=0.01000000, Contract Size=5000.00000000, PnL=-153.125000000000000000000000, PnL USD=-153.125000000000000000000000, Commission=0.10000000, Final PnL=-153.225000000000000000000000
2025-07-16 03:39:38,949 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=132091.90000000, Current=118818.6, Quantity=6.00000000, Contract Size=1.00000000, PnL=-79639.80000000000000000000000, PnL USD=-79639.80000000000000000000000, Commission=3661.62000000, Final PnL=-83301.42000000000000000000000
2025-07-16 03:39:38,950 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.87499063893940429316500241% which is below threshold 100.0%
2025-07-16 03:39:38,951 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100891.1650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45593.3050000000000000000000', 'profit_loss': '-83454.64500000000000000000000', 'margin_level': '68.87499063893940429316500241', 'positions': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-153.225000000000000000000000', 'current_price': '38.0355'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-83301.42000000000000000000000', 'current_price': '118818.6'}], 'margin_call': True}
2025-07-16 03:39:38,952 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 26: {'balance': '184345.81000000', 'equity': '100891.1650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45593.3050000000000000000000', 'profit_loss': '-83454.64500000000000000000000', 'margin_level': '68.87499063893940429316500241', 'positions_with_pnl': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-153.225000000000000000000000', 'current_price': '38.0355'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-83301.42000000000000000000000', 'current_price': '118818.6'}], 'margin_call': True}
2025-07-16 03:39:38,955 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:38,958 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.87499063893940429316500241
2025-07-16 03:39:38,961 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-16 03:39:38,962 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-16 03:39:38,963 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 1 (demo) from cache/DB...
2025-07-16 03:39:38,965 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:38,967 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:39,002 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 1...
2025-07-16 03:39:39,009 - DEBUG - app - [AUTO-CUTOFF] User 1 has 2 open orders.
2025-07-16 03:39:39,009 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 1...
2025-07-16 03:39:39,014 - DEBUG - app - [AUTO-CUTOFF] User 1 has 1 pending orders.
2025-07-16 03:39:39,014 - DEBUG - app - [AUTO-CUTOFF] User 1 total positions for portfolio calculation: 3
2025-07-16 03:39:39,033 - DEBUG - app - [AUTO-CUTOFF] User 1 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616199999999999')}, 'USDZAR': {'buy': Decimal('17.92066'), 'sell': Decimal('17.91554')}, 'SGDJPY': {'buy': Decimal('115.7285'), 'sell': Decimal('115.6815')}, 'GBPAUD': {'buy': Decimal('2.05457'), 'sell': Decimal('2.05413')}, 'USDNOK': {'buy': Decimal('10.29799'), 'sell': Decimal('10.29692')}, 'NZDCAD': {'buy': Decimal('0.81558'), 'sell': Decimal('0.8152')}, 'GBPNZD': {'buy': Decimal('2.2551300000000003'), 'sell': Decimal('2.2546399999999998')}, 'US30': {'buy': Decimal('44053.01'), 'sell': Decimal('44051.0')}, 'CHFJPY': {'buy': Decimal('185.45499999999998'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3635'), 'sell': Decimal('108.33149999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.2595100000'), 'sell': Decimal('40.2579700000')}, 'GBPSEK': {'buy': Decimal('13.06635'), 'sell': Decimal('13.06348')}, 'GBPNOK': {'buy': Decimal('13.80095'), 'sell': Decimal('13.79865')}, 'USDCNH': {'buy': Decimal('7.1828199999999995'), 'sell': Decimal('7.18252')}, 'EURCHF': {'buy': Decimal('0.93146'), 'sell': Decimal('0.93111')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'BTCUSD': {'buy': Decimal('118918.7'), 'sell': Decimal('118818.6')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.963289999999999'), 'sell': Decimal('11.96162')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.37188')}, 'NOKSEK': {'buy': Decimal('0.9470050000000001'), 'sell': Decimal('0.946465')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34024'), 'sell': Decimal('1.34003')}, 'CHFSGD': {'buy': Decimal('1.602855'), 'sell': Decimal('1.602405')}, 'EURGBP': {'buy': Decimal('0.86702'), 'sell': Decimal('0.86668')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.024'), 'sell': Decimal('96.919')}, 'EURJPY': {'buy': Decimal('172.70749999999998'), 'sell': Decimal('172.6775')}, 'AUDCHF': {'buy': Decimal('0.52318'), 'sell': Decimal('0.5227200000000001')}, 'EURZAR': {'buy': Decimal('20.81738'), 'sell': Decimal('20.81193')}, 'USDCZK': {'buy': Decimal('21.247'), 'sell': Decimal('21.177')}, 'D30': {'buy': Decimal('24132.55'), 'sell': Decimal('24132.55')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65217')}, 'EURSEK': {'buy': Decimal('11.32643'), 'sell': Decimal('11.32446')}, 'NZDJPY': {'buy': Decimal('88.3645'), 'sell': Decimal('88.3325')}, 'USDSGD': {'buy': Decimal('1.28496'), 'sell': Decimal('1.2846099999999998')}, 'EURSGD': {'buy': Decimal('1.492665'), 'sell': Decimal('1.4923250000000001')}, 'NZDUSD': {'buy': Decimal('0.59451'), 'sell': Decimal('0.5942000000000001')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.256729999999999'), 'sell': Decimal('4.255780000000001')}, 'AUDCAD': {'buy': Decimal('0.89502'), 'sell': Decimal('0.895')}, 'EURCAD': {'buy': Decimal('1.5939699999999999'), 'sell': Decimal('1.59377')}, 'EURNZD': {'buy': Decimal('1.9548649999999999'), 'sell': Decimal('1.954445')}, 'USDSEK': {'buy': Decimal('9.74959'), 'sell': Decimal('9.7487')}, 'USDJPY': {'buy': Decimal('148.70700000000002'), 'sell': Decimal('148.60299999999998')}, 'EURAUD': {'buy': Decimal('1.78102'), 'sell': Decimal('1.78066')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}}
2025-07-16 03:39:39,033 - DEBUG - app - [AUTO-CUTOFF] User 1 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:39:39,033 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-16 03:39:39,357 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=BUY, Entry=96.66800000, Current=96.919, Quantity=0.01000000, Contract Size=100000.00000000, PnL=251.000000000000000000000000, PnL USD=1.688450594321155411450520325, Commission=0.10000000, Final PnL=1.588450594321155411450520325
2025-07-16 03:39:39,358 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDJPY: Type=SELL, Entry=96.56000000, Current=97.024, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-464.000000000000000000000000, PnL USD=-3.121279186314805222761121239, Commission=0.10000000, Final PnL=-3.221279186314805222761121239
2025-07-16 03:39:39,358 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17011.54000000', 'equity': '17009.90717140800635018868940', 'margin': '6.54000000', 'free_margin': '17003.36717140800635018868940', 'profit_loss': '-1.632828591993649811310600914', 'margin_level': '260090.3237218349594830074832', 'positions': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.588450594321155411450520325', 'current_price': '96.919'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.221279186314805222761121239', 'current_price': '97.024'}], 'margin_call': False}
2025-07-16 03:39:39,358 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 1: {'balance': '17011.54000000', 'equity': '17009.90717140800635018868940', 'margin': '6.54000000', 'free_margin': '17003.36717140800635018868940', 'profit_loss': '-1.632828591993649811310600914', 'margin_level': '260090.3237218349594830074832', 'positions_with_pnl': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.588450594321155411450520325', 'current_price': '96.919'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.221279186314805222761121239', 'current_price': '97.024'}], 'margin_call': False}
2025-07-16 03:39:39,359 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 260090.3237218349594830074832
2025-07-16 03:39:39,360 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-16 03:39:39,360 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-16 03:39:39,360 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 2 (demo) from cache/DB...
2025-07-16 03:39:39,361 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-16 03:39:39,361 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-16 03:39:39,361 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 3 (demo) from cache/DB...
2025-07-16 03:39:39,362 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:39:39,371 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 3.
2025-07-16 03:39:39,372 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-16 03:39:39,372 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (demo) from cache/DB...
2025-07-16 03:39:39,373 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:39,395 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:39:39,398 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:39:39,398 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:39:39,402 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:39:39,402 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:39,402 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-16 03:39:39,402 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (demo) from cache/DB...
2025-07-16 03:39:39,403 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-16 03:39:39,403 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-16 03:39:39,403 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 6 (demo) from cache/DB...
2025-07-16 03:39:39,404 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-16 03:39:39,404 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-16 03:39:39,404 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (demo) from cache/DB...
2025-07-16 03:39:39,405 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:39,426 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:39:39,430 - DEBUG - app - [AUTO-CUTOFF] User 9 has 28 open orders.
2025-07-16 03:39:39,431 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:39:39,434 - DEBUG - app - [AUTO-CUTOFF] User 9 has 6 pending orders.
2025-07-16 03:39:39,434 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 34
2025-07-16 03:39:39,483 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616199999999999')}, 'USDZAR': {'buy': Decimal('17.92066'), 'sell': Decimal('17.91554')}, 'SGDJPY': {'buy': Decimal('115.7285'), 'sell': Decimal('115.6815')}, 'GBPAUD': {'buy': Decimal('2.05457'), 'sell': Decimal('2.05413')}, 'USDNOK': {'buy': Decimal('10.29799'), 'sell': Decimal('10.29692')}, 'NZDCAD': {'buy': Decimal('0.81558'), 'sell': Decimal('0.8152')}, 'GBPNZD': {'buy': Decimal('2.2551300000000003'), 'sell': Decimal('2.2546399999999998')}, 'US30': {'buy': Decimal('44053.01'), 'sell': Decimal('44051.0')}, 'CHFJPY': {'buy': Decimal('185.45499999999998'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3635'), 'sell': Decimal('108.33149999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.2595100000'), 'sell': Decimal('40.2579700000')}, 'GBPSEK': {'buy': Decimal('13.06635'), 'sell': Decimal('13.06348')}, 'GBPNOK': {'buy': Decimal('13.80095'), 'sell': Decimal('13.79865')}, 'USDCNH': {'buy': Decimal('7.1828199999999995'), 'sell': Decimal('7.18252')}, 'EURCHF': {'buy': Decimal('0.93146'), 'sell': Decimal('0.93111')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'BTCUSD': {'buy': Decimal('118918.7'), 'sell': Decimal('118818.6')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.963289999999999'), 'sell': Decimal('11.96162')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.37188')}, 'NOKSEK': {'buy': Decimal('0.9470050000000001'), 'sell': Decimal('0.946465')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34024'), 'sell': Decimal('1.34003')}, 'CHFSGD': {'buy': Decimal('1.602855'), 'sell': Decimal('1.602405')}, 'EURGBP': {'buy': Decimal('0.86702'), 'sell': Decimal('0.86668')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.024'), 'sell': Decimal('96.919')}, 'EURJPY': {'buy': Decimal('172.70749999999998'), 'sell': Decimal('172.6775')}, 'AUDCHF': {'buy': Decimal('0.52318'), 'sell': Decimal('0.5227200000000001')}, 'EURZAR': {'buy': Decimal('20.81738'), 'sell': Decimal('20.81193')}, 'USDCZK': {'buy': Decimal('21.247'), 'sell': Decimal('21.177')}, 'D30': {'buy': Decimal('24132.55'), 'sell': Decimal('24132.55')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65217')}, 'EURSEK': {'buy': Decimal('11.32643'), 'sell': Decimal('11.32446')}, 'NZDJPY': {'buy': Decimal('88.3645'), 'sell': Decimal('88.3325')}, 'USDSGD': {'buy': Decimal('1.28496'), 'sell': Decimal('1.2846099999999998')}, 'EURSGD': {'buy': Decimal('1.492665'), 'sell': Decimal('1.4923250000000001')}, 'NZDUSD': {'buy': Decimal('0.59451'), 'sell': Decimal('0.5942000000000001')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.256729999999999'), 'sell': Decimal('4.255780000000001')}, 'AUDCAD': {'buy': Decimal('0.89502'), 'sell': Decimal('0.895')}, 'EURCAD': {'buy': Decimal('1.5939699999999999'), 'sell': Decimal('1.59377')}, 'EURNZD': {'buy': Decimal('1.9548649999999999'), 'sell': Decimal('1.954445')}, 'USDSEK': {'buy': Decimal('9.74959'), 'sell': Decimal('9.7487')}, 'USDJPY': {'buy': Decimal('148.70700000000002'), 'sell': Decimal('148.60299999999998')}, 'EURAUD': {'buy': Decimal('1.78102'), 'sell': Decimal('1.78066')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}}
2025-07-16 03:39:39,483 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:39:39,483 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:39:39,677 - DEBUG - app.firebase_stream - Firebase listener triggered (133). Event Type: patch, Path: /. Timestamp: 1752662379.677664
2025-07-16 03:39:39,678 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0663000000', 'o': '13.0641500000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543500000'}, 'BTCUSD': {'b': '118846.850000000
2025-07-16 03:39:39,678 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0663000000', 'o': '13.0641500000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543500000'}, 'BTCUSD': {'b': '118846.850000000...
2025-07-16 03:39:39,678 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:39,844 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=BUY, Entry=0.64743000, Current=0.65217, Quantity=0.10000000, Contract Size=100000.00000000, PnL=47.400000000000000000000000, PnL USD=47.400000000000000000000000, Commission=1.00000000, Final PnL=46.400000000000000000000000
2025-07-16 03:39:39,845 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDUSD: Type=SELL, Entry=0.64707000, Current=0.65249, Quantity=0.22000000, Contract Size=100000.00000000, PnL=-119.240000000000000000000000, PnL USD=-119.240000000000000000000000, Commission=2.20000000, Final PnL=-121.440000000000000000000000
2025-07-16 03:39:39,846 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=BUY, Entry=1.57561500, Current=1.602405, Quantity=0.10000000, Contract Size=100000.00000000, PnL=267.900000000000000000000000, PnL USD=208.5133210357951759404114227, Commission=1.00000000, Final PnL=207.5133210357951759404114227
2025-07-16 03:39:39,850 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFSGD: Type=SELL, Entry=1.57505500, Current=1.602855, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-278.000000000000000000000000, PnL USD=-216.3744055541286260225247313, Commission=1.00000000, Final PnL=-217.3744055541286260225247313
2025-07-16 03:39:39,862 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=SELL, Entry=106.24150000, Current=108.3635, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-31830.00000000000000000000000, PnL USD=-214.1141807761386797973886546, Commission=0E-8, Final PnL=-214.1141807761386797973886546
2025-07-16 03:39:39,867 - DEBUG - app.services.portfolio_calculator - Position calculation for CADJPY: Type=BUY, Entry=106.27050000, Current=108.33149999999999, Quantity=0.15000000, Contract Size=100000.00000000, PnL=30914.99999999985000000000000, PnL USD=207.9591548443071055233790083, Commission=0E-8, Final PnL=207.9591548443071055233790083
2025-07-16 03:39:39,867 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77481000, Current=1.78066, Quantity=0.22000000, Contract Size=100000.00000000, PnL=128.700000000000000000000000, PnL USD=83.95229700000000000000000000, Commission=2.20000000, Final PnL=81.75229700000000000000000000
2025-07-16 03:39:39,868 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77439000, Current=1.78102, Quantity=0.21000000, Contract Size=100000.00000000, PnL=-139.230000000000000000000000, PnL USD=-90.82112130000000000000000000, Commission=2.10000000, Final PnL=-92.92112130000000000000000000
2025-07-16 03:39:39,874 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=BUY, Entry=178.15500000, Current=185.41500000000002, Quantity=0.10000000, Contract Size=100000.00000000, PnL=72600.00000000020000000000000, PnL USD=488.3659919681970146442529547, Commission=1.00000000, Final PnL=487.3659919681970146442529547
2025-07-16 03:39:39,877 - DEBUG - app.services.portfolio_calculator - Position calculation for CHFJPY: Type=SELL, Entry=178.09500000, Current=185.45499999999998, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-73599.99999999980000000000000, PnL USD=-495.0927962652769088988894046, Commission=1.00000000, Final PnL=-496.0927962652769088988894046
2025-07-16 03:39:39,877 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=BUY, Entry=1.77480000, Current=1.78066, Quantity=0.05000000, Contract Size=100000.00000000, PnL=29.300000000000000000000000, PnL USD=19.11268300000000000000000000, Commission=0.50000000, Final PnL=18.61268300000000000000000000
2025-07-16 03:39:39,877 - DEBUG - app.services.portfolio_calculator - Position calculation for EURAUD: Type=SELL, Entry=1.77442000, Current=1.78102, Quantity=0.05000000, Contract Size=100000.00000000, PnL=-33.000000000000000000000000, PnL USD=-21.52623000000000000000000000, Commission=0.50000000, Final PnL=-22.02623000000000000000000000
2025-07-16 03:39:39,878 - DEBUG - app.services.portfolio_calculator - Position calculation for EURGBP: Type=SELL, Entry=0.85403000, Current=0.86702, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-129.900000000000000000000000, PnL USD=-174.0828870000000000000000000, Commission=1.00000000, Final PnL=-175.0828870000000000000000000
2025-07-16 03:39:39,881 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=BUY, Entry=167.26050000, Current=172.6775, Quantity=0.10000000, Contract Size=100000.00000000, PnL=54170.00000000000000000000000, PnL USD=364.3909887729636281691656745, Commission=1.00000000, Final PnL=363.3909887729636281691656745
2025-07-16 03:39:39,883 - DEBUG - app.services.portfolio_calculator - Position calculation for EURJPY: Type=SELL, Entry=167.23150000, Current=172.70749999999998, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-54759.99999999980000000000000, PnL USD=-368.3598033082410079443558749, Commission=1.00000000, Final PnL=-369.3598033082410079443558749
2025-07-16 03:39:39,883 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=SELL, Entry=1.91952500, Current=1.9548649999999999, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-353.3999999999990000000000000, PnL USD=-210.0468239999994056400000000, Commission=1.00000000, Final PnL=-211.0468239999994056400000000
2025-07-16 03:39:39,883 - DEBUG - app.services.portfolio_calculator - Position calculation for EURNZD: Type=BUY, Entry=1.92063500, Current=1.954445, Quantity=0.10000000, Contract Size=100000.00000000, PnL=338.100000000000000000000000, PnL USD=200.9531160000000000000000000, Commission=1.00000000, Final PnL=199.9531160000000000000000000
2025-07-16 03:39:39,884 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34376000, Current=1.34024, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-24, PnL USD=0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:39:39,884 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=SELL, Entry=1.34361000, Current=1.34024, Quantity=0.25000000, Contract Size=0E-8, PnL=0E-24, PnL USD=0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:39:39,884 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34379000, Current=1.34003, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:39:39,884 - DEBUG - app.services.portfolio_calculator - Position calculation for GBPUSD: Type=BUY, Entry=1.34378000, Current=1.34003, Quantity=0.25000000, Contract Size=0E-8, PnL=-0E-24, PnL USD=-0E-24, Commission=2.50000000, Final PnL=-2.500000000000000000000000
2025-07-16 03:39:39,886 - DEBUG - app.services.portfolio_calculator - Position calculation for NZDJPY: Type=BUY, Entry=87.10150000, Current=88.3325, Quantity=0.01000000, Contract Size=100000.00000000, PnL=1231.000000000000000000000000, PnL USD=8.280696089708662105893353245, Commission=0.10000000, Final PnL=8.180696089708662105893353245
2025-07-16 03:39:39,889 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=SELL, Entry=0.81771000, Current=0.8018299999999999, Quantity=0.15000000, Contract Size=100000.00000000, PnL=238.2000000000015000000000000, PnL USD=297.1260353258176579183714200, Commission=1.50000000, Final PnL=295.6260353258176579183714200
2025-07-16 03:39:39,892 - DEBUG - app.services.portfolio_calculator - Position calculation for USDCHF: Type=BUY, Entry=0.81805000, Current=0.8015, Quantity=0.15000000, Contract Size=100000.00000000, PnL=-248.250000000000000000000000, PnL USD=-309.6622093603432791138608921, Commission=1.50000000, Final PnL=-311.1622093603432791138608921
2025-07-16 03:39:39,893 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.04973000, Current=10.29692, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2471.900000000000000000000000, PnL USD=240.0387651098474254995183493, Commission=1.00000000, Final PnL=239.0387651098474254995183493
2025-07-16 03:39:39,897 - DEBUG - app.services.portfolio_calculator - Position calculation for USDNOK: Type=BUY, Entry=10.05023000, Current=10.29692, Quantity=0.10000000, Contract Size=100000.00000000, PnL=2466.900000000000000000000000, PnL USD=239.5532301668686492029458376, Commission=1.00000000, Final PnL=238.5532301668686492029458376
2025-07-16 03:39:39,899 - DEBUG - app.services.portfolio_calculator - Position calculation for USDSGD: Type=SELL, Entry=1.28795000, Current=1.28496, Quantity=0.31000000, Contract Size=100000.00000000, PnL=92.690000000000000000000000, PnL USD=72.14296277270569189218639332, Commission=3.10000000, Final PnL=69.04296277270569189218639332
2025-07-16 03:39:39,902 - DEBUG - app.services.portfolio_calculator - Position calculation for USDTRY: Type=SELL, Entry=39.56087000, Current=40.2595100000, Quantity=0.10000000, Contract Size=100000.00000000, PnL=-6986.400000000000000000000000, PnL USD=-173.5341537937247621742043060, Commission=1.00000000, Final PnL=-174.5341537937247621742043060
2025-07-16 03:39:39,902 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '98181.73000000', 'equity': '98229.96463072835834130490055', 'margin': '1917.31000000', 'free_margin': '96312.65463072835834130490055', 'profit_loss': '48.2346307283583413049005501', 'margin_level': '5123.321978747743366555481406', 'positions': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.400000000000000000000000', 'current_price': '0.65217'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-121.440000000000000000000000', 'current_price': '0.65249'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '207.5133210357951759404114227', 'current_price': '1.602405'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.3744055541286260225247313', 'current_price': '1.602855'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-214.1141807761386797973886546', 'current_price': '108.3635'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '207.9591548443071055233790083', 'current_price': '108.33149999999999'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '81.75229700000000000000000000', 'current_price': '1.78066'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-92.92112130000000000000000000', 'current_price': '1.78102'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '487.3659919681970146442529547', 'current_price': '185.41500000000002'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-496.0927962652769088988894046', 'current_price': '185.45499999999998'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.61268300000000000000000000', 'current_price': '1.78066'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.02623000000000000000000000', 'current_price': '1.78102'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-175.0828870000000000000000000', 'current_price': '0.86702'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '363.3909887729636281691656745', 'current_price': '172.6775'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-369.3598033082410079443558749', 'current_price': '172.70749999999998'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.0468239999994056400000000', 'current_price': '1.9548649999999999'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '199.9531160000000000000000000', 'current_price': '1.954445'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34024'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34024'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34003'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34003'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.180696089708662105893353245', 'current_price': '88.3325'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '295.6260353258176579183714200', 'current_price': '0.8018299999999999'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.1622093603432791138608921', 'current_price': '0.8015'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '239.0387651098474254995183493', 'current_price': '10.29692'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.5532301668686492029458376', 'current_price': '10.29692'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '69.04296277270569189218639332', 'current_price': '1.28496'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.5341537937247621742043060', 'current_price': '40.2595100000'}], 'margin_call': False}
2025-07-16 03:39:39,903 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '98181.73000000', 'equity': '98229.96463072835834130490055', 'margin': '1917.31000000', 'free_margin': '96312.65463072835834130490055', 'profit_loss': '48.2346307283583413049005501', 'margin_level': '5123.321978747743366555481406', 'positions_with_pnl': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.400000000000000000000000', 'current_price': '0.65217'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-121.440000000000000000000000', 'current_price': '0.65249'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '207.5133210357951759404114227', 'current_price': '1.602405'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.3744055541286260225247313', 'current_price': '1.602855'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-214.1141807761386797973886546', 'current_price': '108.3635'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '207.9591548443071055233790083', 'current_price': '108.33149999999999'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '81.75229700000000000000000000', 'current_price': '1.78066'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-92.92112130000000000000000000', 'current_price': '1.78102'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '487.3659919681970146442529547', 'current_price': '185.41500000000002'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-496.0927962652769088988894046', 'current_price': '185.45499999999998'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.61268300000000000000000000', 'current_price': '1.78066'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.02623000000000000000000000', 'current_price': '1.78102'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-175.0828870000000000000000000', 'current_price': '0.86702'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '363.3909887729636281691656745', 'current_price': '172.6775'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-369.3598033082410079443558749', 'current_price': '172.70749999999998'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.0468239999994056400000000', 'current_price': '1.9548649999999999'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '199.9531160000000000000000000', 'current_price': '1.954445'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34024'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34024'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34003'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34003'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.180696089708662105893353245', 'current_price': '88.3325'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '295.6260353258176579183714200', 'current_price': '0.8018299999999999'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.1622093603432791138608921', 'current_price': '0.8015'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '239.0387651098474254995183493', 'current_price': '10.29692'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.5532301668686492029458376', 'current_price': '10.29692'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '69.04296277270569189218639332', 'current_price': '1.28496'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.5341537937247621742043060', 'current_price': '40.2595100000'}], 'margin_call': False}
2025-07-16 03:39:39,911 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 5123.321978747743366555481406
2025-07-16 03:39:39,914 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:39:39,914 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-16 03:39:39,914 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (demo) from cache/DB...
2025-07-16 03:39:39,916 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:39,950 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:39:39,954 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:39:39,954 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:39:39,958 - DEBUG - app - [AUTO-CUTOFF] User 10 has 1 pending orders.
2025-07-16 03:39:39,958 - DEBUG - app - [AUTO-CUTOFF] User 10 total positions for portfolio calculation: 1
2025-07-16 03:39:39,974 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:39,976 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:40,000 - DEBUG - app - [AUTO-CUTOFF] User 10 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616199999999999')}, 'USDZAR': {'buy': Decimal('17.92066'), 'sell': Decimal('17.91554')}, 'SGDJPY': {'buy': Decimal('115.7285'), 'sell': Decimal('115.6815')}, 'GBPAUD': {'buy': Decimal('2.05457'), 'sell': Decimal('2.05413')}, 'USDNOK': {'buy': Decimal('10.29799'), 'sell': Decimal('10.29692')}, 'NZDCAD': {'buy': Decimal('0.81558'), 'sell': Decimal('0.8152')}, 'GBPNZD': {'buy': Decimal('2.2551300000000003'), 'sell': Decimal('2.2546399999999998')}, 'US30': {'buy': Decimal('44053.01'), 'sell': Decimal('44051.0')}, 'CHFJPY': {'buy': Decimal('185.45499999999998'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3635'), 'sell': Decimal('108.33149999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.2595100000'), 'sell': Decimal('40.2579700000')}, 'GBPSEK': {'buy': Decimal('13.06635'), 'sell': Decimal('13.06348')}, 'GBPNOK': {'buy': Decimal('13.80095'), 'sell': Decimal('13.79865')}, 'USDCNH': {'buy': Decimal('7.1828199999999995'), 'sell': Decimal('7.18252')}, 'EURCHF': {'buy': Decimal('0.93146'), 'sell': Decimal('0.93111')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'BTCUSD': {'buy': Decimal('118918.7'), 'sell': Decimal('118818.6')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.963289999999999'), 'sell': Decimal('11.96162')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.37188')}, 'NOKSEK': {'buy': Decimal('0.9470050000000001'), 'sell': Decimal('0.946465')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34024'), 'sell': Decimal('1.34003')}, 'CHFSGD': {'buy': Decimal('1.602855'), 'sell': Decimal('1.602405')}, 'EURGBP': {'buy': Decimal('0.86702'), 'sell': Decimal('0.86668')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.024'), 'sell': Decimal('96.919')}, 'EURJPY': {'buy': Decimal('172.70749999999998'), 'sell': Decimal('172.6775')}, 'AUDCHF': {'buy': Decimal('0.52318'), 'sell': Decimal('0.5227200000000001')}, 'EURZAR': {'buy': Decimal('20.81738'), 'sell': Decimal('20.81193')}, 'USDCZK': {'buy': Decimal('21.247'), 'sell': Decimal('21.177')}, 'D30': {'buy': Decimal('24132.55'), 'sell': Decimal('24132.55')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65217')}, 'EURSEK': {'buy': Decimal('11.32643'), 'sell': Decimal('11.32446')}, 'NZDJPY': {'buy': Decimal('88.3645'), 'sell': Decimal('88.3325')}, 'USDSGD': {'buy': Decimal('1.28496'), 'sell': Decimal('1.2846099999999998')}, 'EURSGD': {'buy': Decimal('1.492665'), 'sell': Decimal('1.4923250000000001')}, 'NZDUSD': {'buy': Decimal('0.59451'), 'sell': Decimal('0.5942000000000001')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.256729999999999'), 'sell': Decimal('4.255780000000001')}, 'AUDCAD': {'buy': Decimal('0.89502'), 'sell': Decimal('0.895')}, 'EURCAD': {'buy': Decimal('1.5939699999999999'), 'sell': Decimal('1.59377')}, 'EURNZD': {'buy': Decimal('1.9548649999999999'), 'sell': Decimal('1.954445')}, 'USDSEK': {'buy': Decimal('9.74959'), 'sell': Decimal('9.7487')}, 'USDJPY': {'buy': Decimal('148.70700000000002'), 'sell': Decimal('148.60299999999998')}, 'EURAUD': {'buy': Decimal('1.78102'), 'sell': Decimal('1.78066')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}}
2025-07-16 03:39:40,000 - DEBUG - app - [AUTO-CUTOFF] User 10 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:39:40,000 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-16 03:39:40,380 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions': [], 'margin_call': False}
2025-07-16 03:39:40,380 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions_with_pnl': [], 'margin_call': False}
2025-07-16 03:39:40,382 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 25371.71974522292993630573248
2025-07-16 03:39:40,383 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-16 03:39:40,383 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-16 03:39:40,383 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (demo) from cache/DB...
2025-07-16 03:39:40,383 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:40,404 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:39:40,408 - DEBUG - app - [AUTO-CUTOFF] User 11 has 1 open orders.
2025-07-16 03:39:40,408 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:39:40,411 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:39:40,411 - DEBUG - app - [AUTO-CUTOFF] User 11 total positions for portfolio calculation: 1
2025-07-16 03:39:40,457 - DEBUG - app - [AUTO-CUTOFF] User 11 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16179'), 'sell': Decimal('1.1616199999999999')}, 'USDZAR': {'buy': Decimal('17.92066'), 'sell': Decimal('17.91554')}, 'SGDJPY': {'buy': Decimal('115.7285'), 'sell': Decimal('115.6815')}, 'GBPAUD': {'buy': Decimal('2.05457'), 'sell': Decimal('2.05413')}, 'USDNOK': {'buy': Decimal('10.298119999999999'), 'sell': Decimal('10.29705')}, 'NZDCAD': {'buy': Decimal('0.81563'), 'sell': Decimal('0.81523')}, 'GBPNZD': {'buy': Decimal('2.25518'), 'sell': Decimal('2.25467')}, 'US30': {'buy': Decimal('44053.01'), 'sell': Decimal('44051.0')}, 'CHFJPY': {'buy': Decimal('185.45499999999998'), 'sell': Decimal('185.405')}, 'CADJPY': {'buy': Decimal('108.3615'), 'sell': Decimal('108.3295')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.2595100000'), 'sell': Decimal('40.2579700000')}, 'GBPSEK': {'buy': Decimal('13.06645'), 'sell': Decimal('13.064')}, 'GBPNOK': {'buy': Decimal('13.80115'), 'sell': Decimal('13.79885')}, 'USDCNH': {'buy': Decimal('7.1828199999999995'), 'sell': Decimal('7.18252')}, 'EURCHF': {'buy': Decimal('0.93146'), 'sell': Decimal('0.93111')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'BTCUSD': {'buy': Decimal('118896.85'), 'sell': Decimal('118796.85')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.963289999999999'), 'sell': Decimal('11.96162')}, 'USDCAD': {'buy': Decimal('1.3722400000000001'), 'sell': Decimal('1.3719299999999999')}, 'NOKSEK': {'buy': Decimal('0.9470050000000001'), 'sell': Decimal('0.946465')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34023'), 'sell': Decimal('1.34002')}, 'CHFSGD': {'buy': Decimal('1.602855'), 'sell': Decimal('1.6024150000000001')}, 'EURGBP': {'buy': Decimal('0.86701'), 'sell': Decimal('0.86668')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.024'), 'sell': Decimal('96.921')}, 'EURJPY': {'buy': Decimal('172.70649999999998'), 'sell': Decimal('172.6775')}, 'AUDCHF': {'buy': Decimal('0.52317'), 'sell': Decimal('0.5227200000000001')}, 'EURZAR': {'buy': Decimal('20.8179'), 'sell': Decimal('20.812079999999998')}, 'USDCZK': {'buy': Decimal('21.247'), 'sell': Decimal('21.177')}, 'D30': {'buy': Decimal('24132.55'), 'sell': Decimal('24132.55')}, 'AUDUSD': {'buy': Decimal('0.6524599999999999'), 'sell': Decimal('0.65215')}, 'EURSEK': {'buy': Decimal('11.32635'), 'sell': Decimal('11.32451')}, 'NZDJPY': {'buy': Decimal('88.3645'), 'sell': Decimal('88.3335')}, 'USDSGD': {'buy': Decimal('1.28496'), 'sell': Decimal('1.2846')}, 'EURSGD': {'buy': Decimal('1.492665'), 'sell': Decimal('1.492315')}, 'NZDUSD': {'buy': Decimal('0.59451'), 'sell': Decimal('0.5942000000000001')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.256729999999999'), 'sell': Decimal('4.255780000000001')}, 'AUDCAD': {'buy': Decimal('0.89504'), 'sell': Decimal('0.89501')}, 'EURCAD': {'buy': Decimal('1.59405'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.954905'), 'sell': Decimal('1.954475')}, 'USDSEK': {'buy': Decimal('9.749559999999999'), 'sell': Decimal('9.748610000000001')}, 'USDJPY': {'buy': Decimal('148.709'), 'sell': Decimal('148.60299999999998')}, 'EURAUD': {'buy': Decimal('1.7810700000000002'), 'sell': Decimal('1.7806899999999999')}, 'JP225': {'buy': Decimal('39576.79'), 'sell': Decimal('39572.79')}}
2025-07-16 03:39:40,457 - DEBUG - app - [AUTO-CUTOFF] User 11 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:39:40,457 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-16 03:39:40,790 - DEBUG - app.services.portfolio_calculator - Position calculation for AUDCAD: Type=BUY, Entry=0.89752000, Current=0.89501, Quantity=0.01000000, Contract Size=100000.00000000, PnL=-2.510000000000000000000000, PnL USD=-1.829326064616752545386964412, Commission=0.10000000, Final PnL=-1.929326064616752545386964412
2025-07-16 03:39:40,791 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '99998.61000000', 'equity': '99996.68067393538324745461304', 'margin': '6.55', 'free_margin': '99990.13067393538324745461304', 'profit_loss': '-1.929326064616752545386964412', 'margin_level': '1526666.880518097454159612413', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.929326064616752545386964412', 'current_price': '0.89501'}], 'margin_call': False}
2025-07-16 03:39:40,791 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 11: {'balance': '99998.61000000', 'equity': '99996.68067393538324745461304', 'margin': '6.55', 'free_margin': '99990.13067393538324745461304', 'profit_loss': '-1.929326064616752545386964412', 'margin_level': '1526666.880518097454159612413', 'positions_with_pnl': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.929326064616752545386964412', 'current_price': '0.89501'}], 'margin_call': False}
2025-07-16 03:39:40,792 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 1526666.880518097454159612413
2025-07-16 03:39:40,792 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-16 03:39:40,793 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-16 03:39:40,793 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (demo) from cache/DB...
2025-07-16 03:39:40,793 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:40,818 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:39:40,821 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:39:40,821 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:39:40,825 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:39:40,825 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:40,825 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-16 03:39:40,825 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (demo) from cache/DB...
2025-07-16 03:39:40,826 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:39:40,849 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:39:40,852 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:39:40,852 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:39:40,855 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:39:40,855 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:39:40,979 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:40,983 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:41,931 - DEBUG - app.firebase_stream - Firebase listener triggered (134). Event Type: patch, Path: /. Timestamp: 1752662381.9317455
2025-07-16 03:39:41,932 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0668000000', 'o': '13.0642000000'}, 'NZDJPY': {'b': '88.3540000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543200000'}, 'BTCUSD': {'b': '118868.700000000
2025-07-16 03:39:41,932 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0668000000', 'o': '13.0642000000'}, 'NZDJPY': {'b': '88.3540000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543200000'}, 'BTCUSD': {'b': '118868.700000000...
2025-07-16 03:39:41,932 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:41,990 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:42,006 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:43,034 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:43,038 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:44,045 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:44,050 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:44,293 - DEBUG - app.firebase_stream - Firebase listener triggered (135). Event Type: patch, Path: /. Timestamp: 1752662384.2938035
2025-07-16 03:39:44,294 - DEBUG - app.firebase_stream - Prepared batch update for 34 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0663000000', 'o': '13.0641500000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544800000', 'o': '2.0543100000'}, 'BTCUSD': {'b': '118877.530000000
2025-07-16 03:39:44,295 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0663000000', 'o': '13.0641500000'}, 'NZDJPY': {'b': '88.3520000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0544800000', 'o': '2.0543100000'}, 'BTCUSD': {'b': '118877.530000000...
2025-07-16 03:39:44,296 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:45,068 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:45,073 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:46,082 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:46,087 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:46,539 - DEBUG - app.firebase_stream - Firebase listener triggered (136). Event Type: patch, Path: /. Timestamp: 1752662386.5391088
2025-07-16 03:39:46,539 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0662000000', 'o': '13.0636000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118886.900000000
2025-07-16 03:39:46,540 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0662000000', 'o': '13.0636000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118886.900000000...
2025-07-16 03:39:46,541 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:47,106 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:47,111 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:48,117 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:48,122 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:48,896 - DEBUG - app.firebase_stream - Firebase listener triggered (137). Event Type: patch, Path: /. Timestamp: 1752662388.8960125
2025-07-16 03:39:48,896 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0668000000', 'o': '13.0642000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0510000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0544400000',
2025-07-16 03:39:48,897 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0668000000', 'o': '13.0642000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0510000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0544400000',...
2025-07-16 03:39:48,897 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:49,126 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:49,129 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:50,135 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:50,140 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:51,140 - DEBUG - app.firebase_stream - Firebase listener triggered (138). Event Type: patch, Path: /. Timestamp: 1752662391.1402817
2025-07-16 03:39:51,140 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0640000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0500000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543200000'}, 'EURNZD': {'b': '1.9547300000', '
2025-07-16 03:39:51,141 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0640000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0500000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543200000'}, 'EURNZD': {'b': '1.9547300000', '...
2025-07-16 03:39:51,142 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:51,146 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:51,165 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:52,194 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:52,198 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:53,209 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:53,214 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:53,498 - DEBUG - app.firebase_stream - Firebase listener triggered (139). Event Type: patch, Path: /. Timestamp: 1752662393.4986432
2025-07-16 03:39:53,572 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543300000'}, 'USDJPY': {'b': '148.6650000000',
2025-07-16 03:39:53,573 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543300000'}, 'USDJPY': {'b': '148.6650000000',...
2025-07-16 03:39:53,573 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:54,227 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:54,232 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:55,239 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:55,243 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:55,758 - DEBUG - app.firebase_stream - Firebase listener triggered (140). Event Type: patch, Path: /. Timestamp: 1752662395.7584312
2025-07-16 03:39:55,759 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0550000000', 'o': '38.0500000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0543200000'}, 'USDJPY': {'b': '148.6680000000',
2025-07-16 03:39:55,759 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0550000000', 'o': '38.0500000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0543200000'}, 'USDJPY': {'b': '148.6680000000',...
2025-07-16 03:39:55,760 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:56,252 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:56,256 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:57,271 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:57,275 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:58,105 - DEBUG - app.firebase_stream - Firebase listener triggered (141). Event Type: patch, Path: /. Timestamp: 1752662398.1057239
2025-07-16 03:39:58,106 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3610000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544600000', 'o': '2.0543200000'}, 'USDJPY': {'b': '148.6680000000', 'o': '148.6620000000'}, 'CADCHF': {'b': '0.5843400000',
2025-07-16 03:39:58,106 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3610000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544600000', 'o': '2.0543200000'}, 'USDJPY': {'b': '148.6680000000', 'o': '148.6620000000'}, 'CADCHF': {'b': '0.5843400000',...
2025-07-16 03:39:58,106 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:39:58,278 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:58,280 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:39:59,283 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:39:59,287 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:00,294 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:00,299 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:00,329 - DEBUG - app.firebase_stream - Firebase listener triggered (142). Event Type: patch, Path: /. Timestamp: 1752662400.3291132
2025-07-16 03:40:00,329 - DEBUG - app.firebase_stream - Prepared batch update for 19 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0550000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543400000'}, 'EURNZD': {'b': '1.9546900000', '
2025-07-16 03:40:00,330 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0550000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543400000'}, 'EURNZD': {'b': '1.9546900000', '...
2025-07-16 03:40:00,330 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:00,867 - INFO - app - Application shutdown initiated
2025-07-16 03:40:00,869 - INFO - app - Scheduler shutdown completed
2025-07-16 03:40:01,288 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-16 03:40:02,605 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-16 03:40:02,605 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-16 03:40:02,608 - INFO - app - Redis connection closed
2025-07-16 03:40:02,608 - INFO - app - Application shutdown completed
2025-07-16 03:40:05,819 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:40:05,880 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:40:05,900 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:40:05,900 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:40:06,546 - INFO - app - Application starting up - Trading system initialized
2025-07-16 03:40:06,546 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-16 03:40:06,546 - INFO - app - Environment: DEVELOPMENT
2025-07-16 03:40:06,635 - INFO - app - Application startup initiated
2025-07-16 03:40:06,635 - INFO - app - Initializing core services...
2025-07-16 03:40:06,705 - INFO - app - Firebase initialized
2025-07-16 03:40:06,705 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-16 03:40:08,763 - INFO - app - Redis initialized
2025-07-16 03:40:08,769 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-16 03:40:08,770 - INFO - app - [AUTO-CUTOFF] Scheduled update_all_users_dynamic_portfolio job to run every 1 minute.
2025-07-16 03:40:08,771 - INFO - app - Scheduler initialized
2025-07-16 03:40:08,775 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-16 03:40:08,775 - DEBUG - app.firebase_stream - Successfully got running event loop in process_firebase_events task.
2025-07-16 03:40:08,776 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-16 03:40:09,873 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-16 03:40:09,903 - DEBUG - app.firebase_stream - Firebase listener triggered (1). Event Type: put, Path: /. Timestamp: 1752662409.9035153
2025-07-16 03:40:09,904 - DEBUG - app.firebase_stream - Prepared batch update for 48 symbols from root path for queue. Preview: {'AUDCAD': {'b': '0.8950400000', 'o': '0.8950200000'}, 'AUDCHF': {'b': '0.5229900000', 'o': '0.5229300000'}, 'AUDJPY': {'b': '96.9840000000', 'o': '96.9780000000'}, 'AUDNZD': {'b': '1.0000000000', 'o'
2025-07-16 03:40:09,904 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'AUDCAD': {'b': '0.8950400000', 'o': '0.8950200000'}, 'AUDCHF': {'b': '0.5229900000', 'o': '0.5229300000'}, 'AUDJPY': {'b': '96.9840000000', 'o': '96.9780000000'}, 'AUDNZD': {'b': '1.0000000000', 'o'...
2025-07-16 03:40:09,905 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type put at path /.
2025-07-16 03:40:09,906 - INFO - app - Starting stale cache cleanup task
2025-07-16 03:40:11,849 - DEBUG - app.firebase_stream - Firebase listener triggered (2). Event Type: patch, Path: /. Timestamp: 1752662411.8491232
2025-07-16 03:40:11,849 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3580000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118909.6000000000', 'o': '118909.5000000000'}, 'USDJPY': {'b': '148.6670
2025-07-16 03:40:11,850 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3580000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118909.6000000000', 'o': '118909.5000000000'}, 'USDJPY': {'b': '148.6670...
2025-07-16 03:40:11,850 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:13,969 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-16 03:40:13,969 - INFO - app - Background tasks initialized
2025-07-16 03:40:14,065 - DEBUG - app.firebase_stream - Firebase listener triggered (3). Event Type: patch, Path: /. Timestamp: 1752662414.0657322
2025-07-16 03:40:14,066 - DEBUG - app.firebase_stream - Prepared batch update for 22 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0520000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3610000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0544300000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118928.660000000
2025-07-16 03:40:14,066 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0520000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3610000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0544300000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118928.660000000...
2025-07-16 03:40:14,066 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:15,195 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-16 03:40:15,195 - INFO - app - Application startup completed successfully
2025-07-16 03:40:15,195 - INFO - app - Starting cache validation task
2025-07-16 03:40:15,199 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-16 03:40:15,199 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:15,203 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-16 03:40:15,275 - INFO - app - Validating cache for 30 users
2025-07-16 03:40:15,276 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:16,292 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:16,295 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:16,446 - DEBUG - app.firebase_stream - Firebase listener triggered (4). Event Type: patch, Path: /. Timestamp: 1752662416.4462667
2025-07-16 03:40:16,446 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0665000000', 'o': '13.0639000000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118897.640000000
2025-07-16 03:40:16,447 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0665000000', 'o': '13.0639000000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118897.640000000...
2025-07-16 03:40:16,447 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:17,236 - INFO - app - Found 24 static orders cache entries to check
2025-07-16 03:40:17,309 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:17,313 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:18,325 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:18,358 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:18,652 - DEBUG - app.firebase_stream - Firebase listener triggered (5). Event Type: patch, Path: /. Timestamp: 1752662418.6521244
2025-07-16 03:40:18,652 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0640000000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0543000000'}, 'BTCUSD': {'b': '118945.000000000
2025-07-16 03:40:18,653 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 2. Data preview: {'GBPSEK': {'b': '13.0666000000', 'o': '13.0640000000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0543000000'}, 'BTCUSD': {'b': '118945.000000000...
2025-07-16 03:40:18,653 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:19,266 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-16 03:40:19,373 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:19,378 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:20,390 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:20,394 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:21,045 - DEBUG - app.firebase_stream - Firebase listener triggered (6). Event Type: patch, Path: /. Timestamp: 1752662421.0455003
2025-07-16 03:40:21,046 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0665000000', 'o': '13.0639000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0543000000'}, 'BTCUSD': {'b': '118909.6000000000', 'o': '118909.5000000000'}, 'USDJPY': {'b': '148.6680
2025-07-16 03:40:21,046 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 2. Data preview: {'GBPSEK': {'b': '13.0665000000', 'o': '13.0639000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0543000000'}, 'BTCUSD': {'b': '118909.6000000000', 'o': '118909.5000000000'}, 'USDJPY': {'b': '148.6680...
2025-07-16 03:40:21,046 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:21,408 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:21,412 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:22,418 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:22,421 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:23,278 - DEBUG - app.firebase_stream - Firebase listener triggered (7). Event Type: patch, Path: /. Timestamp: 1752662423.2786772
2025-07-16 03:40:23,279 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0661600000', 'o': '13.0636000000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543000000'}, 'USDJPY': {'b': '148.6660000000',
2025-07-16 03:40:23,280 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 4. Data preview: {'GBPSEK': {'b': '13.0661600000', 'o': '13.0636000000'}, 'NZDJPY': {'b': '88.3620000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543000000'}, 'USDJPY': {'b': '148.6660000000',...
2025-07-16 03:40:23,280 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:23,354 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-16 03:40:23,386 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-16 03:40:23,401 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-16 03:40:23,412 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-16 03:40:23,424 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-16 03:40:23,427 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:23,438 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-16 03:40:23,443 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-16 03:40:23,458 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-16 03:40:23,459 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:23,461 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-16 03:40:23,503 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-16 03:40:23,520 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-16 03:40:23,531 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-16 03:40:23,542 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-16 03:40:23,554 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-16 03:40:23,569 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-16 03:40:23,618 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-16 03:40:23,636 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-16 03:40:23,656 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-16 03:40:23,678 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-16 03:40:23,691 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-16 03:40:23,691 - INFO - app - Completed stale cache cleanup task
2025-07-16 03:40:23,711 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-16 03:40:23,746 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-16 03:40:24,484 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:24,488 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:25,492 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:25,496 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:25,655 - DEBUG - app.firebase_stream - Firebase listener triggered (8). Event Type: patch, Path: /. Timestamp: 1752662425.655446
2025-07-16 03:40:25,655 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0661000000', 'o': '13.0635000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542900000'}, 'BTCUSD': {'b': '118950.000000000
2025-07-16 03:40:25,656 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0661000000', 'o': '13.0635000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3530000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542900000'}, 'BTCUSD': {'b': '118950.000000000...
2025-07-16 03:40:25,656 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:25,825 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-16 03:40:26,500 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:26,504 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:27,513 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:27,538 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:27,905 - DEBUG - app.firebase_stream - Firebase listener triggered (9). Event Type: patch, Path: /. Timestamp: 1752662427.9055157
2025-07-16 03:40:27,906 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118966.400000000
2025-07-16 03:40:27,906 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118966.400000000...
2025-07-16 03:40:27,906 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:28,556 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:28,561 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:29,575 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:29,583 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:29,961 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-16 03:40:29,998 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-16 03:40:30,155 - DEBUG - app.firebase_stream - Firebase listener triggered (10). Event Type: patch, Path: /. Timestamp: 1752662430.155731
2025-07-16 03:40:30,156 - DEBUG - app.firebase_stream - Prepared batch update for 19 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0662000000', 'o': '13.0636000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544600000', 'o': '2.0542900000'}, 'BTCUSD': {'b': '118945.000000000
2025-07-16 03:40:30,156 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0662000000', 'o': '13.0636000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544600000', 'o': '2.0542900000'}, 'BTCUSD': {'b': '118945.000000000...
2025-07-16 03:40:30,157 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:30,201 - INFO - app - Starting stale cache cleanup task
2025-07-16 03:40:30,590 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:30,594 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:31,611 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:31,628 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:32,046 - INFO - app - Found 24 static orders cache entries to check
2025-07-16 03:40:32,062 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-16 03:40:32,070 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-16 03:40:32,070 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-16 03:40:32,082 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-16 03:40:32,087 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-16 03:40:32,096 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-16 03:40:32,100 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-16 03:40:32,101 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-16 03:40:32,103 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-16 03:40:32,109 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-16 03:40:32,113 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-16 03:40:32,409 - DEBUG - app.firebase_stream - Firebase listener triggered (11). Event Type: patch, Path: /. Timestamp: 1752662432.4099436
2025-07-16 03:40:32,410 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0544300000', 'o': '2.0543100000'}, 'USDCNH': {'b': '7.1825200000', 'o': '7.1824400000'}, 'CADCHF': {'b': '0.5843300000', 'o': '0.5842500000'}, 'EURNZD': {'b': '1.9547400000', 'o': 
2025-07-16 03:40:32,410 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPAUD': {'b': '2.0544300000', 'o': '2.0543100000'}, 'USDCNH': {'b': '7.1825200000', 'o': '7.1824400000'}, 'CADCHF': {'b': '0.5843300000', 'o': '0.5842500000'}, 'EURNZD': {'b': '1.9547400000', 'o': ...
2025-07-16 03:40:32,411 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:32,645 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:32,648 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:33,663 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:33,667 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:34,158 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-16 03:40:34,170 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-16 03:40:34,176 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-16 03:40:34,182 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-16 03:40:34,186 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,205 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-16 03:40:34,210 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-16 03:40:34,218 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-16 03:40:34,223 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-16 03:40:34,223 - INFO - app - Completed stale cache cleanup task
2025-07-16 03:40:34,223 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,256 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,288 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,322 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,349 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,391 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,421 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,500 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,538 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,555 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-16 03:40:34,575 - INFO - app - Cache validation completed
2025-07-16 03:40:34,671 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:34,675 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:34,764 - DEBUG - app.firebase_stream - Firebase listener triggered (12). Event Type: patch, Path: /. Timestamp: 1752662434.7645588
2025-07-16 03:40:34,764 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542900000'}, 'USDJPY': {'b': '148.6670000000',
2025-07-16 03:40:34,765 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0653000000', 'o': '13.0627000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544200000', 'o': '2.0542900000'}, 'USDJPY': {'b': '148.6670000000',...
2025-07-16 03:40:34,765 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:35,683 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:35,716 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:36,722 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:36,725 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:36,912 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:40:36,935 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:40:36,959 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:40:36,963 - DEBUG - app.firebase_stream - Firebase listener triggered (13). Event Type: patch, Path: /. Timestamp: 1752662436.9638016
2025-07-16 03:40:36,964 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0624000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0544900000', 'o': '2.0543400000'}, 'USDJPY': {'b': '148.6660000000',
2025-07-16 03:40:36,964 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0624000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3540000000'}, 'GBPAUD': {'b': '2.0544900000', 'o': '2.0543400000'}, 'USDJPY': {'b': '148.6660000000',...
2025-07-16 03:40:36,965 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:36,979 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:40:36,989 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:40:36,992 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:40:37,071 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-16 03:40:37,305 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:40:37,309 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:40:37,332 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:40:37,332 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:40:37,339 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:40:37,339 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:40:37,343 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:40:37,358 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:40:37,366 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:40:37,366 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:40:37,371 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:40:37,380 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:40:37,387 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:40:37,387 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:40:37,396 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:40:37,396 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:40:37,403 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:40:37,403 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:40:37,430 - INFO - app.core.config - .env file loaded successfully.
2025-07-16 03:40:37,447 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-16 03:40:37,447 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-16 03:40:37,730 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:37,737 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:38,743 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:38,749 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:39,288 - DEBUG - app.firebase_stream - Firebase listener triggered (14). Event Type: patch, Path: /. Timestamp: 1752662439.2886846
2025-07-16 03:40:39,289 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0660000000', 'o': '13.0634000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0480000000'}, 'GBPAUD': {'b': '2.0544900000', 'o': '2.0543300000'}, 'USDCNH': {'b': '7.1825000000', '
2025-07-16 03:40:39,289 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0660000000', 'o': '13.0634000000'}, 'XAGUSD': {'b': '38.0550000000', 'o': '38.0480000000'}, 'GBPAUD': {'b': '2.0544900000', 'o': '2.0543300000'}, 'USDCNH': {'b': '7.1825000000', '...
2025-07-16 03:40:39,289 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:39,752 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:39,755 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:40,766 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:40,770 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:41,630 - DEBUG - app.firebase_stream - Firebase listener triggered (15). Event Type: patch, Path: /. Timestamp: 1752662441.6304898
2025-07-16 03:40:41,631 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3610000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544900000',
2025-07-16 03:40:41,631 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0655000000', 'o': '13.0629000000'}, 'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'NZDJPY': {'b': '88.3610000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544900000',...
2025-07-16 03:40:41,631 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:41,780 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:41,794 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:42,818 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:42,822 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:43,836 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:43,840 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:43,984 - DEBUG - app.firebase_stream - Firebase listener triggered (16). Event Type: patch, Path: /. Timestamp: 1752662443.9844556
2025-07-16 03:40:43,984 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3600000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543200000'}, 'USDJPY': {'b': '148.6650000000', 'o': '148.6600000000'}, 'CADCHF': {'b': '0.5843300000',
2025-07-16 03:40:43,985 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3600000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0543200000'}, 'USDJPY': {'b': '148.6650000000', 'o': '148.6600000000'}, 'CADCHF': {'b': '0.5843300000',...
2025-07-16 03:40:43,986 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:44,849 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:44,854 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:45,869 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:45,873 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:46,242 - DEBUG - app.firebase_stream - Firebase listener triggered (17). Event Type: patch, Path: /. Timestamp: 1752662446.2429297
2025-07-16 03:40:46,243 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0540000000', 'o': '38.0470000000'}, 'GBPAUD': {'b': '2.0544000000', 'o': '2.0543000000'}, 'BTCUSD': {'b': '118920.1000000000', 'o': '118920.0000000000'}, 'USDJPY': {'b': '148.6660
2025-07-16 03:40:46,243 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0540000000', 'o': '38.0470000000'}, 'GBPAUD': {'b': '2.0544000000', 'o': '2.0543000000'}, 'BTCUSD': {'b': '118920.1000000000', 'o': '118920.0000000000'}, 'USDJPY': {'b': '148.6660...
2025-07-16 03:40:46,244 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:46,878 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:46,882 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:47,898 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:47,902 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:48,589 - DEBUG - app.firebase_stream - Firebase listener triggered (18). Event Type: patch, Path: /. Timestamp: 1752662448.5889466
2025-07-16 03:40:48,589 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623000000'}, 'NZDJPY': {'b': '88.3610000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544000000', 'o': '2.0542600000'}, 'BTCUSD': {'b': '118951.070000000
2025-07-16 03:40:48,589 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623000000'}, 'NZDJPY': {'b': '88.3610000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0544000000', 'o': '2.0542600000'}, 'BTCUSD': {'b': '118951.070000000...
2025-07-16 03:40:48,589 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:48,915 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:48,917 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:49,925 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:49,930 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:50,834 - DEBUG - app.firebase_stream - Firebase listener triggered (19). Event Type: patch, Path: /. Timestamp: 1752662450.8343968
2025-07-16 03:40:50,834 - DEBUG - app.firebase_stream - Prepared batch update for 14 symbols from root path for queue. Preview: {'USDJPY': {'b': '148.6650000000', 'o': '148.6620000000'}, 'EURNZD': {'b': '1.9547600000', 'o': '1.9545600000'}, 'EURZAR': {'b': '20.8169000000', 'o': '20.8121600000'}, 'EURSEK': {'b': '11.3252400000'
2025-07-16 03:40:50,835 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'USDJPY': {'b': '148.6650000000', 'o': '148.6620000000'}, 'EURNZD': {'b': '1.9547600000', 'o': '1.9545600000'}, 'EURZAR': {'b': '20.8169000000', 'o': '20.8121600000'}, 'EURSEK': {'b': '11.3252400000'...
2025-07-16 03:40:50,835 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:50,933 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:50,937 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:51,945 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:51,949 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:52,959 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:52,962 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:53,193 - DEBUG - app.firebase_stream - Firebase listener triggered (20). Event Type: patch, Path: /. Timestamp: 1752662453.1930044
2025-07-16 03:40:53,193 - DEBUG - app.firebase_stream - Prepared batch update for 20 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0648000000', 'o': '13.0622100000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543900000', 'o': '2.0542600000'}, 'EURNZD': {'b': '1.9547600000', '
2025-07-16 03:40:53,193 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0648000000', 'o': '13.0622100000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543900000', 'o': '2.0542600000'}, 'EURNZD': {'b': '1.9547600000', '...
2025-07-16 03:40:53,193 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:53,972 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:53,975 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:54,980 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:54,983 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:55,446 - DEBUG - app.firebase_stream - Firebase listener triggered (21). Event Type: patch, Path: /. Timestamp: 1752662455.4466443
2025-07-16 03:40:55,447 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3520000000'}, 'USDJPY': {'b': '148.6660000000', 'o': '148.6620000000'}, 'USDCNH': {'b': '7.1824900000
2025-07-16 03:40:55,447 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0649000000', 'o': '13.0623000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3520000000'}, 'USDJPY': {'b': '148.6660000000', 'o': '148.6620000000'}, 'USDCNH': {'b': '7.1824900000...
2025-07-16 03:40:55,448 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:55,990 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:55,993 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:56,997 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:57,000 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:57,800 - DEBUG - app.firebase_stream - Firebase listener triggered (22). Event Type: patch, Path: /. Timestamp: 1752662457.800066
2025-07-16 03:40:57,800 - DEBUG - app.firebase_stream - Prepared batch update for 16 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0624000000'}, 'XAGUSD': {'b': '38.0560000000', 'o': '38.0470000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544100000',
2025-07-16 03:40:57,800 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0650000000', 'o': '13.0624000000'}, 'XAGUSD': {'b': '38.0560000000', 'o': '38.0470000000'}, 'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0544100000',...
2025-07-16 03:40:57,800 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:40:58,016 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:58,020 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:40:59,036 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:40:59,039 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:00,057 - DEBUG - app.firebase_stream - Firebase listener triggered (23). Event Type: patch, Path: /. Timestamp: 1752662460.0575662
2025-07-16 03:41:00,058 - DEBUG - app.firebase_stream - Prepared batch update for 20 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0651000000', 'o': '13.0625000000'}, 'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'GBPAUD': {'b': '2.0544100000', 'o': '2.0542700000'}, 'EURZAR': {'b': '20.8177100000', 
2025-07-16 03:41:00,058 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:00,059 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0651000000', 'o': '13.0625000000'}, 'XAGUSD': {'b': '38.0540000000', 'o': '38.0480000000'}, 'GBPAUD': {'b': '2.0544100000', 'o': '2.0542700000'}, 'EURZAR': {'b': '20.8177100000', ...
2025-07-16 03:41:00,060 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:00,070 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:01,100 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:01,103 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:02,111 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:02,115 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:02,415 - DEBUG - app.firebase_stream - Firebase listener triggered (24). Event Type: patch, Path: /. Timestamp: 1752662462.415322
2025-07-16 03:41:02,416 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0544100000', 'o': '2.0542400000'}, 'USDJPY': {'b': '148.6650000000', 'o': '148.6620000000'}, 'CADCHF': {'b': '0.5843500000', 'o': '0.5842800000'}, 'EURNZD': {'b': '1.9547600000', '
2025-07-16 03:41:02,417 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPAUD': {'b': '2.0544100000', 'o': '2.0542400000'}, 'USDJPY': {'b': '148.6650000000', 'o': '148.6620000000'}, 'CADCHF': {'b': '0.5843500000', 'o': '0.5842800000'}, 'EURNZD': {'b': '1.9547600000', '...
2025-07-16 03:41:02,417 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:03,122 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:03,127 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:04,134 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:04,138 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:04,644 - DEBUG - app.firebase_stream - Firebase listener triggered (25). Event Type: patch, Path: /. Timestamp: 1752662464.6445422
2025-07-16 03:41:04,645 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0648000000', 'o': '13.0622000000'}, 'GBPAUD': {'b': '2.0542900000', 'o': '2.0542500000'}, 'BTCUSD': {'b': '118920.1000000000', 'o': '118920.0000000000'}, 'USDJPY': {'b': '148.6660
2025-07-16 03:41:04,645 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0648000000', 'o': '13.0622000000'}, 'GBPAUD': {'b': '2.0542900000', 'o': '2.0542500000'}, 'BTCUSD': {'b': '118920.1000000000', 'o': '118920.0000000000'}, 'USDJPY': {'b': '148.6660...
2025-07-16 03:41:04,646 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:05,142 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:05,147 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:06,166 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:06,170 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:06,920 - DEBUG - app.firebase_stream - Firebase listener triggered (26). Event Type: patch, Path: /. Timestamp: 1752662466.9199598
2025-07-16 03:41:06,920 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0615700000'}, 'GBPAUD': {'b': '2.0542900000', 'o': '2.0541400000'}, 'BTCUSD': {'b': '118900.1000000000', 'o': '118900.0000000000'}, 'USDJPY': {'b': '148.6660
2025-07-16 03:41:06,920 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0615700000'}, 'GBPAUD': {'b': '2.0542900000', 'o': '2.0541400000'}, 'BTCUSD': {'b': '118900.1000000000', 'o': '118900.0000000000'}, 'USDJPY': {'b': '148.6660...
2025-07-16 03:41:06,921 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:07,173 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:07,176 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:08,188 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:08,193 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:08,787 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-16 03:41:08,787 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-16 03:41:08,795 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-16 03:41:08,796 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-16 03:41:08,796 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-16 03:41:08,796 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (live) from cache/DB...
2025-07-16 03:41:08,797 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:08,821 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:41:08,824 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:41:08,824 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:41:08,828 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:41:08,828 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:08,828 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-16 03:41:08,828 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (live) from cache/DB...
2025-07-16 03:41:08,833 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-16 03:41:08,834 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-16 03:41:08,834 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 8 (live) from cache/DB...
2025-07-16 03:41:08,835 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:41:08,843 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 8.
2025-07-16 03:41:08,843 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-16 03:41:08,843 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (live) from cache/DB...
2025-07-16 03:41:08,843 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:41:08,864 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:41:08,869 - DEBUG - app - [AUTO-CUTOFF] User 9 has 1 open orders.
2025-07-16 03:41:08,869 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:41:08,872 - DEBUG - app - [AUTO-CUTOFF] User 9 has 0 pending orders.
2025-07-16 03:41:08,872 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 1
2025-07-16 03:41:08,947 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.5230899999999999'), 'sell': Decimal('0.52283')}, 'GBPNOK': {'buy': Decimal('13.7988'), 'sell': Decimal('13.7964')}, 'AUDJPY': {'buy': Decimal('96.997'), 'sell': Decimal('96.961')}, 'EURJPY': {'buy': Decimal('172.72299999999998'), 'sell': Decimal('172.68800000000002')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'EURCAD': {'buy': Decimal('1.5940349999999999'), 'sell': Decimal('1.593765')}, 'GBPUSD': {'buy': Decimal('1.340115'), 'sell': Decimal('1.339955')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.74855'), 'sell': Decimal('9.747720000000001')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}, 'GBPSEK': {'buy': Decimal('13.0643'), 'sell': Decimal('13.06137')}, 'EURUSD': {'buy': Decimal('1.161845'), 'sell': Decimal('1.161635')}, 'AUDCAD': {'buy': Decimal('0.89515'), 'sell': Decimal('0.8949')}, 'D30': {'buy': Decimal('24130.15'), 'sell': Decimal('24129.15')}, 'CHFSGD': {'buy': Decimal('1.6028449999999999'), 'sell': Decimal('1.6024150000000001')}, 'USDJPY': {'buy': Decimal('148.676'), 'sell': Decimal('148.651')}, 'EURNOK': {'buy': Decimal('11.962425'), 'sell': Decimal('11.960704999999999')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652215')}, 'EURCHF': {'buy': Decimal('0.9314899999999999'), 'sell': Decimal('0.93113')}, 'GBPAUD': {'buy': Decimal('2.054415'), 'sell': Decimal('2.0540149999999997')}, 'EURGBP': {'buy': Decimal('0.86709'), 'sell': Decimal('0.8667699999999999')}, 'EURNZD': {'buy': Decimal('1.954915'), 'sell': Decimal('1.954385')}, 'EURSEK': {'buy': Decimal('11.325445'), 'sell': Decimal('11.323514999999999')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.5845'), 'sell': Decimal('0.58414')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80155')}, 'USDCNH': {'buy': Decimal('7.182675'), 'sell': Decimal('7.182245')}, 'NZDUSD': {'buy': Decimal('0.59445'), 'sell': Decimal('0.59422')}, 'NZDJPY': {'buy': Decimal('88.374'), 'sell': Decimal('88.336')}, 'EURSGD': {'buy': Decimal('1.4927400000000002'), 'sell': Decimal('1.49236')}, 'CADJPY': {'buy': Decimal('108.377'), 'sell': Decimal('108.339')}, 'USDCZK': {'buy': Decimal('21.2445'), 'sell': Decimal('21.1795')}, 'US30': {'buy': Decimal('44044.5'), 'sell': Decimal('44042.5')}, 'GBPNZD': {'buy': Decimal('2.255075'), 'sell': Decimal('2.2546549999999996')}, 'CHFJPY': {'buy': Decimal('185.475'), 'sell': Decimal('185.425')}, 'BTCUSD': {'buy': Decimal('118950.1'), 'sell': Decimal('118850.0')}, 'USDSGD': {'buy': Decimal('1.2849249999999999'), 'sell': Decimal('1.2846250000000001')}, 'NOKSEK': {'buy': Decimal('0.947025'), 'sell': Decimal('0.946425')}, 'EURPLN': {'buy': Decimal('4.25668'), 'sell': Decimal('4.25571')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78104'), 'sell': Decimal('1.78067')}, 'SGDJPY': {'buy': Decimal('115.735'), 'sell': Decimal('115.688')}, 'EURZAR': {'buy': Decimal('20.81767'), 'sell': Decimal('20.81203')}, 'USDTRY': {'buy': Decimal('40.260985'), 'sell': Decimal('40.258585000000004')}, 'USDNOK': {'buy': Decimal('10.29699'), 'sell': Decimal('10.29587')}, 'USDZAR': {'buy': Decimal('17.920105'), 'sell': Decimal('17.915425000000003')}, 'NZDCAD': {'buy': Decimal('0.81556'), 'sell': Decimal('0.81528')}, 'USDCAD': {'buy': Decimal('1.37219'), 'sell': Decimal('1.37191')}}
2025-07-16 03:41:08,948 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:41:08,948 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:41:09,278 - DEBUG - app.firebase_stream - Firebase listener triggered (27). Event Type: patch, Path: /. Timestamp: 1752662469.2788575
2025-07-16 03:41:09,279 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541400000'}, 'CADCHF': {'b': '0.5843500000', 'o': '0.5842800000'}, 'EURNZD': {'b': '1.9547600000', 'o'
2025-07-16 03:41:09,279 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541400000'}, 'CADCHF': {'b': '0.5843500000', 'o': '0.5842800000'}, 'EURNZD': {'b': '1.9547600000', 'o'...
2025-07-16 03:41:09,280 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:09,280 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '9794.75000000', 'equity': '91.044000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9712.786000000000000000000000', 'profit_loss': '-9703.706000000000000000000000', 'margin_level': '0.9286574736608039919092844327', 'positions': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9703.706000000000000000000000', 'current_price': '118850.0'}], 'margin_call': True}
2025-07-16 03:41:09,281 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '9794.75000000', 'equity': '91.044000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9712.786000000000000000000000', 'profit_loss': '-9703.706000000000000000000000', 'margin_level': '0.9286574736608039919092844327', 'positions_with_pnl': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9703.706000000000000000000000', 'current_price': '118850.0'}], 'margin_call': True}
2025-07-16 03:41:09,282 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:09,283 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.9286574736608039919092844327
2025-07-16 03:41:09,298 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:09,388 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:41:09,388 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-16 03:41:09,388 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (live) from cache/DB...
2025-07-16 03:41:09,389 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:09,410 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:41:09,415 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:41:09,415 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:41:09,419 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 pending orders.
2025-07-16 03:41:09,419 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:09,419 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-16 03:41:09,419 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (live) from cache/DB...
2025-07-16 03:41:09,420 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:09,443 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:41:09,447 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 open orders.
2025-07-16 03:41:09,447 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:41:09,450 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:41:09,450 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:09,450 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-16 03:41:09,450 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (live) from cache/DB...
2025-07-16 03:41:09,451 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:41:09,473 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:41:09,477 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:41:09,477 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:41:09,481 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:41:09,481 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:09,481 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-16 03:41:09,481 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (live) from cache/DB...
2025-07-16 03:41:09,482 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:09,502 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:41:09,507 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:41:09,507 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:41:09,510 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:41:09,510 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:09,510 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-16 03:41:09,511 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 14 (live) from cache/DB...
2025-07-16 03:41:09,511 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:41:09,531 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 14...
2025-07-16 03:41:09,535 - DEBUG - app - [AUTO-CUTOFF] User 14 has 3 open orders.
2025-07-16 03:41:09,535 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 14...
2025-07-16 03:41:09,538 - DEBUG - app - [AUTO-CUTOFF] User 14 has 0 pending orders.
2025-07-16 03:41:09,538 - DEBUG - app - [AUTO-CUTOFF] User 14 total positions for portfolio calculation: 3
2025-07-16 03:41:09,591 - DEBUG - app - [AUTO-CUTOFF] User 14 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.5230899999999999'), 'sell': Decimal('0.52283')}, 'GBPNOK': {'buy': Decimal('13.7988'), 'sell': Decimal('13.7964')}, 'AUDJPY': {'buy': Decimal('96.997'), 'sell': Decimal('96.961')}, 'EURJPY': {'buy': Decimal('172.72299999999998'), 'sell': Decimal('172.68800000000002')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'EURCAD': {'buy': Decimal('1.5940349999999999'), 'sell': Decimal('1.593765')}, 'GBPUSD': {'buy': Decimal('1.340115'), 'sell': Decimal('1.339955')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.74855'), 'sell': Decimal('9.747720000000001')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}, 'GBPSEK': {'buy': Decimal('13.0643'), 'sell': Decimal('13.06137')}, 'EURUSD': {'buy': Decimal('1.161845'), 'sell': Decimal('1.161635')}, 'AUDCAD': {'buy': Decimal('0.89515'), 'sell': Decimal('0.8949')}, 'D30': {'buy': Decimal('24130.15'), 'sell': Decimal('24129.15')}, 'CHFSGD': {'buy': Decimal('1.6028449999999999'), 'sell': Decimal('1.6024150000000001')}, 'USDJPY': {'buy': Decimal('148.676'), 'sell': Decimal('148.651')}, 'EURNOK': {'buy': Decimal('11.962535'), 'sell': Decimal('11.960815')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652215')}, 'EURCHF': {'buy': Decimal('0.9314899999999999'), 'sell': Decimal('0.93113')}, 'GBPAUD': {'buy': Decimal('2.0544450000000003'), 'sell': Decimal('2.0540149999999997')}, 'EURGBP': {'buy': Decimal('0.86704'), 'sell': Decimal('0.86671')}, 'EURNZD': {'buy': Decimal('1.954935'), 'sell': Decimal('1.954435')}, 'EURSEK': {'buy': Decimal('11.325445'), 'sell': Decimal('11.323514999999999')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.5844900000000001'), 'sell': Decimal('0.58414')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80155')}, 'USDCNH': {'buy': Decimal('7.182675'), 'sell': Decimal('7.182245')}, 'NZDUSD': {'buy': Decimal('0.59445'), 'sell': Decimal('0.59422')}, 'NZDJPY': {'buy': Decimal('88.374'), 'sell': Decimal('88.336')}, 'EURSGD': {'buy': Decimal('1.4927300000000001'), 'sell': Decimal('1.49234')}, 'CADJPY': {'buy': Decimal('108.377'), 'sell': Decimal('108.339')}, 'USDCZK': {'buy': Decimal('21.2445'), 'sell': Decimal('21.1795')}, 'US30': {'buy': Decimal('44044.5'), 'sell': Decimal('44042.5')}, 'GBPNZD': {'buy': Decimal('2.255065'), 'sell': Decimal('2.2546549999999996')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.425')}, 'BTCUSD': {'buy': Decimal('118950.1'), 'sell': Decimal('118850.0')}, 'USDSGD': {'buy': Decimal('1.284915'), 'sell': Decimal('1.2846250000000001')}, 'NOKSEK': {'buy': Decimal('0.947025'), 'sell': Decimal('0.946415')}, 'EURPLN': {'buy': Decimal('4.25671'), 'sell': Decimal('4.255739999999999')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78104'), 'sell': Decimal('1.78068')}, 'SGDJPY': {'buy': Decimal('115.736'), 'sell': Decimal('115.687')}, 'EURZAR': {'buy': Decimal('20.81812'), 'sell': Decimal('20.812479999999997')}, 'USDTRY': {'buy': Decimal('40.260985'), 'sell': Decimal('40.258585000000004')}, 'USDNOK': {'buy': Decimal('10.29699'), 'sell': Decimal('10.29587')}, 'USDZAR': {'buy': Decimal('17.920115'), 'sell': Decimal('17.915425000000003')}, 'NZDCAD': {'buy': Decimal('0.81556'), 'sell': Decimal('0.81527')}, 'USDCAD': {'buy': Decimal('1.37218'), 'sell': Decimal('1.37192')}}
2025-07-16 03:41:09,591 - DEBUG - app - [AUTO-CUTOFF] User 14 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:41:09,591 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-16 03:41:09,982 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '431.887174606164153202480729', 'margin': '9494.47000000', 'free_margin': '-9062.582825393835846797519271', 'profit_loss': '-9470.132825393835846797519271', 'margin_level': '4.548828682445298718122030287', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9458.970000000000000000000000', 'current_price': '118850.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.14802308530531527047206490', 'current_price': '96.961'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.014802308530531527047206490', 'current_price': '96.961'}], 'margin_call': True}
2025-07-16 03:41:09,982 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 14: {'balance': '9902.02000000', 'equity': '431.887174606164153202480729', 'margin': '9494.47000000', 'free_margin': '-9062.582825393835846797519271', 'profit_loss': '-9470.132825393835846797519271', 'margin_level': '4.548828682445298718122030287', 'positions_with_pnl': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9458.970000000000000000000000', 'current_price': '118850.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.14802308530531527047206490', 'current_price': '96.961'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.014802308530531527047206490', 'current_price': '96.961'}], 'margin_call': True}
2025-07-16 03:41:09,983 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.548828682445298718122030287
2025-07-16 03:41:10,011 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-16 03:41:10,011 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-16 03:41:10,011 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 16 (live) from cache/DB...
2025-07-16 03:41:10,013 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:41:10,048 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 16...
2025-07-16 03:41:10,054 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 open orders.
2025-07-16 03:41:10,055 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 16...
2025-07-16 03:41:10,058 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 pending orders.
2025-07-16 03:41:10,058 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,058 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-16 03:41:10,058 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 17 (live) from cache/DB...
2025-07-16 03:41:10,059 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:10,082 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 17...
2025-07-16 03:41:10,085 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 open orders.
2025-07-16 03:41:10,085 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 17...
2025-07-16 03:41:10,088 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 pending orders.
2025-07-16 03:41:10,088 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,088 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-16 03:41:10,088 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 18 (live) from cache/DB...
2025-07-16 03:41:10,089 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:10,110 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 18...
2025-07-16 03:41:10,113 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 open orders.
2025-07-16 03:41:10,113 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 18...
2025-07-16 03:41:10,115 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 pending orders.
2025-07-16 03:41:10,116 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,116 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-16 03:41:10,116 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 19 (live) from cache/DB...
2025-07-16 03:41:10,116 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Elite...
2025-07-16 03:41:10,135 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 19...
2025-07-16 03:41:10,138 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 open orders.
2025-07-16 03:41:10,138 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 19...
2025-07-16 03:41:10,141 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 pending orders.
2025-07-16 03:41:10,141 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,141 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-16 03:41:10,141 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 20 (live) from cache/DB...
2025-07-16 03:41:10,142 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:41:10,162 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 20...
2025-07-16 03:41:10,165 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 open orders.
2025-07-16 03:41:10,165 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 20...
2025-07-16 03:41:10,168 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 pending orders.
2025-07-16 03:41:10,168 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,168 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-16 03:41:10,168 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 21 (live) from cache/DB...
2025-07-16 03:41:10,169 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:10,188 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 21...
2025-07-16 03:41:10,191 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 open orders.
2025-07-16 03:41:10,191 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 21...
2025-07-16 03:41:10,194 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 pending orders.
2025-07-16 03:41:10,194 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,194 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-16 03:41:10,194 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 22 (live) from cache/DB...
2025-07-16 03:41:10,195 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group VIP...
2025-07-16 03:41:10,215 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 22...
2025-07-16 03:41:10,218 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 open orders.
2025-07-16 03:41:10,218 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 22...
2025-07-16 03:41:10,221 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 pending orders.
2025-07-16 03:41:10,221 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,221 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-16 03:41:10,221 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 23 (live) from cache/DB...
2025-07-16 03:41:10,222 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:10,242 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 23...
2025-07-16 03:41:10,245 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 open orders.
2025-07-16 03:41:10,245 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 23...
2025-07-16 03:41:10,248 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 pending orders.
2025-07-16 03:41:10,248 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,248 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-16 03:41:10,248 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 25 (live) from cache/DB...
2025-07-16 03:41:10,249 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:10,270 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 25...
2025-07-16 03:41:10,274 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 open orders.
2025-07-16 03:41:10,274 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 25...
2025-07-16 03:41:10,277 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 pending orders.
2025-07-16 03:41:10,277 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:10,277 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-16 03:41:10,277 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 26 (live) from cache/DB...
2025-07-16 03:41:10,277 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Royal+...
2025-07-16 03:41:10,298 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 26...
2025-07-16 03:41:10,302 - DEBUG - app - [AUTO-CUTOFF] User 26 has 2 open orders.
2025-07-16 03:41:10,302 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 26...
2025-07-16 03:41:10,304 - DEBUG - app - [AUTO-CUTOFF] User 26 has 0 pending orders.
2025-07-16 03:41:10,304 - DEBUG - app - [AUTO-CUTOFF] User 26 total positions for portfolio calculation: 2
2025-07-16 03:41:10,332 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:10,335 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:10,384 - DEBUG - app - [AUTO-CUTOFF] User 26 adjusted market prices: {'EURSGD': {'buy': Decimal('1.49272'), 'sell': Decimal('1.49235')}, 'USDCNH': {'buy': Decimal('7.18266'), 'sell': Decimal('7.182259999999999')}, 'BTCUSD': {'buy': Decimal('118950.1'), 'sell': Decimal('118850.0')}, 'USDSEK': {'buy': Decimal('9.748525'), 'sell': Decimal('9.747745')}, 'AUDJPY': {'buy': Decimal('96.9955'), 'sell': Decimal('96.9645')}, 'EURNOK': {'buy': Decimal('11.962535'), 'sell': Decimal('11.960815')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDCHF': {'buy': Decimal('0.8017799999999999'), 'sell': Decimal('0.80156')}, 'USDTRY': {'buy': Decimal('40.26097'), 'sell': Decimal('40.2586')}, 'NZDCAD': {'buy': Decimal('0.81555'), 'sell': Decimal('0.81528')}, 'GBPAUD': {'buy': Decimal('2.0544200000000004'), 'sell': Decimal('2.0540399999999996')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93114')}, 'EURNZD': {'buy': Decimal('1.9549100000000001'), 'sell': Decimal('1.9544599999999999')}, 'USDCZK': {'buy': Decimal('21.2270000000'), 'sell': Decimal('21.1970000000')}, 'EURCAD': {'buy': Decimal('1.5940349999999999'), 'sell': Decimal('1.593785')}, 'EURSEK': {'buy': Decimal('11.325445'), 'sell': Decimal('11.323514999999999')}, 'CHFSGD': {'buy': Decimal('1.6028749999999998'), 'sell': Decimal('1.6023850000000002')}, 'EURGBP': {'buy': Decimal('0.86703'), 'sell': Decimal('0.86672')}, 'NZDJPY': {'buy': Decimal('88.3715'), 'sell': Decimal('88.3385')}, 'AUDUSD': {'buy': Decimal('0.6524650000000001'), 'sell': Decimal('0.652215')}, 'EURAUD': {'buy': Decimal('1.781035'), 'sell': Decimal('1.780685')}, 'GBPNZD': {'buy': Decimal('2.25504'), 'sell': Decimal('2.2546799999999996')}, 'GBPSEK': {'buy': Decimal('13.064375'), 'sell': Decimal('13.061425')}, 'SGDJPY': {'buy': Decimal('115.736'), 'sell': Decimal('115.687')}, 'EURZAR': {'buy': Decimal('20.818095'), 'sell': Decimal('20.812504999999998')}, 'NOKSEK': {'buy': Decimal('0.947025'), 'sell': Decimal('0.946415')}, 'USDNOK': {'buy': Decimal('10.296965'), 'sell': Decimal('10.295895')}, 'USDJPY': {'buy': Decimal('148.6735'), 'sell': Decimal('148.6535')}, 'USDZAR': {'buy': Decimal('17.9201'), 'sell': Decimal('17.91544')}, 'AUDCAD': {'buy': Decimal('0.895115'), 'sell': Decimal('0.894925')}, 'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.1616499999999998')}, 'NZDUSD': {'buy': Decimal('0.59445'), 'sell': Decimal('0.59422')}, 'EURJPY': {'buy': Decimal('172.72400000000002'), 'sell': Decimal('172.691')}, 'CHFJPY': {'buy': Decimal('185.46249999999998'), 'sell': Decimal('185.4275')}, 'USDCAD': {'buy': Decimal('1.37217'), 'sell': Decimal('1.37193')}, 'AUDCHF': {'buy': Decimal('0.523065'), 'sell': Decimal('0.522855')}, 'GBPNOK': {'buy': Decimal('13.798975'), 'sell': Decimal('13.796624999999999')}, 'US30': {'buy': Decimal('44044.5'), 'sell': Decimal('44042.5')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'USDSGD': {'buy': Decimal('1.2849000000000002'), 'sell': Decimal('1.28464')}, 'XAGUSD': {'buy': Decimal('38.066500000000005'), 'sell': Decimal('38.0355')}, 'D30': {'buy': Decimal('24128.17'), 'sell': Decimal('24127.17')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}, 'CADCHF': {'buy': Decimal('0.5844750000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34021'), 'sell': Decimal('1.3400800000000002')}, 'CADJPY': {'buy': Decimal('108.3755'), 'sell': Decimal('108.34049999999999')}, 'EURPLN': {'buy': Decimal('4.25671'), 'sell': Decimal('4.255739999999999')}}
2025-07-16 03:41:10,385 - DEBUG - app - [AUTO-CUTOFF] User 26 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:41:10,385 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-16 03:41:10,687 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101079.5650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45404.9050000000000000000000', 'profit_loss': '-83266.24500000000000000000000', 'margin_level': '69.00360495552873284109912812', 'positions': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-153.225000000000000000000000', 'current_price': '38.0355'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-83113.02000000000000000000000', 'current_price': '118850.0'}], 'margin_call': True}
2025-07-16 03:41:10,688 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 26: {'balance': '184345.81000000', 'equity': '101079.5650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45404.9050000000000000000000', 'profit_loss': '-83266.24500000000000000000000', 'margin_level': '69.00360495552873284109912812', 'positions_with_pnl': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-153.225000000000000000000000', 'current_price': '38.0355'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-83113.02000000000000000000000', 'current_price': '118850.0'}], 'margin_call': True}
2025-07-16 03:41:10,689 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 69.00360495552873284109912812
2025-07-16 03:41:10,689 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-16 03:41:10,690 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-16 03:41:10,690 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 1 (demo) from cache/DB...
2025-07-16 03:41:10,690 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:10,714 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 1...
2025-07-16 03:41:10,719 - DEBUG - app - [AUTO-CUTOFF] User 1 has 2 open orders.
2025-07-16 03:41:10,719 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 1...
2025-07-16 03:41:10,724 - DEBUG - app - [AUTO-CUTOFF] User 1 has 1 pending orders.
2025-07-16 03:41:10,725 - DEBUG - app - [AUTO-CUTOFF] User 1 total positions for portfolio calculation: 3
2025-07-16 03:41:10,798 - DEBUG - app - [AUTO-CUTOFF] User 1 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.1616499999999998')}, 'USDZAR': {'buy': Decimal('17.920090000000002'), 'sell': Decimal('17.91545')}, 'SGDJPY': {'buy': Decimal('115.7335'), 'sell': Decimal('115.6895')}, 'GBPAUD': {'buy': Decimal('2.0544700000000002'), 'sell': Decimal('2.0539899999999998')}, 'USDNOK': {'buy': Decimal('10.29694'), 'sell': Decimal('10.29592')}, 'NZDCAD': {'buy': Decimal('0.81561'), 'sell': Decimal('0.8152200000000001')}, 'GBPNZD': {'buy': Decimal('2.25509'), 'sell': Decimal('2.2546299999999997')}, 'US30': {'buy': Decimal('44044.5'), 'sell': Decimal('44042.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.425')}, 'CADJPY': {'buy': Decimal('108.3755'), 'sell': Decimal('108.34049999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015100000000001')}, 'USDTRY': {'buy': Decimal('40.26096'), 'sell': Decimal('40.258610000000004')}, 'GBPSEK': {'buy': Decimal('13.06435'), 'sell': Decimal('13.06145')}, 'GBPNOK': {'buy': Decimal('13.79895'), 'sell': Decimal('13.79665')}, 'USDCNH': {'buy': Decimal('7.18265'), 'sell': Decimal('7.18227')}, 'EURCHF': {'buy': Decimal('0.9314899999999999'), 'sell': Decimal('0.93113')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'BTCUSD': {'buy': Decimal('118950.1'), 'sell': Decimal('118850.0')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96251'), 'sell': Decimal('11.960840000000001')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.37188')}, 'NOKSEK': {'buy': Decimal('0.946975'), 'sell': Decimal('0.946465')}, 'CADCHF': {'buy': Decimal('0.5844750000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34025'), 'sell': Decimal('1.3400400000000001')}, 'CHFSGD': {'buy': Decimal('1.6028449999999999'), 'sell': Decimal('1.6024150000000001')}, 'EURGBP': {'buy': Decimal('0.86705'), 'sell': Decimal('0.8667')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.033'), 'sell': Decimal('96.927')}, 'EURJPY': {'buy': Decimal('172.7225'), 'sell': Decimal('172.69250000000002')}, 'AUDCHF': {'buy': Decimal('0.5231899999999999'), 'sell': Decimal('0.52273')}, 'EURZAR': {'buy': Decimal('20.81812'), 'sell': Decimal('20.812479999999997')}, 'USDCZK': {'buy': Decimal('21.2270000000'), 'sell': Decimal('21.1970000000')}, 'D30': {'buy': Decimal('24127.67'), 'sell': Decimal('24127.67')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65219')}, 'EURSEK': {'buy': Decimal('11.32542'), 'sell': Decimal('11.32354')}, 'NZDJPY': {'buy': Decimal('88.3715'), 'sell': Decimal('88.3385')}, 'USDSGD': {'buy': Decimal('1.2849400000000002'), 'sell': Decimal('1.2846')}, 'EURSGD': {'buy': Decimal('1.492705'), 'sell': Decimal('1.4923650000000002')}, 'NZDUSD': {'buy': Decimal('0.5945'), 'sell': Decimal('0.59417')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.2566999999999995'), 'sell': Decimal('4.25575')}, 'AUDCAD': {'buy': Decimal('0.89504'), 'sell': Decimal('0.895')}, 'EURCAD': {'buy': Decimal('1.59401'), 'sell': Decimal('1.59381')}, 'EURNZD': {'buy': Decimal('1.954885'), 'sell': Decimal('1.954485')}, 'USDSEK': {'buy': Decimal('9.7485'), 'sell': Decimal('9.747770000000001')}, 'USDJPY': {'buy': Decimal('148.716'), 'sell': Decimal('148.611')}, 'EURAUD': {'buy': Decimal('1.78105'), 'sell': Decimal('1.78067')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}}
2025-07-16 03:41:10,798 - DEBUG - app - [AUTO-CUTOFF] User 1 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:41:10,798 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-16 03:41:11,106 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17011.54000000', 'equity': '17009.90053166157695774420513', 'margin': '6.54000000', 'free_margin': '17003.36053166157695774420513', 'profit_loss': '-1.639468338423042255794869035', 'margin_level': '260090.2221966601981306453384', 'positions': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.642160278745644599303135889', 'current_price': '96.927'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.281628617168686855098004924', 'current_price': '97.033'}], 'margin_call': False}
2025-07-16 03:41:11,106 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 1: {'balance': '17011.54000000', 'equity': '17009.90053166157695774420513', 'margin': '6.54000000', 'free_margin': '17003.36053166157695774420513', 'profit_loss': '-1.639468338423042255794869035', 'margin_level': '260090.2221966601981306453384', 'positions_with_pnl': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.642160278745644599303135889', 'current_price': '96.927'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.281628617168686855098004924', 'current_price': '97.033'}], 'margin_call': False}
2025-07-16 03:41:11,107 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 260090.2221966601981306453384
2025-07-16 03:41:11,108 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-16 03:41:11,108 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-16 03:41:11,108 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 2 (demo) from cache/DB...
2025-07-16 03:41:11,109 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-16 03:41:11,110 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-16 03:41:11,110 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 3 (demo) from cache/DB...
2025-07-16 03:41:11,110 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:41:11,119 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 3.
2025-07-16 03:41:11,119 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-16 03:41:11,119 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (demo) from cache/DB...
2025-07-16 03:41:11,120 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:11,141 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:41:11,144 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:41:11,144 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:41:11,147 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:41:11,147 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:11,148 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-16 03:41:11,148 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (demo) from cache/DB...
2025-07-16 03:41:11,148 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-16 03:41:11,149 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-16 03:41:11,149 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 6 (demo) from cache/DB...
2025-07-16 03:41:11,149 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-16 03:41:11,149 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-16 03:41:11,149 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (demo) from cache/DB...
2025-07-16 03:41:11,150 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:11,172 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:41:11,177 - DEBUG - app - [AUTO-CUTOFF] User 9 has 28 open orders.
2025-07-16 03:41:11,177 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:41:11,181 - DEBUG - app - [AUTO-CUTOFF] User 9 has 6 pending orders.
2025-07-16 03:41:11,181 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 34
2025-07-16 03:41:11,255 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.1616499999999998')}, 'USDZAR': {'buy': Decimal('17.920090000000002'), 'sell': Decimal('17.91545')}, 'SGDJPY': {'buy': Decimal('115.7335'), 'sell': Decimal('115.6895')}, 'GBPAUD': {'buy': Decimal('2.0544700000000002'), 'sell': Decimal('2.0539899999999998')}, 'USDNOK': {'buy': Decimal('10.29694'), 'sell': Decimal('10.29592')}, 'NZDCAD': {'buy': Decimal('0.81561'), 'sell': Decimal('0.8152200000000001')}, 'GBPNZD': {'buy': Decimal('2.25509'), 'sell': Decimal('2.2546299999999997')}, 'US30': {'buy': Decimal('44044.5'), 'sell': Decimal('44042.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.425')}, 'CADJPY': {'buy': Decimal('108.3755'), 'sell': Decimal('108.34049999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015100000000001')}, 'USDTRY': {'buy': Decimal('40.26096'), 'sell': Decimal('40.258610000000004')}, 'GBPSEK': {'buy': Decimal('13.06435'), 'sell': Decimal('13.06145')}, 'GBPNOK': {'buy': Decimal('13.79895'), 'sell': Decimal('13.79665')}, 'USDCNH': {'buy': Decimal('7.18265'), 'sell': Decimal('7.18227')}, 'EURCHF': {'buy': Decimal('0.9314899999999999'), 'sell': Decimal('0.93113')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'BTCUSD': {'buy': Decimal('118950.1'), 'sell': Decimal('118850.0')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96251'), 'sell': Decimal('11.960840000000001')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.37188')}, 'NOKSEK': {'buy': Decimal('0.946975'), 'sell': Decimal('0.946465')}, 'CADCHF': {'buy': Decimal('0.5844750000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34025'), 'sell': Decimal('1.3400400000000001')}, 'CHFSGD': {'buy': Decimal('1.6028449999999999'), 'sell': Decimal('1.6024150000000001')}, 'EURGBP': {'buy': Decimal('0.86705'), 'sell': Decimal('0.8667')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.033'), 'sell': Decimal('96.927')}, 'EURJPY': {'buy': Decimal('172.7225'), 'sell': Decimal('172.69250000000002')}, 'AUDCHF': {'buy': Decimal('0.5231899999999999'), 'sell': Decimal('0.52273')}, 'EURZAR': {'buy': Decimal('20.81812'), 'sell': Decimal('20.812479999999997')}, 'USDCZK': {'buy': Decimal('21.2270000000'), 'sell': Decimal('21.1970000000')}, 'D30': {'buy': Decimal('24127.67'), 'sell': Decimal('24127.67')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65219')}, 'EURSEK': {'buy': Decimal('11.32542'), 'sell': Decimal('11.32354')}, 'NZDJPY': {'buy': Decimal('88.3715'), 'sell': Decimal('88.3385')}, 'USDSGD': {'buy': Decimal('1.2849400000000002'), 'sell': Decimal('1.2846')}, 'EURSGD': {'buy': Decimal('1.492705'), 'sell': Decimal('1.4923650000000002')}, 'NZDUSD': {'buy': Decimal('0.5945'), 'sell': Decimal('0.59417')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.2566999999999995'), 'sell': Decimal('4.25575')}, 'AUDCAD': {'buy': Decimal('0.89504'), 'sell': Decimal('0.895')}, 'EURCAD': {'buy': Decimal('1.59401'), 'sell': Decimal('1.59381')}, 'EURNZD': {'buy': Decimal('1.954885'), 'sell': Decimal('1.954485')}, 'USDSEK': {'buy': Decimal('9.7485'), 'sell': Decimal('9.747770000000001')}, 'USDJPY': {'buy': Decimal('148.716'), 'sell': Decimal('148.611')}, 'EURAUD': {'buy': Decimal('1.78105'), 'sell': Decimal('1.78067')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}}
2025-07-16 03:41:11,255 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:41:11,255 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:41:11,523 - DEBUG - app.firebase_stream - Firebase listener triggered (28). Event Type: patch, Path: /. Timestamp: 1752662471.5229723
2025-07-16 03:41:11,523 - DEBUG - app.firebase_stream - Prepared batch update for 18 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0615700000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118888.9000000000', 'o': '118888.8000000000'}, 'EURZAR': {'b': '20.81805
2025-07-16 03:41:11,524 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0615700000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118888.9000000000', 'o': '118888.8000000000'}, 'EURZAR': {'b': '20.81805...
2025-07-16 03:41:11,524 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:11,573 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:11,592 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:11,639 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '98181.73000000', 'equity': '98227.87877147542287529865865', 'margin': '1917.31000000', 'free_margin': '96310.56877147542287529865865', 'profit_loss': '46.1487714754228752986586545', 'margin_level': '5123.213187824369709400079207', 'positions': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.600000000000000000000000', 'current_price': '0.65219'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-121.440000000000000000000000', 'current_price': '0.65249'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '207.5944006413507265778843235', 'current_price': '1.6024150000000001'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.2999400680259030658706870', 'current_price': '1.6028449999999999'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-215.3148668828111336822138216', 'current_price': '108.3755'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.8574388225946080475697200', 'current_price': '108.34049999999999'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '81.89967280000000000000000000', 'current_price': '1.78067'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-93.33627240000000000000000000', 'current_price': '1.78105'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '488.0156458100708971789111162', 'current_price': '185.425'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-496.7421333727933757550482289', 'current_price': '185.46499999999997'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.64617900000000000000000000', 'current_price': '1.78067'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.12507100000000000000000000', 'current_price': '1.78105'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-175.4771140000000000000000000', 'current_price': '0.86705'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '364.3828044071959963946026664', 'current_price': '172.69250000000002'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-370.3514320692021040453096202', 'current_price': '172.7225'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.1621600000000000000000000', 'current_price': '1.954885'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '200.1874750000000000000000000', 'current_price': '1.954485'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34025'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34025'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000000', 'current_price': '1.3400400000000001'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000000', 'current_price': '1.3400400000000001'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.220665115090202198216135498', 'current_price': '88.3385'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '295.6260353258176579183714200', 'current_price': '0.8018299999999999'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-310.9751022851992066660013971', 'current_price': '0.8015100000000001'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.0950922330757113416479391', 'current_price': '10.29592'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.6095016480944454264165163', 'current_price': '10.29592'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '69.52665493971294919792339604', 'current_price': '1.2849400000000002'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.8887021895485957684408237', 'current_price': '40.26096'}], 'margin_call': False}
2025-07-16 03:41:11,639 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '98181.73000000', 'equity': '98227.87877147542287529865865', 'margin': '1917.31000000', 'free_margin': '96310.56877147542287529865865', 'profit_loss': '46.1487714754228752986586545', 'margin_level': '5123.213187824369709400079207', 'positions_with_pnl': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.600000000000000000000000', 'current_price': '0.65219'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-121.440000000000000000000000', 'current_price': '0.65249'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '207.5944006413507265778843235', 'current_price': '1.6024150000000001'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.2999400680259030658706870', 'current_price': '1.6028449999999999'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-215.3148668828111336822138216', 'current_price': '108.3755'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.8574388225946080475697200', 'current_price': '108.34049999999999'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '81.89967280000000000000000000', 'current_price': '1.78067'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-93.33627240000000000000000000', 'current_price': '1.78105'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '488.0156458100708971789111162', 'current_price': '185.425'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-496.7421333727933757550482289', 'current_price': '185.46499999999997'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '18.64617900000000000000000000', 'current_price': '1.78067'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.12507100000000000000000000', 'current_price': '1.78105'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-175.4771140000000000000000000', 'current_price': '0.86705'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '364.3828044071959963946026664', 'current_price': '172.69250000000002'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-370.3514320692021040453096202', 'current_price': '172.7225'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-211.1621600000000000000000000', 'current_price': '1.954885'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '200.1874750000000000000000000', 'current_price': '1.954485'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34025'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.34025'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000000', 'current_price': '1.3400400000000001'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000000', 'current_price': '1.3400400000000001'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.220665115090202198216135498', 'current_price': '88.3385'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '295.6260353258176579183714200', 'current_price': '0.8018299999999999'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-310.9751022851992066660013971', 'current_price': '0.8015100000000001'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '238.0950922330757113416479391', 'current_price': '10.29592'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.6095016480944454264165163', 'current_price': '10.29592'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '69.52665493971294919792339604', 'current_price': '1.2849400000000002'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.8887021895485957684408237', 'current_price': '40.26096'}], 'margin_call': False}
2025-07-16 03:41:11,646 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 5123.213187824369709400079207
2025-07-16 03:41:11,647 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:41:11,647 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-16 03:41:11,647 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (demo) from cache/DB...
2025-07-16 03:41:11,650 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:11,671 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:41:11,676 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:41:11,676 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:41:11,680 - DEBUG - app - [AUTO-CUTOFF] User 10 has 1 pending orders.
2025-07-16 03:41:11,680 - DEBUG - app - [AUTO-CUTOFF] User 10 total positions for portfolio calculation: 1
2025-07-16 03:41:11,726 - DEBUG - app - [AUTO-CUTOFF] User 10 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618300000000001'), 'sell': Decimal('1.1616499999999998')}, 'USDZAR': {'buy': Decimal('17.920090000000002'), 'sell': Decimal('17.91545')}, 'SGDJPY': {'buy': Decimal('115.7335'), 'sell': Decimal('115.6895')}, 'GBPAUD': {'buy': Decimal('2.0544700000000002'), 'sell': Decimal('2.0539899999999998')}, 'USDNOK': {'buy': Decimal('10.29694'), 'sell': Decimal('10.29592')}, 'NZDCAD': {'buy': Decimal('0.81561'), 'sell': Decimal('0.8152200000000001')}, 'GBPNZD': {'buy': Decimal('2.25509'), 'sell': Decimal('2.2546299999999997')}, 'US30': {'buy': Decimal('44044.5'), 'sell': Decimal('44042.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.425')}, 'CADJPY': {'buy': Decimal('108.3755'), 'sell': Decimal('108.34049999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015100000000001')}, 'USDTRY': {'buy': Decimal('40.26096'), 'sell': Decimal('40.258610000000004')}, 'GBPSEK': {'buy': Decimal('13.06435'), 'sell': Decimal('13.06145')}, 'GBPNOK': {'buy': Decimal('13.79895'), 'sell': Decimal('13.79665')}, 'USDCNH': {'buy': Decimal('7.18265'), 'sell': Decimal('7.18227')}, 'EURCHF': {'buy': Decimal('0.9314899999999999'), 'sell': Decimal('0.93113')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'BTCUSD': {'buy': Decimal('118950.1'), 'sell': Decimal('118850.0')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96251'), 'sell': Decimal('11.960840000000001')}, 'USDCAD': {'buy': Decimal('1.37222'), 'sell': Decimal('1.37188')}, 'NOKSEK': {'buy': Decimal('0.946975'), 'sell': Decimal('0.946465')}, 'CADCHF': {'buy': Decimal('0.5844750000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34025'), 'sell': Decimal('1.3400400000000001')}, 'CHFSGD': {'buy': Decimal('1.6028449999999999'), 'sell': Decimal('1.6024150000000001')}, 'EURGBP': {'buy': Decimal('0.86705'), 'sell': Decimal('0.8667')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.033'), 'sell': Decimal('96.927')}, 'EURJPY': {'buy': Decimal('172.7225'), 'sell': Decimal('172.69250000000002')}, 'AUDCHF': {'buy': Decimal('0.5231899999999999'), 'sell': Decimal('0.52273')}, 'EURZAR': {'buy': Decimal('20.81812'), 'sell': Decimal('20.812479999999997')}, 'USDCZK': {'buy': Decimal('21.2270000000'), 'sell': Decimal('21.1970000000')}, 'D30': {'buy': Decimal('24127.67'), 'sell': Decimal('24127.67')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65219')}, 'EURSEK': {'buy': Decimal('11.32542'), 'sell': Decimal('11.32354')}, 'NZDJPY': {'buy': Decimal('88.3715'), 'sell': Decimal('88.3385')}, 'USDSGD': {'buy': Decimal('1.2849400000000002'), 'sell': Decimal('1.2846')}, 'EURSGD': {'buy': Decimal('1.492705'), 'sell': Decimal('1.492385')}, 'NZDUSD': {'buy': Decimal('0.5945'), 'sell': Decimal('0.59417')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.2566999999999995'), 'sell': Decimal('4.25575')}, 'AUDCAD': {'buy': Decimal('0.89504'), 'sell': Decimal('0.895')}, 'EURCAD': {'buy': Decimal('1.59401'), 'sell': Decimal('1.59381')}, 'EURNZD': {'buy': Decimal('1.954885'), 'sell': Decimal('1.954485')}, 'USDSEK': {'buy': Decimal('9.7485'), 'sell': Decimal('9.747770000000001')}, 'USDJPY': {'buy': Decimal('148.716'), 'sell': Decimal('148.611')}, 'EURAUD': {'buy': Decimal('1.78105'), 'sell': Decimal('1.78067')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}}
2025-07-16 03:41:11,726 - DEBUG - app - [AUTO-CUTOFF] User 10 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:41:11,726 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-16 03:41:12,026 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions': [], 'margin_call': False}
2025-07-16 03:41:12,026 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions_with_pnl': [], 'margin_call': False}
2025-07-16 03:41:12,028 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 25371.71974522292993630573248
2025-07-16 03:41:12,029 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-16 03:41:12,030 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-16 03:41:12,030 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (demo) from cache/DB...
2025-07-16 03:41:12,033 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:12,058 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:41:12,063 - DEBUG - app - [AUTO-CUTOFF] User 11 has 1 open orders.
2025-07-16 03:41:12,063 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:41:12,068 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:41:12,068 - DEBUG - app - [AUTO-CUTOFF] User 11 total positions for portfolio calculation: 1
2025-07-16 03:41:12,127 - DEBUG - app - [AUTO-CUTOFF] User 11 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16182'), 'sell': Decimal('1.1616499999999998')}, 'USDZAR': {'buy': Decimal('17.92022'), 'sell': Decimal('17.915689999999998')}, 'SGDJPY': {'buy': Decimal('115.7345'), 'sell': Decimal('115.69149999999999')}, 'GBPAUD': {'buy': Decimal('2.0544700000000002'), 'sell': Decimal('2.054')}, 'USDNOK': {'buy': Decimal('10.29694'), 'sell': Decimal('10.29592')}, 'NZDCAD': {'buy': Decimal('0.81561'), 'sell': Decimal('0.8152200000000001')}, 'GBPNZD': {'buy': Decimal('2.2549900000000003'), 'sell': Decimal('2.25449')}, 'US30': {'buy': Decimal('44043.5'), 'sell': Decimal('44041.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.425')}, 'CADJPY': {'buy': Decimal('108.3735'), 'sell': Decimal('108.34049999999999')}, 'USDCHF': {'buy': Decimal('0.8018299999999999'), 'sell': Decimal('0.8015')}, 'USDTRY': {'buy': Decimal('40.26096'), 'sell': Decimal('40.258610000000004')}, 'GBPSEK': {'buy': Decimal('13.06415'), 'sell': Decimal('13.06142')}, 'GBPNOK': {'buy': Decimal('13.79895'), 'sell': Decimal('13.79665')}, 'USDCNH': {'buy': Decimal('7.18265'), 'sell': Decimal('7.18227')}, 'EURCHF': {'buy': Decimal('0.9315'), 'sell': Decimal('0.93113')}, 'XAGUSD': {'buy': Decimal('38.069'), 'sell': Decimal('38.033')}, 'BTCUSD': {'buy': Decimal('118938.9'), 'sell': Decimal('118838.8')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96251'), 'sell': Decimal('11.960840000000001')}, 'USDCAD': {'buy': Decimal('1.37223'), 'sell': Decimal('1.37188')}, 'NOKSEK': {'buy': Decimal('0.946975'), 'sell': Decimal('0.946465')}, 'CADCHF': {'buy': Decimal('0.5844750000000001'), 'sell': Decimal('0.584155')}, 'GBPUSD': {'buy': Decimal('1.34017'), 'sell': Decimal('1.33996')}, 'CHFSGD': {'buy': Decimal('1.602855'), 'sell': Decimal('1.6024150000000001')}, 'EURGBP': {'buy': Decimal('0.86709'), 'sell': Decimal('0.86675')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.032'), 'sell': Decimal('96.926')}, 'EURJPY': {'buy': Decimal('172.7225'), 'sell': Decimal('172.69250000000002')}, 'AUDCHF': {'buy': Decimal('0.5231899999999999'), 'sell': Decimal('0.52273')}, 'EURZAR': {'buy': Decimal('20.8182'), 'sell': Decimal('20.812559999999998')}, 'USDCZK': {'buy': Decimal('21.2270000000'), 'sell': Decimal('21.1970000000')}, 'D30': {'buy': Decimal('24127.67'), 'sell': Decimal('24127.67')}, 'AUDUSD': {'buy': Decimal('0.65249'), 'sell': Decimal('0.65219')}, 'EURSEK': {'buy': Decimal('11.32542'), 'sell': Decimal('11.32354')}, 'NZDJPY': {'buy': Decimal('88.3715'), 'sell': Decimal('88.3385')}, 'USDSGD': {'buy': Decimal('1.2849400000000002'), 'sell': Decimal('1.2846')}, 'EURSGD': {'buy': Decimal('1.492705'), 'sell': Decimal('1.492385')}, 'NZDUSD': {'buy': Decimal('0.5945'), 'sell': Decimal('0.59417')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.2566999999999995'), 'sell': Decimal('4.25575')}, 'AUDCAD': {'buy': Decimal('0.89504'), 'sell': Decimal('0.895')}, 'EURCAD': {'buy': Decimal('1.59401'), 'sell': Decimal('1.59381')}, 'EURNZD': {'buy': Decimal('1.954885'), 'sell': Decimal('1.954485')}, 'USDSEK': {'buy': Decimal('9.7485'), 'sell': Decimal('9.747770000000001')}, 'USDJPY': {'buy': Decimal('148.716'), 'sell': Decimal('148.611')}, 'EURAUD': {'buy': Decimal('1.78105'), 'sell': Decimal('1.78067')}, 'JP225': {'buy': Decimal('39571.79'), 'sell': Decimal('39567.79')}}
2025-07-16 03:41:12,127 - DEBUG - app - [AUTO-CUTOFF] User 11 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:41:12,128 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-16 03:41:12,438 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '99998.61000000', 'equity': '99996.67337239811089732377121', 'margin': '6.55', 'free_margin': '99990.12337239811089732377121', 'profit_loss': '-1.936627601889102676228791324', 'margin_level': '1526666.769044245967898072843', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.936627601889102676228791324', 'current_price': '0.895'}], 'margin_call': False}
2025-07-16 03:41:12,438 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 11: {'balance': '99998.61000000', 'equity': '99996.67337239811089732377121', 'margin': '6.55', 'free_margin': '99990.12337239811089732377121', 'profit_loss': '-1.936627601889102676228791324', 'margin_level': '1526666.769044245967898072843', 'positions_with_pnl': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.936627601889102676228791324', 'current_price': '0.895'}], 'margin_call': False}
2025-07-16 03:41:12,439 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 1526666.769044245967898072843
2025-07-16 03:41:12,440 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-16 03:41:12,440 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-16 03:41:12,440 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (demo) from cache/DB...
2025-07-16 03:41:12,441 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:12,464 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:41:12,468 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:41:12,469 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:41:12,472 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:41:12,472 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:12,472 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-16 03:41:12,472 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (demo) from cache/DB...
2025-07-16 03:41:12,473 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:41:12,496 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:41:12,525 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:41:12,525 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:41:12,528 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:41:12,528 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:41:12,613 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:12,619 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:13,628 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:13,633 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:13,881 - DEBUG - app.firebase_stream - Firebase listener triggered (29). Event Type: patch, Path: /. Timestamp: 1752662473.881464
2025-07-16 03:41:13,881 - DEBUG - app.firebase_stream - Prepared batch update for 18 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541700000'}, 'AUDJPY': {'b': '96.9830000000', 
2025-07-16 03:41:13,882 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541700000'}, 'AUDJPY': {'b': '96.9830000000', ...
2025-07-16 03:41:13,882 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:14,650 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:14,655 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:15,660 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:15,665 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:16,129 - DEBUG - app.firebase_stream - Firebase listener triggered (30). Event Type: patch, Path: /. Timestamp: 1752662476.129382
2025-07-16 03:41:16,129 - DEBUG - app.firebase_stream - Prepared batch update for 15 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6650000000', 'o': '148.6610000000'}, 'EURZAR': {'b': '20.8180900000'
2025-07-16 03:41:16,130 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3590000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6650000000', 'o': '148.6610000000'}, 'EURZAR': {'b': '20.8180900000'...
2025-07-16 03:41:16,130 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:16,680 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:16,685 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:17,705 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:17,709 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:18,388 - DEBUG - app.firebase_stream - Firebase listener triggered (31). Event Type: patch, Path: /. Timestamp: 1752662478.3889194
2025-07-16 03:41:18,389 - DEBUG - app.firebase_stream - Prepared batch update for 16 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0643000000', 'o': '13.0617000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541600000'}, 'CADCHF': {'b': '0.5843400000', '
2025-07-16 03:41:18,390 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0643000000', 'o': '13.0617000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543200000', 'o': '2.0541600000'}, 'CADCHF': {'b': '0.5843400000', '...
2025-07-16 03:41:18,391 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:18,722 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:18,727 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:19,737 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:19,741 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:20,742 - DEBUG - app.firebase_stream - Firebase listener triggered (32). Event Type: patch, Path: /. Timestamp: 1752662480.7426052
2025-07-16 03:41:20,743 - DEBUG - app.firebase_stream - Prepared batch update for 24 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118865.100000000
2025-07-16 03:41:20,744 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:20,744 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3520000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118865.100000000...
2025-07-16 03:41:20,745 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:20,752 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:21,796 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:21,801 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:22,815 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:22,819 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:22,994 - DEBUG - app.firebase_stream - Firebase listener triggered (33). Event Type: patch, Path: /. Timestamp: 1752662482.994803
2025-07-16 03:41:22,995 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'BTCUSD': {'b': '118871.8000000000', 'o': '118871.7000000000'}, 'USDJPY': {'b': '148.6650000000', 'o': '148.6600000000'}, 'EURNZD': {'b': '1.95
2025-07-16 03:41:22,995 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'BTCUSD': {'b': '118871.8000000000', 'o': '118871.7000000000'}, 'USDJPY': {'b': '148.6650000000', 'o': '148.6600000000'}, 'EURNZD': {'b': '1.95...
2025-07-16 03:41:22,995 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:23,822 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:23,827 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:24,839 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:24,843 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:25,378 - DEBUG - app.firebase_stream - Firebase listener triggered (34). Event Type: patch, Path: /. Timestamp: 1752662485.3789105
2025-07-16 03:41:25,379 - DEBUG - app.firebase_stream - Prepared batch update for 35 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0643000000', 'o': '13.0617000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0540800000'}, 'BTCUSD': {'b': '118865.100000000
2025-07-16 03:41:25,381 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0643000000', 'o': '13.0617000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0542600000', 'o': '2.0540800000'}, 'BTCUSD': {'b': '118865.100000000...
2025-07-16 03:41:25,382 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:25,847 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:25,851 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:26,859 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:26,865 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:27,612 - DEBUG - app.firebase_stream - Firebase listener triggered (35). Event Type: patch, Path: /. Timestamp: 1752662487.6120229
2025-07-16 03:41:27,612 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0644000000', 'o': '13.0618000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118858.510000000
2025-07-16 03:41:27,612 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0644000000', 'o': '13.0618000000'}, 'NZDJPY': {'b': '88.3600000000', 'o': '88.3510000000'}, 'GBPAUD': {'b': '2.0543100000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118858.510000000...
2025-07-16 03:41:27,613 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:27,869 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:27,873 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:28,880 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:28,889 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:29,899 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:29,903 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:29,963 - DEBUG - app.firebase_stream - Firebase listener triggered (36). Event Type: patch, Path: /. Timestamp: 1752662489.9631503
2025-07-16 03:41:29,963 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0643000000', 'o': '13.0617000000'}, 'XAGUSD': {'b': '38.0610000000', 'o': '38.0550000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541700000'}, 'BTCUSD': {'b': '118857.560000000
2025-07-16 03:41:29,964 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0643000000', 'o': '13.0617000000'}, 'XAGUSD': {'b': '38.0610000000', 'o': '38.0550000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541700000'}, 'BTCUSD': {'b': '118857.560000000...
2025-07-16 03:41:29,965 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:30,915 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:30,919 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:31,931 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:31,935 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:32,215 - DEBUG - app.firebase_stream - Firebase listener triggered (37). Event Type: patch, Path: /. Timestamp: 1752662492.2153773
2025-07-16 03:41:32,216 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0637000000', 'o': '13.0614600000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3500000000'}, 'BTCUSD': {'b': '118855.7900000000', 'o': '118855.7900000000'}, 'USDJPY': {'b': '148.65
2025-07-16 03:41:32,216 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0637000000', 'o': '13.0614600000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3500000000'}, 'BTCUSD': {'b': '118855.7900000000', 'o': '118855.7900000000'}, 'USDJPY': {'b': '148.65...
2025-07-16 03:41:32,217 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:32,940 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:32,944 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:34,102 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:34,107 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:34,468 - DEBUG - app.firebase_stream - Firebase listener triggered (38). Event Type: patch, Path: /. Timestamp: 1752662494.468568
2025-07-16 03:41:34,469 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0637000000', 'o': '13.0612300000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3490000000'}, 'BTCUSD': {'b': '118857.9000000
2025-07-16 03:41:34,469 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0637000000', 'o': '13.0612300000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3490000000'}, 'BTCUSD': {'b': '118857.9000000...
2025-07-16 03:41:34,469 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:35,113 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:35,118 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:36,128 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:36,133 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:36,823 - DEBUG - app.firebase_stream - Firebase listener triggered (39). Event Type: patch, Path: /. Timestamp: 1752662496.8230054
2025-07-16 03:41:36,824 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614000000'}, 'XAGUSD': {'b': '38.0620000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0543300000',
2025-07-16 03:41:36,824 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0640000000', 'o': '13.0614000000'}, 'XAGUSD': {'b': '38.0620000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0543300000',...
2025-07-16 03:41:36,824 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:37,135 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:37,139 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:38,150 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:38,154 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:39,073 - DEBUG - app.firebase_stream - Firebase listener triggered (40). Event Type: patch, Path: /. Timestamp: 1752662499.0739346
2025-07-16 03:41:39,074 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0615000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0542800000', 'o': '2.0541500000'}, 'USDCNH': {'b': '7.1823400000', '
2025-07-16 03:41:39,075 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0615000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3490000000'}, 'GBPAUD': {'b': '2.0542800000', 'o': '2.0541500000'}, 'USDCNH': {'b': '7.1823400000', '...
2025-07-16 03:41:39,075 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:39,157 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:39,161 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:40,164 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:40,168 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:41,179 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:41,183 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:41,429 - DEBUG - app.firebase_stream - Firebase listener triggered (41). Event Type: patch, Path: /. Timestamp: 1752662501.4291892
2025-07-16 03:41:41,429 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0610000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0543000000', 'o': '2.0541900000'}, 'BTCUSD': {'b': '118848.500000000
2025-07-16 03:41:41,430 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0610000000', 'o': '38.0560000000'}, 'NZDJPY': {'b': '88.3580000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0543000000', 'o': '2.0541900000'}, 'BTCUSD': {'b': '118848.500000000...
2025-07-16 03:41:41,430 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:42,199 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:42,203 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:43,215 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:43,219 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:43,994 - DEBUG - app.firebase_stream - Firebase listener triggered (42). Event Type: patch, Path: /. Timestamp: 1752662503.9947717
2025-07-16 03:41:43,995 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0644000000', 'o': '13.0618000000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'GBPAUD': {'b': '2.0543600000', 'o': '2.0541900000'}, 'BTCUSD': {'b': '118857.900000000
2025-07-16 03:41:43,995 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0644000000', 'o': '13.0618000000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0530000000'}, 'GBPAUD': {'b': '2.0543600000', 'o': '2.0541900000'}, 'BTCUSD': {'b': '118857.900000000...
2025-07-16 03:41:43,996 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:44,221 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:44,224 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:45,231 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:45,238 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:46,246 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:46,250 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:46,363 - DEBUG - app.firebase_stream - Firebase listener triggered (43). Event Type: patch, Path: /. Timestamp: 1752662506.3631322
2025-07-16 03:41:46,363 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0540000000'}, 'NZDJPY': {'b': '88.3570000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0544200000',
2025-07-16 03:41:46,365 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0642000000', 'o': '13.0616000000'}, 'XAGUSD': {'b': '38.0600000000', 'o': '38.0540000000'}, 'NZDJPY': {'b': '88.3570000000', 'o': '88.3500000000'}, 'GBPAUD': {'b': '2.0544200000',...
2025-07-16 03:41:46,365 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:47,266 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:47,270 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:48,287 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:48,291 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:48,599 - DEBUG - app.firebase_stream - Firebase listener triggered (44). Event Type: patch, Path: /. Timestamp: 1752662508.5992756
2025-07-16 03:41:48,599 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0615000000'}, 'XAGUSD': {'b': '38.0530000000', 'o': '38.0470000000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0544500000',
2025-07-16 03:41:48,600 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0641000000', 'o': '13.0615000000'}, 'XAGUSD': {'b': '38.0530000000', 'o': '38.0470000000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0544500000',...
2025-07-16 03:41:48,600 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:49,298 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:49,302 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:50,332 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:50,336 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:50,953 - DEBUG - app.firebase_stream - Firebase listener triggered (45). Event Type: patch, Path: /. Timestamp: 1752662510.9531398
2025-07-16 03:41:50,953 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0646000000', 'o': '13.0620000000'}, 'XAGUSD': {'b': '38.0510000000', 'o': '38.0430000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0542600000'}, 'BTCUSD': {'b': '118808.250000000
2025-07-16 03:41:50,954 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0646000000', 'o': '13.0620000000'}, 'XAGUSD': {'b': '38.0510000000', 'o': '38.0430000000'}, 'GBPAUD': {'b': '2.0544400000', 'o': '2.0542600000'}, 'BTCUSD': {'b': '118808.250000000...
2025-07-16 03:41:50,954 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:51,352 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:51,355 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:52,370 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:52,374 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:53,205 - DEBUG - app.firebase_stream - Firebase listener triggered (46). Event Type: patch, Path: /. Timestamp: 1752662513.2057226
2025-07-16 03:41:53,206 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0490000000', 'o': '38.0420000000'}, 'NZDJPY': {'b': '88.3540000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118800.100000000
2025-07-16 03:41:53,206 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0490000000', 'o': '38.0420000000'}, 'NZDJPY': {'b': '88.3540000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0544500000', 'o': '2.0542800000'}, 'BTCUSD': {'b': '118800.100000000...
2025-07-16 03:41:53,207 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:53,376 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:53,380 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:54,385 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:54,389 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:55,410 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:55,415 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:55,457 - DEBUG - app.firebase_stream - Firebase listener triggered (47). Event Type: patch, Path: /. Timestamp: 1752662515.4571168
2025-07-16 03:41:55,457 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0470000000'}, 'NZDJPY': {'b': '88.3500000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543100000'}, 'USDJPY': {'b': '148.6540000000',
2025-07-16 03:41:55,458 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0530000000', 'o': '38.0470000000'}, 'NZDJPY': {'b': '88.3500000000', 'o': '88.3480000000'}, 'GBPAUD': {'b': '2.0544700000', 'o': '2.0543100000'}, 'USDJPY': {'b': '148.6540000000',...
2025-07-16 03:41:55,458 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:56,422 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:56,428 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:57,435 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:57,439 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:57,814 - DEBUG - app.firebase_stream - Firebase listener triggered (48). Event Type: patch, Path: /. Timestamp: 1752662517.813987
2025-07-16 03:41:57,814 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0430000000', 'o': '38.0380000000'}, 'NZDJPY': {'b': '88.3500000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0544900000', 'o': '2.0543300000'}, 'BTCUSD': {'b': '118799.800000000
2025-07-16 03:41:57,815 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0430000000', 'o': '38.0380000000'}, 'NZDJPY': {'b': '88.3500000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0544900000', 'o': '2.0543300000'}, 'BTCUSD': {'b': '118799.800000000...
2025-07-16 03:41:57,815 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:41:58,445 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:58,449 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:41:59,460 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:41:59,463 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:00,034 - DEBUG - app.firebase_stream - Firebase listener triggered (49). Event Type: patch, Path: /. Timestamp: 1752662520.034474
2025-07-16 03:42:00,035 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0545000000', 'o': '2.0543600000'}, 'USDJPY': {'b': '148.6540000000', 'o': '148.6510000000'}, 'USDCNH': {'b': '7.1822500000', 'o': '7.1822500000'}, 'CADCHF': {'b': '0.5843300000', '
2025-07-16 03:42:00,037 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPAUD': {'b': '2.0545000000', 'o': '2.0543600000'}, 'USDJPY': {'b': '148.6540000000', 'o': '148.6510000000'}, 'USDCNH': {'b': '7.1822500000', 'o': '7.1822500000'}, 'CADCHF': {'b': '0.5843300000', '...
2025-07-16 03:42:00,037 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:00,471 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:00,476 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:01,485 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:01,489 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:02,423 - DEBUG - app.firebase_stream - Firebase listener triggered (50). Event Type: patch, Path: /. Timestamp: 1752662522.4232993
2025-07-16 03:42:02,423 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0440000000', 'o': '38.0380000000'}, 'GBPAUD': {'b': '2.0545000000', 'o': '2.0543400000'}, 'BTCUSD': {'b': '118807.5800000000', 'o': '118807.5800000000'}, 'USDJPY': {'b': '148.6560
2025-07-16 03:42:02,424 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0440000000', 'o': '38.0380000000'}, 'GBPAUD': {'b': '2.0545000000', 'o': '2.0543400000'}, 'BTCUSD': {'b': '118807.5800000000', 'o': '118807.5800000000'}, 'USDJPY': {'b': '148.6560...
2025-07-16 03:42:02,424 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:02,495 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:02,505 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:03,519 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:03,524 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:04,533 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:04,536 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:04,607 - DEBUG - app.firebase_stream - Firebase listener triggered (51). Event Type: patch, Path: /. Timestamp: 1752662524.6077878
2025-07-16 03:42:04,608 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0544400000', 'o': '2.0543500000'}, 'BTCUSD': {'b': '118810.0000000000', 'o': '118809.9000000000'}, 'USDJPY': {'b': '148.6570000000', 'o': '148.6520000000'}, 'CADCHF': {'b': '0.5843
2025-07-16 03:42:04,608 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPAUD': {'b': '2.0544400000', 'o': '2.0543500000'}, 'BTCUSD': {'b': '118810.0000000000', 'o': '118809.9000000000'}, 'USDJPY': {'b': '148.6570000000', 'o': '148.6520000000'}, 'CADCHF': {'b': '0.5843...
2025-07-16 03:42:04,608 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:05,542 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:05,546 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:06,552 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:06,556 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:06,933 - DEBUG - app.firebase_stream - Firebase listener triggered (52). Event Type: patch, Path: /. Timestamp: 1752662526.9331048
2025-07-16 03:42:06,933 - DEBUG - app.firebase_stream - Prepared batch update for 25 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0440000000', 'o': '38.0370000000'}, 'NZDJPY': {'b': '88.3490000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0544900000', 'o': '2.0543500000'}, 'USDJPY': {'b': '148.6560000000',
2025-07-16 03:42:06,934 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '38.0440000000', 'o': '38.0370000000'}, 'NZDJPY': {'b': '88.3490000000', 'o': '88.3420000000'}, 'GBPAUD': {'b': '2.0544900000', 'o': '2.0543500000'}, 'USDJPY': {'b': '148.6560000000',...
2025-07-16 03:42:06,934 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:07,570 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:07,573 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:08,579 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:08,583 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:08,777 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-16 03:42:08,777 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-16 03:42:08,786 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-16 03:42:08,787 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-16 03:42:08,787 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-16 03:42:08,787 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (live) from cache/DB...
2025-07-16 03:42:08,788 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:08,809 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:42:08,812 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:42:08,812 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:42:08,814 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:42:08,815 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:08,815 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-16 03:42:08,815 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (live) from cache/DB...
2025-07-16 03:42:08,819 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-16 03:42:08,819 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-16 03:42:08,819 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 8 (live) from cache/DB...
2025-07-16 03:42:08,820 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:42:08,828 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 8.
2025-07-16 03:42:08,828 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-16 03:42:08,828 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (live) from cache/DB...
2025-07-16 03:42:08,829 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:42:08,848 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:42:08,852 - DEBUG - app - [AUTO-CUTOFF] User 9 has 1 open orders.
2025-07-16 03:42:08,852 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:42:08,854 - DEBUG - app - [AUTO-CUTOFF] User 9 has 0 pending orders.
2025-07-16 03:42:08,854 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 1
2025-07-16 03:42:08,910 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.52303'), 'sell': Decimal('0.52277')}, 'GBPNOK': {'buy': Decimal('13.7988'), 'sell': Decimal('13.7964')}, 'AUDJPY': {'buy': Decimal('96.986'), 'sell': Decimal('96.951')}, 'EURJPY': {'buy': Decimal('172.72'), 'sell': Decimal('172.687')}, 'XAGUSD': {'buy': Decimal('38.059'), 'sell': Decimal('38.022')}, 'EURCAD': {'buy': Decimal('1.594085'), 'sell': Decimal('1.593825')}, 'GBPUSD': {'buy': Decimal('1.340085'), 'sell': Decimal('1.339925')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.74846'), 'sell': Decimal('9.74751')}, 'JP225': {'buy': Decimal('39564.55'), 'sell': Decimal('39560.55')}, 'GBPSEK': {'buy': Decimal('13.0648'), 'sell': Decimal('13.0618')}, 'EURUSD': {'buy': Decimal('1.161905'), 'sell': Decimal('1.161675')}, 'AUDCAD': {'buy': Decimal('0.89508'), 'sell': Decimal('0.89485')}, 'D30': {'buy': Decimal('24128.3'), 'sell': Decimal('24127.3')}, 'CHFSGD': {'buy': Decimal('1.6029449999999998'), 'sell': Decimal('1.602475')}, 'USDJPY': {'buy': Decimal('148.666'), 'sell': Decimal('148.642')}, 'EURNOK': {'buy': Decimal('11.962835'), 'sell': Decimal('11.961115')}, 'AUDUSD': {'buy': Decimal('0.652435'), 'sell': Decimal('0.652175')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93113')}, 'GBPAUD': {'buy': Decimal('2.054615'), 'sell': Decimal('2.0542249999999997')}, 'EURGBP': {'buy': Decimal('0.86709'), 'sell': Decimal('0.8667699999999999')}, 'EURNZD': {'buy': Decimal('1.9551450000000001'), 'sell': Decimal('1.954615')}, 'EURSEK': {'buy': Decimal('11.326045'), 'sell': Decimal('11.324085')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58446'), 'sell': Decimal('0.58412')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.8015')}, 'USDCNH': {'buy': Decimal('7.182424999999999'), 'sell': Decimal('7.182075')}, 'NZDUSD': {'buy': Decimal('0.59442'), 'sell': Decimal('0.5942000000000001')}, 'NZDJPY': {'buy': Decimal('88.364'), 'sell': Decimal('88.327')}, 'EURSGD': {'buy': Decimal('1.4928100000000002'), 'sell': Decimal('1.49243')}, 'CADJPY': {'buy': Decimal('108.368'), 'sell': Decimal('108.333')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'US30': {'buy': Decimal('44031.5'), 'sell': Decimal('44029.5')}, 'GBPNZD': {'buy': Decimal('2.254975'), 'sell': Decimal('2.254565')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.425')}, 'BTCUSD': {'buy': Decimal('118860.0'), 'sell': Decimal('118759.9')}, 'USDSGD': {'buy': Decimal('1.284905'), 'sell': Decimal('1.284605')}, 'NOKSEK': {'buy': Decimal('0.9470550000000001'), 'sell': Decimal('0.9464549999999999')}, 'EURPLN': {'buy': Decimal('4.25648'), 'sell': Decimal('4.25551')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78123'), 'sell': Decimal('1.78087')}, 'SGDJPY': {'buy': Decimal('115.729'), 'sell': Decimal('115.67999999999999')}, 'EURZAR': {'buy': Decimal('20.81989'), 'sell': Decimal('20.81431')}, 'USDTRY': {'buy': Decimal('40.260645'), 'sell': Decimal('40.258645')}, 'USDNOK': {'buy': Decimal('10.29683'), 'sell': Decimal('10.29564')}, 'USDZAR': {'buy': Decimal('17.920775'), 'sell': Decimal('17.915785')}, 'NZDCAD': {'buy': Decimal('0.8154899999999999'), 'sell': Decimal('0.81521')}, 'USDCAD': {'buy': Decimal('1.3721400000000001'), 'sell': Decimal('1.37189')}}
2025-07-16 03:42:08,911 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:42:08,911 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:42:09,286 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '9794.75000000', 'equity': '54.103000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9749.727000000000000000000000', 'profit_loss': '-9740.647000000000000000000000', 'margin_level': '0.5518557543327454678426696505', 'positions': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9740.647000000000000000000000', 'current_price': '118759.9'}], 'margin_call': True}
2025-07-16 03:42:09,287 - DEBUG - app.firebase_stream - Firebase listener triggered (53). Event Type: patch, Path: /. Timestamp: 1752662529.2871904
2025-07-16 03:42:09,287 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '9794.75000000', 'equity': '54.103000000000000000000000', 'margin': '9803.83000000', 'free_margin': '-9749.727000000000000000000000', 'profit_loss': '-9740.647000000000000000000000', 'margin_level': '0.5518557543327454678426696505', 'positions_with_pnl': [{'order_id': '1000341-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.41000000'), 'order_price': Decimal('141921.60000000'), 'margin': Decimal('9773.83000000'), 'contract_value': Decimal('0.41000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('244.35000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-9740.647000000000000000000000', 'current_price': '118759.9'}], 'margin_call': True}
2025-07-16 03:42:09,288 - DEBUG - app.firebase_stream - Prepared batch update for 31 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0633000000', 'o': '13.0607000000'}, 'XAGUSD': {'b': '38.0440000000', 'o': '38.0360000000'}, 'NZDJPY': {'b': '88.3500000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0543200000',
2025-07-16 03:42:09,289 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0633000000', 'o': '13.0607000000'}, 'XAGUSD': {'b': '38.0440000000', 'o': '38.0360000000'}, 'NZDJPY': {'b': '88.3500000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0543200000',...
2025-07-16 03:42:09,289 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:09,291 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.5518557543327454678426696505
2025-07-16 03:42:09,407 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:42:09,407 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-16 03:42:09,408 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (live) from cache/DB...
2025-07-16 03:42:09,409 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:09,427 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:42:09,431 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:42:09,431 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:42:09,434 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 pending orders.
2025-07-16 03:42:09,434 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:09,434 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-16 03:42:09,434 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (live) from cache/DB...
2025-07-16 03:42:09,435 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:09,449 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:42:09,452 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 open orders.
2025-07-16 03:42:09,452 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:42:09,484 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:42:09,484 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:09,484 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-16 03:42:09,484 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (live) from cache/DB...
2025-07-16 03:42:09,485 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:42:09,503 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:42:09,507 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:42:09,507 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:42:09,510 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:42:09,510 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:09,510 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-16 03:42:09,511 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (live) from cache/DB...
2025-07-16 03:42:09,512 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:09,538 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:42:09,542 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:42:09,542 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:42:09,545 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:42:09,545 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:09,545 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-16 03:42:09,546 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 14 (live) from cache/DB...
2025-07-16 03:42:09,547 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:42:09,566 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 14...
2025-07-16 03:42:09,571 - DEBUG - app - [AUTO-CUTOFF] User 14 has 3 open orders.
2025-07-16 03:42:09,571 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 14...
2025-07-16 03:42:09,575 - DEBUG - app - [AUTO-CUTOFF] User 14 has 0 pending orders.
2025-07-16 03:42:09,575 - DEBUG - app - [AUTO-CUTOFF] User 14 total positions for portfolio calculation: 3
2025-07-16 03:42:09,587 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:09,595 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:09,677 - DEBUG - app - [AUTO-CUTOFF] User 14 adjusted market prices: {'AUDCHF': {'buy': Decimal('0.52303'), 'sell': Decimal('0.52277')}, 'GBPNOK': {'buy': Decimal('13.7988'), 'sell': Decimal('13.7964')}, 'AUDJPY': {'buy': Decimal('96.986'), 'sell': Decimal('96.951')}, 'EURJPY': {'buy': Decimal('172.72'), 'sell': Decimal('172.687')}, 'XAGUSD': {'buy': Decimal('38.059'), 'sell': Decimal('38.022')}, 'EURCAD': {'buy': Decimal('1.594085'), 'sell': Decimal('1.593825')}, 'GBPUSD': {'buy': Decimal('1.340085'), 'sell': Decimal('1.339925')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDSEK': {'buy': Decimal('9.74846'), 'sell': Decimal('9.74751')}, 'JP225': {'buy': Decimal('39564.55'), 'sell': Decimal('39560.55')}, 'GBPSEK': {'buy': Decimal('13.0635'), 'sell': Decimal('13.060500000000001')}, 'EURUSD': {'buy': Decimal('1.161875'), 'sell': Decimal('1.1616549999999999')}, 'AUDCAD': {'buy': Decimal('0.89508'), 'sell': Decimal('0.89485')}, 'D30': {'buy': Decimal('24130.67'), 'sell': Decimal('24129.67')}, 'CHFSGD': {'buy': Decimal('1.6029449999999998'), 'sell': Decimal('1.602475')}, 'USDJPY': {'buy': Decimal('148.666'), 'sell': Decimal('148.643')}, 'EURNOK': {'buy': Decimal('11.962965'), 'sell': Decimal('11.961245')}, 'AUDUSD': {'buy': Decimal('0.652425'), 'sell': Decimal('0.652165')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93113')}, 'GBPAUD': {'buy': Decimal('2.0544450000000003'), 'sell': Decimal('2.054035')}, 'EURGBP': {'buy': Decimal('0.86717'), 'sell': Decimal('0.86685')}, 'EURNZD': {'buy': Decimal('1.955115'), 'sell': Decimal('1.954615')}, 'EURSEK': {'buy': Decimal('11.325915'), 'sell': Decimal('11.324074999999999')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'CADCHF': {'buy': Decimal('0.58447'), 'sell': Decimal('0.58412')}, 'USDCHF': {'buy': Decimal('0.8017500000000001'), 'sell': Decimal('0.80151')}, 'USDCNH': {'buy': Decimal('7.182424999999999'), 'sell': Decimal('7.182075')}, 'NZDUSD': {'buy': Decimal('0.59441'), 'sell': Decimal('0.59418')}, 'NZDJPY': {'buy': Decimal('88.365'), 'sell': Decimal('88.326')}, 'EURSGD': {'buy': Decimal('1.49278'), 'sell': Decimal('1.4923899999999999')}, 'CADJPY': {'buy': Decimal('108.369'), 'sell': Decimal('108.333')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'US30': {'buy': Decimal('44031.5'), 'sell': Decimal('44029.5')}, 'GBPNZD': {'buy': Decimal('2.254975'), 'sell': Decimal('2.254435')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'BTCUSD': {'buy': Decimal('118860.0'), 'sell': Decimal('118759.9')}, 'USDSGD': {'buy': Decimal('1.284905'), 'sell': Decimal('1.284615')}, 'NOKSEK': {'buy': Decimal('0.947075'), 'sell': Decimal('0.9464549999999999')}, 'EURPLN': {'buy': Decimal('4.25668'), 'sell': Decimal('4.25571')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURAUD': {'buy': Decimal('1.78123'), 'sell': Decimal('1.78085')}, 'SGDJPY': {'buy': Decimal('115.729'), 'sell': Decimal('115.67999999999999')}, 'EURZAR': {'buy': Decimal('20.81954'), 'sell': Decimal('20.813959999999998')}, 'USDTRY': {'buy': Decimal('40.260645'), 'sell': Decimal('40.258645')}, 'USDNOK': {'buy': Decimal('10.296949999999999'), 'sell': Decimal('10.295760000000001')}, 'USDZAR': {'buy': Decimal('17.920765'), 'sell': Decimal('17.916025')}, 'NZDCAD': {'buy': Decimal('0.8154899999999999'), 'sell': Decimal('0.81521')}, 'USDCAD': {'buy': Decimal('1.3721700000000001'), 'sell': Decimal('1.3719')}}
2025-07-16 03:42:09,677 - DEBUG - app - [AUTO-CUTOFF] User 14 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:42:09,677 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-16 03:42:10,059 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '395.106534280486492304380584', 'margin': '9494.47000000', 'free_margin': '-9099.363465719513507695619416', 'profit_loss': '-9506.913465719513507695619416', 'margin_level': '4.161438545600612696700085250', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9495.010000000000000000000000', 'current_price': '118759.9'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.82133247228500699601765149', 'current_price': '96.951'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.082133247228500699601765149', 'current_price': '96.951'}], 'margin_call': True}
2025-07-16 03:42:10,059 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 14: {'balance': '9902.02000000', 'equity': '395.106534280486492304380584', 'margin': '9494.47000000', 'free_margin': '-9099.363465719513507695619416', 'profit_loss': '-9506.913465719513507695619416', 'margin_level': '4.161438545600612696700085250', 'positions_with_pnl': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('235.57000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-9495.010000000000000000000000', 'current_price': '118759.9'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-10.82133247228500699601765149', 'current_price': '96.951'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 14, 'profit_loss': '-1.082133247228500699601765149', 'current_price': '96.951'}], 'margin_call': True}
2025-07-16 03:42:10,062 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.161438545600612696700085250
2025-07-16 03:42:10,116 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-16 03:42:10,116 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-16 03:42:10,117 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 16 (live) from cache/DB...
2025-07-16 03:42:10,119 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:42:10,144 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 16...
2025-07-16 03:42:10,147 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 open orders.
2025-07-16 03:42:10,147 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 16...
2025-07-16 03:42:10,149 - DEBUG - app - [AUTO-CUTOFF] User 16 has 0 pending orders.
2025-07-16 03:42:10,149 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,149 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-16 03:42:10,149 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 17 (live) from cache/DB...
2025-07-16 03:42:10,150 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:10,161 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 17...
2025-07-16 03:42:10,164 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 open orders.
2025-07-16 03:42:10,164 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 17...
2025-07-16 03:42:10,167 - DEBUG - app - [AUTO-CUTOFF] User 17 has 0 pending orders.
2025-07-16 03:42:10,167 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,167 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-16 03:42:10,167 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 18 (live) from cache/DB...
2025-07-16 03:42:10,167 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:10,177 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 18...
2025-07-16 03:42:10,180 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 open orders.
2025-07-16 03:42:10,180 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 18...
2025-07-16 03:42:10,183 - DEBUG - app - [AUTO-CUTOFF] User 18 has 0 pending orders.
2025-07-16 03:42:10,183 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,183 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-16 03:42:10,183 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 19 (live) from cache/DB...
2025-07-16 03:42:10,183 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Elite...
2025-07-16 03:42:10,195 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 19...
2025-07-16 03:42:10,198 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 open orders.
2025-07-16 03:42:10,198 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 19...
2025-07-16 03:42:10,200 - DEBUG - app - [AUTO-CUTOFF] User 19 has 0 pending orders.
2025-07-16 03:42:10,200 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,200 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-16 03:42:10,200 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 20 (live) from cache/DB...
2025-07-16 03:42:10,201 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Standard...
2025-07-16 03:42:10,213 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 20...
2025-07-16 03:42:10,216 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 open orders.
2025-07-16 03:42:10,216 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 20...
2025-07-16 03:42:10,218 - DEBUG - app - [AUTO-CUTOFF] User 20 has 0 pending orders.
2025-07-16 03:42:10,218 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,218 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-16 03:42:10,218 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 21 (live) from cache/DB...
2025-07-16 03:42:10,219 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:10,233 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 21...
2025-07-16 03:42:10,236 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 open orders.
2025-07-16 03:42:10,236 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 21...
2025-07-16 03:42:10,238 - DEBUG - app - [AUTO-CUTOFF] User 21 has 0 pending orders.
2025-07-16 03:42:10,238 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,238 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-16 03:42:10,238 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 22 (live) from cache/DB...
2025-07-16 03:42:10,239 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group VIP...
2025-07-16 03:42:10,254 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 22...
2025-07-16 03:42:10,257 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 open orders.
2025-07-16 03:42:10,257 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 22...
2025-07-16 03:42:10,259 - DEBUG - app - [AUTO-CUTOFF] User 22 has 0 pending orders.
2025-07-16 03:42:10,259 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,259 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-16 03:42:10,259 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 23 (live) from cache/DB...
2025-07-16 03:42:10,260 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:10,274 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 23...
2025-07-16 03:42:10,277 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 open orders.
2025-07-16 03:42:10,277 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 23...
2025-07-16 03:42:10,279 - DEBUG - app - [AUTO-CUTOFF] User 23 has 0 pending orders.
2025-07-16 03:42:10,279 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,279 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-16 03:42:10,279 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 25 (live) from cache/DB...
2025-07-16 03:42:10,280 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:10,295 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 25...
2025-07-16 03:42:10,298 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 open orders.
2025-07-16 03:42:10,298 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 25...
2025-07-16 03:42:10,300 - DEBUG - app - [AUTO-CUTOFF] User 25 has 0 pending orders.
2025-07-16 03:42:10,300 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:10,300 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-16 03:42:10,300 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 26 (live) from cache/DB...
2025-07-16 03:42:10,301 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Royal+...
2025-07-16 03:42:10,317 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 26...
2025-07-16 03:42:10,320 - DEBUG - app - [AUTO-CUTOFF] User 26 has 2 open orders.
2025-07-16 03:42:10,320 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 26...
2025-07-16 03:42:10,322 - DEBUG - app - [AUTO-CUTOFF] User 26 has 0 pending orders.
2025-07-16 03:42:10,322 - DEBUG - app - [AUTO-CUTOFF] User 26 total positions for portfolio calculation: 2
2025-07-16 03:42:10,387 - DEBUG - app - [AUTO-CUTOFF] User 26 adjusted market prices: {'EURSGD': {'buy': Decimal('1.49277'), 'sell': Decimal('1.4924')}, 'USDCNH': {'buy': Decimal('7.18241'), 'sell': Decimal('7.18209')}, 'BTCUSD': {'buy': Decimal('118860.0'), 'sell': Decimal('118759.9')}, 'USDSEK': {'buy': Decimal('9.748465000000001'), 'sell': Decimal('9.747675')}, 'AUDJPY': {'buy': Decimal('96.9825'), 'sell': Decimal('96.9515')}, 'EURNOK': {'buy': Decimal('11.962965'), 'sell': Decimal('11.961245')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'USDCHF': {'buy': Decimal('0.80174'), 'sell': Decimal('0.80152')}, 'USDTRY': {'buy': Decimal('40.26063'), 'sell': Decimal('40.25866')}, 'NZDCAD': {'buy': Decimal('0.81548'), 'sell': Decimal('0.81522')}, 'GBPAUD': {'buy': Decimal('2.0544200000000004'), 'sell': Decimal('2.0540599999999998')}, 'EURCHF': {'buy': Decimal('0.93147'), 'sell': Decimal('0.93114')}, 'EURNZD': {'buy': Decimal('1.95509'), 'sell': Decimal('1.95464')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'EURCAD': {'buy': Decimal('1.594085'), 'sell': Decimal('1.593825')}, 'EURSEK': {'buy': Decimal('11.325915'), 'sell': Decimal('11.324074999999999')}, 'CHFSGD': {'buy': Decimal('1.6029449999999998'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.8671599999999999'), 'sell': Decimal('0.8668600000000001')}, 'NZDJPY': {'buy': Decimal('88.3625'), 'sell': Decimal('88.32849999999999')}, 'AUDUSD': {'buy': Decimal('0.652425'), 'sell': Decimal('0.652165')}, 'EURAUD': {'buy': Decimal('1.781225'), 'sell': Decimal('1.780855')}, 'GBPNZD': {'buy': Decimal('2.25495'), 'sell': Decimal('2.25446')}, 'GBPSEK': {'buy': Decimal('13.063475'), 'sell': Decimal('13.060525')}, 'SGDJPY': {'buy': Decimal('115.729'), 'sell': Decimal('115.67999999999999')}, 'EURZAR': {'buy': Decimal('20.819515'), 'sell': Decimal('20.813985')}, 'NOKSEK': {'buy': Decimal('0.947075'), 'sell': Decimal('0.9464549999999999')}, 'USDNOK': {'buy': Decimal('10.296925'), 'sell': Decimal('10.295785')}, 'USDJPY': {'buy': Decimal('148.6635'), 'sell': Decimal('148.6455')}, 'USDZAR': {'buy': Decimal('17.92075'), 'sell': Decimal('17.91604')}, 'AUDCAD': {'buy': Decimal('0.895055'), 'sell': Decimal('0.894875')}, 'EURUSD': {'buy': Decimal('1.16185'), 'sell': Decimal('1.1616799999999998')}, 'NZDUSD': {'buy': Decimal('0.59441'), 'sell': Decimal('0.59418')}, 'EURJPY': {'buy': Decimal('172.71900000000002'), 'sell': Decimal('172.68599999999998')}, 'CHFJPY': {'buy': Decimal('185.46249999999998'), 'sell': Decimal('185.41750000000002')}, 'USDCAD': {'buy': Decimal('1.37216'), 'sell': Decimal('1.37191')}, 'AUDCHF': {'buy': Decimal('0.523005'), 'sell': Decimal('0.5227949999999999')}, 'GBPNOK': {'buy': Decimal('13.798775000000001'), 'sell': Decimal('13.796425')}, 'US30': {'buy': Decimal('44031.5'), 'sell': Decimal('44029.5')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'USDSGD': {'buy': Decimal('1.28489'), 'sell': Decimal('1.28463')}, 'XAGUSD': {'buy': Decimal('38.0565'), 'sell': Decimal('38.0235')}, 'D30': {'buy': Decimal('24130.67'), 'sell': Decimal('24129.67')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'JP225': {'buy': Decimal('39564.55'), 'sell': Decimal('39560.55')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584135')}, 'GBPUSD': {'buy': Decimal('1.34006'), 'sell': Decimal('1.33993')}, 'CADJPY': {'buy': Decimal('108.3675'), 'sell': Decimal('108.33449999999999')}, 'EURPLN': {'buy': Decimal('4.25668'), 'sell': Decimal('4.25571')}}
2025-07-16 03:42:10,388 - DEBUG - app - [AUTO-CUTOFF] User 26 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:42:10,388 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-16 03:42:10,807 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100538.3650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45946.1050000000000000000000', 'profit_loss': '-83807.44500000000000000000000', 'margin_level': '68.63414599513518395499536572', 'positions': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-153.825000000000000000000000', 'current_price': '38.0235'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-83653.62000000000000000000000', 'current_price': '118759.9'}], 'margin_call': True}
2025-07-16 03:42:10,807 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 26: {'balance': '184345.81000000', 'equity': '100538.3650000000000000000000', 'margin': '146484.47000000', 'free_margin': '-45946.1050000000000000000000', 'profit_loss': '-83807.44500000000000000000000', 'margin_level': '68.63414599513518395499536572', 'positions_with_pnl': [{'order_id': '7987141755', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-153.825000000000000000000000', 'current_price': '38.0235'}, {'order_id': '1116628265', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3661.62000000'), 'order_status': 'OPEN', 'order_user_id': 26, 'profit_loss': '-83653.62000000000000000000000', 'current_price': '118759.9'}], 'margin_call': True}
2025-07-16 03:42:10,808 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:10,809 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.63414599513518395499536572
2025-07-16 03:42:10,810 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-16 03:42:10,810 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-16 03:42:10,810 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 1 (demo) from cache/DB...
2025-07-16 03:42:10,811 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:10,811 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:10,842 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 1...
2025-07-16 03:42:10,850 - DEBUG - app - [AUTO-CUTOFF] User 1 has 2 open orders.
2025-07-16 03:42:10,850 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 1...
2025-07-16 03:42:10,859 - DEBUG - app - [AUTO-CUTOFF] User 1 has 1 pending orders.
2025-07-16 03:42:10,859 - DEBUG - app - [AUTO-CUTOFF] User 1 total positions for portfolio calculation: 3
2025-07-16 03:42:10,913 - DEBUG - app - [AUTO-CUTOFF] User 1 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16185'), 'sell': Decimal('1.1616799999999998')}, 'USDZAR': {'buy': Decimal('17.920740000000002'), 'sell': Decimal('17.91605')}, 'SGDJPY': {'buy': Decimal('115.7265'), 'sell': Decimal('115.68249999999999')}, 'GBPAUD': {'buy': Decimal('2.0544700000000002'), 'sell': Decimal('2.05401')}, 'USDNOK': {'buy': Decimal('10.296899999999999'), 'sell': Decimal('10.295810000000001')}, 'NZDCAD': {'buy': Decimal('0.8155399999999999'), 'sell': Decimal('0.81516')}, 'GBPNZD': {'buy': Decimal('2.255'), 'sell': Decimal('2.25441')}, 'US30': {'buy': Decimal('44031.5'), 'sell': Decimal('44029.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3675'), 'sell': Decimal('108.33449999999999')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.260619999999996'), 'sell': Decimal('40.25867')}, 'GBPSEK': {'buy': Decimal('13.06345'), 'sell': Decimal('13.060550000000001')}, 'GBPNOK': {'buy': Decimal('13.79875'), 'sell': Decimal('13.79645')}, 'USDCNH': {'buy': Decimal('7.1823999999999995'), 'sell': Decimal('7.1821')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93113')}, 'XAGUSD': {'buy': Decimal('38.059'), 'sell': Decimal('38.021')}, 'BTCUSD': {'buy': Decimal('118860.0'), 'sell': Decimal('118759.9')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96294'), 'sell': Decimal('11.96127')}, 'USDCAD': {'buy': Decimal('1.3722100000000002'), 'sell': Decimal('1.3718599999999999')}, 'NOKSEK': {'buy': Decimal('0.947025'), 'sell': Decimal('0.9465049999999999')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584135')}, 'GBPUSD': {'buy': Decimal('1.3401'), 'sell': Decimal('1.33989')}, 'CHFSGD': {'buy': Decimal('1.6029149999999999'), 'sell': Decimal('1.602505')}, 'EURGBP': {'buy': Decimal('0.86718'), 'sell': Decimal('0.86684')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.02'), 'sell': Decimal('96.914')}, 'EURJPY': {'buy': Decimal('172.7175'), 'sell': Decimal('172.6875')}, 'AUDCHF': {'buy': Decimal('0.52313'), 'sell': Decimal('0.52267')}, 'EURZAR': {'buy': Decimal('20.81954'), 'sell': Decimal('20.813959999999998')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'D30': {'buy': Decimal('24130.17'), 'sell': Decimal('24130.17')}, 'AUDUSD': {'buy': Decimal('0.65245'), 'sell': Decimal('0.65214')}, 'EURSEK': {'buy': Decimal('11.32589'), 'sell': Decimal('11.3241')}, 'NZDJPY': {'buy': Decimal('88.3625'), 'sell': Decimal('88.32849999999999')}, 'USDSGD': {'buy': Decimal('1.2849300000000001'), 'sell': Decimal('1.28459')}, 'EURSGD': {'buy': Decimal('1.4927549999999998'), 'sell': Decimal('1.492415')}, 'NZDUSD': {'buy': Decimal('0.59446'), 'sell': Decimal('0.59413')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25667'), 'sell': Decimal('4.25572')}, 'AUDCAD': {'buy': Decimal('0.89498'), 'sell': Decimal('0.89495')}, 'EURCAD': {'buy': Decimal('1.59406'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.9550649999999998'), 'sell': Decimal('1.954665')}, 'USDSEK': {'buy': Decimal('9.74844'), 'sell': Decimal('9.7477')}, 'USDJPY': {'buy': Decimal('148.70600000000002'), 'sell': Decimal('148.60299999999998')}, 'EURAUD': {'buy': Decimal('1.7812400000000002'), 'sell': Decimal('1.78084')}, 'JP225': {'buy': Decimal('39564.55'), 'sell': Decimal('39560.55')}}
2025-07-16 03:42:10,914 - DEBUG - app - [AUTO-CUTOFF] User 1 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:42:10,914 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-16 03:42:11,317 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17011.54000000', 'equity': '17009.90043482940480034441933', 'margin': '6.54000000', 'free_margin': '17003.36043482940480034441933', 'profit_loss': '-1.639565170595199655580669465', 'margin_level': '260090.2207160459449593947910', 'positions': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.554827252179528576041330320', 'current_price': '96.914'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.194392422774728231621999785', 'current_price': '97.02'}], 'margin_call': False}
2025-07-16 03:42:11,318 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 1: {'balance': '17011.54000000', 'equity': '17009.90043482940480034441933', 'margin': '6.54000000', 'free_margin': '17003.36043482940480034441933', 'profit_loss': '-1.639565170595199655580669465', 'margin_level': '260090.2207160459449593947910', 'positions_with_pnl': [{'order_id': '1000052-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.66800000'), 'margin': Decimal('6.54341805'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '1.554827252179528576041330320', 'current_price': '96.914'}, {'order_id': '1000053-001', 'order_company_name': 'AUDJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('96.56000000'), 'margin': Decimal('6.54258453'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 1, 'profit_loss': '-3.194392422774728231621999785', 'current_price': '97.02'}], 'margin_call': False}
2025-07-16 03:42:11,320 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 260090.2207160459449593947910
2025-07-16 03:42:11,321 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-16 03:42:11,321 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-16 03:42:11,321 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 2 (demo) from cache/DB...
2025-07-16 03:42:11,322 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-16 03:42:11,322 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-16 03:42:11,322 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 3 (demo) from cache/DB...
2025-07-16 03:42:11,323 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group string...
2025-07-16 03:42:11,333 - WARNING - app - [AUTO-CUTOFF] No group settings found for group string. Skipping portfolio update for user 3.
2025-07-16 03:42:11,333 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-16 03:42:11,333 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 4 (demo) from cache/DB...
2025-07-16 03:42:11,334 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:11,356 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 4...
2025-07-16 03:42:11,362 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 open orders.
2025-07-16 03:42:11,362 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 4...
2025-07-16 03:42:11,365 - DEBUG - app - [AUTO-CUTOFF] User 4 has 0 pending orders.
2025-07-16 03:42:11,365 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:11,365 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-16 03:42:11,365 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 5 (demo) from cache/DB...
2025-07-16 03:42:11,366 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-16 03:42:11,367 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-16 03:42:11,367 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 6 (demo) from cache/DB...
2025-07-16 03:42:11,369 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-16 03:42:11,369 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-16 03:42:11,369 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 9 (demo) from cache/DB...
2025-07-16 03:42:11,370 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:11,390 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 9...
2025-07-16 03:42:11,394 - DEBUG - app - [AUTO-CUTOFF] User 9 has 28 open orders.
2025-07-16 03:42:11,395 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 9...
2025-07-16 03:42:11,398 - DEBUG - app - [AUTO-CUTOFF] User 9 has 6 pending orders.
2025-07-16 03:42:11,398 - DEBUG - app - [AUTO-CUTOFF] User 9 total positions for portfolio calculation: 34
2025-07-16 03:42:11,418 - DEBUG - app - [AUTO-CUTOFF] User 9 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16185'), 'sell': Decimal('1.1616799999999998')}, 'USDZAR': {'buy': Decimal('17.920740000000002'), 'sell': Decimal('17.91605')}, 'SGDJPY': {'buy': Decimal('115.7265'), 'sell': Decimal('115.68249999999999')}, 'GBPAUD': {'buy': Decimal('2.0544700000000002'), 'sell': Decimal('2.05401')}, 'USDNOK': {'buy': Decimal('10.296899999999999'), 'sell': Decimal('10.295810000000001')}, 'NZDCAD': {'buy': Decimal('0.8155399999999999'), 'sell': Decimal('0.81516')}, 'GBPNZD': {'buy': Decimal('2.255'), 'sell': Decimal('2.25441')}, 'US30': {'buy': Decimal('44031.5'), 'sell': Decimal('44029.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3675'), 'sell': Decimal('108.33449999999999')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.260619999999996'), 'sell': Decimal('40.25867')}, 'GBPSEK': {'buy': Decimal('13.06345'), 'sell': Decimal('13.060550000000001')}, 'GBPNOK': {'buy': Decimal('13.79875'), 'sell': Decimal('13.79645')}, 'USDCNH': {'buy': Decimal('7.1823999999999995'), 'sell': Decimal('7.1821')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93113')}, 'XAGUSD': {'buy': Decimal('38.059'), 'sell': Decimal('38.021')}, 'BTCUSD': {'buy': Decimal('118860.0'), 'sell': Decimal('118759.9')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96294'), 'sell': Decimal('11.96127')}, 'USDCAD': {'buy': Decimal('1.3722100000000002'), 'sell': Decimal('1.3718599999999999')}, 'NOKSEK': {'buy': Decimal('0.947025'), 'sell': Decimal('0.9465049999999999')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584135')}, 'GBPUSD': {'buy': Decimal('1.3401'), 'sell': Decimal('1.33989')}, 'CHFSGD': {'buy': Decimal('1.6029149999999999'), 'sell': Decimal('1.602505')}, 'EURGBP': {'buy': Decimal('0.86718'), 'sell': Decimal('0.86684')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.02'), 'sell': Decimal('96.914')}, 'EURJPY': {'buy': Decimal('172.7175'), 'sell': Decimal('172.6875')}, 'AUDCHF': {'buy': Decimal('0.52313'), 'sell': Decimal('0.52267')}, 'EURZAR': {'buy': Decimal('20.81954'), 'sell': Decimal('20.813959999999998')}, 'USDCZK': {'buy': Decimal('21.2260000000'), 'sell': Decimal('21.1960000000')}, 'D30': {'buy': Decimal('24130.17'), 'sell': Decimal('24130.17')}, 'AUDUSD': {'buy': Decimal('0.65245'), 'sell': Decimal('0.65214')}, 'EURSEK': {'buy': Decimal('11.32589'), 'sell': Decimal('11.3241')}, 'NZDJPY': {'buy': Decimal('88.3625'), 'sell': Decimal('88.32849999999999')}, 'USDSGD': {'buy': Decimal('1.2849300000000001'), 'sell': Decimal('1.28459')}, 'EURSGD': {'buy': Decimal('1.4927549999999998'), 'sell': Decimal('1.492415')}, 'NZDUSD': {'buy': Decimal('0.59446'), 'sell': Decimal('0.59413')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25667'), 'sell': Decimal('4.25572')}, 'AUDCAD': {'buy': Decimal('0.89498'), 'sell': Decimal('0.89495')}, 'EURCAD': {'buy': Decimal('1.59406'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.9550649999999998'), 'sell': Decimal('1.954665')}, 'USDSEK': {'buy': Decimal('9.74844'), 'sell': Decimal('9.7477')}, 'USDJPY': {'buy': Decimal('148.70600000000002'), 'sell': Decimal('148.60299999999998')}, 'EURAUD': {'buy': Decimal('1.7812400000000002'), 'sell': Decimal('1.78084')}, 'JP225': {'buy': Decimal('39564.55'), 'sell': Decimal('39560.55')}}
2025-07-16 03:42:11,418 - DEBUG - app - [AUTO-CUTOFF] User 9 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:42:11,418 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-16 03:42:11,529 - DEBUG - app.firebase_stream - Firebase listener triggered (54). Event Type: patch, Path: /. Timestamp: 1752662531.529086
2025-07-16 03:42:11,529 - DEBUG - app.firebase_stream - Prepared batch update for 23 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0635000000', 'o': '13.0609000000'}, 'XAGUSD': {'b': '38.0440000000', 'o': '38.0370000000'}, 'GBPAUD': {'b': '2.0543400000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6570000000',
2025-07-16 03:42:11,529 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0635000000', 'o': '13.0609000000'}, 'XAGUSD': {'b': '38.0440000000', 'o': '38.0370000000'}, 'GBPAUD': {'b': '2.0543400000', 'o': '2.0541500000'}, 'USDJPY': {'b': '148.6570000000',...
2025-07-16 03:42:11,529 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:11,778 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '98181.73000000', 'equity': '98226.03073869258835326295585', 'margin': '1917.31000000', 'free_margin': '96308.72073869258835326295585', 'profit_loss': '44.3007386925883532629558528', 'margin_level': '5123.116801075078539895111164', 'positions': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.100000000000000000000000', 'current_price': '0.65214'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-120.560000000000000000000000', 'current_price': '0.65245'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.2965332586123694328990177', 'current_price': '1.602505'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.8464639860513083952116316', 'current_price': '1.6029149999999999'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-214.5206751111619365384744748', 'current_price': '108.3675'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.2646629489351325534619964', 'current_price': '108.33449999999999'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '84.33411800000000000000000000', 'current_price': '1.78084'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-95.93335500000273966000000000', 'current_price': '1.7812400000000002'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '487.3725623414988866989109157', 'current_price': '185.41500000000002'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-496.7721466193970011502990105', 'current_price': '185.46499999999997'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '19.19946000000000000000000000', 'current_price': '1.78084'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.74343000000065230000000000', 'current_price': '1.7812400000000002'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-177.2073700000000000000000000', 'current_price': '0.86718'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '364.0685806924665505156164863', 'current_price': '172.6875'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-370.0374486233409795704204982', 'current_price': '172.7175'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-212.2177739999988113800000000', 'current_price': '1.9550649999999998'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '201.2436930000000000000000000', 'current_price': '1.954665'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.3401'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.3401'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33989'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33989'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.153899917259126714517311664', 'current_price': '88.32849999999999'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '296.3893268798962127638341400', 'current_price': '0.80179'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.7390100294396487201237463', 'current_price': '0.80147'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.9891907115881787368768635', 'current_price': '10.295810000000001'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.5035982402138549243932522', 'current_price': '10.295810000000001'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '69.76850667040030199722909759', 'current_price': '1.2849300000000001'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.8057205988891833602538669', 'current_price': '40.260619999999996'}], 'margin_call': False}
2025-07-16 03:42:11,778 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 9: {'balance': '98181.73000000', 'equity': '98226.03073869258835326295585', 'margin': '1917.31000000', 'free_margin': '96308.72073869258835326295585', 'profit_loss': '44.3007386925883532629558528', 'margin_level': '5123.116801075078539895111164', 'positions_with_pnl': [{'order_id': '2504219016', 'order_company_name': 'AUDUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.64743000'), 'margin': Decimal('64.74000000'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '46.100000000000000000000000', 'current_price': '0.65214'}, {'order_id': '4208488950', 'order_company_name': 'AUDUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('0.64707000'), 'margin': Decimal('142.36000000'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-120.560000000000000000000000', 'current_price': '0.65245'}, {'order_id': '1409905880', 'order_company_name': 'CHFSGD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57561500'), 'margin': Decimal('122.35389131'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.2965332586123694328990177', 'current_price': '1.602505'}, {'order_id': '7183762766', 'order_company_name': 'CHFSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.57505500'), 'margin': Decimal('122.31506360'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-217.8464639860513083952116316', 'current_price': '1.6029149999999999'}, {'order_id': '9716387266', 'order_company_name': 'CADJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.24150000'), 'margin': Decimal('109.44987397'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-214.5206751111619365384744748', 'current_price': '108.3675'}, {'order_id': '9899743248', 'order_company_name': 'CADJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('106.27050000'), 'margin': Decimal('109.47824594'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0E-8'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '208.2646629489351325534619964', 'current_price': '108.33449999999999'}, {'order_id': '2965066905', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.22000000'), 'order_price': Decimal('1.77481000'), 'margin': Decimal('252.73304420'), 'contract_value': Decimal('22000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.20000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '84.33411800000000000000000000', 'current_price': '1.78084'}, {'order_id': '6518780780', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.21000000'), 'order_price': Decimal('1.77439000'), 'margin': Decimal('241.18574740'), 'contract_value': Decimal('21000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-95.93335500000273966000000000', 'current_price': '1.7812400000000002'}, {'order_id': '7509572762', 'order_company_name': 'CHFJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.15500000'), 'margin': Decimal('122.35584187'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '487.3725623414988866989109157', 'current_price': '185.41500000000002'}, {'order_id': '7522048723', 'order_company_name': 'CHFJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('178.09500000'), 'margin': Decimal('122.31379417'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-496.7721466193970011502990105', 'current_price': '185.46499999999997'}, {'order_id': '6209391896', 'order_company_name': 'EURAUD', 'order_type': 'BUY', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77480000'), 'margin': Decimal('57.44317680'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '19.19946000000000000000000000', 'current_price': '1.78084'}, {'order_id': '8581607125', 'order_company_name': 'EURAUD', 'order_type': 'SELL', 'order_quantity': Decimal('0.05000000'), 'order_price': Decimal('1.77442000'), 'margin': Decimal('57.43111760'), 'contract_value': Decimal('5000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-22.74343000000065230000000000', 'current_price': '1.7812400000000002'}, {'order_id': '8951109289', 'order_company_name': 'EURGBP', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('0.85403000'), 'margin': Decimal('114.85104400'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-177.2073700000000000000000000', 'current_price': '0.86718'}, {'order_id': '7115525171', 'order_company_name': 'EURJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.26050000'), 'margin': Decimal('114.87277223'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '364.0685806924665505156164863', 'current_price': '172.6875'}, {'order_id': '2099467271', 'order_company_name': 'EURJPY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('167.23150000'), 'margin': Decimal('114.85285533'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-370.0374486233409795704204982', 'current_price': '172.7175'}, {'order_id': '4283527369', 'order_company_name': 'EURNZD', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.91952500'), 'margin': Decimal('114.85328250'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-212.2177739999988113800000000', 'current_price': '1.9550649999999998'}, {'order_id': '6611902574', 'order_company_name': 'EURNZD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('1.92063500'), 'margin': Decimal('114.81922980'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '201.2436930000000000000000000', 'current_price': '1.954665'}, {'order_id': '4731664142', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.3401'}, {'order_id': '8676137902', 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.3401'}, {'order_id': '3301052276', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33989'}, {'order_id': '2972795665', 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('2.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-2.500000000000000000000000', 'current_price': '1.33989'}, {'order_id': '1117118581', 'order_company_name': 'NZDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('87.10150000'), 'margin': Decimal('5.97837949'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '8.153899917259126714517311664', 'current_price': '88.32849999999999'}, {'order_id': '3385451189', 'order_company_name': 'USDCHF', 'order_type': 'SELL', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81771000'), 'margin': Decimal('149.97126753'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '296.3893268798962127638341400', 'current_price': '0.80179'}, {'order_id': '6134727989', 'order_company_name': 'USDCHF', 'order_type': 'BUY', 'order_quantity': Decimal('0.15000000'), 'order_price': Decimal('0.81805000'), 'margin': Decimal('150.03056608'), 'contract_value': Decimal('15000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.50000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-311.7390100294396487201237463', 'current_price': '0.80147'}, {'order_id': '9211531174', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.04973000'), 'margin': Decimal('100.00169162'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.9891907115881787368768635', 'current_price': '10.295810000000001'}, {'order_id': '5200391957', 'order_company_name': 'USDNOK', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('10.05023000'), 'margin': Decimal('100.00169154'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '237.5035982402138549243932522', 'current_price': '10.295810000000001'}, {'order_id': '5654381883', 'order_company_name': 'USDSGD', 'order_type': 'SELL', 'order_quantity': Decimal('0.31000000'), 'order_price': Decimal('1.28795000'), 'margin': Decimal('309.93393934'), 'contract_value': Decimal('31000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('3.10000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '69.76850667040030199722909759', 'current_price': '1.2849300000000001'}, {'order_id': '6985407710', 'order_company_name': 'USDTRY', 'order_type': 'SELL', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('39.56087000'), 'margin': Decimal('99.98738813'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('1.00000000'), 'order_status': 'OPEN', 'order_user_id': 9, 'profit_loss': '-174.8057205988891833602538669', 'current_price': '40.260619999999996'}], 'margin_call': False}
2025-07-16 03:42:11,782 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 5123.116801075078539895111164
2025-07-16 03:42:11,783 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-16 03:42:11,783 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-16 03:42:11,783 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 10 (demo) from cache/DB...
2025-07-16 03:42:11,784 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:11,802 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 10...
2025-07-16 03:42:11,806 - DEBUG - app - [AUTO-CUTOFF] User 10 has 0 open orders.
2025-07-16 03:42:11,806 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 10...
2025-07-16 03:42:11,809 - DEBUG - app - [AUTO-CUTOFF] User 10 has 1 pending orders.
2025-07-16 03:42:11,809 - DEBUG - app - [AUTO-CUTOFF] User 10 total positions for portfolio calculation: 1
2025-07-16 03:42:11,816 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:11,819 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:11,869 - DEBUG - app - [AUTO-CUTOFF] User 10 adjusted market prices: {'EURUSD': {'buy': Decimal('1.16185'), 'sell': Decimal('1.1616799999999998')}, 'USDZAR': {'buy': Decimal('17.920740000000002'), 'sell': Decimal('17.91605')}, 'SGDJPY': {'buy': Decimal('115.7265'), 'sell': Decimal('115.68249999999999')}, 'GBPAUD': {'buy': Decimal('2.0544700000000002'), 'sell': Decimal('2.05401')}, 'USDNOK': {'buy': Decimal('10.296899999999999'), 'sell': Decimal('10.295810000000001')}, 'NZDCAD': {'buy': Decimal('0.8155399999999999'), 'sell': Decimal('0.81516')}, 'GBPNZD': {'buy': Decimal('2.255'), 'sell': Decimal('2.25441')}, 'US30': {'buy': Decimal('44031.5'), 'sell': Decimal('44029.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3675'), 'sell': Decimal('108.33449999999999')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.2604700000'), 'sell': Decimal('40.2588200000')}, 'GBPSEK': {'buy': Decimal('13.06345'), 'sell': Decimal('13.060550000000001')}, 'GBPNOK': {'buy': Decimal('13.79875'), 'sell': Decimal('13.79645')}, 'USDCNH': {'buy': Decimal('7.1823999999999995'), 'sell': Decimal('7.1821')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93113')}, 'XAGUSD': {'buy': Decimal('38.059'), 'sell': Decimal('38.021')}, 'BTCUSD': {'buy': Decimal('118860.0'), 'sell': Decimal('118759.9')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96294'), 'sell': Decimal('11.96127')}, 'USDCAD': {'buy': Decimal('1.3722100000000002'), 'sell': Decimal('1.3718599999999999')}, 'NOKSEK': {'buy': Decimal('0.947025'), 'sell': Decimal('0.9465049999999999')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584135')}, 'GBPUSD': {'buy': Decimal('1.3401'), 'sell': Decimal('1.33989')}, 'CHFSGD': {'buy': Decimal('1.6029149999999999'), 'sell': Decimal('1.602505')}, 'EURGBP': {'buy': Decimal('0.86718'), 'sell': Decimal('0.86684')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.02'), 'sell': Decimal('96.914')}, 'EURJPY': {'buy': Decimal('172.7175'), 'sell': Decimal('172.6875')}, 'AUDCHF': {'buy': Decimal('0.52313'), 'sell': Decimal('0.52267')}, 'EURZAR': {'buy': Decimal('20.81954'), 'sell': Decimal('20.813959999999998')}, 'USDCZK': {'buy': Decimal('21.2270000000'), 'sell': Decimal('21.1970000000')}, 'D30': {'buy': Decimal('24130.17'), 'sell': Decimal('24130.17')}, 'AUDUSD': {'buy': Decimal('0.65245'), 'sell': Decimal('0.65214')}, 'EURSEK': {'buy': Decimal('11.32589'), 'sell': Decimal('11.3241')}, 'NZDJPY': {'buy': Decimal('88.3625'), 'sell': Decimal('88.32849999999999')}, 'USDSGD': {'buy': Decimal('1.2849300000000001'), 'sell': Decimal('1.28459')}, 'EURSGD': {'buy': Decimal('1.4927549999999998'), 'sell': Decimal('1.492415')}, 'NZDUSD': {'buy': Decimal('0.59446'), 'sell': Decimal('0.59413')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25667'), 'sell': Decimal('4.25572')}, 'AUDCAD': {'buy': Decimal('0.89498'), 'sell': Decimal('0.89495')}, 'EURCAD': {'buy': Decimal('1.59406'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.9550649999999998'), 'sell': Decimal('1.954665')}, 'USDSEK': {'buy': Decimal('9.74844'), 'sell': Decimal('9.7477')}, 'USDJPY': {'buy': Decimal('148.70600000000002'), 'sell': Decimal('148.60299999999998')}, 'EURAUD': {'buy': Decimal('1.7812400000000002'), 'sell': Decimal('1.78084')}, 'JP225': {'buy': Decimal('39564.55'), 'sell': Decimal('39560.55')}}
2025-07-16 03:42:11,869 - DEBUG - app - [AUTO-CUTOFF] User 10 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:42:11,869 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-16 03:42:12,162 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions': [], 'margin_call': False}
2025-07-16 03:42:12,162 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 10: {'balance': '9958.40000000', 'equity': '9958.40000000', 'margin': '39.25000000', 'free_margin': '9919.15000000', 'profit_loss': '0.0', 'margin_level': '25371.71974522292993630573248', 'positions_with_pnl': [], 'margin_call': False}
2025-07-16 03:42:12,164 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 25371.71974522292993630573248
2025-07-16 03:42:12,165 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-16 03:42:12,165 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-16 03:42:12,165 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 11 (demo) from cache/DB...
2025-07-16 03:42:12,166 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:12,194 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 11...
2025-07-16 03:42:12,198 - DEBUG - app - [AUTO-CUTOFF] User 11 has 1 open orders.
2025-07-16 03:42:12,198 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 11...
2025-07-16 03:42:12,201 - DEBUG - app - [AUTO-CUTOFF] User 11 has 0 pending orders.
2025-07-16 03:42:12,202 - DEBUG - app - [AUTO-CUTOFF] User 11 total positions for portfolio calculation: 1
2025-07-16 03:42:12,271 - DEBUG - app - [AUTO-CUTOFF] User 11 adjusted market prices: {'EURUSD': {'buy': Decimal('1.1618600000000001'), 'sell': Decimal('1.16169')}, 'USDZAR': {'buy': Decimal('17.92075'), 'sell': Decimal('17.91605')}, 'SGDJPY': {'buy': Decimal('115.7255'), 'sell': Decimal('115.68249999999999')}, 'GBPAUD': {'buy': Decimal('2.05449'), 'sell': Decimal('2.054')}, 'USDNOK': {'buy': Decimal('10.296899999999999'), 'sell': Decimal('10.295810000000001')}, 'NZDCAD': {'buy': Decimal('0.8155399999999999'), 'sell': Decimal('0.81516')}, 'GBPNZD': {'buy': Decimal('2.255'), 'sell': Decimal('2.2544299999999997')}, 'US30': {'buy': Decimal('44030.5'), 'sell': Decimal('44028.5')}, 'CHFJPY': {'buy': Decimal('185.46499999999997'), 'sell': Decimal('185.41500000000002')}, 'CADJPY': {'buy': Decimal('108.3675'), 'sell': Decimal('108.33449999999999')}, 'USDCHF': {'buy': Decimal('0.80179'), 'sell': Decimal('0.80147')}, 'USDTRY': {'buy': Decimal('40.2604700000'), 'sell': Decimal('40.2588200000')}, 'GBPSEK': {'buy': Decimal('13.063649999999999'), 'sell': Decimal('13.06075')}, 'GBPNOK': {'buy': Decimal('13.79795'), 'sell': Decimal('13.79565')}, 'USDCNH': {'buy': Decimal('7.1823999999999995'), 'sell': Decimal('7.1821')}, 'EURCHF': {'buy': Decimal('0.93148'), 'sell': Decimal('0.93114')}, 'XAGUSD': {'buy': Decimal('38.059'), 'sell': Decimal('38.022')}, 'BTCUSD': {'buy': Decimal('118860.0'), 'sell': Decimal('118759.9')}, 'AUDNZD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'EURNOK': {'buy': Decimal('11.96294'), 'sell': Decimal('11.96127')}, 'USDCAD': {'buy': Decimal('1.3722100000000002'), 'sell': Decimal('1.3718599999999999')}, 'NOKSEK': {'buy': Decimal('0.947025'), 'sell': Decimal('0.9465049999999999')}, 'CADCHF': {'buy': Decimal('0.5844550000000001'), 'sell': Decimal('0.584135')}, 'GBPUSD': {'buy': Decimal('1.34008'), 'sell': Decimal('1.3398700000000001')}, 'CHFSGD': {'buy': Decimal('1.6029149999999999'), 'sell': Decimal('1.602475')}, 'EURGBP': {'buy': Decimal('0.86717'), 'sell': Decimal('0.86684')}, 'AUDSGD': {'buy': Decimal('1.0000000000'), 'sell': Decimal('1.0000000000')}, 'AUDJPY': {'buy': Decimal('97.02'), 'sell': Decimal('96.914')}, 'EURJPY': {'buy': Decimal('172.7175'), 'sell': Decimal('172.6875')}, 'AUDCHF': {'buy': Decimal('0.52313'), 'sell': Decimal('0.52267')}, 'EURZAR': {'buy': Decimal('20.81991'), 'sell': Decimal('20.814329999999998')}, 'USDCZK': {'buy': Decimal('21.247'), 'sell': Decimal('21.177')}, 'D30': {'buy': Decimal('24128.92'), 'sell': Decimal('24128.92')}, 'AUDUSD': {'buy': Decimal('0.65245'), 'sell': Decimal('0.65214')}, 'EURSEK': {'buy': Decimal('11.32591'), 'sell': Decimal('11.324110000000001')}, 'NZDJPY': {'buy': Decimal('88.3625'), 'sell': Decimal('88.32849999999999')}, 'USDSGD': {'buy': Decimal('1.2849300000000001'), 'sell': Decimal('1.28459')}, 'EURSGD': {'buy': Decimal('1.4927549999999998'), 'sell': Decimal('1.492415')}, 'NZDUSD': {'buy': Decimal('0.59446'), 'sell': Decimal('0.59413')}, 'EURCZK': {'buy': Decimal('25.0000000000'), 'sell': Decimal('25.0000000000')}, 'EURPLN': {'buy': Decimal('4.25662'), 'sell': Decimal('4.25567')}, 'AUDCAD': {'buy': Decimal('0.89499'), 'sell': Decimal('0.89495')}, 'EURCAD': {'buy': Decimal('1.59406'), 'sell': Decimal('1.59385')}, 'EURNZD': {'buy': Decimal('1.9550649999999998'), 'sell': Decimal('1.954645')}, 'USDSEK': {'buy': Decimal('9.7485'), 'sell': Decimal('9.74773')}, 'USDJPY': {'buy': Decimal('148.70700000000002'), 'sell': Decimal('148.60299999999998')}, 'EURAUD': {'buy': Decimal('1.78126'), 'sell': Decimal('1.7808599999999999')}, 'JP225': {'buy': Decimal('39564.55'), 'sell': Decimal('39560.55')}}
2025-07-16 03:42:12,271 - DEBUG - app - [AUTO-CUTOFF] User 11 margin thresholds: call=100.0, cutoff=10.0
2025-07-16 03:42:12,271 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-16 03:42:12,648 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '99998.61000000', 'equity': '99996.63690407125052840254799', 'margin': '6.55', 'free_margin': '99990.08690407125052840254799', 'profit_loss': '-1.973095928749471597452006472', 'margin_level': '1526666.212275896954632099969', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.973095928749471597452006472', 'current_price': '0.89495'}], 'margin_call': False}
2025-07-16 03:42:12,648 - DEBUG - app - [AUTO-CUTOFF] Caching dynamic portfolio data for user 11: {'balance': '99998.61000000', 'equity': '99996.63690407125052840254799', 'margin': '6.55', 'free_margin': '99990.08690407125052840254799', 'profit_loss': '-1.973095928749471597452006472', 'margin_level': '1526666.212275896954632099969', 'positions_with_pnl': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'commission': Decimal('0.10000000'), 'order_status': 'OPEN', 'order_user_id': 11, 'profit_loss': '-1.973095928749471597452006472', 'current_price': '0.89495'}], 'margin_call': False}
2025-07-16 03:42:12,649 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 1526666.212275896954632099969
2025-07-16 03:42:12,650 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-16 03:42:12,650 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-16 03:42:12,650 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 12 (demo) from cache/DB...
2025-07-16 03:42:12,651 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:12,673 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 12...
2025-07-16 03:42:12,676 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 open orders.
2025-07-16 03:42:12,676 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 12...
2025-07-16 03:42:12,679 - DEBUG - app - [AUTO-CUTOFF] User 12 has 0 pending orders.
2025-07-16 03:42:12,679 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:12,679 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-16 03:42:12,679 - DEBUG - app - [AUTO-CUTOFF] Getting user data for user 13 (demo) from cache/DB...
2025-07-16 03:42:12,680 - DEBUG - app - [AUTO-CUTOFF] Getting group symbol settings for group Group B...
2025-07-16 03:42:12,708 - DEBUG - app - [AUTO-CUTOFF] Getting open orders for user 13...
2025-07-16 03:42:12,711 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 open orders.
2025-07-16 03:42:12,711 - DEBUG - app - [AUTO-CUTOFF] Getting pending orders for user 13...
2025-07-16 03:42:12,714 - DEBUG - app - [AUTO-CUTOFF] User 13 has 0 pending orders.
2025-07-16 03:42:12,714 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-16 03:42:12,835 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:12,839 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:13,850 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:13,868 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:13,882 - DEBUG - app.firebase_stream - Firebase listener triggered (55). Event Type: patch, Path: /. Timestamp: 1752662533.8821933
2025-07-16 03:42:13,882 - DEBUG - app.firebase_stream - Prepared batch update for 17 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3490000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541500000'}, 'EURNZD': {'b': '1.9549600000', 'o': '1.9547700000'}, 'EURZAR': {'b': '20.8193800000', 'o
2025-07-16 03:42:13,883 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3490000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0543300000', 'o': '2.0541500000'}, 'EURNZD': {'b': '1.9549600000', 'o': '1.9547700000'}, 'EURZAR': {'b': '20.8193800000', 'o...
2025-07-16 03:42:13,883 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:14,877 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:14,881 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:15,890 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:15,895 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:16,133 - DEBUG - app.firebase_stream - Firebase listener triggered (56). Event Type: patch, Path: /. Timestamp: 1752662536.133848
2025-07-16 03:42:16,134 - DEBUG - app.firebase_stream - Prepared batch update for 14 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0543200000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118830.6800000000', 'o': '118830.6800000000'}, 'CADCHF': {'b': '0.5843100000', 'o': '0.5842600000'}, 'EURSEK': {'b': '11.3257300
2025-07-16 03:42:16,135 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPAUD': {'b': '2.0543200000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118830.6800000000', 'o': '118830.6800000000'}, 'CADCHF': {'b': '0.5843100000', 'o': '0.5842600000'}, 'EURSEK': {'b': '11.3257300...
2025-07-16 03:42:16,135 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:16,899 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:16,903 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:17,915 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:17,951 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:18,504 - DEBUG - app.firebase_stream - Firebase listener triggered (57). Event Type: patch, Path: /. Timestamp: 1752662538.5047991
2025-07-16 03:42:18,505 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'XAGUSD': {'b': '38.0400000000', 'o': '38.0330000000'}, 'NZDJPY': {'b': '88.3500000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0543400000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118836.900000000
2025-07-16 03:42:18,506 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'XAGUSD': {'b': '38.0400000000', 'o': '38.0330000000'}, 'NZDJPY': {'b': '88.3500000000', 'o': '88.3410000000'}, 'GBPAUD': {'b': '2.0543400000', 'o': '2.0541500000'}, 'BTCUSD': {'b': '118836.900000000...
2025-07-16 03:42:18,506 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:18,959 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:18,964 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:19,977 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:19,981 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:20,744 - DEBUG - app.firebase_stream - Firebase listener triggered (58). Event Type: patch, Path: /. Timestamp: 1752662540.7442377
2025-07-16 03:42:20,744 - DEBUG - app.firebase_stream - Prepared batch update for 17 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.3490000000', 'o': '88.3400000000'}, 'GBPAUD': {'b': '2.0543500000', 'o': '2.0541600000'}, 'USDJPY': {'b': '148.6570000000', 'o': '148.6510000000'}, 'SGDJPY': {'b': '115.7120000000
2025-07-16 03:42:20,745 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.3490000000', 'o': '88.3400000000'}, 'GBPAUD': {'b': '2.0543500000', 'o': '2.0541600000'}, 'USDJPY': {'b': '148.6570000000', 'o': '148.6510000000'}, 'SGDJPY': {'b': '115.7120000000...
2025-07-16 03:42:20,745 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:20,985 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:20,988 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:21,999 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:22,006 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:23,008 - DEBUG - app.firebase_stream - Firebase listener triggered (59). Event Type: patch, Path: /. Timestamp: 1752662543.0083644
2025-07-16 03:42:23,008 - DEBUG - app.firebase_stream - Prepared batch update for 28 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0637000000', 'o': '13.0611000000'}, 'XAGUSD': {'b': '38.0410000000', 'o': '38.0340000000'}, 'NZDJPY': {'b': '88.3480000000', 'o': '88.3390000000'}, 'BTCUSD': {'b': '118823.8000000
2025-07-16 03:42:23,009 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0637000000', 'o': '13.0611000000'}, 'XAGUSD': {'b': '38.0410000000', 'o': '38.0340000000'}, 'NZDJPY': {'b': '88.3480000000', 'o': '88.3390000000'}, 'BTCUSD': {'b': '118823.8000000...
2025-07-16 03:42:23,009 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:23,010 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:23,024 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:24,045 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:24,049 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:25,053 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:25,056 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:25,305 - DEBUG - app.firebase_stream - Firebase listener triggered (60). Event Type: patch, Path: /. Timestamp: 1752662545.3051202
2025-07-16 03:42:25,305 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0634000000', 'o': '13.0608000000'}, 'XAGUSD': {'b': '38.0400000000', 'o': '38.0330000000'}, 'NZDJPY': {'b': '88.3490000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0541800000',
2025-07-16 03:42:25,306 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0634000000', 'o': '13.0608000000'}, 'XAGUSD': {'b': '38.0400000000', 'o': '38.0330000000'}, 'NZDJPY': {'b': '88.3490000000', 'o': '88.3440000000'}, 'GBPAUD': {'b': '2.0541800000',...
2025-07-16 03:42:25,306 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:26,073 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:26,077 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:27,083 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:27,087 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:27,618 - DEBUG - app.firebase_stream - Firebase listener triggered (61). Event Type: patch, Path: /. Timestamp: 1752662547.6187832
2025-07-16 03:42:27,619 - DEBUG - app.firebase_stream - Prepared batch update for 37 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0619000000', 'o': '13.0597700000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0539600000', 'o': '2.0539600000'}, 'BTCUSD': {'b': '118836.900000000
2025-07-16 03:42:27,619 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0619000000', 'o': '13.0597700000'}, 'NZDJPY': {'b': '88.3550000000', 'o': '88.3460000000'}, 'GBPAUD': {'b': '2.0539600000', 'o': '2.0539600000'}, 'BTCUSD': {'b': '118836.900000000...
2025-07-16 03:42:27,620 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-16 03:42:28,092 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:28,097 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:28,997 - INFO - app - Application shutdown initiated
2025-07-16 03:42:28,998 - INFO - app - Scheduler shutdown completed
2025-07-16 03:42:28,999 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-16 03:42:29,956 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-16 03:42:29,956 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-16 03:42:29,957 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-16 03:42:29,962 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-16 03:42:29,970 - INFO - app - Redis connection closed
2025-07-16 03:42:29,970 - INFO - app - Application shutdown completed
