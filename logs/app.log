2025-07-10 01:14:05,155 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:14:05,169 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:14:05,179 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:14:05,179 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:14:05,482 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:14:05,482 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:14:05,482 - INFO - app - Environment: PRODUCTION
2025-07-10 01:14:05,532 - INFO - app - Application startup initiated
2025-07-10 01:14:05,532 - INFO - app - Initializing core services...
2025-07-10 01:14:05,570 - INFO - app - Firebase initialized
2025-07-10 01:14:05,570 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:14:07,631 - INFO - app - Redis initialized
2025-07-10 01:14:07,634 - INFO - app - Scheduler initialized
2025-07-10 01:14:07,635 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:14:07,636 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:14:08,699 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:14:08,702 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:14:12,771 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:14:12,771 - INFO - app - Background tasks initialized
2025-07-10 01:14:13,499 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:14:13,499 - INFO - app - Application startup completed successfully
2025-07-10 01:14:13,500 - INFO - app - Starting cache validation task
2025-07-10 01:14:13,522 - INFO - app - Validating cache for 10 users
2025-07-10 01:14:15,536 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:14:17,584 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 01:14:19,601 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:14:21,634 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:14:21,647 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:14:23,689 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:14:23,696 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-10 01:14:23,707 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:14:23,711 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 01:14:23,713 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:14:23,713 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:14:25,768 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 01:14:27,835 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:14:27,860 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 01:14:27,874 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 01:14:27,897 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 01:14:27,909 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:14:27,919 - INFO - app - Cache validation completed
2025-07-10 01:14:28,502 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:14:28,503 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:14:28,504 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:14:28,505 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:14:28,505 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:14:28,506 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:14:28,506 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-10 01:14:28,507 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:14:28,507 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:14:28,507 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:14:28,807 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:14:28,813 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:14:29,003 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:14:29,007 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:14:29,017 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:14:29,017 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:14:29,023 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:14:29,023 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:15:07,183 - INFO - app - Application shutdown initiated
2025-07-10 01:15:07,183 - INFO - app - Scheduler shutdown completed
2025-07-10 01:15:07,324 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 01:15:07,518 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 01:15:07,519 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 01:15:07,520 - INFO - app - Redis connection closed
2025-07-10 01:15:07,520 - INFO - app - Application shutdown completed
2025-07-10 01:21:08,967 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:21:08,982 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:21:08,992 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:21:08,992 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:21:09,463 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:21:09,463 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:21:09,463 - INFO - app - Environment: PRODUCTION
2025-07-10 01:21:09,517 - INFO - app - Application startup initiated
2025-07-10 01:21:09,517 - INFO - app - Initializing core services...
2025-07-10 01:21:09,556 - INFO - app - Firebase initialized
2025-07-10 01:21:09,556 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:21:11,606 - INFO - app - Redis initialized
2025-07-10 01:21:11,609 - INFO - app - Scheduler initialized
2025-07-10 01:21:11,610 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:21:11,611 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:21:12,733 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:21:12,734 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:21:16,778 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:21:16,778 - INFO - app - Background tasks initialized
2025-07-10 01:21:17,436 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:21:17,436 - INFO - app - Application startup completed successfully
2025-07-10 01:21:17,436 - INFO - app - Starting cache validation task
2025-07-10 01:21:17,460 - INFO - app - Validating cache for 10 users
2025-07-10 01:21:19,476 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:21:21,514 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 01:21:23,552 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:21:25,621 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:21:25,629 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:21:27,672 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:21:27,679 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-10 01:21:27,689 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:21:27,691 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 01:21:27,693 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:21:27,693 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:21:29,745 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 01:21:29,764 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:21:31,802 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 01:21:31,832 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 01:21:31,849 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 01:21:31,858 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:21:31,868 - INFO - app - Cache validation completed
2025-07-10 01:21:32,441 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:21:32,442 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:21:32,442 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:21:32,442 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:21:32,443 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:21:32,443 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:21:32,444 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-10 01:21:32,444 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:21:32,444 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:21:32,444 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:21:32,782 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:21:32,788 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:21:33,004 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:21:33,008 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:21:33,024 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:21:33,024 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:21:33,025 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:21:33,025 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:22:12,039 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:22:12,056 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:22:12,417 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:22:12,420 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:22:12,432 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:23:11,972 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:23:11,991 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:23:12,326 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:23:12,330 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:23:12,344 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:24:12,036 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:24:12,050 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:24:12,430 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:24:12,435 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:24:12,447 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:25:11,949 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:25:11,961 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:25:12,339 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:25:12,342 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:25:12,369 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:26:12,111 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:26:12,128 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:26:12,766 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:26:12,772 - INFO - app.api.v1.endpoints.orders - [get_rejected_orders] user_type: demo
2025-07-10 01:26:12,785 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:26:12,807 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:26:31,873 - INFO - app - Starting cache validation task
2025-07-10 01:26:31,890 - INFO - app - Validating cache for 10 users
2025-07-10 01:26:31,894 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 01:26:31,921 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 01:26:31,945 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 01:26:31,961 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:26:31,973 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 01:26:31,988 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 01:26:32,008 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 01:26:32,023 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:26:32,040 - INFO - app - Cache validation completed
2025-07-10 01:26:40,551 - INFO - app - Application shutdown initiated
2025-07-10 01:26:40,552 - INFO - app - Scheduler shutdown completed
2025-07-10 01:26:40,612 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 01:26:41,929 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 01:26:41,929 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 01:26:41,931 - INFO - app - Redis connection closed
2025-07-10 01:26:41,931 - INFO - app - Application shutdown completed
2025-07-10 01:31:23,498 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:31:23,511 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:31:23,521 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:31:23,521 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:31:23,868 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:31:23,868 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:31:23,868 - INFO - app - Environment: PRODUCTION
2025-07-10 01:31:23,915 - INFO - app - Application startup initiated
2025-07-10 01:31:23,915 - INFO - app - Initializing core services...
2025-07-10 01:31:23,954 - INFO - app - Firebase initialized
2025-07-10 01:31:23,954 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:31:26,012 - INFO - app - Redis initialized
2025-07-10 01:31:26,020 - INFO - app - Scheduler initialized
2025-07-10 01:31:26,022 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:31:26,024 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:31:27,221 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:31:27,229 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:31:31,335 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:31:31,335 - INFO - app - Background tasks initialized
2025-07-10 01:31:32,228 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:31:32,229 - INFO - app - Application startup completed successfully
2025-07-10 01:31:32,229 - INFO - app - Starting cache validation task
2025-07-10 01:31:32,256 - INFO - app - Validating cache for 10 users
2025-07-10 01:31:34,275 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:31:36,312 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 01:31:36,316 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:31:38,370 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:31:40,422 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:31:42,476 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:31:42,482 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-10 01:31:42,483 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:31:42,483 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 01:31:42,485 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:31:42,485 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:31:44,539 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 01:31:44,566 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:31:45,589 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:31:45,589 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:31:45,767 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:31:45,767 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:31:45,782 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:31:45,782 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:31:45,783 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:31:45,783 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:31:46,622 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 01:31:46,661 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 01:31:47,244 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:31:48,717 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:31:48,723 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:31:48,727 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:31:48,727 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 01:31:48,730 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:31:48,735 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:31:48,737 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-10 01:31:48,738 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:31:48,739 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:31:48,739 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:31:48,740 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:31:48,748 - INFO - app - Cache validation completed
2025-07-10 01:32:26,531 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:32:26,580 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:32:26,601 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:32:26,605 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:32:26,624 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:32:29,181 - INFO - app.api.v1.endpoints.orders - [get_rejected_orders] user_type: live
2025-07-10 01:33:26,416 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:33:26,427 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:33:26,436 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:33:26,438 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:33:26,446 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:34:26,528 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:34:26,562 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:34:26,585 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:34:26,588 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:34:26,610 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:35:26,430 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:35:26,449 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:35:26,466 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:35:26,471 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:35:26,489 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:36:03,023 - INFO - app - Application shutdown initiated
2025-07-10 01:36:03,023 - INFO - app - Scheduler shutdown completed
2025-07-10 01:36:03,216 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 01:36:04,308 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 01:36:04,308 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 01:36:04,310 - INFO - app - Redis connection closed
2025-07-10 01:36:04,310 - INFO - app - Application shutdown completed
2025-07-10 01:36:06,629 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:36:06,649 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:36:06,662 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:36:06,662 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:36:07,071 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:36:07,071 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:36:07,071 - INFO - app - Environment: PRODUCTION
2025-07-10 01:36:07,124 - INFO - app - Application startup initiated
2025-07-10 01:36:07,124 - INFO - app - Initializing core services...
2025-07-10 01:36:07,179 - INFO - app - Firebase initialized
2025-07-10 01:36:07,179 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:36:09,234 - INFO - app - Redis initialized
2025-07-10 01:36:09,237 - INFO - app - Scheduler initialized
2025-07-10 01:36:09,240 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:36:09,241 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:36:10,345 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:36:10,347 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:36:14,448 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:36:14,448 - INFO - app - Background tasks initialized
2025-07-10 01:36:15,361 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:36:15,361 - INFO - app - Application startup completed successfully
2025-07-10 01:36:15,363 - INFO - app - Starting cache validation task
2025-07-10 01:36:15,512 - INFO - app - Validating cache for 10 users
2025-07-10 01:36:17,406 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:36:19,511 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:36:23,620 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:36:23,628 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:36:23,644 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:36:23,671 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:36:23,681 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:36:23,681 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:36:25,751 - INFO - app - Cache validation completed
2025-07-10 01:36:28,986 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:36:29,239 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:36:29,261 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:36:29,261 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:36:29,266 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:36:29,286 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:36:29,286 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:36:30,159 - INFO - app - Application shutdown initiated
2025-07-10 01:36:30,159 - INFO - app - Scheduler shutdown completed
2025-07-10 01:36:30,160 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 01:36:31,859 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 01:36:31,859 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 01:36:31,861 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:36:32,112 - INFO - app - Redis connection closed
2025-07-10 01:36:32,112 - INFO - app - Application shutdown completed
2025-07-10 01:36:34,265 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:36:34,286 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:36:34,300 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:36:34,300 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:36:34,721 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:36:34,721 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:36:34,721 - INFO - app - Environment: PRODUCTION
2025-07-10 01:36:34,793 - INFO - app - Application startup initiated
2025-07-10 01:36:34,793 - INFO - app - Initializing core services...
2025-07-10 01:36:34,834 - INFO - app - Firebase initialized
2025-07-10 01:36:34,834 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:36:36,888 - INFO - app - Redis initialized
2025-07-10 01:36:36,896 - INFO - app - Scheduler initialized
2025-07-10 01:36:36,901 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:36:36,903 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:36:38,016 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:36:38,028 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:36:42,111 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:36:42,111 - INFO - app - Background tasks initialized
2025-07-10 01:36:42,744 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:36:42,744 - INFO - app - Application startup completed successfully
2025-07-10 01:36:42,745 - INFO - app - Starting cache validation task
2025-07-10 01:36:42,832 - INFO - app - Validating cache for 10 users
2025-07-10 01:36:44,788 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:36:48,860 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:36:50,910 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:36:50,913 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 01:36:50,916 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:36:50,932 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:36:50,949 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:36:50,956 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:36:50,956 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:36:50,959 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 01:36:52,448 - INFO - app.api.v1.endpoints.orders - [get_rejected_orders] user_type: live
2025-07-10 01:36:53,013 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:36:55,052 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 01:36:55,114 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 01:36:57,170 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 01:36:57,746 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:36:58,671 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:36:58,672 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:36:58,908 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:36:58,910 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:36:58,926 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:36:58,926 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:36:58,927 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:36:58,928 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:36:59,233 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:36:59,237 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:36:59,241 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:36:59,242 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 01:36:59,245 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:36:59,251 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:36:59,257 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:36:59,260 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:36:59,260 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:36:59,260 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:36:59,269 - INFO - app - Cache validation completed
2025-07-10 01:37:37,243 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:37:37,254 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:37:37,262 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:37:37,264 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:37:37,271 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:38:22,528 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 4 by invalidating refresh token.
2025-07-10 01:38:29,930 - INFO - app - Application shutdown initiated
2025-07-10 01:38:29,931 - INFO - app - Scheduler shutdown completed
2025-07-10 01:38:29,931 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 01:38:31,765 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 01:38:31,766 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 01:38:31,771 - INFO - app - Redis connection closed
2025-07-10 01:38:31,771 - INFO - app - Application shutdown completed
2025-07-10 01:42:35,843 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:42:35,859 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:42:35,871 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:42:35,871 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:42:36,257 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:42:36,258 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:42:36,258 - INFO - app - Environment: PRODUCTION
2025-07-10 01:42:36,320 - INFO - app - Application startup initiated
2025-07-10 01:42:36,321 - INFO - app - Initializing core services...
2025-07-10 01:42:36,364 - INFO - app - Firebase initialized
2025-07-10 01:42:36,365 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:42:38,406 - INFO - app - Redis initialized
2025-07-10 01:42:38,411 - INFO - app - Scheduler initialized
2025-07-10 01:42:38,413 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:42:38,413 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:42:39,569 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:42:39,589 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:42:43,663 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:42:43,663 - INFO - app - Background tasks initialized
2025-07-10 01:42:44,473 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:42:44,473 - INFO - app - Application startup completed successfully
2025-07-10 01:42:44,473 - INFO - app - Starting cache validation task
2025-07-10 01:42:44,490 - INFO - app - Validating cache for 10 users
2025-07-10 01:42:46,525 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:42:48,577 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 01:42:50,615 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:42:52,682 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:42:52,686 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:42:52,693 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:42:52,698 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 01:42:52,699 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:42:52,701 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:42:52,701 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:42:52,710 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 01:42:58,833 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:42:58,839 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 01:42:59,476 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:42:59,989 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:42:59,990 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:43:00,179 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:43:00,184 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:43:00,192 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:43:00,192 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:43:00,198 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:43:00,199 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:43:00,875 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:43:00,879 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:43:00,881 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:43:00,883 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:43:00,884 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 01:43:00,885 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:43:00,887 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:43:00,888 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:43:00,888 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:43:00,892 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 01:43:00,902 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 01:43:00,911 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:43:00,918 - INFO - app - Cache validation completed
2025-07-10 01:43:27,085 - INFO - app.api.v1.endpoints.orders - [get_rejected_orders] user_type: live
2025-07-10 01:43:31,718 - INFO - app - Application shutdown initiated
2025-07-10 01:43:31,718 - INFO - app - Scheduler shutdown completed
2025-07-10 01:43:31,719 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 01:43:33,487 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 01:43:33,487 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 01:43:33,491 - INFO - app - Redis connection closed
2025-07-10 01:43:33,492 - INFO - app - Application shutdown completed
2025-07-10 01:54:25,461 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:54:25,486 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:54:25,499 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:54:25,499 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:54:25,911 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:54:25,912 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:54:25,912 - INFO - app - Environment: PRODUCTION
2025-07-10 01:54:25,981 - INFO - app - Application startup initiated
2025-07-10 01:54:25,981 - INFO - app - Initializing core services...
2025-07-10 01:54:26,041 - INFO - app - Firebase initialized
2025-07-10 01:54:26,041 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:54:28,095 - INFO - app - Redis initialized
2025-07-10 01:54:28,104 - INFO - app - Scheduler initialized
2025-07-10 01:54:28,108 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:54:28,109 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:54:29,281 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:54:29,285 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:54:33,404 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:54:33,405 - INFO - app - Background tasks initialized
2025-07-10 01:54:34,197 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:54:34,197 - INFO - app - Application startup completed successfully
2025-07-10 01:54:34,197 - INFO - app - Starting cache validation task
2025-07-10 01:54:34,225 - INFO - app - Validating cache for 10 users
2025-07-10 01:54:36,247 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:54:38,301 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 01:54:40,337 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:54:42,401 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:54:42,434 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:54:44,521 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:54:44,536 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:54:44,538 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 01:54:44,538 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:54:44,538 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:54:46,601 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 01:54:48,664 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:54:48,670 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 01:54:48,680 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 01:54:48,697 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 01:54:48,708 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 01:54:48,715 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 01:54:48,724 - INFO - app - Cache validation completed
2025-07-10 01:54:49,210 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:54:49,211 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:54:49,212 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:54:49,212 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:54:49,213 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:54:49,214 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:54:49,214 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:54:49,215 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:54:49,215 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:54:49,580 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:54:49,580 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:54:49,701 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:54:49,701 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:54:49,711 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:54:49,711 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:54:49,711 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:54:49,711 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:55:28,475 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:55:28,485 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:55:28,493 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:55:28,494 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:55:28,501 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:56:28,483 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:56:28,493 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:56:28,503 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:56:28,505 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:56:28,512 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:56:40,382 - INFO - app.api.v1.endpoints.orders - [get_rejected_orders] user_type: live
2025-07-10 01:57:02,989 - INFO - app.api.v1.endpoints.orders - [get_rejected_orders] user_type: demo
2025-07-10 01:57:28,494 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:57:28,509 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:57:28,517 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:57:28,519 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:57:28,527 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:58:13,637 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 1 by invalidating refresh token.
2025-07-10 01:58:29,123 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 01:58:29,134 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 01:58:29,143 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 01:58:29,144 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 01:58:29,152 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 01:58:52,608 - INFO - app - Application shutdown initiated
2025-07-10 01:58:52,609 - INFO - app - Scheduler shutdown completed
2025-07-10 01:58:52,609 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 01:58:54,289 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 01:58:54,289 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 01:58:54,292 - INFO - app - Redis connection closed
2025-07-10 01:58:54,292 - INFO - app - Application shutdown completed
2025-07-10 01:58:56,177 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:58:56,191 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:58:56,202 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:58:56,202 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:58:56,505 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:58:56,506 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:58:56,506 - INFO - app - Environment: PRODUCTION
2025-07-10 01:58:56,567 - INFO - app - Application startup initiated
2025-07-10 01:58:56,567 - INFO - app - Initializing core services...
2025-07-10 01:58:56,603 - INFO - app - Firebase initialized
2025-07-10 01:58:56,603 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:58:58,643 - INFO - app - Redis initialized
2025-07-10 01:58:58,649 - INFO - app - Scheduler initialized
2025-07-10 01:58:58,653 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:58:58,654 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:58:59,619 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:58:59,643 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:59:03,747 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:59:03,747 - INFO - app - Background tasks initialized
2025-07-10 01:59:04,424 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:59:04,424 - INFO - app - Application startup completed successfully
2025-07-10 01:59:04,424 - INFO - app - Starting cache validation task
2025-07-10 01:59:04,460 - INFO - app - Application shutdown initiated
2025-07-10 01:59:04,460 - INFO - app - Scheduler shutdown completed
2025-07-10 01:59:04,460 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 01:59:05,758 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 01:59:05,759 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 01:59:05,763 - INFO - app - Redis connection closed
2025-07-10 01:59:05,763 - INFO - app - Application shutdown completed
2025-07-10 01:59:07,418 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:59:07,432 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:59:07,443 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:59:07,443 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:59:07,747 - INFO - app - Application starting up - Trading system initialized
2025-07-10 01:59:07,747 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 01:59:07,747 - INFO - app - Environment: PRODUCTION
2025-07-10 01:59:07,802 - INFO - app - Application startup initiated
2025-07-10 01:59:07,802 - INFO - app - Initializing core services...
2025-07-10 01:59:07,840 - INFO - app - Firebase initialized
2025-07-10 01:59:07,840 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 01:59:09,904 - INFO - app - Redis initialized
2025-07-10 01:59:09,908 - INFO - app - Scheduler initialized
2025-07-10 01:59:09,909 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:59:09,910 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 01:59:10,989 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 01:59:11,005 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:59:15,083 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 01:59:15,083 - INFO - app - Background tasks initialized
2025-07-10 01:59:15,790 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 01:59:15,790 - INFO - app - Application startup completed successfully
2025-07-10 01:59:15,790 - INFO - app - Starting cache validation task
2025-07-10 01:59:15,811 - INFO - app - Validating cache for 10 users
2025-07-10 01:59:17,835 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:59:21,892 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:59:23,944 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:59:23,951 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:59:23,965 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:59:23,971 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:59:23,974 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:59:23,974 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:59:26,028 - INFO - app - Cache validation completed
2025-07-10 01:59:29,053 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:59:29,138 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 01:59:29,231 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:59:29,243 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:59:29,243 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:59:29,322 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 01:59:29,332 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 01:59:29,332 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 01:59:30,791 - INFO - app - Starting stale cache cleanup task
2025-07-10 01:59:30,793 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 01:59:30,794 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 01:59:30,795 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 01:59:30,796 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 01:59:30,798 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 01:59:30,800 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 01:59:30,800 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 01:59:30,801 - INFO - app - Completed stale cache cleanup task
2025-07-10 01:59:42,412 - INFO - app.api.v1.endpoints.orders - [get_rejected_orders] user_type: live
2025-07-10 01:59:54,657 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 4 by invalidating refresh token.
2025-07-10 01:59:59,717 - INFO - app - Application shutdown initiated
2025-07-10 01:59:59,717 - INFO - app - Scheduler shutdown completed
2025-07-10 01:59:59,718 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:00:00,951 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:00:00,951 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:00:00,955 - INFO - app - Redis connection closed
2025-07-10 02:00:00,955 - INFO - app - Application shutdown completed
2025-07-10 02:20:30,815 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:20:30,830 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:20:30,840 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:20:30,840 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:20:31,205 - INFO - app - Application starting up - Trading system initialized
2025-07-10 02:20:31,205 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 02:20:31,205 - INFO - app - Environment: PRODUCTION
2025-07-10 02:20:31,259 - INFO - app - Application startup initiated
2025-07-10 02:20:31,259 - INFO - app - Initializing core services...
2025-07-10 02:20:31,309 - INFO - app - Firebase initialized
2025-07-10 02:20:31,309 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 02:20:33,350 - INFO - app - Redis initialized
2025-07-10 02:20:33,357 - INFO - app - Scheduler initialized
2025-07-10 02:20:33,361 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:20:33,362 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 02:20:34,533 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:20:34,547 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:20:38,629 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 02:20:38,630 - INFO - app - Background tasks initialized
2025-07-10 02:20:39,250 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 02:20:39,250 - INFO - app - Application startup completed successfully
2025-07-10 02:20:39,251 - INFO - app - Starting cache validation task
2025-07-10 02:20:39,262 - INFO - app - Validating cache for 10 users
2025-07-10 02:20:41,282 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:20:43,338 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 02:20:45,380 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:20:47,425 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:20:47,433 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:20:49,458 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:20:49,465 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:20:49,469 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 02:20:49,470 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:20:49,470 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:20:51,518 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 02:20:53,551 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 02:20:53,554 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 02:20:54,251 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:20:54,621 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:20:54,621 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:20:54,810 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:20:54,815 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:20:54,826 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:20:54,826 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:20:54,831 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:20:54,831 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:20:55,597 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:20:55,637 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:20:55,638 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:20:55,640 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:20:55,642 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 02:20:55,642 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:20:55,646 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:20:55,648 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:20:55,648 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:20:55,655 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 02:20:55,667 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 02:20:55,680 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 02:20:55,689 - INFO - app - Cache validation completed
2025-07-10 02:21:33,854 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:21:33,893 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:21:33,927 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:21:33,932 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:21:33,961 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:22:33,750 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:22:33,778 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:22:33,804 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:22:33,808 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:22:33,823 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:22:53,705 - INFO - app.api.v1.endpoints.orders - [get_rejected_orders] user_type: demo
2025-07-10 02:23:33,883 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:23:33,911 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:23:33,932 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:23:33,935 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:23:33,949 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:23:39,648 - INFO - app - Application shutdown initiated
2025-07-10 02:23:39,648 - INFO - app - Scheduler shutdown completed
2025-07-10 02:23:39,649 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:23:40,916 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:23:40,916 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:23:40,920 - INFO - app - Redis connection closed
2025-07-10 02:23:40,920 - INFO - app - Application shutdown completed
2025-07-10 02:32:37,658 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:32:37,679 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:32:37,705 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:32:37,705 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:32:38,547 - INFO - app - Application starting up - Trading system initialized
2025-07-10 02:32:38,548 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 02:32:38,548 - INFO - app - Environment: PRODUCTION
2025-07-10 02:32:38,667 - INFO - app - Application startup initiated
2025-07-10 02:32:38,667 - INFO - app - Initializing core services...
2025-07-10 02:32:38,733 - INFO - app - Firebase initialized
2025-07-10 02:32:38,733 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 02:32:40,790 - INFO - app - Redis initialized
2025-07-10 02:32:40,796 - INFO - app - Scheduler initialized
2025-07-10 02:32:40,800 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:32:40,802 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 02:32:42,099 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:32:42,117 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:32:46,226 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 02:32:46,227 - INFO - app - Background tasks initialized
2025-07-10 02:32:46,896 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 02:32:46,896 - INFO - app - Application startup completed successfully
2025-07-10 02:32:46,897 - INFO - app - Starting cache validation task
2025-07-10 02:32:46,927 - INFO - app - Validating cache for 10 users
2025-07-10 02:32:48,951 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:32:50,998 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 02:32:53,033 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:32:55,085 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:32:55,093 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:32:55,114 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:32:55,145 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:32:55,148 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 02:32:55,166 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:32:55,167 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:32:57,235 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 02:32:57,263 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 02:32:59,332 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 02:32:59,381 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 02:33:01,005 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:33:01,006 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:33:01,240 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:33:01,242 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:33:01,256 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:33:01,257 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:33:01,259 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:33:01,259 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:33:01,428 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 02:33:01,899 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:33:03,479 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:33:03,498 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:33:03,505 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:33:03,506 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 02:33:03,510 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:33:03,518 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:33:03,522 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:33:03,524 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:33:03,524 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:33:03,525 - INFO - app - Cache validation completed
2025-07-10 02:33:41,286 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:33:41,302 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:33:41,321 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:33:41,324 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:33:41,335 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:34:14,025 - INFO - app - Application shutdown initiated
2025-07-10 02:34:14,026 - INFO - app - Scheduler shutdown completed
2025-07-10 02:34:14,186 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:34:14,692 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:34:14,692 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:34:14,694 - INFO - app - Redis connection closed
2025-07-10 02:34:14,694 - INFO - app - Application shutdown completed
2025-07-10 02:34:17,535 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:34:17,574 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:34:17,596 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:34:17,597 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:34:18,399 - INFO - app - Application starting up - Trading system initialized
2025-07-10 02:34:18,399 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 02:34:18,399 - INFO - app - Environment: PRODUCTION
2025-07-10 02:34:18,499 - INFO - app - Application startup initiated
2025-07-10 02:34:18,499 - INFO - app - Initializing core services...
2025-07-10 02:34:18,574 - INFO - app - Firebase initialized
2025-07-10 02:34:18,574 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 02:34:20,621 - INFO - app - Redis initialized
2025-07-10 02:34:20,628 - INFO - app - Scheduler initialized
2025-07-10 02:34:20,639 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:34:20,641 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 02:34:21,871 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:34:21,909 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:34:26,007 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 02:34:26,007 - INFO - app - Background tasks initialized
2025-07-10 02:34:26,632 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 02:34:26,632 - INFO - app - Application startup completed successfully
2025-07-10 02:34:26,633 - INFO - app - Starting cache validation task
2025-07-10 02:34:26,688 - INFO - app - Validating cache for 10 users
2025-07-10 02:34:28,662 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:34:32,746 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:34:34,794 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:34:34,803 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:34:34,827 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:34:34,849 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:34:34,856 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:34:34,856 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:34:36,996 - INFO - app - Cache validation completed
2025-07-10 02:34:41,635 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:34:41,636 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:34:41,636 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:34:41,637 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:34:41,637 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:34:41,638 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:34:41,639 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:34:41,640 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:34:41,640 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:34:42,530 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:34:42,541 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:34:42,784 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:34:42,834 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:34:42,834 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:34:42,835 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:34:42,835 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:35:21,145 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:35:21,185 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:35:21,227 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:35:21,233 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:35:21,253 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:35:31,788 - INFO - app - Application shutdown initiated
2025-07-10 02:35:31,789 - INFO - app - Scheduler shutdown completed
2025-07-10 02:35:32,033 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:35:32,485 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:35:32,486 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:35:32,489 - INFO - app - Redis connection closed
2025-07-10 02:35:32,489 - INFO - app - Application shutdown completed
2025-07-10 02:39:57,790 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:39:57,818 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:39:57,846 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:39:57,847 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:39:58,545 - INFO - app - Application starting up - Trading system initialized
2025-07-10 02:39:58,545 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 02:39:58,545 - INFO - app - Environment: PRODUCTION
2025-07-10 02:39:58,648 - INFO - app - Application startup initiated
2025-07-10 02:39:58,648 - INFO - app - Initializing core services...
2025-07-10 02:39:58,714 - INFO - app - Firebase initialized
2025-07-10 02:39:58,714 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 02:40:00,745 - INFO - app - Redis initialized
2025-07-10 02:40:00,753 - INFO - app - Scheduler initialized
2025-07-10 02:40:00,862 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:40:00,864 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 02:40:02,112 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:40:02,117 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:40:06,221 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 02:40:06,221 - INFO - app - Background tasks initialized
2025-07-10 02:40:06,902 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 02:40:06,903 - INFO - app - Application startup completed successfully
2025-07-10 02:40:06,903 - INFO - app - Starting cache validation task
2025-07-10 02:40:06,938 - INFO - app - Validating cache for 10 users
2025-07-10 02:40:08,952 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:40:10,985 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 02:40:13,046 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:40:15,098 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:40:15,105 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:40:17,153 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:40:17,170 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 02:40:17,170 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:40:17,178 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:40:17,178 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:40:17,204 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 02:40:21,353 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 02:40:21,366 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 02:40:21,914 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:40:23,438 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:40:23,446 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:40:23,448 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:40:23,482 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:40:23,485 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 02:40:23,489 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:40:23,495 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:40:23,497 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:40:23,497 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:40:23,501 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 02:40:23,519 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 02:40:23,534 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 02:40:23,544 - INFO - app - Cache validation completed
2025-07-10 02:40:24,962 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:40:24,998 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:40:25,194 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:40:25,209 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:40:25,209 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:40:25,235 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:40:25,253 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:40:25,253 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:41:01,190 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:41:01,219 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:41:01,235 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:41:01,239 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:41:01,252 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:41:39,178 - INFO - app - Application shutdown initiated
2025-07-10 02:41:39,179 - INFO - app - Scheduler shutdown completed
2025-07-10 02:41:39,179 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:41:39,342 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:41:39,342 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:41:39,435 - INFO - app - Redis connection closed
2025-07-10 02:41:39,436 - INFO - app - Application shutdown completed
2025-07-10 02:41:43,045 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:41:43,066 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:41:43,083 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:41:43,083 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:41:43,753 - INFO - app - Application starting up - Trading system initialized
2025-07-10 02:41:43,753 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 02:41:43,753 - INFO - app - Environment: PRODUCTION
2025-07-10 02:41:43,825 - INFO - app - Application startup initiated
2025-07-10 02:41:43,825 - INFO - app - Initializing core services...
2025-07-10 02:41:43,923 - INFO - app - Firebase initialized
2025-07-10 02:41:43,923 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 02:41:45,981 - INFO - app - Redis initialized
2025-07-10 02:41:45,988 - INFO - app - Scheduler initialized
2025-07-10 02:41:46,006 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:41:46,008 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 02:41:47,147 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:41:47,149 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:41:51,213 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 02:41:51,213 - INFO - app - Background tasks initialized
2025-07-10 02:41:51,962 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 02:41:51,962 - INFO - app - Application startup completed successfully
2025-07-10 02:41:51,962 - INFO - app - Starting cache validation task
2025-07-10 02:41:52,018 - INFO - app - Validating cache for 10 users
2025-07-10 02:41:54,006 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:41:58,077 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:41:58,082 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:42:00,139 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:42:02,217 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:42:02,246 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:42:02,262 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:42:02,262 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:42:04,370 - INFO - app - Cache validation completed
2025-07-10 02:42:06,966 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:42:08,518 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:42:08,524 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:42:08,531 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:42:08,535 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:42:08,541 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:42:08,545 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:42:08,558 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:42:08,558 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:42:10,037 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:42:10,037 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:42:10,304 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:42:10,305 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:42:10,324 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:42:10,324 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:42:10,324 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:42:10,325 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:42:14,810 - INFO - app - Application shutdown initiated
2025-07-10 02:42:14,810 - INFO - app - Scheduler shutdown completed
2025-07-10 02:42:14,810 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:42:16,143 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:42:16,143 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:42:16,150 - INFO - app - Redis connection closed
2025-07-10 02:42:16,150 - INFO - app - Application shutdown completed
2025-07-10 02:42:19,291 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:42:19,322 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:42:19,380 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:42:19,381 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:42:19,955 - INFO - app - Application starting up - Trading system initialized
2025-07-10 02:42:19,955 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 02:42:19,955 - INFO - app - Environment: PRODUCTION
2025-07-10 02:42:20,043 - INFO - app - Application startup initiated
2025-07-10 02:42:20,043 - INFO - app - Initializing core services...
2025-07-10 02:42:20,117 - INFO - app - Firebase initialized
2025-07-10 02:42:20,117 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 02:42:22,147 - INFO - app - Redis initialized
2025-07-10 02:42:22,153 - INFO - app - Scheduler initialized
2025-07-10 02:42:22,206 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:42:22,207 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 02:42:23,304 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:42:23,318 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:42:27,396 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 02:42:27,396 - INFO - app - Background tasks initialized
2025-07-10 02:42:28,210 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 02:42:28,210 - INFO - app - Application startup completed successfully
2025-07-10 02:42:28,210 - INFO - app - Starting cache validation task
2025-07-10 02:42:28,275 - INFO - app - Validating cache for 10 users
2025-07-10 02:42:30,260 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:42:32,306 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:42:34,339 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:42:36,377 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:42:36,406 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:42:36,464 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:42:36,472 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:42:36,472 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:42:38,546 - INFO - app - Cache validation completed
2025-07-10 02:42:42,091 - INFO - app - Application shutdown initiated
2025-07-10 02:42:42,091 - INFO - app - Scheduler shutdown completed
2025-07-10 02:42:42,092 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:42:43,675 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:42:43,677 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:42:43,779 - INFO - app - Redis connection closed
2025-07-10 02:42:43,780 - INFO - app - Application shutdown completed
2025-07-10 02:42:57,340 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:42:57,367 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:42:57,392 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:42:57,392 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:42:57,931 - INFO - app - Application starting up - Trading system initialized
2025-07-10 02:42:57,931 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 02:42:57,931 - INFO - app - Environment: PRODUCTION
2025-07-10 02:42:58,033 - INFO - app - Application startup initiated
2025-07-10 02:42:58,033 - INFO - app - Initializing core services...
2025-07-10 02:42:58,111 - INFO - app - Firebase initialized
2025-07-10 02:42:58,111 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 02:43:00,171 - INFO - app - Redis initialized
2025-07-10 02:43:00,176 - INFO - app - Scheduler initialized
2025-07-10 02:43:00,179 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:43:00,180 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 02:43:01,402 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:43:01,433 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:43:05,538 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 02:43:05,538 - INFO - app - Background tasks initialized
2025-07-10 02:43:06,302 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 02:43:06,302 - INFO - app - Application startup completed successfully
2025-07-10 02:43:06,303 - INFO - app - Starting cache validation task
2025-07-10 02:43:06,372 - INFO - app - Validating cache for 10 users
2025-07-10 02:43:08,329 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:43:10,380 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:43:12,446 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:43:14,490 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:43:14,510 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:43:14,532 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:43:14,543 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:43:14,543 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:43:16,647 - INFO - app - Cache validation completed
2025-07-10 02:43:20,236 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:43:20,236 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:43:20,457 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:43:20,458 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:43:20,478 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:43:20,478 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:43:20,478 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:43:20,478 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:43:21,314 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:43:23,123 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:43:23,125 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:43:23,127 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:43:23,131 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:43:23,137 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:43:23,139 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:43:23,140 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:43:23,140 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:44:03,161 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:44:03,244 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:44:03,318 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:44:03,338 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:44:03,384 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:45:00,597 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:45:00,623 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:45:00,645 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:45:00,650 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:45:00,666 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:45:12,671 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDNZD
2025-07-10 02:46:00,704 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:46:00,723 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:46:01,096 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:46:01,098 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:46:01,107 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:46:44,034 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 1 by invalidating refresh token.
2025-07-10 02:46:58,453 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDSGD
2025-07-10 02:46:58,454 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDSGD
2025-07-10 02:46:58,465 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '7613293094', 'user_id': '4', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '95.98', 'status': 'OPEN', 'contract_value': '1000.0', 'account_type': 'live', 'timestamp': '2025-07-10T09:46:58.465224'}
2025-07-10 02:46:58,850 - INFO - app.core.firebase - Order data (ID: 7613293094) sent to Firebase successfully.
2025-07-10 02:47:00,922 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:47:00,963 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:47:01,512 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:47:03,699 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:47:03,843 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:48:00,733 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 02:48:00,768 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 02:48:01,214 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 02:48:01,221 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 02:48:01,270 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 02:48:16,668 - INFO - app - Starting cache validation task
2025-07-10 02:48:16,696 - INFO - app - Validating cache for 10 users
2025-07-10 02:48:16,705 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 02:48:16,738 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 02:48:16,774 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 02:48:16,792 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 02:48:16,820 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 02:48:16,855 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 02:48:16,889 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 02:48:16,920 - INFO - app - Cache validation completed
2025-07-10 02:48:17,866 - INFO - app - Application shutdown initiated
2025-07-10 02:48:17,867 - INFO - app - Scheduler shutdown completed
2025-07-10 02:48:17,871 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:48:19,407 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:48:19,408 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:48:19,823 - INFO - app - Redis connection closed
2025-07-10 02:48:19,823 - INFO - app - Application shutdown completed
2025-07-10 02:49:55,109 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:49:55,122 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:49:55,130 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:49:55,130 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:49:55,507 - INFO - app - Application starting up - Trading system initialized
2025-07-10 02:49:55,507 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 02:49:55,507 - INFO - app - Environment: PRODUCTION
2025-07-10 02:49:55,561 - INFO - app - Application startup initiated
2025-07-10 02:49:55,561 - INFO - app - Initializing core services...
2025-07-10 02:49:55,597 - INFO - app - Firebase initialized
2025-07-10 02:49:55,598 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 02:49:57,617 - INFO - app - Redis initialized
2025-07-10 02:49:57,620 - INFO - app - Scheduler initialized
2025-07-10 02:49:57,622 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:49:57,622 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 02:49:58,527 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 02:49:58,529 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:50:02,592 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 02:50:02,592 - INFO - app - Background tasks initialized
2025-07-10 02:50:03,369 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 02:50:03,369 - INFO - app - Application startup completed successfully
2025-07-10 02:50:03,370 - INFO - app - Starting cache validation task
2025-07-10 02:50:03,395 - INFO - app - Validating cache for 10 users
2025-07-10 02:50:05,413 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:50:07,491 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:50:09,543 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:50:11,597 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:50:11,630 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:50:11,712 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:50:11,717 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:50:11,717 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:50:13,804 - INFO - app - Cache validation completed
2025-07-10 02:50:16,786 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:50:16,792 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 02:50:16,936 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:50:16,947 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 02:50:16,948 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:50:16,948 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:50:16,957 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 02:50:16,957 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 02:50:18,377 - INFO - app - Starting stale cache cleanup task
2025-07-10 02:50:18,379 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 02:50:18,380 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 02:50:18,381 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 02:50:18,382 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 02:50:18,384 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 02:50:18,385 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 02:50:18,386 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 02:50:18,386 - INFO - app - Completed stale cache cleanup task
2025-07-10 02:50:43,320 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '8945672525', 'user_id': '4', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '95.958', 'status': 'OPEN', 'contract_value': '1000.0', 'account_type': 'live', 'timestamp': '2025-07-10T09:50:43.320539'}
2025-07-10 02:50:43,613 - INFO - app.core.firebase - Order data (ID: 8945672525) sent to Firebase successfully.
2025-07-10 02:50:53,533 - INFO - app - Application shutdown initiated
2025-07-10 02:50:53,534 - INFO - app - Scheduler shutdown completed
2025-07-10 02:50:53,628 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 02:50:55,206 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 02:50:55,206 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 02:50:55,208 - INFO - app - Redis connection closed
2025-07-10 02:50:55,209 - INFO - app - Application shutdown completed
2025-07-10 03:04:53,164 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:04:53,177 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:04:53,186 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:04:53,186 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:04:53,563 - INFO - app - Application starting up - Trading system initialized
2025-07-10 03:04:53,564 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 03:04:53,564 - INFO - app - Environment: PRODUCTION
2025-07-10 03:04:53,612 - INFO - app - Application startup initiated
2025-07-10 03:04:53,613 - INFO - app - Initializing core services...
2025-07-10 03:04:53,646 - INFO - app - Firebase initialized
2025-07-10 03:04:53,646 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 03:04:55,707 - INFO - app - Redis initialized
2025-07-10 03:04:55,712 - INFO - app - Scheduler initialized
2025-07-10 03:04:55,715 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:04:55,715 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 03:04:57,027 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:04:57,030 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:05:01,138 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 03:05:01,138 - INFO - app - Background tasks initialized
2025-07-10 03:05:01,758 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 03:05:01,758 - INFO - app - Application startup completed successfully
2025-07-10 03:05:01,759 - INFO - app - Starting cache validation task
2025-07-10 03:05:01,778 - INFO - app - Validating cache for 10 users
2025-07-10 03:05:03,819 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:05:05,852 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 03:05:07,890 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:05:09,911 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:05:09,916 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:05:09,926 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:05:11,984 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:05:11,986 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 03:05:11,995 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:05:11,995 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:05:14,060 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 03:05:16,197 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:05:16,238 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 03:05:16,282 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 03:05:16,316 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 03:05:16,342 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 03:05:16,363 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:05:16,383 - INFO - app - Cache validation completed
2025-07-10 03:05:16,760 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:05:16,760 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:05:16,761 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:05:16,762 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:05:16,763 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:05:16,765 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:05:16,766 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:05:16,767 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:05:16,767 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:05:17,251 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:05:17,253 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:05:17,395 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:05:17,395 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:05:17,404 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:05:17,404 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:05:17,404 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:05:17,405 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:05:56,077 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 03:05:56,083 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 03:05:56,088 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 03:05:56,089 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 03:05:56,093 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 03:06:56,087 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 03:06:56,100 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 03:06:56,108 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 03:06:56,110 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 03:06:56,118 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 03:07:18,189 - INFO - app - Application shutdown initiated
2025-07-10 03:07:18,189 - INFO - app - Scheduler shutdown completed
2025-07-10 03:07:18,297 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 03:07:20,562 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 03:07:20,563 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 03:07:20,564 - INFO - app - Redis connection closed
2025-07-10 03:07:20,564 - INFO - app - Application shutdown completed
2025-07-10 03:11:21,930 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:11:21,942 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:11:21,951 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:11:21,951 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:11:22,325 - INFO - app - Application starting up - Trading system initialized
2025-07-10 03:11:22,326 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 03:11:22,326 - INFO - app - Environment: PRODUCTION
2025-07-10 03:11:22,377 - INFO - app - Application startup initiated
2025-07-10 03:11:22,377 - INFO - app - Initializing core services...
2025-07-10 03:11:22,410 - INFO - app - Firebase initialized
2025-07-10 03:11:22,410 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 03:11:24,470 - INFO - app - Redis initialized
2025-07-10 03:11:24,476 - INFO - app - Scheduler initialized
2025-07-10 03:11:24,479 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:11:24,480 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 03:11:25,599 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:11:25,609 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:11:29,670 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 03:11:29,670 - INFO - app - Background tasks initialized
2025-07-10 03:11:30,411 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 03:11:30,411 - INFO - app - Application startup completed successfully
2025-07-10 03:11:30,411 - INFO - app - Starting cache validation task
2025-07-10 03:11:30,432 - INFO - app - Validating cache for 10 users
2025-07-10 03:11:32,449 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:11:34,484 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 03:11:36,543 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:11:36,559 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:11:38,602 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:11:38,614 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:11:38,625 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:11:38,628 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 03:11:38,629 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:11:38,629 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:11:38,646 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 03:11:42,726 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:11:42,737 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 03:11:42,747 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 03:11:43,657 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:11:43,660 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:11:43,790 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:11:43,791 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:11:43,802 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:11:43,803 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:11:43,803 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:11:44,794 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 03:11:45,413 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:11:46,849 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:11:46,854 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:11:46,858 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:11:46,861 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:11:46,863 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:11:46,864 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:11:46,865 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:11:46,865 - INFO - app - Cache validation completed
2025-07-10 03:11:46,866 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:11:46,866 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:12:06,195 - INFO - app - Application shutdown initiated
2025-07-10 03:12:06,195 - INFO - app - Scheduler shutdown completed
2025-07-10 03:12:06,287 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 03:12:08,096 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 03:12:08,096 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 03:12:08,097 - INFO - app - Redis connection closed
2025-07-10 03:12:08,097 - INFO - app - Application shutdown completed
2025-07-10 03:23:43,169 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:23:43,183 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:23:43,194 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:23:43,195 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:23:43,620 - INFO - app - Application starting up - Trading system initialized
2025-07-10 03:23:43,620 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 03:23:43,620 - INFO - app - Environment: PRODUCTION
2025-07-10 03:23:43,664 - INFO - app - Application startup initiated
2025-07-10 03:23:43,664 - INFO - app - Initializing core services...
2025-07-10 03:23:43,696 - INFO - app - Firebase initialized
2025-07-10 03:23:43,696 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 03:23:45,750 - INFO - app - Redis initialized
2025-07-10 03:23:45,756 - INFO - app - Scheduler initialized
2025-07-10 03:23:45,760 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:23:45,761 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 03:23:47,044 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:23:47,051 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:23:51,116 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 03:23:51,116 - INFO - app - Background tasks initialized
2025-07-10 03:23:51,751 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 03:23:51,751 - INFO - app - Application startup completed successfully
2025-07-10 03:23:51,751 - INFO - app - Starting cache validation task
2025-07-10 03:23:51,771 - INFO - app - Validating cache for 10 users
2025-07-10 03:23:53,800 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:23:55,840 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 03:23:57,872 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:23:59,916 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:23:59,920 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:23:59,926 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:24:01,973 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 03:24:01,974 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:24:04,016 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:24:04,016 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:24:06,068 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 03:24:06,755 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:24:08,135 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:24:08,138 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:24:08,143 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:24:08,146 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:24:08,149 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:24:10,183 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:24:10,190 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:24:10,192 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:24:10,192 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:24:10,193 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 03:24:10,211 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 03:24:10,228 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 03:24:10,237 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:24:10,247 - INFO - app - Cache validation completed
2025-07-10 03:24:11,132 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:24:11,133 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:24:11,318 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:24:11,325 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:24:11,330 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:24:11,330 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:24:11,337 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:24:11,338 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:24:43,381 - INFO - app - Application shutdown initiated
2025-07-10 03:24:43,381 - INFO - app - Scheduler shutdown completed
2025-07-10 03:24:43,452 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 03:24:44,900 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 03:24:44,901 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 03:24:44,901 - INFO - app - Redis connection closed
2025-07-10 03:24:44,901 - INFO - app - Application shutdown completed
2025-07-10 03:38:41,775 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:38:41,795 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:38:41,805 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:38:41,806 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:38:42,370 - INFO - app - Application starting up - Trading system initialized
2025-07-10 03:38:42,371 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 03:38:42,371 - INFO - app - Environment: PRODUCTION
2025-07-10 03:38:42,438 - INFO - app - Application startup initiated
2025-07-10 03:38:42,438 - INFO - app - Initializing core services...
2025-07-10 03:38:42,480 - INFO - app - Firebase initialized
2025-07-10 03:38:42,480 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 03:38:44,523 - INFO - app - Redis initialized
2025-07-10 03:38:44,526 - INFO - app - Scheduler initialized
2025-07-10 03:38:44,528 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:38:44,529 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 03:38:45,807 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:38:45,812 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:38:49,905 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 03:38:49,905 - INFO - app - Background tasks initialized
2025-07-10 03:38:50,598 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 03:38:50,598 - INFO - app - Application startup completed successfully
2025-07-10 03:38:50,599 - INFO - app - Starting cache validation task
2025-07-10 03:38:50,617 - INFO - app - Validating cache for 10 users
2025-07-10 03:38:52,637 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:38:54,684 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 03:38:56,709 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:38:58,763 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:39:00,249 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 1
2025-07-10 03:39:00,781 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:39:00,785 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 1
2025-07-10 03:39:00,799 - WARNING - app.api.v1.endpoints.users - Refresh token valid, but user ID 1 not found or inactive.
2025-07-10 03:39:00,799 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:39:00,805 - INFO - app.api.v1.endpoints.users - Invalidated refresh token for invalid user ID 1.
2025-07-10 03:39:00,805 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: User not found or inactive
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 331, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive
2025-07-10 03:39:00,812 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 03:39:00,812 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:39:00,818 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:39:00,819 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:39:04,897 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 03:39:04,943 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:39:05,611 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:39:07,004 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 03:39:07,005 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:39:07,025 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:39:07,036 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:39:07,040 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:39:07,047 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:39:07,063 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 03:39:07,081 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:39:07,084 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:39:07,084 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:39:07,100 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 03:39:07,127 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 03:39:07,152 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:39:07,169 - INFO - app - Cache validation completed
2025-07-10 03:39:08,188 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:39:08,189 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:39:08,334 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:39:08,336 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:39:08,344 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:39:08,344 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:39:08,346 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:39:08,346 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:39:45,105 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 03:39:45,128 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 03:39:45,515 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 03:39:45,536 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 03:39:45,575 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 03:40:06,684 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDSGD
2025-07-10 03:40:06,685 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDSGD
2025-07-10 03:40:44,993 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 03:40:45,002 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 03:40:45,404 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 03:40:45,411 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 03:40:45,425 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 03:41:44,943 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 03:41:44,969 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 03:41:45,395 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 03:41:45,397 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 03:41:45,411 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 03:42:44,923 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 03:42:44,931 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 03:42:45,301 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 03:42:45,305 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 03:42:45,317 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 03:43:44,900 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 03:43:44,908 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 03:43:45,304 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 03:43:45,305 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 03:43:45,311 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 03:44:07,220 - INFO - app - Starting cache validation task
2025-07-10 03:44:07,232 - INFO - app - Validating cache for 10 users
2025-07-10 03:44:09,274 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 03:44:09,367 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 03:44:11,480 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 03:44:11,544 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:44:11,556 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 03:44:11,584 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 03:44:11,610 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 03:44:11,664 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:44:11,688 - INFO - app - Cache validation completed
2025-07-10 03:44:12,039 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDSGD
2025-07-10 03:44:12,039 - WARNING - app.services.portfolio_calculator - No adjusted prices found for symbol AUDSGD
2025-07-10 03:44:35,210 - INFO - app - Application shutdown initiated
2025-07-10 03:44:35,211 - INFO - app - Scheduler shutdown completed
2025-07-10 03:44:35,211 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 03:44:36,914 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 03:44:36,915 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 03:44:36,918 - INFO - app - Redis connection closed
2025-07-10 03:44:36,918 - INFO - app - Application shutdown completed
2025-07-10 03:49:41,247 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:49:41,267 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:49:41,282 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:49:41,282 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:49:41,739 - INFO - app - Application starting up - Trading system initialized
2025-07-10 03:49:41,740 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 03:49:41,740 - INFO - app - Environment: PRODUCTION
2025-07-10 03:49:41,802 - INFO - app - Application startup initiated
2025-07-10 03:49:41,802 - INFO - app - Initializing core services...
2025-07-10 03:49:41,855 - INFO - app - Firebase initialized
2025-07-10 03:49:41,855 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 03:49:43,907 - INFO - app - Redis initialized
2025-07-10 03:49:43,915 - INFO - app - Scheduler initialized
2025-07-10 03:49:43,918 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:49:43,919 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 03:49:45,127 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 03:49:45,128 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:49:49,207 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 03:49:49,207 - INFO - app - Background tasks initialized
2025-07-10 03:49:49,840 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 03:49:49,840 - INFO - app - Application startup completed successfully
2025-07-10 03:49:49,840 - INFO - app - Starting cache validation task
2025-07-10 03:49:49,859 - INFO - app - Validating cache for 10 users
2025-07-10 03:49:51,867 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:49:53,931 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 03:49:53,934 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:49:55,983 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:49:58,031 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:50:00,103 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:50:00,111 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:50:00,112 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 03:50:00,113 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:50:00,113 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:50:02,152 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 03:50:04,850 - INFO - app - Starting stale cache cleanup task
2025-07-10 03:50:06,205 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 03:50:06,208 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 03:50:06,210 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 03:50:06,211 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:50:06,212 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 03:50:06,216 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 03:50:08,244 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 03:50:08,246 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 03:50:08,249 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 03:50:08,249 - INFO - app - Completed stale cache cleanup task
2025-07-10 03:50:08,255 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 03:50:08,262 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 03:50:08,287 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 03:50:08,295 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 03:50:08,302 - INFO - app - Cache validation completed
2025-07-10 03:50:09,160 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:50:09,161 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 03:50:09,339 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:50:09,339 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 03:50:09,351 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:50:09,352 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:50:09,352 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 03:50:09,352 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 03:50:44,335 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 03:50:44,359 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 03:50:44,723 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 03:50:44,724 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 03:50:44,733 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 03:51:41,816 - INFO - app - Application shutdown initiated
2025-07-10 03:51:41,816 - INFO - app - Scheduler shutdown completed
2025-07-10 03:51:41,976 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 03:51:42,495 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 03:51:42,495 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 03:51:42,499 - INFO - app - Redis connection closed
2025-07-10 03:51:42,499 - INFO - app - Application shutdown completed
2025-07-10 04:04:58,529 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 04:04:58,552 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 04:04:58,561 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 04:04:58,561 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 04:04:59,051 - INFO - app - Application starting up - Trading system initialized
2025-07-10 04:04:59,051 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 04:04:59,051 - INFO - app - Environment: PRODUCTION
2025-07-10 04:04:59,100 - INFO - app - Application startup initiated
2025-07-10 04:04:59,100 - INFO - app - Initializing core services...
2025-07-10 04:04:59,135 - INFO - app - Firebase initialized
2025-07-10 04:04:59,135 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 04:05:01,166 - INFO - app - Redis initialized
2025-07-10 04:05:01,175 - INFO - app - Scheduler initialized
2025-07-10 04:05:01,178 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 04:05:01,180 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 04:05:02,312 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 04:05:02,324 - INFO - app - Starting stale cache cleanup task
2025-07-10 04:05:06,421 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 04:05:06,421 - INFO - app - Background tasks initialized
2025-07-10 04:05:07,123 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 04:05:07,123 - INFO - app - Application startup completed successfully
2025-07-10 04:05:07,123 - INFO - app - Starting cache validation task
2025-07-10 04:05:07,146 - INFO - app - Validating cache for 10 users
2025-07-10 04:05:09,166 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 04:05:11,235 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 04:05:11,236 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 04:05:13,276 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 04:05:15,322 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 04:05:15,333 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 04:05:15,340 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 04:05:15,341 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 04:05:15,345 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 04:05:15,346 - INFO - app - Completed stale cache cleanup task
2025-07-10 04:05:15,361 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 04:05:17,394 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 04:05:17,402 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 04:05:19,448 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 04:05:19,469 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 04:05:20,320 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 04:05:20,334 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 04:05:20,519 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 04:05:20,534 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 04:05:20,534 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 04:05:20,541 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 04:05:20,562 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 04:05:20,562 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 04:05:21,560 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 04:05:22,139 - INFO - app - Starting stale cache cleanup task
2025-07-10 04:05:23,622 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 04:05:23,625 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 04:05:23,625 - INFO - app - Cache validation completed
2025-07-10 04:05:23,627 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 04:05:23,629 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 04:05:23,635 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 04:05:23,639 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 04:05:23,640 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 04:05:23,640 - INFO - app - Completed stale cache cleanup task
2025-07-10 04:06:01,606 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:06:01,628 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:06:02,012 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:06:02,017 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:06:02,035 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:07:01,617 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:07:01,636 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:07:02,014 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:07:02,017 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:07:02,033 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:08:01,611 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:08:01,621 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:08:02,016 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:08:02,017 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:08:02,024 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:09:01,527 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:09:01,545 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:09:01,918 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:09:01,919 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:09:01,925 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:10:02,123 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:10:02,150 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:10:02,680 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:10:02,692 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:10:02,719 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:10:23,630 - INFO - app - Starting cache validation task
2025-07-10 04:10:23,634 - INFO - app - Validating cache for 10 users
2025-07-10 04:10:23,635 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 04:10:23,646 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 04:10:23,655 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 04:10:23,662 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 04:10:23,666 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 04:10:23,673 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 04:10:23,681 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 04:10:23,688 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 04:10:23,695 - INFO - app - Cache validation completed
2025-07-10 04:11:01,523 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:11:01,531 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:11:01,932 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:11:01,935 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:11:01,941 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:12:01,542 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:12:01,550 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:12:01,940 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:12:01,943 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:12:01,951 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:13:01,575 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:13:01,597 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:13:02,060 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:13:02,064 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:13:02,083 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:14:01,653 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:14:01,662 - WARNING - app - No user data found for user 10 (live). Skipping portfolio update.
2025-07-10 04:14:02,056 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:14:02,058 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:14:02,072 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:15:01,555 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:15:01,562 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:15:01,950 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:15:01,952 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:15:01,959 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:15:23,645 - INFO - app - Starting stale cache cleanup task
2025-07-10 04:15:23,646 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 04:15:23,647 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 04:15:23,647 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 04:15:23,648 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 04:15:23,650 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 04:15:23,651 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 04:15:23,652 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 04:15:23,652 - INFO - app - Completed stale cache cleanup task
2025-07-10 04:15:23,710 - INFO - app - Starting cache validation task
2025-07-10 04:15:23,714 - INFO - app - Validating cache for 10 users
2025-07-10 04:15:23,715 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 04:15:23,721 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 04:15:23,726 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 04:15:23,729 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 04:15:23,731 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 04:15:23,735 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 04:15:23,738 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 04:15:23,742 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 04:15:23,744 - INFO - app - Cache validation completed
2025-07-10 04:16:01,552 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:16:01,559 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:16:01,870 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:16:01,872 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:16:01,878 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:17:01,669 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:17:01,694 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:17:02,429 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:17:02,433 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:17:02,450 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:18:01,562 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:18:01,583 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:18:02,382 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:18:02,384 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:18:02,402 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:19:01,579 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:19:01,590 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:19:01,973 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:19:01,974 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:19:01,980 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:19:54,736 - INFO - app - Application shutdown initiated
2025-07-10 04:19:54,736 - INFO - app - Scheduler shutdown completed
2025-07-10 04:19:54,736 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 04:19:56,058 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 04:19:56,058 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 04:19:56,062 - INFO - app - Redis connection closed
2025-07-10 04:19:56,062 - INFO - app - Application shutdown completed
2025-07-10 04:28:30,303 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 04:28:30,343 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 04:28:30,358 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 04:28:30,358 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 04:28:30,836 - INFO - app - Application starting up - Trading system initialized
2025-07-10 04:28:30,836 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-10 04:28:30,836 - INFO - app - Environment: PRODUCTION
2025-07-10 04:28:30,889 - INFO - app - Application startup initiated
2025-07-10 04:28:30,889 - INFO - app - Initializing core services...
2025-07-10 04:28:30,922 - INFO - app - Firebase initialized
2025-07-10 04:28:30,922 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-10 04:28:32,969 - INFO - app - Redis initialized
2025-07-10 04:28:32,978 - INFO - app - Scheduler initialized
2025-07-10 04:28:32,981 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 04:28:32,982 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-10 04:28:34,175 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-10 04:28:34,197 - INFO - app - Starting stale cache cleanup task
2025-07-10 04:28:38,308 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-10 04:28:38,309 - INFO - app - Background tasks initialized
2025-07-10 04:28:39,088 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-10 04:28:39,088 - INFO - app - Application startup completed successfully
2025-07-10 04:28:39,089 - INFO - app - Starting cache validation task
2025-07-10 04:28:39,114 - INFO - app - Validating cache for 10 users
2025-07-10 04:28:41,157 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 04:28:43,181 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-10 04:28:43,182 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 04:28:45,221 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 04:28:47,281 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 04:28:47,293 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 04:28:47,299 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 04:28:47,301 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-10 04:28:47,302 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 04:28:47,302 - INFO - app - Completed stale cache cleanup task
2025-07-10 04:28:49,364 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-10 04:28:49,378 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-10 04:28:49,381 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-10 04:28:50,280 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 04:28:50,284 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-10 04:28:50,416 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 04:28:50,426 - INFO - app.core.config - .env file loaded successfully.
2025-07-10 04:28:50,428 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 04:28:50,428 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 04:28:50,439 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-10 04:28:50,439 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-10 04:28:53,495 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-10 04:28:53,502 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-10 04:28:53,514 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-10 04:28:53,523 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-10 04:28:53,529 - INFO - app - Cache validation completed
2025-07-10 04:28:54,090 - INFO - app - Starting stale cache cleanup task
2025-07-10 04:28:54,093 - INFO - app - Found 8 static orders cache entries to check
2025-07-10 04:28:54,096 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-10 04:28:54,097 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-10 04:28:54,098 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-10 04:28:54,099 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-10 04:28:54,100 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-10 04:28:54,101 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-10 04:28:54,102 - INFO - app - Completed stale cache cleanup task
2025-07-10 04:29:33,474 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:29:33,484 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:29:33,879 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:29:33,884 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:29:33,903 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:30:33,394 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:30:33,416 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:30:33,793 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:30:33,797 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:30:33,819 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:31:00,017 - INFO - app - Executing daily swap charge job...
2025-07-10 04:31:00,017 - INFO - app.services.swap_service - Starting daily swap charge application process.
2025-07-10 04:31:00,028 - ERROR - app.services.swap_service - General failure to process swap for order 5239114834: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,055 - ERROR - app.services.swap_service - General failure to process swap for order 6253049859: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,059 - ERROR - app.services.swap_service - General failure to process swap for order 5338478143: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,061 - ERROR - app.services.swap_service - General failure to process swap for order 9836469641: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,064 - ERROR - app.services.swap_service - General failure to process swap for order 7660709467: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,067 - ERROR - app.services.swap_service - General failure to process swap for order 3649865209: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,071 - ERROR - app.services.swap_service - General failure to process swap for order 5320207948: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,074 - ERROR - app.services.swap_service - General failure to process swap for order 1621588803: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,077 - ERROR - app.services.swap_service - General failure to process swap for order 1998792779: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,079 - ERROR - app.services.swap_service - General failure to process swap for order 4622005675: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,083 - ERROR - app.services.swap_service - General failure to process swap for order 3823359110: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,086 - ERROR - app.services.swap_service - General failure to process swap for order 5925796279: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,088 - ERROR - app.services.swap_service - General failure to process swap for order 8872241214: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,091 - ERROR - app.services.swap_service - General failure to process swap for order 9192797404: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,094 - ERROR - app.services.swap_service - General failure to process swap for order 3048844884: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,097 - ERROR - app.services.swap_service - General failure to process swap for order 9605988963: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,100 - ERROR - app.services.swap_service - General failure to process swap for order 6866600215: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,102 - ERROR - app.services.swap_service - General failure to process swap for order 9990382230: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\swap_service.py", line 36, in apply_daily_swap_charges_for_all_open_orders
    user = order.user
           ^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<3 lines>...
        execution_options=execution_options,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1817, in _execute_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str(statement), parameters, None, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1811, in _execute_context
    context = constructor(
        dialect, self, conn, execution_options, *args, **kw
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1427, in _init_compiled
    self.cursor = self.create_cursor()
                  ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1766, in create_cursor
    return self.create_default_cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 1772, in create_default_cursor
    return self._dbapi_connection.cursor()
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1486, in cursor
    return self.dbapi_connection.cursor(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 200, in cursor
    return AsyncAdapt_aiomysql_cursor(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 63, in __init__
    self._cursor = self.await_(cursor.__aenter__())
                   ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.StatementError: (sqlalchemy.exc.MissingGreenlet) greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?
[SQL: SELECT users.id AS users_id, users.name AS users_name, users.email AS users_email, users.phone_number AS users_phone_number, users.hashed_password AS users_hashed_password, users.user_type AS users_user_type, users.wallet_balance AS users_wallet_balance, users.leverage AS users_leverage, users.margin AS users_margin, users.net_profit AS users_net_profit, users.account_number AS users_account_number, users.group_name AS users_group_name, users.status AS users_status, users.security_question AS users_security_question, users.security_answer AS users_security_answer, users.country AS users_country, users.city AS users_city, users.state AS users_state, users.pincode AS users_pincode, users.fund_manager AS users_fund_manager, users.is_self_trading AS users_is_self_trading, users.id_proof AS users_id_proof, users.id_proof_image AS users_id_proof_image, users.address_proof AS users_address_proof, users.address_proof_image AS users_address_proof_image, users.bank_ifsc_code AS users_bank_ifsc_code, users.bank_holder_name AS users_bank_holder_name, users.bank_branch_name AS users_bank_branch_name, users.bank_account_number AS users_bank_account_number, users.`isActive` AS `users_isActive`, users.referred_by_id AS users_referred_by_id, users.reffered_code AS users_reffered_code, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = %s]
[parameters: [{'pk_1': 4}]]
(Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-07-10 04:31:00,106 - INFO - app.services.swap_service - Daily swap charges committed to DB. Processed: 0, Failed: 18.
2025-07-10 04:31:00,106 - INFO - app - Daily swap charge job completed successfully
2025-07-10 04:31:33,386 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:31:33,395 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:31:33,784 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:31:33,787 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:31:33,794 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:32:33,388 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-10 04:32:33,397 - WARNING - app - No user data found for user 11 (live). Skipping portfolio update.
2025-07-10 04:32:33,791 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-10 04:32:33,795 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-10 04:32:33,802 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-10 04:32:42,054 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 1
2025-07-10 04:32:42,054 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 1
2025-07-10 04:32:42,058 - WARNING - app.api.v1.endpoints.users - Refresh token valid, but user ID 1 not found or inactive.
2025-07-10 04:32:42,058 - INFO - app.api.v1.endpoints.users - Invalidated refresh token for invalid user ID 1.
2025-07-10 04:32:42,058 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: User not found or inactive
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 331, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive
2025-07-10 04:33:27,236 - INFO - app - Application shutdown initiated
2025-07-10 04:33:27,236 - INFO - app - Scheduler shutdown completed
2025-07-10 04:33:27,487 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-10 04:33:27,684 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-10 04:33:27,685 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-10 04:33:27,687 - INFO - app - Redis connection closed
2025-07-10 04:33:27,688 - INFO - app - Application shutdown completed
