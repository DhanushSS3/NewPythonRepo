2025-07-30 21:46:47,233 - INFO - orders - Order close request received - Order ID: 1428-001, User ID: 31, Close Price: 0.999915
2025-07-30 21:46:47,233 - INFO - orders - Request to close order 1428-001 for user 31 (user_type: live) with price 0.999915. Frontend provided type: BUY, company: AUDSGD, status: CLOSED, frontend_status: CLOSED.
2025-07-30 21:46:47,255 - INFO - orders - User group: VIP, sending_orders setting: barclays
2025-07-30 21:46:47,255 - INFO - orders - Live user 31 from group 'VIP' has 'sending_orders' set to 'barclays'. Pushing close request to Firebase and skipping local DB update.
2025-07-30 21:46:47,257 - INFO - orders - db_order_for_firebase: 2025-07-30 21:45:51
2025-07-30 21:46:47,257 - INFO - orders - [FIREBASE_CLOSE_REQUEST] Preparing to send payload for user-initiated close: {'order_id': '1428-001', 'close_price': '0.999915', 'user_id': 31, 'order_type': 'BUY', 'order_company_name': 'AUDSGD', 'order_quantity': '0.01000000', 'contract_value': '1000.00000000', 'order_status': 'CLOSED', 'status': 'CLOSED', 'action': 'close_order', 'close_id': '1434-003'}
2025-07-30 21:47:07,128 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-30 21:47:07,128 - INFO - orders - Using order model: UserOrder
2025-07-30 21:47:07,133 - INFO - orders - Fetched 3 open orders for user 14
2025-07-30 21:47:07,138 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-30 21:47:07,141 - INFO - orders - Updated static orders cache for user 14 with 3 open orders and 0 pending orders
2025-07-30 21:47:07,146 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 14, Symbol BTCUSD
2025-07-30 21:47:07,146 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-30 21:47:07,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol BTCUSD: AllMarginsPerLot=[Decimal('23556.825')], HighestMarginPerLot=23556.825
2025-07-30 21:47:07,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol BTCUSD: CalculatedTotalMargin=9422.73
2025-07-30 21:47:07,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 14, Symbol AUDJPY
2025-07-30 21:47:07,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: TotalBuyQty=0.11000000, TotalSellQty=0, NetQty=0.11000000, IsHedged=False
2025-07-30 21:47:07,149 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 14, Symbol AUDJPY: AllMarginsPerLot=[Decimal('652.1517371'), Decimal('652.134765')], HighestMarginPerLot=652.1517371
2025-07-30 21:47:07,149 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 14, Symbol AUDJPY: CalculatedTotalMargin=71.74
2025-07-30 21:47:07,149 - INFO - orders - [TOTAL_USER_MARGIN] User 14 total margin across all symbols: 9494.47
2025-07-30 21:47:07,166 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=9902.02000000, margin=9494.47
2025-07-30 21:47:08,827 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-30 21:47:08,838 - INFO - orders - Using order model: UserOrder
2025-07-30 21:47:08,860 - INFO - orders - Fetched 1 open orders for user 25
2025-07-30 21:47:08,884 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-30 21:47:08,899 - INFO - orders - Updated static orders cache for user 25 with 1 open orders and 0 pending orders
2025-07-30 21:47:08,907 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 25, Symbol BTCUSD
2025-07-30 21:47:08,907 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: TotalBuyQty=0.10000000, TotalSellQty=0, NetQty=0.10000000, IsHedged=False
2025-07-30 21:47:08,908 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 25, Symbol BTCUSD: AllMarginsPerLot=[Decimal('59366.2')], HighestMarginPerLot=59366.2
2025-07-30 21:47:08,908 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 25, Symbol BTCUSD: CalculatedTotalMargin=5936.62
2025-07-30 21:47:08,908 - INFO - orders - [TOTAL_USER_MARGIN] User 25 total margin across all symbols: 5936.62
2025-07-30 21:47:08,918 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=6389.62000000, margin=5936.62
2025-07-30 21:47:17,758 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-30 21:47:19,309 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-30 21:47:19,309 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-30 21:47:19,309 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-30 21:47:19,309 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-30 21:47:19,376 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-30 21:47:19,376 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
