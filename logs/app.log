2025-07-22 03:19:54,675 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:54,708 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:54,718 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:54,719 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:54,997 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:19:54,997 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:19:54,997 - INFO - app - Environment: PRODUCTION
2025-07-22 03:19:55,062 - INFO - app - Application startup initiated
2025-07-22 03:19:55,062 - INFO - app - Initializing core services...
2025-07-22 03:19:55,098 - INFO - app - Firebase initialized
2025-07-22 03:19:55,098 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:19:55,119 - INFO - app - Redis initialized
2025-07-22 03:19:55,986 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:19:55,989 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:19:55,992 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:19:55,992 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:19:55,992 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:19:55,993 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:19:55,993 - INFO - app - Scheduler initialized
2025-07-22 03:19:55,994 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:19:55,995 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:19:56,898 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:19:56,917 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:19:56,956 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:19:56,956 - INFO - app - Background tasks initialized
2025-07-22 03:19:56,956 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:19:57,571 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:19:57,571 - INFO - app - Application startup completed successfully
2025-07-22 03:19:57,572 - INFO - app - Starting cache validation task
2025-07-22 03:19:57,575 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:19:57,578 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:19:57,580 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:19:57,580 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:19:57,580 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:19:57,580 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:19:57,581 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:19:57,620 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 03:19:57,634 - INFO - app - Validating cache for 30 users
2025-07-22 03:19:57,636 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:19:57,636 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:19:57,636 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:19:57,640 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:19:57,652 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:19:57,652 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:19:57,655 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:19:57,659 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:19:57,661 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:19:57,665 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:19:57,666 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:19:57,670 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:19:57,671 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:19:57,673 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:19:57,675 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:19:57,675 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:19:57,675 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:19:57,676 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:19:57,677 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:19:57,679 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:19:57,680 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:19:57,681 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:19:57,684 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:19:57,686 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:19:57,688 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:19:57,691 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:19:57,693 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:19:57,695 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:19:57,695 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:19:57,716 - WARNING - app - User 4: Missing static orders cache, refreshing...
2025-07-22 03:19:57,744 - INFO - app - Cache validation completed
2025-07-22 03:19:57,857 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:19:58,146 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:19:58,148 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:19:58,149 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:19:58,150 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:19:58,151 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3495200000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3495200000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3495100000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3495100000'}], 'margin_call': False}
2025-07-22 03:19:58,152 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:19:58,153 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:19:58,153 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:19:58,176 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,176 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:19:58,194 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,194 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:19:58,216 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,216 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:19:58,436 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:19:58,744 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.975377872009417860507462418% which is below threshold 100.0%
2025-07-22 03:19:58,745 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '187.551659444572575940522867', 'margin': '9494.47', 'free_margin': '-9306.918340555427424059477133', 'profit_loss': '-9714.468340555427424059477133', 'margin_level': '1.975377872009417860507462418', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9639.646000000000000000000000', 'current_price': '118398.3100000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.02030959584311278134284823', 'current_price': '96.1090000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.802030959584311278134284823', 'current_price': '96.1090000000'}], 'margin_call': True}
2025-07-22 03:19:58,746 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 1.975377872009417860507462418
2025-07-22 03:19:58,777 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:19:58,777 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:19:58,799 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,799 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:19:58,822 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,822 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:19:58,845 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,845 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:19:58,869 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,870 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:19:58,891 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,891 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:19:58,917 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,917 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:19:58,940 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,940 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:19:58,963 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:19:58,963 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:19:59,131 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:19:59,318 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,325 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,334 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,337 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,345 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,350 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:19:59,422 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.488281210520464506739525184% which is below threshold 100.0%
2025-07-22 03:19:59,423 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '207.086000000000000000000000', 'margin': '5936.62', 'free_margin': '-5729.534000000000000000000000', 'profit_loss': '-6182.534000000000000000000000', 'margin_level': '3.488281210520464506739525184', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6182.534000000000000000000000', 'current_price': '118398.3100000000'}], 'margin_call': True}
2025-07-22 03:19:59,425 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.488281210520464506739525184
2025-07-22 03:19:59,484 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:19:59,484 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:19:59,645 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,649 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,662 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,663 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,670 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,674 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,674 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,679 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,679 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,682 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,682 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,682 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,683 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,683 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,686 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:19:59,692 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,692 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,702 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,703 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,705 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:19:59,705 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:19:59,709 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:20:00,005 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.18220709676595751071768905% which is below threshold 100.0%
2025-07-22 03:20:00,005 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98411.50000000000000000000000', 'margin': '146484.47', 'free_margin': '-48072.97000000000000000000000', 'profit_loss': '-85934.31000000000000000000000', 'margin_level': '67.18220709676595751071768905', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.1500000000000000000000000', 'current_price': '38.8770000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85823.16000000000000000000000', 'current_price': '118398.3100000000'}], 'margin_call': True}
2025-07-22 03:20:00,008 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.18220709676595751071768905
2025-07-22 03:20:00,009 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:20:00,009 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:20:00,031 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:00,031 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:20:00,049 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:00,049 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:20:00,067 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:00,067 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:20:00,068 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:00,068 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:20:00,073 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:20:00,074 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:20:00,075 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:20:00,089 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:00,090 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:20:00,090 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:00,090 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:20:00,091 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:00,091 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:20:00,186 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:20:00,186 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:20:00,617 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:20:00,619 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:20:00,620 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:20:00,620 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:20:00,690 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:20:00,691 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:20:00,979 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:20:00,981 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:20:00,982 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:20:00,982 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:20:01,057 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:20:01,057 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:20:01,399 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:20:01,410 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:20:01,410 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:20:01,411 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:20:01,451 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:01,451 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:20:01,480 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:12,572 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:20:12,573 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:20:12,574 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:20:12,575 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:20:12,576 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:20:12,578 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:20:12,580 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:20:12,581 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:20:12,585 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:20:12,586 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:20:12,587 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:20:12,588 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:20:12,589 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:20:12,592 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:20:12,595 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:20:12,596 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:20:12,598 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:20:12,599 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:20:12,601 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:20:12,601 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:20:12,604 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:20:12,606 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:20:12,609 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:20:12,610 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:20:31,492 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:20:31,493 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:20:31,493 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:20:31,493 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:20:31,498 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:20:31,498 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:20:31,498 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:20:31,502 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:20:31,502 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:20:31,511 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:20:31,513 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:20:31,513 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:20:31,563 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:20:31,861 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:20:31,868 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:20:31,873 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:20:31,877 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:20:31,877 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349515'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349515'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3493549999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3493549999999999'}], 'margin_call': False}
2025-07-22 03:20:31,881 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:20:31,883 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:20:31,883 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:20:31,935 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:31,935 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:20:31,960 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:31,960 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:20:31,976 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:31,976 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:20:32,025 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:20:32,323 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.829940466700691002462017985% which is below threshold 100.0%
2025-07-22 03:20:32,323 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '173.743148628757097021455559', 'margin': '9494.47', 'free_margin': '-9320.726851371242902978544441', 'profit_loss': '-9728.276851371242902978544441', 'margin_level': '1.829940466700691002462017985', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9652.486000000000000000000000', 'current_price': '118366.21'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.90077397385718452594949159', 'current_price': '96.096'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.890077397385718452594949159', 'current_price': '96.096'}], 'margin_call': True}
2025-07-22 03:20:32,325 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 1.829940466700691002462017985
2025-07-22 03:20:32,362 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:20:32,363 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:20:32,387 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,387 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:20:32,409 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,409 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:20:32,429 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,430 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:20:32,449 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,449 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:20:32,469 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,469 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:20:32,491 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,491 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:20:32,514 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,515 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:20:32,543 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:32,543 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:20:32,652 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:20:32,978 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.434210038708894960432030347% which is below threshold 100.0%
2025-07-22 03:20:32,979 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '203.876000000000000000000000', 'margin': '5936.62', 'free_margin': '-5732.744000000000000000000000', 'profit_loss': '-6185.744000000000000000000000', 'margin_level': '3.434210038708894960432030347', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6185.744000000000000000000000', 'current_price': '118366.21'}], 'margin_call': True}
2025-07-22 03:20:32,982 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.434210038708894960432030347
2025-07-22 03:20:33,012 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:20:33,012 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:20:33,105 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:20:33,398 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.05029891564614323962123766% which is below threshold 100.0%
2025-07-22 03:20:33,398 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98218.27500000000000000000000', 'margin': '146484.47', 'free_margin': '-48266.19500000000000000000000', 'profit_loss': '-86127.53500000000000000000000', 'margin_level': '67.05029891564614323962123766', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.775000000000000000000000', 'current_price': '38.8645'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-86015.76000000000000000000000', 'current_price': '118366.21'}], 'margin_call': True}
2025-07-22 03:20:33,403 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.05029891564614323962123766
2025-07-22 03:20:33,405 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:20:33,405 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:20:33,433 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:33,433 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:20:33,464 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:33,464 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:20:33,496 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:33,496 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:20:33,496 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:33,497 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:20:33,512 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:20:33,515 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:20:33,515 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:20:33,541 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:33,542 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:20:33,544 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:33,544 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:20:33,546 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:20:33,546 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:20:33,663 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:20:33,663 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:20:33,956 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:20:33,958 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:20:33,960 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:20:33,960 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:20:34,049 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:20:34,050 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:20:34,345 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:20:34,347 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:20:34,347 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:20:34,347 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:20:34,461 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:20:34,462 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:20:34,751 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:20:34,752 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:20:34,752 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:20:34,752 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:20:34,785 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:34,785 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:20:34,809 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:20:56,006 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:20:56,314 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:21:04,810 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:21:04,810 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:21:04,811 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:21:04,811 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:21:04,819 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:21:04,819 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:21:04,819 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:21:04,823 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:21:04,823 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:21:04,834 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:21:04,838 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:21:04,838 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:21:04,965 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:21:05,300 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:05,304 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:05,306 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:05,309 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:05,309 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349405'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349405'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349245'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349245'}], 'margin_call': False}
2025-07-22 03:21:05,311 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:21:05,312 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:21:05,312 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:21:05,342 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:05,342 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:21:05,379 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:05,379 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:21:05,446 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:05,446 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:21:05,569 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:21:05,916 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.164435124579711248888885267% which is below threshold 100.0%
2025-07-22 03:21:05,916 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '205.501643572683310612380545', 'margin': '9494.47', 'free_margin': '-9288.968356427316689387619455', 'profit_loss': '-9696.518356427316689387619455', 'margin_level': '2.164435124579711248888885267', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9620.290000000000000000000000', 'current_price': '118446.7'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.29850584301517217056314051', 'current_price': '96.09'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.929850584301517217056314051', 'current_price': '96.09'}], 'margin_call': True}
2025-07-22 03:21:05,921 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.164435124579711248888885267
2025-07-22 03:21:05,960 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:21:05,960 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:21:06,013 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,014 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:21:06,052 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,053 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:21:06,095 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,095 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:21:06,130 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,130 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:21:06,160 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,161 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:21:06,192 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,192 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:21:06,226 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,226 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:21:06,261 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:06,261 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:21:06,375 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:21:06,732 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.569792238681269813462879551% which is below threshold 100.0%
2025-07-22 03:21:06,733 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '211.925000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.695000000000000000000000', 'profit_loss': '-6177.695000000000000000000000', 'margin_level': '3.569792238681269813462879551', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.695000000000000000000000', 'current_price': '118446.7'}], 'margin_call': True}
2025-07-22 03:21:06,735 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.569792238681269813462879551
2025-07-22 03:21:06,833 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:21:06,833 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:21:07,764 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:21:08,166 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.38036120825641090144231672% which is below threshold 100.0%
2025-07-22 03:21:08,166 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98701.76499999999975000000000', 'margin': '146484.47', 'free_margin': '-47782.70500000000025000000000', 'profit_loss': '-85644.04500000000025000000000', 'margin_level': '67.38036120825641090144231672', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.2250000000002500000000000', 'current_price': '38.875499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85532.82000000000000000000000', 'current_price': '118446.7'}], 'margin_call': True}
2025-07-22 03:21:08,169 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.38036120825641090144231672
2025-07-22 03:21:08,172 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:21:08,172 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:21:08,230 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:08,230 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:21:08,340 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:08,340 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:21:08,424 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:08,424 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:21:08,430 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:08,430 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:21:08,446 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:21:08,450 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:21:08,451 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:21:08,521 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:08,521 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:21:08,523 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:08,524 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:21:08,526 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:08,526 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:21:08,747 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:21:08,749 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:21:09,100 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:21:09,132 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:21:09,139 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:21:09,139 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:21:09,437 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:21:09,440 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:21:09,806 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:21:09,810 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:21:09,810 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:21:09,811 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:21:09,924 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:21:09,926 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:21:10,317 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:21:10,320 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:21:10,320 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:21:10,320 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:21:10,385 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:10,385 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:21:10,449 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:24,205 - INFO - app - Application shutdown initiated
2025-07-22 03:21:24,206 - INFO - app - Scheduler shutdown completed
2025-07-22 03:21:24,583 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 03:21:25,282 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 03:21:25,282 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 03:21:25,287 - INFO - app - Redis connection closed
2025-07-22 03:21:25,288 - INFO - app - Application shutdown completed
2025-07-22 03:21:27,087 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:27,119 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:27,130 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:27,130 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:43,111 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:43,168 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:43,182 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:43,182 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:53,013 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:53,033 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:53,046 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:53,046 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:53,452 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:21:53,452 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:21:53,452 - INFO - app - Environment: PRODUCTION
2025-07-22 03:21:53,495 - INFO - app - Application startup initiated
2025-07-22 03:21:53,495 - INFO - app - Initializing core services...
2025-07-22 03:21:53,528 - INFO - app - Firebase initialized
2025-07-22 03:21:53,528 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:21:53,549 - INFO - app - Redis initialized
2025-07-22 03:21:54,039 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:21:54,042 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:21:54,045 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:21:54,045 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:21:54,045 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:21:54,046 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:21:54,046 - INFO - app - Scheduler initialized
2025-07-22 03:21:54,047 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:21:54,047 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:21:55,178 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:21:55,187 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:21:55,223 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:21:55,223 - INFO - app - Background tasks initialized
2025-07-22 03:21:55,223 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:21:55,880 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:21:55,880 - INFO - app - Application startup completed successfully
2025-07-22 03:21:55,881 - INFO - app - Starting cache validation task
2025-07-22 03:21:55,885 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:21:55,887 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:21:55,890 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:21:55,890 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:21:55,890 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:21:55,890 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:21:55,890 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:21:55,922 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:21:55,930 - INFO - app - Validating cache for 30 users
2025-07-22 03:21:55,932 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:21:55,932 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:21:55,932 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:21:55,939 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:21:55,951 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:21:55,954 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:21:55,954 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:21:55,961 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:21:55,965 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:21:55,969 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:21:55,970 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:21:55,973 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:21:55,974 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:21:55,977 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:21:55,978 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:21:55,978 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:21:55,979 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:21:55,981 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:21:55,982 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:21:55,984 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:21:55,985 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:21:55,986 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:21:55,990 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:21:55,991 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:21:55,993 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:21:55,994 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:21:55,997 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:21:56,000 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:21:56,002 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:21:56,003 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:21:56,042 - INFO - app - Cache validation completed
2025-07-22 03:21:56,199 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:21:56,524 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:56,529 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:56,535 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:56,540 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:21:56,540 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3492300000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3492300000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3492200000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3492200000'}], 'margin_call': False}
2025-07-22 03:21:56,544 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:21:56,549 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:21:56,549 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:21:56,604 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:56,605 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:21:56,673 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:56,673 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:21:56,752 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:56,752 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:21:57,095 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:21:57,401 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.388489886720491912708953981% which is below threshold 100.0%
2025-07-22 03:21:57,402 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '226.774455747711088504577823', 'margin': '9494.47', 'free_margin': '-9267.695544252288911495422177', 'profit_loss': '-9675.245544252288911495422177', 'margin_level': '2.388489886720491912708953981', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9600.290000000000000000000000', 'current_price': '118496.7000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.14140386571719226856561546', 'current_price': '96.1070000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.814140386571719226856561546', 'current_price': '96.1070000000'}], 'margin_call': True}
2025-07-22 03:21:57,407 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.388489886720491912708953981
2025-07-22 03:21:57,433 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:21:57,433 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:21:57,457 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,457 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:21:57,481 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,481 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:21:57,503 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,503 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:21:57,530 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,530 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:21:57,555 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,561 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:21:57,587 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,587 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:21:57,612 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,613 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:21:57,637 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:57,637 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:21:57,777 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:21:57,976 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:57,983 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,004 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,008 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,016 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,018 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,078 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.654015247733558826402902662% which is below threshold 100.0%
2025-07-22 03:21:58,079 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '216.925000000000000000000000', 'margin': '5936.62', 'free_margin': '-5719.695000000000000000000000', 'profit_loss': '-6172.695000000000000000000000', 'margin_level': '3.654015247733558826402902662', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6172.695000000000000000000000', 'current_price': '118496.7000000000'}], 'margin_call': True}
2025-07-22 03:21:58,082 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.654015247733558826402902662
2025-07-22 03:21:58,093 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:21:58,126 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:21:58,126 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:21:58,335 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,336 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,361 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,361 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,367 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,367 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,369 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,372 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,380 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,385 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,395 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,396 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,396 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,396 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,403 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,403 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,404 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,404 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,438 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:21:58,449 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:21:58,459 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:21:58,459 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:21:58,746 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.58551947520443634741621416% which is below threshold 100.0%
2025-07-22 03:21:58,746 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '99002.29000000000000000000000', 'margin': '146484.47', 'free_margin': '-47482.18000000000000000000000', 'profit_loss': '-85343.52000000000000000000000', 'margin_level': '67.58551947520443634741621416', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.7000000000000000000000000', 'current_price': '38.8860000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85232.82000000000000000000000', 'current_price': '118496.7000000000'}], 'margin_call': True}
2025-07-22 03:21:58,749 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.58551947520443634741621416
2025-07-22 03:21:58,750 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:21:58,750 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:21:58,767 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:58,768 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:21:58,780 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:58,780 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:21:58,800 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:58,800 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:21:58,801 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:58,801 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:21:58,807 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:21:58,809 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:21:58,809 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:21:58,824 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:21:58,825 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:21:58,825 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:58,825 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:21:58,826 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:21:58,826 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:21:58,998 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:21:58,999 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:22:00,116 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:22:00,122 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:22:00,123 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:22:00,123 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:22:00,209 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:22:00,210 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:22:00,592 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:22:00,595 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:22:00,595 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:22:00,595 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:22:00,656 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:22:00,657 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:22:01,002 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:22:01,006 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:22:01,006 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:22:01,006 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:22:01,028 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:01,028 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:22:01,047 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:10,891 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:22:10,893 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:22:10,895 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:22:10,898 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:22:10,900 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:22:10,901 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:22:10,905 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:22:10,906 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:22:10,908 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:22:10,910 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:22:10,912 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:22:10,913 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:22:10,914 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:22:10,915 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:22:10,917 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:22:10,918 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:22:10,919 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:22:10,921 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:22:10,921 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:22:10,922 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:22:10,924 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:22:10,925 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:22:10,926 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:22:10,926 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:22:31,059 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:22:31,059 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:22:31,059 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:22:31,060 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:22:31,069 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:22:31,069 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:22:31,070 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:22:31,077 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:22:31,078 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:22:31,094 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:22:31,098 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:22:31,098 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:22:31,272 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:22:31,623 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:22:31,626 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:22:31,630 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:22:31,633 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:22:31,633 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349385'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349385'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349225'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349225'}], 'margin_call': False}
2025-07-22 03:22:31,636 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:22:31,637 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:22:31,638 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:22:31,683 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:31,684 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:22:31,759 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:31,759 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:22:31,826 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:31,826 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:22:32,026 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:22:32,351 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.172279193760198641318617816% which is below threshold 100.0%
2025-07-22 03:22:32,351 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '206.246396367803931940403773', 'margin': '9494.47', 'free_margin': '-9288.223603632196068059596227', 'profit_loss': '-9695.773603632196068059596227', 'margin_level': '2.172279193760198641318617816', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9620.002000000000000000000000', 'current_price': '118447.42'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.88327602926915278145111523', 'current_price': '96.096'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.888327602926915278145111523', 'current_price': '96.096'}], 'margin_call': True}
2025-07-22 03:22:32,352 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.172279193760198641318617816
2025-07-22 03:22:32,390 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:22:32,390 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:22:32,449 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,449 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:22:32,493 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,493 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:22:32,555 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,555 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:22:32,637 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,637 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:22:32,671 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,671 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:22:32,685 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,685 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:22:32,699 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,699 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:22:32,713 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:32,713 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:22:32,771 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:22:33,071 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.571005050011622775249215884% which is below threshold 100.0%
2025-07-22 03:22:33,071 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '211.997000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.623000000000000000000000', 'profit_loss': '-6177.623000000000000000000000', 'margin_level': '3.571005050011622775249215884', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.623000000000000000000000', 'current_price': '118447.42'}], 'margin_call': True}
2025-07-22 03:22:33,074 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.571005050011622775249215884
2025-07-22 03:22:33,118 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:22:33,119 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:22:33,195 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:22:33,497 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.38320792641021928809245103% which is below threshold 100.0%
2025-07-22 03:22:33,498 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98705.93499999999975000000000', 'margin': '146484.47', 'free_margin': '-47778.53500000000025000000000', 'profit_loss': '-85639.87500000000025000000000', 'margin_level': '67.38320792641021928809245103', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.3750000000002500000000000', 'current_price': '38.872499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85528.50000000000000000000000', 'current_price': '118447.42'}], 'margin_call': True}
2025-07-22 03:22:33,502 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.38320792641021928809245103
2025-07-22 03:22:33,504 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:22:33,504 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:22:33,539 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:33,539 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:22:33,572 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:33,572 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:22:33,607 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:33,607 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:22:33,608 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:22:33,609 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:22:33,620 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:22:33,622 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:22:33,623 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:22:33,672 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:33,672 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:22:33,674 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:22:33,674 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:22:33,676 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:22:33,676 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:22:33,777 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:22:33,778 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:22:34,085 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:22:34,086 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:22:34,087 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:22:34,087 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:22:34,137 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:22:34,137 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:22:34,437 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:22:34,441 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:22:34,441 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:22:34,442 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:22:34,511 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:22:34,512 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:22:34,830 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:22:34,832 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:22:34,832 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:22:34,832 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:22:34,889 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:34,889 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:22:34,924 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:22:54,046 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:22:54,350 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:23:04,935 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:23:04,935 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:23:04,935 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:23:04,936 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:23:04,950 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:23:04,951 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:23:04,951 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:23:04,961 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:23:04,961 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:23:04,987 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:23:04,991 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:23:04,991 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:23:05,196 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:23:05,541 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:05,545 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:05,552 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:05,558 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:05,558 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349345'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349345'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3491849999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3491849999999999'}], 'margin_call': False}
2025-07-22 03:23:05,570 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:23:05,572 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:23:05,572 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:23:05,613 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:05,613 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:23:05,646 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:05,646 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:23:05,679 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:05,680 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:23:05,785 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:23:06,132 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.256740329345669942894539611% which is below threshold 100.0%
2025-07-22 03:23:06,132 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '214.265533547625829027139195', 'margin': '9494.47', 'free_margin': '-9280.204466452374170972860805', 'profit_loss': '-9687.754466452374170972860805', 'margin_level': '2.256740329345669942894539611', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9611.686000000000000000000000', 'current_price': '118468.21'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.15315132034015542987345893', 'current_price': '96.092'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.915315132034015542987345893', 'current_price': '96.092'}], 'margin_call': True}
2025-07-22 03:23:06,135 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.256740329345669942894539611
2025-07-22 03:23:06,187 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:23:06,187 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:23:06,232 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,233 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:23:06,292 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,292 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:23:06,336 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,336 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:23:06,382 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,382 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:23:06,425 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,426 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:23:06,478 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,478 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:23:06,534 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,535 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:23:06,587 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:06,587 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:23:06,801 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:23:07,153 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.606024977175564546829677493% which is below threshold 100.0%
2025-07-22 03:23:07,153 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '214.076000000000000000000000', 'margin': '5936.62', 'free_margin': '-5722.544000000000000000000000', 'profit_loss': '-6175.544000000000000000000000', 'margin_level': '3.606024977175564546829677493', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6175.544000000000000000000000', 'current_price': '118468.21'}], 'margin_call': True}
2025-07-22 03:23:07,155 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.606024977175564546829677493
2025-07-22 03:23:07,212 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:23:07,213 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:23:07,386 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:23:07,388 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-22 03:23:07,765 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-85514.83500000000025000000000', 'margin': '0.0', 'free_margin': '-85514.83500000000025000000000', 'profit_loss': '-85514.83500000000025000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-111.0750000000002500000000000', 'current_price': '38.878499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85403.76000000000000000000000', 'current_price': '118468.21'}], 'margin_call': False}
2025-07-22 03:23:07,768 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-22 03:23:07,768 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:23:07,768 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:23:07,796 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:07,796 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:23:07,812 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:07,812 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:23:07,848 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:07,848 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:23:07,852 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:07,852 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:23:07,863 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:23:07,864 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:23:07,865 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:23:07,954 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:07,954 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:23:07,955 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:07,956 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:23:07,957 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:07,957 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:23:08,090 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:23:08,091 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:08,095 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:08,483 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:08,485 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:23:08,486 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:23:08,486 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:23:08,605 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:23:08,606 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:23:08,610 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:23:08,993 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:08,996 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:23:08,996 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:23:08,997 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:23:09,100 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:23:09,101 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:23:09,105 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:23:09,412 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:09,413 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:23:09,414 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:23:09,414 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:23:09,445 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:09,446 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:23:09,474 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:39,485 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:23:39,486 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:23:39,486 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:23:39,486 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:23:39,500 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:23:39,501 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:23:39,501 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:23:39,510 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:23:39,511 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:23:39,531 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:23:39,534 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:23:39,535 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:23:39,725 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:23:39,726 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:40,127 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:40,131 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:40,134 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:40,136 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:23:40,136 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3493650000000001'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3493650000000001'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349205'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349205'}], 'margin_call': False}
2025-07-22 03:23:40,140 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:23:40,141 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:23:40,141 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:23:40,185 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:40,185 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:23:40,247 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:40,247 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:23:40,302 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:40,302 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:23:40,398 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:23:41,065 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.171033538508004124067515691% which is below threshold 100.0%
2025-07-22 03:23:41,066 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '206.128128003580899158353057', 'margin': '9494.47', 'free_margin': '-9288.341871996419100841646943', 'profit_loss': '-9695.891871996419100841646943', 'margin_level': '2.171033538508004124067515691', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9619.966000000000000000000000', 'current_price': '118447.51'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.02351999674463712876994758', 'current_price': '96.094'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.902351999674463712876994758', 'current_price': '96.094'}], 'margin_call': True}
2025-07-22 03:23:41,070 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.171033538508004124067515691
2025-07-22 03:23:41,117 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:23:41,117 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:23:41,150 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,150 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:23:41,181 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,181 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:23:41,211 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,211 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:23:41,240 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,240 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:23:41,270 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,270 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:23:41,292 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,292 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:23:41,307 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,307 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:23:41,339 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:41,340 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:23:41,461 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:23:41,865 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.571156651427916895472507925% which is below threshold 100.0%
2025-07-22 03:23:41,866 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '212.006000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.614000000000000000000000', 'profit_loss': '-6177.614000000000000000000000', 'margin_level': '3.571156651427916895472507925', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.614000000000000000000000', 'current_price': '118447.51'}], 'margin_call': True}
2025-07-22 03:23:41,869 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.571156651427916895472507925
2025-07-22 03:23:41,899 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:23:41,900 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:23:41,952 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:23:41,953 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-22 03:23:42,275 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-85638.41000000000000000000000', 'margin': '0.0', 'free_margin': '-85638.41000000000000000000000', 'profit_loss': '-85638.41000000000000000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.4500000000000000000000000', 'current_price': '38.8910000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85527.96000000000000000000000', 'current_price': '118447.51'}], 'margin_call': False}
2025-07-22 03:23:42,279 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-22 03:23:42,279 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:23:42,280 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:23:42,315 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:42,315 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:23:42,333 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:42,333 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:23:42,350 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:42,350 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:23:42,350 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:42,350 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:23:42,354 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:23:42,356 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:23:42,356 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:23:42,371 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:42,371 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:23:42,372 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:42,372 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:23:42,374 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:23:42,374 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:23:42,422 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:23:42,423 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:42,425 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:23:42,762 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:42,765 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:23:42,765 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:23:42,765 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:23:42,870 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:23:42,871 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:23:42,878 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:23:43,301 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:43,305 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:23:43,306 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:23:43,306 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:23:43,449 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:23:43,449 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:23:43,454 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:23:43,816 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:23:43,820 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:23:43,820 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:23:43,821 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:23:43,864 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:43,864 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:23:43,900 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:23:54,056 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:23:54,362 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:23:58,198 - INFO - app - Application shutdown initiated
2025-07-22 03:23:58,200 - INFO - app - Scheduler shutdown completed
2025-07-22 03:23:58,205 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 03:23:58,975 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 03:23:58,975 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 03:23:58,985 - INFO - app - Redis connection closed
2025-07-22 03:23:58,985 - INFO - app - Application shutdown completed
2025-07-22 03:28:31,417 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:31,465 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:31,483 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:31,483 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:32,081 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:28:32,081 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:28:32,081 - INFO - app - Environment: PRODUCTION
2025-07-22 03:28:32,152 - INFO - app - Application startup initiated
2025-07-22 03:28:32,152 - INFO - app - Initializing core services...
2025-07-22 03:28:32,187 - INFO - app - Firebase initialized
2025-07-22 03:28:32,187 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:28:32,208 - INFO - app - Redis initialized
2025-07-22 03:28:33,441 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:28:33,444 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:28:33,446 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:28:33,447 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:28:33,447 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:28:33,447 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:28:33,447 - INFO - app - Scheduler initialized
2025-07-22 03:28:33,449 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:28:33,449 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:28:34,742 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:28:34,749 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:28:34,845 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:28:34,845 - INFO - app - Background tasks initialized
2025-07-22 03:28:34,845 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:28:35,541 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:28:35,542 - INFO - app - Application startup completed successfully
2025-07-22 03:28:35,542 - INFO - app - Starting cache validation task
2025-07-22 03:28:35,545 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:28:35,549 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:28:35,551 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:28:35,551 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:28:35,551 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:28:35,551 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:28:35,551 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:28:35,558 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:28:35,571 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:28:35,571 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:28:35,571 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:28:35,572 - INFO - app - Validating cache for 30 users
2025-07-22 03:28:35,573 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:28:35,583 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,589 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:28:35,589 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:28:35,593 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:28:35,595 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:28:35,604 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:28:35,605 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,607 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:28:35,608 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:28:35,612 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:28:35,613 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:28:35,615 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:28:35,615 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:28:35,616 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:28:35,618 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:28:35,619 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:28:35,619 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:28:35,619 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:28:35,619 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,620 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:28:35,621 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:28:35,624 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:28:35,625 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:28:35,626 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:28:35,627 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:28:35,629 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:28:35,630 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:28:35,632 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:28:35,632 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:28:35,633 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,647 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,656 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,670 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,681 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,691 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,703 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,714 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,726 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,761 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,781 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,799 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,813 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,827 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,839 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,861 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,875 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-22 03:28:35,883 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:28:36,217 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-22 03:28:36,222 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:28:36,225 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:28:36,227 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:28:36,229 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:28:36,229 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3492900000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3492900000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3492800000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3492800000'}], 'margin_call': False}
2025-07-22 03:28:36,230 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:28:36,231 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:28:36,232 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:28:36,232 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:28:36,243 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-22 03:28:36,267 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,267 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:28:36,267 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-22 03:28:36,280 - INFO - app - Cache validation completed
2025-07-22 03:28:36,298 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,298 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:28:36,334 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,334 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:28:36,521 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:28:36,873 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.381455344966785879648767693% which is below threshold 100.0%
2025-07-22 03:28:36,874 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '226.106563291267995307488354', 'margin': '9494.47', 'free_margin': '-9268.363436708732004692511646', 'profit_loss': '-9675.913436708732004692511646', 'margin_level': '2.381455344966785879648767693', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9601.042000000000000000000000', 'current_price': '118494.8200000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-68.06494246248364062955604229', 'current_price': '96.1080000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.806494246248364062955604229', 'current_price': '96.1080000000'}], 'margin_call': True}
2025-07-22 03:28:36,877 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.381455344966785879648767693
2025-07-22 03:28:36,907 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:28:36,907 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:28:36,931 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,931 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:28:36,955 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,955 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:28:36,980 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:36,980 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:28:37,009 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,009 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:28:37,037 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,037 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:28:37,061 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,061 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:28:37,087 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,087 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:28:37,121 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:37,121 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:28:37,320 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,328 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,334 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,386 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:28:37,389 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,390 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,400 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:28:37,718 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,737 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,747 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,752 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,766 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,782 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,790 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,791 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,795 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.650848462593192759516357793% which is below threshold 100.0%
2025-07-22 03:28:37,796 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '216.737000000000000000000000', 'margin': '5936.62', 'free_margin': '-5719.883000000000000000000000', 'profit_loss': '-6172.883000000000000000000000', 'margin_level': '3.650848462593192759516357793', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6172.883000000000000000000000', 'current_price': '118494.8200000000'}], 'margin_call': True}
2025-07-22 03:28:37,797 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,801 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.650848462593192759516357793
2025-07-22 03:28:37,814 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,814 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,820 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,820 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,826 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,827 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,828 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,844 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,844 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,845 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:28:37,845 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:28:37,845 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:28:37,858 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:28:37,858 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:28:37,930 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:28:38,306 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.59195019103390277481292044% which is below threshold 100.0%
2025-07-22 03:28:38,307 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '99011.71000000000000000000000', 'margin': '146484.47', 'free_margin': '-47472.76000000000000000000000', 'profit_loss': '-85334.10000000000000000000000', 'margin_level': '67.59195019103390277481292044', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.4000000000000000000000000', 'current_price': '38.8920000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85223.70000000000000000000000', 'current_price': '118498.2200000000'}], 'margin_call': True}
2025-07-22 03:28:38,311 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.59195019103390277481292044
2025-07-22 03:28:38,314 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:28:38,315 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:28:38,336 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:38,337 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:28:38,350 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:38,350 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:28:38,367 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:38,367 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:28:38,368 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:28:38,368 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:28:38,372 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:28:38,373 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:28:38,373 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:28:38,387 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:38,387 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:28:38,388 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:28:38,388 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:28:38,388 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:28:38,388 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:28:38,455 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:28:38,456 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:28:38,921 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:28:38,928 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:28:38,930 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:28:38,930 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:28:38,990 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:28:38,990 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:28:39,330 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:28:39,333 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:28:39,333 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:28:39,333 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:28:39,405 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:28:39,406 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:28:39,706 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:28:39,709 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:28:39,709 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:28:39,709 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:28:39,732 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:39,732 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:28:39,749 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:28:50,550 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:28:50,553 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:28:50,556 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:28:50,558 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:28:50,560 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:28:50,562 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:28:50,565 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:28:50,567 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:28:50,571 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:28:50,572 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:28:50,575 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:28:50,577 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:28:50,579 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:28:50,580 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:28:50,582 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:28:50,584 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:28:50,586 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:28:50,587 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:28:50,588 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:28:50,589 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:28:50,590 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:28:50,591 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:28:50,592 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:28:50,592 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:29:09,757 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:29:09,758 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:29:09,758 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:29:09,758 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:29:09,763 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:29:09,763 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:29:09,763 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:29:09,766 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:29:09,766 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:29:09,773 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:29:09,774 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:29:09,774 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:29:09,843 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:29:10,270 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:10,277 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:10,288 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:10,293 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:10,293 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349185'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349185'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349025'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349025'}], 'margin_call': False}
2025-07-22 03:29:10,296 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:29:10,298 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:29:10,298 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:29:10,344 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:10,344 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:29:10,387 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:10,388 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:29:10,427 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:10,427 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:29:10,586 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:29:10,978 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.160011950545364239054182614% which is below threshold 100.0%
2025-07-22 03:29:10,978 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '205.081686640944444067727652', 'margin': '9494.47', 'free_margin': '-9289.388313359055555932272348', 'profit_loss': '-9696.938313359055555932272348', 'margin_level': '2.160011950545364239054182614', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9619.682000000000000000000000', 'current_price': '118448.22'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.23301214459595993842940742', 'current_price': '96.076'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.023301214459595993842940742', 'current_price': '96.076'}], 'margin_call': True}
2025-07-22 03:29:10,981 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.160011950545364239054182614
2025-07-22 03:29:11,027 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:29:11,028 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:29:11,073 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,073 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:29:11,114 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,115 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:29:11,165 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,165 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:29:11,212 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,212 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:29:11,252 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,252 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:29:11,296 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,296 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:29:11,339 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,339 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:29:11,381 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:11,381 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:29:11,506 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:29:11,897 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.572352618156459399456256254% which is below threshold 100.0%
2025-07-22 03:29:11,897 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '212.077000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.543000000000000000000000', 'profit_loss': '-6177.543000000000000000000000', 'margin_level': '3.572352618156459399456256254', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.543000000000000000000000', 'current_price': '118448.22'}], 'margin_call': True}
2025-07-22 03:29:11,905 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.572352618156459399456256254
2025-07-22 03:29:11,960 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:29:11,960 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:29:12,231 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:29:12,608 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.38682605739707424275078443% which is below threshold 100.0%
2025-07-22 03:29:12,608 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98711.23500000000000000000000', 'margin': '146484.47', 'free_margin': '-47773.23500000000000000000000', 'profit_loss': '-85634.57500000000000000000000', 'margin_level': '67.38682605739707424275078443', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.875000000000000000000000', 'current_price': '38.8825'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85523.70000000000000000000000', 'current_price': '118448.22'}], 'margin_call': True}
2025-07-22 03:29:12,609 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.38682605739707424275078443
2025-07-22 03:29:12,610 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:29:12,611 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:29:12,636 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:12,636 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:29:12,657 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:12,657 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:29:12,682 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:12,682 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:29:12,683 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:12,683 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:29:12,696 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:29:12,698 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:29:12,698 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:29:12,721 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:12,721 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:29:12,721 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:12,721 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:29:12,722 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:12,722 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:29:12,801 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:29:12,802 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:29:13,120 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:29:13,121 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:29:13,122 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:29:13,122 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:29:13,209 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:29:13,210 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:29:13,636 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:29:13,638 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:29:13,638 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:29:13,638 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:29:13,773 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:29:13,774 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:29:14,098 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:29:14,100 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:29:14,101 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:29:14,101 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:29:14,137 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:14,137 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:29:14,161 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:33,450 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:29:33,753 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:29:44,177 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:29:44,178 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:29:44,178 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:29:44,178 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:29:44,190 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:29:44,191 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:29:44,191 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:29:44,197 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:29:44,198 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:29:44,211 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:29:44,213 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:29:44,213 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:29:44,275 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:29:44,603 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:44,628 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:44,637 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:44,643 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:29:44,643 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349215'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349215'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349055'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349055'}], 'margin_call': False}
2025-07-22 03:29:44,649 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:29:44,652 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:29:44,652 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:29:44,691 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:44,691 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:29:44,707 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:44,708 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:29:44,735 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:44,735 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:29:44,837 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:29:45,184 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.148359278073876552917890130% which is below threshold 100.0%
2025-07-22 03:29:45,185 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '203.975327148940787153823203', 'margin': '9494.47', 'free_margin': '-9290.494672851059212846176797', 'profit_loss': '-9698.044672851059212846176797', 'margin_level': '2.148359278073876552917890130', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9620.562000000000000000000000', 'current_price': '118446.02'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.43879350096292076925163425', 'current_price': '96.073'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.043879350096292076925163425', 'current_price': '96.073'}], 'margin_call': True}
2025-07-22 03:29:45,188 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.148359278073876552917890130
2025-07-22 03:29:45,216 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:29:45,216 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:29:45,246 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,247 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:29:45,277 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,277 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:29:45,319 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,319 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:29:45,337 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,337 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:29:45,358 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,358 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:29:45,376 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,376 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:29:45,412 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,412 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:29:45,444 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:45,444 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:29:45,592 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:29:45,994 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.582307777826439960785766985% which is below threshold 100.0%
2025-07-22 03:29:45,994 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '212.668000000000000000000000', 'margin': '5936.62', 'free_margin': '-5723.952000000000000000000000', 'profit_loss': '-6176.952000000000000000000000', 'margin_level': '3.582307777826439960785766985', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6176.952000000000000000000000', 'current_price': '118454.13'}], 'margin_call': True}
2025-07-22 03:29:45,999 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.582307777826439960785766985
2025-07-22 03:29:46,052 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:29:46,052 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:29:46,205 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:29:46,608 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.41106753500900129549569316% which is below threshold 100.0%
2025-07-22 03:29:46,609 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98746.74500000000000000000000', 'margin': '146484.47', 'free_margin': '-47737.72500000000000000000000', 'profit_loss': '-85599.06500000000000000000000', 'margin_level': '67.41106753500900129549569316', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.825000000000000000000000', 'current_price': '38.8835'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85488.24000000000000000000000', 'current_price': '118454.13'}], 'margin_call': True}
2025-07-22 03:29:46,617 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.41106753500900129549569316
2025-07-22 03:29:46,620 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:29:46,622 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:29:46,695 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:46,696 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:29:46,760 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:46,761 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:29:46,992 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:46,992 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:29:47,012 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:47,013 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:29:47,084 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:29:47,088 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:29:47,088 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:29:47,127 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:47,127 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:29:47,128 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:47,128 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:29:47,129 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:29:47,129 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:29:47,225 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:29:47,226 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:29:47,630 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:29:47,633 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:29:47,636 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:29:47,636 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:29:47,734 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:29:47,735 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:29:48,101 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:29:48,107 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:29:48,107 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:29:48,108 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:29:48,174 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:29:48,175 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:29:48,529 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:29:48,533 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:29:48,533 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:29:48,533 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:29:48,593 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:29:48,593 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:29:48,667 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:18,685 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:30:18,685 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:30:18,686 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:30:18,686 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:30:18,700 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:30:18,700 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:30:18,701 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:30:18,710 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:30:18,710 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:30:18,738 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:30:18,743 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:30:18,743 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:30:18,887 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:30:19,279 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:19,316 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:19,330 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:19,344 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:19,345 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3492250000000001'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3492250000000001'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349065'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349065'}], 'margin_call': False}
2025-07-22 03:30:19,347 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:30:19,349 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:30:19,349 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:30:19,381 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:19,381 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:30:19,417 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:19,417 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:30:19,450 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:19,450 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:30:19,551 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:30:19,851 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.206571063316008617538135862% which is below threshold 100.0%
2025-07-22 03:30:19,851 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '209.502227635219443389573048', 'margin': '9494.47', 'free_margin': '-9284.967772364780556610426952', 'profit_loss': '-9692.517772364780556610426952', 'margin_level': '2.206571063316008617538135862', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9615.406000000000000000000000', 'current_price': '118458.91'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.10161124070959691856995606', 'current_price': '96.078'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.010161124070959691856995606', 'current_price': '96.078'}], 'margin_call': True}
2025-07-22 03:30:19,853 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.206571063316008617538135862
2025-07-22 03:30:19,906 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:30:19,906 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:30:19,958 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:19,958 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:30:20,003 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,003 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:30:20,042 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,042 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:30:20,075 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,075 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:30:20,105 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,105 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:30:20,154 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,154 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:30:20,191 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,191 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:30:20,233 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:20,234 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:30:20,374 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:30:20,743 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.590359497491838790422833195% which is below threshold 100.0%
2025-07-22 03:30:20,743 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '213.146000000000000000000000', 'margin': '5936.62', 'free_margin': '-5723.474000000000000000000000', 'profit_loss': '-6176.474000000000000000000000', 'margin_level': '3.590359497491838790422833195', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6176.474000000000000000000000', 'current_price': '118458.91'}], 'margin_call': True}
2025-07-22 03:30:20,745 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.590359497491838790422833195
2025-07-22 03:30:20,778 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:30:20,779 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:30:20,931 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:30:21,319 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.43054400237786299120992143% which is below threshold 100.0%
2025-07-22 03:30:21,319 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98775.27500000000000000000000', 'margin': '146484.47', 'free_margin': '-47709.19500000000000000000000', 'profit_loss': '-85570.53500000000000000000000', 'margin_level': '67.43054400237786299120992143', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-110.975000000000000000000000', 'current_price': '38.8805'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85459.56000000000000000000000', 'current_price': '118458.91'}], 'margin_call': True}
2025-07-22 03:30:21,322 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.43054400237786299120992143
2025-07-22 03:30:21,324 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:30:21,324 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:30:21,372 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:21,373 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:30:21,447 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:21,448 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:30:21,512 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:21,512 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:30:21,513 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:21,513 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:30:21,577 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:30:21,585 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:30:21,585 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:30:21,622 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:21,622 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:30:21,623 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:21,624 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:30:21,624 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:21,625 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:30:21,737 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:30:21,738 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:30:22,032 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:30:22,038 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:30:22,041 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:30:22,042 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:30:22,164 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:30:22,166 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:30:22,704 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:30:22,707 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:30:22,708 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:30:22,708 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:30:22,876 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:30:22,877 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:30:23,194 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:30:23,197 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:30:23,197 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:30:23,197 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:30:23,246 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:23,246 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:30:23,287 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:31,793 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-22 03:30:31,798 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-22 03:30:31,814 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-22 03:30:31,953 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-22 03:30:31,957 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-22 03:30:31,958 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-22 03:30:31,965 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-22 03:30:31,974 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-22 03:30:31,978 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-22 03:30:31,986 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-22 03:30:31,993 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-22 03:30:31,995 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-22 03:30:32,623 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 30
2025-07-22 03:30:32,623 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-22 03:30:33,449 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:30:33,741 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:30:41,090 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 30 by invalidating refresh token.
2025-07-22 03:30:50,817 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 25
2025-07-22 03:30:50,817 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-22 03:30:53,291 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:30:53,292 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:30:53,292 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:30:53,292 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:30:53,302 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:30:53,302 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:30:53,303 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:30:53,310 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:30:53,310 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:30:53,327 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:30:53,331 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:30:53,331 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:30:53,512 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:30:53,891 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:53,895 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:53,899 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:53,903 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:30:53,904 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349235'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349235'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349075'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349075'}], 'margin_call': False}
2025-07-22 03:30:53,907 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:30:53,909 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:30:53,910 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:30:53,963 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:53,963 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:30:53,995 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:53,995 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:30:54,020 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,020 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:30:54,183 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:30:54,489 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.250792536208083200295235163% which is below threshold 100.0%
2025-07-22 03:30:54,489 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '213.700822112515597027071014', 'margin': '9494.47', 'free_margin': '-9280.769177887484402972928986', 'profit_loss': '-9688.319177887484402972928986', 'margin_level': '2.250792536208083200295235163', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9611.282000000000000000000000', 'current_price': '118469.22'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.03379807953127542993544187', 'current_price': '96.079'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.003379807953127542993544187', 'current_price': '96.079'}], 'margin_call': True}
2025-07-22 03:30:54,493 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.250792536208083200295235163
2025-07-22 03:30:54,612 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:30:54,612 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:30:54,647 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,647 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:30:54,691 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,691 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:30:54,735 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,736 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:30:54,778 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,778 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:30:54,810 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,810 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:30:54,842 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,843 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:30:54,880 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,880 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:30:54,912 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:54,912 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:30:55,041 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:30:55,336 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.607726281958420784891065960% which is below threshold 100.0%
2025-07-22 03:30:55,336 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '214.177000000000000000000000', 'margin': '5936.62', 'free_margin': '-5722.443000000000000000000000', 'profit_loss': '-6175.443000000000000000000000', 'margin_level': '3.607726281958420784891065960', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'swap': 'None', 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6175.443000000000000000000000', 'current_price': '118469.22'}], 'margin_call': True}
2025-07-22 03:30:55,339 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.607726281958420784891065960
2025-07-22 03:30:55,378 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:30:55,378 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:30:55,545 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:30:55,841 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.47147666916499728606042675% which is below threshold 100.0%
2025-07-22 03:30:55,841 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98835.23499999999970000000000', 'margin': '146484.47', 'free_margin': '-47649.23500000000030000000000', 'profit_loss': '-85510.57500000000030000000000', 'margin_level': '67.47147666916499728606042675', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.8750000000003000000000000', 'current_price': '38.842499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85397.70000000000000000000000', 'current_price': '118469.22'}], 'margin_call': True}
2025-07-22 03:30:55,846 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.47147666916499728606042675
2025-07-22 03:30:55,849 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:30:55,849 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:30:55,871 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:55,871 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:30:55,907 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:55,907 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:30:55,945 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:55,945 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:30:55,948 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:55,948 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:30:55,967 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:30:55,969 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:30:55,969 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:30:56,011 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:56,011 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:30:56,013 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:56,013 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:30:56,014 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:30:56,014 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:30:56,136 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:30:56,137 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:30:56,456 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:30:56,459 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:30:56,462 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:30:56,462 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:30:56,591 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:30:56,592 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:30:56,891 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:30:56,894 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:30:56,895 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:30:56,895 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:30:57,043 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:30:57,044 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:30:57,358 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:30:57,359 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:30:57,359 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:30:57,359 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:30:57,388 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:30:57,388 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:30:57,419 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:27,436 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:31:27,436 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:31:27,437 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:31:27,437 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:31:27,445 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:31:27,446 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:31:27,446 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:31:27,454 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:31:27,454 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:31:27,475 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:31:27,479 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:31:27,480 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:31:27,631 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:31:27,983 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:31:27,988 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:31:27,990 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:31:27,991 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:31:27,992 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.349215'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.349215'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.349055'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.349055'}], 'margin_call': False}
2025-07-22 03:31:27,994 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:31:27,995 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:31:27,996 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:31:28,037 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,037 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:31:28,085 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,085 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:31:28,133 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,133 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:31:28,275 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:31:28,600 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.145383808812030550700260404% which is below threshold 100.0%
2025-07-22 03:31:28,601 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '203.692822112515597027071014', 'margin': '9494.47', 'free_margin': '-9290.777177887484402972928986', 'profit_loss': '-9698.327177887484402972928986', 'margin_level': '2.145383808812030550700260404', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9621.290000000000000000000000', 'current_price': '118444.2'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-70.03379807953127542993544187', 'current_price': '96.079'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.003379807953127542993544187', 'current_price': '96.079'}], 'margin_call': True}
2025-07-22 03:31:28,603 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.145383808812030550700260404
2025-07-22 03:31:28,663 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:31:28,663 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:31:28,734 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,734 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:31:28,779 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,779 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:31:28,827 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,827 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:31:28,868 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,868 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:31:28,906 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,907 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:31:28,940 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,940 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:31:28,977 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:28,977 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:31:29,021 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:29,022 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:31:29,125 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:31:29,438 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.565581088228655362815878395% which is below threshold 100.0%
2025-07-22 03:31:29,439 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '211.675000000000000000000000', 'margin': '5936.62', 'free_margin': '-5724.945000000000000000000000', 'profit_loss': '-6177.945000000000000000000000', 'margin_level': '3.565581088228655362815878395', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6177.945000000000000000000000', 'current_price': '118444.2'}], 'margin_call': True}
2025-07-22 03:31:29,447 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.565581088228655362815878395
2025-07-22 03:31:29,506 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:31:29,507 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:31:29,638 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:31:30,029 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.36896068231669869167700849% which is below threshold 100.0%
2025-07-22 03:31:30,030 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98685.06499999999980000000000', 'margin': '146484.47', 'free_margin': '-47799.40500000000020000000000', 'profit_loss': '-85660.74500000000020000000000', 'margin_level': '67.36896068231669869167700849', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.9250000000002000000000000', 'current_price': '38.841499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85547.82000000000000000000000', 'current_price': '118444.2'}], 'margin_call': True}
2025-07-22 03:31:30,034 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.36896068231669869167700849
2025-07-22 03:31:30,035 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:31:30,035 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:31:30,068 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:30,068 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:31:30,103 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:30,103 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:31:30,144 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:30,145 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:31:30,148 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:31:30,148 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:31:30,177 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:31:30,179 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:31:30,179 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:31:30,219 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:30,219 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:31:30,220 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:31:30,221 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:31:30,222 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:31:30,222 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:31:30,335 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:31:30,339 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:31:30,633 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:31:30,636 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:31:30,638 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:31:30,638 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:31:30,769 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:31:30,770 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:31:31,136 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:31:31,142 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:31:31,142 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:31:31,142 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:31:31,259 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:31:31,260 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:31:31,563 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:31:31,574 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:31:31,574 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:31:31,574 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:31:31,650 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:31,650 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:31:31,683 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:31:33,453 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:31:33,815 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:31:43,748 - INFO - app - Application shutdown initiated
2025-07-22 03:31:43,757 - INFO - app - Scheduler shutdown completed
2025-07-22 03:31:43,824 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 03:31:46,028 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 03:31:46,028 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 03:31:46,041 - INFO - app - Redis connection closed
2025-07-22 03:31:46,042 - INFO - app - Application shutdown completed
2025-07-22 03:40:09,619 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:09,663 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:09,681 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:09,681 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:10,079 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:40:10,079 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:40:10,079 - INFO - app - Environment: PRODUCTION
2025-07-22 03:40:10,150 - INFO - app - Application startup initiated
2025-07-22 03:40:10,150 - INFO - app - Initializing core services...
2025-07-22 03:40:10,202 - INFO - app - Firebase initialized
2025-07-22 03:40:10,202 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:40:10,234 - INFO - app - Redis initialized
2025-07-22 03:40:10,964 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:40:10,968 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:40:10,974 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:40:10,974 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:40:10,974 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:40:10,975 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:40:10,975 - INFO - app - Scheduler initialized
2025-07-22 03:40:10,977 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:40:10,977 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:40:12,264 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:40:12,272 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:40:12,308 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:40:12,308 - INFO - app - Background tasks initialized
2025-07-22 03:40:12,308 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:40:13,077 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:40:13,078 - INFO - app - Application startup completed successfully
2025-07-22 03:40:13,078 - INFO - app - Starting cache validation task
2025-07-22 03:40:13,081 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:40:13,087 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:40:13,089 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:40:13,089 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:40:13,089 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:40:13,089 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:40:13,089 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:40:13,119 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:40:13,120 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:40:13,120 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:40:13,120 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:40:13,123 - INFO - app - Validating cache for 30 users
2025-07-22 03:40:13,138 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:40:13,154 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,158 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:40:13,159 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:40:13,166 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:40:13,168 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:40:13,171 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:40:13,177 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,178 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:40:13,186 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:40:13,190 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:40:13,192 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:40:13,194 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:40:13,195 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:40:13,196 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:40:13,197 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:40:13,198 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:40:13,198 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:40:13,198 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:40:13,199 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:40:13,200 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:40:13,200 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,201 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:40:13,202 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:40:13,203 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:40:13,205 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:40:13,209 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:40:13,210 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:40:13,211 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:40:13,211 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:40:13,213 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,223 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,235 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,242 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,252 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,260 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,270 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,276 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,285 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,293 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,300 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,309 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,316 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,325 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,335 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,344 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,391 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,408 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:40:13,411 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,718 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:13,720 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:13,721 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:13,722 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,722 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:13,722 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3491500000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3491500000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3491400000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3491400000'}], 'margin_call': False}
2025-07-22 03:40:13,724 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:40:13,726 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:40:13,726 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:40:13,731 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,742 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,748 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:13,748 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:40:13,750 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,764 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-22 03:40:13,774 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:13,775 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:40:13,780 - INFO - app - Cache validation completed
2025-07-22 03:40:13,803 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:13,803 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:40:14,031 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:40:14,358 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.366476529998692772101292563% which is below threshold 100.0%
2025-07-22 03:40:14,358 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '224.684404197766885639325592', 'margin': '9494.47', 'free_margin': '-9269.785595802233114360674408', 'profit_loss': '-9677.335595802233114360674408', 'margin_level': '2.366476529998692772101292563', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9601.290000000000000000000000', 'current_price': '118494.2000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.13235982021192214606764425', 'current_price': '96.0920000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.913235982021192214606764425', 'current_price': '96.0920000000'}], 'margin_call': True}
2025-07-22 03:40:14,360 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.366476529998692772101292563
2025-07-22 03:40:14,389 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:40:14,389 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:40:14,413 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,413 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:40:14,438 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,438 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:40:14,459 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,459 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:40:14,483 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,483 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:40:14,507 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,507 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:40:14,533 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,533 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:40:14,557 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,557 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:40:14,581 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:14,581 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:40:14,774 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:40:14,929 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,933 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,935 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,941 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,947 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,947 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:14,997 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:40:15,061 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.649804097280944375755901506% which is below threshold 100.0%
2025-07-22 03:40:15,061 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '216.675000000000000000000000', 'margin': '5936.62', 'free_margin': '-5719.945000000000000000000000', 'profit_loss': '-6172.945000000000000000000000', 'margin_level': '3.649804097280944375755901506', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6172.945000000000000000000000', 'current_price': '118494.2000000000'}], 'margin_call': True}
2025-07-22 03:40:15,063 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.649804097280944375755901506
2025-07-22 03:40:15,116 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:40:15,116 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:40:15,234 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,236 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,246 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,257 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,260 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,262 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,263 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,263 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,263 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,267 - INFO - app.core.config - .env file loaded successfully.
t: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,267 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,274 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,274 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,280 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,280 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,283 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,283 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,305 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:40:15,319 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:40:15,319 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 03:40:15,323 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:40:15,600 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.57418721588711759000800563% which is below threshold 100.0%
2025-07-22 03:40:15,600 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98985.69000000000000000000000', 'margin': '146484.47', 'free_margin': '-47498.78000000000000000000000', 'profit_loss': '-85360.12000000000000000000000', 'margin_level': '67.57418721588711759000800563', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.3000000000000000000000000', 'current_price': '38.8540000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85247.82000000000000000000000', 'current_price': '118494.2000000000'}], 'margin_call': True}
2025-07-22 03:40:15,610 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.57418721588711759000800563
2025-07-22 03:40:15,612 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:40:15,612 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:40:15,634 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:15,634 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:40:15,646 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:15,646 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:40:15,666 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:15,666 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:40:15,667 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:15,667 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:40:15,671 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:40:15,672 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:40:15,672 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:40:15,686 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:15,686 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:40:15,686 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:15,686 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:40:15,687 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:15,687 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:40:15,762 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:40:15,763 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:40:16,183 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:40:16,186 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:40:16,187 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:40:16,187 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:40:16,363 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:40:16,365 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:40:16,664 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:40:16,666 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:40:16,666 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:40:16,666 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:40:16,747 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:40:16,748 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:40:17,037 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:40:17,040 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:40:17,041 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:40:17,041 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:40:17,096 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:17,096 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:40:17,129 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:18,138 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 25 by invalidating refresh token.
2025-07-22 03:40:26,352 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 30
2025-07-22 03:40:26,353 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-22 03:40:28,083 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:40:28,087 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:40:28,091 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:40:28,094 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:40:28,099 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:40:28,104 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:40:28,110 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:40:28,113 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:40:28,120 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:40:28,123 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:40:28,130 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:40:28,134 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:40:28,136 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:40:28,139 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:40:28,143 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:40:28,147 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:40:28,153 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:40:28,157 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:40:28,160 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:40:28,164 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:40:28,169 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:40:28,173 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:40:28,177 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:40:28,177 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:40:47,130 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:40:47,130 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:40:47,131 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:40:47,131 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:40:47,142 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:40:47,142 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:40:47,142 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:40:47,148 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:40:47,149 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:40:47,159 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:40:47,164 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:40:47,164 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:40:47,285 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:40:47,582 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:47,584 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:47,588 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:47,591 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:40:47,591 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.348695'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.348695'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.348535'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.348535'}], 'margin_call': False}
2025-07-22 03:40:47,593 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:40:47,594 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:40:47,595 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:40:47,639 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:47,639 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:40:47,682 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:47,683 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:40:47,716 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:47,717 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:40:47,827 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:40:48,212 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.171843018374062441103939209% which is below threshold 100.0%
2025-07-22 03:40:48,213 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '301.149683826619846251881177', 'margin': '9494.47', 'free_margin': '-9193.320316173380153748118823', 'profit_loss': '-9600.870316173380153748118823', 'margin_level': '3.171843018374062441103939209', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9524.530000000000000000000000', 'current_price': '118686.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.40028743034559431647165693', 'current_price': '96.088'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.940028743034559431647165693', 'current_price': '96.088'}], 'margin_call': True}
2025-07-22 03:40:48,217 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.171843018374062441103939209
2025-07-22 03:40:48,254 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:40:48,254 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:40:48,317 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,317 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:40:48,363 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,363 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:40:48,412 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,412 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:40:48,452 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,452 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:40:48,485 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,485 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:40:48,502 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,503 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:40:48,519 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,519 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:40:48,540 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:48,540 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:40:48,694 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:40:49,030 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.973052006023629607419710205% which is below threshold 100.0%
2025-07-22 03:40:49,030 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '235.865000000000000000000000', 'margin': '5936.62', 'free_margin': '-5700.755000000000000000000000', 'profit_loss': '-6153.755000000000000000000000', 'margin_level': '3.973052006023629607419710205', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6153.755000000000000000000000', 'current_price': '118686.1'}], 'margin_call': True}
2025-07-22 03:40:49,032 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.973052006023629607419710205
2025-07-22 03:40:49,073 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:40:49,073 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:40:49,256 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:40:49,632 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.36002137291413874795055066% which is below threshold 100.0%
2025-07-22 03:40:49,633 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100136.8149999999997000000000', 'margin': '146484.47', 'free_margin': '-46347.6550000000003000000000', 'profit_loss': '-84208.99500000000030000000000', 'margin_level': '68.36002137291413874795055066', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.5750000000003000000000000', 'current_price': '38.848499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84096.42000000000000000000000', 'current_price': '118686.1'}], 'margin_call': True}
2025-07-22 03:40:49,635 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.36002137291413874795055066
2025-07-22 03:40:49,642 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:40:49,644 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:40:49,707 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:49,707 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:40:49,742 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:49,742 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:40:49,779 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:49,780 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:40:49,781 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:49,781 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:40:49,794 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:40:49,797 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:40:49,797 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:40:49,836 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:49,836 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:40:49,837 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:49,838 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:40:49,839 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:40:49,839 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:40:49,998 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:40:49,999 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:40:50,351 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:40:50,358 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:40:50,364 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:40:50,364 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:40:51,791 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:40:51,793 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:40:52,194 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:40:52,200 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:40:52,200 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:40:52,200 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:40:52,329 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:40:52,331 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:40:52,704 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:40:53,012 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:40:53,012 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:40:53,012 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:40:53,062 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:40:53,063 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:40:53,098 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:10,983 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:41:11,339 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:41:23,111 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:41:23,111 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:41:23,111 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:41:23,112 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:41:23,126 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:41:23,127 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:41:23,127 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:41:23,133 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:41:23,133 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:41:23,148 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:41:23,153 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:41:23,153 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:41:23,314 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:41:23,641 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:23,646 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:23,648 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:23,651 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:23,651 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.348725'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.348725'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.348565'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.348565'}], 'margin_call': False}
2025-07-22 03:41:23,653 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:41:23,654 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:41:23,654 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:41:23,694 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:23,694 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:41:23,719 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:23,719 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:41:23,743 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:23,743 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:41:23,792 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:41:24,109 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.197406342645892650850323030% which is below threshold 100.0%
2025-07-22 03:41:24,110 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '303.576785980611483967188665', 'margin': '9494.47', 'free_margin': '-9190.893214019388516032811335', 'profit_loss': '-9598.443214019388516032811335', 'margin_level': '3.197406342645892650850323030', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9522.250000000000000000000000', 'current_price': '118691.8'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.26655819944410548437394075', 'current_price': '96.09'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.926655819944410548437394075', 'current_price': '96.09'}], 'margin_call': True}
2025-07-22 03:41:24,113 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.197406342645892650850323030
2025-07-22 03:41:24,164 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:41:24,164 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:41:24,240 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,241 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:41:24,351 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,351 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:41:24,389 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,389 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:41:24,424 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,424 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:41:24,455 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,455 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:41:24,500 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,500 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:41:24,529 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,529 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:41:24,565 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:24,565 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:41:24,698 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:41:25,062 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.982653429055590554894872840% which is below threshold 100.0%
2025-07-22 03:41:25,063 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '236.435000000000000000000000', 'margin': '5936.62', 'free_margin': '-5700.185000000000000000000000', 'profit_loss': '-6153.185000000000000000000000', 'margin_level': '3.982653429055590554894872840', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6153.185000000000000000000000', 'current_price': '118691.8'}], 'margin_call': True}
2025-07-22 03:41:25,070 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.982653429055590554894872840
2025-07-22 03:41:25,119 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:41:25,119 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:41:25,342 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:41:25,685 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.38323202452792435949012206% which is below threshold 100.0%
2025-07-22 03:41:25,685 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100170.8150000000000000000000', 'margin': '146484.47', 'free_margin': '-46313.6550000000000000000000', 'profit_loss': '-84174.99500000000000000000000', 'margin_level': '68.38323202452792435949012206', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.775000000000000000000000', 'current_price': '38.8445'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84062.22000000000000000000000', 'current_price': '118691.8'}], 'margin_call': True}
2025-07-22 03:41:25,688 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.38323202452792435949012206
2025-07-22 03:41:25,690 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:41:25,691 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:41:25,731 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:25,732 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:41:25,755 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:25,756 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:41:25,777 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:25,777 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:41:25,778 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:25,778 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:41:25,782 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:41:25,783 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:41:25,783 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:41:25,802 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:25,802 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:41:25,803 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:25,803 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:41:25,804 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:25,804 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:41:25,852 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:41:25,852 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:41:26,191 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:41:26,195 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:41:26,197 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:41:26,197 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:41:26,442 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:41:26,443 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:41:26,753 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:41:26,771 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:41:26,771 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:41:26,772 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:41:26,944 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:41:26,945 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:41:27,316 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:41:27,319 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:41:27,319 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:41:27,319 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:41:27,370 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:27,371 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:41:27,407 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:54,212 - INFO - app - [BarclaysMarginChecker] User 30: free_margin=10000.0, total_pending_margin=237515.95, num_pending_orders=1
2025-07-22 03:41:54,212 - INFO - app - [BarclaysMarginChecker] Considering cancellation: user 30, order 1194-001, order_margin=237515.95, free_margin=10000.0, total_pending_margin=237515.95
2025-07-22 03:41:54,217 - WARNING - app - [BarclaysMarginChecker] Cancelling order 1194-001 for user 30 (order_margin=237515.95) due to insufficient margin.
2025-07-22 03:41:54,598 - INFO - app - [BarclaysMarginChecker] Created rejected order record: order_id=1194-001, rejected_id=1197-002
2025-07-22 03:41:54,655 - INFO - app - [BarclaysMarginChecker] Successfully cancelled order 1194-001 for user 30
2025-07-22 03:41:57,425 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:41:57,426 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:41:57,426 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:41:57,426 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:41:57,439 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:41:57,439 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:41:57,440 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:41:57,449 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:41:57,449 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:41:57,487 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:41:57,491 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:41:57,491 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:41:57,617 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:41:57,911 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:57,914 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:57,919 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:57,924 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:41:57,924 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.348705'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.348705'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3485449999999999'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3485449999999999'}], 'margin_call': False}
2025-07-22 03:41:57,928 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:41:57,930 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:41:57,932 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:41:57,995 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:57,996 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:41:58,057 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,057 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:41:58,109 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,109 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:41:58,246 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:41:58,537 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.157898058834456754846570446% which is below threshold 100.0%
2025-07-22 03:41:58,537 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '299.825683826619846251881177', 'margin': '9494.47', 'free_margin': '-9194.644316173380153748118823', 'profit_loss': '-9602.194316173380153748118823', 'margin_level': '3.157898058834456754846570446', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9525.854000000000000000000000', 'current_price': '118682.79'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.40028743034559431647165693', 'current_price': '96.088'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.940028743034559431647165693', 'current_price': '96.088'}], 'margin_call': True}
2025-07-22 03:41:58,540 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.157898058834456754846570446
2025-07-22 03:41:58,609 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:41:58,609 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:41:58,664 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,664 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:41:58,703 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,703 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:41:58,739 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,739 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:41:58,760 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,761 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:41:58,784 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,784 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:41:58,802 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,802 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:41:58,819 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,819 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:41:58,841 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:58,841 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:41:58,926 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:41:59,207 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.967476442824368074763080676% which is below threshold 100.0%
2025-07-22 03:41:59,207 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '235.534000000000000000000000', 'margin': '5936.62', 'free_margin': '-5701.086000000000000000000000', 'profit_loss': '-6154.086000000000000000000000', 'margin_level': '3.967476442824368074763080676', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6154.086000000000000000000000', 'current_price': '118682.79'}], 'margin_call': True}
2025-07-22 03:41:59,212 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.967476442824368074763080676
2025-07-22 03:41:59,303 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:41:59,303 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:41:59,422 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:41:59,717 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.34636122177320210121933062% which is below threshold 100.0%
2025-07-22 03:41:59,718 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100116.8049999999997000000000', 'margin': '146484.47', 'free_margin': '-46367.6650000000003000000000', 'profit_loss': '-84229.00500000000030000000000', 'margin_level': '68.34636122177320210121933062', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.7250000000003000000000000', 'current_price': '38.845499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84116.28000000000000000000000', 'current_price': '118682.79'}], 'margin_call': True}
2025-07-22 03:41:59,722 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.34636122177320210121933062
2025-07-22 03:41:59,724 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:41:59,724 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:41:59,773 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:59,773 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 03:41:59,812 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:59,812 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:41:59,844 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:59,844 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:41:59,846 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:59,846 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:41:59,857 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:41:59,860 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:41:59,860 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:41:59,892 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:41:59,893 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:41:59,894 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:59,894 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:41:59,895 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:41:59,895 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:42:00,067 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:42:00,068 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:42:00,398 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 03:42:00,401 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:42:00,404 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:42:00,404 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:42:00,553 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:42:00,554 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:42:00,899 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:42:00,903 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 03:42:00,904 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:42:00,904 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:42:01,094 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:42:01,095 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 03:42:01,405 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:42:01,407 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 03:42:01,407 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:42:01,407 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:42:01,519 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:01,519 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:42:01,560 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:10,985 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:42:11,272 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:42:31,584 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:42:31,584 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:42:31,584 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:42:31,584 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:42:31,619 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 03:42:31,619 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 03:42:31,620 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:42:31,632 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:42:31,632 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:42:31,667 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:42:31,685 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:42:31,686 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:42:31,884 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:42:32,250 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:42:32,253 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:42:32,255 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:42:32,256 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 03:42:32,257 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.348715'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.348715'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.348555'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.348555'}], 'margin_call': False}
2025-07-22 03:42:32,258 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 03:42:32,259 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:42:32,259 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:42:32,293 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:32,294 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:42:32,325 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:32,325 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:42:32,364 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:32,364 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:42:32,490 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 03:42:32,854 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.097595263559233259105083664% which is below threshold 100.0%
2025-07-22 03:42:32,854 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '294.100253020052334015754437', 'margin': '9494.47', 'free_margin': '-9200.369746979947665984245563', 'profit_loss': '-9607.919746979947665984245563', 'margin_level': '3.097595263559233259105083664', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9531.654000000000000000000000', 'current_price': '118668.29'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-69.33249725449787816749596648', 'current_price': '96.089'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-6.933249725449787816749596648', 'current_price': '96.089'}], 'margin_call': True}
2025-07-22 03:42:32,860 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.097595263559233259105083664
2025-07-22 03:42:32,931 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 03:42:32,931 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:42:33,023 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,023 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:42:33,087 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,087 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:42:33,143 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,144 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:42:33,204 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,204 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:42:33,275 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,275 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:42:33,331 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,331 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:42:33,383 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,383 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:42:33,441 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:42:33,442 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:42:33,635 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 03:42:33,937 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.943051770199204261010473973% which is below threshold 100.0%
2025-07-22 03:42:33,938 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '234.084000000000000000000000', 'margin': '5936.62', 'free_margin': '-5702.536000000000000000000000', 'profit_loss': '-6155.536000000000000000000000', 'margin_level': '3.943051770199204261010473973', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6155.536000000000000000000000', 'current_price': '118668.29'}], 'margin_call': True}
2025-07-22 03:42:33,945 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.943051770199204261010473973
2025-07-22 03:42:34,022 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 03:42:34,022 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:42:34,124 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:42:34,488 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.28690099366847557287130847% which is below threshold 100.0%
2025-07-22 03:42:34,489 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100029.7050000000000000000000', 'margin': '146484.47', 'free_margin': '-46454.7650000000000000000000', 'profit_loss': '-84316.10500000000000000000000', 'margin_level': '68.28690099366847557287130847', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.825000000000000000000000', 'current_price': '38.8435'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84203.28000000000000000000000', 'current_price': '118668.29'}], 'margin_call': True}
2025-07-22 03:42:34,492 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.28690099366847557287130847
2025-07-22 03:42:34,498 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:42:34,499 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:42:34,907 - INFO - app - Application shutdown initiated
2025-07-22 03:42:34,907 - INFO - app - Scheduler shutdown completed
2025-07-22 03:42:35,782 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 03:42:36,128 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 03:42:36,128 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 03:42:36,131 - INFO - app - Redis connection closed
2025-07-22 03:42:36,132 - INFO - app - Application shutdown completed
2025-07-22 03:54:35,654 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:54:35,707 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:54:35,726 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:54:35,726 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-22 03:54:36,136 - INFO - app - Application starting up - Trading system initialized
2025-07-22 03:54:36,136 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 03:54:36,136 - INFO - app - Environment: PRODUCTION
2025-07-22 03:54:36,197 - INFO - app - Application startup initiated
2025-07-22 03:54:36,197 - INFO - app - Initializing core services...
2025-07-22 03:54:36,242 - INFO - app - Firebase initialized
2025-07-22 03:54:36,242 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 03:54:36,276 - INFO - app - Redis initialized
2025-07-22 03:54:38,400 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 03:54:38,407 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 03:54:38,413 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 03:54:38,413 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 03:54:38,413 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 03:54:38,414 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 03:54:38,414 - INFO - app - Scheduler initialized
2025-07-22 03:54:38,417 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:54:38,418 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 03:54:39,671 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 03:54:39,731 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:54:39,777 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 03:54:39,777 - INFO - app - Background tasks initialized
2025-07-22 03:54:39,777 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:54:40,558 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:54:40,558 - INFO - app - Application startup completed successfully
2025-07-22 03:54:40,559 - INFO - app - Starting cache validation task
2025-07-22 03:54:40,566 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 03:54:40,578 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 03:54:40,588 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 03:54:40,588 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:54:40,588 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:54:40,589 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:54:40,589 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:54:40,629 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:54:40,632 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:54:40,637 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:54:40,640 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:54:40,644 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:54:40,666 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:54:40,696 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:54:40,702 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:54:40,704 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:54:40,707 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:54:40,708 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:54:40,709 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:54:40,711 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:54:40,712 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:54:40,713 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:54:40,716 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:54:40,717 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:54:40,718 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:54:40,720 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:54:40,724 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:54:40,725 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:54:40,726 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:54:40,727 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:54:40,836 - INFO - app - Validating cache for 37 users
2025-07-22 03:54:40,841 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-22 03:54:40,851 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:54:40,852 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:54:40,852 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:54:40,956 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:54:40,997 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,007 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:41,007 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:54:41,086 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,105 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:54:41,105 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:54:41,143 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:54:41,199 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,227 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:54:41,227 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:54:41,288 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,344 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:41,345 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:54:41,368 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,446 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,526 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,616 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,686 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-22 03:54:41,711 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:54:41,993 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:54:41,998 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:54:41,999 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:54:42,000 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:54:42,032 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-22 03:54:42,095 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-22 03:54:42,166 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-22 03:54:42,238 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-22 03:54:42,242 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:54:42,539 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.70605114617342267521282337% which is below threshold 100.0%
2025-07-22 03:54:42,540 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.4137148704454920878558638', 'margin': '967.17', 'free_margin': '-476.7562851295545079121441362', 'profit_loss': '-4.646285129554507912144136242', 'margin_level': '50.70605114617342267521282337', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-4.646285129554507912144136242', 'current_price': '0.8913000000'}], 'margin_call': True}
2025-07-22 03:54:42,542 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.70605114617342267521282337
2025-07-22 03:54:42,662 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:54:42,672 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:54:42,684 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:54:42,735 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:54:42,771 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:54:42,798 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 03:54:43,072 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:54:43,082 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:54:43,096 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:54:43,096 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-22 03:54:43,103 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:54:43,104 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-22 03:54:43,110 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:54:43,132 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:54:43,132 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-22 03:54:43,139 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:54:43,157 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:54:43,161 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:54:43,161 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-22 03:54:43,175 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:54:43,175 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-22 03:54:43,178 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:54:43,182 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 03:54:43,191 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:54:43,191 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-22 03:54:43,195 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 03:54:43,195 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-22 03:54:46,337 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 11 at root9678@gmail.com
2025-07-22 03:54:46,350 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:54:46,350 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:54:46,484 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-22 03:54:46,586 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:46,590 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:54:46,608 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-22 03:54:46,722 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-22 03:54:46,730 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:46,731 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:54:46,844 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-22 03:54:46,961 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:46,961 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:54:46,981 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-22 03:54:47,064 - WARNING - app - User 27: Missing balance/margin cache, refreshing...
2025-07-22 03:54:47,083 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:47,084 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:54:47,133 - WARNING - app - User 28: Missing balance/margin cache, refreshing...
2025-07-22 03:54:47,170 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:47,170 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:54:47,203 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-22 03:54:47,253 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:47,253 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:54:47,303 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-22 03:54:47,333 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 30 by invalidating refresh token.
2025-07-22 03:54:47,380 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-22 03:54:47,673 - WARNING - app - User 33: Missing balance/margin cache, refreshing...
2025-07-22 03:54:47,792 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-22 03:54:47,807 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:54:48,106 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:54:48,121 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:54:48,125 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:54:48,125 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:54:48,163 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-22 03:54:48,233 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-22 03:54:48,314 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:54:48,380 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:54:48,702 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:54:48,718 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:54:48,723 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-22 03:54:48,726 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:54:48,726 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:54:48,814 - INFO - app - Cache validation completed
2025-07-22 03:54:48,857 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:48,857 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:54:49,059 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:54:49,351 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:54:49,356 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:54:49,358 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:54:49,358 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:54:49,462 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:49,462 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:54:49,710 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:49,710 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:54:49,913 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:49,913 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:54:50,142 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:54:50,432 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-74500.01500000000030000000000', 'margin': '308.75', 'free_margin': '-74808.76500000000030000000000', 'profit_loss': '-84137.77500000000030000000000', 'margin_level': '-24129.55951417004058299595142', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.8750000000003000000000000', 'current_price': '38.842499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84024.90000000000000000000000', 'current_price': '118698.02'}], 'margin_call': False}
2025-07-22 03:54:50,444 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -24129.55951417004058299595142
2025-07-22 03:54:50,444 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:54:50,444 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:54:50,645 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:54:50,946 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:54:50,955 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:54:50,961 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:54:50,961 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:54:52,413 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 03:54:52,779 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 03:54:52,787 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 03:54:52,792 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 03:54:52,792 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:54:52,909 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:52,913 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 03:54:53,034 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:53,034 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 03:54:53,258 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:53,258 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 03:54:53,660 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:53,660 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:54:53,807 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:53,807 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:54:53,808 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:54:53,809 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:54:53,825 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:54:53,913 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:54:53,914 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:54:54,117 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:54,117 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:54:54,121 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:54:54,121 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:54:54,132 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:54:54,132 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:54:54,397 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:54:54,398 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:54:55,510 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:54:55,551 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:54:55,551 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:54:55,552 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:54:55,566 - INFO - app - Starting stale cache cleanup task
2025-07-22 03:54:55,580 - INFO - app - Found 27 static orders cache entries to check
2025-07-22 03:54:55,583 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 03:54:55,585 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 03:54:55,592 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 03:54:55,598 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 03:54:55,604 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 03:54:55,607 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 03:54:55,640 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 03:54:55,648 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 03:54:55,661 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 03:54:55,663 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 03:54:55,667 - WARNING - app - Found stale cache entry for user live:27, will be refreshed on next access
2025-07-22 03:54:55,669 - WARNING - app - Found stale cache entry for user live:28, will be refreshed on next access
2025-07-22 03:54:55,672 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 03:54:55,674 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 03:54:55,678 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 03:54:55,687 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 03:54:55,690 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 03:54:55,694 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 03:54:55,701 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 03:54:55,704 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 03:54:55,705 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 03:54:55,705 - INFO - app - Completed stale cache cleanup task
2025-07-22 03:54:55,934 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:54:55,935 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:54:56,241 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:54:56,252 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:54:56,257 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:54:56,257 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:54:56,395 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:56,395 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:54:56,529 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:56,529 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:54:56,652 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:54:58,348 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 1 symbols for user 1
2025-07-22 03:54:58,349 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDCAD']
2025-07-22 03:55:00,005 - INFO - app - [SCHEDULER] Starting daily_swap_charge_job...
2025-07-22 03:55:00,005 - INFO - app - Executing daily swap charge job...
2025-07-22 03:55:02,016 - INFO - app - Daily swap charge job completed successfully
2025-07-22 03:55:26,730 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:55:26,731 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:55:26,731 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:55:26,731 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:55:26,835 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:55:26,836 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:55:26,836 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:55:26,977 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:26,977 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:55:27,157 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:55:27,157 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:55:27,173 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:55:27,241 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:55:27,242 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:55:27,357 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:27,357 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:55:27,565 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:55:27,850 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:55:27,864 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:55:27,867 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:55:27,867 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:55:28,038 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:55:28,315 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.68336140502566973468523562% which is below threshold 100.0%
2025-07-22 03:55:28,315 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.1942665009867699729551933', 'margin': '967.17', 'free_margin': '-476.9757334990132300270448067', 'profit_loss': '-4.865733499013230027044806666', 'margin_level': '50.68336140502566973468523562', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-4.865733499013230027044806666', 'current_price': '0.891'}], 'margin_call': True}
2025-07-22 03:55:28,318 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.68336140502566973468523562
2025-07-22 03:55:28,320 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:55:28,321 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:55:28,421 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:28,422 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:55:28,552 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:28,552 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:55:28,648 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:28,648 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:55:28,733 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:28,733 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:55:28,861 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:28,861 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:55:28,980 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:28,980 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:55:29,192 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:55:29,478 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:55:29,482 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:55:29,491 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:55:29,495 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:55:29,818 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:55:30,106 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:55:30,126 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:55:30,129 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:55:30,129 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:55:30,226 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:30,226 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:55:30,358 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:55:30,651 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:55:30,656 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:55:30,657 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:55:30,657 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:55:30,765 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:30,765 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:55:30,966 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:30,967 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:55:31,075 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:31,076 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:55:31,309 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:55:31,612 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-74500.72500000000020000000000', 'margin': '308.75', 'free_margin': '-74809.47500000000020000000000', 'profit_loss': '-84138.48500000000020000000000', 'margin_level': '-24129.78947368421059109311741', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-112.9250000000002000000000000', 'current_price': '38.841499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84025.56000000000000000000000', 'current_price': '118697.91'}], 'margin_call': False}
2025-07-22 03:55:31,615 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -24129.78947368421059109311741
2025-07-22 03:55:31,615 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:55:31,616 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:55:31,911 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:55:32,204 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:55:32,211 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:55:32,212 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:55:32,212 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:55:32,412 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 03:55:32,703 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 03:55:32,717 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 03:55:32,720 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 03:55:32,720 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:55:32,844 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:32,845 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 03:55:32,936 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:32,937 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 03:55:33,043 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:33,043 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 03:55:33,153 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:33,153 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:55:33,262 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:33,263 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:55:33,266 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:55:33,266 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:55:33,298 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:55:33,329 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:55:33,330 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:55:33,453 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:33,453 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:55:33,456 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:55:33,456 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:55:33,459 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:55:33,459 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:55:33,626 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:55:33,626 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:55:33,929 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:55:33,935 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:55:33,936 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:55:33,936 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:55:34,250 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:55:34,251 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:55:34,648 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:55:34,652 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:55:34,654 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:55:34,654 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:55:34,746 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:34,746 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:55:34,843 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:34,843 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:55:34,969 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:55:38,420 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:55:38,715 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:56:05,039 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:56:05,039 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:56:05,039 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:56:05,039 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:56:05,148 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:56:05,148 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:56:05,148 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:56:05,260 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:05,261 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:56:05,366 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:56:05,366 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:56:05,394 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:56:05,457 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:56:05,457 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:56:05,593 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:05,593 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:56:05,783 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:56:06,089 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:56:06,096 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:56:06,099 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:56:06,099 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:56:06,261 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:56:06,556 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.68336140502566973468523562% which is below threshold 100.0%
2025-07-22 03:56:06,556 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.1942665009867699729551933', 'margin': '967.17', 'free_margin': '-476.9757334990132300270448067', 'profit_loss': '-4.865733499013230027044806666', 'margin_level': '50.68336140502566973468523562', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-4.865733499013230027044806666', 'current_price': '0.891'}], 'margin_call': True}
2025-07-22 03:56:06,560 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.68336140502566973468523562
2025-07-22 03:56:06,562 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:56:06,562 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:56:06,666 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:06,667 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:56:06,831 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:06,831 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:56:06,948 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:06,948 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:56:07,072 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:07,072 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:56:07,171 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:07,171 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:56:07,312 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:07,313 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:56:07,557 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:56:07,843 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:56:07,850 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:56:07,852 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:56:07,852 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:56:08,088 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:56:08,378 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:56:08,380 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:56:08,383 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:56:08,383 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:56:08,473 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:08,474 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:56:08,690 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:56:08,986 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:56:08,994 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:56:09,005 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:56:09,005 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:56:09,162 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:09,162 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:56:09,280 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:09,281 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:56:09,413 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:09,414 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:56:09,609 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:56:09,902 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-74500.87500000000020000000000', 'margin': '308.75', 'free_margin': '-74809.62500000000020000000000', 'profit_loss': '-84138.63500000000020000000000', 'margin_level': '-24129.83805668016200809716599', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-113.0750000000002000000000000', 'current_price': '38.838499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-84025.56000000000000000000000', 'current_price': '118697.91'}], 'margin_call': False}
2025-07-22 03:56:09,906 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -24129.83805668016200809716599
2025-07-22 03:56:09,906 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:56:09,906 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:56:10,122 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:56:10,411 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:56:10,414 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:56:10,416 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:56:10,416 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:56:10,664 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 03:56:10,961 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 03:56:10,968 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 03:56:10,970 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 03:56:10,971 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:56:11,151 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:11,151 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 03:56:11,286 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:11,287 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 03:56:11,490 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:11,490 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 03:56:11,618 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:11,618 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:56:11,739 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:11,739 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:56:11,740 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:56:11,741 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:56:11,750 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:56:11,780 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:56:11,781 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:56:11,872 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:11,872 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:56:11,873 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:56:11,873 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:56:11,874 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:56:11,875 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:56:12,044 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:56:12,044 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:56:12,340 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:56:12,346 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:56:12,347 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:56:12,348 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:56:12,481 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:56:12,481 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:56:12,775 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:56:12,779 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:56:12,782 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:56:12,782 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:56:12,911 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:12,911 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:56:13,015 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:13,015 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:56:13,117 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:38,428 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:56:38,708 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:56:43,191 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:56:43,192 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:56:43,192 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:56:43,193 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:56:43,413 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:56:43,414 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:56:43,414 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:56:43,682 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:43,683 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:56:43,849 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:56:43,850 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:56:43,876 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:56:43,932 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:56:43,932 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:56:44,039 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:44,040 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:56:44,251 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:56:44,596 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:56:44,606 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:56:44,610 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:56:44,610 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:56:44,892 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:56:45,508 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.67130258075375147593684391% which is below threshold 100.0%
2025-07-22 03:56:45,509 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.0776371702760581498183732', 'margin': '967.17', 'free_margin': '-477.0923628297239418501816268', 'profit_loss': '-4.982362829723941850181626821', 'margin_level': '50.67130258075375147593684391', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-4.982362829723941850181626821', 'current_price': '0.89084'}], 'margin_call': True}
2025-07-22 03:56:45,515 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.67130258075375147593684391
2025-07-22 03:56:45,518 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:56:45,518 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:56:45,642 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:45,642 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:56:45,745 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:45,746 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:56:45,855 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:45,856 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:56:45,983 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:45,984 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:56:46,142 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:46,142 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:56:46,260 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:46,260 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:56:46,486 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:56:46,776 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:56:46,782 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:56:46,784 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:56:46,785 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:56:46,971 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:56:47,260 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:56:47,263 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:56:47,267 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:56:47,267 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:56:47,394 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:47,394 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:56:47,650 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:56:47,937 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:56:47,941 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:56:47,944 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:56:47,944 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:56:48,074 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:48,074 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:56:48,187 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:48,187 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:56:48,299 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:48,299 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:56:48,576 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:56:48,868 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-73539.31500000000020000000000', 'margin': '308.75', 'free_margin': '-73848.06500000000020000000000', 'profit_loss': '-83177.07500000000020000000000', 'margin_level': '-23818.40161943319844534412955', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-113.3750000000002000000000000', 'current_price': '38.832499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83063.70000000000000000000000', 'current_price': '118858.22'}], 'margin_call': False}
2025-07-22 03:56:48,878 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -23818.40161943319844534412955
2025-07-22 03:56:48,878 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:56:48,878 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:56:49,127 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:56:49,429 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:56:49,432 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:56:49,434 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:56:49,434 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:56:49,677 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 03:56:49,966 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 03:56:49,969 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 03:56:49,971 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 03:56:49,971 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:56:50,095 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:50,095 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 03:56:50,187 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:50,188 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 03:56:50,295 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:50,295 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 03:56:50,405 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:50,405 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:56:50,518 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:50,518 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:56:50,520 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:56:50,521 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:56:50,541 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:56:50,574 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:56:50,575 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:56:50,717 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:50,717 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:56:50,721 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:56:50,722 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:56:50,723 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:56:50,723 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:56:50,940 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:56:50,941 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:56:51,234 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:56:51,236 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:56:51,236 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:56:51,236 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:56:51,457 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:56:51,459 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:56:51,736 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:56:51,745 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:56:51,747 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:56:51,747 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:56:51,871 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:51,871 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:56:51,977 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:51,977 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:56:52,080 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:56:52,173 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 1
2025-07-22 03:56:52,176 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 1
2025-07-22 03:56:52,177 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 1
2025-07-22 03:56:52,181 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 1
2025-07-22 03:56:52,254 - WARNING - app.api.v1.endpoints.users - Refresh token valid, but user ID 1 not found or inactive.
2025-07-22 03:56:52,257 - WARNING - app.api.v1.endpoints.users - Refresh token valid, but user ID 1 not found or inactive.
2025-07-22 03:56:52,261 - INFO - app.api.v1.endpoints.users - Invalidated refresh token for invalid user ID 1.
2025-07-22 03:56:52,262 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: User not found or inactive
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 345, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive
2025-07-22 03:56:52,291 - INFO - app.api.v1.endpoints.users - Invalidated refresh token for invalid user ID 1.
2025-07-22 03:56:52,292 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: User not found or inactive
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 345, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive
2025-07-22 03:57:22,141 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:57:22,142 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:57:22,142 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:57:22,144 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:57:22,233 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:57:22,234 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:57:22,234 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:57:22,339 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:22,339 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:57:22,437 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:57:22,437 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:57:22,459 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:57:22,521 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:57:22,522 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:57:22,632 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:22,633 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:57:22,976 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:57:23,280 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:57:23,283 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:57:23,288 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:57:23,289 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:57:23,618 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:57:23,927 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.67055796357271935150392148% which is below threshold 100.0%
2025-07-22 03:57:23,927 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.0704354562862697519404774', 'margin': '967.17', 'free_margin': '-477.0995645437137302480595226', 'profit_loss': '-4.989564543713730248059522591', 'margin_level': '50.67055796357271935150392148', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-4.989564543713730248059522591', 'current_price': '0.89083'}], 'margin_call': True}
2025-07-22 03:57:23,931 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.67055796357271935150392148
2025-07-22 03:57:23,932 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:57:23,932 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:57:24,037 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:24,038 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:57:24,179 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:24,180 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:57:24,306 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:24,306 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:57:24,428 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:24,428 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:57:24,534 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:24,534 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:57:24,661 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:24,661 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:57:24,870 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:57:25,165 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:57:25,167 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:57:25,168 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:57:25,169 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:57:25,468 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:57:25,754 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:57:25,760 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:57:25,764 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:57:25,764 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:57:25,893 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:25,894 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:57:26,039 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:57:26,327 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:57:26,334 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:57:26,336 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:57:26,337 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:57:26,447 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:26,448 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:57:26,577 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:26,577 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:57:26,693 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:26,693 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:57:26,931 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:57:27,225 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-73396.52500000000030000000000', 'margin': '308.75', 'free_margin': '-73705.27500000000030000000000', 'profit_loss': '-83034.28500000000030000000000', 'margin_level': '-23772.15384615384625101214575', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-113.3250000000003000000000000', 'current_price': '38.833499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-82920.96000000000000000000000', 'current_price': '118882.01'}], 'margin_call': False}
2025-07-22 03:57:27,228 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -23772.15384615384625101214575
2025-07-22 03:57:27,228 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:57:27,229 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:57:27,473 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:57:27,762 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:57:27,771 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:57:27,801 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:57:27,801 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:57:28,059 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 03:57:28,346 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 03:57:28,354 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 03:57:28,355 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 03:57:28,355 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:57:28,477 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:28,477 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 03:57:28,608 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:28,608 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 03:57:28,720 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:28,720 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 03:57:28,819 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:28,819 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:57:28,923 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:28,924 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:57:28,925 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:57:28,925 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:57:28,946 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:57:28,977 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:57:28,977 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:57:29,096 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:29,097 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:57:29,099 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:57:29,099 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:57:29,102 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:57:29,103 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:57:29,345 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:57:29,346 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:57:29,640 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:57:29,644 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:57:29,645 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:57:29,645 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:57:29,871 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:57:29,872 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:57:30,161 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:57:30,171 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:57:30,191 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:57:30,194 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:57:30,347 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:30,347 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:57:30,462 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:30,462 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:57:30,575 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:57:38,426 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:57:38,725 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:58:00,652 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:58:00,652 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:58:00,653 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:58:00,653 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:58:00,760 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:58:00,760 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:58:00,760 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:58:00,869 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:00,869 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:58:00,966 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:58:00,966 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:58:00,987 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:58:01,057 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:58:01,058 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:58:01,200 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:01,200 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:58:01,356 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:58:01,636 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:58:01,642 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:58:01,645 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:58:01,645 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:58:01,829 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:58:02,128 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.66749061174748848116150857% which is below threshold 100.0%
2025-07-22 03:58:02,128 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.0407689496381843432497624', 'margin': '967.17', 'free_margin': '-477.1292310503618156567502376', 'profit_loss': '-5.019231050361815656750237556', 'margin_level': '50.66749061174748848116150857', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-5.019231050361815656750237556', 'current_price': '0.89079'}], 'margin_call': True}
2025-07-22 03:58:02,132 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.66749061174748848116150857
2025-07-22 03:58:02,135 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:58:02,135 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:58:02,253 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:02,253 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:58:02,417 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:02,417 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:58:02,534 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:02,534 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:58:02,638 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:02,638 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:58:02,757 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:02,757 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:58:02,855 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:02,855 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:58:03,059 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:58:03,363 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:58:03,368 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:58:03,371 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:58:03,371 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:58:03,653 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:58:03,951 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:58:03,954 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:58:03,957 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:58:03,957 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:58:04,055 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:04,055 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:58:04,250 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:58:04,554 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:58:04,558 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:58:04,566 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:58:04,567 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:58:04,728 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:04,728 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:58:04,847 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:04,848 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:58:04,961 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:04,961 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:58:05,205 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:58:05,497 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-73539.77500000000000000000000', 'margin': '308.75', 'free_margin': '-73848.52500000000000000000000', 'profit_loss': '-83177.53500000000000000000000', 'margin_level': '-23818.55060728744939271255061', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-113.775000000000000000000000', 'current_price': '38.8245'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83063.76000000000000000000000', 'current_price': '118858.21'}], 'margin_call': False}
2025-07-22 03:58:05,503 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -23818.55060728744939271255061
2025-07-22 03:58:05,503 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:58:05,503 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:58:05,713 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:58:06,004 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:58:06,006 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:58:06,008 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:58:06,009 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:58:06,221 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 03:58:06,502 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 03:58:06,507 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 03:58:06,508 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 03:58:06,509 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:58:06,613 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:06,614 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 03:58:06,727 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:06,728 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 03:58:06,868 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:06,869 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 03:58:06,998 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:06,998 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:58:07,119 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:07,120 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:58:07,123 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:58:07,123 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:58:07,132 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:58:07,177 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:58:07,177 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:58:07,343 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:07,343 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:58:07,347 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:58:07,347 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:58:07,349 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:58:07,349 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:58:07,664 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:58:07,666 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:58:07,960 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:58:07,966 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:58:07,966 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:58:07,966 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:58:08,209 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:58:08,210 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:58:08,501 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:58:08,507 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:58:08,509 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:58:08,509 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:58:08,611 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:08,611 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:58:08,703 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:08,704 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:58:08,834 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:38,419 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:58:38,709 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:58:38,918 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:58:38,918 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:58:38,919 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:58:38,919 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:58:39,014 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:58:39,014 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:58:39,014 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:58:39,124 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:39,124 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:58:39,257 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:58:39,257 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:58:39,270 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:58:39,335 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:58:39,335 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:58:39,428 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:39,428 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:58:39,599 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:58:39,896 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:58:39,904 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:58:39,907 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:58:39,908 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:58:40,089 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:58:40,391 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.67130627033983506315283544% which is below threshold 100.0%
2025-07-22 03:58:40,391 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.0776728548457827802952785', 'margin': '967.17', 'free_margin': '-477.0923271451542172197047215', 'profit_loss': '-4.982327145154217219704721532', 'margin_level': '50.67130627033983506315283544', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-4.982327145154217219704721532', 'current_price': '0.89084'}], 'margin_call': True}
2025-07-22 03:58:40,392 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.67130627033983506315283544
2025-07-22 03:58:40,393 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:58:40,393 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:58:40,492 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:40,492 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:58:40,599 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:40,600 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:58:40,726 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:40,726 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:58:40,840 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:40,841 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:58:40,982 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:40,982 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:58:41,100 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:41,100 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:58:41,244 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:58:41,540 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:58:41,545 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:58:41,547 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:58:41,548 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:58:41,704 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:58:41,993 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:58:42,164 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:58:42,178 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:58:42,179 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:58:42,309 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:42,309 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:58:42,469 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:58:42,754 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:58:42,769 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:58:42,772 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:58:42,772 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:58:42,918 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:42,918 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:58:43,059 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:43,059 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:58:43,189 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:43,189 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:58:43,325 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:58:43,620 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-73630.11500000000000000000000', 'margin': '308.75', 'free_margin': '-73938.86500000000000000000000', 'profit_loss': '-83267.87500000000000000000000', 'margin_level': '-23847.81052631578947368421053', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-113.575000000000000000000000', 'current_price': '38.8285'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83154.30000000000000000000000', 'current_price': '118843.12'}], 'margin_call': False}
2025-07-22 03:58:43,624 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -23847.81052631578947368421053
2025-07-22 03:58:43,625 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:58:43,625 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:58:43,872 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:58:44,161 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:58:44,164 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:58:44,170 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:58:44,171 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:58:44,412 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 03:58:44,705 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 03:58:44,707 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 03:58:44,710 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 03:58:44,711 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:58:44,808 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:44,808 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 03:58:44,933 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:44,933 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 03:58:45,037 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:45,037 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 03:58:45,124 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:45,125 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:58:45,219 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:45,219 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:58:45,220 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:58:45,221 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:58:45,231 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:58:45,274 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:58:45,274 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:58:45,386 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:45,386 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:58:45,388 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:58:45,388 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:58:45,389 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:58:45,390 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:58:45,548 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:58:45,548 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:58:45,843 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:58:45,850 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:58:45,850 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:58:45,850 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:58:46,008 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:58:46,009 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:58:46,320 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:58:46,322 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:58:46,325 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:58:46,325 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:58:46,440 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:46,441 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:58:46,620 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:58:46,620 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:58:46,721 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:16,784 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:59:16,785 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:59:16,785 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:59:16,785 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:59:16,915 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:59:16,916 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:59:16,916 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:59:17,025 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:17,025 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:59:17,137 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:59:17,137 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:59:17,159 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:59:17,221 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:59:17,221 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:59:17,351 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:17,351 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:59:17,527 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:59:17,837 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:59:17,841 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:59:17,842 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:59:17,843 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:59:18,074 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:59:18,379 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.66524576033011504809672692% which is below threshold 100.0%
2025-07-22 03:59:18,380 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.0190574201847737106771138', 'margin': '967.17', 'free_margin': '-477.1509425798152262893228862', 'profit_loss': '-5.040942579815226289322886212', 'margin_level': '50.66524576033011504809672692', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-5.040942579815226289322886212', 'current_price': '0.89076'}], 'margin_call': True}
2025-07-22 03:59:18,382 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.66524576033011504809672692
2025-07-22 03:59:18,384 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:59:18,384 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:59:18,502 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:18,502 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:59:18,619 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:18,619 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:59:18,761 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:18,761 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:59:18,908 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:18,908 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:59:19,171 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:19,171 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:59:19,288 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:19,289 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:59:19,484 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:59:19,779 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:59:19,783 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:59:19,786 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:59:19,787 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:59:20,052 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:59:20,344 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:59:20,347 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:59:20,348 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:59:20,348 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:59:20,453 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:20,453 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:59:20,693 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:59:20,982 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:59:20,986 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:59:20,990 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:59:20,990 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:59:21,107 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:21,107 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:59:21,222 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:21,222 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:59:21,365 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:21,366 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:59:21,629 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:59:21,930 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-73582.52500000000000000000000', 'margin': '308.75', 'free_margin': '-73891.27500000000000000000000', 'profit_loss': '-83220.28500000000000000000000', 'margin_level': '-23832.39676113360323886639676', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-113.625000000000000000000000', 'current_price': '38.8275'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83106.66000000000000000000000', 'current_price': '118851.06'}], 'margin_call': False}
2025-07-22 03:59:21,942 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -23832.39676113360323886639676
2025-07-22 03:59:21,942 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:59:21,942 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:59:22,170 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:59:22,454 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:59:22,456 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:59:22,459 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:59:22,459 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:59:22,657 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 03:59:22,946 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 03:59:22,949 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 03:59:22,950 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 03:59:22,950 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 03:59:23,038 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:23,038 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 03:59:23,128 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:23,128 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 03:59:23,215 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:23,216 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 03:59:23,305 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:23,305 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 03:59:23,404 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:23,404 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 03:59:23,406 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 03:59:23,406 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 03:59:23,418 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:59:23,447 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 03:59:23,447 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 03:59:23,540 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:23,540 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 03:59:23,542 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 03:59:23,542 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 03:59:23,544 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 03:59:23,544 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 03:59:23,794 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 03:59:23,795 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 03:59:24,088 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 03:59:24,100 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 03:59:24,101 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 03:59:24,101 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 03:59:24,302 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:59:24,304 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 03:59:24,596 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:59:24,600 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:59:24,604 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:59:24,604 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 03:59:24,703 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:24,703 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 03:59:24,790 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:24,790 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 03:59:24,894 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:38,426 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 03:59:38,715 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 03:59:48,876 - INFO - app - Starting cache validation task
2025-07-22 03:59:49,008 - INFO - app - Validating cache for 37 users
2025-07-22 03:59:49,008 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,092 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,130 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,227 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,298 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,369 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,460 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,532 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,615 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,696 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,771 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,843 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-22 03:59:49,918 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,001 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,082 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,168 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,249 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,323 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,396 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,467 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,540 - WARNING - app - User 27: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,620 - WARNING - app - User 28: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,706 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,787 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,869 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-22 03:59:50,952 - WARNING - app - User 33: Missing balance/margin cache, refreshing...
2025-07-22 03:59:51,040 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-22 03:59:51,136 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-22 03:59:51,218 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 03:59:51,296 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-22 03:59:51,430 - INFO - app - Cache validation completed
2025-07-22 03:59:54,956 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:59:54,956 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 03:59:54,956 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 03:59:54,956 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 03:59:55,067 - INFO - app - [AUTO-CUTOFF] Found 26 live users and 11 demo users.
2025-07-22 03:59:55,067 - INFO - app - [AUTO-CUTOFF] Processing 37 users for dynamic portfolio update...
2025-07-22 03:59:55,067 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-22 03:59:55,166 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:55,166 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 03:59:55,259 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 03:59:55,259 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 03:59:55,268 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 03:59:55,324 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 03:59:55,325 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 03:59:55,417 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:55,418 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 03:59:55,574 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 03:59:55,992 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 03:59:55,995 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 03:59:55,997 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 03:59:55,997 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 03:59:56,126 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 03:59:56,412 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 50.67432172259634696591957146% which is below threshold 100.0%
2025-07-22 03:59:56,412 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '495.06000000', 'equity': '490.1068374044350889502843193', 'margin': '967.17', 'free_margin': '-477.0631625955649110497156807', 'profit_loss': '-4.953162595564911049715680685', 'margin_level': '50.67432172259634696591957146', 'positions': [{'order_id': '1000099-001', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89752000'), 'margin': Decimal('6.55364428'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 11, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-15T00:15:22', 'profit_loss': '-4.953162595564911049715680685', 'current_price': '0.89088'}], 'margin_call': True}
2025-07-22 03:59:56,419 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 50.67432172259634696591957146
2025-07-22 03:59:56,430 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 03:59:56,430 - INFO - app - [AUTO-CUTOFF] Processing user 12 (live), group: Standard
2025-07-22 03:59:56,510 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:56,510 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 03:59:56,588 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:56,588 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 03:59:56,674 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:56,674 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 03:59:56,764 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:56,764 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 03:59:56,842 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:56,842 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 03:59:56,918 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:56,918 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 03:59:57,037 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 19...
2025-07-22 03:59:57,321 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 19: {'balance': '9610.04000000', 'equity': '9610.04000000', 'margin': '13.82', 'free_margin': '9596.22000000', 'profit_loss': '0.0', 'margin_level': '69537.19247467438494934876990', 'positions': [], 'margin_call': False}
2025-07-22 03:59:57,324 - INFO - app - [AUTO-CUTOFF] User 19 margin_level: 69537.19247467438494934876990
2025-07-22 03:59:57,327 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 19
2025-07-22 03:59:57,327 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 03:59:57,548 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 20...
2025-07-22 03:59:57,830 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 20: {'balance': '8712.00000000', 'equity': '8712.00000000', 'margin': '18.38', 'free_margin': '8693.62000000', 'profit_loss': '0.0', 'margin_level': '47399.34711643090315560391730', 'positions': [], 'margin_call': False}
2025-07-22 03:59:57,834 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-22 03:59:57,835 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 20
2025-07-22 03:59:57,835 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 03:59:57,927 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:57,927 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 03:59:58,055 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 22...
2025-07-22 03:59:58,330 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 22: {'balance': '5960.41000000', 'equity': '5960.41000000', 'margin': '26.25', 'free_margin': '5934.16000000', 'profit_loss': '0.0', 'margin_level': '22706.32380952380952380952381', 'positions': [], 'margin_call': False}
2025-07-22 03:59:58,333 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-22 03:59:58,334 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 22
2025-07-22 03:59:58,335 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 03:59:58,428 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:58,429 - INFO - app - [AUTO-CUTOFF] Processing user 24 (live), group: Group B
2025-07-22 03:59:58,546 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:58,546 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 03:59:58,671 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-22 03:59:58,671 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 03:59:58,908 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 03:59:59,188 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '9637.76000000', 'equity': '-73598.76500000000000000000000', 'margin': '308.75', 'free_margin': '-73907.51500000000000000000000', 'profit_loss': '-83236.52500000000000000000000', 'margin_level': '-23837.65668016194331983805668', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-113.425000000000000000000000', 'current_price': '38.8315'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83123.10000000000000000000000', 'current_price': '118848.32'}], 'margin_call': False}
2025-07-22 03:59:59,200 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: -23837.65668016194331983805668
2025-07-22 03:59:59,200 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 03:59:59,200 - INFO - app - [AUTO-CUTOFF] Processing user 27 (live), group: Elite
2025-07-22 03:59:59,379 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 27...
2025-07-22 03:59:59,661 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 27: {'balance': '6672.64000000', 'equity': '6672.64000000', 'margin': '19.55', 'free_margin': '6653.09000000', 'profit_loss': '0.0', 'margin_level': '34131.15089514066496163682864', 'positions': [], 'margin_call': False}
2025-07-22 03:59:59,674 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-22 03:59:59,675 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 27
2025-07-22 03:59:59,675 - INFO - app - [AUTO-CUTOFF] Processing user 28 (live), group: Classic
2025-07-22 03:59:59,885 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 28...
2025-07-22 04:00:00,170 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 28: {'balance': '10023.20000000', 'equity': '10023.20000000', 'margin': '9705.52', 'free_margin': '317.68000000', 'profit_loss': '0.0', 'margin_level': '103.2731888657176534590624717', 'positions': [], 'margin_call': False}
2025-07-22 04:00:00,172 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-22 04:00:00,174 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 28
2025-07-22 04:00:00,174 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 04:00:00,264 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:00,265 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Classic
2025-07-22 04:00:00,370 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:00,371 - INFO - app - [AUTO-CUTOFF] Processing user 31 (live), group: Standard
2025-07-22 04:00:00,495 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:00,495 - INFO - app - [AUTO-CUTOFF] Processing user 33 (live), group: Classic
2025-07-22 04:00:00,598 - WARNING - app - [AUTO-CUTOFF] User 33 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:00,598 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 04:00:00,724 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:00,724 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 04:00:00,727 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 04:00:00,727 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 04:00:00,759 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 04:00:00,792 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 04:00:00,792 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 04:00:00,934 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:00,934 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 04:00:00,936 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 04:00:00,936 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 04:00:00,939 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 04:00:00,939 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 04:00:01,252 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 04:00:01,252 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 04:00:01,537 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '5.75000000', 'equity': '5.75000000', 'margin': '0.0', 'free_margin': '5.75000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 04:00:01,549 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-22 04:00:01,549 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 04:00:01,549 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 04:00:01,788 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 04:00:01,789 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 04:00:02,083 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9696.78000000', 'equity': '9696.78000000', 'margin': '6.51', 'free_margin': '9690.27000000', 'profit_loss': '0.0', 'margin_level': '148952.0737327188940092165899', 'positions': [], 'margin_call': False}
2025-07-22 04:00:02,089 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 148952.0737327188940092165899
2025-07-22 04:00:02,090 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 04:00:02,090 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 04:00:02,204 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:02,204 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 04:00:02,365 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:02,365 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 04:00:02,517 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 04:00:23,257 - INFO - app - Application shutdown initiated
2025-07-22 04:00:23,261 - INFO - app - Scheduler shutdown completed
2025-07-22 04:00:23,674 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 04:00:24,383 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 04:00:24,384 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 04:00:24,394 - INFO - app - Redis connection closed
2025-07-22 04:00:24,394 - INFO - app - Application shutdown completed
2025-07-22 21:29:30,909 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:29:30,959 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:29:30,971 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:29:30,971 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:29:31,435 - INFO - app - Application starting up - Trading system initialized
2025-07-22 21:29:31,435 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 21:29:31,435 - INFO - app - Environment: PRODUCTION
2025-07-22 21:29:31,508 - INFO - app - Application startup initiated
2025-07-22 21:29:31,508 - INFO - app - Initializing core services...
2025-07-22 21:29:31,563 - INFO - app - Firebase initialized
2025-07-22 21:29:31,563 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 21:29:35,636 - WARNING - app - Redis initialization failed
2025-07-22 21:29:35,636 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 21:29:35,640 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 21:29:35,640 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 21:29:35,641 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 21:29:35,642 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 21:29:35,642 - INFO - app - Scheduler initialized
2025-07-22 21:29:35,642 - INFO - app - Background tasks initialized
2025-07-22 21:29:35,642 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:29:36,939 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:29:36,939 - INFO - app - Application startup completed successfully
2025-07-22 21:29:36,939 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:29:36,939 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 21:29:37,655 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:30:35,643 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:30:35,936 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:31:18,557 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 21:31:27,872 - INFO - app - Application shutdown initiated
2025-07-22 21:31:27,872 - INFO - app - Scheduler shutdown completed
2025-07-22 21:31:27,873 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 21:31:28,249 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 21:31:28,249 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 21:31:28,249 - INFO - app - Application shutdown completed
2025-07-22 21:32:50,104 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:32:50,145 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:32:50,161 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:32:50,161 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:32:50,501 - INFO - app - Application starting up - Trading system initialized
2025-07-22 21:32:50,502 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 21:32:50,502 - INFO - app - Environment: PRODUCTION
2025-07-22 21:32:50,572 - INFO - app - Application startup initiated
2025-07-22 21:32:50,573 - INFO - app - Initializing core services...
2025-07-22 21:32:50,630 - INFO - app - Firebase initialized
2025-07-22 21:32:50,630 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 21:32:50,657 - INFO - app - Redis initialized
2025-07-22 21:32:51,446 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 21:32:51,450 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 21:32:51,455 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 21:32:51,455 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 21:32:51,455 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 21:32:51,456 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 21:32:51,456 - INFO - app - Scheduler initialized
2025-07-22 21:32:51,459 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:32:51,460 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 21:32:52,630 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:32:52,654 - INFO - app - Starting stale cache cleanup task
2025-07-22 21:32:52,688 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 21:32:52,688 - INFO - app - Background tasks initialized
2025-07-22 21:32:52,688 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:32:53,443 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:32:53,444 - INFO - app - Application startup completed successfully
2025-07-22 21:32:53,444 - INFO - app - Starting cache validation task
2025-07-22 21:32:53,448 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 21:32:53,451 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 21:32:53,453 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 21:32:53,453 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:32:53,453 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:32:53,453 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:32:53,453 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:32:53,459 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 21:32:53,461 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 21:32:53,463 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 21:32:53,464 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 21:32:53,468 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 21:32:53,492 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 21:32:53,513 - INFO - app - Validating cache for 30 users
2025-07-22 21:32:53,514 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:32:53,515 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:32:53,515 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:32:53,521 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 21:32:53,536 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 21:32:53,536 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,540 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:32:53,540 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:32:53,543 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 21:32:53,546 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 21:32:53,546 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,547 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 21:32:53,549 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 21:32:53,549 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 21:32:53,552 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-22 21:32:53,552 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 21:32:53,553 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 21:32:53,555 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 21:32:53,555 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:32:53,556 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 21:32:53,557 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 21:32:53,559 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 21:32:53,562 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 21:32:53,562 - INFO - app - Completed stale cache cleanup task
2025-07-22 21:32:53,563 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:32:53,563 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:32:53,564 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,576 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,590 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,599 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,610 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,621 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,631 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,641 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,653 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,663 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,672 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,680 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,688 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,694 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,726 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,745 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,757 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,770 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-22 21:32:53,774 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:32:54,177 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:32:54,179 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:32:54,181 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-22 21:32:54,182 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:32:54,184 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:32:54,185 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3477900000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3477900000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3477800000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3477800000'}], 'margin_call': False}
2025-07-22 21:32:54,187 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:32:54,188 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:32:54,188 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:32:54,195 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-22 21:32:54,210 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-22 21:32:54,224 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 21:32:54,226 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:54,226 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:32:54,237 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-22 21:32:54,261 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:54,261 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:32:54,267 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-22 21:32:54,282 - INFO - app - Cache validation completed
2025-07-22 21:32:54,295 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:54,295 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:32:54,489 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:32:54,877 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.240953686059171652562668406% which is below threshold 100.0%
2025-07-22 21:32:54,877 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '402.656075436782234801066783', 'margin': '9494.47', 'free_margin': '-9091.813924563217765198933217', 'profit_loss': '-9499.363924563217765198933217', 'margin_level': '4.240953686059171652562668406', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9420.582000000000000000000000', 'current_price': '118945.9700000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-71.61993142110705927175747020', 'current_price': '96.0590000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-7.161993142110705927175747020', 'current_price': '96.0590000000'}], 'margin_call': True}
2025-07-22 21:32:54,879 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.240953686059171652562668406
2025-07-22 21:32:54,905 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:32:54,905 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:32:54,925 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:54,925 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:32:54,947 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:54,947 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:32:54,970 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:54,970 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:32:54,993 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:54,993 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:32:55,016 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:55,016 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:32:55,039 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:55,039 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:32:55,064 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:55,064 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:32:55,097 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:55,097 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:32:55,293 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:32:55,295 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:32:55,331 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:32:55,334 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:32:55,359 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:32:55,361 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:32:55,362 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:32:55,368 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:32:55,567 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:32:55,593 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:32:55,593 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:32:55,603 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:32:55,606 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:32:55,627 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:32:55,627 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:32:55,629 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:32:55,629 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:32:55,634 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:32:55,639 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:32:55,642 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:32:55,651 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:32:55,652 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:32:55,655 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:32:55,655 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:32:55,660 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:32:55,660 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:32:55,661 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:32:55,674 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:32:55,674 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:32:55,694 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.410792673271996523274186322% which is below threshold 100.0%
2025-07-22 21:32:55,695 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '261.852000000000000000000000', 'margin': '5936.62', 'free_margin': '-5674.768000000000000000000000', 'profit_loss': '-6127.768000000000000000000000', 'margin_level': '4.410792673271996523274186322', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6127.768000000000000000000000', 'current_price': '118945.9700000000'}], 'margin_call': True}
2025-07-22 21:32:55,696 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.410792673271996523274186322
2025-07-22 21:32:55,712 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:32:55,712 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:32:55,804 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:32:56,207 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.97406257468795156237381342% which is below threshold 100.0%
2025-07-22 21:32:56,208 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '101036.2900000000000000000000', 'margin': '146484.47', 'free_margin': '-45448.1800000000000000000000', 'profit_loss': '-83309.52000000000000000000000', 'margin_level': '68.97406257468795156237381342', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-93.90000000000000000000000000', 'current_price': '39.2220000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83215.62000000000000000000000', 'current_price': '118832.9000000000'}], 'margin_call': True}
2025-07-22 21:32:56,212 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.97406257468795156237381342
2025-07-22 21:32:56,213 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:32:56,213 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:32:56,231 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:56,231 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:32:56,244 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:56,244 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:32:56,264 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:56,264 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:32:56,265 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:32:56,265 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:32:56,268 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:32:56,270 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:32:56,270 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:32:56,283 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:56,283 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:32:56,284 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:32:56,284 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:32:56,284 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:32:56,284 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:32:56,372 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:32:56,373 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:32:56,820 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:32:56,835 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:32:56,837 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:32:56,838 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:32:56,933 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:32:56,934 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:32:57,248 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:32:57,251 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:32:57,251 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:32:57,251 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:32:57,322 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:32:57,322 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:32:57,651 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:32:57,653 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:32:57,653 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:32:57,653 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:32:57,677 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:32:57,677 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:32:57,709 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:08,450 - INFO - app - Starting stale cache cleanup task
2025-07-22 21:33:08,453 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 21:33:08,459 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 21:33:08,463 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 21:33:08,464 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 21:33:08,465 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 21:33:08,466 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 21:33:08,467 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 21:33:08,468 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 21:33:08,469 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 21:33:08,469 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 21:33:08,470 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 21:33:08,470 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 21:33:08,470 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 21:33:08,471 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 21:33:08,471 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 21:33:08,472 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 21:33:08,472 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 21:33:08,473 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-22 21:33:08,473 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 21:33:08,473 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 21:33:08,474 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 21:33:08,474 - INFO - app - Completed stale cache cleanup task
2025-07-22 21:33:27,714 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:33:27,714 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:33:27,715 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:33:27,715 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:33:27,736 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:33:27,737 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:33:27,737 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:33:27,742 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:33:27,742 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:33:27,749 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:33:27,752 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:33:27,752 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:33:27,807 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:33:28,160 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:33:28,163 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:33:28,166 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:33:28,168 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:33:28,169 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3528850000000001'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3528850000000001'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352725'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352725'}], 'margin_call': False}
2025-07-22 21:33:28,177 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:33:28,178 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:33:28,178 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:33:28,196 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,196 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:33:28,213 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,214 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:33:28,231 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,231 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:33:28,287 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:33:28,597 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.887320842440728543597924013% which is below threshold 100.0%
2025-07-22 21:33:28,597 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '369.080511189282239353341816', 'margin': '9494.47', 'free_margin': '-9125.389488810717760646658184', 'profit_loss': '-9532.939488810717760646658184', 'margin_level': '3.887320842440728543597924013', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9485.810000000000000000000000', 'current_price': '118782.9'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-42.84498982792523695150744024', 'current_price': '96.482'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.284498982792523695150744024', 'current_price': '96.482'}], 'margin_call': True}
2025-07-22 21:33:28,600 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.887320842440728543597924013
2025-07-22 21:33:28,623 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:33:28,623 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:33:28,641 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,641 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:33:28,655 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,655 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:33:28,685 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,685 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:33:28,706 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,706 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:33:28,724 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,724 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:33:28,741 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,741 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:33:28,758 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,758 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:33:28,775 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:28,775 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:33:28,822 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:33:29,184 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.135939305530756558445714902% which is below threshold 100.0%
2025-07-22 21:33:29,184 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '245.535000000000000000000000', 'margin': '5936.62', 'free_margin': '-5691.085000000000000000000000', 'profit_loss': '-6144.085000000000000000000000', 'margin_level': '4.135939305530756558445714902', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6144.085000000000000000000000', 'current_price': '118782.8'}], 'margin_call': True}
2025-07-22 21:33:29,188 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.135939305530756558445714902
2025-07-22 21:33:29,229 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:33:29,231 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:33:29,309 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:33:29,628 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.76839230807197493358852307% which is below threshold 100.0%
2025-07-22 21:33:29,628 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100735.0149999999997000000000', 'margin': '146484.47', 'free_margin': '-45749.4550000000003000000000', 'profit_loss': '-83610.79500000000030000000000', 'margin_level': '68.76839230807197493358852307', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.57500000000030000000000000', 'current_price': '39.208499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83516.22000000000000000000000', 'current_price': '118782.8'}], 'margin_call': True}
2025-07-22 21:33:29,630 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.76839230807197493358852307
2025-07-22 21:33:29,633 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:33:29,633 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:33:29,652 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:29,652 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:33:29,667 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:29,667 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:33:29,693 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:29,693 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:33:29,694 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:33:29,694 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:33:29,702 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:33:29,703 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:33:29,704 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:33:29,720 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:29,720 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:33:29,721 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:33:29,721 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:33:29,721 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:33:29,721 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:33:29,787 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:33:29,787 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:33:30,205 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:33:30,208 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:33:30,210 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:33:30,211 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:33:30,287 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:33:30,288 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:33:30,613 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:33:30,615 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:33:30,616 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:33:30,616 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:33:30,699 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:33:30,700 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:33:31,023 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:33:31,033 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:33:31,035 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:33:31,035 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:33:31,066 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:31,066 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:33:31,083 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:33:51,461 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:33:51,807 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:34:01,090 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:34:01,091 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:34:01,091 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:34:01,091 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:34:01,104 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:34:01,104 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:34:01,104 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:34:01,109 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:34:01,109 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:34:01,126 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:34:01,133 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:34:01,133 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:34:01,288 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:34:02,056 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:34:02,075 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:34:02,081 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:34:02,084 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:34:02,084 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.352865'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.352865'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352705'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352705'}], 'margin_call': False}
2025-07-22 21:34:02,086 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:34:02,087 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:34:02,087 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:34:02,128 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,128 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:34:02,170 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,170 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:34:02,209 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,209 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:34:02,273 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:34:02,664 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.815278906450620617615747019% which is below threshold 100.0%
2025-07-22 21:34:02,664 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '362.240511189282239353341816', 'margin': '9494.47', 'free_margin': '-9132.229488810717760646658184', 'profit_loss': '-9539.779488810717760646658184', 'margin_level': '3.815278906450620617615747019', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9492.650000000000000000000000', 'current_price': '118765.8'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-42.84498982792523695150744024', 'current_price': '96.482'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.284498982792523695150744024', 'current_price': '96.482'}], 'margin_call': True}
2025-07-22 21:34:02,665 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.815278906450620617615747019
2025-07-22 21:34:02,687 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:34:02,687 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:34:02,705 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,705 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:34:02,719 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,719 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:34:02,733 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,733 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:34:02,748 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,748 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:34:02,763 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,763 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:34:02,777 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,777 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:34:02,790 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,790 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:34:02,804 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:02,804 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:34:02,851 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:34:03,279 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.107303482452978294046107044% which is below threshold 100.0%
2025-07-22 21:34:03,279 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '243.835000000000000000000000', 'margin': '5936.62', 'free_margin': '-5692.785000000000000000000000', 'profit_loss': '-6145.785000000000000000000000', 'margin_level': '4.107303482452978294046107044', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6145.785000000000000000000000', 'current_price': '118765.8'}], 'margin_call': True}
2025-07-22 21:34:03,283 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.107303482452978294046107044
2025-07-22 21:34:03,311 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:34:03,311 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:34:03,367 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:34:03,685 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.69889688647540589115009939% which is below threshold 100.0%
2025-07-22 21:34:03,685 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100633.2150000000000000000000', 'margin': '146484.47', 'free_margin': '-45851.2550000000000000000000', 'profit_loss': '-83712.59500000000000000000000', 'margin_level': '68.69889688647540589115009939', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.375000000000000000000000', 'current_price': '39.2125'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83618.22000000000000000000000', 'current_price': '118765.8'}], 'margin_call': True}
2025-07-22 21:34:03,687 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.69889688647540589115009939
2025-07-22 21:34:03,688 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:34:03,688 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:34:03,706 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:03,706 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:34:03,724 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:03,725 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:34:03,743 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:03,743 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:34:03,744 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:34:03,744 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:34:03,751 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:34:03,753 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:34:03,753 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:34:03,782 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:03,782 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:34:03,783 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:34:03,783 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:34:03,784 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:34:03,784 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:34:03,936 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:34:03,936 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:34:04,303 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:34:04,305 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:34:04,307 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:34:04,308 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:34:04,481 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:34:04,482 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:34:04,815 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:34:04,816 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:34:04,816 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:34:04,816 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:34:04,878 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:34:04,879 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:34:05,185 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:34:05,187 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:34:05,187 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:34:05,187 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:34:05,209 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:05,209 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:34:05,227 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:35,232 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:34:35,233 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:34:35,233 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:34:35,233 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:34:35,248 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:34:35,248 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:34:35,249 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:34:35,259 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:34:35,259 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:34:35,280 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:34:35,283 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:34:35,283 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:34:35,439 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:34:35,741 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:34:35,744 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:34:35,748 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:34:35,751 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:34:35,751 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.352875'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.352875'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352715'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352715'}], 'margin_call': False}
2025-07-22 21:34:35,759 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:34:35,761 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:34:35,761 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:34:35,810 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:35,810 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:34:35,857 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:35,858 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:34:35,912 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:35,912 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:34:36,109 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:34:36,418 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.747104151368291030210336364% which is below threshold 100.0%
2025-07-22 21:34:36,418 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '355.767679520416981376011323', 'margin': '9494.47', 'free_margin': '-9138.702320479583018623988677', 'profit_loss': '-9546.252320479583018623988677', 'margin_level': '3.747104151368291030210336364', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9498.970000000000000000000000', 'current_price': '118750.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-42.98392770871183511271697933', 'current_price': '96.48'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.298392770871183511271697933', 'current_price': '96.48'}], 'margin_call': True}
2025-07-22 21:34:36,427 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.747104151368291030210336364
2025-07-22 21:34:36,516 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:34:36,516 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:34:36,556 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:36,556 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:34:36,591 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:36,591 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:34:36,622 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:36,622 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:34:36,657 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:36,657 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:34:36,695 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:36,695 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:34:36,731 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:36,731 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:34:36,776 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:36,776 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:34:36,824 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:36,825 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:34:36,972 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:34:37,274 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.080689011592454965957059741% which is below threshold 100.0%
2025-07-22 21:34:37,275 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '242.255000000000000000000000', 'margin': '5936.62', 'free_margin': '-5694.365000000000000000000000', 'profit_loss': '-6147.365000000000000000000000', 'margin_level': '4.080689011592454965957059741', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6147.365000000000000000000000', 'current_price': '118750.0'}], 'margin_call': True}
2025-07-22 21:34:37,286 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.080689011592454965957059741
2025-07-22 21:34:37,347 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:34:37,354 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:34:37,511 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:34:37,812 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.63421426175757730495253183% which is below threshold 100.0%
2025-07-22 21:34:37,813 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100538.4649999999998000000000', 'margin': '146484.47', 'free_margin': '-45946.0050000000002000000000', 'profit_loss': '-83807.34500000000020000000000', 'margin_level': '68.63421426175757730495253183', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.32500000000020000000000000', 'current_price': '39.213499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83713.02000000000000000000000', 'current_price': '118750.0'}], 'margin_call': True}
2025-07-22 21:34:37,815 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.63421426175757730495253183
2025-07-22 21:34:37,817 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:34:37,817 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:34:37,866 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:37,866 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:34:37,919 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:37,920 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:34:37,971 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:37,972 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:34:37,973 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:34:37,974 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:34:37,994 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:34:37,997 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:34:37,997 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:34:38,048 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:38,049 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:34:38,050 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:34:38,050 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:34:38,053 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:34:38,053 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:34:38,215 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:34:38,216 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:34:38,531 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:34:38,548 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:34:38,550 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:34:38,551 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:34:38,799 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:34:38,800 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:34:39,102 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:34:39,105 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:34:39,105 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:34:39,105 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:34:39,241 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:34:39,243 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:34:39,543 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:34:39,545 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:34:39,545 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:34:39,545 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:34:39,600 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:39,600 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:34:39,654 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:34:51,458 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:34:51,813 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:35:09,665 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:35:09,665 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:35:09,665 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:35:09,665 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:35:09,676 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:35:09,676 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:35:09,676 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:35:09,684 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:35:09,685 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:35:09,710 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:35:09,714 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:35:09,714 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:35:09,829 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:35:10,149 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:35:10,153 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:35:10,157 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:35:10,161 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:35:10,161 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.352945'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.352945'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352785'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352785'}], 'margin_call': False}
2025-07-22 21:35:10,164 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:35:10,165 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:35:10,166 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:35:10,214 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:10,214 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:35:10,268 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:10,268 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:35:10,314 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:10,315 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:35:10,484 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:35:10,863 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.757595605352409805687913564% which is below threshold 100.0%
2025-07-22 21:35:10,863 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '356.763787471502943278097247', 'margin': '9494.47', 'free_margin': '-9137.706212528497056721902753', 'profit_loss': '-9545.256212528497056721902753', 'margin_level': '3.757595605352409805687913564', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9497.370000000000000000000000', 'current_price': '118754.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-43.53292048045186974718432066', 'current_price': '96.472'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.353292048045186974718432066', 'current_price': '96.472'}], 'margin_call': True}
2025-07-22 21:35:10,865 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.757595605352409805687913564
2025-07-22 21:35:10,881 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:35:10,881 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:35:10,908 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:10,908 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:35:10,937 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:10,937 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:35:10,955 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:10,955 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:35:10,990 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:10,990 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:35:11,017 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:11,018 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:35:11,046 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:11,047 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:35:11,083 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:11,084 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:35:11,109 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:11,109 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:35:11,179 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:35:11,578 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.087426852316638086992261590% which is below threshold 100.0%
2025-07-22 21:35:11,578 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '242.655000000000000000000000', 'margin': '5936.62', 'free_margin': '-5693.965000000000000000000000', 'profit_loss': '-6146.965000000000000000000000', 'margin_level': '4.087426852316638086992261590', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6146.965000000000000000000000', 'current_price': '118754.0'}], 'margin_call': True}
2025-07-22 21:35:11,584 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.087426852316638086992261590
2025-07-22 21:35:11,675 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:35:11,675 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:35:11,808 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:35:12,193 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.65080305099919465865562404% which is below threshold 100.0%
2025-07-22 21:35:12,194 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100562.7650000000000000000000', 'margin': '146484.47', 'free_margin': '-45921.7050000000000000000000', 'profit_loss': '-83783.04500000000000000000000', 'margin_level': '68.65080305099919465865562404', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.025000000000000000000000', 'current_price': '39.2195'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83689.02000000000000000000000', 'current_price': '118754.0'}], 'margin_call': True}
2025-07-22 21:35:12,197 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.65080305099919465865562404
2025-07-22 21:35:12,198 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:35:12,199 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:35:12,237 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:12,237 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:35:12,269 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:12,269 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:35:12,306 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:12,306 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:35:12,307 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:35:12,307 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:35:12,330 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:35:12,336 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:35:12,336 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:35:12,387 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:12,388 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:35:12,389 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:35:12,389 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:35:12,390 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:35:12,390 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:35:12,509 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:35:12,510 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:35:12,856 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:35:12,859 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:35:12,861 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:35:12,861 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:35:12,951 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:35:12,952 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:35:13,273 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:35:13,276 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:35:13,276 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:35:13,276 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:35:13,342 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:35:13,343 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:35:13,727 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:35:13,730 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:35:13,730 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:35:13,730 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:35:13,930 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:13,931 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:35:13,982 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:43,990 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:35:43,991 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:35:43,991 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:35:43,991 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:35:44,005 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:35:44,005 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:35:44,006 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:35:44,017 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:35:44,017 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:35:44,034 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:35:44,041 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:35:44,041 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:35:44,223 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:35:44,555 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:35:44,558 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:35:44,563 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:35:44,575 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:35:44,575 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.352915'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.352915'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352755'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352755'}], 'margin_call': False}
2025-07-22 21:35:44,578 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:35:44,580 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:35:44,580 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:35:44,654 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:44,654 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:35:44,714 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:44,715 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:35:44,750 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:44,751 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:35:44,873 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:35:45,178 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.758818732482680438480003065% which is below threshold 100.0%
2025-07-22 21:35:45,178 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '356.879916909948349427352347', 'margin': '9494.47', 'free_margin': '-9137.590083090051650572647653', 'profit_loss': '-9545.140083090051650572647653', 'margin_level': '3.758818732482680438480003065', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9497.330000000000000000000000', 'current_price': '118754.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-43.46371190004695506604332115', 'current_price': '96.473'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.346371190004695506604332115', 'current_price': '96.473'}], 'margin_call': True}
2025-07-22 21:35:45,181 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.758818732482680438480003065
2025-07-22 21:35:45,203 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:35:45,203 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:35:45,226 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:45,227 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:35:45,246 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:45,246 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:35:45,272 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:45,272 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:35:45,295 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:45,295 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:35:45,315 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:45,315 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:35:45,333 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:45,333 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:35:45,351 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:45,351 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:35:45,372 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:45,372 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:35:45,434 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:35:45,786 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.087595298334742665018141636% which is below threshold 100.0%
2025-07-22 21:35:45,786 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '242.665000000000000000000000', 'margin': '5936.62', 'free_margin': '-5693.955000000000000000000000', 'profit_loss': '-6146.955000000000000000000000', 'margin_level': '4.087595298334742665018141636', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6146.955000000000000000000000', 'current_price': '118754.1'}], 'margin_call': True}
2025-07-22 21:35:45,788 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.087595298334742665018141636
2025-07-22 21:35:45,805 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:35:45,806 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:35:45,856 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:35:46,152 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.65138331728953929382411665% which is below threshold 100.0%
2025-07-22 21:35:46,153 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100563.6150000000000000000000', 'margin': '146484.47', 'free_margin': '-45920.8550000000000000000000', 'profit_loss': '-83782.19500000000000000000000', 'margin_level': '68.65138331728953929382411665', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-93.775000000000000000000000', 'current_price': '39.2245'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83688.42000000000000000000000', 'current_price': '118754.1'}], 'margin_call': True}
2025-07-22 21:35:46,154 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.65138331728953929382411665
2025-07-22 21:35:46,156 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:35:46,156 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:35:46,191 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:46,191 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:35:46,213 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:46,213 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:35:46,240 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:46,240 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:35:46,241 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:35:46,241 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:35:46,250 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:35:46,252 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:35:46,252 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:35:46,274 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:46,274 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:35:46,275 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:35:46,275 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:35:46,276 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:35:46,276 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:35:46,350 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:35:46,351 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:35:46,653 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:35:46,656 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:35:46,657 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:35:46,657 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:35:46,705 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:35:46,705 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:35:47,008 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:35:47,011 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:35:47,011 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:35:47,011 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:35:47,106 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:35:47,107 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:35:47,406 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:35:47,409 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:35:47,409 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:35:47,409 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:35:47,461 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:47,462 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:35:47,504 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:35:51,459 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:35:51,762 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:36:17,510 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:36:17,511 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:36:17,511 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:36:17,511 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:36:17,516 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:36:17,516 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:36:17,516 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:36:17,522 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:36:17,523 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:36:17,530 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:36:17,532 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:36:17,532 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:36:17,579 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:36:17,935 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:36:17,936 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:36:17,937 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:36:17,938 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:36:17,938 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3529250000000002'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3529250000000002'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352765'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352765'}], 'margin_call': False}
2025-07-22 21:36:17,939 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:36:17,939 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:36:17,939 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:36:17,957 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:17,957 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:36:17,973 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:17,973 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:36:17,988 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:17,988 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:36:18,050 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:36:18,450 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.709938135489796818142511641% which is below threshold 100.0%
2025-07-22 21:36:18,451 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '352.238963292638111959495325', 'margin': '9494.47', 'free_margin': '-9142.231036707361888040504675', 'profit_loss': '-9549.781036707361888040504675', 'margin_level': '3.709938135489796818142511641', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9501.970000000000000000000000', 'current_price': '118742.5'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-43.46457882487444367318606835', 'current_price': '96.473'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.346457882487444367318606835', 'current_price': '96.473'}], 'margin_call': True}
2025-07-22 21:36:18,454 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.709938135489796818142511641
2025-07-22 21:36:18,482 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:36:18,482 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:36:18,496 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:18,496 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:36:18,511 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:18,511 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:36:18,527 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:18,527 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:36:18,543 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:18,543 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:36:18,557 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:18,557 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:36:18,572 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:18,572 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:36:18,587 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:18,588 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:36:18,602 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:18,602 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:36:18,666 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:36:18,979 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.068055560234611614016056274% which is below threshold 100.0%
2025-07-22 21:36:18,980 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '241.505000000000000000000000', 'margin': '5936.62', 'free_margin': '-5695.115000000000000000000000', 'profit_loss': '-6148.115000000000000000000000', 'margin_level': '4.068055560234611614016056274', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6148.115000000000000000000000', 'current_price': '118742.5'}], 'margin_call': True}
2025-07-22 21:36:18,982 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.068055560234611614016056274
2025-07-22 21:36:19,000 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:36:19,001 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:36:19,048 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:36:19,372 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.60369908154768898027210666% which is below threshold 100.0%
2025-07-22 21:36:19,372 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100493.7650000000000000000000', 'margin': '146484.47', 'free_margin': '-45990.7050000000000000000000', 'profit_loss': '-83852.04500000000000000000000', 'margin_level': '68.60369908154768898027210666', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.025000000000000000000000', 'current_price': '39.2195'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83758.02000000000000000000000', 'current_price': '118742.5'}], 'margin_call': True}
2025-07-22 21:36:19,374 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.60369908154768898027210666
2025-07-22 21:36:19,375 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:36:19,375 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:36:19,395 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:19,395 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:36:19,407 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:19,408 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:36:19,422 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:19,422 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:36:19,423 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:36:19,423 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:36:19,427 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:36:19,428 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:36:19,428 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:36:19,440 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:19,441 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:36:19,441 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:36:19,441 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:36:19,442 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:36:19,442 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:36:19,491 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:36:19,491 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:36:19,876 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:36:19,878 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:36:19,878 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:36:19,878 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:36:19,931 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:36:19,932 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:36:20,286 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:36:20,288 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:36:20,289 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:36:20,289 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:36:20,344 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:36:20,345 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:36:20,696 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:36:20,699 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:36:20,699 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:36:20,699 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:36:20,727 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:20,727 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:36:20,742 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:50,749 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:36:50,749 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:36:50,749 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:36:50,749 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:36:50,754 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:36:50,754 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:36:50,754 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:36:50,758 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:36:50,758 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:36:50,763 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:36:50,765 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:36:50,765 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:36:50,818 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:36:51,116 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:36:51,119 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:36:51,121 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:36:51,122 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:36:51,122 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.352935'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.352935'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352775'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352775'}], 'margin_call': False}
2025-07-22 21:36:51,123 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:36:51,124 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:36:51,124 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:36:51,146 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,147 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:36:51,170 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,170 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:36:51,185 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,185 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:36:51,241 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:36:51,538 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:36:51,839 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:36:51,840 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.709944831484410705003461331% which is below threshold 100.0%
2025-07-22 21:36:51,840 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '352.239599041837929063342135', 'margin': '9494.47', 'free_margin': '-9142.230400958162070936657865', 'profit_loss': '-9549.780400958162070936657865', 'margin_level': '3.709944831484410705003461331', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9501.970000000000000000000000', 'current_price': '118742.5'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-43.46400087105642812423442306', 'current_price': '96.473'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.346400087105642812423442306', 'current_price': '96.473'}], 'margin_call': True}
2025-07-22 21:36:51,841 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.709944831484410705003461331
2025-07-22 21:36:51,856 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:36:51,856 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:36:51,872 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,873 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:36:51,889 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,889 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:36:51,903 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,904 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:36:51,922 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,922 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:36:51,936 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,936 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:36:51,952 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,952 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:36:51,966 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,966 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:36:51,981 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:51,981 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:36:52,026 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:36:52,335 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.068055560234611614016056274% which is below threshold 100.0%
2025-07-22 21:36:52,335 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '241.505000000000000000000000', 'margin': '5936.62', 'free_margin': '-5695.115000000000000000000000', 'profit_loss': '-6148.115000000000000000000000', 'margin_level': '4.068055560234611614016056274', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6148.115000000000000000000000', 'current_price': '118742.5'}], 'margin_call': True}
2025-07-22 21:36:52,337 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.068055560234611614016056274
2025-07-22 21:36:52,361 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:36:52,361 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:36:52,412 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:36:52,709 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.60352841499170505924621224% which is below threshold 100.0%
2025-07-22 21:36:52,709 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100493.5149999999997000000000', 'margin': '146484.47', 'free_margin': '-45990.9550000000003000000000', 'profit_loss': '-83852.29500000000030000000000', 'margin_level': '68.60352841499170505924621224', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.27500000000030000000000000', 'current_price': '39.214499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83758.02000000000000000000000', 'current_price': '118742.5'}], 'margin_call': True}
2025-07-22 21:36:52,711 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.60352841499170505924621224
2025-07-22 21:36:52,713 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:36:52,713 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:36:52,774 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:52,774 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:36:52,833 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:52,834 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:36:52,874 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:52,874 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:36:52,875 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:36:52,875 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:36:52,880 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:36:52,882 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:36:52,882 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:36:52,907 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:52,907 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:36:52,909 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:36:52,909 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:36:52,911 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:36:52,911 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:36:52,995 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:36:52,995 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:36:53,307 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:36:53,310 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:36:53,311 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:36:53,312 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:36:53,539 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:36:53,541 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:36:53,974 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:36:53,980 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:36:53,980 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:36:53,980 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:36:54,120 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:36:54,121 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:36:54,431 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:36:54,433 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:36:54,433 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:36:54,433 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:36:54,481 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:54,481 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:36:54,509 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:36:54,862 - INFO - app - Application shutdown initiated
2025-07-22 21:36:54,862 - INFO - app - Scheduler shutdown completed
2025-07-22 21:36:55,241 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 21:36:55,931 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 21:36:55,931 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 21:36:55,935 - INFO - app - Redis connection closed
2025-07-22 21:36:55,935 - INFO - app - Application shutdown completed
2025-07-22 21:39:18,091 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:39:18,119 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:39:18,133 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:39:18,133 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:41:55,618 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:41:55,666 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:41:55,678 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:41:55,679 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:41:55,979 - INFO - app - Application starting up - Trading system initialized
2025-07-22 21:41:55,979 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 21:41:55,979 - INFO - app - Environment: PRODUCTION
2025-07-22 21:41:56,041 - INFO - app - Application startup initiated
2025-07-22 21:41:56,041 - INFO - app - Initializing core services...
2025-07-22 21:41:56,073 - INFO - app - Firebase initialized
2025-07-22 21:41:56,074 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 21:41:56,102 - INFO - app - Redis initialized
2025-07-22 21:41:56,692 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 21:41:56,695 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 21:41:56,698 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 21:41:56,698 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 21:41:56,698 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 21:41:56,699 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 21:41:56,699 - INFO - app - Scheduler initialized
2025-07-22 21:41:56,702 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:41:56,703 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 21:41:57,697 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:41:57,709 - INFO - app - Starting stale cache cleanup task
2025-07-22 21:41:57,746 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 21:41:57,746 - INFO - app - Background tasks initialized
2025-07-22 21:41:57,746 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:41:58,470 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:41:58,470 - INFO - app - Application startup completed successfully
2025-07-22 21:41:58,470 - INFO - app - Starting cache validation task
2025-07-22 21:41:58,472 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 21:41:58,475 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 21:41:58,477 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 21:41:58,477 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:41:58,477 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:41:58,477 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:41:58,477 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:41:58,497 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 21:41:58,518 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:41:58,519 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:41:58,519 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:41:58,522 - INFO - app - Validating cache for 30 users
2025-07-22 21:41:58,534 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,548 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:41:58,548 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:41:58,556 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 21:41:58,558 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,560 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 21:41:58,563 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 21:41:58,565 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 21:41:58,566 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 21:41:58,567 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 21:41:58,568 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:41:58,570 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 21:41:58,571 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,572 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 21:41:58,573 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:41:58,573 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:41:58,574 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 21:41:58,575 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 21:41:58,577 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 21:41:58,579 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 21:41:58,580 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 21:41:58,581 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 21:41:58,584 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 21:41:58,584 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,585 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 21:41:58,586 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-22 21:41:58,588 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 21:41:58,589 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 21:41:58,592 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 21:41:58,593 - INFO - app - Completed stale cache cleanup task
2025-07-22 21:41:58,595 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,607 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,615 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,625 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,634 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,642 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,652 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,661 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,668 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,676 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,684 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,691 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,700 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,708 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,716 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,722 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,778 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,787 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,798 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,809 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-22 21:41:58,814 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:41:59,114 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-22 21:41:59,115 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:41:59,118 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:41:59,120 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:41:59,123 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:41:59,123 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3528500000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3528500000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3528400000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3528400000'}], 'margin_call': False}
2025-07-22 21:41:59,125 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:41:59,127 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:41:59,127 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:41:59,133 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-22 21:41:59,148 - INFO - app - Cache validation completed
2025-07-22 21:41:59,157 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,157 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:41:59,186 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,186 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:41:59,207 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,207 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:41:59,386 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:41:59,700 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.931592386300351358989723671% which is below threshold 100.0%
2025-07-22 21:41:59,701 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '373.283859639570969673871617', 'margin': '9494.47', 'free_margin': '-9121.186140360429030326128383', 'profit_loss': '-9528.736140360429030326128383', 'margin_level': '3.931592386300351358989723671', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9481.970000000000000000000000', 'current_price': '118792.5000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-42.51467305493548211466216584', 'current_price': '96.4870000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.251467305493548211466216584', 'current_price': '96.4870000000'}], 'margin_call': True}
2025-07-22 21:41:59,703 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.931592386300351358989723671
2025-07-22 21:41:59,738 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:41:59,738 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:41:59,765 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,765 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:41:59,791 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,791 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:41:59,821 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,821 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:41:59,851 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,851 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:41:59,882 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,882 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:41:59,910 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,910 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:41:59,939 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,939 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:41:59,972 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:41:59,972 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:42:00,179 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:42:00,490 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.152278569286900626956079385% which is below threshold 100.0%
2025-07-22 21:42:00,490 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '246.505000000000000000000000', 'margin': '5936.62', 'free_margin': '-5690.115000000000000000000000', 'profit_loss': '-6143.115000000000000000000000', 'margin_level': '4.152278569286900626956079385', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6143.115000000000000000000000', 'current_price': '118792.5000000000'}], 'margin_call': True}
2025-07-22 21:42:00,493 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.152278569286900626956079385
2025-07-22 21:42:00,492 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:42:00,498 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:42:00,518 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:42:00,542 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:42:00,542 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:42:00,577 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:42:00,590 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:42:00,620 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:42:00,666 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:42:00,856 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:42:00,885 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:42:00,891 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:42:00,898 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:42:00,902 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:42:00,903 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:42:00,909 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:42:00,909 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:42:00,926 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:42:00,927 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:42:00,945 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:42:00,946 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:42:00,958 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:42:00,965 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:42:00,965 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:42:00,966 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:42:00,966 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:42:00,969 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:42:00,974 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:42:00,974 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:42:00,980 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:42:00,980 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:42:01,167 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.80875494856212402584383177% which is below threshold 100.0%
2025-07-22 21:42:01,168 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100794.1400000000000000000000', 'margin': '146484.47', 'free_margin': '-45690.3300000000000000000000', 'profit_loss': '-83551.67000000000000000000000', 'margin_level': '68.80875494856212402584383177', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-93.65000000000000000000000000', 'current_price': '39.2270000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83458.02000000000000000000000', 'current_price': '118792.5000000000'}], 'margin_call': True}
2025-07-22 21:42:01,170 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.80875494856212402584383177
2025-07-22 21:42:01,172 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:42:01,172 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:42:01,213 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:01,214 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:42:01,241 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:01,241 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:42:01,281 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:01,281 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:42:01,282 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:42:01,282 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:42:01,288 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:42:01,290 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:42:01,291 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:42:01,319 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:01,320 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:42:01,321 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:42:01,321 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:42:01,322 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:42:01,322 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:42:01,493 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:42:01,494 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:42:02,454 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:42:02,456 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:42:02,457 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:42:02,457 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:42:02,575 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:42:02,576 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:42:02,907 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:42:02,913 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:42:02,913 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:42:02,914 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:42:03,073 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:42:03,074 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:42:03,379 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:42:03,383 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:42:03,383 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:42:03,383 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:42:03,447 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:03,447 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:42:03,511 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:13,486 - INFO - app - Starting stale cache cleanup task
2025-07-22 21:42:13,487 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 21:42:13,490 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 21:42:13,492 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 21:42:13,493 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 21:42:13,493 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 21:42:13,494 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 21:42:13,495 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 21:42:13,495 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 21:42:13,496 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 21:42:13,496 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 21:42:13,496 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 21:42:13,497 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 21:42:13,497 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 21:42:13,498 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 21:42:13,499 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 21:42:13,500 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 21:42:13,501 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 21:42:13,502 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-22 21:42:13,503 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 21:42:13,504 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 21:42:13,505 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 21:42:13,505 - INFO - app - Completed stale cache cleanup task
2025-07-22 21:42:33,539 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:42:33,539 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:42:33,539 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:42:33,539 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:42:33,547 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:42:33,547 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:42:33,547 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:42:33,552 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:42:33,552 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:42:33,563 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:42:33,567 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:42:33,567 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:42:33,677 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:42:33,995 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:42:33,996 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:42:33,998 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:42:33,999 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:42:33,999 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.352915'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.352915'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352755'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352755'}], 'margin_call': False}
2025-07-22 21:42:34,000 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:42:34,002 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:42:34,002 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:42:34,056 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:34,056 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:42:34,132 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:34,132 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:42:34,199 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:34,199 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:42:34,397 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:42:34,713 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.956267159907141313951375348% which is below threshold 100.0%
2025-07-22 21:42:34,714 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '375.626598617235559910719147', 'margin': '9494.47', 'free_margin': '-9118.843401382764440089280853', 'profit_loss': '-9526.393401382764440089280853', 'margin_level': '3.956267159907141313951375348', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9478.210000000000000000000000', 'current_price': '118801.9000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-43.80309216614949099025532147', 'current_price': '96.468'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.380309216614949099025532147', 'current_price': '96.468'}], 'margin_call': True}
2025-07-22 21:42:34,716 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.956267159907141313951375348
2025-07-22 21:42:34,810 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:42:34,810 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:42:34,845 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:34,845 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:42:34,875 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:34,875 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:42:34,912 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:34,912 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:42:34,956 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:34,956 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:42:34,998 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:34,998 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:42:35,039 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:35,040 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:42:35,082 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:35,082 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:42:35,121 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:35,121 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:42:35,261 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:42:35,574 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.168112494988730961388803730% which is below threshold 100.0%
2025-07-22 21:42:35,575 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '247.445000000000000000000000', 'margin': '5936.62', 'free_margin': '-5689.175000000000000000000000', 'profit_loss': '-6142.175000000000000000000000', 'margin_level': '4.168112494988730961388803730', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6142.175000000000000000000000', 'current_price': '118801.9000000000'}], 'margin_call': True}
2025-07-22 21:42:35,579 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.168112494988730961388803730
2025-07-22 21:42:35,640 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:42:35,642 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:42:35,823 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:42:36,190 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.84573839124379533202393400% which is below threshold 100.0%
2025-07-22 21:42:36,190 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100848.3150000000000000000000', 'margin': '146484.47', 'free_margin': '-45636.1550000000000000000000', 'profit_loss': '-83497.49500000000000000000000', 'margin_level': '68.84573839124379533202393400', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-95.875000000000000000000000', 'current_price': '39.1825'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83401.62000000000000000000000', 'current_price': '118801.9000000000'}], 'margin_call': True}
2025-07-22 21:42:36,193 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.84573839124379533202393400
2025-07-22 21:42:36,195 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:42:36,196 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:42:36,249 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:36,249 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:42:36,291 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:36,291 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:42:36,331 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:36,331 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:42:36,333 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:42:36,333 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:42:36,347 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:42:36,349 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:42:36,349 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:42:36,393 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:36,393 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:42:36,395 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:42:36,395 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:42:36,397 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:42:36,397 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:42:36,546 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:42:36,546 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:42:36,879 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:42:36,881 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:42:36,884 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:42:36,884 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:42:37,117 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:42:37,118 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:42:37,429 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:42:37,432 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:42:37,432 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:42:37,432 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:42:37,546 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:42:37,547 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:42:37,849 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:42:37,852 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:42:37,853 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:42:37,853 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:42:37,888 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:37,888 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:42:37,920 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:42:56,713 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:42:57,079 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:43:04,409 - INFO - app - Application shutdown initiated
2025-07-22 21:43:04,409 - INFO - app - Scheduler shutdown completed
2025-07-22 21:43:05,607 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 21:43:06,977 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 21:43:06,978 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 21:43:06,987 - INFO - app - Redis connection closed
2025-07-22 21:43:06,987 - INFO - app - Application shutdown completed
2025-07-22 21:43:08,617 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:43:08,645 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:43:08,658 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:43:08,658 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:43:08,947 - INFO - app - Application starting up - Trading system initialized
2025-07-22 21:43:08,947 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 21:43:08,947 - INFO - app - Environment: PRODUCTION
2025-07-22 21:43:09,006 - INFO - app - Application startup initiated
2025-07-22 21:43:09,006 - INFO - app - Initializing core services...
2025-07-22 21:43:09,038 - INFO - app - Firebase initialized
2025-07-22 21:43:09,039 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 21:43:09,058 - INFO - app - Redis initialized
2025-07-22 21:43:09,681 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 21:43:09,687 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 21:43:09,689 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 21:43:09,689 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 21:43:09,689 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 21:43:09,690 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 21:43:09,690 - INFO - app - Scheduler initialized
2025-07-22 21:43:09,692 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:43:09,692 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 21:43:10,905 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:43:10,907 - INFO - app - Starting stale cache cleanup task
2025-07-22 21:43:10,945 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 21:43:10,945 - INFO - app - Background tasks initialized
2025-07-22 21:43:10,945 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:43:11,612 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:43:11,612 - INFO - app - Application startup completed successfully
2025-07-22 21:43:11,627 - INFO - app - Starting cache validation task
2025-07-22 21:43:11,630 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 21:43:11,632 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 21:43:11,635 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 21:43:11,635 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:43:11,635 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:43:11,635 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:43:11,635 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:43:11,674 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 21:43:11,676 - INFO - app - Validating cache for 30 users
2025-07-22 21:43:11,679 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:43:11,679 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:43:11,679 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:43:11,707 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:43:11,707 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:43:11,716 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 21:43:11,718 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 21:43:11,721 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 21:43:11,722 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 21:43:11,723 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 21:43:11,723 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 21:43:11,724 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 21:43:11,725 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 21:43:11,726 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 21:43:11,727 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 21:43:11,728 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 21:43:11,730 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 21:43:11,731 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 21:43:11,731 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:43:11,732 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 21:43:11,734 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 21:43:11,735 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 21:43:11,736 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:43:11,736 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:43:11,736 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-22 21:43:11,737 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 21:43:11,737 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 21:43:11,739 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 21:43:11,739 - INFO - app - Completed stale cache cleanup task
2025-07-22 21:43:11,765 - INFO - app - Cache validation completed
2025-07-22 21:43:11,837 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:43:12,182 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:43:12,185 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:43:12,188 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:43:12,190 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:43:12,191 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.352815'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.352815'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352655'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352655'}], 'margin_call': False}
2025-07-22 21:43:12,193 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:43:12,195 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:43:12,195 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:43:12,239 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:12,239 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:43:12,281 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:12,282 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:43:12,323 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:12,324 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:43:12,509 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:43:12,819 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.969738896349036884826570077% which is below threshold 100.0%
2025-07-22 21:43:12,819 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '376.905668592190402318793248', 'margin': '9494.47', 'free_margin': '-9117.564331407809597681206752', 'profit_loss': '-9525.114331407809597681206752', 'margin_level': '3.969738896349036884826570077', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9478.210000000000000000000000', 'current_price': '118801.9000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-42.64030127982690698291522933', 'current_price': '96.485'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.264030127982690698291522933', 'current_price': '96.485'}], 'margin_call': True}
2025-07-22 21:43:12,822 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.969738896349036884826570077
2025-07-22 21:43:12,867 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:43:12,867 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:43:12,909 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:12,909 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:43:12,952 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:12,952 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:43:12,988 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:12,988 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:43:13,017 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:13,017 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:43:13,046 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:13,047 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:43:13,081 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:13,081 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:43:13,111 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:13,111 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:43:13,141 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:13,141 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:43:13,270 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:43:13,564 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.168112494988730961388803730% which is below threshold 100.0%
2025-07-22 21:43:13,564 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '247.445000000000000000000000', 'margin': '5936.62', 'free_margin': '-5689.175000000000000000000000', 'profit_loss': '-6142.175000000000000000000000', 'margin_level': '4.168112494988730961388803730', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6142.175000000000000000000000', 'current_price': '118801.9000000000'}], 'margin_call': True}
2025-07-22 21:43:13,566 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.168112494988730961388803730
2025-07-22 21:43:13,602 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:43:13,602 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:43:13,634 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:43:13,657 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:43:13,703 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:43:13,812 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:43:13,813 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:43:13,855 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:43:13,859 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:43:13,869 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:43:14,018 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:43:14,019 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:43:14,033 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:43:14,033 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:43:14,041 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:43:14,041 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:43:14,050 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:43:14,069 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:43:14,069 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:43:14,098 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:43:14,107 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:43:14,111 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:43:14,111 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:43:14,122 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:43:14,123 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:43:14,130 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:43:14,142 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:43:14,143 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:43:14,143 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:43:14,151 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:43:14,151 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:43:14,187 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.84614799097815625096639937% which is below threshold 100.0%
2025-07-22 21:43:14,188 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100848.9150000000000000000000', 'margin': '146484.47', 'free_margin': '-45635.5550000000000000000000', 'profit_loss': '-83496.89500000000000000000000', 'margin_level': '68.84614799097815625096639937', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-95.275000000000000000000000', 'current_price': '39.1945'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83401.62000000000000000000000', 'current_price': '118801.9000000000'}], 'margin_call': True}
2025-07-22 21:43:14,191 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.84614799097815625096639937
2025-07-22 21:43:14,193 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:43:14,193 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:43:14,238 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:14,239 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:43:14,303 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:14,303 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:43:14,358 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:14,358 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:43:14,359 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:43:14,359 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:43:14,371 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:43:14,373 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:43:14,373 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:43:14,404 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:14,405 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:43:14,407 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:43:14,407 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:43:14,408 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:43:14,408 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:43:14,527 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:43:14,528 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:43:15,408 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:43:15,413 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:43:15,415 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:43:15,415 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:43:15,562 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:43:15,563 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:43:16,229 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:43:16,237 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:43:16,237 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:43:16,237 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:43:16,381 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:43:16,384 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:43:16,756 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:43:16,763 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:43:16,763 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:43:16,763 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:43:16,828 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:16,828 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:43:16,870 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:26,629 - INFO - app - Starting stale cache cleanup task
2025-07-22 21:43:26,631 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 21:43:26,636 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 21:43:26,638 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 21:43:26,640 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 21:43:26,642 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 21:43:26,643 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 21:43:26,644 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 21:43:26,646 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 21:43:26,648 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 21:43:26,650 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 21:43:26,651 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 21:43:26,652 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 21:43:26,654 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 21:43:26,656 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 21:43:26,657 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 21:43:26,660 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 21:43:26,663 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 21:43:26,664 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-22 21:43:26,665 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 21:43:26,667 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 21:43:26,672 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 21:43:26,672 - INFO - app - Completed stale cache cleanup task
2025-07-22 21:43:46,881 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:43:46,881 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:43:46,882 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:43:46,882 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:43:46,895 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:43:46,895 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:43:46,896 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:43:46,907 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:43:46,908 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:43:46,930 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:43:46,934 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:43:46,934 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:43:47,084 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:43:47,461 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:43:47,464 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:43:47,466 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:43:47,467 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:43:47,468 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.352835'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.352835'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3526749999999998'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3526749999999998'}], 'margin_call': False}
2025-07-22 21:43:47,469 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:43:47,470 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:43:47,470 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:43:47,516 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:47,516 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:43:47,554 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:47,554 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:43:47,593 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:47,593 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:43:47,704 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:43:48,078 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.791736001168839179322411551% which is below threshold 100.0%
2025-07-22 21:43:48,078 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '360.005237110175085229012568', 'margin': '9494.47', 'free_margin': '-9134.464762889824914770987432', 'profit_loss': '-9542.014762889824914770987432', 'margin_level': '3.791736001168839179322411551', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9495.330000000000000000000000', 'current_price': '118759.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-42.44069353620446797362493791', 'current_price': '96.488'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.244069353620446797362493791', 'current_price': '96.488'}], 'margin_call': True}
2025-07-22 21:43:48,080 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.791736001168839179322411551
2025-07-22 21:43:48,127 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:43:48,127 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:43:48,197 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:48,197 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:43:48,278 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:48,278 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:43:48,337 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:48,337 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:43:48,392 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:48,392 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:43:48,450 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:48,450 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:43:48,506 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:48,506 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:43:48,561 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:48,561 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:43:48,617 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:48,617 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:43:48,820 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:43:49,180 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.096017599239971566312143947% which is below threshold 100.0%
2025-07-22 21:43:49,181 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '243.165000000000000000000000', 'margin': '5936.62', 'free_margin': '-5693.455000000000000000000000', 'profit_loss': '-6146.455000000000000000000000', 'margin_level': '4.096017599239971566312143947', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6146.455000000000000000000000', 'current_price': '118759.1'}], 'margin_call': True}
2025-07-22 21:43:49,184 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.096017599239971566312143947
2025-07-22 21:43:49,234 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:43:49,234 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:43:49,445 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:43:49,815 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.67104410453886340306245433% which is below threshold 100.0%
2025-07-22 21:43:49,815 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100592.4150000000000000000000', 'margin': '146484.47', 'free_margin': '-45892.0550000000000000000000', 'profit_loss': '-83753.39500000000000000000000', 'margin_level': '68.67104410453886340306245433', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.975000000000000000000000', 'current_price': '39.2005'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83658.42000000000000000000000', 'current_price': '118759.1'}], 'margin_call': True}
2025-07-22 21:43:49,818 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.67104410453886340306245433
2025-07-22 21:43:49,819 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:43:49,820 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:43:49,867 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:49,867 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:43:49,921 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:49,921 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:43:49,975 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:49,975 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:43:49,977 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:43:49,977 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:43:49,991 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:43:49,993 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:43:49,993 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:43:50,037 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:50,038 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:43:50,040 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:43:50,040 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:43:50,042 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:43:50,043 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:43:50,181 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:43:50,182 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:43:50,533 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:43:50,536 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:43:50,538 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:43:50,538 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:43:50,674 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:43:50,675 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:43:51,043 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:43:51,046 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:43:51,046 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:43:51,046 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:43:51,239 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:43:51,240 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:43:51,555 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:43:51,559 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:43:51,559 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:43:51,560 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:43:51,619 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:51,619 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:43:51,666 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:43:58,608 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 21:43:58,625 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 21:43:58,625 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 21:43:58,626 - INFO - app - Application shutdown initiated
2025-07-22 21:43:58,627 - INFO - app - Scheduler shutdown completed
2025-07-22 21:43:58,649 - INFO - app - Redis connection closed
2025-07-22 21:43:58,650 - INFO - app - Application shutdown completed
2025-07-22 21:45:31,804 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:45:31,833 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:45:31,846 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:45:31,846 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:45:32,098 - INFO - app - Application starting up - Trading system initialized
2025-07-22 21:45:32,099 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-22 21:45:32,099 - INFO - app - Environment: PRODUCTION
2025-07-22 21:45:32,160 - INFO - app - Application startup initiated
2025-07-22 21:45:32,160 - INFO - app - Initializing core services...
2025-07-22 21:45:32,191 - INFO - app - Firebase initialized
2025-07-22 21:45:32,191 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-22 21:45:32,213 - INFO - app - Redis initialized
2025-07-22 21:45:33,078 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-22 21:45:33,082 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-22 21:45:33,084 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-22 21:45:33,084 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-22 21:45:33,084 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-22 21:45:33,085 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-22 21:45:33,085 - INFO - app - Scheduler initialized
2025-07-22 21:45:33,086 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:45:33,087 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-22 21:45:34,164 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-22 21:45:34,175 - INFO - app - Starting stale cache cleanup task
2025-07-22 21:45:34,216 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-22 21:45:34,216 - INFO - app - Background tasks initialized
2025-07-22 21:45:34,216 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-22 21:45:34,828 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-22 21:45:34,828 - INFO - app - Application startup completed successfully
2025-07-22 21:45:34,828 - INFO - app - Starting cache validation task
2025-07-22 21:45:34,833 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-22 21:45:34,836 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-22 21:45:34,839 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-22 21:45:34,839 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:45:34,839 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:45:34,839 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:45:34,839 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:45:34,857 - INFO - app - Validating cache for 30 users
2025-07-22 21:45:34,860 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:45:34,860 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:45:34,860 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:45:34,861 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 21:45:34,883 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:45:34,884 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:45:34,890 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 21:45:34,900 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 21:45:34,903 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 21:45:34,904 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 21:45:34,905 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:45:34,906 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 21:45:34,910 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:45:34,910 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:45:34,910 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 21:45:34,911 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 21:45:34,912 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 21:45:34,914 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 21:45:34,915 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 21:45:34,917 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 21:45:34,919 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 21:45:34,920 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 21:45:34,921 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 21:45:34,924 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 21:45:34,925 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 21:45:34,926 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-22 21:45:34,927 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 21:45:34,928 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 21:45:34,935 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 21:45:34,935 - INFO - app - Completed stale cache cleanup task
2025-07-22 21:45:34,964 - INFO - app - Cache validation completed
2025-07-22 21:45:35,076 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:45:35,374 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:45:35,377 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:45:35,381 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:45:35,382 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:45:35,382 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3527600000'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3527600000'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.3527500000'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.3527500000'}], 'margin_call': False}
2025-07-22 21:45:35,385 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:45:35,386 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:45:35,386 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:45:35,400 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:35,400 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:45:35,414 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:35,414 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:45:35,428 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:35,429 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:45:35,585 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:45:35,883 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.014191409749152247760311265% which is below threshold 100.0%
2025-07-22 21:45:35,883 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '381.126199141210335417928425', 'margin': '9494.47', 'free_margin': '-9113.343800858789664582071575', 'profit_loss': '-9520.893800858789664582071575', 'margin_level': '4.014191409749152247760311265', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9475.330000000000000000000000', 'current_price': '118809.1000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-41.42163714435424052915597716', 'current_price': '96.5030000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.142163714435424052915597716', 'current_price': '96.5030000000'}], 'margin_call': True}
2025-07-22 21:45:35,885 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.014191409749152247760311265
2025-07-22 21:45:35,909 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:45:35,910 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:45:35,932 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:35,932 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:45:35,954 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:35,954 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:45:35,977 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:35,977 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:45:35,998 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:35,998 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:45:36,018 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:36,018 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:45:36,041 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:36,041 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:45:36,061 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:36,061 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:45:36,081 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:36,081 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:45:36,204 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:45:36,501 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.180240608292260579252167058% which is below threshold 100.0%
2025-07-22 21:45:36,501 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '248.165000000000000000000000', 'margin': '5936.62', 'free_margin': '-5688.455000000000000000000000', 'profit_loss': '-6141.455000000000000000000000', 'margin_level': '4.180240608292260579252167058', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6141.455000000000000000000000', 'current_price': '118809.1000000000'}], 'margin_call': True}
2025-07-22 21:45:36,503 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.180240608292260579252167058
2025-07-22 21:45:36,535 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:45:36,535 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:45:36,584 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:45:36,595 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:45:36,603 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:45:36,614 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:45:36,613 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:45:36,639 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-22 21:45:36,813 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:45:36,913 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:45:36,928 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:45:36,942 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:45:36,943 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:45:36,952 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:45:36,950 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:45:36,958 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:45:36,959 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:45:36,959 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:45:36,975 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:45:36,976 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:45:36,977 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:45:36,979 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:45:36,979 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:45:36,979 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:45:36,979 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:45:36,998 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:45:36,998 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:45:37,006 - INFO - app.core.config - .env file loaded successfully.
2025-07-22 21:45:37,045 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-22 21:45:37,045 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-22 21:45:37,108 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.87627063810928216486020668% which is below threshold 100.0%
2025-07-22 21:45:37,108 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100893.0400000000000000000000', 'margin': '146484.47', 'free_margin': '-45591.4300000000000000000000', 'profit_loss': '-83452.77000000000000000000000', 'margin_level': '68.87627063810928216486020668', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.35000000000000000000000000', 'current_price': '39.2130000000'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83358.42000000000000000000000', 'current_price': '118809.1000000000'}], 'margin_call': True}
2025-07-22 21:45:37,110 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.87627063810928216486020668
2025-07-22 21:45:37,111 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:45:37,111 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:45:37,131 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:37,131 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:45:37,148 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:37,148 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:45:37,173 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:37,173 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:45:37,173 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:45:37,174 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:45:37,180 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:45:37,181 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:45:37,182 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:45:37,202 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:37,202 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:45:37,203 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:45:37,203 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:45:37,203 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:45:37,204 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:45:37,298 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:45:37,299 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:45:37,741 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:45:37,742 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:45:37,743 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:45:37,743 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:45:37,852 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:45:37,853 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:45:38,158 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:45:38,160 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:45:38,160 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:45:38,160 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:45:38,269 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:45:38,272 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:45:38,579 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:45:38,582 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:45:38,582 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:45:38,583 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:45:38,615 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:38,615 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:45:38,686 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:45:49,839 - INFO - app - Starting stale cache cleanup task
2025-07-22 21:45:49,842 - INFO - app - Found 26 static orders cache entries to check
2025-07-22 21:45:49,852 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-22 21:45:49,856 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-22 21:45:49,859 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-22 21:45:49,861 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-22 21:45:49,863 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-22 21:45:49,866 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-22 21:45:49,869 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-22 21:45:49,872 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-22 21:45:49,873 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-22 21:45:49,876 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-22 21:45:49,879 - WARNING - app - Found stale cache entry for user live:4, will be refreshed on next access
2025-07-22 21:45:49,881 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-22 21:45:49,883 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-22 21:45:49,886 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-22 21:45:49,889 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-22 21:45:49,892 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-22 21:45:49,894 - WARNING - app - Found stale cache entry for user demo:1, will be refreshed on next access
2025-07-22 21:45:49,897 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-22 21:45:49,900 - WARNING - app - Found stale cache entry for user live:1, will be refreshed on next access
2025-07-22 21:45:49,904 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-22 21:45:49,904 - INFO - app - Completed stale cache cleanup task
2025-07-22 21:46:08,696 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:46:08,696 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-22 21:46:08,697 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-22 21:46:08,697 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-22 21:46:08,704 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-22 21:46:08,705 - INFO - app - [AUTO-CUTOFF] Processing 30 users for dynamic portfolio update...
2025-07-22 21:46:08,705 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-22 21:46:08,710 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-22 21:46:08,710 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-22 21:46:08,723 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:46:08,725 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-22 21:46:08,725 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-22 21:46:08,789 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:46:09,191 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:46:09,198 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:46:09,204 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:46:09,218 - ERROR - app.services.portfolio_calculator - Could not convert PnL from None to USD
2025-07-22 21:46:09,218 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [{'order_id': Decimal('4731664142'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34376000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:07', 'profit_loss': '0.0', 'current_price': '1.3528850000000001'}, {'order_id': Decimal('8676137902'), 'order_company_name': 'GBPUSD', 'order_type': 'SELL', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34361000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:21', 'profit_loss': '0.0', 'current_price': '1.3528850000000001'}, {'order_id': Decimal('3301052276'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34379000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:24', 'profit_loss': '0.0', 'current_price': '1.352705'}, {'order_id': Decimal('2972795665'), 'order_company_name': 'GBPUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.25000000'), 'order_price': Decimal('1.34378000'), 'margin': Decimal('0E-8'), 'contract_value': Decimal('0E-8'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('2.50000000'), 'created_at': '2025-06-19T11:41:30', 'profit_loss': '0.0', 'current_price': '1.352705'}], 'margin_call': False}
2025-07-22 21:46:09,221 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:46:09,224 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:46:09,224 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-22 21:46:09,254 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,254 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-22 21:46:09,277 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,277 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-22 21:46:09,296 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,296 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-22 21:46:09,361 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-22 21:46:09,696 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.902127173787548746355844665% which is below threshold 100.0%
2025-07-22 21:46:09,696 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '370.486293877106679458131765', 'margin': '9494.47', 'free_margin': '-9123.983706122893320541868235', 'profit_loss': '-9531.533706122893320541868235', 'margin_level': '3.902127173787548746355844665', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9484.330000000000000000000000', 'current_price': '118786.6000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-42.91246011172120049260748573', 'current_price': '96.481'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-4.291246011172120049260748573', 'current_price': '96.481'}], 'margin_call': True}
2025-07-22 21:46:09,698 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.902127173787548746355844665
2025-07-22 21:46:09,725 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-22 21:46:09,725 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-22 21:46:09,740 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,740 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-22 21:46:09,757 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,757 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-22 21:46:09,773 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,773 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-22 21:46:09,798 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,798 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-22 21:46:09,819 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,819 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-22 21:46:09,835 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,835 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-22 21:46:09,849 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,849 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-22 21:46:09,862 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:09,862 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-22 21:46:09,904 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-22 21:46:10,303 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.142340254218730523429156658% which is below threshold 100.0%
2025-07-22 21:46:10,304 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '6389.62000000', 'equity': '245.915000000000000000000000', 'margin': '5936.62', 'free_margin': '-5690.705000000000000000000000', 'profit_loss': '-6143.705000000000000000000000', 'margin_level': '4.142340254218730523429156658', 'positions': [{'order_id': '1031-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('179986.15000000'), 'margin': Decimal('5936.62000000'), 'contract_value': Decimal('0.10000000'), 'stop_loss': Decimal('118576.15000000'), 'take_profit': Decimal('118976.15000000'), 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('23.75000000'), 'created_at': '2025-07-18T02:09:29', 'profit_loss': '-6143.705000000000000000000000', 'current_price': '118786.6000000000'}], 'margin_call': True}
2025-07-22 21:46:10,305 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.142340254218730523429156658
2025-07-22 21:46:10,321 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-22 21:46:10,321 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-22 21:46:10,388 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-22 21:46:10,726 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.78368403148811611224043068% which is below threshold 100.0%
2025-07-22 21:46:10,727 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '100757.4150000000000000000000', 'margin': '146484.47', 'free_margin': '-45727.0550000000000000000000', 'profit_loss': '-83588.39500000000000000000000', 'margin_level': '68.78368403148811611224043068', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-94.975000000000000000000000', 'current_price': '39.2005'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-83493.42000000000000000000000', 'current_price': '118786.6000000000'}], 'margin_call': True}
2025-07-22 21:46:10,731 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.78368403148811611224043068
2025-07-22 21:46:10,734 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-22 21:46:10,735 - INFO - app - [AUTO-CUTOFF] Processing user 29 (live), group: Standard
2025-07-22 21:46:10,801 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:10,801 - INFO - app - [AUTO-CUTOFF] Processing user 30 (live), group: Royal+
2025-07-22 21:46:10,841 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:10,841 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-22 21:46:10,879 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:10,879 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-22 21:46:10,881 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-22 21:46:10,882 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-22 21:46:10,892 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-22 21:46:10,895 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-22 21:46:10,895 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-22 21:46:10,929 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:10,929 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-22 21:46:10,930 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-22 21:46:10,930 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-22 21:46:10,931 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-22 21:46:10,931 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-22 21:46:11,044 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-22 21:46:11,045 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-22 21:46:11,433 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-22 21:46:11,436 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-22 21:46:11,440 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-22 21:46:11,440 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-22 21:46:11,586 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-22 21:46:11,586 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-22 21:46:11,910 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:46:11,914 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-22 21:46:11,915 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-22 21:46:11,915 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-22 21:46:12,032 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-22 21:46:12,033 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-22 21:46:12,351 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-22 21:46:12,353 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-22 21:46:12,353 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-22 21:46:12,353 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-22 21:46:12,390 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:12,390 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-22 21:46:12,419 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-22 21:46:27,391 - INFO - app - Application shutdown initiated
2025-07-22 21:46:27,391 - INFO - app - Scheduler shutdown completed
2025-07-22 21:46:27,409 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-22 21:46:29,762 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-22 21:46:29,762 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-22 21:46:29,764 - INFO - app - Redis connection closed
2025-07-22 21:46:29,764 - INFO - app - Application shutdown completed
