2025-07-14 22:43:29,218 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 22:43:30,353 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 22:43:30,353 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 22:43:30,353 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 22:43:30,353 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 22:43:34,465 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 22:43:34,465 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 22:43:35,358 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 22:43:40,367 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 22:43:43,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:43:43,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:43:43,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:43:43,451 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:43:43,451 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:43:47,621 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-14 22:43:47,621 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:43:47,621 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-14 22:43:47,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-14 22:43:47,622 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-14 22:43:47,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDCAD
2025-07-14 22:43:47,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:47,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('900')], HighestMarginPerLot=900
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=9.00
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 10, Symbol AUDJPY
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95777'), Decimal('658.76335'), Decimal('658.70886')], HighestMarginPerLot=95777
2025-07-14 22:43:47,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=1915.54
2025-07-14 22:43:47,686 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 1924.54
2025-07-14 22:43:47,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 11, Symbol AUDJPY
2025-07-14 22:43:47,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:43:47,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717'), Decimal('655.714237')], HighestMarginPerLot=96717
2025-07-14 22:43:47,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-14 22:43:47,744 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-14 22:43:48,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-14 22:43:48,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-14 22:43:48,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-14 22:43:48,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-14 22:43:48,027 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-14 22:43:48,140 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 19, Symbol AUDJPY
2025-07-14 22:43:48,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 19, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 19, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.751744')], HighestMarginPerLot=654.751744
2025-07-14 22:43:48,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 19, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:43:48,141 - INFO - orders - [TOTAL_USER_MARGIN] User 19 total margin across all symbols: 6.55
2025-07-14 22:43:48,164 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-14 22:43:48,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol EURUSD
2025-07-14 22:43:48,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180')], HighestMarginPerLot=1180
2025-07-14 22:43:48,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=11.80
2025-07-14 22:43:48,204 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 18.38
2025-07-14 22:43:48,314 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-14 22:43:48,564 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDSGD
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.353812')], HighestMarginPerLot=780.353812
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDSGD: CalculatedTotalMargin=7.80
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=4.00000000, TotalSellQty=0, NetQty=4.00000000, IsHedged=False
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24466.1075')], HighestMarginPerLot=24466.1075
2025-07-14 22:43:48,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=97864.43
2025-07-14 22:43:48,565 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 97915.37
2025-07-14 22:43:48,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-14 22:43:48,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-14 22:43:48,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:43:48,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-14 22:43:48,624 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 19.76
2025-07-14 22:43:48,643 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-14 22:43:49,274 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-14 22:44:37,516 - INFO - orders - Starting update_user_static_orders for user 11, user_type live
2025-07-14 22:44:37,516 - INFO - orders - Using order model: UserOrder
2025-07-14 22:44:37,949 - INFO - orders - Fetched 2 open orders for user 11
2025-07-14 22:44:38,047 - INFO - orders - Fetched 0 pending orders for user 11
2025-07-14 22:44:38,048 - INFO - orders - Updated static orders cache for user 11 with 2 open orders and 0 pending orders
2025-07-14 22:44:38,190 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 11, Symbol AUDJPY
2025-07-14 22:44:38,190 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:44:38,190 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717'), Decimal('655.714237')], HighestMarginPerLot=96717
2025-07-14 22:44:38,190 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-14 22:44:38,190 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-14 22:44:38,193 - INFO - orders - User 11: Updated balance/margin cache after static orders update - balance=14420.65000000, margin=967.17
2025-07-14 22:44:38,325 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 11, Symbol AUDJPY
2025-07-14 22:44:38,325 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:44:38,326 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717'), Decimal('655.714237')], HighestMarginPerLot=96717
2025-07-14 22:44:38,326 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-14 22:44:38,326 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-14 22:45:36,439 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-14 22:45:41,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:41,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-14 22:45:41,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:41,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-14 22:45:41,108 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 19.76
2025-07-14 22:45:55,038 - INFO - orders - Order close request received - Order ID: 9615167363, User ID: 1, Close Price: 96.608
2025-07-14 22:45:55,038 - INFO - orders - Request to close order 9615167363 for user 1 (user_type: demo) with price 96.608. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-14 22:45:55,477 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-14 22:45:55,717 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:55,717 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-14 22:45:55,717 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:55,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.18
2025-07-14 22:45:55,896 - INFO - orders - Existing entry commission for order 9615167363: 0.10000000
2025-07-14 22:45:55,896 - INFO - orders - Commission calculation for order 9615167363: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-14 22:45:55,896 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -153.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 9615167363)
2025-07-14 22:45:55,896 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:45:57,956 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:45:57,956 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:45:57,956 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:45:57,967 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5730000000'), 'o': Decimal('147.5690000000')}
2025-07-14 22:45:57,967 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5730000000
2025-07-14 22:45:57,967 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -153.000000000000000000000000 JPY / 147.5730000000 = -1.036775019820698908336890895 USD
2025-07-14 22:45:58,603 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=17024.33000000, margin=13.18
2025-07-14 22:45:58,603 - INFO - orders - Setting user data cache for user 1 with wallet_balance=17024.33000000, margin=13.18
2025-07-14 22:45:58,606 - INFO - orders - User data cache updated for user 1
2025-07-14 22:45:58,609 - INFO - orders - Balance/margin cache updated for user 1: balance=17024.33000000, margin=13.18
2025-07-14 22:45:58,609 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-14 22:45:58,609 - INFO - orders - Using order model: DemoUserOrder
2025-07-14 22:45:58,723 - INFO - orders - Fetched 2 open orders for user 1
2025-07-14 22:45:58,824 - INFO - orders - Fetched 0 pending orders for user 1
2025-07-14 22:45:58,826 - INFO - orders - Updated static orders cache for user 1 with 2 open orders and 0 pending orders
2025-07-14 22:45:58,927 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:58,928 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:45:58,928 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:58,928 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.18
2025-07-14 22:45:58,928 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.18
2025-07-14 22:45:58,932 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=17024.33000000, margin=13.18
2025-07-14 22:45:58,933 - INFO - orders - Publishing order update for user 1
2025-07-14 22:45:58,934 - INFO - orders - Publishing user data update for user 1
2025-07-14 22:45:58,935 - INFO - orders - Publishing market data trigger
2025-07-14 22:45:59,625 - INFO - orders - Order close request received - Order ID: 9418776886, User ID: 1, Close Price: 96.61
2025-07-14 22:45:59,625 - INFO - orders - Request to close order 9418776886 for user 1 (user_type: demo) with price 96.61. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-14 22:45:59,857 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.18
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:45:59,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:45:59,978 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104')], HighestMarginPerLot=658.782104
2025-07-14 22:45:59,978 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.59
2025-07-14 22:46:00,157 - INFO - orders - Existing entry commission for order 9418776886: 0.10000000
2025-07-14 22:46:00,157 - INFO - orders - Commission calculation for order 9418776886: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-14 22:46:00,157 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -157.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 9418776886)
2025-07-14 22:46:00,157 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:46:00,158 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:46:00,158 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:46:00,159 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:46:00,159 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5760000000'), 'o': Decimal('147.5720000000')}
2025-07-14 22:46:00,159 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5760000000
2025-07-14 22:46:00,159 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -157.000000000000000000000000 JPY / 147.5760000000 = -1.063858621998156881877812110 USD
2025-07-14 22:46:01,052 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=17023.07000000, margin=6.59
2025-07-14 22:46:01,053 - INFO - orders - Setting user data cache for user 1 with wallet_balance=17023.07000000, margin=6.59
2025-07-14 22:46:01,054 - INFO - orders - User data cache updated for user 1
2025-07-14 22:46:01,056 - INFO - orders - Balance/margin cache updated for user 1: balance=17023.07000000, margin=6.59
2025-07-14 22:46:01,056 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-14 22:46:01,056 - INFO - orders - Using order model: DemoUserOrder
2025-07-14 22:46:01,090 - INFO - orders - Fetched 1 open orders for user 1
2025-07-14 22:46:01,124 - INFO - orders - Fetched 0 pending orders for user 1
2025-07-14 22:46:01,126 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 0 pending orders
2025-07-14 22:46:01,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:01,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:01,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104')], HighestMarginPerLot=658.782104
2025-07-14 22:46:01,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.59
2025-07-14 22:46:01,160 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.59
2025-07-14 22:46:01,164 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=17023.07000000, margin=6.59
2025-07-14 22:46:01,164 - INFO - orders - Publishing order update for user 1
2025-07-14 22:46:01,164 - INFO - orders - Publishing user data update for user 1
2025-07-14 22:46:01,165 - INFO - orders - Publishing market data trigger
2025-07-14 22:46:01,897 - INFO - orders - Order close request received - Order ID: 2227099351, User ID: 1, Close Price: 96.605
2025-07-14 22:46:01,897 - INFO - orders - Request to close order 2227099351 for user 1 (user_type: demo) with price 96.605. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-14 22:46:02,615 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-14 22:46:02,852 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:02,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:02,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104')], HighestMarginPerLot=658.782104
2025-07-14 22:46:02,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.59
2025-07-14 22:46:02,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-14 22:46:02,918 - INFO - orders - Existing entry commission for order 2227099351: 0.10000000
2025-07-14 22:46:02,918 - INFO - orders - Commission calculation for order 2227099351: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -162.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 2227099351)
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:46:02,918 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:46:02,919 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5770000000'), 'o': Decimal('147.5710000000')}
2025-07-14 22:46:02,919 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5770000000
2025-07-14 22:46:02,919 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -162.000000000000000000000000 JPY / 147.5770000000 = -1.097732031414109244665496656 USD
2025-07-14 22:46:03,524 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=17021.77000000, margin=0
2025-07-14 22:46:03,524 - INFO - orders - Setting user data cache for user 1 with wallet_balance=17021.77000000, margin=0
2025-07-14 22:46:03,525 - INFO - orders - User data cache updated for user 1
2025-07-14 22:46:03,528 - INFO - orders - Balance/margin cache updated for user 1: balance=17021.77000000, margin=0
2025-07-14 22:46:03,528 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-14 22:46:03,528 - INFO - orders - Using order model: DemoUserOrder
2025-07-14 22:46:03,570 - INFO - orders - Fetched 0 open orders for user 1
2025-07-14 22:46:03,637 - INFO - orders - Fetched 0 pending orders for user 1
2025-07-14 22:46:03,638 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 0 pending orders
2025-07-14 22:46:03,702 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=17021.77000000, margin=0.0
2025-07-14 22:46:03,702 - INFO - orders - Publishing order update for user 1
2025-07-14 22:46:03,703 - INFO - orders - Publishing user data update for user 1
2025-07-14 22:46:03,704 - INFO - orders - Publishing market data trigger
2025-07-14 22:46:14,969 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-14 22:46:15,452 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.6620000000', 'o': '96.6560000000'}
2025-07-14 22:46:15,453 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.6620000000, ask=96.67166620000000
2025-07-14 22:46:15,453 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.6620000000, ask=96.67166620000000
2025-07-14 22:46:15,453 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 966.72 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5750000000'), 'o': Decimal('147.5720000000')}
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5750000000
2025-07-14 22:46:15,454 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 966.72 JPY / 147.5750000000 = 6.550703032356428934440115196 USD
2025-07-14 22:46:15,454 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 96.67166620000000, Margin: 6.550703032356428934440115196, Commission: 0.10
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.550703032356428934440115196
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.550703032356428934440115196
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.0703032356428934440115196')], HighestMarginPerLot=655.0703032356428934440115196
2025-07-14 22:46:15,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.55, AdditionalMargin: 6.55, OpenOrders: 0
2025-07-14 22:46:15,455 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.550703032356428934440115196
2025-07-14 22:46:15,733 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=17021.77000000, margin=6.55000000 (was 0E-8)
2025-07-14 22:46:15,733 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-14 22:46:15,733 - INFO - orders - [PERF] Order processing: 0.7628s
2025-07-14 22:46:16,231 - INFO - orders - [PERF] Order creation: 0.4976s
2025-07-14 22:46:16,231 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-14 22:46:16,231 - INFO - orders - [PERF] TOTAL place_order: 1.2629s
2025-07-14 22:46:16,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:16,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:16,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303')], HighestMarginPerLot=655.070303
2025-07-14 22:46:16,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:16,744 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-14 22:46:17,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:17,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:17,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303')], HighestMarginPerLot=655.070303
2025-07-14 22:46:17,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:17,009 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-14 22:46:17,011 - INFO - orders - Background balance/margin cache updated for user 1: balance=17021.77000000, margin=6.55
2025-07-14 22:46:17,810 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-14 22:46:25,065 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: SELL
2025-07-14 22:46:25,595 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.6620000000', 'o': '96.6560000000'}
2025-07-14 22:46:25,596 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.6620000000, ask=96.67166620000000
2025-07-14 22:46:25,596 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.6620000000, ask=96.67166620000000
2025-07-14 22:46:25,597 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 966.62 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-14 22:46:25,597 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-14 22:46:25,598 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-14 22:46:25,598 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-14 22:46:25,598 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-14 22:46:25,599 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.5750000000'), 'o': Decimal('147.5720000000')}
2025-07-14 22:46:25,599 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.5750000000
2025-07-14 22:46:25,600 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 966.62 JPY / 147.5750000000 = 6.550025410808063696425546332 USD
2025-07-14 22:46:25,600 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 96.6620000000, Margin: 6.550025410808063696425546332, Commission: 0.10
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: SELL, Quantity: 0.01, FullMargin: 6.550025410808063696425546332
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=6.550025410808063696425546332
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-14 22:46:25,600 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:46:25,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:25,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:46:25,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303')], HighestMarginPerLot=655.070303
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01, NetQty=0.01000000, IsHedged=True
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.0025410808063696425546332')], HighestMarginPerLot=655.070303
2025-07-14 22:46:25,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:25,601 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:46:25,601 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: SELL, MarginBefore: 6.55, MarginAfter: 6.55, AdditionalMargin: 0.0, OpenOrders: 1
2025-07-14 22:46:25,601 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=6.550025410808063696425546332
2025-07-14 22:46:25,961 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=17021.77000000, margin=6.55000000 (was 6.55000000)
2025-07-14 22:46:25,961 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-14 22:46:25,961 - INFO - orders - [PERF] Order processing: 0.8950s
2025-07-14 22:46:26,197 - INFO - orders - [PERF] Order creation: 0.2360s
2025-07-14 22:46:26,197 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-14 22:46:26,197 - INFO - orders - [PERF] TOTAL place_order: 1.1359s
2025-07-14 22:46:26,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:26,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:46:26,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.002541')], HighestMarginPerLot=655.070303
2025-07-14 22:46:26,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:26,392 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-14 22:46:26,535 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:46:26,535 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:46:26,535 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.002541')], HighestMarginPerLot=655.070303
2025-07-14 22:46:26,535 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:46:26,535 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-14 22:46:26,537 - INFO - orders - Background balance/margin cache updated for user 1: balance=17021.77000000, margin=6.55
2025-07-14 22:46:27,123 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-14 22:47:10,867 - INFO - orders - Order placement request received - User: 1, Symbol: BTCUSD, Type: BUY
2025-07-14 22:47:11,731 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117131.4000000000', 'o': '117131.3000000000'}
2025-07-14 22:47:11,732 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117131.4000000000, ask=117143.11314000000000
2025-07-14 22:47:11,732 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117131.4000000000, ask=117143.11314000000000
2025-07-14 22:47:11,732 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.29, Price: 117143.11314000000000, Margin: 16985.75, Commission: 67.94
2025-07-14 22:47:11,732 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.29, FullMargin: 16985.75
2025-07-14 22:47:11,732 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 22:47:11,733 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.29, Margin=16985.75
2025-07-14 22:47:11,733 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 22:47:11,733 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:47:11,735 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol BTCUSD. Returning zero margin.
2025-07-14 22:47:11,735 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol BTCUSD
2025-07-14 22:47:11,736 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: TotalBuyQty=0.29, TotalSellQty=0, NetQty=0.29, IsHedged=False
2025-07-14 22:47:11,736 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58571.55172413793103448275862')], HighestMarginPerLot=58571.55172413793103448275862
2025-07-14 22:47:11,736 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol BTCUSD: CalculatedTotalMargin=16985.75
2025-07-14 22:47:11,736 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:47:11,736 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 16985.75, AdditionalMargin: 16985.75, OpenOrders: 0
2025-07-14 22:47:11,737 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.29, Margin=16985.75
2025-07-14 22:47:12,063 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=17021.77000000, margin=16992.30000000 (was 6.55000000)
2025-07-14 22:47:12,064 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-14 22:47:12,064 - INFO - orders - [PERF] Order processing: 1.1920s
2025-07-14 22:47:12,314 - INFO - orders - [PERF] Order creation: 0.2497s
2025-07-14 22:47:12,314 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-14 22:47:12,315 - INFO - orders - [PERF] TOTAL place_order: 1.4485s
2025-07-14 22:47:12,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:47:12,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:47:12,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.002541')], HighestMarginPerLot=655.070303
2025-07-14 22:47:12,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:47:12,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol BTCUSD
2025-07-14 22:47:12,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: TotalBuyQty=0.29000000, TotalSellQty=0, NetQty=0.29000000, IsHedged=False
2025-07-14 22:47:12,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58571.55172413793103448275862')], HighestMarginPerLot=58571.55172413793103448275862
2025-07-14 22:47:12,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol BTCUSD: CalculatedTotalMargin=16985.75
2025-07-14 22:47:12,504 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 16992.30
2025-07-14 22:47:12,806 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:47:12,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:47:12,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.070303'), Decimal('655.002541')], HighestMarginPerLot=655.070303
2025-07-14 22:47:12,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:47:12,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol BTCUSD
2025-07-14 22:47:12,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: TotalBuyQty=0.29000000, TotalSellQty=0, NetQty=0.29000000, IsHedged=False
2025-07-14 22:47:12,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58571.55172413793103448275862')], HighestMarginPerLot=58571.55172413793103448275862
2025-07-14 22:47:12,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol BTCUSD: CalculatedTotalMargin=16985.75
2025-07-14 22:47:12,830 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 16992.30
2025-07-14 22:47:12,843 - INFO - orders - Background balance/margin cache updated for user 1: balance=17021.77000000, margin=16992.30
2025-07-14 22:47:13,545 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:49,361 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:48:49,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:48:49,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:48:49,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:48:49,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:48:49,363 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:48:49,698 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-14 22:48:49,699 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-14 22:48:49,699 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-14 22:48:49,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 10, Symbol AUDUSD
2025-07-14 22:48:49,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDUSD: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-14 22:48:49,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDUSD: AllMarginsPerLot=[Decimal('655'), Decimal('655'), Decimal('655')], HighestMarginPerLot=655
2025-07-14 22:48:49,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDUSD: CalculatedTotalMargin=19.65
2025-07-14 22:48:49,792 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 19.65
2025-07-14 22:48:50,756 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-14 22:48:50,756 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-14 22:48:50,756 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-14 22:48:50,756 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-14 22:48:50,756 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-14 22:48:51,065 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 19, Symbol AUDJPY
2025-07-14 22:48:51,066 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 19, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,066 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 19, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.751744')], HighestMarginPerLot=654.751744
2025-07-14 22:48:51,066 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 19, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-14 22:48:51,066 - INFO - orders - [TOTAL_USER_MARGIN] User 19 total margin across all symbols: 6.55
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol EURUSD
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180')], HighestMarginPerLot=1180
2025-07-14 22:48:51,267 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=11.80
2025-07-14 22:48:51,267 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 18.38
2025-07-14 22:48:51,883 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-14 22:48:51,883 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-14 22:48:51,883 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDSGD
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.353812')], HighestMarginPerLot=780.353812
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDSGD: CalculatedTotalMargin=7.80
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=4.00000000, TotalSellQty=0, NetQty=4.00000000, IsHedged=False
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24466.1075')], HighestMarginPerLot=24466.1075
2025-07-14 22:48:51,884 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=97864.43
2025-07-14 22:48:51,884 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 97915.37
2025-07-14 22:49:52,649 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:49:59,565 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:49:59,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:49:59,566 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:50:22,565 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:50:27,862 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:50:27,863 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:50:27,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:50:27,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:50:27,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:50:27,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:50:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:50:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:50:27,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:50:27,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:50:27,868 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:50:27,868 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:51:31,700 - INFO - orders - Order placement request received - User: 4, Symbol: BTCUSD, Type: BUY
2025-07-14 22:51:32,197 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117174.9000000000', 'o': '117174.8000000000'}
2025-07-14 22:51:32,198 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117174.9000000000, ask=117186.61749000000000
2025-07-14 22:51:32,198 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117174.9000000000, ask=117186.61749000000000
2025-07-14 22:51:32,198 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.28, Price: 117186.61749000000000, Margin: 8203.06, Commission: 65.62
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 4, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.28, FullMargin: 8203.06
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 2
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.28, Margin=8203.06
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 2 existing orders + 1 new order
2025-07-14 22:51:32,198 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol BTCUSD
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.29000000, TotalSellQty=0.01000000, NetQty=0.29000000, IsHedged=True
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449'), Decimal('29296.64285714285714285714286')], HighestMarginPerLot=29449
2025-07-14 22:51:32,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=8540.21
2025-07-14 22:51:32,199 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:51:32,199 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 4, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 294.49, MarginAfter: 8540.21, AdditionalMargin: 8245.72, OpenOrders: 2
2025-07-14 22:51:32,200 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.28, Margin=8203.06
2025-07-14 22:51:32,200 - INFO - orders - [PERF] Order processing: 0.4910s
2025-07-14 22:51:32,819 - INFO - orders - [PERF] Order creation: 0.6196s
2025-07-14 22:51:32,820 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-14 22:51:32,820 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-14 22:51:32,820 - INFO - orders - [PERF] TOTAL place_order: 1.1200s
2025-07-14 22:51:33,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:51:33,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:33,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:51:33,751 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:51:33,752 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:51:33,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:51:33,753 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-14 22:51:33,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('328.629664')], HighestMarginPerLot=328.629664
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=3.29
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol CADJPY
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADJPY: AllMarginsPerLot=[Decimal('365.578111'), Decimal('365.564821')], HighestMarginPerLot=365.578111
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADJPY: CalculatedTotalMargin=3.66
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol EURPLN
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol EURPLN: AllMarginsPerLot=[Decimal('2130'), Decimal('2130'), Decimal('2130')], HighestMarginPerLot=2130
2025-07-14 22:51:33,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol EURPLN: CalculatedTotalMargin=42.60
2025-07-14 22:51:33,952 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 350.62
2025-07-14 22:51:33,954 - INFO - orders - Background balance/margin cache updated for user 4: balance=8728.66000000, margin=350.62
2025-07-14 22:51:34,979 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-14 22:51:35,274 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 4
2025-07-14 22:52:26,143 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 22:52:27,452 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 22:52:27,452 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 22:52:27,452 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 22:52:27,453 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 22:52:31,527 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 22:52:31,527 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 22:52:32,455 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 22:52:37,451 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 22:52:42,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:52:42,790 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:52:42,790 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 22:52:42,790 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 22:52:42,790 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 22:52:43,366 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:53:11,691 - INFO - orders - Order placement request received - User: 4, Symbol: BTCUSD, Type: BUY
2025-07-14 22:53:12,103 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117213.0000000000', 'o': '117212.9000000000'}
2025-07-14 22:53:12,103 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117213.0000000000, ask=117224.72130000000000
2025-07-14 22:53:12,103 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117213.0000000000, ask=117224.72130000000000
2025-07-14 22:53:12,103 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.26, Price: 117224.72130000000000, Margin: 7619.61, Commission: 60.96
2025-07-14 22:53:12,104 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 4, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.26, FullMargin: 7619.61
2025-07-14 22:53:12,104 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-14 22:53:12,104 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.26, Margin=7619.61
2025-07-14 22:53:12,105 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-14 22:53:12,105 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-14 22:53:12,105 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 4, Symbol BTCUSD. Returning zero margin.
2025-07-14 22:53:12,105 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:53:12,106 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26, TotalSellQty=0, NetQty=0.26, IsHedged=False
2025-07-14 22:53:12,106 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29306.19230769230769230769231')], HighestMarginPerLot=29306.19230769230769230769231
2025-07-14 22:53:12,106 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7619.61
2025-07-14 22:53:12,106 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-14 22:53:12,106 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 4, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 7619.61, AdditionalMargin: 7619.61, OpenOrders: 0
2025-07-14 22:53:12,106 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.26, Margin=7619.61
2025-07-14 22:53:12,107 - INFO - orders - [PERF] Order processing: 0.4146s
2025-07-14 22:53:12,136 - INFO - orders - [PERF] Order creation: 0.0289s
2025-07-14 22:53:12,136 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-14 22:53:12,136 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-14 22:53:12,136 - INFO - orders - [PERF] TOTAL place_order: 0.4462s
2025-07-14 22:53:12,153 - INFO - orders - Background balance/margin cache updated for user 4: balance=8728.66000000, margin=0.0
2025-07-14 22:53:12,167 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-14 22:53:12,480 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 4
2025-07-14 22:54:49,601 - INFO - orders - Order 1000057-001 transitioning to OPEN. Calculating margin.
2025-07-14 22:54:49,601 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-14 22:54:49,602 - INFO - orders - Using group_name: Group B for order 1000057-001
2025-07-14 22:54:49,963 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-14 22:54:49,963 - INFO - orders - Using user's leverage from cache: 200.00
2025-07-14 22:54:49,963 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '117161.8000000000', 'o': '117161.7000000000'}
2025-07-14 22:54:49,963 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=117161.8000000000, ask=117173.51618000000000
2025-07-14 22:54:49,964 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=117161.8000000000, ask=117173.51618000000000
2025-07-14 22:54:49,964 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.26000000, Price: 117173.51618000000000, Margin: 7616.28, Commission: 60.93
2025-07-14 22:54:49,964 - INFO - orders - New margin calculated: 7616.28, contract_value: 0.26
2025-07-14 22:54:49,964 - INFO - orders - [MARGIN] Final stored margin (USD): 7616.28
2025-07-14 22:54:49,964 - INFO - orders - Recalculating total hedged margin for user 4 on symbol BTCUSD
2025-07-14 22:54:49,965 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 4, Symbol BTCUSD. Returning zero margin.
2025-07-14 22:54:49,965 - INFO - orders - Old total margin for BTCUSD: 0.0
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 22:54:49,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 22:54:49,966 - INFO - orders - New total margin for BTCUSD: 7616.28
2025-07-14 22:54:49,966 - INFO - orders - Margin change for user 4: 7616.28
2025-07-14 22:54:49,969 - INFO - orders - User 4 margin updated from 297.78000000 to 7914.06000000
2025-07-14 22:54:49,991 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 22:54:49,991 - INFO - orders - Using order model: UserOrder
2025-07-14 22:54:49,993 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 22:54:49,994 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 22:54:49,995 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 22:54:49,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:54:49,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 22:54:49,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 22:54:49,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 22:54:49,997 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 22:54:49,999 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 22:56:29,572 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:56:31,667 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:56:31,667 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 22:56:31,668 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 22:56:31,668 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 22:56:31,668 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 22:56:47,516 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 22:56:50,088 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 22:56:50,088 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 22:56:50,088 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 22:56:50,088 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 22:56:50,088 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 22:57:47,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 22:57:47,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 22:57:47,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 22:57:47,337 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 22:57:47,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 22:57:47,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 22:57:47,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 22:57:47,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 22:57:47,342 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 22:59:58,662 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 23:00:01,180 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:00:01,180 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:00:01,180 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:00:01,180 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:00:01,180 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1954')], HighestMarginPerLot=1954
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.54
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol BTCUSD
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: TotalBuyQty=6.00000000, TotalSellQty=0, NetQty=6.00000000, IsHedged=False
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24410.82166666666666666666667')], HighestMarginPerLot=24410.82166666666666666666667
2025-07-14 23:02:47,476 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol BTCUSD: CalculatedTotalMargin=146464.93
2025-07-14 23:02:47,476 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 146484.47
2025-07-14 23:02:47,481 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-14 23:02:47,482 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-14 23:02:47,482 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.341805'), Decimal('654.258453')], HighestMarginPerLot=654.341805
2025-07-14 23:02:47,482 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-14 23:02:47,482 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-14 23:03:41,453 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 23:03:43,140 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:03:43,140 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:03:43,140 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:03:43,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:03:43,141 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:04:21,208 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-14 23:04:24,057 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:04:24,058 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:04:24,058 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:04:24,058 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:04:24,058 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:04:27,128 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:04:27,129 - INFO - orders - Using order model: UserOrder
2025-07-14 23:04:27,178 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:04:27,222 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:04:27,246 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:04:27,266 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:04:27,266 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:04:27,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:04:27,274 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:04:27,274 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:04:27,330 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:05:27,021 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:05:27,021 - INFO - orders - Using order model: UserOrder
2025-07-14 23:05:27,024 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:05:27,027 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:05:27,029 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:05:27,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:05:27,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:05:27,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:05:27,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:05:27,036 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:05:27,037 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
2025-07-14 23:07:26,960 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-14 23:07:28,145 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-14 23:07:28,146 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-14 23:07:28,146 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-14 23:07:28,146 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-14 23:07:32,236 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-14 23:07:32,236 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-14 23:07:33,134 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-14 23:07:38,144 - INFO - orders - Starting the users with orders cache updater task.
2025-07-14 23:07:51,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:07:51,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:07:51,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:07:51,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:07:51,805 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:08:27,923 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-14 23:08:27,923 - INFO - orders - Using order model: UserOrder
2025-07-14 23:08:27,929 - INFO - orders - Fetched 1 open orders for user 4
2025-07-14 23:08:27,934 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-14 23:08:27,936 - INFO - orders - Updated static orders cache for user 4 with 1 open orders and 0 pending orders
2025-07-14 23:08:27,942 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol BTCUSD
2025-07-14 23:08:27,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.26000000, TotalSellQty=0, NetQty=0.26000000, IsHedged=False
2025-07-14 23:08:27,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29293.38461538461538461538462')], HighestMarginPerLot=29293.38461538461538461538462
2025-07-14 23:08:27,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=7616.28
2025-07-14 23:08:27,943 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 7616.28
2025-07-14 23:08:27,946 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=8728.66000000, margin=7616.28
