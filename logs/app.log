2025-07-15 23:41:58,226 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 23:41:58,277 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 23:41:58,293 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 23:41:58,294 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 23:41:59,126 - INFO - app - Application starting up - Trading system initialized
2025-07-15 23:41:59,126 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 23:41:59,126 - INFO - app - Environment: DEVELOPMENT
2025-07-15 23:41:59,196 - INFO - app - Application startup initiated
2025-07-15 23:41:59,196 - INFO - app - Initializing core services...
2025-07-15 23:41:59,248 - INFO - app - Firebase initialized
2025-07-15 23:41:59,248 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 23:42:01,612 - INFO - app - Redis initialized
2025-07-15 23:42:01,621 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 23:42:01,624 - INFO - app - Scheduler initialized
2025-07-15 23:42:01,631 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 23:42:01,631 - DEBUG - app.firebase_stream - Successfully got running event loop in process_firebase_events task.
2025-07-15 23:42:01,632 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 23:42:02,577 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 23:42:02,578 - INFO - app - Starting stale cache cleanup task
2025-07-15 23:42:02,591 - DEBUG - app.firebase_stream - Firebase listener triggered (1). Event Type: put, Path: /. Timestamp: 1752648122.590762
2025-07-15 23:42:02,591 - DEBUG - app.firebase_stream - Prepared batch update for 48 symbols from root path for queue. Preview: {'AUDCAD': {'b': '0.8949500000', 'o': '0.8949300000'}, 'AUDCHF': {'b': '0.5225900000', 'o': '0.5225400000'}, 'AUDJPY': {'b': '97.0400000000', 'o': '97.0340000000'}, 'AUDNZD': {'b': '1.0000000000', 'o'
2025-07-15 23:42:02,591 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'AUDCAD': {'b': '0.8949500000', 'o': '0.8949300000'}, 'AUDCHF': {'b': '0.5225900000', 'o': '0.5225400000'}, 'AUDJPY': {'b': '97.0400000000', 'o': '97.0340000000'}, 'AUDNZD': {'b': '1.0000000000', 'o'...
2025-07-15 23:42:02,591 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type put at path /.
2025-07-15 23:42:03,188 - DEBUG - app.firebase_stream - Firebase listener triggered (2). Event Type: patch, Path: /. Timestamp: 1752648123.1886377
2025-07-15 23:42:03,188 - DEBUG - app.firebase_stream - Prepared batch update for 39 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0191000000', 'o': '13.0164000000'}, 'NZDJPY': {'b': '88.5250000000', 'o': '88.5160000000'}, 'GBPAUD': {'b': '2.0552500000', 'o': '2.0550800000'}, 'BTCUSD': {'b': '118244.530000000
2025-07-15 23:42:03,189 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0191000000', 'o': '13.0164000000'}, 'NZDJPY': {'b': '88.5250000000', 'o': '88.5160000000'}, 'GBPAUD': {'b': '2.0552500000', 'o': '2.0550800000'}, 'BTCUSD': {'b': '118244.530000000...
2025-07-15 23:42:03,189 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:05,566 - DEBUG - app.firebase_stream - Firebase listener triggered (3). Event Type: patch, Path: /. Timestamp: 1752648125.5664256
2025-07-15 23:42:05,566 - DEBUG - app.firebase_stream - Prepared batch update for 30 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0185000000', 'o': '13.0159000000'}, 'XAGUSD': {'b': '37.8890000000', 'o': '37.8830000000'}, 'NZDJPY': {'b': '88.5240000000', 'o': '88.5160000000'}, 'GBPAUD': {'b': '2.0552400000',
2025-07-15 23:42:05,567 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0185000000', 'o': '13.0159000000'}, 'XAGUSD': {'b': '37.8890000000', 'o': '37.8830000000'}, 'NZDJPY': {'b': '88.5240000000', 'o': '88.5160000000'}, 'GBPAUD': {'b': '2.0552400000',...
2025-07-15 23:42:05,567 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:06,659 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 23:42:06,659 - INFO - app - Background tasks initialized
2025-07-15 23:42:07,405 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 23:42:07,406 - INFO - app - Application startup completed successfully
2025-07-15 23:42:07,406 - INFO - app - Starting cache validation task
2025-07-15 23:42:07,408 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 23:42:07,409 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:07,411 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 23:42:07,442 - INFO - app - Validating cache for 31 users
2025-07-15 23:42:07,445 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:07,808 - DEBUG - app.firebase_stream - Firebase listener triggered (4). Event Type: patch, Path: /. Timestamp: 1752648127.80836
2025-07-15 23:42:07,808 - DEBUG - app.firebase_stream - Prepared batch update for 27 symbols from root path for queue. Preview: {'XAGUSD': {'b': '37.8900000000', 'o': '37.8800000000'}, 'NZDJPY': {'b': '88.5250000000', 'o': '88.5170000000'}, 'GBPAUD': {'b': '2.0552700000', 'o': '2.0551100000'}, 'BTCUSD': {'b': '118268.880000000
2025-07-15 23:42:07,808 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 2. Data preview: {'XAGUSD': {'b': '37.8900000000', 'o': '37.8800000000'}, 'NZDJPY': {'b': '88.5250000000', 'o': '88.5170000000'}, 'GBPAUD': {'b': '2.0552700000', 'o': '2.0551100000'}, 'BTCUSD': {'b': '118268.880000000...
2025-07-15 23:42:07,808 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:08,458 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:08,461 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:09,451 - INFO - app - Found 23 static orders cache entries to check
2025-07-15 23:42:09,477 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:09,480 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:10,095 - DEBUG - app.firebase_stream - Firebase listener triggered (5). Event Type: patch, Path: /. Timestamp: 1752648130.0957
2025-07-15 23:42:10,095 - DEBUG - app.firebase_stream - Prepared batch update for 34 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0187000000', 'o': '13.0161000000'}, 'XAGUSD': {'b': '37.8890000000', 'o': '37.8830000000'}, 'NZDJPY': {'b': '88.5280000000', 'o': '88.5190000000'}, 'BTCUSD': {'b': '118247.1700000
2025-07-15 23:42:10,096 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 2. Data preview: {'GBPSEK': {'b': '13.0187000000', 'o': '13.0161000000'}, 'XAGUSD': {'b': '37.8890000000', 'o': '37.8830000000'}, 'NZDJPY': {'b': '88.5280000000', 'o': '88.5190000000'}, 'BTCUSD': {'b': '118247.1700000...
2025-07-15 23:42:10,096 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:10,488 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:10,492 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:11,490 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-15 23:42:11,502 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:11,506 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:12,425 - DEBUG - app.firebase_stream - Firebase listener triggered (6). Event Type: patch, Path: /. Timestamp: 1752648132.4252253
2025-07-15 23:42:12,425 - DEBUG - app.firebase_stream - Prepared batch update for 35 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0185000000', 'o': '13.0158000000'}, 'NZDJPY': {'b': '88.5260000000', 'o': '88.5190000000'}, 'GBPAUD': {'b': '2.0552400000', 'o': '2.0551000000'}, 'USDJPY': {'b': '148.6910000000',
2025-07-15 23:42:12,425 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 3. Data preview: {'GBPSEK': {'b': '13.0185000000', 'o': '13.0158000000'}, 'NZDJPY': {'b': '88.5260000000', 'o': '88.5190000000'}, 'GBPAUD': {'b': '2.0552400000', 'o': '2.0551000000'}, 'USDJPY': {'b': '148.6910000000',...
2025-07-15 23:42:12,426 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:12,511 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:12,513 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:13,518 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:13,573 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:13,592 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 23:42:13,594 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 23:42:14,576 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:14,578 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:14,730 - DEBUG - app.firebase_stream - Firebase listener triggered (7). Event Type: patch, Path: /. Timestamp: 1752648134.7300253
2025-07-15 23:42:14,730 - DEBUG - app.firebase_stream - Prepared batch update for 40 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0191000000', 'o': '13.0164000000'}, 'XAGUSD': {'b': '37.8820000000', 'o': '37.8750000000'}, 'NZDJPY': {'b': '88.5250000000', 'o': '88.5170000000'}, 'GBPAUD': {'b': '2.0554100000',
2025-07-15 23:42:14,731 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 3. Data preview: {'GBPSEK': {'b': '13.0191000000', 'o': '13.0164000000'}, 'XAGUSD': {'b': '37.8820000000', 'o': '37.8750000000'}, 'NZDJPY': {'b': '88.5250000000', 'o': '88.5170000000'}, 'GBPAUD': {'b': '2.0554100000',...
2025-07-15 23:42:14,731 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:15,133 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 23:42:15,158 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 23:42:15,192 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 23:42:15,484 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 23:42:15,579 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 23:42:15,584 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:15,587 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:15,588 - DEBUG - app.api.v1.endpoints.users - Comparing Redis user_id (type: <class 'int'>, value: 14) with decoded user_id (type: <class 'str'>, value: 14)
2025-07-15 23:42:15,588 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 23:42:15,590 - DEBUG - app.api.v1.endpoints.users - Comparing Redis user_id (type: <class 'int'>, value: 14) with decoded user_id (type: <class 'str'>, value: 14)
2025-07-15 23:42:15,590 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 23:42:15,593 - DEBUG - app.api.v1.endpoints.users - Comparing Redis user_id (type: <class 'int'>, value: 14) with decoded user_id (type: <class 'str'>, value: 14)
2025-07-15 23:42:15,593 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 23:42:15,594 - DEBUG - app.api.v1.endpoints.users - Comparing Redis user_id (type: <class 'int'>, value: 14) with decoded user_id (type: <class 'str'>, value: 14)
2025-07-15 23:42:15,595 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 23:42:15,596 - DEBUG - app.api.v1.endpoints.users - Comparing Redis user_id (type: <class 'int'>, value: 14) with decoded user_id (type: <class 'str'>, value: 14)
2025-07-15 23:42:15,596 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 23:42:15,597 - DEBUG - app.api.v1.endpoints.users - Comparing Redis user_id (type: <class 'int'>, value: 14) with decoded user_id (type: <class 'str'>, value: 14)
2025-07-15 23:42:15,597 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 23:42:15,601 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 23:42:15,622 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 23:42:15,626 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 23:42:15,626 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 23:42:15,629 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 23:42:15,634 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 23:42:15,637 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 23:42:15,645 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 23:42:15,669 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 23:42:15,731 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 23:42:15,745 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 23:42:15,760 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 23:42:15,763 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 23:42:15,771 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 23:42:15,777 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 23:42:15,782 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 23:42:15,785 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 23:42:15,787 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 23:42:15,789 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 23:42:15,791 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 23:42:15,791 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 23:42:15,797 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 23:42:15,799 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 23:42:16,075 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-15 23:42:16,076 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-15 23:42:16,598 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:16,600 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:17,046 - DEBUG - app.firebase_stream - Firebase listener triggered (8). Event Type: patch, Path: /. Timestamp: 1752648137.0460258
2025-07-15 23:42:17,046 - DEBUG - app.firebase_stream - Prepared batch update for 34 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0196000000', 'o': '13.0170000000'}, 'XAGUSD': {'b': '37.8830000000', 'o': '37.8750000000'}, 'NZDJPY': {'b': '88.5280000000', 'o': '88.5190000000'}, 'GBPAUD': {'b': '2.0553800000',
2025-07-15 23:42:17,047 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0196000000', 'o': '13.0170000000'}, 'XAGUSD': {'b': '37.8830000000', 'o': '37.8750000000'}, 'NZDJPY': {'b': '88.5280000000', 'o': '88.5190000000'}, 'GBPAUD': {'b': '2.0553800000',...
2025-07-15 23:42:17,047 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:17,604 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:17,607 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:17,827 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 23:42:17,832 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 23:42:17,832 - INFO - app - Completed stale cache cleanup task
2025-07-15 23:42:17,850 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 23:42:17,907 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 23:42:17,949 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 23:42:18,611 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:18,613 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:19,362 - DEBUG - app.firebase_stream - Firebase listener triggered (9). Event Type: patch, Path: /. Timestamp: 1752648139.3622837
2025-07-15 23:42:19,362 - DEBUG - app.firebase_stream - Prepared batch update for 26 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0199000000', 'o': '13.0173000000'}, 'GBPAUD': {'b': '2.0554100000', 'o': '2.0552700000'}, 'USDJPY': {'b': '148.6850000000', 'o': '148.6840000000'}, 'USDCNH': {'b': '7.1813800000',
2025-07-15 23:42:19,363 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0199000000', 'o': '13.0173000000'}, 'GBPAUD': {'b': '2.0554100000', 'o': '2.0552700000'}, 'USDJPY': {'b': '148.6850000000', 'o': '148.6840000000'}, 'USDCNH': {'b': '7.1813800000',...
2025-07-15 23:42:19,363 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:19,621 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:19,641 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:20,121 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 23:42:20,296 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 23:42:20,656 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:20,658 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:21,675 - DEBUG - app.firebase_stream - Firebase listener triggered (10). Event Type: patch, Path: /. Timestamp: 1752648141.6753104
2025-07-15 23:42:21,675 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:21,675 - DEBUG - app.firebase_stream - Prepared batch update for 29 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0189000000', 'o': '13.0163900000'}, 'NZDJPY': {'b': '88.5250000000', 'o': '88.5160000000'}, 'GBPAUD': {'b': '2.0553500000', 'o': '2.0552200000'}, 'USDJPY': {'b': '148.6870000000',
2025-07-15 23:42:21,677 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0189000000', 'o': '13.0163900000'}, 'NZDJPY': {'b': '88.5250000000', 'o': '88.5160000000'}, 'GBPAUD': {'b': '2.0553500000', 'o': '2.0552200000'}, 'USDJPY': {'b': '148.6870000000',...
2025-07-15 23:42:21,678 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:21,678 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:22,395 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 23:42:22,413 - INFO - app - Starting stale cache cleanup task
2025-07-15 23:42:22,431 - INFO - app - Found 23 static orders cache entries to check
2025-07-15 23:42:22,452 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 23:42:22,469 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 23:42:22,488 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 23:42:22,491 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 23:42:22,502 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 23:42:22,521 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 23:42:22,532 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 23:42:22,545 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 23:42:22,551 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 23:42:22,560 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 23:42:22,562 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 23:42:22,566 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 23:42:22,590 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 23:42:22,605 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 23:42:22,621 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 23:42:22,653 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 23:42:22,656 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 23:42:22,664 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 23:42:22,687 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:22,692 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 23:42:22,695 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:22,704 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 23:42:22,705 - INFO - app - Completed stale cache cleanup task
2025-07-15 23:42:23,720 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:23,725 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:24,006 - DEBUG - app.firebase_stream - Firebase listener triggered (11). Event Type: patch, Path: /. Timestamp: 1752648144.0067754
2025-07-15 23:42:24,007 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0179000000', 'o': '13.0153000000'}, 'XAGUSD': {'b': '37.8840000000', 'o': '37.8780000000'}, 'GBPAUD': {'b': '2.0553500000', 'o': '2.0552800000'}, 'USDJPY': {'b': '148.6820000000',
2025-07-15 23:42:24,008 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0179000000', 'o': '13.0153000000'}, 'XAGUSD': {'b': '37.8840000000', 'o': '37.8780000000'}, 'GBPAUD': {'b': '2.0553500000', 'o': '2.0552800000'}, 'USDJPY': {'b': '148.6820000000',...
2025-07-15 23:42:24,008 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:24,728 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:24,731 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:24,746 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 23:42:24,841 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-15 23:42:24,841 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-15 23:42:25,735 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:25,738 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:26,348 - DEBUG - app.firebase_stream - Firebase listener triggered (12). Event Type: patch, Path: /. Timestamp: 1752648146.3487616
2025-07-15 23:42:26,349 - DEBUG - app.firebase_stream - Prepared batch update for 38 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0178000000', 'o': '13.0152000000'}, 'NZDJPY': {'b': '88.5310000000', 'o': '88.5280000000'}, 'GBPAUD': {'b': '2.0552500000', 'o': '2.0552100000'}, 'BTCUSD': {'b': '118248.520000000
2025-07-15 23:42:26,349 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0178000000', 'o': '13.0152000000'}, 'NZDJPY': {'b': '88.5310000000', 'o': '88.5280000000'}, 'GBPAUD': {'b': '2.0552500000', 'o': '2.0552100000'}, 'BTCUSD': {'b': '118248.520000000...
2025-07-15 23:42:26,349 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:26,743 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:26,745 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:26,823 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 23:42:26,854 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 23:42:26,869 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 23:42:26,912 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 23:42:26,950 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 23:42:26,996 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 23:42:27,069 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 23:42:27,113 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 23:42:27,156 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 23:42:27,212 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 23:42:27,266 - INFO - app - Cache validation completed
2025-07-15 23:42:27,755 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:27,758 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:28,458 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 23:42:28,460 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 23:42:28,473 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 23:42:28,490 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 23:42:28,503 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 23:42:28,511 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 23:42:28,622 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 23:42:28,698 - DEBUG - app.firebase_stream - Firebase listener triggered (13). Event Type: patch, Path: /. Timestamp: 1752648148.698132
2025-07-15 23:42:28,698 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.5370000000', 'o': '88.5300000000'}, 'GBPAUD': {'b': '2.0552800000', 'o': '2.0551900000'}, 'BTCUSD': {'b': '118250.0000000000', 'o': '118249.9000000000'}, 'USDJPY': {'b': '148.6840
2025-07-15 23:42:28,698 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.5370000000', 'o': '88.5300000000'}, 'GBPAUD': {'b': '2.0552800000', 'o': '2.0551900000'}, 'BTCUSD': {'b': '118250.0000000000', 'o': '118249.9000000000'}, 'USDJPY': {'b': '148.6840...
2025-07-15 23:42:28,698 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:28,762 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:28,765 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:28,858 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 23:42:28,863 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 23:42:28,864 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 23:42:28,864 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 23:42:28,865 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 23:42:28,868 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 23:42:28,870 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 23:42:28,877 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 23:42:28,877 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 23:42:28,881 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 23:42:28,881 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 23:42:28,882 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 23:42:28,882 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 23:42:28,890 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 23:42:28,890 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 23:42:28,890 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 23:42:28,891 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 23:42:28,892 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 23:42:28,892 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 23:42:28,893 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 23:42:28,893 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 23:42:29,766 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:29,769 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:30,776 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:30,778 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:31,098 - DEBUG - app.firebase_stream - Firebase listener triggered (14). Event Type: patch, Path: /. Timestamp: 1752648151.0982842
2025-07-15 23:42:31,098 - DEBUG - app.firebase_stream - Prepared batch update for 21 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0194000000', 'o': '13.0168000000'}, 'XAGUSD': {'b': '37.8850000000', 'o': '37.8780000000'}, 'NZDJPY': {'b': '88.5380000000', 'o': '88.5300000000'}, 'USDJPY': {'b': '148.6850000000
2025-07-15 23:42:31,098 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0194000000', 'o': '13.0168000000'}, 'XAGUSD': {'b': '37.8850000000', 'o': '37.8780000000'}, 'NZDJPY': {'b': '88.5380000000', 'o': '88.5300000000'}, 'USDJPY': {'b': '148.6850000000...
2025-07-15 23:42:31,098 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:31,784 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:31,787 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:32,789 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:32,792 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:33,535 - DEBUG - app.firebase_stream - Firebase listener triggered (15). Event Type: patch, Path: /. Timestamp: 1752648153.535151
2025-07-15 23:42:33,535 - DEBUG - app.firebase_stream - Prepared batch update for 12 symbols from root path for queue. Preview: {'GBPAUD': {'b': '2.0552800000', 'o': '2.0551200000'}, 'EURNZD': {'b': '1.9526800000', 'o': '1.9525000000'}, 'SGDJPY': {'b': '115.8050000000', 'o': '115.7850000000'}, 'USDCHF': {'b': '0.8007500000', '
2025-07-15 23:42:33,535 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPAUD': {'b': '2.0552800000', 'o': '2.0551200000'}, 'EURNZD': {'b': '1.9526800000', 'o': '1.9525000000'}, 'SGDJPY': {'b': '115.8050000000', 'o': '115.7850000000'}, 'USDCHF': {'b': '0.8007500000', '...
2025-07-15 23:42:33,536 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:33,796 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:33,799 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:34,820 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:34,823 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:35,831 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:35,833 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:35,966 - DEBUG - app.firebase_stream - Firebase listener triggered (16). Event Type: patch, Path: /. Timestamp: 1752648155.966422
2025-07-15 23:42:35,966 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0190000000', 'o': '13.0164000000'}, 'XAGUSD': {'b': '37.8930000000', 'o': '37.8830000000'}, 'NZDJPY': {'b': '88.5380000000', 'o': '88.5310000000'}, 'GBPAUD': {'b': '2.0552600000',
2025-07-15 23:42:35,966 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0190000000', 'o': '13.0164000000'}, 'XAGUSD': {'b': '37.8930000000', 'o': '37.8830000000'}, 'NZDJPY': {'b': '88.5380000000', 'o': '88.5310000000'}, 'GBPAUD': {'b': '2.0552600000',...
2025-07-15 23:42:35,966 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:36,837 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:36,839 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:37,845 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:37,847 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:38,221 - DEBUG - app.firebase_stream - Firebase listener triggered (17). Event Type: patch, Path: /. Timestamp: 1752648158.2215507
2025-07-15 23:42:38,222 - DEBUG - app.firebase_stream - Prepared batch update for 37 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0188000000', 'o': '13.0160000000'}, 'XAGUSD': {'b': '37.8830000000', 'o': '37.8750000000'}, 'NZDJPY': {'b': '88.5350000000', 'o': '88.5280000000'}, 'GBPAUD': {'b': '2.0552400000',
2025-07-15 23:42:38,222 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0188000000', 'o': '13.0160000000'}, 'XAGUSD': {'b': '37.8830000000', 'o': '37.8750000000'}, 'NZDJPY': {'b': '88.5350000000', 'o': '88.5280000000'}, 'GBPAUD': {'b': '2.0552400000',...
2025-07-15 23:42:38,223 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:38,850 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:38,852 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:39,861 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:39,863 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:40,582 - DEBUG - app.firebase_stream - Firebase listener triggered (18). Event Type: patch, Path: /. Timestamp: 1752648160.5820904
2025-07-15 23:42:40,582 - DEBUG - app.firebase_stream - Prepared batch update for 37 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0182000000', 'o': '13.0161100000'}, 'XAGUSD': {'b': '37.8940000000', 'o': '37.8850000000'}, 'NZDJPY': {'b': '88.5400000000', 'o': '88.5340000000'}, 'GBPAUD': {'b': '2.0552900000',
2025-07-15 23:42:40,582 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 1. Data preview: {'GBPSEK': {'b': '13.0182000000', 'o': '13.0161100000'}, 'XAGUSD': {'b': '37.8940000000', 'o': '37.8850000000'}, 'NZDJPY': {'b': '88.5400000000', 'o': '88.5340000000'}, 'GBPAUD': {'b': '2.0552900000',...
2025-07-15 23:42:40,583 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:40,878 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:40,881 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:41,891 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:41,893 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:42,837 - DEBUG - app.firebase_stream - Firebase listener triggered (19). Event Type: patch, Path: /. Timestamp: 1752648162.8377283
2025-07-15 23:42:42,838 - DEBUG - app.firebase_stream - Prepared batch update for 37 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0179000000', 'o': '13.0153000000'}, 'NZDJPY': {'b': '88.5450000000', 'o': '88.5380000000'}, 'GBPAUD': {'b': '2.0551200000', 'o': '2.0551000000'}, 'USDJPY': {'b': '148.6810000000',
2025-07-15 23:42:42,838 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0179000000', 'o': '13.0153000000'}, 'NZDJPY': {'b': '88.5450000000', 'o': '88.5380000000'}, 'GBPAUD': {'b': '2.0551200000', 'o': '2.0551000000'}, 'USDJPY': {'b': '148.6810000000',...
2025-07-15 23:42:42,838 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:42,895 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:42,897 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:43,899 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:43,902 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:44,909 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:44,910 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:45,189 - DEBUG - app.firebase_stream - Firebase listener triggered (20). Event Type: patch, Path: /. Timestamp: 1752648165.1894405
2025-07-15 23:42:45,189 - DEBUG - app.firebase_stream - Prepared batch update for 36 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0189000000', 'o': '13.0163000000'}, 'XAGUSD': {'b': '37.8980000000', 'o': '37.8930000000'}, 'NZDJPY': {'b': '88.5480000000', 'o': '88.5390000000'}, 'GBPAUD': {'b': '2.0551100000',
2025-07-15 23:42:45,190 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0189000000', 'o': '13.0163000000'}, 'XAGUSD': {'b': '37.8980000000', 'o': '37.8930000000'}, 'NZDJPY': {'b': '88.5480000000', 'o': '88.5390000000'}, 'GBPAUD': {'b': '2.0551100000',...
2025-07-15 23:42:45,190 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:45,920 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:45,923 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:46,927 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:46,929 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:47,542 - DEBUG - app.firebase_stream - Firebase listener triggered (21). Event Type: patch, Path: /. Timestamp: 1752648167.542542
2025-07-15 23:42:47,543 - DEBUG - app.firebase_stream - Prepared batch update for 39 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0173000000', 'o': '13.0147000000'}, 'XAGUSD': {'b': '37.8980000000', 'o': '37.8900000000'}, 'NZDJPY': {'b': '88.5420000000', 'o': '88.5360000000'}, 'GBPAUD': {'b': '2.0551200000',
2025-07-15 23:42:47,543 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0173000000', 'o': '13.0147000000'}, 'XAGUSD': {'b': '37.8980000000', 'o': '37.8900000000'}, 'NZDJPY': {'b': '88.5420000000', 'o': '88.5360000000'}, 'GBPAUD': {'b': '2.0551200000',...
2025-07-15 23:42:47,544 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:47,939 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:47,941 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:48,949 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:48,952 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:49,801 - DEBUG - app.firebase_stream - Firebase listener triggered (22). Event Type: patch, Path: /. Timestamp: 1752648169.801934
2025-07-15 23:42:49,802 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.5450000000', 'o': '88.5360000000'}, 'GBPAUD': {'b': '2.0552200000', 'o': '2.0550800000'}, 'BTCUSD': {'b': '118229.5700000000', 'o': '118229.5700000000'}, 'USDJPY': {'b': '148.6890
2025-07-15 23:42:49,802 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.5450000000', 'o': '88.5360000000'}, 'GBPAUD': {'b': '2.0552200000', 'o': '2.0550800000'}, 'BTCUSD': {'b': '118229.5700000000', 'o': '118229.5700000000'}, 'USDJPY': {'b': '148.6890...
2025-07-15 23:42:49,802 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:49,954 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:49,957 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:50,969 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:50,971 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:51,977 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:51,978 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:52,158 - DEBUG - app.firebase_stream - Firebase listener triggered (23). Event Type: patch, Path: /. Timestamp: 1752648172.1584647
2025-07-15 23:42:52,158 - DEBUG - app.firebase_stream - Prepared batch update for 37 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0178000000', 'o': '13.0153600000'}, 'XAGUSD': {'b': '37.8940000000', 'o': '37.8880000000'}, 'NZDJPY': {'b': '88.5420000000', 'o': '88.5330000000'}, 'GBPAUD': {'b': '2.0552500000',
2025-07-15 23:42:52,159 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0178000000', 'o': '13.0153600000'}, 'XAGUSD': {'b': '37.8940000000', 'o': '37.8880000000'}, 'NZDJPY': {'b': '88.5420000000', 'o': '88.5330000000'}, 'GBPAUD': {'b': '2.0552500000',...
2025-07-15 23:42:52,159 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:52,984 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:52,987 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:54,003 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:54,007 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:54,398 - DEBUG - app.firebase_stream - Firebase listener triggered (24). Event Type: patch, Path: /. Timestamp: 1752648174.39872
2025-07-15 23:42:54,399 - DEBUG - app.firebase_stream - Prepared batch update for 14 symbols from root path for queue. Preview: {'NZDJPY': {'b': '88.5420000000', 'o': '88.5370000000'}, 'GBPAUD': {'b': '2.0553800000', 'o': '2.0552800000'}, 'USDJPY': {'b': '148.6960000000', 'o': '148.6950000000'}, 'EURNZD': {'b': '1.9524800000',
2025-07-15 23:42:54,399 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'NZDJPY': {'b': '88.5420000000', 'o': '88.5370000000'}, 'GBPAUD': {'b': '2.0553800000', 'o': '2.0552800000'}, 'USDJPY': {'b': '148.6960000000', 'o': '148.6950000000'}, 'EURNZD': {'b': '1.9524800000',...
2025-07-15 23:42:54,399 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:55,024 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:55,026 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:56,029 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:56,032 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:56,755 - DEBUG - app.firebase_stream - Firebase listener triggered (25). Event Type: patch, Path: /. Timestamp: 1752648176.7554905
2025-07-15 23:42:56,755 - DEBUG - app.firebase_stream - Prepared batch update for 12 symbols from root path for queue. Preview: {'XAGUSD': {'b': '37.8840000000', 'o': '37.8780000000'}, 'USDJPY': {'b': '148.6990000000', 'o': '148.6940000000'}, 'USDCNH': {'b': '7.1810900000', 'o': '7.1810900000'}, 'AUDJPY': {'b': '97.0620000000'
2025-07-15 23:42:56,756 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'XAGUSD': {'b': '37.8840000000', 'o': '37.8780000000'}, 'USDJPY': {'b': '148.6990000000', 'o': '148.6940000000'}, 'USDCNH': {'b': '7.1810900000', 'o': '7.1810900000'}, 'AUDJPY': {'b': '97.0620000000'...
2025-07-15 23:42:56,756 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:42:57,035 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:57,038 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:58,053 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:58,055 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:59,071 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:42:59,074 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:42:59,113 - DEBUG - app.firebase_stream - Firebase listener triggered (26). Event Type: patch, Path: /. Timestamp: 1752648179.1134434
2025-07-15 23:42:59,113 - DEBUG - app.firebase_stream - Prepared batch update for 33 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0174000000', 'o': '13.0148500000'}, 'XAGUSD': {'b': '37.8930000000', 'o': '37.8850000000'}, 'NZDJPY': {'b': '88.5430000000', 'o': '88.5370000000'}, 'GBPAUD': {'b': '2.0552700000',
2025-07-15 23:42:59,113 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0174000000', 'o': '13.0148500000'}, 'XAGUSD': {'b': '37.8930000000', 'o': '37.8850000000'}, 'NZDJPY': {'b': '88.5430000000', 'o': '88.5370000000'}, 'GBPAUD': {'b': '2.0552700000',...
2025-07-15 23:42:59,114 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:43:00,079 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:43:00,083 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:43:01,087 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:43:01,088 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:43:01,476 - DEBUG - app.firebase_stream - Firebase listener triggered (27). Event Type: patch, Path: /. Timestamp: 1752648181.476471
2025-07-15 23:43:01,476 - DEBUG - app.firebase_stream - Prepared batch update for 32 symbols from root path for queue. Preview: {'GBPSEK': {'b': '13.0181000000', 'o': '13.0155000000'}, 'XAGUSD': {'b': '37.8940000000', 'o': '37.8850000000'}, 'NZDJPY': {'b': '88.5430000000', 'o': '88.5340000000'}, 'GBPAUD': {'b': '2.0552900000',
2025-07-15 23:43:01,477 - DEBUG - app.firebase_stream - Successfully queued data for path '/'. Queue size (approx): 0. Data preview: {'GBPSEK': {'b': '13.0181000000', 'o': '13.0155000000'}, 'XAGUSD': {'b': '37.8940000000', 'o': '37.8850000000'}, 'NZDJPY': {'b': '88.5430000000', 'o': '88.5340000000'}, 'GBPAUD': {'b': '2.0552900000',...
2025-07-15 23:43:01,477 - DEBUG - app.firebase_stream - Firebase listener callback finished for event type patch at path /.
2025-07-15 23:43:01,749 - WARNING - app - User 4 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:01,753 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 23:43:01,760 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 23:43:01,771 - WARNING - app - User 9 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:01,779 - WARNING - app - User 10 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:01,788 - WARNING - app - User 11 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:01,796 - WARNING - app - User 12 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:01,804 - WARNING - app - User 13 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:02,179 - DEBUG - app.services.portfolio_calculator - Position calculation for BTCUSD: Type=BUY, Entry=118908.50000000, Current=118198.52, Quantity=0.40000000, Contract Size=1.00000000, PnL=-283.992000000000000000000000, PnL USD=-283.992000000000000000000000, Commission=235.57000000, Final PnL=-519.562000000000000000000000
2025-07-15 23:43:02,179 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 99.57260793846369364292513953% which is below threshold 100.0%
2025-07-15 23:43:02,183 - DEBUG - app - BarclaysMarginChecker heartbeat: loop is alive
2025-07-15 23:43:02,192 - DEBUG - app - Fetched 0 live users for Barclays margin check.
2025-07-15 23:43:02,227 - WARNING - app - User 16 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:02,250 - WARNING - app - User 17 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:02,275 - WARNING - app - User 18 has no open or pending orders. Skipping portfolio update.
2025-07-15 23:43:02,283 - INFO - app - Application shutdown initiated
2025-07-15 23:43:02,284 - INFO - app - Scheduler shutdown completed
2025-07-15 23:43:02,718 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 23:43:03,730 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 23:43:03,730 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 23:43:03,734 - INFO - app - Redis connection closed
2025-07-15 23:43:03,734 - INFO - app - Application shutdown completed
