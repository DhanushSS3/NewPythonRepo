2025-07-14 03:00:54,483 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:00:54,499 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:00:54,508 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:00:54,508 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:00:54,765 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:00:54,765 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:00:54,765 - INFO - app - Environment: PRODUCTION
2025-07-14 03:00:54,807 - INFO - app - Application startup initiated
2025-07-14 03:00:54,808 - INFO - app - Initializing core services...
2025-07-14 03:00:54,845 - INFO - app - Firebase initialized
2025-07-14 03:00:54,845 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:00:56,892 - INFO - app - Redis initialized
2025-07-14 03:00:56,897 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:00:56,899 - INFO - app - Scheduler initialized
2025-07-14 03:00:56,902 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:00:56,904 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:00:58,021 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:00:58,038 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:01:02,130 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:01:02,130 - INFO - app - Background tasks initialized
2025-07-14 03:01:02,832 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:01:02,833 - INFO - app - Application startup completed successfully
2025-07-14 03:01:02,833 - INFO - app - Starting cache validation task
2025-07-14 03:01:02,836 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:01:02,838 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:01:02,865 - INFO - app - Validating cache for 31 users
2025-07-14 03:01:04,877 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:01:06,917 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 03:01:11,028 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:01:11,033 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:01:11,044 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:01:11,054 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:01:11,057 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:01:11,060 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:01:11,063 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 03:01:11,064 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:01:11,072 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:01:11,075 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:01:11,077 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:01:11,083 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:01:11,087 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:01:11,090 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 03:01:11,093 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:01:11,102 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:01:11,106 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:01:11,114 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:01:11,118 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:01:11,118 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 03:01:11,122 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:01:11,151 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 03:01:13,211 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 03:01:15,268 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 03:01:17,327 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 03:01:17,842 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:01:19,366 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:01:19,379 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:01:19,382 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:01:19,383 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,394 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:01:19,398 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:01:19,400 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:01:19,401 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,403 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:01:19,409 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:01:19,414 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:01:19,418 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:01:19,421 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:01:19,424 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:01:19,425 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,426 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:01:19,433 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:01:19,437 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:01:19,442 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:01:19,444 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:01:19,446 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,449 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:01:19,464 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,475 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,486 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,494 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,501 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,507 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,541 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,555 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,564 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,575 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,586 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 03:01:19,608 - INFO - app - Cache validation completed
2025-07-14 03:01:20,745 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:01:20,860 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:01:20,865 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:01:20,917 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:01:20,934 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:01:20,943 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:01:20,950 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:01:20,992 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:01:21,009 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:01:21,010 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:01:21,105 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:01:21,127 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:01:21,127 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:01:21,133 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:01:21,157 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:01:21,158 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:01:21,183 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:01:21,184 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:01:21,201 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:01:21,203 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:01:21,203 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:01:21,204 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:01:21,204 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:01:21,216 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:01:21,217 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:01:21,217 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:01:21,235 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:01:21,236 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:01:56,938 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:01:56,941 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:01:57,383 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 63.98080867353652790901208707% which is below threshold 100.0%
2025-07-14 03:01:57,823 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:01:57,827 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:01:57,835 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:01:57,836 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:02:56,938 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:02:56,941 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:02:57,394 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 64.07785513239724399918893181% which is below threshold 100.0%
2025-07-14 03:02:57,850 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:02:57,865 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:02:57,880 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:02:57,880 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:03:00,000 - INFO - app - Executing daily swap charge job...
2025-07-14 03:03:00,314 - INFO - app - Daily swap charge job completed successfully
2025-07-14 03:03:16,769 - INFO - app - Application shutdown initiated
2025-07-14 03:03:16,769 - INFO - app - Scheduler shutdown completed
2025-07-14 03:03:17,043 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:03:18,413 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:03:18,413 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:03:18,414 - INFO - app - Redis connection closed
2025-07-14 03:03:18,414 - INFO - app - Application shutdown completed
2025-07-14 03:06:42,114 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:06:42,128 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:06:42,144 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:06:42,144 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:06:42,684 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:06:42,685 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:06:42,685 - INFO - app - Environment: PRODUCTION
2025-07-14 03:06:42,740 - INFO - app - Application startup initiated
2025-07-14 03:06:42,740 - INFO - app - Initializing core services...
2025-07-14 03:06:42,780 - INFO - app - Firebase initialized
2025-07-14 03:06:42,781 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:06:44,806 - INFO - app - Redis initialized
2025-07-14 03:06:44,809 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:06:44,811 - INFO - app - Scheduler initialized
2025-07-14 03:06:44,814 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:06:44,815 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:06:45,978 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:06:45,993 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:06:50,061 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:06:50,061 - INFO - app - Background tasks initialized
2025-07-14 03:06:50,886 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:06:50,886 - INFO - app - Application startup completed successfully
2025-07-14 03:06:50,887 - INFO - app - Starting cache validation task
2025-07-14 03:06:50,891 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:06:50,892 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:06:50,906 - INFO - app - Validating cache for 31 users
2025-07-14 03:06:52,923 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:06:54,970 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 03:06:59,055 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:06:59,068 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:06:59,084 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:06:59,093 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:06:59,099 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:06:59,104 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:06:59,105 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 03:06:59,106 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:07:01,147 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:07:01,150 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:07:01,153 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:07:01,159 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:07:01,162 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:07:01,168 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 03:07:01,168 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:07:01,177 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:07:01,182 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:07:01,190 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:07:01,193 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:07:01,194 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 03:07:01,196 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:07:03,227 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 03:07:03,251 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 03:07:05,317 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 03:07:05,898 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:07:07,362 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:07:07,369 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:07:07,371 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:07:07,375 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 03:07:07,380 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:07:07,385 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:07:07,389 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:07:07,390 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:07:07,393 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 03:07:07,397 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:07:07,401 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:07:07,403 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:07:07,407 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:07:07,409 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:07:07,413 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:07:07,414 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 03:07:07,422 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:07:07,424 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:07:07,430 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:07:07,432 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:07:07,433 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 03:07:07,434 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:07:07,450 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 03:07:07,463 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 03:07:07,477 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,546 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,567 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,583 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,595 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,647 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,673 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,695 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,733 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,753 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 03:07:09,770 - INFO - app - Cache validation completed
2025-07-14 03:07:10,930 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:07:11,000 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:07:11,048 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:07:11,077 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:07:11,087 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:07:11,102 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:07:11,105 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:07:11,208 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:07:11,223 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:07:11,223 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:07:11,291 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:07:11,303 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:07:11,303 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:07:11,319 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:07:11,333 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:07:11,336 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:07:11,337 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:07:11,354 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:07:11,354 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:07:11,358 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:07:11,367 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:07:11,367 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:07:11,376 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:07:11,376 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:07:11,386 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:07:11,387 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:07:11,387 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:07:11,388 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:07:44,841 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:07:44,845 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:07:45,564 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 63.25866884730825817916674235% which is below threshold 100.0%
2025-07-14 03:07:45,966 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:07:45,973 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:07:45,987 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:07:45,987 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:08:44,842 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:08:44,847 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:08:45,350 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 63.20647579380333523991196870% which is below threshold 100.0%
2025-07-14 03:08:45,403 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 1 by invalidating refresh token.
2025-07-14 03:08:47,977 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:08:47,984 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:08:48,006 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:08:48,006 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:08:50,830 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 1 symbols for user 12
2025-07-14 03:08:50,830 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDNZD']
2025-07-14 03:09:05,700 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 12 by invalidating refresh token.
2025-07-14 03:09:19,709 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 03:09:19,709 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 03:09:44,836 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:09:44,838 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:09:45,382 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 62.76609690485554793994981608% which is below threshold 100.0%
2025-07-14 03:09:45,889 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:09:45,897 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:09:45,919 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:09:45,919 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:10:44,843 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:10:44,849 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:10:46,149 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '7411928111', 'user_id': '26', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '0.6', 'price': '121736.3', 'status': 'OPEN', 'contract_value': '0.6', 'account_type': 'live', 'timestamp': '2025-07-14T10:10:46.149515'}
2025-07-14 03:10:46,502 - INFO - app.core.firebase - Order data (ID: 7411928111) sent to Firebase successfully.
2025-07-14 03:10:47,182 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:10:47,194 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:10:47,232 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:10:47,234 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:11:44,867 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:11:44,879 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:11:45,943 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:11:45,988 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:11:46,040 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:11:46,042 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:12:09,779 - INFO - app - Starting cache validation task
2025-07-14 03:12:09,789 - INFO - app - Validating cache for 31 users
2025-07-14 03:12:09,791 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,800 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,804 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,815 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,825 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,835 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,846 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,856 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,867 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,877 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,889 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,915 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,928 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,944 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,958 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,970 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,981 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 03:12:09,991 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 03:12:10,003 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 03:12:10,013 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 03:12:10,021 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 03:12:10,032 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:12:10,041 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 03:12:10,054 - INFO - app - Cache validation completed
2025-07-14 03:12:44,860 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:12:44,870 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:12:46,227 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:12:46,289 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:12:46,332 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:12:46,334 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:13:00,626 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 03:13:00,626 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 03:13:44,846 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:13:44,850 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:13:45,291 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 71.56237431224550261074720536% which is below threshold 100.0%
2025-07-14 03:13:45,295 - ERROR - app - Failed to send margin call warning email to user 26 at forworkcursor@gmail.com: '\n            margin'
2025-07-14 03:13:45,704 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:13:45,713 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:13:45,726 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:13:45,726 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:14:44,826 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:14:44,828 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:14:45,267 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 71.39815485757725670032481240% which is below threshold 100.0%
2025-07-14 03:14:45,270 - ERROR - app - Failed to send margin call warning email to user 26 at forworkcursor@gmail.com: '\n            margin'
2025-07-14 03:14:45,613 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:14:45,625 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:14:45,639 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:14:45,639 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:15:44,837 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:15:44,841 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:15:45,402 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 71.52870932403851219911061480% which is below threshold 100.0%
2025-07-14 03:15:45,404 - ERROR - app - Failed to send margin call warning email to user 26 at forworkcursor@gmail.com: '\n            margin'
2025-07-14 03:15:45,814 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:15:45,818 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:15:45,828 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:15:45,828 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:16:19,192 - INFO - app - Application shutdown initiated
2025-07-14 03:16:19,192 - INFO - app - Scheduler shutdown completed
2025-07-14 03:16:19,582 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:16:19,811 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:16:19,812 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:16:19,814 - INFO - app - Redis connection closed
2025-07-14 03:16:19,814 - INFO - app - Application shutdown completed
2025-07-14 03:16:21,629 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:16:21,642 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:16:21,652 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:16:21,652 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:16:21,934 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:16:21,934 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:16:21,934 - INFO - app - Environment: PRODUCTION
2025-07-14 03:16:21,988 - INFO - app - Application startup initiated
2025-07-14 03:16:21,988 - INFO - app - Initializing core services...
2025-07-14 03:16:22,021 - INFO - app - Firebase initialized
2025-07-14 03:16:22,021 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:16:24,078 - INFO - app - Redis initialized
2025-07-14 03:16:24,083 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:16:24,085 - INFO - app - Scheduler initialized
2025-07-14 03:16:24,087 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:16:24,088 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:16:24,964 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:16:24,978 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:16:29,049 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:16:29,049 - INFO - app - Background tasks initialized
2025-07-14 03:16:29,659 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:16:29,659 - INFO - app - Application startup completed successfully
2025-07-14 03:16:29,659 - INFO - app - Starting cache validation task
2025-07-14 03:16:29,663 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:16:29,665 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:16:29,691 - INFO - app - Validating cache for 31 users
2025-07-14 03:16:31,728 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:16:37,846 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:16:37,858 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:16:37,913 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:16:37,938 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:16:37,945 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:16:37,949 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:16:37,956 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:16:37,960 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 03:16:37,960 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:16:37,965 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:16:37,967 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:16:37,972 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:16:37,976 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:16:37,987 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:16:37,992 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:16:38,000 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:16:38,005 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:16:38,009 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:16:40,206 - INFO - app - Cache validation completed
2025-07-14 03:16:41,854 - INFO - app - Application shutdown initiated
2025-07-14 03:16:41,855 - INFO - app - Scheduler shutdown completed
2025-07-14 03:16:42,351 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:16:42,952 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:16:42,952 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:16:42,955 - INFO - app - Redis connection closed
2025-07-14 03:16:42,955 - INFO - app - Application shutdown completed
2025-07-14 03:16:45,075 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:16:45,092 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:16:45,110 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:16:45,110 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:16:45,498 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:16:45,498 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:16:45,498 - INFO - app - Environment: PRODUCTION
2025-07-14 03:16:45,550 - INFO - app - Application startup initiated
2025-07-14 03:16:45,550 - INFO - app - Initializing core services...
2025-07-14 03:16:45,596 - INFO - app - Firebase initialized
2025-07-14 03:16:45,596 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:16:47,628 - INFO - app - Redis initialized
2025-07-14 03:16:47,630 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:16:47,631 - INFO - app - Scheduler initialized
2025-07-14 03:16:47,632 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:16:47,633 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:16:48,409 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:16:48,429 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:16:52,494 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:16:52,495 - INFO - app - Background tasks initialized
2025-07-14 03:16:53,293 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:16:53,383 - INFO - app - Application startup completed successfully
2025-07-14 03:16:53,384 - INFO - app - Starting cache validation task
2025-07-14 03:16:53,388 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:16:53,391 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:16:53,430 - INFO - app - Validating cache for 31 users
2025-07-14 03:16:55,432 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:16:59,501 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:16:59,511 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:17:01,553 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:17:01,569 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:17:01,577 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:17:01,582 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:17:01,593 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:17:01,597 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:17:01,602 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:17:01,605 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:17:01,610 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:17:01,620 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:17:01,632 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:17:01,642 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:17:05,691 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:17:05,698 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:17:05,702 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:17:08,389 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:17:09,863 - INFO - app - Cache validation completed
2025-07-14 03:17:09,867 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:17:09,873 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:17:09,876 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:17:09,891 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:17:09,903 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:17:09,911 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:17:09,915 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:17:09,920 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:17:09,927 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:17:09,940 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:17:09,953 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:17:09,962 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:17:09,979 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:17:10,010 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:17:10,016 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:17:10,029 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:17:10,037 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:17:10,043 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:17:13,942 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:17:13,947 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:17:13,956 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:17:14,003 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:17:14,072 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:17:14,090 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:17:14,095 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:17:14,237 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:17:14,243 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:17:14,258 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:17:14,259 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:17:14,260 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:17:14,270 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:17:14,270 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:17:14,288 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:17:14,288 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:17:14,292 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:17:14,313 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:17:14,313 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:17:14,330 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:17:14,335 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:17:14,348 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:17:14,351 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:17:14,351 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:17:14,356 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:17:14,356 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:17:14,370 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:17:14,370 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:17:47,648 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:17:47,652 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:17:48,186 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 71.49750762765154547613036014% which is below threshold 100.0%
2025-07-14 03:17:48,204 - ERROR - app - Failed to send margin call warning email to user 26 at forworkcursor@gmail.com: Single '}' encountered in format string
2025-07-14 03:17:48,652 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:17:48,668 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:17:48,692 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:17:48,693 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:17:57,475 - INFO - app - Application shutdown initiated
2025-07-14 03:17:57,476 - INFO - app - Scheduler shutdown completed
2025-07-14 03:17:57,914 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:17:59,720 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:17:59,720 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:17:59,722 - INFO - app - Redis connection closed
2025-07-14 03:17:59,723 - INFO - app - Application shutdown completed
2025-07-14 03:23:30,665 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:23:30,698 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:23:30,715 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:23:30,716 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:23:31,208 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:23:31,208 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:23:31,209 - INFO - app - Environment: PRODUCTION
2025-07-14 03:23:31,279 - INFO - app - Application startup initiated
2025-07-14 03:23:31,280 - INFO - app - Initializing core services...
2025-07-14 03:23:31,315 - INFO - app - Firebase initialized
2025-07-14 03:23:31,316 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:23:33,365 - INFO - app - Redis initialized
2025-07-14 03:23:33,369 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:23:33,371 - INFO - app - Scheduler initialized
2025-07-14 03:23:33,374 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:23:33,375 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:23:34,311 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:23:34,313 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:23:38,387 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:23:38,387 - INFO - app - Background tasks initialized
2025-07-14 03:23:39,096 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:23:39,096 - INFO - app - Application startup completed successfully
2025-07-14 03:23:39,096 - INFO - app - Starting cache validation task
2025-07-14 03:23:39,099 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:23:39,101 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:23:39,116 - INFO - app - Validating cache for 31 users
2025-07-14 03:23:41,144 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:23:43,187 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 03:23:47,273 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:23:47,277 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:23:49,306 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:23:49,312 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:23:49,316 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:23:49,321 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:23:49,322 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 03:23:49,323 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:23:51,384 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:23:53,429 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:23:53,439 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:23:53,447 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:23:53,451 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:23:53,454 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 03:23:53,456 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:23:53,465 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:23:53,469 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:23:53,476 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:23:53,478 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 03:23:53,479 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:23:53,485 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:23:53,504 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 03:23:53,520 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 03:23:53,545 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 03:23:53,561 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 03:23:54,105 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:23:55,608 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:23:55,619 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:23:55,621 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:23:55,625 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 03:23:55,633 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:23:55,639 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:23:55,641 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:23:55,644 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:23:55,645 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 03:23:55,648 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:23:55,650 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:23:55,651 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:23:55,652 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:23:55,654 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:23:55,655 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:23:57,693 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 03:23:57,694 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:23:57,701 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:23:57,707 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:23:57,709 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:23:57,712 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:23:57,714 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 03:23:57,724 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,775 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,793 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,810 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,824 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,838 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,876 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,899 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,925 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,954 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:23:59,976 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 03:24:00,034 - INFO - app - Cache validation completed
2025-07-14 03:24:01,224 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:24:01,235 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:24:01,248 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:24:01,254 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:24:01,255 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:24:01,311 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:24:01,324 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:24:01,465 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:24:01,485 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:24:01,485 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:24:01,490 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:24:01,508 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:24:01,513 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:24:01,513 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:24:01,518 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:24:01,526 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:24:01,526 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:24:01,531 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:24:01,540 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:24:01,540 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:24:01,551 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:24:01,552 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:24:01,577 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:24:01,585 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:24:01,595 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:24:01,596 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:24:01,603 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:24:01,603 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:24:33,418 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:24:33,421 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:24:33,875 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 72.02752591759330915201863343% which is below threshold 100.0%
2025-07-14 03:24:37,782 - INFO - app - Sent margin call warning email (HTML) to user 26 at forworkcursor@gmail.com
2025-07-14 03:24:38,215 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:24:38,247 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:24:38,272 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:24:38,272 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:25:33,416 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:25:33,420 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:25:33,886 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 71.95403771162926910710461258% which is below threshold 100.0%
2025-07-14 03:25:34,303 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:25:34,308 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:25:34,317 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:25:34,317 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:26:25,657 - INFO - app - Application shutdown initiated
2025-07-14 03:26:25,658 - INFO - app - Scheduler shutdown completed
2025-07-14 03:26:26,131 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:26:26,772 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:26:26,772 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:26:26,773 - INFO - app - Redis connection closed
2025-07-14 03:26:26,773 - INFO - app - Application shutdown completed
2025-07-14 03:26:28,723 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:26:28,742 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:26:28,757 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:26:28,757 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:26:29,186 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:26:29,186 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:26:29,186 - INFO - app - Environment: PRODUCTION
2025-07-14 03:26:29,234 - INFO - app - Application startup initiated
2025-07-14 03:26:29,234 - INFO - app - Initializing core services...
2025-07-14 03:26:29,268 - INFO - app - Firebase initialized
2025-07-14 03:26:29,269 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:26:31,321 - INFO - app - Redis initialized
2025-07-14 03:26:31,325 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:26:31,327 - INFO - app - Scheduler initialized
2025-07-14 03:26:31,330 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:26:31,330 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:26:32,373 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:26:32,375 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:26:36,435 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:26:36,435 - INFO - app - Background tasks initialized
2025-07-14 03:26:37,268 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:26:37,268 - INFO - app - Application startup completed successfully
2025-07-14 03:26:37,269 - INFO - app - Starting cache validation task
2025-07-14 03:26:37,271 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:26:37,273 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:26:37,303 - INFO - app - Validating cache for 31 users
2025-07-14 03:26:39,296 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:26:43,390 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:26:45,432 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:26:47,480 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:26:47,492 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:26:47,497 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:26:47,502 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:26:47,508 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:26:47,510 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:26:47,513 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:26:47,516 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:26:47,522 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:26:47,526 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:26:47,538 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:26:47,542 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:26:47,550 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:26:47,554 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:26:47,557 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:26:49,703 - INFO - app - Cache validation completed
2025-07-14 03:26:52,274 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:26:53,822 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:26:53,827 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:26:53,827 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:26:53,835 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:26:53,839 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:26:53,841 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:26:53,845 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:26:53,849 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:26:53,851 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:26:53,853 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:26:53,855 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:26:55,900 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:26:55,911 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:26:55,916 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:26:55,918 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:26:55,922 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:26:55,924 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:26:55,927 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:26:57,394 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:26:57,401 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:26:57,408 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:26:57,412 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:26:57,415 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:26:57,428 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:26:57,443 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:26:57,645 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:26:57,661 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:26:57,666 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:26:57,668 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:26:57,668 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:26:57,670 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:26:57,689 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:26:57,689 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:26:57,691 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:26:57,691 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:26:57,691 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:26:57,695 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:26:57,695 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:26:57,699 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:26:57,713 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:26:57,713 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:26:57,727 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:26:57,727 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:26:57,744 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:26:57,755 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:26:57,755 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:27:31,354 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:27:31,356 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:27:31,848 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 72.19338756680823752154525033% which is below threshold 100.0%
2025-07-14 03:27:32,264 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:27:32,271 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:27:32,281 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:27:32,281 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:28:04,150 - INFO - app - Application shutdown initiated
2025-07-14 03:28:04,150 - INFO - app - Scheduler shutdown completed
2025-07-14 03:28:04,576 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:28:06,357 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:28:06,357 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:28:06,360 - INFO - app - Redis connection closed
2025-07-14 03:28:06,360 - INFO - app - Application shutdown completed
2025-07-14 03:28:08,190 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:08,203 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:08,214 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:08,214 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:08,487 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:28:08,487 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:28:08,488 - INFO - app - Environment: PRODUCTION
2025-07-14 03:28:08,550 - INFO - app - Application startup initiated
2025-07-14 03:28:08,550 - INFO - app - Initializing core services...
2025-07-14 03:28:08,585 - INFO - app - Firebase initialized
2025-07-14 03:28:08,585 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:28:10,627 - INFO - app - Redis initialized
2025-07-14 03:28:10,631 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:28:10,632 - INFO - app - Scheduler initialized
2025-07-14 03:28:10,635 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:28:10,636 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:28:11,437 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:28:11,448 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:28:15,516 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:28:15,516 - INFO - app - Background tasks initialized
2025-07-14 03:28:16,183 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:28:16,183 - INFO - app - Application startup completed successfully
2025-07-14 03:28:16,183 - INFO - app - Starting cache validation task
2025-07-14 03:28:16,189 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:28:16,191 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:28:16,215 - INFO - app - Validating cache for 31 users
2025-07-14 03:28:18,218 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:28:22,329 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:28:24,361 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:28:24,399 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:28:24,413 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:28:24,420 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:28:24,430 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:28:24,439 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:28:24,443 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:28:24,445 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:28:24,450 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:28:24,455 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:28:24,461 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:28:24,471 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:28:24,478 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:28:24,485 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:28:24,489 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:28:24,492 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:28:26,627 - INFO - app - Cache validation completed
2025-07-14 03:28:28,125 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:28,160 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:28,167 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:28,201 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:28,211 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:28,365 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:28,373 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:28,532 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:28,546 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:28,547 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:28,549 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:28,570 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:28,584 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:28,584 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:28,598 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:28,599 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:28,632 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:28,641 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:28,651 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:28,652 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:28,659 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:28,659 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:28,681 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:28,686 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:28,697 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:28,698 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:28,700 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:28,700 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:29,630 - INFO - app - Application shutdown initiated
2025-07-14 03:28:29,631 - INFO - app - Scheduler shutdown completed
2025-07-14 03:28:29,975 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:28:31,851 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:28:31,851 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:28:31,852 - INFO - app - Redis connection closed
2025-07-14 03:28:31,852 - INFO - app - Application shutdown completed
2025-07-14 03:28:33,417 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:28:33,430 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:28:33,441 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:28:33,441 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:28:33,708 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:28:33,708 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:28:33,708 - INFO - app - Environment: PRODUCTION
2025-07-14 03:28:33,760 - INFO - app - Application startup initiated
2025-07-14 03:28:33,760 - INFO - app - Initializing core services...
2025-07-14 03:28:33,792 - INFO - app - Firebase initialized
2025-07-14 03:28:33,793 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:28:35,834 - INFO - app - Redis initialized
2025-07-14 03:28:35,839 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:28:35,841 - INFO - app - Scheduler initialized
2025-07-14 03:28:35,843 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:28:35,844 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:28:36,981 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:28:36,983 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:28:41,083 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:28:41,083 - INFO - app - Background tasks initialized
2025-07-14 03:28:41,784 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:28:41,784 - INFO - app - Application startup completed successfully
2025-07-14 03:28:41,784 - INFO - app - Starting cache validation task
2025-07-14 03:28:41,788 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:28:41,789 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:28:41,808 - INFO - app - Validating cache for 31 users
2025-07-14 03:28:43,840 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:28:49,943 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:28:49,955 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:28:49,988 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:28:52,032 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:28:52,044 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:28:52,050 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:28:52,063 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:28:52,069 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:28:52,073 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:28:52,077 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:28:52,082 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:28:52,089 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:28:52,098 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:28:52,105 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:28:52,114 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:28:52,117 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:28:52,121 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:28:56,250 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 03:28:56,791 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:28:58,300 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:28:58,307 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 03:28:58,310 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:28:58,316 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:28:58,326 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:28:58,330 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 03:28:58,330 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:28:58,333 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:28:58,335 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:28:58,338 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:28:58,339 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:28:58,340 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:28:58,341 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:28:58,342 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 03:28:58,343 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:29:00,383 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:29:00,392 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:29:00,396 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:29:00,404 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:29:00,405 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 03:29:00,406 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:29:00,411 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:29:02,455 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 03:29:02,488 - INFO - app - Cache validation completed
2025-07-14 03:29:03,870 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:29:03,976 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:29:03,983 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:29:03,985 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:29:03,989 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:29:03,995 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:29:04,002 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:29:04,126 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:29:04,148 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:29:04,148 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:29:04,230 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:29:04,231 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:29:04,250 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:29:04,250 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:29:04,253 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:29:04,253 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:29:04,258 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:29:04,266 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:29:04,267 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:29:04,269 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:29:04,272 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:29:04,272 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:29:04,279 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:29:04,279 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:29:04,284 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:29:04,284 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:29:04,290 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:29:04,290 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:29:35,881 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:29:35,884 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:29:36,363 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 72.00453519393975472455949842% which is below threshold 100.0%
2025-07-14 03:29:36,802 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:29:36,816 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:29:36,830 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:29:36,830 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:29:53,717 - INFO - app - Application shutdown initiated
2025-07-14 03:29:53,717 - INFO - app - Scheduler shutdown completed
2025-07-14 03:29:54,042 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:29:55,004 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:29:55,004 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:29:55,008 - INFO - app - Redis connection closed
2025-07-14 03:29:55,008 - INFO - app - Application shutdown completed
2025-07-14 03:29:56,630 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:29:56,644 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:29:56,653 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:29:56,653 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:29:56,962 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:29:56,962 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:29:56,962 - INFO - app - Environment: PRODUCTION
2025-07-14 03:29:57,013 - INFO - app - Application startup initiated
2025-07-14 03:29:57,013 - INFO - app - Initializing core services...
2025-07-14 03:29:57,046 - INFO - app - Firebase initialized
2025-07-14 03:29:57,046 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:29:59,093 - INFO - app - Redis initialized
2025-07-14 03:29:59,095 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:29:59,097 - INFO - app - Scheduler initialized
2025-07-14 03:29:59,098 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:29:59,099 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:30:00,020 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:30:00,043 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:30:04,107 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:30:04,108 - INFO - app - Background tasks initialized
2025-07-14 03:30:04,873 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:30:04,873 - INFO - app - Application startup completed successfully
2025-07-14 03:30:04,874 - INFO - app - Starting cache validation task
2025-07-14 03:30:04,876 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:30:04,880 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:30:04,901 - INFO - app - Validating cache for 31 users
2025-07-14 03:30:06,921 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:30:13,071 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:30:13,079 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:30:13,080 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:30:13,101 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 03:30:13,107 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:30:13,120 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:30:13,126 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:30:13,131 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:30:13,139 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:30:13,145 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:30:13,150 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:30:13,153 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:30:13,157 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:30:13,160 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:30:13,172 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:30:13,180 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:30:13,188 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 03:30:13,188 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:30:13,192 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:30:13,197 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:30:13,214 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 03:30:13,233 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 03:30:15,268 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 03:30:15,299 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 03:30:15,323 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 03:30:17,364 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 03:30:17,398 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 03:30:19,494 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 03:30:19,529 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 03:30:19,887 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:30:21,608 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 03:30:21,614 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:30:21,623 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:30:21,626 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:30:21,636 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:30:21,640 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:30:21,640 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 03:30:21,643 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:30:21,647 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:30:21,652 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:30:21,655 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:30:21,657 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:30:21,659 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:30:21,660 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 03:30:21,662 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:30:21,666 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:30:21,673 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:30:21,675 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:30:21,680 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:30:21,682 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 03:30:21,683 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:30:21,685 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:30:21,695 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:30:21,706 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 03:30:21,720 - INFO - app - Cache validation completed
2025-07-14 03:30:21,876 - INFO - app - Application shutdown initiated
2025-07-14 03:30:21,876 - INFO - app - Scheduler shutdown completed
2025-07-14 03:30:23,358 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:23,360 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:23,364 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:23,396 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:23,397 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:23,404 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:23,497 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:23,705 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:23,720 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:23,731 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:23,731 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:23,742 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:23,744 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:23,745 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:23,761 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:23,780 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:23,780 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:23,783 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:23,794 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:23,794 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:23,800 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:23,810 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:23,810 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:23,833 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:23,834 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:23,869 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:23,881 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:23,882 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:24,396 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:30:25,519 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:30:25,520 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:30:25,525 - INFO - app - Redis connection closed
2025-07-14 03:30:25,525 - INFO - app - Application shutdown completed
2025-07-14 03:30:27,214 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:27,232 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:27,245 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:27,245 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:27,560 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:30:27,560 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:30:27,560 - INFO - app - Environment: PRODUCTION
2025-07-14 03:30:27,623 - INFO - app - Application startup initiated
2025-07-14 03:30:27,623 - INFO - app - Initializing core services...
2025-07-14 03:30:27,658 - INFO - app - Firebase initialized
2025-07-14 03:30:27,659 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:30:29,687 - INFO - app - Redis initialized
2025-07-14 03:30:29,691 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:30:29,692 - INFO - app - Scheduler initialized
2025-07-14 03:30:29,695 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:30:29,696 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:30:30,941 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:30:30,959 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:30:35,048 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:30:35,048 - INFO - app - Background tasks initialized
2025-07-14 03:30:35,753 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:30:35,753 - INFO - app - Application startup completed successfully
2025-07-14 03:30:35,753 - INFO - app - Starting cache validation task
2025-07-14 03:30:35,756 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:30:35,760 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:30:35,827 - INFO - app - Validating cache for 31 users
2025-07-14 03:30:37,794 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:30:43,918 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:30:45,960 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:30:46,013 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:30:46,044 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:30:46,053 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:30:46,063 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:30:46,090 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:30:46,098 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:30:46,112 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:30:46,125 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:30:46,137 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:30:46,155 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:30:46,187 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:30:46,196 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:30:46,206 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:30:46,217 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:30:46,231 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:30:48,775 - INFO - app - Cache validation completed
2025-07-14 03:30:50,762 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:30:50,849 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:30:50,857 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:30:50,862 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:30:50,873 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:30:52,912 - WARNING - app - Found stale cache entry for user 26, will be refreshed on next access
2025-07-14 03:30:52,916 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:30:52,918 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:30:52,919 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:30:52,922 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:30:54,970 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:30:54,978 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:30:54,981 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:30:54,984 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:30:54,989 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:30:54,999 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:30:55,004 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:30:55,014 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:30:55,019 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:30:55,021 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:30:56,581 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:56,630 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:56,643 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:56,656 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:56,659 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:56,659 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:56,672 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:30:56,816 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:56,836 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:56,836 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:56,890 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:56,910 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:56,913 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:56,913 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:56,930 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:56,931 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:56,934 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:56,934 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:56,936 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:56,943 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:30:56,948 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:56,949 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:56,949 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:56,949 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:56,961 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:56,961 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:30:56,961 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:30:56,962 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:31:14,953 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 03:31:14,953 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 03:31:29,740 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:31:29,747 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:31:30,466 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:31:30,504 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:31:30,530 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:31:30,531 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:31:51,544 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '5692245474', 'user_id': '26', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': '6.0', 'price': '39.096500000000006', 'status': 'OPEN', 'contract_value': '30000.0', 'account_type': 'live', 'timestamp': '2025-07-14T10:31:51.544658'}
2025-07-14 03:31:51,835 - INFO - app.core.firebase - Order data (ID: 5692245474) sent to Firebase successfully.
2025-07-14 03:32:29,738 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:32:29,747 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:32:31,068 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:32:31,081 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:32:31,114 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:32:31,116 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:32:48,442 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 03:32:48,442 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 03:33:29,718 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:33:29,720 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:33:30,588 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:33:30,603 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:33:30,619 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:33:30,619 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:34:29,716 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:34:29,718 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:34:30,594 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:34:30,611 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:34:30,626 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:34:30,626 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:35:29,718 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:35:29,722 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:35:30,671 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:35:30,679 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:35:30,687 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:35:30,688 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:35:47,618 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 26
2025-07-14 03:35:47,619 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 26
2025-07-14 03:35:47,622 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 26 using refresh token.
2025-07-14 03:35:48,799 - INFO - app - Starting cache validation task
2025-07-14 03:35:48,810 - INFO - app - Validating cache for 31 users
2025-07-14 03:35:50,374 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,383 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,388 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,395 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,401 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,407 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,415 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,422 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,428 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,434 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,440 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,446 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,452 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,459 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,464 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,470 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,476 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,482 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,489 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,495 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,504 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,511 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,528 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,537 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 03:35:50,555 - INFO - app - Cache validation completed
2025-07-14 03:36:29,726 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:36:29,730 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:36:32,839 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:36:32,853 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:36:32,871 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:36:32,872 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:37:10,390 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 03:37:10,391 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 03:37:29,747 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:37:29,755 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:37:31,187 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:37:31,196 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:37:31,235 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:37:31,236 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:37:32,672 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 03:37:32,673 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 03:37:48,586 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 03:37:48,587 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 03:38:05,011 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 03:38:05,012 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 03:38:29,714 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:38:29,716 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:38:30,266 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 26.44508066627606398720051307% which is below threshold 100.0%
2025-07-14 03:38:33,952 - INFO - app - Sent margin call warning email (HTML) to user 26 at forworkcursor@gmail.com
2025-07-14 03:38:34,368 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:38:34,375 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:38:34,388 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:38:34,388 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:39:29,722 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:39:29,725 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:39:30,272 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 29.51532006819342849369790721% which is below threshold 100.0%
2025-07-14 03:39:30,692 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:39:30,700 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:39:30,714 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:39:30,714 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:40:29,715 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:40:29,717 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:40:30,276 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 27.98020036723474624044921014% which is below threshold 100.0%
2025-07-14 03:40:30,692 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:40:30,699 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:40:30,708 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:40:30,709 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:40:50,562 - INFO - app - Starting cache validation task
2025-07-14 03:40:50,565 - INFO - app - Validating cache for 31 users
2025-07-14 03:40:50,566 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,570 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,571 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,574 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,578 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,581 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,584 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,587 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,589 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,592 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,595 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,598 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,600 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,603 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,606 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,609 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,612 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,615 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,619 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,622 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,626 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,629 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,631 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,634 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 03:40:50,638 - INFO - app - Cache validation completed
2025-07-14 03:41:29,749 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:41:29,758 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:41:30,254 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 32.32970618661665587818654604% which is below threshold 100.0%
2025-07-14 03:41:30,602 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:41:30,608 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:41:30,620 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:41:30,621 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:41:43,158 - INFO - app - Application shutdown initiated
2025-07-14 03:41:43,159 - INFO - app - Scheduler shutdown completed
2025-07-14 03:41:43,493 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:41:43,539 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:41:43,540 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:41:43,541 - INFO - app - Redis connection closed
2025-07-14 03:41:43,541 - INFO - app - Application shutdown completed
2025-07-14 03:41:45,250 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:41:45,263 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:41:45,274 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:41:45,274 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:41:45,568 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:41:45,568 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:41:45,568 - INFO - app - Environment: PRODUCTION
2025-07-14 03:41:45,620 - INFO - app - Application startup initiated
2025-07-14 03:41:45,620 - INFO - app - Initializing core services...
2025-07-14 03:41:45,653 - INFO - app - Firebase initialized
2025-07-14 03:41:45,653 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:41:47,709 - INFO - app - Redis initialized
2025-07-14 03:41:47,713 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:41:47,716 - INFO - app - Scheduler initialized
2025-07-14 03:41:47,718 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:41:47,719 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:41:48,817 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:41:48,826 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:41:52,898 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:41:52,898 - INFO - app - Background tasks initialized
2025-07-14 03:41:53,534 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:41:53,534 - INFO - app - Application startup completed successfully
2025-07-14 03:41:53,534 - INFO - app - Starting cache validation task
2025-07-14 03:41:53,536 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:41:53,540 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:41:53,544 - INFO - app - Application shutdown initiated
2025-07-14 03:41:53,545 - INFO - app - Scheduler shutdown completed
2025-07-14 03:41:53,545 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:41:55,099 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:41:55,099 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:41:55,105 - INFO - app - Redis connection closed
2025-07-14 03:41:55,105 - INFO - app - Application shutdown completed
2025-07-14 03:41:56,549 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:41:56,562 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:41:56,572 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:41:56,572 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:41:56,842 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:41:56,842 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:41:56,842 - INFO - app - Environment: PRODUCTION
2025-07-14 03:41:56,887 - INFO - app - Application startup initiated
2025-07-14 03:41:56,887 - INFO - app - Initializing core services...
2025-07-14 03:41:56,921 - INFO - app - Firebase initialized
2025-07-14 03:41:56,922 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:41:58,953 - INFO - app - Redis initialized
2025-07-14 03:41:58,956 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:41:58,957 - INFO - app - Scheduler initialized
2025-07-14 03:41:58,959 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:41:58,960 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:42:00,095 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:42:00,102 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:42:04,214 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:42:04,215 - INFO - app - Background tasks initialized
2025-07-14 03:42:04,849 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:42:04,850 - INFO - app - Application startup completed successfully
2025-07-14 03:42:04,851 - INFO - app - Starting cache validation task
2025-07-14 03:42:04,855 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:42:04,857 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:42:04,895 - INFO - app - Validating cache for 31 users
2025-07-14 03:42:06,888 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:42:12,983 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:42:15,025 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:42:15,050 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:42:15,060 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:42:15,065 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:42:15,072 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:42:15,080 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:42:15,084 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:42:15,089 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:42:15,091 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:42:15,095 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:42:15,098 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:42:15,108 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:42:15,111 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:42:15,123 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:42:15,128 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:42:15,131 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:42:19,292 - INFO - app - Cache validation completed
2025-07-14 03:42:19,856 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:42:21,334 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:42:21,346 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:42:21,349 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:42:21,356 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:42:21,359 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:42:21,360 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:42:21,361 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:42:23,396 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:42:23,410 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:42:23,414 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:42:23,418 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:42:23,420 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:42:23,421 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:42:23,424 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:42:23,426 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:42:23,428 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:42:23,429 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:42:23,431 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:42:23,680 - INFO - app - Application shutdown initiated
2025-07-14 03:42:23,681 - INFO - app - Scheduler shutdown completed
2025-07-14 03:42:24,821 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:24,914 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:24,922 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:24,933 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:24,954 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:24,975 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:24,995 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:25,078 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:25,100 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:25,100 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:25,175 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:25,199 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:25,199 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:25,207 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:25,221 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:25,224 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:25,224 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:25,224 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:25,226 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:25,237 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:25,237 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:25,243 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:25,243 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:25,244 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:25,245 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:25,264 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:25,278 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:25,278 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:25,736 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:42:28,033 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:42:28,034 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:42:28,035 - INFO - app - Redis connection closed
2025-07-14 03:42:28,035 - INFO - app - Application shutdown completed
2025-07-14 03:42:29,490 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:29,503 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:29,512 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:29,512 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:29,799 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:42:29,799 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:42:29,799 - INFO - app - Environment: PRODUCTION
2025-07-14 03:42:29,864 - INFO - app - Application startup initiated
2025-07-14 03:42:29,864 - INFO - app - Initializing core services...
2025-07-14 03:42:29,952 - INFO - app - Firebase initialized
2025-07-14 03:42:29,952 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:42:32,001 - INFO - app - Redis initialized
2025-07-14 03:42:32,006 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:42:32,008 - INFO - app - Scheduler initialized
2025-07-14 03:42:32,010 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:42:32,011 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:42:33,052 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:42:33,067 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:42:37,146 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:42:37,146 - INFO - app - Background tasks initialized
2025-07-14 03:42:37,762 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:42:37,762 - INFO - app - Application startup completed successfully
2025-07-14 03:42:37,763 - INFO - app - Starting cache validation task
2025-07-14 03:42:37,765 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:42:37,767 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:42:37,772 - INFO - app - Application shutdown initiated
2025-07-14 03:42:37,772 - INFO - app - Scheduler shutdown completed
2025-07-14 03:42:37,773 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:42:39,521 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:42:39,521 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:42:39,529 - INFO - app - Redis connection closed
2025-07-14 03:42:39,529 - INFO - app - Application shutdown completed
2025-07-14 03:42:41,141 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:42:41,153 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:42:41,163 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:42:41,164 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:42:41,431 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:42:41,431 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:42:41,431 - INFO - app - Environment: PRODUCTION
2025-07-14 03:42:41,485 - INFO - app - Application startup initiated
2025-07-14 03:42:41,485 - INFO - app - Initializing core services...
2025-07-14 03:42:41,529 - INFO - app - Firebase initialized
2025-07-14 03:42:41,529 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:42:43,577 - INFO - app - Redis initialized
2025-07-14 03:42:43,579 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:42:43,582 - INFO - app - Scheduler initialized
2025-07-14 03:42:43,585 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:42:43,586 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:42:44,635 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:42:44,637 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:42:48,729 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:42:48,729 - INFO - app - Background tasks initialized
2025-07-14 03:42:49,437 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:42:49,437 - INFO - app - Application startup completed successfully
2025-07-14 03:42:49,437 - INFO - app - Starting cache validation task
2025-07-14 03:42:49,440 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:42:49,445 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:42:49,550 - INFO - app - Validating cache for 31 users
2025-07-14 03:42:51,472 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:42:53,569 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '5692245474', 'close_price': '39.0745', 'user_id': '26', 'order_type': 'BUY', 'order_company_name': 'XAGUSD', 'order_quantity': '6.00000000', 'contract_value': '30000.00000000', 'order_status': 'CLOSED', 'status': 'CLOSED', 'action': 'close_order', 'close_id': '3493331109', 'account_type': 'live', 'timestamp': '2025-07-14T10:42:53.569481'}
2025-07-14 03:42:53,914 - INFO - app.core.firebase - Order data (ID: 5692245474) sent to Firebase successfully.
2025-07-14 03:42:55,553 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:42:55,575 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:42:55,641 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:42:57,720 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:42:57,742 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:42:57,756 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:42:57,797 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:42:57,810 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:42:57,829 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:42:57,847 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:42:57,870 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:42:57,886 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:42:57,933 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:42:57,958 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:42:58,004 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:42:58,041 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:42:58,055 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:43:00,595 - INFO - app - Cache validation completed
2025-07-14 03:43:04,439 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:43:04,737 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:43:04,756 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 03:43:04,762 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 03:43:04,806 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 03:43:04,827 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 03:43:04,844 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 03:43:04,858 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 03:43:04,882 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 03:43:04,892 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 03:43:04,898 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 03:43:04,908 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 03:43:04,915 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 03:43:04,920 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 03:43:04,927 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 03:43:04,935 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 03:43:04,947 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 03:43:04,953 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 03:43:04,961 - INFO - app - Completed stale cache cleanup task
2025-07-14 03:43:06,643 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:43:06,659 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:43:06,721 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:43:06,726 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:43:06,736 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:43:06,763 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:43:06,767 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:43:06,913 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:43:06,933 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:43:06,933 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:43:06,959 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:43:06,980 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:43:06,980 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:43:06,995 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:43:07,004 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:43:07,012 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:43:07,013 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:43:07,024 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:43:07,028 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:43:07,028 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:43:07,045 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:43:07,046 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:43:07,046 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:43:07,067 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:43:07,075 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:43:07,075 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:43:07,091 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:43:07,091 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:43:34,107 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '7987141755', 'user_id': '26', 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '39.100500000000004', 'status': 'OPEN', 'contract_value': '50.0', 'account_type': 'live', 'timestamp': '2025-07-14T10:43:34.107303'}
2025-07-14 03:43:34,479 - INFO - app.core.firebase - Order data (ID: 7987141755) sent to Firebase successfully.
2025-07-14 03:43:43,630 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:43:43,639 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:43:44,483 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:43:44,559 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:43:44,623 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:43:44,625 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:44:43,633 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:44:43,640 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:44:45,000 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:44:45,048 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:44:45,094 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:44:45,095 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:45:43,645 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:45:43,657 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:45:44,900 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:45:44,906 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:45:44,928 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:45:44,929 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:46:07,069 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1116628265', 'user_id': '26', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '6.0', 'price': '122072.5', 'status': 'OPEN', 'contract_value': '6.0', 'account_type': 'live', 'timestamp': '2025-07-14T10:46:07.069398'}
2025-07-14 03:46:07,474 - INFO - app.core.firebase - Order data (ID: 1116628265) sent to Firebase successfully.
2025-07-14 03:46:43,663 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:46:43,676 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:46:44,479 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 82.03416717144145041450469118% which is below threshold 100.0%
2025-07-14 03:46:48,629 - INFO - app - Sent margin call warning email (HTML) to user 26 at forworkcursor@gmail.com
2025-07-14 03:46:49,043 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:46:49,046 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:46:49,062 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:46:49,063 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:47:43,617 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 03:47:43,621 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 03:47:44,193 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 81.80926278396610917184599842% which is below threshold 100.0%
2025-07-14 03:47:44,639 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 03:47:44,644 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 03:47:44,654 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 03:47:44,654 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 03:48:00,617 - INFO - app - Starting cache validation task
2025-07-14 03:48:00,626 - INFO - app - Validating cache for 31 users
2025-07-14 03:48:00,627 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,637 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,640 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,645 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,650 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,655 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,659 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,670 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,674 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,678 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,686 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,690 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,695 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,699 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,703 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,706 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,711 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,715 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,718 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,723 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,728 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,732 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,735 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,739 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 03:48:00,745 - INFO - app - Cache validation completed
2025-07-14 03:48:27,201 - INFO - app - Application shutdown initiated
2025-07-14 03:48:27,201 - INFO - app - Scheduler shutdown completed
2025-07-14 03:48:27,544 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:48:29,477 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:48:29,477 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:48:29,478 - INFO - app - Redis connection closed
2025-07-14 03:48:29,478 - INFO - app - Application shutdown completed
2025-07-14 03:48:31,380 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:48:31,400 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:48:31,411 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:48:31,411 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:48:31,923 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:48:31,923 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:48:31,923 - INFO - app - Environment: PRODUCTION
2025-07-14 03:48:31,982 - INFO - app - Application startup initiated
2025-07-14 03:48:31,982 - INFO - app - Initializing core services...
2025-07-14 03:48:32,018 - INFO - app - Firebase initialized
2025-07-14 03:48:32,018 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:48:34,049 - INFO - app - Redis initialized
2025-07-14 03:48:34,052 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:48:34,054 - INFO - app - Scheduler initialized
2025-07-14 03:48:34,058 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:48:34,059 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:48:35,341 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:48:35,355 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:48:39,428 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:48:39,428 - INFO - app - Background tasks initialized
2025-07-14 03:48:40,035 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:48:40,035 - INFO - app - Application startup completed successfully
2025-07-14 03:48:40,036 - INFO - app - Starting cache validation task
2025-07-14 03:48:40,037 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:48:40,040 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:48:40,043 - INFO - app - Application shutdown initiated
2025-07-14 03:48:40,043 - INFO - app - Scheduler shutdown completed
2025-07-14 03:48:40,044 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:48:40,969 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:48:40,969 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:48:40,976 - INFO - app - Redis connection closed
2025-07-14 03:48:40,976 - INFO - app - Application shutdown completed
2025-07-14 03:48:42,563 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 03:48:42,575 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 03:48:42,585 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 03:48:42,585 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 03:48:42,860 - INFO - app - Application starting up - Trading system initialized
2025-07-14 03:48:42,860 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 03:48:42,860 - INFO - app - Environment: PRODUCTION
2025-07-14 03:48:42,914 - INFO - app - Application startup initiated
2025-07-14 03:48:42,914 - INFO - app - Initializing core services...
2025-07-14 03:48:42,945 - INFO - app - Firebase initialized
2025-07-14 03:48:42,946 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 03:48:45,001 - INFO - app - Redis initialized
2025-07-14 03:48:45,003 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 03:48:45,004 - INFO - app - Scheduler initialized
2025-07-14 03:48:45,007 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:48:45,008 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 03:48:45,840 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 03:48:45,849 - INFO - app - Starting stale cache cleanup task
2025-07-14 03:48:49,911 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 03:48:49,911 - INFO - app - Background tasks initialized
2025-07-14 03:48:50,600 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 03:48:50,600 - INFO - app - Application startup completed successfully
2025-07-14 03:48:50,600 - INFO - app - Starting cache validation task
2025-07-14 03:48:50,603 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 03:48:50,605 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 03:48:50,627 - INFO - app - Validating cache for 31 users
2025-07-14 03:48:52,636 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 03:48:54,575 - INFO - app - Application shutdown initiated
2025-07-14 03:48:54,575 - INFO - app - Scheduler shutdown completed
2025-07-14 03:48:54,576 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 03:48:54,816 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 03:48:54,817 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 03:48:54,848 - INFO - app - Redis connection closed
2025-07-14 03:48:54,848 - INFO - app - Application shutdown completed
2025-07-14 04:14:49,857 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:14:49,872 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:14:49,883 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:14:49,883 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:14:50,196 - INFO - app - Application starting up - Trading system initialized
2025-07-14 04:14:50,196 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 04:14:50,196 - INFO - app - Environment: PRODUCTION
2025-07-14 04:14:50,248 - INFO - app - Application startup initiated
2025-07-14 04:14:50,248 - INFO - app - Initializing core services...
2025-07-14 04:14:50,298 - INFO - app - Firebase initialized
2025-07-14 04:14:50,298 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 04:14:52,342 - INFO - app - Redis initialized
2025-07-14 04:14:52,344 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 04:14:52,345 - INFO - app - Scheduler initialized
2025-07-14 04:14:52,346 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:14:52,347 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 04:14:53,499 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:14:53,522 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:14:57,595 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 04:14:57,595 - INFO - app - Background tasks initialized
2025-07-14 04:14:58,463 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 04:14:58,463 - INFO - app - Application startup completed successfully
2025-07-14 04:14:58,463 - INFO - app - Starting cache validation task
2025-07-14 04:14:58,466 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 04:14:58,468 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 04:14:58,488 - INFO - app - Validating cache for 31 users
2025-07-14 04:15:00,502 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:15:02,559 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 04:15:02,600 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 26
2025-07-14 04:15:02,601 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 26
2025-07-14 04:15:06,652 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 26
2025-07-14 04:15:06,655 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 26
2025-07-14 04:15:06,663 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:15:06,670 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:15:06,681 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 26 using refresh token.
2025-07-14 04:15:06,682 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 26 using refresh token.
2025-07-14 04:15:06,688 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:15:06,690 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 04:15:09,582 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:15:09,597 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 04:15:09,602 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:15:09,711 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:15:09,741 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:15:09,753 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:15:09,765 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:15:09,771 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:15:09,777 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 04:15:09,780 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:15:09,789 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:15:09,832 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:15:11,065 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 4 symbols for user 26
2025-07-14 04:15:11,065 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'AUDSGD', 'AUDUSD', 'XAGUSD']
2025-07-14 04:15:11,840 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:15:11,873 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:15:11,893 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 04:15:11,896 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:15:11,915 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:15:12,060 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 04:15:12,135 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 04:15:13,474 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:15:14,207 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:15:14,231 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:15:14,251 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:15:14,257 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 04:15:14,279 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:15:14,320 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:15:14,333 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:15:14,345 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:15:14,348 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 04:15:14,369 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:15:14,383 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:15:14,393 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:15:14,401 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:15:14,410 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:15:14,416 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 04:15:14,416 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:15:14,428 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:15:14,432 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:15:16,500 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:15:16,541 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:15:16,576 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:15:16,592 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 04:15:16,663 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 04:15:18,763 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 04:15:18,850 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 04:15:20,976 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,027 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,091 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,152 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,292 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,368 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,463 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,514 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,569 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,664 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 04:15:21,729 - INFO - app - Cache validation completed
2025-07-14 04:15:23,046 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:15:23,066 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:15:23,083 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:15:23,099 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:15:23,131 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:15:23,192 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:15:23,194 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:15:23,392 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:15:23,392 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:15:23,393 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:15:23,394 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:15:23,415 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:15:23,415 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:15:23,423 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:15:23,423 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:15:23,424 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:15:23,424 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:15:23,444 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:15:23,444 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:15:23,445 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:15:23,477 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:15:23,477 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:15:23,483 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:15:23,489 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:15:23,506 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:15:23,506 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:15:23,508 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:15:23,508 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:15:41,161 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 26 by invalidating refresh token.
2025-07-14 04:15:52,387 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:15:52,392 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:15:53,092 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.29690451144752730443029217% which is below threshold 100.0%
2025-07-14 04:15:53,747 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:15:53,786 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:15:53,840 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:15:53,845 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:15:53,972 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 1 symbols for user 1
2025-07-14 04:15:53,972 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDCAD']
2025-07-14 04:16:18,477 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 1 by invalidating refresh token.
2025-07-14 04:16:27,406 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 1 symbols for user 12
2025-07-14 04:16:27,407 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDNZD']
2025-07-14 04:16:52,397 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:16:52,407 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:16:53,200 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.02671887333858667748192010% which is below threshold 100.0%
2025-07-14 04:16:53,731 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:16:53,755 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:16:53,795 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:16:53,797 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:16:59,006 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 12 by invalidating refresh token.
2025-07-14 04:17:07,179 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-14 04:17:07,179 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-14 04:17:16,976 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': 'ORD_1920056401', 'user_id': '14', 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '0.89827', 'status': 'OPEN', 'contract_value': '1000.0', 'account_type': 'live', 'timestamp': '2025-07-14T11:17:16.976499'}
2025-07-14 04:17:17,366 - INFO - app.core.firebase - Order data (ID: ORD_1920056401) sent to Firebase successfully.
2025-07-14 04:17:52,373 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:17:52,376 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:17:52,901 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 79.89196056073384420887756907% which is below threshold 100.0%
2025-07-14 04:17:53,269 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:17:53,276 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:17:53,288 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:17:53,288 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:18:14,734 - INFO - app - Application shutdown initiated
2025-07-14 04:18:14,735 - INFO - app - Scheduler shutdown completed
2025-07-14 04:18:14,735 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 04:18:15,411 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 04:18:15,411 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 04:18:15,432 - INFO - app - Redis connection closed
2025-07-14 04:18:15,432 - INFO - app - Application shutdown completed
2025-07-14 04:25:35,544 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:25:35,566 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:25:35,579 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:25:35,579 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:25:35,970 - INFO - app - Application starting up - Trading system initialized
2025-07-14 04:25:35,970 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 04:25:35,970 - INFO - app - Environment: PRODUCTION
2025-07-14 04:25:36,030 - INFO - app - Application startup initiated
2025-07-14 04:25:36,030 - INFO - app - Initializing core services...
2025-07-14 04:25:36,069 - INFO - app - Firebase initialized
2025-07-14 04:25:36,069 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 04:25:38,120 - INFO - app - Redis initialized
2025-07-14 04:25:38,159 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 04:25:38,161 - INFO - app - Scheduler initialized
2025-07-14 04:25:38,164 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:25:38,165 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 04:25:39,322 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:25:39,339 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:25:43,491 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 04:25:43,492 - INFO - app - Background tasks initialized
2025-07-14 04:25:44,136 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 04:25:44,136 - INFO - app - Application startup completed successfully
2025-07-14 04:25:44,136 - INFO - app - Starting cache validation task
2025-07-14 04:25:44,139 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 04:25:44,140 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 04:25:44,188 - INFO - app - Validating cache for 31 users
2025-07-14 04:25:46,174 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:25:48,234 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 04:25:52,352 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:25:52,368 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:25:52,400 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:25:52,409 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 04:25:52,411 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:25:52,415 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:25:52,418 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 04:25:52,419 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:25:52,440 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:25:52,443 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:25:54,512 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:25:54,522 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:25:54,527 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:25:54,534 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:25:54,534 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 04:25:54,546 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:25:54,550 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:25:54,558 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:25:54,561 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:25:54,563 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 04:25:54,564 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:25:54,596 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 04:25:54,613 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 04:25:56,708 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 04:25:58,782 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 04:25:59,140 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:26:00,844 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:26:00,860 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:26:00,866 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:26:00,873 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 04:26:00,878 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:26:00,886 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:26:00,888 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:26:02,939 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:26:02,955 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 04:26:02,956 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:26:02,960 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:26:02,967 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:26:02,971 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:26:02,975 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:26:02,979 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:26:02,989 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 04:26:02,989 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:26:02,993 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:26:03,000 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:26:03,003 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:26:03,005 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:26:03,010 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,083 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,107 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,124 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,142 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,153 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,207 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,239 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,269 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,294 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,329 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,362 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 04:26:05,384 - INFO - app - Cache validation completed
2025-07-14 04:26:06,564 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:26:06,582 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:26:06,605 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:26:06,653 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:26:06,665 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:26:06,728 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:26:06,746 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:26:06,814 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:26:06,832 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:26:06,832 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:26:06,847 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:26:06,870 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:26:06,870 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:26:06,876 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:26:06,895 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:26:06,896 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:26:06,907 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:26:06,925 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:26:06,927 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:26:06,927 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:26:06,944 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:26:06,944 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:26:06,973 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:26:06,990 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:26:06,990 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:26:06,990 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:26:07,005 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:26:07,005 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:26:38,202 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:26:38,208 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:26:38,734 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 79.27844842528358108542154673% which is below threshold 100.0%
2025-07-14 04:26:39,230 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:26:39,239 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:26:39,257 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:26:39,258 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:27:03,280 - INFO - app - Application shutdown initiated
2025-07-14 04:27:03,281 - INFO - app - Scheduler shutdown completed
2025-07-14 04:27:03,283 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 04:27:04,062 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 04:27:04,062 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 04:27:04,082 - INFO - app - Redis connection closed
2025-07-14 04:27:04,082 - INFO - app - Application shutdown completed
2025-07-14 04:27:05,922 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:27:05,949 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:27:05,962 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:27:05,963 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:27:06,354 - INFO - app - Application starting up - Trading system initialized
2025-07-14 04:27:06,354 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 04:27:06,354 - INFO - app - Environment: PRODUCTION
2025-07-14 04:27:06,415 - INFO - app - Application startup initiated
2025-07-14 04:27:06,415 - INFO - app - Initializing core services...
2025-07-14 04:27:06,455 - INFO - app - Firebase initialized
2025-07-14 04:27:06,455 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 04:27:08,503 - INFO - app - Redis initialized
2025-07-14 04:27:08,506 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 04:27:08,507 - INFO - app - Scheduler initialized
2025-07-14 04:27:08,509 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:27:08,511 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 04:27:09,436 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:27:09,460 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:27:13,518 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 04:27:13,518 - INFO - app - Background tasks initialized
2025-07-14 04:27:14,307 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 04:27:14,307 - INFO - app - Application startup completed successfully
2025-07-14 04:27:14,309 - INFO - app - Starting cache validation task
2025-07-14 04:27:14,314 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 04:27:14,318 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 04:27:14,424 - INFO - app - Validating cache for 31 users
2025-07-14 04:27:16,370 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:27:20,466 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:27:22,575 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:27:22,665 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:27:22,701 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:27:22,718 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:27:22,735 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:27:22,756 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:27:22,775 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:27:22,797 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:27:22,806 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:27:22,826 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:27:22,847 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:27:22,873 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:27:22,883 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:27:22,906 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:27:22,915 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:27:22,931 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:27:25,363 - INFO - app - Cache validation completed
2025-07-14 04:27:29,321 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:27:29,556 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:27:29,582 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:27:29,590 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:27:31,652 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:27:31,685 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:27:31,696 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:27:31,719 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:27:31,746 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:27:31,756 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:27:31,761 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:27:31,773 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:27:31,780 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:27:31,787 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:27:31,795 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:27:31,797 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:27:33,834 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:27:33,851 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:27:33,868 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:27:35,787 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:27:35,795 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:27:35,810 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:27:35,823 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:27:35,823 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:27:35,846 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:27:35,853 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:27:36,052 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:27:36,052 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:27:36,064 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:27:36,074 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:27:36,075 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:27:36,076 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:27:36,076 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:27:36,076 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:27:36,086 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:27:36,087 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:27:36,099 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:27:36,099 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:27:36,100 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:27:36,114 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:27:36,123 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:27:36,125 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:27:36,126 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:27:36,137 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:27:36,137 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:27:36,146 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:27:36,146 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:28:08,554 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:28:08,559 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:28:09,235 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 79.27824362541640062595031405% which is below threshold 100.0%
2025-07-14 04:28:09,656 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:28:09,663 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:28:09,679 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:28:09,679 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:28:28,883 - INFO - app - Application shutdown initiated
2025-07-14 04:28:28,883 - INFO - app - Scheduler shutdown completed
2025-07-14 04:28:28,885 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 04:28:29,509 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 04:28:29,509 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 04:28:29,513 - INFO - app - Redis connection closed
2025-07-14 04:28:29,513 - INFO - app - Application shutdown completed
2025-07-14 04:28:31,488 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:28:31,502 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:28:31,514 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:28:31,514 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:28:31,834 - INFO - app - Application starting up - Trading system initialized
2025-07-14 04:28:31,834 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 04:28:31,834 - INFO - app - Environment: PRODUCTION
2025-07-14 04:28:31,898 - INFO - app - Application startup initiated
2025-07-14 04:28:31,899 - INFO - app - Initializing core services...
2025-07-14 04:28:31,935 - INFO - app - Firebase initialized
2025-07-14 04:28:31,935 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 04:28:33,977 - INFO - app - Redis initialized
2025-07-14 04:28:33,982 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 04:28:33,984 - INFO - app - Scheduler initialized
2025-07-14 04:28:33,987 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:28:33,988 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 04:28:34,939 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:28:34,959 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:28:39,069 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 04:28:39,069 - INFO - app - Background tasks initialized
2025-07-14 04:28:39,853 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 04:28:39,854 - INFO - app - Application startup completed successfully
2025-07-14 04:28:39,854 - INFO - app - Starting cache validation task
2025-07-14 04:28:39,862 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 04:28:39,865 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 04:28:39,891 - INFO - app - Validating cache for 31 users
2025-07-14 04:28:41,887 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:28:45,991 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:28:46,002 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:28:50,105 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:28:50,116 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:28:50,121 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:28:50,126 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:28:50,133 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:28:50,138 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:28:50,142 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:28:50,149 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:28:50,154 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:28:50,157 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:28:50,170 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:28:50,174 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:28:50,183 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:28:50,188 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:28:50,194 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:28:54,402 - INFO - app - Cache validation completed
2025-07-14 04:28:54,864 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:28:56,472 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:28:56,479 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:28:56,486 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:28:56,495 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:28:56,500 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:28:56,502 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:28:58,541 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:28:58,562 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:28:58,567 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:28:58,570 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:28:58,574 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:28:58,575 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:28:58,579 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:28:58,584 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:28:58,585 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:28:58,588 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:28:58,589 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:29:00,629 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:29:02,134 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:29:02,192 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:29:02,244 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:29:02,279 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:29:02,283 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:29:02,324 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:29:02,331 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:29:02,411 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:29:02,433 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:29:02,434 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:29:02,479 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:29:02,505 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:29:02,505 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:29:02,536 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:29:02,560 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:29:02,560 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:29:02,579 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:29:02,590 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:29:02,601 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:29:02,601 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:29:02,614 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:29:02,614 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:29:02,628 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:29:02,643 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:29:02,643 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:29:02,644 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:29:02,644 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:29:34,131 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:29:34,149 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:29:35,148 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 79.64906791825781920772898315% which is below threshold 100.0%
2025-07-14 04:29:35,547 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:29:35,569 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:29:35,601 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:29:35,603 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:30:09,444 - INFO - app - Application shutdown initiated
2025-07-14 04:30:09,444 - INFO - app - Scheduler shutdown completed
2025-07-14 04:30:09,445 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 04:30:11,094 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 04:30:11,094 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 04:30:11,107 - INFO - app - Redis connection closed
2025-07-14 04:30:11,108 - INFO - app - Application shutdown completed
2025-07-14 04:38:20,855 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:38:20,883 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:38:20,900 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:38:20,900 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:38:21,423 - INFO - app - Application starting up - Trading system initialized
2025-07-14 04:38:21,423 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 04:38:21,423 - INFO - app - Environment: PRODUCTION
2025-07-14 04:38:21,495 - INFO - app - Application startup initiated
2025-07-14 04:38:21,495 - INFO - app - Initializing core services...
2025-07-14 04:38:21,537 - INFO - app - Firebase initialized
2025-07-14 04:38:21,538 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 04:38:23,580 - INFO - app - Redis initialized
2025-07-14 04:38:23,583 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 04:38:23,585 - INFO - app - Scheduler initialized
2025-07-14 04:38:23,590 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:38:23,591 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 04:38:24,651 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 04:38:24,667 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:38:28,777 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 04:38:28,777 - INFO - app - Background tasks initialized
2025-07-14 04:38:29,564 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 04:38:29,564 - INFO - app - Application startup completed successfully
2025-07-14 04:38:29,566 - INFO - app - Starting cache validation task
2025-07-14 04:38:29,571 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 04:38:29,575 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 04:38:29,664 - INFO - app - Validating cache for 31 users
2025-07-14 04:38:31,600 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:38:33,634 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 04:38:37,705 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:38:37,721 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:38:37,793 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:38:37,815 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 04:38:37,825 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:38:37,842 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:38:37,843 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 04:38:37,852 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:38:37,886 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:38:37,900 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:38:37,921 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:38:37,940 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:38:37,953 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:38:37,953 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 04:38:37,963 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:38:37,988 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:38:38,002 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:38:38,035 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:38:38,051 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:38:38,055 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 04:38:38,075 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:38:38,139 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 04:38:40,250 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 04:38:42,342 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 04:38:42,435 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 04:38:42,510 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 04:38:42,572 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 04:38:44,576 - INFO - app - Starting stale cache cleanup task
2025-07-14 04:38:44,646 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 04:38:44,652 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 04:38:44,670 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 04:38:44,688 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 04:38:44,719 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 04:38:44,723 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 04:38:44,738 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 04:38:44,751 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 04:38:44,759 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 04:38:44,779 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 04:38:44,792 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 04:38:44,794 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 04:38:44,798 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 04:38:44,814 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 04:38:44,824 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 04:38:44,837 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 04:38:44,868 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 04:38:44,882 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 04:38:44,883 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 04:38:44,899 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 04:38:44,912 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 04:38:44,925 - INFO - app - Completed stale cache cleanup task
2025-07-14 04:38:44,961 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,050 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,078 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,192 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,213 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,232 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,253 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,277 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,293 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 04:38:45,319 - INFO - app - Cache validation completed
2025-07-14 04:38:46,660 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:38:46,660 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:38:46,662 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:38:46,668 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:38:46,698 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:38:46,727 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:38:46,734 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 04:38:46,920 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:38:46,925 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:38:46,925 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:38:46,926 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:38:46,942 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:38:46,943 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
o...
2025-07-14 04:38:46,943 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:38:46,948 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:38:46,948 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:38:46,949 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:38:46,950 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:38:46,993 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:38:46,997 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:38:47,008 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 04:38:47,009 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:38:47,010 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:38:47,013 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:38:47,013 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:38:47,023 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 04:38:47,023 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 04:39:23,609 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:39:23,613 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:39:24,245 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.22267821291908964820639348% which is below threshold 100.0%
2025-07-14 04:39:24,655 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:39:24,659 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:39:24,673 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:39:24,674 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:40:23,701 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:40:23,710 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:40:24,557 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.33009574325524064086793638% which is below threshold 100.0%
2025-07-14 04:40:25,178 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:40:25,188 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:40:25,226 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:40:25,228 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:41:23,624 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:41:23,628 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:41:24,254 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.04038585114176267286218123% which is below threshold 100.0%
2025-07-14 04:41:24,668 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:41:24,674 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:41:24,691 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:41:24,692 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:42:23,643 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:42:23,735 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:42:24,615 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.01132474998885547389426333% which is below threshold 100.0%
2025-07-14 04:42:25,113 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:42:25,124 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:42:25,194 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:42:25,195 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:43:23,649 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:43:23,657 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:43:24,674 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 79.74542625576622559374382827% which is below threshold 100.0%
2025-07-14 04:43:25,097 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:43:25,104 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:43:25,129 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:43:25,130 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:43:45,331 - INFO - app - Starting cache validation task
2025-07-14 04:43:45,341 - INFO - app - Validating cache for 31 users
2025-07-14 04:43:45,342 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,352 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,356 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,365 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,374 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,384 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,393 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,400 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,410 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,418 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,426 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,434 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,442 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,449 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,457 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,465 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,474 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,485 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,495 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,510 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,559 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,570 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,584 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,594 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 04:43:45,610 - INFO - app - Cache validation completed
2025-07-14 04:44:23,642 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:44:23,651 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:44:24,584 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 79.92087147531748570343327180% which is below threshold 100.0%
2025-07-14 04:44:24,994 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:44:25,002 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:44:25,022 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:44:25,022 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:45:23,637 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:45:23,645 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:45:24,482 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.10454282286716127655034011% which is below threshold 100.0%
2025-07-14 04:45:25,009 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:45:25,023 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:45:25,066 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:45:25,067 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:46:23,640 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 04:46:23,649 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 04:46:24,488 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.34245882857070090774810463% which is below threshold 100.0%
2025-07-14 04:46:25,026 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 04:46:25,034 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 04:46:25,059 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 04:46:25,060 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 04:47:23,132 - INFO - app - Application shutdown initiated
2025-07-14 04:47:23,132 - INFO - app - Scheduler shutdown completed
2025-07-14 04:47:23,133 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 04:47:24,346 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 04:47:24,346 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 04:47:24,350 - INFO - app - Redis connection closed
2025-07-14 04:47:24,351 - INFO - app - Application shutdown completed
2025-07-14 05:02:13,639 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:02:13,653 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:02:13,665 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:02:13,665 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:02:13,967 - INFO - app - Application starting up - Trading system initialized
2025-07-14 05:02:13,967 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 05:02:13,967 - INFO - app - Environment: PRODUCTION
2025-07-14 05:02:14,037 - INFO - app - Application startup initiated
2025-07-14 05:02:14,037 - INFO - app - Initializing core services...
2025-07-14 05:02:14,076 - INFO - app - Firebase initialized
2025-07-14 05:02:14,076 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 05:02:16,124 - INFO - app - Redis initialized
2025-07-14 05:02:16,127 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 05:02:16,128 - INFO - app - Scheduler initialized
2025-07-14 05:02:16,130 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 05:02:16,131 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 05:02:17,308 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 05:02:17,335 - INFO - app - Starting stale cache cleanup task
2025-07-14 05:02:21,391 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 05:02:21,391 - INFO - app - Background tasks initialized
2025-07-14 05:02:22,121 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 05:02:22,121 - INFO - app - Application startup completed successfully
2025-07-14 05:02:22,122 - INFO - app - Starting cache validation task
2025-07-14 05:02:22,123 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 05:02:22,125 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 05:02:22,185 - INFO - app - Validating cache for 31 users
2025-07-14 05:02:24,153 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 05:02:26,180 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 05:02:30,241 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 05:02:30,247 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 05:02:30,258 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 05:02:30,259 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 05:02:30,263 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 05:02:30,268 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 05:02:30,269 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 05:02:30,273 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 05:02:30,285 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 05:02:30,288 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 05:02:30,296 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 05:02:30,301 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 05:02:30,307 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 05:02:30,308 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 05:02:30,314 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 05:02:30,332 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 05:02:30,340 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 05:02:30,347 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 05:02:30,349 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 05:02:30,350 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 05:02:30,354 - INFO - app - Completed stale cache cleanup task
2025-07-14 05:02:30,386 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 05:02:30,403 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 05:02:32,468 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 05:02:32,495 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 05:02:34,548 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 05:02:36,587 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 05:02:36,607 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 05:02:37,128 - INFO - app - Starting stale cache cleanup task
2025-07-14 05:02:38,657 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 05:02:38,662 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 05:02:40,681 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 05:02:40,681 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,706 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 05:02:40,721 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 05:02:40,726 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 05:02:40,730 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 05:02:40,731 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,736 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 05:02:40,741 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 05:02:40,746 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 05:02:40,748 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 05:02:40,750 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 05:02:40,753 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 05:02:40,755 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,768 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 05:02:40,772 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 05:02:40,778 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 05:02:40,780 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 05:02:40,782 - INFO - app - Completed stale cache cleanup task
2025-07-14 05:02:40,784 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,793 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,799 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,804 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,843 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,852 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,864 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,872 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,881 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,889 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 05:02:40,900 - INFO - app - Cache validation completed
2025-07-14 05:02:42,042 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-14 05:02:42,044 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-14 05:02:42,044 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-14 05:02:42,045 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-14 05:02:42,051 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-14 05:02:42,052 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-14 05:02:43,107 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:02:43,120 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:02:43,160 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:02:43,218 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:02:43,239 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:02:43,265 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:02:43,331 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:02:43,533 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:02:43,534 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:02:43,556 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:02:43,556 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:02:43,557 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:02:43,557 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:02:43,578 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:02:43,610 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:02:43,614 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:02:43,614 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:02:43,617 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:02:43,619 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:02:43,632 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:02:43,632 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:02:43,639 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:02:43,640 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:02:43,642 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:02:43,642 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:02:43,662 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:02:43,684 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:02:43,684 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:02:44,544 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-14 05:02:44,544 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-14 05:02:46,189 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-14 05:02:46,190 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-14 05:02:47,459 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-14 05:02:47,459 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-14 05:02:50,305 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 14 by invalidating refresh token.
2025-07-14 05:03:16,175 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 05:03:16,181 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 05:03:17,002 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.25193046061469860934746188% which is below threshold 100.0%
2025-07-14 05:03:17,434 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 05:03:17,443 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 05:03:17,469 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 05:03:17,470 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 05:04:16,152 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 05:04:16,155 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 05:04:16,700 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.26326271993201719608911443% which is below threshold 100.0%
2025-07-14 05:04:17,119 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 05:04:17,128 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 05:04:17,147 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 05:04:17,148 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 05:05:16,193 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 05:05:16,202 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 05:05:17,341 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.30002429609090967117538125% which is below threshold 100.0%
2025-07-14 05:05:17,826 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 05:05:17,847 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 05:05:17,862 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 05:05:17,863 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 05:05:18,269 - INFO - app - Application shutdown initiated
2025-07-14 05:05:18,269 - INFO - app - Scheduler shutdown completed
2025-07-14 05:05:18,284 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 05:05:20,134 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 05:05:20,134 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 05:05:20,135 - INFO - app - Redis connection closed
2025-07-14 05:05:20,135 - INFO - app - Application shutdown completed
2025-07-14 05:06:54,214 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:06:54,228 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:06:54,239 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:06:54,239 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:06:54,538 - INFO - app - Application starting up - Trading system initialized
2025-07-14 05:06:54,539 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 05:06:54,539 - INFO - app - Environment: PRODUCTION
2025-07-14 05:06:54,596 - INFO - app - Application startup initiated
2025-07-14 05:06:54,596 - INFO - app - Initializing core services...
2025-07-14 05:06:54,633 - INFO - app - Firebase initialized
2025-07-14 05:06:54,633 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 05:06:56,675 - INFO - app - Redis initialized
2025-07-14 05:06:56,680 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 05:06:56,682 - INFO - app - Scheduler initialized
2025-07-14 05:06:56,685 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 05:06:56,685 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 05:06:58,191 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 05:06:58,207 - INFO - app - Starting stale cache cleanup task
2025-07-14 05:07:02,326 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 05:07:02,326 - INFO - app - Background tasks initialized
2025-07-14 05:07:02,997 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 05:07:02,997 - INFO - app - Application startup completed successfully
2025-07-14 05:07:02,998 - INFO - app - Starting cache validation task
2025-07-14 05:07:03,001 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 05:07:03,003 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 05:07:03,044 - INFO - app - Validating cache for 31 users
2025-07-14 05:07:05,046 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 05:07:09,137 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 05:07:11,197 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 05:07:11,216 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 05:07:11,225 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 05:07:11,229 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 05:07:13,283 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 05:07:13,295 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 05:07:13,297 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 05:07:13,301 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 05:07:13,307 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 05:07:13,311 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 05:07:13,316 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 05:07:13,326 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 05:07:13,329 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 05:07:13,336 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 05:07:13,337 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 05:07:13,339 - INFO - app - Completed stale cache cleanup task
2025-07-14 05:07:18,001 - INFO - app - Starting stale cache cleanup task
2025-07-14 05:07:19,553 - INFO - app - Cache validation completed
2025-07-14 05:07:19,560 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 05:07:19,567 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 05:07:19,569 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 05:07:19,572 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 05:07:19,574 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 05:07:19,574 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 05:07:19,576 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 05:07:21,599 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 05:07:21,603 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 05:07:21,612 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 05:07:21,616 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 05:07:21,619 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 05:07:21,620 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 05:07:21,623 - WARNING - app - Found stale cache entry for user 11, will be refreshed on next access
2025-07-14 05:07:21,626 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 05:07:21,629 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 05:07:21,630 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 05:07:21,633 - INFO - app - Completed stale cache cleanup task
2025-07-14 05:07:23,481 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:07:23,481 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:07:23,487 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:07:23,525 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:07:23,549 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:07:23,552 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:07:23,552 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 05:07:23,912 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:07:23,967 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:07:23,968 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:07:23,968 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:07:24,010 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:07:24,046 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:07:24,046 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:07:24,057 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:07:24,066 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:07:24,067 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:07:24,080 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:07:24,093 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:07:24,094 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:07:24,112 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:07:24,117 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:07:24,118 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:07:24,128 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 05:07:24,135 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:07:24,135 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:07:24,158 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 05:07:24,158 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 05:07:56,735 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 05:07:56,747 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 05:07:57,676 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.53636334281715986684458769% which is below threshold 100.0%
2025-07-14 05:07:58,195 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 05:07:58,204 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 05:07:58,231 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 05:07:58,232 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 05:08:56,737 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 05:08:56,745 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 05:08:57,786 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 80.56561559051276886211896729% which is below threshold 100.0%
2025-07-14 05:08:58,211 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 05:08:58,230 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 05:08:58,267 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 05:08:58,268 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 05:09:56,446 - INFO - app - Application shutdown initiated
2025-07-14 05:09:56,447 - INFO - app - Scheduler shutdown completed
2025-07-14 05:09:57,752 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 05:09:59,123 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 05:09:59,123 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 05:09:59,140 - INFO - app - Redis connection closed
2025-07-14 05:09:59,140 - INFO - app - Application shutdown completed
