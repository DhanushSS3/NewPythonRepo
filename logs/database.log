2025-07-15 05:50:27,116 - ERROR - database - Error in database session: 500: Failed to process order: 400: Insufficient free margin
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 1006, in place_pending_order
    raise HTTPException(status_code=400, detail="Insufficient free margin")
fastapi.exceptions.HTTPException: 400: Insufficient free margin

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 1247, in place_pending_order
    raise HTTPException(status_code=500, detail=f"Failed to process order: {str(e)}")
fastapi.exceptions.HTTPException: 500: Failed to process order: 400: Insufficient free margin
2025-07-15 05:50:27,124 - INFO - database - Session rolled back due to error
2025-07-15 05:53:04,314 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 8, 'checked_out': 2, 'overflow': 0}
2025-07-15 06:00:08,234 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 8, 'checked_out': 2, 'overflow': 0}
2025-07-15 21:10:38,622 - ERROR - database - Error in database session: 401: Could not validate credentials
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 94, in decode_token
    payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 174, in decode
    _validate_claims(
    ~~~~~~~~~~~~~~~~^
        claims,
        ^^^^^^^
    ...<5 lines>...
        options=defaults,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 497, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 331, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 382, in get_user_from_service_or_user_token
    payload = decode_token(token)
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 99, in decode_token
    raise JWTError("Could not validate credentials")
jose.exceptions.JWTError: Could not validate credentials

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 435, in get_user_from_service_or_user_token
    raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Could not validate credentials
2025-07-15 21:10:38,636 - INFO - database - Session rolled back due to error
2025-07-15 21:10:38,669 - ERROR - database - Error in database session: 401: Could not validate credentials
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 94, in decode_token
    payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 174, in decode
    _validate_claims(
    ~~~~~~~~~~~~~~~~^
        claims,
        ^^^^^^^
    ...<5 lines>...
        options=defaults,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 497, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 331, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 382, in get_user_from_service_or_user_token
    payload = decode_token(token)
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 99, in decode_token
    raise JWTError("Could not validate credentials")
jose.exceptions.JWTError: Could not validate credentials

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 435, in get_user_from_service_or_user_token
    raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Could not validate credentials
2025-07-15 21:10:38,675 - INFO - database - Session rolled back due to error
2025-07-15 21:12:18,384 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 9, 'checked_out': 1, 'overflow': 0}
2025-07-15 21:14:18,386 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 9, 'checked_out': 1, 'overflow': 0}
2025-07-15 21:16:18,387 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 9, 'checked_out': 1, 'overflow': 0}
2025-07-15 21:18:18,389 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 9, 'checked_out': 1, 'overflow': 0}
2025-07-15 21:20:18,387 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 8, 'checked_out': 2, 'overflow': 0}
2025-07-15 21:22:18,382 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 8, 'checked_out': 2, 'overflow': 0}
2025-07-15 21:24:18,387 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 8, 'checked_out': 2, 'overflow': 0}
2025-07-15 21:26:18,389 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 8, 'checked_out': 2, 'overflow': 0}
2025-07-15 21:28:18,389 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 8, 'checked_out': 2, 'overflow': 0}
2025-07-15 21:37:19,420 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 7, 'checked_out': 3, 'overflow': 0}
2025-07-15 21:39:19,424 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 7, 'checked_out': 3, 'overflow': 0}
2025-07-15 21:41:19,421 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 7, 'checked_out': 3, 'overflow': 0}
2025-07-15 21:47:28,218 - ERROR - database - Error in database session: 401: Could not validate credentials
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 460, in get_user_from_service_token
    payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 174, in decode
    _validate_claims(
    ~~~~~~~~~~~~~~~~^
        claims,
        ^^^^^^^
    ...<5 lines>...
        options=defaults,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 497, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 331, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 468, in get_user_from_service_token
    raise credentials_exception
fastapi.exceptions.HTTPException: 401: Could not validate credentials
2025-07-15 21:47:28,235 - INFO - database - Session rolled back due to error
2025-07-15 21:48:10,626 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 7, 'checked_out': 3, 'overflow': 0}
2025-07-15 21:50:10,633 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 7, 'checked_out': 3, 'overflow': 0}
2025-07-15 21:52:10,637 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 7, 'checked_out': 3, 'overflow': 0}
2025-07-15 21:57:07,937 - ERROR - database - Error in database session: 500: Failed to update order: 404: Order not found with provided ID
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 2901, in update_order_by_service_provider
    raise HTTPException(status_code=404, detail="Order not found with provided ID")
fastapi.exceptions.HTTPException: 404: Order not found with provided ID

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3572, in update_order_by_service_provider
    raise HTTPException(status_code=500, detail=f"Failed to update order: {str(e)}")
fastapi.exceptions.HTTPException: 500: Failed to update order: 404: Order not found with provided ID
2025-07-15 21:57:07,944 - INFO - database - Session rolled back due to error
2025-07-15 22:57:43,658 - ERROR - database - Error in database session: 401: Could not validate credentials
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 460, in get_user_from_service_token
    payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 174, in decode
    _validate_claims(
    ~~~~~~~~~~~~~~~~^
        claims,
        ^^^^^^^
    ...<5 lines>...
        options=defaults,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 497, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 331, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 468, in get_user_from_service_token
    raise credentials_exception
fastapi.exceptions.HTTPException: 401: Could not validate credentials
2025-07-15 22:57:43,673 - INFO - database - Session rolled back due to error
2025-07-15 22:57:56,191 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 6, 'checked_out': 2, 'overflow': -2}
2025-07-15 22:59:56,185 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 6, 'checked_out': 2, 'overflow': -2}
2025-07-15 23:02:30,071 - ERROR - database - Error in database session: 401: Could not validate credentials
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jws.py", line 180, in _load
    signing_input, crypto_segment = jwt.rsplit(b".", 1)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: not enough values to unpack (expected 2, got 1)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 159, in decode
    payload = jws.verify(token, key, algorithms, verify=verify_signature)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jws.py", line 74, in verify
    header, payload, signing_input, signature = _load(token)
                                                ~~~~~^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jws.py", line 184, in _load
    raise JWSError("Not enough segments")
jose.exceptions.JWSError: Not enough segments

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 460, in get_user_from_service_token
    payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 161, in decode
    raise JWTError(e)
jose.exceptions.JWTError: Not enough segments

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 468, in get_user_from_service_token
    raise credentials_exception
fastapi.exceptions.HTTPException: 401: Could not validate credentials
2025-07-15 23:02:30,077 - INFO - database - Session rolled back due to error
2025-07-15 23:04:06,581 - INFO - database - Connection pool status: {'pool_size': 10, 'checked_in': 8, 'checked_out': 2, 'overflow': 0}
