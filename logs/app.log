2025-07-18 01:42:31,185 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:42:31,223 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:42:31,238 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:42:31,239 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:42:31,848 - INFO - app - Application starting up - Trading system initialized
2025-07-18 01:42:31,848 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-18 01:42:31,848 - INFO - app - Environment: PRODUCTION
2025-07-18 01:42:31,919 - INFO - app - Application startup initiated
2025-07-18 01:42:31,920 - INFO - app - Initializing core services...
2025-07-18 01:42:31,973 - INFO - app - Firebase initialized
2025-07-18 01:42:31,973 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-18 01:42:32,001 - INFO - app - Redis initialized
2025-07-18 01:42:32,682 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-18 01:42:32,756 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-18 01:42:32,756 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-18 01:42:32,759 - INFO - app - Scheduler initialized
2025-07-18 01:42:32,766 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-18 01:42:32,767 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-18 01:42:33,985 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-18 01:42:34,010 - INFO - app - Starting stale cache cleanup task
2025-07-18 01:42:34,064 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-18 01:42:34,064 - INFO - app - Background tasks initialized
2025-07-18 01:42:34,712 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-18 01:42:34,712 - INFO - app - Application startup completed successfully
2025-07-18 01:42:34,713 - INFO - app - Starting cache validation task
2025-07-18 01:42:34,715 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-18 01:42:34,718 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-18 01:42:34,720 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-18 01:42:34,720 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:42:34,720 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:42:34,720 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:42:34,734 - INFO - app - Found 46 static orders cache entries to check
2025-07-18 01:42:34,746 - INFO - app - Validating cache for 29 users
2025-07-18 01:42:34,748 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:42:34,748 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:42:34,748 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:42:34,765 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,778 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-18 01:42:34,786 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-18 01:42:34,791 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-18 01:42:34,795 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-18 01:42:34,799 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-18 01:42:34,802 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-18 01:42:34,807 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-18 01:42:34,809 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-18 01:42:34,811 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-18 01:42:34,814 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-18 01:42:34,815 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,815 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-18 01:42:34,817 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-18 01:42:34,821 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-18 01:42:34,828 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-18 01:42:34,828 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,831 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-18 01:42:34,836 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-18 01:42:34,839 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-18 01:42:34,842 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-18 01:42:34,844 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-18 01:42:34,846 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-18 01:42:34,850 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-18 01:42:34,856 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-18 01:42:34,857 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,861 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-18 01:42:34,865 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-18 01:42:34,871 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-18 01:42:34,875 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-18 01:42:34,877 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-18 01:42:34,878 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-18 01:42:34,880 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-18 01:42:34,882 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-18 01:42:34,886 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,889 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-18 01:42:34,891 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-18 01:42:34,893 - INFO - app - Completed stale cache cleanup task
2025-07-18 01:42:34,898 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,907 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,917 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,926 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,936 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,946 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,954 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,963 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,972 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,981 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-18 01:42:34,988 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,032 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,046 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,058 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,079 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,093 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,111 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,127 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,129 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:42:35,434 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 48.83272248417891079264383220% which is below threshold 100.0%
2025-07-18 01:42:35,434 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '1586.95604874634940715718073', 'margin': '3249.78', 'free_margin': '-1662.82395125365059284281927', 'profit_loss': '-18228.47395125365059284281927', 'margin_level': '48.83272248417891079264383220', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18228.47395125365059284281927', 'current_price': '96.8260000000'}], 'margin_call': True}
2025-07-18 01:42:35,436 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 48.83272248417891079264383220
2025-07-18 01:42:35,437 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:42:35,438 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:42:35,446 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:42:35,447 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:42:35,450 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-18 01:42:35,461 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:42:35,463 - INFO - app - Cache validation completed
2025-07-18 01:42:35,465 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:42:35,465 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:42:35,734 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:42:36,036 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 16.98071008549653758365894232% which is below threshold 100.0%
2025-07-18 01:42:36,037 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '1404.590000000000000000000000', 'margin': '8271.68', 'free_margin': '-6867.090000000000000000000000', 'profit_loss': '-7032.000000000000000000000000', 'margin_level': '16.98071008549653758365894232', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7032.000000000000000000000000', 'current_price': '119705.0000000000'}], 'margin_call': True}
2025-07-18 01:42:36,039 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 16.98071008549653758365894232
2025-07-18 01:42:36,648 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:42:36,651 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:42:36,662 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:42:36,675 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:42:36,702 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:42:36,712 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:42:36,715 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:42:36,923 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:42:36,931 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:42:36,947 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:42:36,947 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:42:36,950 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:42:36,952 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:42:36,955 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:42:36,955 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:42:36,975 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:42:36,976 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:42:36,977 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:42:36,977 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:42:36,992 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:42:36,996 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:42:36,999 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:42:37,017 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:42:37,017 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:42:37,022 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:42:37,022 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:42:37,023 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:42:37,023 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:42:40,037 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-18 01:42:40,046 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:42:40,046 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:42:40,059 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 25
2025-07-18 01:42:40,062 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 25
2025-07-18 01:42:40,067 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 25
2025-07-18 01:42:40,070 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 25
2025-07-18 01:42:40,100 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 25 using refresh token.
2025-07-18 01:42:40,103 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 25 using refresh token.
2025-07-18 01:42:40,137 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,138 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:42:40,175 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,175 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:42:40,209 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,209 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:42:40,304 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:42:40,653 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.155482051367244657687799035% which is below threshold 100.0%
2025-07-18 01:42:40,653 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '299.596296722447633850770773', 'margin': '9494.47', 'free_margin': '-9194.873703277552366149229227', 'profit_loss': '-9602.423703277552366149229227', 'margin_level': '3.155482051367244657687799035', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9583.930000000000000000000000', 'current_price': '118537.6000000000'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-16.81245752504760559020838800', 'current_price': '96.8620000000'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-1.681245752504760559020838800', 'current_price': '96.8620000000'}], 'margin_call': True}
2025-07-18 01:42:40,711 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.155482051367244657687799035
2025-07-18 01:42:40,765 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:42:40,765 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:42:40,791 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,792 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:42:40,825 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,825 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:42:40,859 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,859 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:42:40,890 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,891 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:42:40,916 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,916 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:42:40,937 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,937 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:42:40,961 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,961 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:42:40,987 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:40,987 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:42:41,118 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:42:41,443 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356289.8600000000000000000000', 'margin': '59910.39', 'free_margin': '296379.4700000000000000000000', 'profit_loss': '106289.8600000000000000000000', 'margin_level': '594.7046246903083087925149544', 'positions': [{'order_id': '1024-006', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106289.8600000000000000000000', 'current_price': '118487.6'}], 'margin_call': False}
2025-07-18 01:42:41,447 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.7046246903083087925149544
2025-07-18 01:42:41,451 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:42:41,451 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:42:41,566 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:42:41,880 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.52727097964719386293987342% which is below threshold 100.0%
2025-07-18 01:42:41,881 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98916.96499999999980000000000', 'margin': '146484.47', 'free_margin': '-47567.50500000000020000000000', 'profit_loss': '-85428.84500000000020000000000', 'margin_level': '67.52727097964719386293987342', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-141.4250000000002000000000000', 'current_price': '38.271499999999996'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85287.42000000000000000000000', 'current_price': '118487.6'}], 'margin_call': True}
2025-07-18 01:42:41,884 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.52727097964719386293987342
2025-07-18 01:42:41,886 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:42:41,886 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:42:41,978 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:42:41,980 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:42:42,489 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17009.69000000', 'equity': '17009.69000000', 'margin': '16907.79', 'free_margin': '101.90000000', 'profit_loss': '0.0', 'margin_level': '100.6026807761392825437268857', 'positions': [], 'margin_call': False}
2025-07-18 01:42:42,492 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 100.6026807761392825437268857
2025-07-18 01:42:42,494 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:42:42,494 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:42:42,495 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:42:42,495 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:42:42,506 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:42:42,507 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:42:42,507 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:42:42,534 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:42,534 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:42:42,535 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:42:42,535 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:42:42,536 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:42:42,536 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:42:42,634 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:42:42,635 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:42:43,002 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-18 01:42:43,024 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-18 01:42:43,029 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:42:43,029 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:42:43,244 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:42:43,245 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:42:43,618 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:42:43,623 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:42:43,623 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:42:43,624 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:42:43,743 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:42:43,744 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:42:44,140 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:42:44,143 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:42:44,143 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:42:44,143 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:42:44,183 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:44,183 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:42:44,208 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:42:49,714 - INFO - app - Starting stale cache cleanup task
2025-07-18 01:42:49,727 - INFO - app - Found 46 static orders cache entries to check
2025-07-18 01:42:49,733 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-18 01:42:49,740 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-18 01:42:49,743 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-18 01:42:49,748 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-18 01:42:49,750 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-18 01:42:49,753 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-18 01:42:49,756 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-18 01:42:49,758 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-18 01:42:49,759 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-18 01:42:49,761 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-18 01:42:49,762 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-18 01:42:49,764 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-18 01:42:49,767 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-18 01:42:49,769 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-18 01:42:49,772 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-18 01:42:49,774 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-18 01:42:49,776 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-18 01:42:49,777 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-18 01:42:49,778 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-18 01:42:49,779 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-18 01:42:49,782 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-18 01:42:49,783 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-18 01:42:49,785 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-18 01:42:49,787 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-18 01:42:49,789 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-18 01:42:49,790 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-18 01:42:49,791 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-18 01:42:49,792 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-18 01:42:49,794 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-18 01:42:49,795 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-18 01:42:49,797 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-18 01:42:49,798 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-18 01:42:49,799 - INFO - app - Completed stale cache cleanup task
2025-07-18 01:43:14,210 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:43:14,210 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:43:14,210 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:43:14,220 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:43:14,220 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:43:14,220 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:43:14,444 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:43:14,748 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 47.42465349008132270095591425% which is below threshold 100.0%
2025-07-18 01:43:14,748 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '1541.19690418996480887112511', 'margin': '3249.78', 'free_margin': '-1708.58309581003519112887489', 'profit_loss': '-18274.23309581003519112887489', 'margin_level': '47.42465349008132270095591425', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18274.23309581003519112887489', 'current_price': '96.819'}], 'margin_call': True}
2025-07-18 01:43:14,751 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 47.42465349008132270095591425
2025-07-18 01:43:14,754 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:43:14,755 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:43:14,765 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:43:14,766 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:43:14,792 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:43:14,796 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:43:14,796 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:43:15,084 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:43:15,463 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.79313029517582885217996828% which is below threshold 100.0%
2025-07-18 01:43:15,464 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '975.490000000000000000000000', 'margin': '8271.68', 'free_margin': '-7296.190000000000000000000000', 'profit_loss': '-7461.100000000000000000000000', 'margin_level': '11.79313029517582885217996828', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7461.100000000000000000000000', 'current_price': '118479.0'}], 'margin_call': True}
2025-07-18 01:43:15,469 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.79313029517582885217996828
2025-07-18 01:43:19,253 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-18 01:43:19,302 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:43:19,303 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:43:19,495 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:19,495 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:43:19,565 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:19,565 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:43:19,626 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:19,626 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:43:19,860 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:43:20,177 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.902367511750091591567577358% which is below threshold 100.0%
2025-07-18 01:43:20,177 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '275.564412692858921133906162', 'margin': '9494.47', 'free_margin': '-9218.905587307141078866093838', 'profit_loss': '-9626.455587307141078866093838', 'margin_level': '2.902367511750091591567577358', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9607.370000000000000000000000', 'current_price': '118479.0'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-17.35053391558279896917621569', 'current_price': '96.854'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-1.735053391558279896917621569', 'current_price': '96.854'}], 'margin_call': True}
2025-07-18 01:43:20,180 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.902367511750091591567577358
2025-07-18 01:43:20,279 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:43:20,280 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:43:20,353 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:20,354 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:43:20,427 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:20,428 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:43:20,502 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:20,503 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:43:20,548 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:20,548 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:43:20,598 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:20,598 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:43:20,633 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:20,634 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:43:20,676 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:20,676 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:43:20,714 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:20,714 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:43:20,815 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:43:21,198 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356277.0600000000000000000000', 'margin': '59910.39', 'free_margin': '296366.6700000000000000000000', 'profit_loss': '106277.0600000000000000000000', 'margin_level': '594.6832594479855664434833424', 'positions': [{'order_id': '1024-006', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'swap': 'None', 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106277.0600000000000000000000', 'current_price': '118474.8'}], 'margin_call': False}
2025-07-18 01:43:21,202 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.6832594479855664434833424
2025-07-18 01:43:21,205 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:43:21,206 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:43:21,465 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:43:21,761 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.47450088053702894238549656% which is below threshold 100.0%
2025-07-18 01:43:21,761 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98839.66500000000000000000000', 'margin': '146484.47', 'free_margin': '-47644.80500000000000000000000', 'profit_loss': '-85506.14500000000000000000000', 'margin_level': '67.47450088053702894238549656', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-141.925000000000000000000000', 'current_price': '38.2615'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85364.22000000000000000000000', 'current_price': '118474.8'}], 'margin_call': True}
2025-07-18 01:43:21,764 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.47450088053702894238549656
2025-07-18 01:43:21,766 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:43:21,767 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:43:21,860 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:43:21,861 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:43:22,237 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17009.69000000', 'equity': '17009.69000000', 'margin': '16907.79', 'free_margin': '101.90000000', 'profit_loss': '0.0', 'margin_level': '100.6026807761392825437268857', 'positions': [], 'margin_call': False}
2025-07-18 01:43:22,242 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 100.6026807761392825437268857
2025-07-18 01:43:22,249 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:43:22,249 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:43:22,256 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:43:22,256 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:43:22,310 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:43:22,314 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:43:22,314 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:43:22,393 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:22,394 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:43:22,397 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:43:22,397 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:43:22,400 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:43:22,400 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:43:22,550 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:43:22,551 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:43:22,938 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-18 01:43:22,942 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-18 01:43:22,945 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:43:22,946 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:43:23,112 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:43:23,113 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:43:23,451 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:43:23,487 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:43:23,488 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:43:23,488 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:43:23,649 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:43:23,651 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:43:23,960 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:43:23,962 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:43:23,962 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:43:23,962 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:43:24,030 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:24,030 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:43:24,109 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:33,074 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-18 01:43:54,116 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:43:54,116 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:43:54,116 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:43:54,129 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:43:54,130 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:43:54,130 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:43:54,434 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:43:54,768 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 39.80680089639869474776756673% which is below threshold 100.0%
2025-07-18 01:43:54,768 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '1293.63345417098550217400083', 'margin': '3249.78', 'free_margin': '-1956.14654582901449782599917', 'profit_loss': '-18521.79654582901449782599917', 'margin_level': '39.80680089639869474776756673', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18521.79654582901449782599917', 'current_price': '96.783'}], 'margin_call': True}
2025-07-18 01:43:54,771 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 39.80680089639869474776756673
2025-07-18 01:43:54,773 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:43:54,773 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:43:54,780 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:43:54,781 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:43:54,804 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:43:54,808 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:43:54,808 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:43:54,950 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:43:55,300 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.51682608611551704127819258% which is below threshold 100.0%
2025-07-18 01:43:55,300 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '952.635000000000000000000000', 'margin': '8271.68', 'free_margin': '-7319.045000000000000000000000', 'profit_loss': '-7483.955000000000000000000000', 'margin_level': '11.51682608611551704127819258', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7483.955000000000000000000000', 'current_price': '118413.7'}], 'margin_call': True}
2025-07-18 01:43:55,303 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.51682608611551704127819258
2025-07-18 01:43:59,087 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-18 01:43:59,091 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:43:59,092 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:43:59,240 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:59,241 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:43:59,301 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:59,301 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:43:59,326 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:43:59,326 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:43:59,542 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:43:59,910 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.487910381547670808816357364% which is below threshold 100.0%
2025-07-18 01:43:59,911 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '236.213904802929140641826405', 'margin': '9494.47', 'free_margin': '-9258.256095197070859358173595', 'profit_loss': '-9665.806095197070859358173595', 'margin_level': '2.487910381547670808816357364', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9644.050000000000000000000000', 'current_price': '118387.3'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-19.77826836097350850743054060', 'current_price': '96.818'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-1.977826836097350850743054060', 'current_price': '96.818'}], 'margin_call': True}
2025-07-18 01:43:59,914 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.487910381547670808816357364
2025-07-18 01:43:59,967 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:43:59,967 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:44:00,001 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:00,002 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:44:00,040 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:00,040 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:44:00,070 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:00,070 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:44:00,107 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:00,109 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:44:00,163 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:00,163 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:44:00,199 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:00,199 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:44:00,239 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:00,240 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:44:00,281 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:00,281 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:44:00,450 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:44:00,824 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356189.5600000000000000000000', 'margin': '59910.39', 'free_margin': '296279.1700000000000000000000', 'profit_loss': '106189.5600000000000000000000', 'margin_level': '594.5372079867949449169000569', 'positions': [{'order_id': '1024-006', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'swap': 'None', 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106189.5600000000000000000000', 'current_price': '118387.3'}], 'margin_call': False}
2025-07-18 01:44:00,827 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.5372079867949449169000569
2025-07-18 01:44:00,830 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:44:00,831 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:44:01,002 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:44:01,341 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.11661311263917601640638083% which is below threshold 100.0%
2025-07-18 01:44:01,342 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98315.41500000000000000000000', 'margin': '146484.47', 'free_margin': '-48169.05500000000000000000000', 'profit_loss': '-86030.39500000000000000000000', 'margin_level': '67.11661311263917601640638083', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-141.175000000000000000000000', 'current_price': '38.2765'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85889.22000000000000000000000', 'current_price': '118387.3'}], 'margin_call': True}
2025-07-18 01:44:01,345 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.11661311263917601640638083
2025-07-18 01:44:01,355 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:44:01,357 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:44:01,509 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:44:01,513 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:44:01,848 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17009.69000000', 'equity': '17009.69000000', 'margin': '16907.79', 'free_margin': '101.90000000', 'profit_loss': '0.0', 'margin_level': '100.6026807761392825437268857', 'positions': [], 'margin_call': False}
2025-07-18 01:44:01,852 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 100.6026807761392825437268857
2025-07-18 01:44:01,858 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:44:01,861 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:44:01,865 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:44:01,865 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:44:01,893 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:44:01,896 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:44:01,896 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:44:01,945 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:01,945 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:44:01,947 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:44:01,947 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:44:01,949 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:44:01,949 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:44:02,095 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:44:02,096 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:44:02,469 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-18 01:44:02,502 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-18 01:44:02,504 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:44:02,504 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:44:02,645 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:44:02,645 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:44:03,080 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:44:03,084 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:44:03,085 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:44:03,085 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:44:03,316 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:44:03,319 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:44:03,693 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:44:03,698 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:44:03,699 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:44:03,699 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:44:03,804 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:03,804 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:44:03,851 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:33,194 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-18 01:44:33,858 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:44:33,858 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:44:33,858 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:44:33,866 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:44:33,867 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:44:33,867 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:44:33,976 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:44:34,310 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 40.41288886655398670127404501% which is below threshold 100.0%
2025-07-18 01:44:34,310 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '1313.32997980749814902066366', 'margin': '3249.78', 'free_margin': '-1936.45002019250185097933634', 'profit_loss': '-18502.10002019250185097933634', 'margin_level': '40.41288886655398670127404501', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18502.10002019250185097933634', 'current_price': '96.786'}], 'margin_call': True}
2025-07-18 01:44:34,313 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 40.41288886655398670127404501
2025-07-18 01:44:34,314 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:44:34,314 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:44:34,319 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:44:34,319 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:44:34,333 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:44:34,335 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:44:34,335 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:44:34,410 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:44:34,719 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.21386465627296994081008937% which is below threshold 100.0%
2025-07-18 01:44:34,720 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '927.575000000000000000000000', 'margin': '8271.68', 'free_margin': '-7344.105000000000000000000000', 'profit_loss': '-7509.015000000000000000000000', 'margin_level': '11.21386465627296994081008937', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7509.015000000000000000000000', 'current_price': '118342.1'}], 'margin_call': True}
2025-07-18 01:44:34,723 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.21386465627296994081008937
2025-07-18 01:44:38,609 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-18 01:44:38,613 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:44:38,614 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:44:38,721 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:38,721 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:44:38,783 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:38,783 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:44:38,803 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:38,803 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:44:38,875 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:44:39,231 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.299812949880905405980771797% which is below threshold 100.0%
2025-07-18 01:44:39,231 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '218.355050582557599499222584', 'margin': '9494.47', 'free_margin': '-9276.114949417442400500777416', 'profit_loss': '-9683.664949417442400500777416', 'margin_level': '2.299812949880905405980771797', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9662.130000000000000000000000', 'current_price': '118342.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-19.57722674312945500070674232', 'current_price': '96.821'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-1.957722674312945500070674232', 'current_price': '96.821'}], 'margin_call': True}
2025-07-18 01:44:39,234 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.299812949880905405980771797
2025-07-18 01:44:39,276 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:44:39,276 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:44:39,308 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:39,308 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:44:39,326 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:39,326 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:44:39,343 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:39,343 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:44:39,360 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:39,360 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:44:39,377 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:39,377 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:44:39,399 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:39,399 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:44:39,418 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:39,418 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:44:39,434 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:39,434 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:44:39,500 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:44:39,848 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356145.8900000000000000000000', 'margin': '59910.39', 'free_margin': '296235.5000000000000000000000', 'profit_loss': '106145.8900000000000000000000', 'margin_level': '594.4643157889641512932898617', 'positions': [{'order_id': '1024-006', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'swap': 'None', 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106145.8900000000000000000000', 'current_price': '118343.63'}], 'margin_call': False}
2025-07-18 01:44:39,881 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.4643157889641512932898617
2025-07-18 01:44:39,884 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:44:39,884 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:44:39,980 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:44:40,351 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.07807660429805268776956356% which is below threshold 100.0%
2025-07-18 01:44:40,352 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98258.96499999999970000000000', 'margin': '146484.47', 'free_margin': '-48225.50500000000030000000000', 'profit_loss': '-86086.84500000000030000000000', 'margin_level': '67.07807660429805268776956356', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-141.2250000000003000000000000', 'current_price': '38.275499999999994'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85945.62000000000000000000000', 'current_price': '118377.9'}], 'margin_call': True}
2025-07-18 01:44:40,357 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.07807660429805268776956356
2025-07-18 01:44:40,371 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:44:40,372 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:44:40,484 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:44:40,484 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:44:40,863 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17009.69000000', 'equity': '17009.69000000', 'margin': '16907.79', 'free_margin': '101.90000000', 'profit_loss': '0.0', 'margin_level': '100.6026807761392825437268857', 'positions': [], 'margin_call': False}
2025-07-18 01:44:40,897 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 100.6026807761392825437268857
2025-07-18 01:44:40,900 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:44:40,900 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:44:40,902 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:44:40,902 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:44:40,921 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:44:40,923 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:44:40,923 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:44:40,945 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:40,945 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:44:40,946 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:44:40,946 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:44:40,947 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:44:40,947 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:44:40,999 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:44:41,000 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:44:41,372 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-18 01:44:41,373 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-18 01:44:41,374 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:44:41,374 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:44:41,436 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:44:41,436 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:44:41,893 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:44:41,926 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:44:41,926 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:44:41,926 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:44:42,026 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:44:42,027 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:44:42,364 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:44:42,367 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:44:42,367 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:44:42,367 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:44:42,433 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:44:42,433 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:44:42,454 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:12,467 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:45:12,467 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:45:12,468 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:45:12,477 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:45:12,477 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:45:12,477 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:45:12,605 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:45:12,914 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 41.04185297041060509542630917% which is below threshold 100.0%
2025-07-18 01:45:12,915 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '1333.76992946180976227014511', 'margin': '3249.78', 'free_margin': '-1916.01007053819023772985489', 'profit_loss': '-18481.66007053819023772985489', 'margin_level': '41.04185297041060509542630917', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18481.66007053819023772985489', 'current_price': '96.789'}], 'margin_call': True}
2025-07-18 01:45:12,916 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 41.04185297041060509542630917
2025-07-18 01:45:12,917 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:45:12,917 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:45:12,922 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:45:12,923 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:45:12,939 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:45:12,943 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:45:12,943 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:45:13,101 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:45:13,424 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.37550050292080931564083717% which is below threshold 100.0%
2025-07-18 01:45:13,425 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '940.945000000000000000000000', 'margin': '8271.68', 'free_margin': '-7330.735000000000000000000000', 'profit_loss': '-7495.645000000000000000000000', 'margin_level': '11.37550050292080931564083717', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7495.645000000000000000000000', 'current_price': '118380.3'}], 'margin_call': True}
2025-07-18 01:45:13,429 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.37550050292080931564083717
2025-07-18 01:45:17,214 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-18 01:45:17,216 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:45:17,216 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:45:17,406 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:17,407 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:45:17,448 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:17,448 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:45:17,469 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:17,469 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:45:17,589 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:45:17,872 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.463102521863836334717154502% which is below threshold 100.0%
2025-07-18 01:45:17,873 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '233.858530007605381648819819', 'margin': '9494.47', 'free_margin': '-9260.611469992394618351180181', 'profit_loss': '-9668.161469992394618351180181', 'margin_level': '2.463102521863836334717154502', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9646.850000000000000000000000', 'current_price': '118380.3'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-19.37406362944965304652743658', 'current_price': '96.824'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-1.937406362944965304652743658', 'current_price': '96.824'}], 'margin_call': True}
2025-07-18 01:45:17,875 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.463102521863836334717154502
2025-07-18 01:45:17,917 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:45:17,917 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:45:17,941 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:17,941 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:45:17,963 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:17,963 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:45:17,988 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:17,988 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:45:18,011 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:18,011 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:45:18,051 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:18,055 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:45:18,080 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:18,080 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:45:18,097 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:18,097 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:45:18,115 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:18,115 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:45:18,180 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:45:18,548 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356182.5600000000000000000000', 'margin': '59910.39', 'free_margin': '296272.1700000000000000000000', 'profit_loss': '106182.5600000000000000000000', 'margin_level': '594.5255238698996951947733941', 'positions': [{'order_id': '1024-006', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'swap': 'None', 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106182.5600000000000000000000', 'current_price': '118380.3'}], 'margin_call': False}
2025-07-18 01:45:18,582 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.5255238698996951947733941
2025-07-18 01:45:18,585 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:45:18,585 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:45:18,783 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:45:19,162 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.08756566481074751473654511% which is below threshold 100.0%
2025-07-18 01:45:19,162 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98272.86500000000000000000000', 'margin': '146484.47', 'free_margin': '-48211.60500000000000000000000', 'profit_loss': '-86072.94500000000000000000000', 'margin_level': '67.08756566481074751473654511', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-139.925000000000000000000000', 'current_price': '38.3015'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85933.02000000000000000000000', 'current_price': '118380.0'}], 'margin_call': True}
2025-07-18 01:45:19,164 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.08756566481074751473654511
2025-07-18 01:45:19,167 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:45:19,167 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:45:19,423 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:45:19,425 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:45:19,786 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17009.69000000', 'equity': '17009.69000000', 'margin': '16907.79', 'free_margin': '101.90000000', 'profit_loss': '0.0', 'margin_level': '100.6026807761392825437268857', 'positions': [], 'margin_call': False}
2025-07-18 01:45:19,790 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 100.6026807761392825437268857
2025-07-18 01:45:19,793 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:45:19,793 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:45:19,797 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:45:19,797 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:45:19,818 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:45:19,821 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:45:19,821 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:45:19,848 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:19,849 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:45:19,849 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:45:19,849 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:45:19,850 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:45:19,850 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:45:19,920 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:45:19,920 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:45:20,287 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-18 01:45:20,290 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-18 01:45:20,294 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:45:20,295 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:45:20,516 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:45:20,519 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:45:20,811 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:45:20,815 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:45:20,815 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:45:20,815 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:45:20,966 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:45:20,967 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:45:21,330 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:45:21,337 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:45:21,337 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:45:21,337 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:45:21,398 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:21,398 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:45:21,417 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:33,091 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-18 01:45:51,420 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:45:51,421 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:45:51,421 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:45:51,431 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:45:51,431 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:45:51,431 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:45:51,594 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:45:51,932 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 41.03804584903910592258935620% which is below threshold 100.0%
2025-07-18 01:45:51,933 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '1333.64620639290305645112438', 'margin': '3249.78', 'free_margin': '-1916.13379360709694354887562', 'profit_loss': '-18481.78379360709694354887562', 'margin_level': '41.03804584903910592258935620', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18481.78379360709694354887562', 'current_price': '96.789'}], 'margin_call': True}
2025-07-18 01:45:51,934 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 41.03804584903910592258935620
2025-07-18 01:45:51,935 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:45:51,935 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:45:51,939 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:45:51,939 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:45:51,948 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:45:51,949 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:45:51,949 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:45:52,004 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:45:52,294 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.53544382761422105303880227% which is below threshold 100.0%
2025-07-18 01:45:52,294 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '954.175000000000000000000000', 'margin': '8271.68', 'free_margin': '-7317.505000000000000000000000', 'profit_loss': '-7482.415000000000000000000000', 'margin_level': '11.53544382761422105303880227', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7482.415000000000000000000000', 'current_price': '118418.1'}], 'margin_call': True}
2025-07-18 01:45:52,296 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.53544382761422105303880227
2025-07-18 01:45:55,922 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-18 01:45:55,923 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:45:55,924 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:45:56,061 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,061 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:45:56,089 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,089 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:45:56,107 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,107 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:45:56,170 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:45:56,542 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.622330190777070474785518212% which is below threshold 100.0%
2025-07-18 01:45:56,542 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '248.976353264271723107368591', 'margin': '9494.47', 'free_margin': '-9245.493646735728276892631409', 'profit_loss': '-9653.043646735728276892631409', 'margin_level': '2.622330190777070474785518212', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9631.730000000000000000000000', 'current_price': '118418.1'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-19.37604248702570626602855354', 'current_price': '96.824'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-1.937604248702570626602855354', 'current_price': '96.824'}], 'margin_call': True}
2025-07-18 01:45:56,544 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.622330190777070474785518212
2025-07-18 01:45:56,577 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:45:56,577 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:45:56,599 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,599 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:45:56,620 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,621 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:45:56,637 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,637 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:45:56,653 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,653 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:45:56,674 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,674 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:45:56,690 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,690 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:45:56,707 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,707 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:45:56,724 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:56,724 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:45:56,799 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:45:57,149 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356206.5600000000000000000000', 'margin': '59910.39', 'free_margin': '296296.1700000000000000000000', 'profit_loss': '106206.5600000000000000000000', 'margin_level': '594.5655836992548370992076667', 'positions': [{'order_id': '1024-006', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'swap': 'None', 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106206.5600000000000000000000', 'current_price': '118404.3'}], 'margin_call': False}
2025-07-18 01:45:57,183 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.5655836992548370992076667
2025-07-18 01:45:57,185 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:45:57,185 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:45:57,388 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:45:57,762 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.19044346475773165578576350% which is below threshold 100.0%
2025-07-18 01:45:57,762 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98423.56500000000000000000000', 'margin': '146484.47', 'free_margin': '-48060.90500000000000000000000', 'profit_loss': '-85922.24500000000000000000000', 'margin_level': '67.19044346475773165578576350', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-139.825000000000000000000000', 'current_price': '38.3035'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85782.42000000000000000000000', 'current_price': '118405.1'}], 'margin_call': True}
2025-07-18 01:45:57,777 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.19044346475773165578576350
2025-07-18 01:45:57,779 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:45:57,779 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:45:58,016 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:45:58,017 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:45:58,378 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17009.69000000', 'equity': '17009.69000000', 'margin': '16907.79', 'free_margin': '101.90000000', 'profit_loss': '0.0', 'margin_level': '100.6026807761392825437268857', 'positions': [], 'margin_call': False}
2025-07-18 01:45:58,381 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 100.6026807761392825437268857
2025-07-18 01:45:58,384 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:45:58,384 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:45:58,386 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:45:58,386 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:45:58,406 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:45:58,407 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:45:58,408 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:45:58,446 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:45:58,446 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:45:58,447 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:45:58,448 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:45:58,449 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:45:58,449 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:45:58,542 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:45:58,542 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:45:58,888 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-18 01:45:58,889 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-18 01:45:58,891 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:45:58,891 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:45:59,030 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:45:59,032 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:45:59,401 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:45:59,405 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:45:59,405 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:45:59,405 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:45:59,637 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:45:59,638 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:46:00,016 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:46:00,025 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:46:00,025 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:46:00,025 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:46:00,079 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:00,080 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:46:00,103 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:04,457 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 25
2025-07-18 01:46:04,457 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-18 01:46:30,105 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:46:30,105 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:46:30,105 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:46:30,111 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:46:30,111 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:46:30,111 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:46:30,299 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:46:30,637 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 39.58823938443104083759388205% which is below threshold 100.0%
2025-07-18 01:46:30,637 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '1286.53068586736307893195846', 'margin': '3249.78', 'free_margin': '-1963.24931413263692106804154', 'profit_loss': '-18528.89931413263692106804154', 'margin_level': '39.58823938443104083759388205', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18528.89931413263692106804154', 'current_price': '96.782'}], 'margin_call': True}
2025-07-18 01:46:30,640 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 39.58823938443104083759388205
2025-07-18 01:46:30,642 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:46:30,643 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:46:30,654 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:46:30,654 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:46:30,677 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:46:30,680 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:46:30,681 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:46:30,765 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:46:31,054 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.36449911021702967232774962% which is below threshold 100.0%
2025-07-18 01:46:31,054 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '940.035000000000000000000000', 'margin': '8271.68', 'free_margin': '-7331.645000000000000000000000', 'profit_loss': '-7496.555000000000000000000000', 'margin_level': '11.36449911021702967232774962', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7496.555000000000000000000000', 'current_price': '118377.7'}], 'margin_call': True}
2025-07-18 01:46:31,087 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.36449911021702967232774962
2025-07-18 01:46:34,626 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-18 01:46:34,628 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:46:34,629 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:46:34,788 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:34,788 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:46:34,853 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:34,853 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:46:34,905 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:34,905 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:46:35,065 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:46:35,361 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.446663958352086877241275848% which is below threshold 100.0%
2025-07-18 01:46:35,362 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '232.297775526551382933609763', 'margin': '9494.47', 'free_margin': '-9262.172224473448617066390237', 'profit_loss': '-9669.722224473448617066390237', 'margin_level': '2.446663958352086877241275848', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9647.890000000000000000000000', 'current_price': '118377.7'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-19.84747679404419733308203364', 'current_price': '96.817'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-1.984747679404419733308203364', 'current_price': '96.817'}], 'margin_call': True}
2025-07-18 01:46:35,364 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.446663958352086877241275848
2025-07-18 01:46:35,405 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:46:35,405 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:46:35,441 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:35,441 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:46:35,483 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:35,483 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:46:35,518 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:35,519 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:46:35,560 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:35,561 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:46:35,599 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:35,599 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:46:35,677 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:35,678 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:46:35,717 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:35,718 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:46:35,772 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:35,772 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:46:35,942 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:46:36,218 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356220.3600000000000000000000', 'margin': '59910.39', 'free_margin': '296309.9700000000000000000000', 'profit_loss': '106220.3600000000000000000000', 'margin_level': '594.5886181011340436942573734', 'positions': [{'order_id': '1024-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'swap': 'None', 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106220.3600000000000000000000', 'current_price': '118418.1'}], 'margin_call': False}
2025-07-18 01:46:36,222 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.5886181011340436942573734
2025-07-18 01:46:36,225 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:46:36,225 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:46:36,399 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:46:36,690 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.23089143852587240135421864% which is below threshold 100.0%
2025-07-18 01:46:36,691 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98482.81500000000000000000000', 'margin': '146484.47', 'free_margin': '-48001.65500000000000000000000', 'profit_loss': '-85862.99500000000000000000000', 'margin_level': '67.23089143852587240135421864', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-139.975000000000000000000000', 'current_price': '38.3005'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85723.02000000000000000000000', 'current_price': '118415.0'}], 'margin_call': True}
2025-07-18 01:46:36,700 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.23089143852587240135421864
2025-07-18 01:46:36,709 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:46:36,709 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:46:36,947 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:46:36,948 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:46:37,291 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17009.69000000', 'equity': '17009.69000000', 'margin': '16907.79', 'free_margin': '101.90000000', 'profit_loss': '0.0', 'margin_level': '100.6026807761392825437268857', 'positions': [], 'margin_call': False}
2025-07-18 01:46:37,295 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 100.6026807761392825437268857
2025-07-18 01:46:37,299 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:46:37,299 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:46:37,302 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:46:37,303 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:46:37,323 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:46:37,327 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:46:37,327 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:46:37,384 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:37,384 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:46:37,385 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:46:37,385 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:46:37,388 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:46:37,388 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:46:37,593 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:46:37,594 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:46:37,904 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-18 01:46:37,938 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-18 01:46:37,940 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:46:37,940 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:46:38,107 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:46:38,108 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:46:38,414 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:46:38,419 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:46:38,419 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:46:38,419 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:46:38,605 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:46:38,606 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:46:38,944 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:46:38,983 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:46:38,984 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:46:38,984 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:46:39,083 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:46:39,083 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:46:39,128 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:07,256 - INFO - app - Application shutdown initiated
2025-07-18 01:47:07,257 - INFO - app - Scheduler shutdown completed
2025-07-18 01:47:07,817 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-18 01:47:08,623 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-18 01:47:08,623 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-18 01:47:08,627 - INFO - app - Redis connection closed
2025-07-18 01:47:08,627 - INFO - app - Application shutdown completed
2025-07-18 01:47:10,543 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:47:10,573 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:10,591 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:10,592 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:11,154 - INFO - app - Application starting up - Trading system initialized
2025-07-18 01:47:11,154 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-18 01:47:11,154 - INFO - app - Environment: PRODUCTION
2025-07-18 01:47:11,228 - INFO - app - Application startup initiated
2025-07-18 01:47:11,228 - INFO - app - Initializing core services...
2025-07-18 01:47:11,277 - INFO - app - Firebase initialized
2025-07-18 01:47:11,277 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-18 01:47:11,301 - INFO - app - Redis initialized
2025-07-18 01:47:12,385 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-18 01:47:12,505 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-18 01:47:12,505 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-18 01:47:12,507 - INFO - app - Scheduler initialized
2025-07-18 01:47:12,511 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-18 01:47:12,511 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-18 01:47:13,450 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-18 01:47:13,464 - INFO - app - Starting stale cache cleanup task
2025-07-18 01:47:13,548 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-18 01:47:13,548 - INFO - app - Background tasks initialized
2025-07-18 01:47:14,253 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-18 01:47:14,254 - INFO - app - Application startup completed successfully
2025-07-18 01:47:14,254 - INFO - app - Starting cache validation task
2025-07-18 01:47:14,259 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-18 01:47:14,262 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-18 01:47:14,266 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-18 01:47:14,266 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:47:14,266 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:47:14,267 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:47:14,299 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-18 01:47:15,488 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-18 01:47:15,489 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-18 01:47:15,489 - INFO - app - Application shutdown initiated
2025-07-18 01:47:15,489 - INFO - app - Scheduler shutdown completed
2025-07-18 01:47:15,501 - INFO - app - Redis connection closed
2025-07-18 01:47:15,501 - INFO - app - Application shutdown completed
2025-07-18 01:47:17,350 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:47:17,402 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:17,432 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:17,432 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:17,754 - INFO - app - Application starting up - Trading system initialized
2025-07-18 01:47:17,754 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-18 01:47:17,754 - INFO - app - Environment: PRODUCTION
2025-07-18 01:47:17,830 - INFO - app - Application startup initiated
2025-07-18 01:47:17,831 - INFO - app - Initializing core services...
2025-07-18 01:47:17,872 - INFO - app - Firebase initialized
2025-07-18 01:47:17,872 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-18 01:47:17,944 - INFO - app - Redis initialized
2025-07-18 01:47:18,495 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-18 01:47:18,546 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-18 01:47:18,548 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio will run as a background asyncio task, not via APScheduler.
2025-07-18 01:47:18,550 - INFO - app - Scheduler initialized
2025-07-18 01:47:18,553 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-18 01:47:18,553 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-18 01:47:19,459 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-18 01:47:19,480 - INFO - app - Starting stale cache cleanup task
2025-07-18 01:47:19,547 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-18 01:47:19,547 - INFO - app - Background tasks initialized
2025-07-18 01:47:20,201 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-18 01:47:20,202 - INFO - app - Application startup completed successfully
2025-07-18 01:47:20,202 - INFO - app - Starting cache validation task
2025-07-18 01:47:20,205 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-18 01:47:20,207 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-18 01:47:20,210 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio background loop
2025-07-18 01:47:20,210 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:47:20,210 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:47:20,210 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:47:20,218 - INFO - app - Found 46 static orders cache entries to check
2025-07-18 01:47:20,262 - INFO - app - Validating cache for 29 users
2025-07-18 01:47:20,263 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:47:20,263 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:47:20,263 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:47:20,274 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-18 01:47:20,279 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-18 01:47:20,282 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-18 01:47:20,284 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-18 01:47:20,285 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-18 01:47:20,286 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-18 01:47:20,287 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-18 01:47:20,289 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-18 01:47:20,291 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-18 01:47:20,292 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-18 01:47:20,292 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-18 01:47:20,294 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-18 01:47:20,295 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-18 01:47:20,297 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-18 01:47:20,300 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-18 01:47:20,301 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-18 01:47:20,302 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-18 01:47:20,304 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-18 01:47:20,308 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-18 01:47:20,311 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-18 01:47:20,313 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-18 01:47:20,315 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-18 01:47:20,317 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-18 01:47:20,319 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-18 01:47:20,321 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-18 01:47:20,322 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-18 01:47:20,323 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-18 01:47:20,324 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-18 01:47:20,327 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-18 01:47:20,328 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-18 01:47:20,332 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-18 01:47:20,334 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-18 01:47:20,335 - INFO - app - Completed stale cache cleanup task
2025-07-18 01:47:20,344 - INFO - app - Cache validation completed
2025-07-18 01:47:20,384 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:47:20,711 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 39.17782863369693520599726535% which is below threshold 100.0%
2025-07-18 01:47:20,711 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '19815.43000000', 'equity': '1273.19323937215626093745793', 'margin': '3249.78', 'free_margin': '-1976.58676062784373906254207', 'profit_loss': '-18542.23676062784373906254207', 'margin_level': '39.17782863369693520599726535', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18542.23676062784373906254207', 'current_price': '96.78'}], 'margin_call': True}
2025-07-18 01:47:20,744 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 39.17782863369693520599726535
2025-07-18 01:47:20,747 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:47:20,747 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:47:20,760 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:47:20,760 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:47:20,792 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:47:20,798 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:47:20,798 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:47:20,980 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:47:21,320 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.78001325002901466207590236% which is below threshold 100.0%
2025-07-18 01:47:21,320 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '974.405000000000000000000000', 'margin': '8271.68', 'free_margin': '-7297.275000000000000000000000', 'profit_loss': '-7462.185000000000000000000000', 'margin_level': '11.78001325002901466207590236', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7462.185000000000000000000000', 'current_price': '118475.9'}], 'margin_call': True}
2025-07-18 01:47:21,352 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.78001325002901466207590236
2025-07-18 01:47:22,371 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:47:22,387 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:47:22,395 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:47:22,404 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:47:22,412 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:47:22,447 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-18 01:47:22,626 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:22,635 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:22,647 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:22,650 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:22,652 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:22,652 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:22,661 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:22,661 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:22,671 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:22,672 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:22,681 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:22,681 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:22,681 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:22,688 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:22,708 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:22,708 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:22,718 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:22,719 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:22,737 - INFO - app.core.config - .env file loaded successfully.
2025-07-18 01:47:22,749 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-18 01:47:22,749 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-18 01:47:25,311 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-18 01:47:25,312 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:47:25,312 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:47:25,466 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:25,466 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:47:25,493 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:25,493 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:47:25,521 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:25,521 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:47:25,649 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:47:26,040 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.858823187093607420690885515% which is below threshold 100.0%
2025-07-18 01:47:26,041 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '271.430109851646428475269918', 'margin': '9494.47', 'free_margin': '-9223.039890148353571524730082', 'profit_loss': '-9630.589890148353571524730082', 'margin_level': '2.858823187093607420690885515', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9608.610000000000000000000000', 'current_price': '118475.9'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-19.98171831668506502248189333', 'current_price': '96.815'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-1.998171831668506502248189333', 'current_price': '96.815'}], 'margin_call': True}
2025-07-18 01:47:26,043 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.858823187093607420690885515
2025-07-18 01:47:26,077 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:47:26,077 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:47:26,103 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:26,103 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:47:26,121 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:26,121 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:47:26,140 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:26,140 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:47:26,164 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:26,164 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:47:26,185 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:26,185 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:47:26,204 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:26,204 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:47:26,221 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:26,221 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:47:26,237 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:26,237 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:47:26,302 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:47:26,649 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356262.2600000000000000000000', 'margin': '59910.39', 'free_margin': '296351.8700000000000000000000', 'profit_loss': '106262.2600000000000000000000', 'margin_level': '594.6585558865498956024155409', 'positions': [{'order_id': '1024-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'swap': 'None', 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106262.2600000000000000000000', 'current_price': '118460.0'}], 'margin_call': False}
2025-07-18 01:47:26,654 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.6585558865498956024155409
2025-07-18 01:47:26,657 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:47:26,657 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:47:26,737 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:47:27,055 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.41555265210025335791568895% which is below threshold 100.0%
2025-07-18 01:47:27,055 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '184345.81000000', 'equity': '98753.31500000000000000000000', 'margin': '146484.47', 'free_margin': '-47731.15500000000000000000000', 'profit_loss': '-85592.49500000000000000000000', 'margin_level': '67.41555265210025335791568895', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-139.475000000000000000000000', 'current_price': '38.3105'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85453.02000000000000000000000', 'current_price': '118460.0'}], 'margin_call': True}
2025-07-18 01:47:27,060 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.41555265210025335791568895
2025-07-18 01:47:27,065 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:47:27,066 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:47:27,217 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:47:27,218 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:47:27,669 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '17009.69000000', 'equity': '17009.69000000', 'margin': '16907.79', 'free_margin': '101.90000000', 'profit_loss': '0.0', 'margin_level': '100.6026807761392825437268857', 'positions': [], 'margin_call': False}
2025-07-18 01:47:27,673 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 100.6026807761392825437268857
2025-07-18 01:47:27,675 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:47:27,675 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:47:27,677 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:47:27,677 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:47:27,696 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:47:27,697 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:47:27,697 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:47:27,726 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:27,726 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:47:27,727 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:47:27,727 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:47:27,727 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:47:27,727 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:47:27,790 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:47:27,790 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:47:28,180 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '8436.59000000', 'equity': '8436.59000000', 'margin': '8271.68', 'free_margin': '164.91000000', 'profit_loss': '0.0', 'margin_level': '101.9936699678904406360013927', 'positions': [], 'margin_call': False}
2025-07-18 01:47:28,214 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-18 01:47:28,217 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:47:28,217 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:47:28,303 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:47:28,304 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:47:28,693 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '9707.74000000', 'equity': '9707.74000000', 'margin': '0.0', 'free_margin': '9707.74000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:47:28,696 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:47:28,696 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:47:28,696 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:47:28,825 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:47:28,826 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:47:29,204 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '14420.38000000', 'equity': '14420.38000000', 'margin': '0.0', 'free_margin': '14420.38000000', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:47:29,237 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:47:29,237 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:47:29,237 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:47:29,314 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:29,314 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:47:29,351 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:47:35,211 - INFO - app - Starting stale cache cleanup task
2025-07-18 01:47:35,215 - INFO - app - Found 46 static orders cache entries to check
2025-07-18 01:47:35,220 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-18 01:47:35,224 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-18 01:47:35,225 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-18 01:47:35,227 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-18 01:47:35,228 - WARNING - app - Found stale cache entry for user 4, will be refreshed on next access
2025-07-18 01:47:35,230 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-18 01:47:35,232 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-18 01:47:35,235 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-18 01:47:35,237 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-18 01:47:35,238 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-18 01:47:35,241 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-18 01:47:35,242 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-18 01:47:35,247 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-18 01:47:35,249 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-18 01:47:35,251 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-18 01:47:35,256 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-18 01:47:35,257 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-18 01:47:35,260 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-18 01:47:35,261 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-18 01:47:35,263 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-18 01:47:35,266 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-18 01:47:35,270 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-18 01:47:35,273 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-18 01:47:35,277 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-18 01:47:35,281 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-18 01:47:35,284 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-18 01:47:35,286 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-18 01:47:35,288 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-18 01:47:35,322 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-18 01:47:35,325 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-18 01:47:35,330 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-18 01:47:35,332 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-18 01:47:35,333 - INFO - app - Completed stale cache cleanup task
2025-07-18 01:47:53,577 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1024-001', 'takeprofit_id': '1026-006', 'user_id': '25', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'take_profit': '119589.1', 'action': 'add_takeprofit', 'timestamp': '2025-07-18T08:47:53.577406', 'contract_value': '1.00000000', 'order_quantity': '1', 'order_status': 'OPEN', 'status': 'TAKEPROFIT', 'account_type': 'live'}
2025-07-18 01:47:53,884 - INFO - app.core.firebase - Order data (ID: 1024-001) sent to Firebase successfully.
2025-07-18 01:47:59,365 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:47:59,366 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:47:59,366 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:47:59,371 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:47:59,372 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:47:59,372 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:47:59,529 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:47:59,530 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 4, falling back to DB and updating cache.
2025-07-18 01:47:59,926 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '0.0', 'equity': '-18531.62862085911046186780120', 'margin': '0.0', 'free_margin': '-18531.62862085911046186780120', 'profit_loss': '-18531.62862085911046186780120', 'margin_level': '0.0', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18531.62862085911046186780120', 'current_price': '96.782'}], 'margin_call': False}
2025-07-18 01:47:59,928 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 0.0
2025-07-18 01:47:59,928 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:47:59,928 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:47:59,933 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:47:59,933 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:47:59,946 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:47:59,948 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:47:59,948 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:48:00,081 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:48:00,087 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:48:00,438 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '-7469.892000000000000000000000', 'margin': '0.0', 'free_margin': '-7469.892000000000000000000000', 'profit_loss': '-7469.892000000000000000000000', 'margin_level': '0.0', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7469.892000000000000000000000', 'current_price': '118453.88'}], 'margin_call': False}
2025-07-18 01:48:00,441 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-18 01:48:00,441 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:48:00,441 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:48:00,481 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:00,481 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:48:00,501 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:00,501 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:48:00,519 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:00,519 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:48:00,589 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:48:00,953 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.729587877861082289770229154% which is below threshold 100.0%
2025-07-18 01:48:00,953 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '259.159902187157099677547476', 'margin': '9494.47', 'free_margin': '-9235.310097812842900322452524', 'profit_loss': '-9642.860097812842900322452524', 'margin_level': '2.729587877861082289770229154', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9620.730000000000000000000000', 'current_price': '118445.6'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-20.11827073894809120222956735', 'current_price': '96.813'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-2.011827073894809120222956735', 'current_price': '96.813'}], 'margin_call': True}
2025-07-18 01:48:00,955 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.729587877861082289770229154
2025-07-18 01:48:00,999 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:48:00,999 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:48:01,038 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:01,038 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:48:01,071 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:01,071 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:48:01,100 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:01,100 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:48:01,127 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:01,127 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:48:01,153 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:01,153 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:48:01,182 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:01,182 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:48:01,232 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:01,232 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:48:01,267 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:01,268 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:48:01,417 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:48:01,789 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356247.8600000000000000000000', 'margin': '59910.39', 'free_margin': '296337.4700000000000000000000', 'profit_loss': '106247.8600000000000000000000', 'margin_level': '594.6345199889368104597549774', 'positions': [{'order_id': '1024-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'swap': 'None', 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106247.8600000000000000000000', 'current_price': '118445.6'}], 'margin_call': False}
2025-07-18 01:48:01,797 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.6345199889368104597549774
2025-07-18 01:48:01,803 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:48:01,807 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:48:01,986 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:48:01,987 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-18 01:48:02,382 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-85678.94500000000000000000000', 'margin': '0.0', 'free_margin': '-85678.94500000000000000000000', 'profit_loss': '-85678.94500000000000000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-139.525000000000000000000000', 'current_price': '38.3095'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85539.42000000000000000000000', 'current_price': '118445.6'}], 'margin_call': False}
2025-07-18 01:48:02,384 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-18 01:48:02,385 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:48:02,385 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:48:02,507 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:48:02,508 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:48:02,511 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:48:02,893 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:48:02,897 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 0.0
2025-07-18 01:48:02,898 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:48:02,898 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:48:02,900 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:48:02,901 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:48:02,931 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:48:02,934 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:48:02,934 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:48:03,002 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:03,003 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:48:03,006 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:48:03,006 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:48:03,008 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:48:03,008 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:48:03,211 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:48:03,212 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:48:03,220 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:48:03,611 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:48:03,615 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-18 01:48:03,615 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:48:03,615 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:48:03,954 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:48:03,958 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:48:03,965 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:48:04,327 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:48:04,361 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:48:04,361 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:48:04,362 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:48:04,559 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:48:04,560 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:48:04,565 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:48:04,944 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:48:04,976 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:48:04,976 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:48:04,976 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:48:05,028 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:05,028 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:48:05,061 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:18,857 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-18 01:48:35,069 - INFO - app - [AUTO-CUTOFF] Starting update_all_users_dynamic_portfolio job...
2025-07-18 01:48:35,069 - INFO - app - [AUTO-CUTOFF] update_all_users_dynamic_portfolio heartbeat: task is alive and running.
2025-07-18 01:48:35,070 - INFO - app - [AUTO-CUTOFF] Fetching all active users (live and demo)...
2025-07-18 01:48:35,085 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-18 01:48:35,085 - INFO - app - [AUTO-CUTOFF] Processing 29 users for dynamic portfolio update...
2025-07-18 01:48:35,085 - INFO - app - [AUTO-CUTOFF] Processing user 4 (live), group: Group B
2025-07-18 01:48:35,388 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 4...
2025-07-18 01:48:35,394 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 4, falling back to DB and updating cache.
2025-07-18 01:48:35,765 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 4: {'balance': '0.0', 'equity': '-18553.06619810285514242050909', 'margin': '0.0', 'free_margin': '-18553.06619810285514242050909', 'profit_loss': '-18553.06619810285514242050909', 'margin_level': '0.0', 'positions': [{'order_id': '1016-005', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('10.00000000'), 'order_price': Decimal('99.52000000'), 'margin': Decimal('3249.77540855'), 'contract_value': Decimal('1000000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 4, 'order_status': 'OPEN', 'commission': Decimal('100.00000000'), 'swap': 'None', 'created_at': '2025-07-17T23:14:15', 'profit_loss': '-18553.06619810285514242050909', 'current_price': '96.779'}], 'margin_call': False}
2025-07-18 01:48:35,769 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 0.0
2025-07-18 01:48:35,769 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 4
2025-07-18 01:48:35,769 - INFO - app - [AUTO-CUTOFF] Processing user 5 (live), group: Admin
2025-07-18 01:48:35,777 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-18 01:48:35,777 - INFO - app - [AUTO-CUTOFF] Processing user 8 (live), group: string
2025-07-18 01:48:35,803 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:48:35,808 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-18 01:48:35,808 - INFO - app - [AUTO-CUTOFF] Processing user 9 (live), group: Standard
2025-07-18 01:48:36,220 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:48:36,224 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:48:36,584 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '-7474.680000000000000000000000', 'margin': '0.0', 'free_margin': '-7474.680000000000000000000000', 'profit_loss': '-7474.680000000000000000000000', 'margin_level': '0.0', 'positions': [{'order_id': '1000347-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.35000000'), 'order_price': Decimal('139205.60000000'), 'margin': Decimal('8271.68000000'), 'contract_value': Decimal('0.35000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 9, 'order_status': 'OPEN', 'commission': Decimal('206.79000000'), 'swap': 'None', 'created_at': '2025-07-17T04:29:22', 'profit_loss': '-7474.680000000000000000000000', 'current_price': '118440.2'}], 'margin_call': False}
2025-07-18 01:48:36,588 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-18 01:48:36,588 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:48:36,588 - INFO - app - [AUTO-CUTOFF] Processing user 10 (live), group: Group B
2025-07-18 01:48:36,662 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:36,662 - INFO - app - [AUTO-CUTOFF] Processing user 11 (live), group: Group B
2025-07-18 01:48:36,736 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:36,737 - INFO - app - [AUTO-CUTOFF] Processing user 13 (live), group: Group B
2025-07-18 01:48:36,802 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:36,803 - INFO - app - [AUTO-CUTOFF] Processing user 14 (live), group: Standard
2025-07-18 01:48:37,075 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 14...
2025-07-18 01:48:37,409 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.707608801369956594505273017% which is below threshold 100.0%
2025-07-18 01:48:37,410 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 14: {'balance': '9902.02000000', 'equity': '257.073105363430117878324795', 'margin': '9494.47', 'free_margin': '-9237.396894636569882121675205', 'profit_loss': '-9644.946894636569882121675205', 'margin_level': '2.707608801369956594505273017', 'positions': [{'order_id': '1000330-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.40000000'), 'order_price': Decimal('141908.50000000'), 'margin': Decimal('9422.73000000'), 'contract_value': Decimal('0.40000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('235.57000000'), 'created_at': '2025-07-15T23:00:09', 'profit_loss': '-9622.890000000000000000000000', 'current_price': '118440.2'}, {'order_id': '1000332-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.10000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('65.21517371'), 'contract_value': Decimal('10000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('1.00000000'), 'created_at': '2025-07-16T01:49:52', 'profit_loss': '-20.05172239688171101970473196', 'current_price': '96.814'}, {'order_id': '1000333-001', 'order_company_name': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('97.09700000'), 'margin': Decimal('6.52134765'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 14, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'created_at': '2025-07-16T01:51:54', 'profit_loss': '-2.005172239688171101970473196', 'current_price': '96.814'}], 'margin_call': True}
2025-07-18 01:48:37,414 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.707608801369956594505273017
2025-07-18 01:48:37,518 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 14
2025-07-18 01:48:37,519 - INFO - app - [AUTO-CUTOFF] Processing user 16 (live), group: Standard
2025-07-18 01:48:37,585 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:37,585 - INFO - app - [AUTO-CUTOFF] Processing user 17 (live), group: Group B
2025-07-18 01:48:37,623 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:37,623 - INFO - app - [AUTO-CUTOFF] Processing user 18 (live), group: Group B
2025-07-18 01:48:37,667 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:37,667 - INFO - app - [AUTO-CUTOFF] Processing user 19 (live), group: Elite
2025-07-18 01:48:37,702 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:37,702 - INFO - app - [AUTO-CUTOFF] Processing user 20 (live), group: Standard
2025-07-18 01:48:37,764 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:37,764 - INFO - app - [AUTO-CUTOFF] Processing user 21 (live), group: Group B
2025-07-18 01:48:37,830 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:37,831 - INFO - app - [AUTO-CUTOFF] Processing user 22 (live), group: VIP
2025-07-18 01:48:37,905 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:37,906 - INFO - app - [AUTO-CUTOFF] Processing user 23 (live), group: Group B
2025-07-18 01:48:37,983 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:37,983 - INFO - app - [AUTO-CUTOFF] Processing user 25 (live), group: Group B
2025-07-18 01:48:38,298 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 25...
2025-07-18 01:48:38,628 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 25: {'balance': '250000.00000000', 'equity': '356246.4600000000000000000000', 'margin': '59910.39', 'free_margin': '296336.0700000000000000000000', 'profit_loss': '106246.4600000000000000000000', 'margin_level': '594.6321831655577605153296448', 'positions': [{'order_id': '1024-001', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('1.00000000'), 'order_price': Decimal('11958.10000000'), 'margin': Decimal('59910.39000000'), 'contract_value': Decimal('1.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 25, 'order_status': 'OPEN', 'commission': Decimal('239.64000000'), 'created_at': '2025-07-18T00:22:11', 'profit_loss': '106246.4600000000000000000000', 'current_price': '118444.2'}], 'margin_call': False}
2025-07-18 01:48:38,663 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 594.6321831655577605153296448
2025-07-18 01:48:38,679 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 25
2025-07-18 01:48:38,682 - INFO - app - [AUTO-CUTOFF] Processing user 26 (live), group: Royal+
2025-07-18 01:48:38,887 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 26...
2025-07-18 01:48:38,891 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-18 01:48:39,247 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 26: {'balance': '0.0', 'equity': '-85687.54500000000025000000000', 'margin': '0.0', 'free_margin': '-85687.54500000000025000000000', 'profit_loss': '-85687.54500000000025000000000', 'margin_level': '0.0', 'positions': [{'order_id': Decimal('7987141755'), 'order_company_name': 'XAGUSD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('41.09800000'), 'margin': Decimal('19.54000000'), 'contract_value': Decimal('50.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('0.10000000'), 'swap': Decimal('-0.00283800'), 'created_at': '2025-07-14T03:43:34', 'profit_loss': '-139.7250000000002500000000000', 'current_price': '38.305499999999995'}, {'order_id': Decimal('1116628265'), 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': Decimal('6.00000000'), 'order_price': Decimal('132091.90000000'), 'margin': Decimal('146464.93000000'), 'contract_value': Decimal('6.00000000'), 'stop_loss': None, 'take_profit': None, 'order_user_id': 26, 'order_status': 'OPEN', 'commission': Decimal('3661.62000000'), 'swap': Decimal('-9621.57600000'), 'created_at': '2025-07-14T03:46:06', 'profit_loss': '-85547.82000000000000000000000', 'current_price': '118444.2'}], 'margin_call': False}
2025-07-18 01:48:39,250 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-18 01:48:39,250 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 26
2025-07-18 01:48:39,250 - INFO - app - [AUTO-CUTOFF] Processing user 1 (demo), group: Group B
2025-07-18 01:48:39,448 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 1...
2025-07-18 01:48:39,449 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:48:39,455 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 1, falling back to DB and updating cache.
2025-07-18 01:48:39,771 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 1: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:48:39,777 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 0.0
2025-07-18 01:48:39,777 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 1
2025-07-18 01:48:39,777 - INFO - app - [AUTO-CUTOFF] Processing user 2 (demo), group: 
2025-07-18 01:48:39,780 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-18 01:48:39,781 - INFO - app - [AUTO-CUTOFF] Processing user 3 (demo), group: string
2025-07-18 01:48:39,803 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-18 01:48:39,805 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-18 01:48:39,806 - INFO - app - [AUTO-CUTOFF] Processing user 4 (demo), group: Group B
2025-07-18 01:48:39,851 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:39,851 - INFO - app - [AUTO-CUTOFF] Processing user 5 (demo), group: None
2025-07-18 01:48:39,855 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-18 01:48:39,855 - INFO - app - [AUTO-CUTOFF] Processing user 6 (demo), group: None
2025-07-18 01:48:39,858 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-18 01:48:39,858 - INFO - app - [AUTO-CUTOFF] Processing user 9 (demo), group: Group B
2025-07-18 01:48:40,161 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 9...
2025-07-18 01:48:40,163 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:48:40,168 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-18 01:48:40,480 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 9: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:48:40,482 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-18 01:48:40,482 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 9
2025-07-18 01:48:40,483 - INFO - app - [AUTO-CUTOFF] Processing user 10 (demo), group: Group B
2025-07-18 01:48:40,601 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 10...
2025-07-18 01:48:40,602 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:48:40,606 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-18 01:48:40,941 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 10: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:48:40,975 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-18 01:48:40,976 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 10
2025-07-18 01:48:40,976 - INFO - app - [AUTO-CUTOFF] Processing user 11 (demo), group: Group B
2025-07-18 01:48:41,231 - INFO - app - [AUTO-CUTOFF] Calculating portfolio metrics for user 11...
2025-07-18 01:48:41,232 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:48:41,236 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-18 01:48:41,602 - INFO - app - [AUTO-CUTOFF] Portfolio metrics for user 11: {'balance': '0.0', 'equity': '0.0', 'margin': '0.0', 'free_margin': '0.0', 'profit_loss': '0.0', 'margin_level': '0.0', 'positions': [], 'margin_call': False}
2025-07-18 01:48:41,605 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-18 01:48:41,605 - INFO - app - [AUTO-CUTOFF] Portfolio update completed for user 11
2025-07-18 01:48:41,605 - INFO - app - [AUTO-CUTOFF] Processing user 12 (demo), group: Group B
2025-07-18 01:48:41,665 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:41,665 - INFO - app - [AUTO-CUTOFF] Processing user 13 (demo), group: Group B
2025-07-18 01:48:41,724 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-18 01:48:51,582 - INFO - app - Application shutdown initiated
2025-07-18 01:48:51,582 - INFO - app - Scheduler shutdown completed
2025-07-18 01:48:51,584 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-18 01:48:52,159 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-18 01:48:52,159 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-18 01:48:52,424 - INFO - app - Redis connection closed
2025-07-18 01:48:52,424 - INFO - app - Application shutdown completed
