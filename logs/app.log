2025-07-23 23:21:55,938 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:21:55,962 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:21:55,978 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:21:55,978 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:21:56,257 - INFO - app - Application starting up - Trading system initialized
2025-07-23 23:21:56,257 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-23 23:21:56,257 - INFO - app - Environment: PRODUCTION
2025-07-23 23:21:56,328 - INFO - app - Application startup initiated
2025-07-23 23:21:56,328 - INFO - app - Initializing core services...
2025-07-23 23:21:56,367 - INFO - app - Firebase initialized
2025-07-23 23:21:56,367 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-23 23:21:56,384 - INFO - app - Redis initialized
2025-07-23 23:21:58,545 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-23 23:21:58,549 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-23 23:21:58,551 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-23 23:21:58,552 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-23 23:21:58,552 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-23 23:21:58,552 - INFO - app - Scheduler initialized
2025-07-23 23:21:58,554 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:21:58,555 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-23 23:21:59,467 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:21:59,469 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:21:59,514 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-23 23:21:59,514 - INFO - app - Background tasks initialized
2025-07-23 23:21:59,514 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-23 23:22:00,156 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-23 23:22:00,156 - INFO - app - Application startup completed successfully
2025-07-23 23:22:00,157 - INFO - app - Starting cache validation task
2025-07-23 23:22:00,162 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-23 23:22:00,173 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-23 23:22:00,181 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:22:00,199 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:22:00,200 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:22:00,202 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:22:00,204 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:22:00,206 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:22:00,207 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:22:00,210 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:22:00,213 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:22:00,215 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:22:00,220 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:22:00,223 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:22:00,259 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:22:00,262 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:22:00,263 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:22:00,265 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:22:00,267 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:22:00,268 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:22:00,268 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:22:00,269 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:22:00,270 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:22:00,272 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:22:00,431 - INFO - app - Validating cache for 37 users
2025-07-23 23:22:00,449 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:22:00,652 - INFO - app - Cache validation completed
2025-07-23 23:22:01,181 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 403.5681667757148781688995599
2025-07-23 23:22:01,290 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:22:01,307 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:22:01,379 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:22:01,486 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:02,172 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:22:02,871 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:22:02,879 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:22:02,891 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:22:02,919 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.36916496711961819078797329% which is below threshold 100.0%
2025-07-23 23:22:02,923 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.36916496711961819078797329
2025-07-23 23:22:02,930 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:22:02,945 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:22:02,975 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:22:02,996 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:22:03,078 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:03,185 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:22:03,188 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:22:03,212 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:22:03,212 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:22:03,213 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:22:03,213 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:22:03,218 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:22:03,237 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:22:03,237 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:22:03,272 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:22:03,277 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:22:03,280 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:22:03,294 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:22:03,294 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:22:03,294 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:22:03,295 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:22:03,295 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:22:03,298 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:22:03,298 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:22:03,305 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:22:03,305 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:22:03,648 - INFO - app - [AUTO-CUTOFF] User 13 margin_level: 296.3152507676560900716479017
2025-07-23 23:22:03,741 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:03,837 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:03,967 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:04,072 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:04,178 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:04,637 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:22:04,734 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:05,374 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:22:05,485 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:05,580 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:05,679 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:05,780 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:06,300 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34215.58843953732169264870545
2025-07-23 23:22:06,899 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:22:06,908 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:22:06,908 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 88.87414584689949636907656674% which is below threshold 100.0%
2025-07-23 23:22:06,909 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 88.87414584689949636907656674
2025-07-23 23:22:07,187 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:07,305 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:07,430 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:07,567 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:07,569 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:22:07,584 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:22:07,620 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:22:07,742 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:07,745 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:22:07,747 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:22:07,945 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:22:08,636 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:22:08,886 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:22:09,180 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:22:09,288 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:09,398 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:09,497 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:22:09,738 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:22:10,032 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:22:15,159 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:22:15,162 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:22:15,164 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:22:15,166 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:22:15,171 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:22:15,172 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:22:15,174 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:22:15,175 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:22:15,176 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:22:15,177 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:22:15,180 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:22:15,181 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:22:15,188 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:22:15,192 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:22:15,193 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:22:15,194 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:22:15,197 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:22:15,198 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:22:15,199 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:22:15,199 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:22:15,200 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:22:15,201 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:22:31,475 - INFO - app - Application shutdown initiated
2025-07-23 23:22:31,477 - INFO - app - Scheduler shutdown completed
2025-07-23 23:22:31,477 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-23 23:22:31,640 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-23 23:22:31,641 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-23 23:22:32,590 - INFO - app - Redis connection closed
2025-07-23 23:22:32,591 - INFO - app - Application shutdown completed
2025-07-23 23:34:33,206 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:34:33,229 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:34:33,240 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:34:33,240 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:34:33,555 - INFO - app - Application starting up - Trading system initialized
2025-07-23 23:34:33,555 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-23 23:34:33,556 - INFO - app - Environment: PRODUCTION
2025-07-23 23:34:33,628 - INFO - app - Application startup initiated
2025-07-23 23:34:33,628 - INFO - app - Initializing core services...
2025-07-23 23:34:33,664 - INFO - app - Firebase initialized
2025-07-23 23:34:33,664 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-23 23:34:33,681 - INFO - app - Redis initialized
2025-07-23 23:34:35,830 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-23 23:34:35,837 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-23 23:34:35,839 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-23 23:34:35,839 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-23 23:34:35,840 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-23 23:34:35,840 - INFO - app - Scheduler initialized
2025-07-23 23:34:35,842 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:34:35,843 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-23 23:34:36,890 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:34:36,908 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:34:36,940 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-23 23:34:36,940 - INFO - app - Background tasks initialized
2025-07-23 23:34:36,940 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-23 23:34:37,527 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-23 23:34:37,527 - INFO - app - Application startup completed successfully
2025-07-23 23:34:37,527 - INFO - app - Starting cache validation task
2025-07-23 23:34:37,537 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-23 23:34:37,543 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-23 23:34:37,546 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:34:37,558 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:34:37,559 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:34:37,560 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:34:37,561 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:34:37,562 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:34:37,562 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:34:37,563 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:34:37,566 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:34:37,568 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:34:37,570 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:34:37,571 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:34:37,580 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:34:37,582 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:34:37,582 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:34:37,583 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:34:37,583 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:34:37,584 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:34:37,584 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:34:37,585 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:34:37,587 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:34:37,590 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:34:37,757 - INFO - app - Validating cache for 37 users
2025-07-23 23:34:37,759 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:34:37,760 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-23 23:34:37,843 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-23 23:34:37,877 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-23 23:34:37,964 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,045 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,375 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 403.8514458689983991035329955
2025-07-23 23:34:38,375 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,456 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,476 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:34:38,488 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:34:38,530 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,554 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:34:38,609 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,666 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:38,682 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,757 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,832 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,910 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-23 23:34:38,987 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-23 23:34:39,353 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:34:39,390 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-23 23:34:39,470 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-23 23:34:39,550 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-23 23:34:39,626 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-23 23:34:39,849 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:34:39,874 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:34:39,887 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:34:39,890 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:34:39,919 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.35928833017743227560257808% which is below threshold 100.0%
2025-07-23 23:34:39,923 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.35928833017743227560257808
2025-07-23 23:34:39,960 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:34:39,960 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:34:40,006 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,007 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:34:40,066 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:40,091 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,167 - WARNING - app - User 27: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,172 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:40,251 - WARNING - app - User 28: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,280 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:40,283 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:34:40,284 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:34:40,323 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:34:40,324 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:34:40,325 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:34:40,329 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:34:40,330 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:34:40,336 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:34:40,338 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,340 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:34:40,341 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:34:40,351 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:34:40,351 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:34:40,358 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:34:40,358 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:34:40,359 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:34:40,359 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:34:40,360 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:34:40,360 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:34:40,393 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:34:40,403 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:34:40,404 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:34:40,409 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:40,415 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,484 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,501 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:40,553 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,583 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:40,625 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,671 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:40,692 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,770 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-23 23:34:40,845 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-23 23:34:41,169 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:34:41,213 - INFO - app - Cache validation completed
2025-07-23 23:34:41,263 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:41,700 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:34:41,793 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:41,889 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:41,980 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:42,063 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:42,536 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34215.82049350250704100948028
2025-07-23 23:34:43,054 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:34:43,055 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:34:43,056 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 89.83850427385652700731130326% which is below threshold 100.0%
2025-07-23 23:34:43,057 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 89.83850427385652700731130326
2025-07-23 23:34:43,159 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:43,270 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:43,378 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:43,490 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:43,491 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:34:43,511 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:34:43,545 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:34:43,655 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:43,657 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:34:43,658 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:34:43,880 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:34:44,687 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:34:45,046 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:34:45,338 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:34:45,437 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:45,560 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:45,672 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:34:45,888 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:34:46,183 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:34:52,532 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:34:52,534 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:34:52,535 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:34:52,536 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:34:52,538 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:34:52,539 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:34:52,542 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:34:52,544 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:34:52,546 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:34:52,547 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:34:52,553 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:34:52,554 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:34:52,558 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:34:52,561 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:34:52,562 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:34:52,563 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:34:52,564 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:34:52,565 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:34:52,567 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:34:52,570 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:34:52,571 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:34:52,573 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:35:16,261 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:35:16,401 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:35:16,809 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 401.6987845797234355337422448
2025-07-23 23:35:16,903 - INFO - app - Application shutdown initiated
2025-07-23 23:35:16,904 - INFO - app - Scheduler shutdown completed
2025-07-23 23:35:16,904 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-23 23:35:17,107 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-23 23:35:17,107 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-23 23:35:17,109 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:35:17,185 - INFO - app - Redis connection closed
2025-07-23 23:35:17,185 - INFO - app - Application shutdown completed
2025-07-23 23:35:18,931 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:35:18,959 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:35:18,978 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:35:18,978 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:35:19,249 - INFO - app - Application starting up - Trading system initialized
2025-07-23 23:35:19,249 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-23 23:35:19,249 - INFO - app - Environment: PRODUCTION
2025-07-23 23:35:19,340 - INFO - app - Application startup initiated
2025-07-23 23:35:19,340 - INFO - app - Initializing core services...
2025-07-23 23:35:19,386 - INFO - app - Firebase initialized
2025-07-23 23:35:19,386 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-23 23:35:19,402 - INFO - app - Redis initialized
2025-07-23 23:35:21,163 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-23 23:35:21,167 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-23 23:35:21,169 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-23 23:35:21,170 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-23 23:35:21,170 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-23 23:35:21,170 - INFO - app - Scheduler initialized
2025-07-23 23:35:21,172 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:35:21,172 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-23 23:35:21,974 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:35:21,977 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:35:22,009 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-23 23:35:22,009 - INFO - app - Background tasks initialized
2025-07-23 23:35:22,010 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-23 23:35:22,609 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-23 23:35:22,609 - INFO - app - Application startup completed successfully
2025-07-23 23:35:22,610 - INFO - app - Starting cache validation task
2025-07-23 23:35:22,615 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-23 23:35:22,619 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-23 23:35:22,623 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:35:22,662 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:35:22,665 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:35:22,668 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:35:22,674 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:35:22,675 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:35:22,676 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:35:22,678 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:35:22,680 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:35:22,681 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:35:22,685 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:35:22,687 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:35:22,693 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:35:22,699 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:35:22,700 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:35:22,700 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:35:22,701 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:35:22,701 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:35:22,702 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:35:22,702 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:35:22,703 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:35:22,705 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:35:22,862 - INFO - app - Validating cache for 37 users
2025-07-23 23:35:22,878 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:35:22,947 - INFO - app - Cache validation completed
2025-07-23 23:35:23,407 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 401.6987038060543265950926251
2025-07-23 23:35:23,525 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:35:23,543 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:35:23,618 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:35:23,741 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:24,240 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:35:24,451 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:35:24,486 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:35:24,502 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:35:24,586 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:35:24,605 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:35:24,627 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:35:24,683 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:35:24,869 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.36153991124179147693035816% which is below threshold 100.0%
2025-07-23 23:35:24,876 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.36153991124179147693035816
2025-07-23 23:35:24,888 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:35:24,901 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:35:24,907 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:35:24,913 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:35:24,913 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:35:24,919 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:35:24,919 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:35:24,934 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:35:24,934 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:35:24,935 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:35:24,952 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:35:24,953 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:35:24,962 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:35:24,963 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:35:24,974 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:35:24,974 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:35:24,975 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:35:24,975 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:35:25,000 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:35:25,010 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:35:25,010 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:35:25,030 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:25,143 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:25,254 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:25,347 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:25,453 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:25,556 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:25,664 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:26,097 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:35:26,199 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:26,664 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:35:26,789 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:26,893 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:27,001 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:27,117 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:27,674 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34215.44775780858118766878751
2025-07-23 23:35:28,169 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:35:28,174 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:35:28,175 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 89.82597532126047857301824117% which is below threshold 100.0%
2025-07-23 23:35:28,178 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 89.82597532126047857301824117
2025-07-23 23:35:28,332 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:28,437 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:28,563 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:28,704 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:28,707 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:35:28,734 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:35:28,775 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:35:29,085 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:29,086 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:35:29,087 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:35:29,306 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:35:30,139 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:35:30,327 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:35:30,623 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:35:30,771 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:30,890 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:31,136 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:35:31,408 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:35:31,717 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:35:37,623 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:35:37,626 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:35:37,628 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:35:37,629 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:35:37,632 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:35:37,634 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:35:37,636 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:35:37,637 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:35:37,638 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:35:37,640 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:35:37,642 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:35:37,642 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:35:37,646 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:35:37,649 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:35:37,650 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:35:37,651 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:35:37,653 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:35:37,654 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:35:37,655 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:35:37,656 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:35:37,657 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:35:37,659 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:36:00,136 - INFO - app - Application shutdown initiated
2025-07-23 23:36:00,137 - INFO - app - Scheduler shutdown completed
2025-07-23 23:36:00,137 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-23 23:36:01,147 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-23 23:36:01,147 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-23 23:36:01,164 - INFO - app - Redis connection closed
2025-07-23 23:36:01,164 - INFO - app - Application shutdown completed
2025-07-23 23:36:17,995 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:36:18,043 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:36:18,055 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:36:18,055 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:36:18,443 - INFO - app - Application starting up - Trading system initialized
2025-07-23 23:36:18,443 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-23 23:36:18,443 - INFO - app - Environment: PRODUCTION
2025-07-23 23:36:18,509 - INFO - app - Application startup initiated
2025-07-23 23:36:18,510 - INFO - app - Initializing core services...
2025-07-23 23:36:18,554 - INFO - app - Firebase initialized
2025-07-23 23:36:18,554 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-23 23:36:18,580 - INFO - app - Redis initialized
2025-07-23 23:36:20,031 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-23 23:36:20,037 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-23 23:36:20,040 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-23 23:36:20,040 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-23 23:36:20,041 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-23 23:36:20,041 - INFO - app - Scheduler initialized
2025-07-23 23:36:20,044 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:36:20,045 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-23 23:36:20,970 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:36:20,971 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:36:20,997 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-23 23:36:20,997 - INFO - app - Background tasks initialized
2025-07-23 23:36:20,997 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-23 23:36:21,594 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-23 23:36:21,594 - INFO - app - Application startup completed successfully
2025-07-23 23:36:21,595 - INFO - app - Starting cache validation task
2025-07-23 23:36:21,601 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-23 23:36:21,606 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-23 23:36:21,610 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:36:21,623 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:36:21,623 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:36:21,624 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:36:21,626 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:36:21,627 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:36:21,629 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:36:21,631 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:36:21,633 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:36:21,634 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:36:21,636 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:36:21,637 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:36:21,649 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:36:21,660 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:36:21,661 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:36:21,664 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:36:21,666 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:36:21,666 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:36:21,667 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:36:21,668 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:36:21,668 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:36:21,670 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:36:21,844 - INFO - app - Validating cache for 37 users
2025-07-23 23:36:21,847 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:36:22,107 - INFO - app - Cache validation completed
2025-07-23 23:36:22,988 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 401.7339599832116830951860771
2025-07-23 23:36:23,097 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:36:23,119 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:36:23,188 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:36:23,306 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:23,866 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:36:24,481 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:36:24,489 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.36078131708154131779584321% which is below threshold 100.0%
2025-07-23 23:36:24,491 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.36078131708154131779584321
2025-07-23 23:36:24,509 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:36:24,533 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:36:24,581 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:36:24,614 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:36:24,635 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:36:24,637 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:36:24,695 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:24,814 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:24,831 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:36:24,852 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:36:24,852 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:36:24,858 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:36:24,882 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:36:24,882 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:36:24,882 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:36:24,905 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:36:24,905 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:36:24,913 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:36:24,934 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:36:24,934 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:36:24,937 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:36:24,954 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:36:24,961 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:36:24,961 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:36:24,975 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:36:24,975 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:36:24,979 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:36:24,994 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:24,998 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:36:24,998 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:36:25,095 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:25,200 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:25,297 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:25,408 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:25,878 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:36:25,987 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:26,440 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:36:26,564 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:26,661 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:26,869 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:26,989 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:27,526 - ERROR - app - Error in barclays_pending_order_margin_checker loop: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3297, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 713, in checkout
    rec = pool._do_get()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 179, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 675, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 901, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 270, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 75, in _connect
    await conn._connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 540, in _connect
    await self._request_authentication()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 844, in _request_authentication
    auth_packet = await self._read_packet()
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\main.py", line 1467, in barclays_pending_order_margin_checker
    live_users = await crud_user.get_all_users_with_pending_orders(db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\user.py", line 473, in get_all_users_with_pending_orders
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3273, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 147, in __init__
    Connection._handle_dbapi_exception_noconnection(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        err, dialect, engine
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2436, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3297, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 713, in checkout
    rec = pool._do_get()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 179, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 675, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 901, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 270, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 75, in _connect
    await conn._connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 540, in _connect
    await self._request_authentication()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 844, in _request_authentication
    auth_packet = await self._read_packet()
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-23 23:36:27,588 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34213.44585784080543072523463
2025-07-23 23:36:28,077 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:36:28,078 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:36:28,079 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 89.80466785911522515022379017% which is below threshold 100.0%
2025-07-23 23:36:28,080 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 89.80466785911522515022379017
2025-07-23 23:36:28,182 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:28,321 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:28,429 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:28,565 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:28,566 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:36:28,576 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:36:28,632 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:36:28,811 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:28,814 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:36:28,817 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:36:29,165 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:36:30,142 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:36:30,497 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:36:30,797 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:36:30,919 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:31,023 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:31,131 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:36:31,313 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:36:31,620 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:36:36,597 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:36:36,601 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:36:36,603 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:36:36,606 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:36:36,609 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:36:36,610 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:36:36,611 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:36:36,611 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:36:36,612 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:36:36,614 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:36:36,615 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:36:36,616 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:36:36,620 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:36:36,622 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:36:36,623 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:36:36,624 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:36:36,625 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:36:36,626 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:36:36,627 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:36:36,629 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:36:36,631 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:36:36,633 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:37:01,691 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:37:01,788 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:37:02,266 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 401.6988653511834947686537990
2025-07-23 23:37:02,374 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:37:02,384 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:37:02,447 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:37:02,566 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:03,032 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:37:03,484 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.36611358533478782809699170% which is below threshold 100.0%
2025-07-23 23:37:03,486 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.36611358533478782809699170
2025-07-23 23:37:03,575 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:03,662 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:03,741 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:03,832 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:03,914 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:03,993 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:04,073 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:04,538 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:37:04,654 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:05,134 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:37:05,266 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:05,350 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:05,434 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:05,517 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:05,997 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34214.84310083998133009467915
2025-07-23 23:37:06,560 - ERROR - app - Error in barclays_pending_order_margin_checker loop: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3297, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 713, in checkout
    rec = pool._do_get()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 179, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 675, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 901, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 270, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 75, in _connect
    await conn._connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 540, in _connect
    await self._request_authentication()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 844, in _request_authentication
    auth_packet = await self._read_packet()
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\main.py", line 1467, in barclays_pending_order_margin_checker
    live_users = await crud_user.get_all_users_with_pending_orders(db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\user.py", line 473, in get_all_users_with_pending_orders
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3273, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 147, in __init__
    Connection._handle_dbapi_exception_noconnection(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        err, dialect, engine
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2436, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3297, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 713, in checkout
    rec = pool._do_get()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 179, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 675, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 901, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 270, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 75, in _connect
    await conn._connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 540, in _connect
    await self._request_authentication()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 844, in _request_authentication
    auth_packet = await self._read_packet()
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-23 23:37:06,565 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:37:06,566 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:37:06,567 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 89.82119453671724956519588853% which is below threshold 100.0%
2025-07-23 23:37:06,568 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 89.82119453671724956519588853
2025-07-23 23:37:06,651 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:06,729 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:06,822 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:06,912 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:06,914 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:37:06,923 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:37:06,950 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:37:07,044 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:07,046 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:37:07,047 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:37:07,262 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:37:07,557 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:37:07,710 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:37:08,093 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:37:08,186 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:08,270 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:08,364 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:08,546 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:37:08,848 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:37:37,408 - INFO - app - Application shutdown initiated
2025-07-23 23:37:37,408 - INFO - app - Scheduler shutdown completed
2025-07-23 23:37:37,409 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-23 23:37:38,521 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-23 23:37:38,521 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-23 23:37:38,528 - INFO - app - Redis connection closed
2025-07-23 23:37:38,528 - INFO - app - Application shutdown completed
2025-07-23 23:37:40,365 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:37:40,392 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:37:40,407 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:37:40,408 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:37:40,673 - INFO - app - Application starting up - Trading system initialized
2025-07-23 23:37:40,673 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-23 23:37:40,673 - INFO - app - Environment: PRODUCTION
2025-07-23 23:37:40,730 - INFO - app - Application startup initiated
2025-07-23 23:37:40,730 - INFO - app - Initializing core services...
2025-07-23 23:37:40,765 - INFO - app - Firebase initialized
2025-07-23 23:37:40,765 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-23 23:37:40,798 - INFO - app - Redis initialized
2025-07-23 23:37:43,410 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-23 23:37:43,418 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-23 23:37:43,420 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-23 23:37:43,420 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-23 23:37:43,421 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-23 23:37:43,422 - INFO - app - Scheduler initialized
2025-07-23 23:37:43,425 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:37:43,426 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-23 23:37:44,385 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:37:44,402 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:37:44,432 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-23 23:37:44,432 - INFO - app - Background tasks initialized
2025-07-23 23:37:44,432 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-23 23:37:45,051 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-23 23:37:45,051 - INFO - app - Application startup completed successfully
2025-07-23 23:37:45,052 - INFO - app - Starting cache validation task
2025-07-23 23:37:45,058 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-23 23:37:45,067 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-23 23:37:45,076 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:37:45,108 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:37:45,110 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:37:45,121 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:37:45,129 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:37:45,132 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:37:45,140 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:37:45,144 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:37:45,145 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:37:45,147 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:37:45,151 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:37:45,156 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:37:45,162 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:37:45,165 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:37:45,166 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:37:45,167 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:37:45,169 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:37:45,170 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:37:45,171 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:37:45,174 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:37:45,174 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:37:45,176 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:37:45,325 - INFO - app - Validating cache for 37 users
2025-07-23 23:37:45,394 - INFO - app - Cache validation completed
2025-07-23 23:37:45,406 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:37:45,973 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 401.7447637600297236444300327
2025-07-23 23:37:46,071 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:37:46,089 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:37:46,146 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:37:46,253 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:46,812 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:37:47,326 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.36612336218120734950823565% which is below threshold 100.0%
2025-07-23 23:37:47,327 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.36612336218120734950823565
2025-07-23 23:37:47,438 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:47,546 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:47,580 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:37:47,624 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:37:47,639 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:37:47,670 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:47,694 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:37:47,747 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:37:47,758 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:37:47,762 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:37:47,825 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:47,930 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:48,037 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:37:48,038 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:37:48,061 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:37:48,068 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:37:48,068 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:37:48,070 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:37:48,071 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:37:48,079 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:48,108 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:37:48,108 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:37:48,118 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:37:48,120 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:37:48,128 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:37:48,130 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:37:48,136 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:37:48,137 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:37:48,140 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:37:48,140 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:37:48,144 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:37:48,144 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:37:48,146 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:37:48,146 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:37:48,194 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:48,617 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:37:48,694 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:49,210 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:37:49,279 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:49,349 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:49,416 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:49,485 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:49,913 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34215.83334980567130993011192
2025-07-23 23:37:50,345 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:37:50,379 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:37:50,379 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 89.43947361913632654406976648% which is below threshold 100.0%
2025-07-23 23:37:50,385 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 89.43947361913632654406976648
2025-07-23 23:37:50,465 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:50,560 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:50,660 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:50,747 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:50,748 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:37:50,755 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:37:50,783 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:37:50,857 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:50,861 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:37:50,865 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:37:51,151 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:37:51,996 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:37:52,237 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:37:52,525 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:37:52,677 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:52,775 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:52,887 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:37:53,119 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:37:53,423 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:38:00,058 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:38:00,061 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:38:00,062 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:38:00,063 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:38:00,066 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:38:00,068 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:38:00,069 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:38:00,071 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:38:00,072 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:38:00,074 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:38:00,078 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:38:00,079 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:38:00,087 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:38:00,095 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:38:00,096 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:38:00,098 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:38:00,101 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:38:00,102 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:38:00,104 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:38:00,106 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:38:00,108 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:38:00,112 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:38:23,485 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:38:23,634 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:38:24,123 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 401.7550508827743475445095802
2025-07-23 23:38:24,245 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:38:24,257 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:38:24,321 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:38:24,419 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:24,878 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:38:25,419 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.37753294280170212191634547% which is below threshold 100.0%
2025-07-23 23:38:25,421 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.37753294280170212191634547
2025-07-23 23:38:25,567 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:25,659 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:25,773 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:25,878 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:26,003 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:26,152 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:26,274 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:26,870 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:38:26,959 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:27,427 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:38:27,540 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:27,639 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:27,731 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:27,822 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:28,297 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34216.03939897540744827829463
2025-07-23 23:38:29,150 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:38:29,154 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:38:29,155 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 89.31055729110856502279115390% which is below threshold 100.0%
2025-07-23 23:38:29,157 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 89.31055729110856502279115390
2025-07-23 23:38:29,278 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:29,389 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:29,472 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:29,584 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:29,585 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:38:29,594 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:38:29,626 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:38:29,721 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:29,723 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:38:29,724 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:38:29,877 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:38:30,176 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:38:30,329 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:38:30,619 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:38:30,710 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:30,825 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:30,930 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:38:31,103 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:38:31,389 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:39:01,457 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:39:01,590 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:39:02,093 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 401.7201019119130574966979735
2025-07-23 23:39:02,198 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:39:02,229 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:39:02,295 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:39:02,422 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:02,962 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:39:03,488 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.37905757848315276236490345% which is below threshold 100.0%
2025-07-23 23:39:03,490 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.37905757848315276236490345
2025-07-23 23:39:03,571 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:03,653 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:03,739 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:03,841 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:03,952 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:04,075 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:04,216 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:04,879 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:39:04,961 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:05,422 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:39:05,510 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:05,596 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:05,688 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:05,775 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:06,204 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34216.31690461716430449331369
2025-07-23 23:39:06,655 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:39:06,665 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:39:06,666 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 89.13741870605593517915577939% which is below threshold 100.0%
2025-07-23 23:39:06,667 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 89.13741870605593517915577939
2025-07-23 23:39:06,752 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:06,841 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:06,955 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:07,046 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:07,048 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:39:07,062 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:39:07,095 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:39:07,183 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:07,185 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:39:07,187 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:39:07,360 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:39:07,850 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:39:07,979 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:39:08,278 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:39:08,366 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:08,468 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:08,597 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:08,728 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:39:09,015 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:39:39,083 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:39:39,198 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:39:39,379 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 4, falling back to DB and updating cache.
2025-07-23 23:39:39,682 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 0.0
2025-07-23 23:39:39,775 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:39:39,783 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:39:39,810 - INFO - app - [BarclaysMarginChecker] Considering cancellation: user 4, order 1002003-001, order_margin=6.61665196, free_margin=-3.6656444319790946, total_pending_margin=6.61665196
2025-07-23 23:39:39,841 - WARNING - app - [BarclaysMarginChecker] Cancelling order 1002003-001 for user 4 (order_margin=6.61665196) due to insufficient margin.
2025-07-23 23:39:39,844 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:39:39,932 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:40,078 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:39:40,393 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-23 23:39:40,896 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-23 23:39:41,189 - INFO - app - [BarclaysMarginChecker] Created rejected order record: order_id=1002003-001, rejected_id=1002012-002
2025-07-23 23:39:41,196 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-23 23:39:41,305 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:41,388 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:41,478 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:41,484 - INFO - app - [BarclaysMarginChecker] Successfully cancelled order 1002003-001 for user 4
2025-07-23 23:39:41,566 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:41,672 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:41,763 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:39:42,160 - INFO - app - Application shutdown initiated
2025-07-23 23:39:42,160 - INFO - app - Scheduler shutdown completed
2025-07-23 23:39:42,161 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-23 23:39:43,944 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-23 23:39:43,944 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-23 23:39:44,024 - INFO - app - Redis connection closed
2025-07-23 23:39:44,024 - INFO - app - Application shutdown completed
2025-07-23 23:44:25,990 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:44:26,016 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:44:26,031 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:44:26,031 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:44:26,287 - INFO - app - Application starting up - Trading system initialized
2025-07-23 23:44:26,287 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-23 23:44:26,287 - INFO - app - Environment: PRODUCTION
2025-07-23 23:44:26,337 - INFO - app - Application startup initiated
2025-07-23 23:44:26,337 - INFO - app - Initializing core services...
2025-07-23 23:44:26,376 - INFO - app - Firebase initialized
2025-07-23 23:44:26,376 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-23 23:44:26,419 - INFO - app - Redis initialized
2025-07-23 23:44:28,448 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-23 23:44:28,456 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-23 23:44:28,459 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-23 23:44:28,460 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-23 23:44:28,461 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-23 23:44:28,461 - INFO - app - Scheduler initialized
2025-07-23 23:44:28,463 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:44:28,464 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-23 23:44:29,489 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:44:29,502 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:44:29,530 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-23 23:44:29,530 - INFO - app - Background tasks initialized
2025-07-23 23:44:29,530 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-23 23:44:30,138 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-23 23:44:30,139 - INFO - app - Application startup completed successfully
2025-07-23 23:44:30,140 - INFO - app - Starting cache validation task
2025-07-23 23:44:30,144 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-23 23:44:30,150 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-23 23:44:30,155 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:44:30,172 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:44:30,174 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:44:30,175 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:44:30,177 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:44:30,178 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:44:30,179 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:44:30,181 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:44:30,187 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:44:30,189 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:44:30,197 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:44:30,211 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:44:30,236 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:44:30,242 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:44:30,243 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:44:30,245 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:44:30,246 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:44:30,247 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:44:30,249 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:44:30,253 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:44:30,257 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:44:30,260 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:44:30,389 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:44:30,454 - INFO - app - Validating cache for 37 users
2025-07-23 23:44:30,468 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-23 23:44:30,530 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-23 23:44:30,630 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-23 23:44:30,762 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-23 23:44:30,871 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-23 23:44:31,228 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 401.3175144903445359670334203
2025-07-23 23:44:31,276 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-23 23:44:31,358 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:44:31,372 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:44:31,408 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-23 23:44:31,458 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:44:31,524 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-23 23:44:31,573 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:31,613 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-23 23:44:31,764 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-23 23:44:31,866 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-23 23:44:31,967 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-23 23:44:32,262 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:44:32,307 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-23 23:44:32,340 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:44:32,349 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:44:32,350 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:44:32,357 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:44:32,406 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-23 23:44:32,405 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:44:32,409 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:44:32,448 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:44:32,501 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-23 23:44:32,606 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-23 23:44:32,689 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:44:32,703 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:44:32,711 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:44:32,713 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:44:32,713 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:44:32,717 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:44:32,720 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:44:32,720 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:44:32,730 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:44:32,730 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:44:32,740 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:44:32,741 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:44:32,750 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:44:32,756 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:44:32,764 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:44:32,764 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:44:32,766 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:44:32,773 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:44:32,773 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:44:32,780 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:44:32,780 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:44:32,985 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.37140492646393905910340330% which is below threshold 100.0%
2025-07-23 23:44:32,989 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.37140492646393905910340330
2025-07-23 23:44:33,001 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,098 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,107 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:33,192 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,208 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:33,282 - WARNING - app - User 27: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,314 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:33,386 - WARNING - app - User 28: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,449 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:33,481 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,541 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:33,577 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,638 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:33,669 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,744 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:33,772 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-23 23:44:33,880 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-23 23:44:34,220 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:44:34,265 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-23 23:44:34,312 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:34,356 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-23 23:44:34,461 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-23 23:44:34,816 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:44:34,845 - INFO - app - Cache validation completed
2025-07-23 23:44:34,931 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:35,015 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:35,099 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:35,205 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:35,778 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34213.20434979710298680799957
2025-07-23 23:44:36,424 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:44:36,428 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:44:36,428 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 88.41337712971587302895671741% which is below threshold 100.0%
2025-07-23 23:44:36,431 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 88.41337712971587302895671741
2025-07-23 23:44:36,536 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:36,641 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:36,750 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:36,885 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:36,887 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:44:36,905 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:44:36,936 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:44:37,038 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:37,041 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:44:37,043 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:44:37,187 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:44:37,989 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:44:38,420 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:44:38,730 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:44:38,850 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:38,981 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:39,089 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:44:39,311 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:44:39,607 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:44:40,419 - ERROR - app - Error in barclays_pending_order_margin_checker loop: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3297, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 713, in checkout
    rec = pool._do_get()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 179, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 675, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 901, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 270, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 75, in _connect
    await conn._connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 540, in _connect
    await self._request_authentication()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 844, in _request_authentication
    auth_packet = await self._read_packet()
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\main.py", line 1467, in barclays_pending_order_margin_checker
    live_users = await crud_user.get_all_users_with_pending_orders(db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\user.py", line 473, in get_all_users_with_pending_orders
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3273, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 147, in __init__
    Connection._handle_dbapi_exception_noconnection(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        err, dialect, engine
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2436, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3297, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 713, in checkout
    rec = pool._do_get()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 179, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 675, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 901, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 270, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 75, in _connect
    await conn._connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 540, in _connect
    await self._request_authentication()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 844, in _request_authentication
    auth_packet = await self._read_packet()
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-23 23:44:44,076 - INFO - app - Application shutdown initiated
2025-07-23 23:44:44,077 - INFO - app - Scheduler shutdown completed
2025-07-23 23:44:44,078 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-23 23:44:44,891 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-23 23:44:44,891 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-23 23:44:45,084 - INFO - app - Redis connection closed
2025-07-23 23:44:45,084 - INFO - app - Application shutdown completed
2025-07-23 23:48:18,921 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:48:18,955 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:48:18,974 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:48:18,974 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:48:19,367 - INFO - app - Application starting up - Trading system initialized
2025-07-23 23:48:19,367 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-23 23:48:19,367 - INFO - app - Environment: PRODUCTION
2025-07-23 23:48:19,479 - INFO - app - Application startup initiated
2025-07-23 23:48:19,479 - INFO - app - Initializing core services...
2025-07-23 23:48:19,547 - INFO - app - Firebase initialized
2025-07-23 23:48:19,547 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-23 23:48:19,572 - INFO - app - Redis initialized
2025-07-23 23:48:20,935 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-23 23:48:20,940 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-23 23:48:20,942 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-23 23:48:20,942 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-23 23:48:20,943 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-23 23:48:20,944 - INFO - app - Scheduler initialized
2025-07-23 23:48:20,946 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:48:20,947 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-23 23:48:21,718 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-23 23:48:21,737 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:48:21,764 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-23 23:48:21,764 - INFO - app - Background tasks initialized
2025-07-23 23:48:21,764 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-23 23:48:22,355 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-23 23:48:22,355 - INFO - app - Application startup completed successfully
2025-07-23 23:48:22,356 - INFO - app - Starting cache validation task
2025-07-23 23:48:22,360 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-23 23:48:22,366 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-23 23:48:22,370 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-23 23:48:22,394 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:48:22,398 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:48:22,400 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:48:22,405 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:48:22,407 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:48:22,411 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:48:22,413 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:48:22,414 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:48:22,416 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:48:22,434 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:48:22,436 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:48:22,439 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:48:22,441 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:48:22,441 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:48:22,442 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:48:22,442 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:48:22,443 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:48:22,443 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:48:22,444 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:48:22,445 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:48:22,445 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:48:22,596 - INFO - app - Validating cache for 37 users
2025-07-23 23:48:22,598 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-23 23:48:22,619 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-23 23:48:22,790 - INFO - app - Cache validation completed
2025-07-23 23:48:23,331 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 400.4984082085671244119422495
2025-07-23 23:48:23,445 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-23 23:48:23,461 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:48:23,526 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-23 23:48:23,639 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:24,232 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:48:24,624 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:48:24,655 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:48:24,656 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:48:24,678 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:48:24,705 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:48:24,812 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:48:24,853 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-23 23:48:24,911 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 51.35163602988472794414313990% which is below threshold 100.0%
2025-07-23 23:48:24,914 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 51.35163602988472794414313990
2025-07-23 23:48:25,038 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:25,099 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:48:25,104 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:48:25,119 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:48:25,123 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:48:25,129 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:48:25,129 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:48:25,133 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:48:25,133 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:48:25,140 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:48:25,148 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:48:25,148 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:48:25,153 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:48:25,153 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:48:25,158 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:48:25,158 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:48:25,185 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:25,192 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:48:25,212 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:48:25,213 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:48:25,232 - INFO - app.core.config - .env file loaded successfully.
2025-07-23 23:48:25,246 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-23 23:48:25,246 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-23 23:48:25,287 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:25,379 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:25,468 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:25,558 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:25,644 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:26,085 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 47399.34711643090315560391730
2025-07-23 23:48:26,198 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:26,660 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 22706.32380952380952380952381
2025-07-23 23:48:26,750 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:26,852 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:26,940 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:27,041 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:27,348 - ERROR - app - Error in barclays_pending_order_margin_checker loop: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3297, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 713, in checkout
    rec = pool._do_get()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 179, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 675, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 901, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 270, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 75, in _connect
    await conn._connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 540, in _connect
    await self._request_authentication()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 844, in _request_authentication
    auth_packet = await self._read_packet()
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\main.py", line 1467, in barclays_pending_order_margin_checker
    live_users = await crud_user.get_all_users_with_pending_orders(db)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\user.py", line 473, in get_all_users_with_pending_orders
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3273, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 147, in __init__
    Connection._handle_dbapi_exception_noconnection(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        err, dialect, engine
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2436, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3297, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 713, in checkout
    rec = pool._do_get()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 179, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 675, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 901, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 270, in connect
    await_only(creator_fn(*arg, **kw)),
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 75, in _connect
    await conn._connect()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 540, in _connect
    await self._request_authentication()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 844, in _request_authentication
    auth_packet = await self._read_packet()
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-23 23:48:27,729 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34214.42623065452517599509119
2025-07-23 23:48:28,200 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:48:28,203 - ERROR - app.services.portfolio_calculator - Could not convert PnL from PLN to USD
2025-07-23 23:48:28,203 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 88.34566308657341389230046407% which is below threshold 100.0%
2025-07-23 23:48:28,207 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 88.34566308657341389230046407
2025-07-23 23:48:28,330 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:28,446 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:28,589 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:28,736 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:28,739 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-23 23:48:28,772 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-23 23:48:28,804 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-23 23:48:28,936 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:28,939 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-23 23:48:28,942 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-23 23:48:29,159 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-23 23:48:29,959 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-23 23:48:30,348 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-23 23:48:30,652 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 146156.0422960725075528700906
2025-07-23 23:48:30,759 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:30,861 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:30,979 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-23 23:48:31,169 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-23 23:48:31,460 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 0.0
2025-07-23 23:48:37,367 - INFO - app - Starting stale cache cleanup task
2025-07-23 23:48:37,370 - INFO - app - Found 30 static orders cache entries to check
2025-07-23 23:48:37,372 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-23 23:48:37,373 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-23 23:48:37,375 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-23 23:48:37,376 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-23 23:48:37,377 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-23 23:48:37,378 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-23 23:48:37,379 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-23 23:48:37,380 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-23 23:48:37,381 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-23 23:48:37,382 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-23 23:48:37,385 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-23 23:48:37,388 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-23 23:48:37,389 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-23 23:48:37,389 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-23 23:48:37,391 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-23 23:48:37,392 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-23 23:48:37,393 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-23 23:48:37,393 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-23 23:48:37,394 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-23 23:48:37,396 - INFO - app - Completed stale cache cleanup task
2025-07-23 23:48:43,213 - INFO - app - Application shutdown initiated
2025-07-23 23:48:43,214 - INFO - app - Scheduler shutdown completed
2025-07-23 23:48:43,215 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-23 23:48:43,259 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-23 23:48:43,259 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-23 23:48:44,428 - INFO - app - Redis connection closed
2025-07-23 23:48:44,428 - INFO - app - Application shutdown completed
2025-07-24 01:45:12,418 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:45:12,464 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:45:12,481 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:45:12,481 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:45:12,888 - INFO - app - Application starting up - Trading system initialized
2025-07-24 01:45:12,888 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 01:45:12,888 - INFO - app - Environment: PRODUCTION
2025-07-24 01:45:12,963 - INFO - app - Application startup initiated
2025-07-24 01:45:12,963 - INFO - app - Initializing core services...
2025-07-24 01:45:13,041 - INFO - app - Firebase initialized
2025-07-24 01:45:13,041 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 01:45:13,853 - INFO - app - Redis initialized
2025-07-24 01:45:15,033 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 01:45:15,047 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 01:45:15,061 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 01:45:15,062 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 01:45:15,064 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 01:45:15,064 - INFO - app - Scheduler initialized
2025-07-24 01:45:15,068 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 01:45:15,069 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 01:45:16,420 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 01:45:16,473 - INFO - app - Starting stale cache cleanup task
2025-07-24 01:45:16,535 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 01:45:16,536 - INFO - app - Background tasks initialized
2025-07-24 01:45:16,536 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 01:45:17,322 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 01:45:17,323 - INFO - app - Application startup completed successfully
2025-07-24 01:45:17,323 - INFO - app - Starting cache validation task
2025-07-24 01:45:17,327 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 01:45:17,329 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 01:45:17,331 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:45:17,340 - INFO - app - Found 28 static orders cache entries to check
2025-07-24 01:45:17,383 - INFO - app - Validating cache for 30 users
2025-07-24 01:45:17,384 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:45:17,387 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 01:45:17,408 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,415 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:45:17,417 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 01:45:17,426 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-24 01:45:17,428 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,428 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 01:45:17,431 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 01:45:17,435 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 01:45:17,438 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 01:45:17,440 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 01:45:17,444 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 01:45:17,445 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:45:17,446 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 01:45:17,448 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,451 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:45:17,458 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 01:45:17,462 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 01:45:17,464 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 01:45:17,466 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,467 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 01:45:17,469 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 01:45:17,472 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 01:45:17,474 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 01:45:17,475 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 01:45:17,476 - INFO - app - Completed stale cache cleanup task
2025-07-24 01:45:17,479 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,491 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,503 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,515 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,527 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,537 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,547 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,557 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,569 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,580 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,590 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,598 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,606 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,644 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,653 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,663 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,688 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,698 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,707 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,717 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,726 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 01:45:17,749 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 01:45:18,128 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 7.367270010445278347324848157% which is below threshold 100.0%
2025-07-24 01:45:18,130 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 7.367270010445278347324848157
2025-07-24 01:45:18,144 - INFO - app - Cache validation completed
2025-07-24 01:45:18,203 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:18,241 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:18,279 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:18,882 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: -1.610103861408902229416860867
2025-07-24 01:45:18,924 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:18,950 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:18,975 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:18,999 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:19,029 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:19,057 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:19,083 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:19,106 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:19,560 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:45:19,560 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:45:19,564 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:45:19,570 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:45:19,613 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:45:19,633 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:45:19,633 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:45:19,680 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.862288642358783280722027012% which is below threshold 100.0%
2025-07-24 01:45:19,682 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 1.862288642358783280722027012
2025-07-24 01:45:19,908 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:45:19,918 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:45:19,930 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:45:19,938 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:45:19,941 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:45:19,941 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:45:19,953 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:45:19,953 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:45:19,967 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:45:19,967 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:45:19,968 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:45:19,968 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:45:19,978 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:45:19,988 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:45:20,008 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:45:20,008 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:45:20,009 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:45:20,009 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:45:20,011 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:45:20,026 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:45:20,026 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:45:20,292 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 63.23527674981518518652523370% which is below threshold 100.0%
2025-07-24 01:45:20,293 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 63.23527674981518518652523370
2025-07-24 01:45:20,322 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:20,343 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:20,448 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:45:20,990 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:45:20,993 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:45:21,006 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:45:21,007 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:45:21,026 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:21,027 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:45:21,027 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:45:21,144 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:45:21,525 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:45:21,651 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:45:22,038 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:45:22,197 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:45:22,654 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:45:22,694 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:22,735 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:32,338 - INFO - app - Starting stale cache cleanup task
2025-07-24 01:45:32,340 - INFO - app - Found 28 static orders cache entries to check
2025-07-24 01:45:32,340 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 01:45:32,342 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 01:45:32,344 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-24 01:45:32,345 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 01:45:32,347 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 01:45:32,348 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 01:45:32,350 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 01:45:32,351 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 01:45:32,353 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 01:45:32,355 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 01:45:32,358 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 01:45:32,360 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 01:45:32,361 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 01:45:32,363 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 01:45:32,364 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 01:45:32,365 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 01:45:32,366 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 01:45:32,367 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 01:45:32,369 - INFO - app - Completed stale cache cleanup task
2025-07-24 01:45:52,738 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:45:52,745 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:45:52,749 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:45:52,766 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:45:52,768 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:45:53,264 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.27177550388796471817091570% which is below threshold 100.0%
2025-07-24 01:45:53,267 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.27177550388796471817091570
2025-07-24 01:45:57,101 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:45:57,203 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,259 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,288 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,695 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.382351114458234614265286298% which is below threshold 100.0%
2025-07-24 01:45:57,697 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.382351114458234614265286298
2025-07-24 01:45:57,768 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,799 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,824 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,848 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,881 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,913 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,939 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:57,964 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:58,350 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.817643709720345920742779561% which is below threshold 100.0%
2025-07-24 01:45:58,353 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.817643709720345920742779561
2025-07-24 01:45:58,805 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.99096518559271146627352374% which is below threshold 100.0%
2025-07-24 01:45:58,807 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.99096518559271146627352374
2025-07-24 01:45:58,872 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:58,907 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:59,019 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:45:59,411 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:45:59,414 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:45:59,428 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:45:59,429 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:45:59,458 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:45:59,459 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:45:59,459 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:45:59,570 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:45:59,922 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:46:00,202 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:46:00,538 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:46:00,738 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:46:01,053 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:46:01,093 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:01,174 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:22,238 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-24 01:46:22,263 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-24 01:46:22,325 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-24 01:46:22,329 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-24 01:46:22,336 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-24 01:46:22,361 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-24 01:46:22,366 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-24 01:46:22,373 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 30
2025-07-24 01:46:22,382 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 30
2025-07-24 01:46:22,383 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-24 01:46:22,386 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-24 01:46:22,392 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 30 using refresh token.
2025-07-24 01:46:22,984 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 30
2025-07-24 01:46:22,984 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-24 01:46:29,951 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 30 by invalidating refresh token.
2025-07-24 01:46:31,181 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:46:31,194 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:46:31,230 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:46:31,278 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:46:31,282 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:46:31,765 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.28078818329529188750048358% which is below threshold 100.0%
2025-07-24 01:46:31,768 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.28078818329529188750048358
2025-07-24 01:46:35,389 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:46:35,590 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:35,637 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:35,682 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:36,276 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.382255082731962802088153620% which is below threshold 100.0%
2025-07-24 01:46:36,278 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.382255082731962802088153620
2025-07-24 01:46:36,345 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:36,381 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:36,421 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:36,462 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:36,507 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:36,552 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:36,596 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:36,639 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:37,109 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.817037304055169439849611395% which is below threshold 100.0%
2025-07-24 01:46:37,113 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.817037304055169439849611395
2025-07-24 01:46:37,707 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.98927900001959252062693062% which is below threshold 100.0%
2025-07-24 01:46:37,713 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.98927900001959252062693062
2025-07-24 01:46:37,766 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:37,802 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:37,950 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:46:38,322 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:46:38,344 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:46:38,395 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:46:38,398 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:46:38,439 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:38,440 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:46:38,441 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:46:38,602 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:46:38,921 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:46:39,100 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:46:39,448 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:46:39,638 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:46:39,962 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:46:40,039 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:46:40,106 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:10,111 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:47:10,120 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:47:10,126 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:47:10,147 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:47:10,150 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:47:10,696 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.36655673333591241440674688% which is below threshold 100.0%
2025-07-24 01:47:10,699 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.36655673333591241440674688
2025-07-24 01:47:14,061 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:47:14,307 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:14,378 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:14,418 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:14,838 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.475911112251524798246315603% which is below threshold 100.0%
2025-07-24 01:47:14,840 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.475911112251524798246315603
2025-07-24 01:47:14,933 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:14,972 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:15,006 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:15,045 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:15,106 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:15,146 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:15,194 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:15,234 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:15,678 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.853051062725928221782765277% which is below threshold 100.0%
2025-07-24 01:47:15,685 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.853051062725928221782765277
2025-07-24 01:47:16,155 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.07706987641761614729534127% which is below threshold 100.0%
2025-07-24 01:47:16,170 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.07706987641761614729534127
2025-07-24 01:47:16,263 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:16,298 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:16,467 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:47:16,823 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:47:16,826 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:47:16,840 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:47:16,843 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:47:16,897 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:16,899 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:47:16,901 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:47:17,099 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:47:17,431 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:47:17,682 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:47:18,052 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:47:18,395 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:47:18,771 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:47:18,826 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:18,882 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:48,886 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:47:48,894 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-24 01:47:48,902 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:47:48,923 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:47:48,926 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:47:49,409 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.37218436883438430887074935% which is below threshold 100.0%
2025-07-24 01:47:49,411 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.37218436883438430887074935
2025-07-24 01:47:53,280 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:47:53,505 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:53,554 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:53,602 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:54,101 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.479931056008918361356822129% which is below threshold 100.0%
2025-07-24 01:47:54,105 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.479931056008918361356822129
2025-07-24 01:47:54,196 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:54,241 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:54,295 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:54,340 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:54,379 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:54,416 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:54,458 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:54,508 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:55,016 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.861389140622104834063827565% which is below threshold 100.0%
2025-07-24 01:47:55,019 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.861389140622104834063827565
2025-07-24 01:47:55,734 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.09716757005025857007230869% which is below threshold 100.0%
2025-07-24 01:47:55,738 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.09716757005025857007230869
2025-07-24 01:47:55,811 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:55,975 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:47:56,353 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:47:56,356 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:47:56,369 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:47:56,371 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:47:56,417 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:56,419 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:47:56,421 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:47:56,579 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:47:56,965 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:47:57,124 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:47:57,475 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:47:57,711 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:47:58,025 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:47:58,086 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:47:58,144 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:28,150 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:48:28,160 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-24 01:48:28,166 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:48:28,181 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:48:28,184 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:48:28,708 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.69994124530929629772911911% which is below threshold 100.0%
2025-07-24 01:48:28,712 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.69994124530929629772911911
2025-07-24 01:48:32,192 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:48:32,368 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:32,472 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:32,557 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:33,115 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.836382796472413471829412163% which is below threshold 100.0%
2025-07-24 01:48:33,117 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.836382796472413471829412163
2025-07-24 01:48:33,207 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:33,259 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:33,305 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:33,363 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:33,413 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:33,461 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:33,515 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:33,582 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:34,133 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.990166121463054734849122902% which is below threshold 100.0%
2025-07-24 01:48:34,136 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.990166121463054734849122902
2025-07-24 01:48:34,646 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.48772774342563392556221148% which is below threshold 100.0%
2025-07-24 01:48:34,651 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.48772774342563392556221148
2025-07-24 01:48:34,763 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:34,999 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:48:35,327 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:48:35,330 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:48:35,349 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:48:35,351 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:48:35,397 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:35,398 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:48:35,399 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:48:35,617 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:48:35,934 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:48:36,229 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:48:36,550 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:48:36,859 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:48:37,171 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:48:37,279 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:48:37,326 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:07,330 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:49:07,339 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-24 01:49:07,346 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:49:07,361 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:49:07,364 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:49:07,792 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.71644333436496576269875044% which is below threshold 100.0%
2025-07-24 01:49:07,795 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.71644333436496576269875044
2025-07-24 01:49:11,617 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:49:11,784 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:11,825 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:11,897 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:12,431 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.847286329284955521491484727% which is below threshold 100.0%
2025-07-24 01:49:12,434 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.847286329284955521491484727
2025-07-24 01:49:12,499 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:12,530 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:12,565 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:12,593 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:12,623 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:12,654 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:12,681 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:12,733 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:13,147 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.011255562929747903689304689% which is below threshold 100.0%
2025-07-24 01:49:13,150 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.011255562929747903689304689
2025-07-24 01:49:13,728 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.46985554168301936717250641% which is below threshold 100.0%
2025-07-24 01:49:13,733 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.46985554168301936717250641
2025-07-24 01:49:13,812 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:13,934 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:49:14,275 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:49:14,293 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:49:14,326 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:49:14,327 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:49:14,369 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:14,370 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:49:14,371 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:49:14,542 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:49:14,889 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:49:15,038 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:49:15,335 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:49:15,515 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:49:15,825 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:49:15,887 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:15,924 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:45,927 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:49:45,936 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-24 01:49:45,947 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:49:45,979 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:49:45,983 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:49:46,632 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.74796655576618050988432821% which is below threshold 100.0%
2025-07-24 01:49:46,666 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.74796655576618050988432821
2025-07-24 01:49:50,214 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:49:50,382 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:50,418 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:50,449 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:50,931 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.877880458910223804640732321% which is below threshold 100.0%
2025-07-24 01:49:50,933 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.877880458910223804640732321
2025-07-24 01:49:50,995 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:51,027 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:51,059 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:51,101 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:51,168 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:51,251 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:51,281 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:51,308 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:51,752 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.004315586983839289023046784% which is below threshold 100.0%
2025-07-24 01:49:51,756 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.004315586983839289023046784
2025-07-24 01:49:52,296 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.44502014445626898196102290% which is below threshold 100.0%
2025-07-24 01:49:52,301 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.44502014445626898196102290
2025-07-24 01:49:52,355 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:52,481 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:49:52,876 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:49:52,883 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:49:52,899 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:49:52,901 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:49:52,944 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:52,945 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:49:52,946 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:49:53,060 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:49:53,424 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:49:53,699 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:49:54,014 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:49:54,150 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:49:54,516 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:49:54,545 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:49:54,569 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:18,150 - INFO - app - Starting cache validation task
2025-07-24 01:50:18,158 - INFO - app - Validating cache for 29 users
2025-07-24 01:50:18,160 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,165 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,179 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,196 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,208 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,220 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,233 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,243 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,251 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,260 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,270 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,281 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,293 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,304 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,319 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,333 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,344 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,361 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,375 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,388 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,397 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,405 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,421 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 01:50:18,434 - INFO - app - Cache validation completed
2025-07-24 01:50:21,693 - INFO - app.api.v1.endpoints.users - Stored OTP in Redis for new email dhanush777ss@gmail.com (type: live).
2025-07-24 01:50:25,342 - INFO - app.api.v1.endpoints.users - Signup OTP sent successfully to dhanush777ss@gmail.com for account type live.
2025-07-24 01:50:25,347 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:50:25,363 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-24 01:50:25,435 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:50:25,507 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:50:25,511 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:50:25,986 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.73260691902974970018182522% which is below threshold 100.0%
2025-07-24 01:50:25,991 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.73260691902974970018182522
2025-07-24 01:50:29,333 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:50:29,549 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:29,598 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:29,656 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,084 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.856255805015375024271525077% which is below threshold 100.0%
2025-07-24 01:50:30,086 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.856255805015375024271525077
2025-07-24 01:50:30,188 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,234 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,270 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,331 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,376 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,414 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,449 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,489 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:30,969 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.997021874399911060502440783% which is below threshold 100.0%
2025-07-24 01:50:30,973 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.997021874399911060502440783
2025-07-24 01:50:31,584 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.42718207602485096201665610% which is below threshold 100.0%
2025-07-24 01:50:31,589 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.42718207602485096201665610
2025-07-24 01:50:31,641 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:31,745 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:50:32,098 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:50:32,101 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:50:32,118 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:50:32,120 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:50:32,171 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:32,174 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:50:32,176 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:50:32,366 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:50:32,718 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:50:32,899 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:50:33,223 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:50:33,477 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:50:33,840 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:50:33,888 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:50:33,926 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:03,931 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:51:03,974 - INFO - app - [AUTO-CUTOFF] Found 18 live users and 11 demo users.
2025-07-24 01:51:03,979 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:51:04,008 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:51:04,012 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:51:04,557 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.81122456381291345893458161% which is below threshold 100.0%
2025-07-24 01:51:04,564 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.81122456381291345893458161
2025-07-24 01:51:08,241 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:51:08,251 - INFO - app.api.v1.endpoints.users - OTP for new email dhanush777ss@gmail.com (type: live) verified via Redis.
2025-07-24 01:51:08,409 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:08,454 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:08,486 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:08,922 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.959880001923685997815917687% which is below threshold 100.0%
2025-07-24 01:51:08,925 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.959880001923685997815917687
2025-07-24 01:51:08,988 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:09,003 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:09,021 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:09,053 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:09,092 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:09,123 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:09,138 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:09,171 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:09,574 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.029717246514009655325757754% which is below threshold 100.0%
2025-07-24 01:51:09,608 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.029717246514009655325757754
2025-07-24 01:51:10,191 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.50671951777550207199438958% which is below threshold 100.0%
2025-07-24 01:51:10,194 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.50671951777550207199438958
2025-07-24 01:51:10,267 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:10,548 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:51:10,911 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:51:10,915 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:51:10,936 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:51:10,938 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:51:10,981 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:10,983 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:51:10,985 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:51:11,086 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:51:11,423 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:51:11,622 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:51:12,033 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:51:12,322 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:51:12,798 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:51:12,895 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:12,928 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:15,991 - INFO - app.api.v1.endpoints.users - Saved uploaded file Screenshot 2025-07-23 054322.png to ./uploads/proofs\b4c8bae3-c610-4503-8b8b-86fde5f63efc.png, storing path /static/proofs\b4c8bae3-c610-4503-8b8b-86fde5f63efc.png
2025-07-24 01:51:15,999 - INFO - app.api.v1.endpoints.users - Saved uploaded file Screenshot 2025-07-24 014929.png to ./uploads/proofs\cc9b3917-b7ef-4aff-ac14-c04f69d2e6c3.png, storing path /static/proofs\cc9b3917-b7ef-4aff-ac14-c04f69d2e6c3.png
2025-07-24 01:51:42,930 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:51:42,938 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:51:42,942 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:51:42,956 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:51:42,959 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:51:43,367 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.75088615613756818445587837% which is below threshold 100.0%
2025-07-24 01:51:43,372 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.75088615613756818445587837
2025-07-24 01:51:47,053 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:51:47,234 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:47,268 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:47,318 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:47,837 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.882607338408093009092683868% which is below threshold 100.0%
2025-07-24 01:51:47,839 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.882607338408093009092683868
2025-07-24 01:51:47,937 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:48,005 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:48,053 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:48,090 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:48,121 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:48,153 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:48,190 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:48,236 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:48,691 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.999312740246133321654409411% which is below threshold 100.0%
2025-07-24 01:51:48,694 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.999312740246133321654409411
2025-07-24 01:51:49,166 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.43258196585617574340815788% which is below threshold 100.0%
2025-07-24 01:51:49,169 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.43258196585617574340815788
2025-07-24 01:51:49,202 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:49,224 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:49,298 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:51:49,609 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:51:49,629 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:51:49,676 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:51:49,679 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:51:49,735 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:49,737 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:51:49,739 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:51:49,842 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:51:50,233 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:51:50,457 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:51:50,804 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:51:50,930 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:51:51,254 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:51:51,300 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:51:51,343 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:21,352 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:52:21,361 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:52:21,368 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:52:21,394 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:52:21,398 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:52:21,866 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.62525871407017679600758250% which is below threshold 100.0%
2025-07-24 01:52:21,869 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.62525871407017679600758250
2025-07-24 01:52:25,758 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:52:25,879 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:25,918 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:25,941 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:26,378 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.769180283614576597342584420% which is below threshold 100.0%
2025-07-24 01:52:26,380 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.769180283614576597342584420
2025-07-24 01:52:26,435 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:26,453 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:26,468 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:26,483 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:26,504 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:26,521 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:26,536 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:26,552 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:27,090 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.953748092348844965653856908% which is below threshold 100.0%
2025-07-24 01:52:27,106 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.953748092348844965653856908
2025-07-24 01:52:27,598 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.33352027010098749717290850% which is below threshold 100.0%
2025-07-24 01:52:27,602 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.33352027010098749717290850
2025-07-24 01:52:27,638 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:27,664 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:27,751 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:52:28,116 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:52:28,120 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:52:28,138 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:52:28,140 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:52:28,166 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:28,167 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:52:28,168 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:52:28,254 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:52:28,554 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:52:28,650 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:52:28,945 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:52:29,033 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:52:29,452 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:52:29,493 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:29,513 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:52:59,517 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:52:59,532 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:52:59,545 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:52:59,690 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:52:59,707 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:53:00,224 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.70129526287283840767534527% which is below threshold 100.0%
2025-07-24 01:53:00,228 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.70129526287283840767534527
2025-07-24 01:53:03,816 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:53:03,968 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,018 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,059 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,573 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.845677813261288545277658216% which is below threshold 100.0%
2025-07-24 01:53:04,577 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.845677813261288545277658216
2025-07-24 01:53:04,655 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,681 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,704 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,724 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,745 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,767 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,799 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:04,825 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:05,247 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.985735991186904332768477686% which is below threshold 100.0%
2025-07-24 01:53:05,258 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.985735991186904332768477686
2025-07-24 01:53:05,694 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.39905622759873439143412268% which is below threshold 100.0%
2025-07-24 01:53:05,695 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.39905622759873439143412268
2025-07-24 01:53:05,733 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:05,754 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:05,831 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:53:06,237 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:53:06,241 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:53:06,269 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:53:06,272 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:53:06,326 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:06,328 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:53:06,330 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:53:06,417 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:53:06,729 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:53:06,921 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:53:07,245 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:53:07,406 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:53:07,746 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:53:07,858 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:07,877 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:37,881 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:53:37,892 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:53:37,899 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:53:37,921 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:53:37,923 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:53:38,359 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.71436999497079190684359163% which is below threshold 100.0%
2025-07-24 01:53:38,362 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.71436999497079190684359163
2025-07-24 01:53:42,112 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:53:42,263 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,290 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,307 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,769 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.857110135060834085878372905% which is below threshold 100.0%
2025-07-24 01:53:42,773 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.857110135060834085878372905
2025-07-24 01:53:42,838 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,855 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,873 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,895 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,913 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,927 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,942 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:42,959 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:43,339 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.990957817748146251570759119% which is below threshold 100.0%
2025-07-24 01:53:43,342 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.990957817748146251570759119
2025-07-24 01:53:43,888 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.41154901949674241917931641% which is below threshold 100.0%
2025-07-24 01:53:43,898 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.41154901949674241917931641
2025-07-24 01:53:43,941 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:43,961 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:44,031 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:53:44,404 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:53:44,408 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:53:44,431 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:53:44,433 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:53:44,459 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:44,459 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:53:44,460 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:53:44,513 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:53:44,914 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:53:45,017 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:53:45,323 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:53:45,522 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:53:45,866 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:53:45,922 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:53:45,944 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:15,947 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:54:15,954 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:54:15,961 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:54:15,987 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:54:15,990 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:54:16,397 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.75156316491933923942899145% which is below threshold 100.0%
2025-07-24 01:54:16,432 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.75156316491933923942899145
2025-07-24 01:54:20,140 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:54:20,277 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:20,325 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:20,352 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:20,876 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.894943892022107522378735727% which is below threshold 100.0%
2025-07-24 01:54:20,880 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.894943892022107522378735727
2025-07-24 01:54:20,936 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:20,953 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:20,972 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:20,988 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:21,008 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:21,025 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:21,040 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:21,056 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:21,468 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.008610960445506028682987963% which is below threshold 100.0%
2025-07-24 01:54:21,502 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.008610960445506028682987963
2025-07-24 01:54:21,945 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.45450920496896339932827009% which is below threshold 100.0%
2025-07-24 01:54:21,947 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.45450920496896339932827009
2025-07-24 01:54:21,983 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:21,999 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:22,074 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:54:22,442 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:54:22,448 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:54:22,474 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:54:22,476 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:54:22,495 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:22,496 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:54:22,497 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:54:22,560 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:54:22,934 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:54:23,004 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:54:23,447 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:54:23,554 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:54:23,929 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:54:23,975 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:23,992 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:54:50,115 - INFO - app - Application shutdown initiated
2025-07-24 01:54:50,115 - INFO - app - Scheduler shutdown completed
2025-07-24 01:54:50,119 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 01:54:51,275 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 01:54:51,275 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 01:54:51,289 - INFO - app - Redis connection closed
2025-07-24 01:54:51,289 - INFO - app - Application shutdown completed
2025-07-24 01:55:45,240 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:55:45,284 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:55:45,300 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:55:45,300 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:55:45,785 - INFO - app - Application starting up - Trading system initialized
2025-07-24 01:55:45,785 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 01:55:45,785 - INFO - app - Environment: PRODUCTION
2025-07-24 01:55:45,857 - INFO - app - Application startup initiated
2025-07-24 01:55:45,858 - INFO - app - Initializing core services...
2025-07-24 01:55:45,910 - INFO - app - Firebase initialized
2025-07-24 01:55:45,910 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 01:55:45,936 - INFO - app - Redis initialized
2025-07-24 01:55:46,616 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 01:55:46,620 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 01:55:46,626 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 01:55:46,627 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 01:55:46,629 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 01:55:46,630 - INFO - app - Scheduler initialized
2025-07-24 01:55:46,632 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 01:55:46,632 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 01:55:47,794 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 01:55:47,814 - INFO - app - Starting stale cache cleanup task
2025-07-24 01:55:47,893 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 01:55:47,893 - INFO - app - Background tasks initialized
2025-07-24 01:55:47,893 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 01:55:48,505 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 01:55:48,505 - INFO - app - Application startup completed successfully
2025-07-24 01:55:48,505 - INFO - app - Starting cache validation task
2025-07-24 01:55:48,508 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 01:55:48,510 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 01:55:48,512 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:55:48,542 - INFO - app - Found 28 static orders cache entries to check
2025-07-24 01:55:48,562 - INFO - app - Validating cache for 30 users
2025-07-24 01:55:48,563 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:55:48,567 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 01:55:48,568 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,589 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 01:55:48,591 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:55:48,602 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-24 01:55:48,604 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 01:55:48,604 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,605 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 01:55:48,607 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 01:55:48,610 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 01:55:48,612 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 01:55:48,615 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 01:55:48,617 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 01:55:48,620 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,620 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:55:48,625 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:55:48,626 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 01:55:48,632 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 01:55:48,634 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 01:55:48,634 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,638 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 01:55:48,639 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 01:55:48,641 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 01:55:48,643 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 01:55:48,644 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 01:55:48,646 - INFO - app - Completed stale cache cleanup task
2025-07-24 01:55:48,647 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,656 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,670 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,679 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,688 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,696 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,705 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,714 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,724 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,735 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,744 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,753 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,760 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,766 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,807 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,816 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,825 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,834 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,845 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,861 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 01:55:48,878 - INFO - app - Cache validation completed
2025-07-24 01:55:49,229 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.94006779759371735850516461% which is below threshold 100.0%
2025-07-24 01:55:49,232 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.94006779759371735850516461
2025-07-24 01:55:50,214 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:55:50,272 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:55:50,284 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:55:50,284 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:55:50,301 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:55:50,346 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:55:50,441 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 01:55:50,553 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:55:50,572 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:55:50,573 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:55:50,597 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:55:50,618 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:55:50,619 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:55:50,619 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:55:50,620 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:55:50,628 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:55:50,640 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:55:50,640 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:55:50,644 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:55:50,645 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:55:50,650 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:55:50,650 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:55:50,659 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:55:50,674 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:55:50,674 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:55:50,697 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 01:55:50,709 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 01:55:50,709 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 01:55:53,116 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:55:53,199 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,229 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,268 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,701 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.056498840457390520275906807% which is below threshold 100.0%
2025-07-24 01:55:53,739 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.056498840457390520275906807
2025-07-24 01:55:53,804 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,818 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,833 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,851 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,866 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,882 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,898 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:53,915 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:54,344 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.970289491326714527795277447% which is below threshold 100.0%
2025-07-24 01:55:54,349 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.970289491326714527795277447
2025-07-24 01:55:54,761 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.36146179864664151769808772% which is below threshold 100.0%
2025-07-24 01:55:54,764 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.36146179864664151769808772
2025-07-24 01:55:54,814 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:54,830 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:54,937 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:55:55,407 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:55:55,412 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:55:55,428 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:55:55,430 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:55:55,454 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:55,454 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:55:55,455 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:55:55,515 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:55:55,876 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:55:56,004 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:55:56,303 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:55:56,382 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:55:56,702 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:55:56,764 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:55:56,788 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:03,513 - INFO - app - Starting stale cache cleanup task
2025-07-24 01:56:03,515 - INFO - app - Found 28 static orders cache entries to check
2025-07-24 01:56:03,517 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 01:56:03,518 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 01:56:03,520 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-24 01:56:03,520 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 01:56:03,521 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 01:56:03,523 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 01:56:03,524 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 01:56:03,525 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 01:56:03,527 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 01:56:03,528 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 01:56:03,533 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 01:56:03,535 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 01:56:03,535 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 01:56:03,536 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 01:56:03,537 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 01:56:03,537 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 01:56:03,538 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 01:56:03,538 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 01:56:03,539 - INFO - app - Completed stale cache cleanup task
2025-07-24 01:56:26,796 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 01:56:26,811 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 01:56:26,819 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 01:56:26,837 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:56:26,843 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 01:56:27,318 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.69363660102905334829200356% which is below threshold 100.0%
2025-07-24 01:56:27,321 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.69363660102905334829200356
2025-07-24 01:56:30,900 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 01:56:31,060 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,084 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,105 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,515 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.864989728543322205258687425% which is below threshold 100.0%
2025-07-24 01:56:31,516 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.864989728543322205258687425
2025-07-24 01:56:31,574 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,593 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,612 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,631 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,649 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,673 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,691 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:31,709 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:32,127 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.982703962861021928302636854% which is below threshold 100.0%
2025-07-24 01:56:32,131 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.982703962861021928302636854
2025-07-24 01:56:32,641 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.39143767253962129910426682% which is below threshold 100.0%
2025-07-24 01:56:32,644 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.39143767253962129910426682
2025-07-24 01:56:32,712 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:32,751 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:32,987 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 01:56:33,390 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 01:56:33,394 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 01:56:33,419 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 01:56:33,421 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 01:56:33,452 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:33,453 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 01:56:33,454 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 01:56:33,523 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 01:56:33,869 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 01:56:34,003 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 01:56:34,326 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 01:56:34,569 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 01:56:34,896 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 01:56:34,943 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:34,969 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 01:56:51,272 - INFO - app - Application shutdown initiated
2025-07-24 01:56:51,272 - INFO - app - Scheduler shutdown completed
2025-07-24 01:56:51,273 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 01:56:51,379 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 01:56:51,379 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 01:56:51,602 - INFO - app - Redis connection closed
2025-07-24 01:56:51,603 - INFO - app - Application shutdown completed
2025-07-24 02:06:02,141 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:06:02,203 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:02,218 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:02,218 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:40,197 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:06:40,258 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:40,280 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:40,280 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:40,953 - INFO - app - Application starting up - Trading system initialized
2025-07-24 02:06:40,984 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 02:06:40,985 - INFO - app - Environment: PRODUCTION
2025-07-24 02:06:41,179 - INFO - app - Application startup initiated
2025-07-24 02:06:41,180 - INFO - app - Initializing core services...
2025-07-24 02:06:41,305 - INFO - app - Firebase initialized
2025-07-24 02:06:41,305 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 02:06:41,346 - INFO - app - Redis initialized
2025-07-24 02:06:44,349 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 02:06:44,360 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 02:06:44,407 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 02:06:44,408 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 02:06:44,412 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 02:06:44,413 - INFO - app - Scheduler initialized
2025-07-24 02:06:44,423 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 02:06:44,425 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 02:06:45,911 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 02:06:45,969 - INFO - app - Starting stale cache cleanup task
2025-07-24 02:06:46,050 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 02:06:46,050 - INFO - app - Background tasks initialized
2025-07-24 02:06:46,050 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 02:06:46,723 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 02:06:46,723 - INFO - app - Application startup completed successfully
2025-07-24 02:06:46,724 - INFO - app - Starting cache validation task
2025-07-24 02:06:46,728 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 02:06:46,732 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 02:06:46,736 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 02:06:46,799 - INFO - app - Found 28 static orders cache entries to check
2025-07-24 02:06:46,838 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 02:06:46,841 - INFO - app - Validating cache for 30 users
2025-07-24 02:06:46,844 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 02:06:46,854 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 02:06:46,858 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 02:06:46,861 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 02:06:46,867 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-24 02:06:46,870 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 02:06:46,871 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 02:06:46,874 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 02:06:46,876 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 02:06:46,880 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 02:06:46,883 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 02:06:46,888 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 02:06:46,889 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:06:46,890 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 02:06:46,891 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 02:06:46,896 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 02:06:46,909 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 02:06:46,912 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 02:06:46,915 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 02:06:46,919 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 02:06:46,925 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 02:06:46,928 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 02:06:46,929 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 02:06:46,930 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 02:06:46,932 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 02:06:46,934 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 02:06:46,939 - INFO - app - Completed stale cache cleanup task
2025-07-24 02:06:46,952 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 02:06:46,967 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-24 02:06:46,983 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 02:06:46,996 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,014 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,028 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,044 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,058 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,071 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,087 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,101 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,197 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,213 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,227 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,245 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,282 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,295 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,308 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,321 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,745 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.89953189678517544199001896% which is below threshold 100.0%
2025-07-24 02:06:47,747 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 02:06:47,748 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.89953189678517544199001896
2025-07-24 02:06:49,401 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:06:49,402 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:06:49,405 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:06:49,417 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:06:49,975 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:49,992 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:49,994 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:50,000 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:50,005 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:50,008 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:50,012 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:50,012 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:50,013 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:06:50,026 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:50,026 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:50,026 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:50,026 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:50,033 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:50,033 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:50,035 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:50,035 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:50,039 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:50,039 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:50,043 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:06:50,043 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:06:51,424 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 02:06:51,534 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 02:06:51,569 - INFO - app - Cache validation completed
2025-07-24 02:06:51,582 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:51,612 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:51,637 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,154 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.386600763609402803404335123% which is below threshold 100.0%
2025-07-24 02:06:52,157 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.386600763609402803404335123
2025-07-24 02:06:52,278 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,311 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,349 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,386 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,420 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,451 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,479 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,550 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:52,999 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.090846306484161020917626528% which is below threshold 100.0%
2025-07-24 02:06:53,003 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.090846306484161020917626528
2025-07-24 02:06:53,687 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.65194993025540509516128228% which is below threshold 100.0%
2025-07-24 02:06:53,695 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.65194993025540509516128228
2025-07-24 02:06:53,763 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:53,824 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:54,118 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 02:06:54,622 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 02:06:54,629 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 02:06:54,656 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:06:54,658 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 02:06:54,701 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:54,702 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 02:06:54,704 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 02:06:54,883 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 02:06:55,234 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 02:06:55,793 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 02:06:56,148 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 02:06:56,526 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 02:06:56,893 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 02:06:57,021 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:06:57,104 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:01,725 - INFO - app - Starting stale cache cleanup task
2025-07-24 02:07:01,729 - INFO - app - Found 28 static orders cache entries to check
2025-07-24 02:07:01,732 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 02:07:01,735 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 02:07:01,742 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-24 02:07:01,746 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 02:07:01,749 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 02:07:01,752 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 02:07:01,755 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 02:07:01,758 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 02:07:01,764 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 02:07:01,768 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 02:07:01,785 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 02:07:01,795 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 02:07:01,798 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 02:07:01,803 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 02:07:01,806 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 02:07:01,810 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 02:07:01,813 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 02:07:01,816 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 02:07:01,819 - INFO - app - Completed stale cache cleanup task
2025-07-24 02:07:27,113 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 02:07:27,131 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 02:07:27,145 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 02:07:27,181 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:07:27,188 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 02:07:27,991 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.88243742504545630391891369% which is below threshold 100.0%
2025-07-24 02:07:28,044 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.88243742504545630391891369
2025-07-24 02:07:31,986 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 02:07:32,273 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:32,360 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:32,449 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:33,313 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.076824333294646409756682816% which is below threshold 100.0%
2025-07-24 02:07:33,317 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.076824333294646409756682816
2025-07-24 02:07:33,493 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:33,594 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:33,681 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:33,772 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:33,874 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:33,990 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:34,088 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:34,189 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:34,849 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.057847731537474185647725473% which is below threshold 100.0%
2025-07-24 02:07:34,878 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.057847731537474185647725473
2025-07-24 02:07:35,728 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.65307632952489775878630684% which is below threshold 100.0%
2025-07-24 02:07:35,731 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.65307632952489775878630684
2025-07-24 02:07:35,825 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:35,939 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:36,272 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 02:07:36,596 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 02:07:36,603 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 02:07:36,642 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:07:36,648 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 02:07:36,746 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:36,750 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 02:07:36,752 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 02:07:37,073 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 02:07:37,428 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 02:07:37,810 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 02:07:38,234 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 02:07:38,615 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 02:07:38,951 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 02:07:39,037 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:07:39,134 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:08:09,152 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 02:08:09,173 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 02:08:09,185 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 02:08:09,216 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:08:09,222 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 02:08:09,875 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.87418638051762157143409803% which is below threshold 100.0%
2025-07-24 02:08:09,879 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.87418638051762157143409803
2025-07-24 02:08:13,765 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 02:08:13,918 - INFO - app - Application shutdown initiated
2025-07-24 02:08:13,919 - INFO - app - Scheduler shutdown completed
2025-07-24 02:08:13,922 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 02:08:15,196 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 02:08:15,196 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 02:08:15,241 - INFO - app - Redis connection closed
2025-07-24 02:08:15,241 - INFO - app - Application shutdown completed
2025-07-24 02:20:00,600 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:20:00,705 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:20:00,734 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:20:00,735 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:20:01,418 - INFO - app - Application starting up - Trading system initialized
2025-07-24 02:20:01,418 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 02:20:01,418 - INFO - app - Environment: PRODUCTION
2025-07-24 02:20:01,551 - INFO - app - Application startup initiated
2025-07-24 02:20:01,552 - INFO - app - Initializing core services...
2025-07-24 02:20:01,649 - INFO - app - Firebase initialized
2025-07-24 02:20:01,649 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 02:20:01,689 - INFO - app - Redis initialized
2025-07-24 02:20:03,774 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 02:20:03,791 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 02:20:03,806 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 02:20:03,807 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 02:20:03,811 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 02:20:03,812 - INFO - app - Scheduler initialized
2025-07-24 02:20:03,821 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 02:20:03,826 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 02:20:05,019 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 02:20:05,124 - INFO - app - Starting stale cache cleanup task
2025-07-24 02:20:05,303 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 02:20:05,303 - INFO - app - Background tasks initialized
2025-07-24 02:20:05,303 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 02:20:06,042 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 02:20:06,042 - INFO - app - Application startup completed successfully
2025-07-24 02:20:06,045 - INFO - app - Starting cache validation task
2025-07-24 02:20:06,054 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 02:20:06,057 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 02:20:06,063 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 02:20:06,235 - INFO - app - Found 28 static orders cache entries to check
2025-07-24 02:20:06,310 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 02:20:06,314 - INFO - app - Validating cache for 30 users
2025-07-24 02:20:06,324 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 02:20:06,335 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,340 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 02:20:06,417 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 02:20:06,419 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,420 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-24 02:20:06,455 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 02:20:06,464 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 02:20:06,471 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 02:20:06,478 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 02:20:06,479 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,484 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 02:20:06,505 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 02:20:06,521 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:20:06,523 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 02:20:06,535 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 02:20:06,549 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,563 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 02:20:06,586 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 02:20:06,601 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 02:20:06,605 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,637 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 02:20:06,646 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 02:20:06,654 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 02:20:06,661 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 02:20:06,666 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,669 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 02:20:06,681 - INFO - app - Completed stale cache cleanup task
2025-07-24 02:20:06,730 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,777 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,816 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,857 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,905 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,953 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 02:20:06,998 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,042 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,090 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,145 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,248 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,343 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,452 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,503 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,542 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,578 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,604 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,648 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 02:20:07,675 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 02:20:08,090 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 13.08575162482107625053193547% which is below threshold 100.0%
2025-07-24 02:20:08,091 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 02:20:08,093 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 13.08575162482107625053193547
2025-07-24 02:20:08,135 - INFO - app - Cache validation completed
2025-07-24 02:20:08,179 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:08,249 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:08,313 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,117 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.295826597216217938535268583% which is below threshold 100.0%
2025-07-24 02:20:09,121 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 4.295826597216217938535268583
2025-07-24 02:20:09,331 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,414 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,473 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,529 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,592 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,659 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,729 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,794 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:09,976 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:20:09,979 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:20:10,092 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:20:10,412 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:20:10,413 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:20:10,237 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:20:10,229 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:20:10,240 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:20:10,242 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 02:20:10,442 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:20:10,442 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:20:10,455 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:20:10,456 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:20:10,538 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:20:10,566 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:20:10,566 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:20:10,701 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 4.138786043236723927083087683% which is below threshold 100.0%
2025-07-24 02:20:10,705 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 4.138786043236723927083087683
2025-07-24 02:20:10,807 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:20:10,812 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:20:10,823 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:20:10,824 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 02:20:10,835 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:20:10,835 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:20:10,839 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:20:10,839 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:20:10,852 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:20:10,852 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:20:10,854 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 02:20:10,855 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 02:20:11,680 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.68236933239407563136215054% which is below threshold 100.0%
2025-07-24 02:20:11,684 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.68236933239407563136215054
2025-07-24 02:20:11,747 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:11,800 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:12,099 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 02:20:13,679 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 02:20:13,704 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 02:20:13,772 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:20:13,778 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 02:20:13,882 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:13,885 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 02:20:13,888 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 02:20:14,241 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 02:20:14,649 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 02:20:15,432 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 02:20:15,772 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 02:20:16,185 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 02:20:16,493 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 02:20:16,610 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:16,701 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:21,048 - INFO - app - Starting stale cache cleanup task
2025-07-24 02:20:21,052 - INFO - app - Found 28 static orders cache entries to check
2025-07-24 02:20:21,054 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 02:20:21,057 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 02:20:21,062 - WARNING - app - Found stale cache entry for user live:24, will be refreshed on next access
2025-07-24 02:20:21,066 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 02:20:21,070 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 02:20:21,073 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 02:20:21,076 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 02:20:21,079 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 02:20:21,084 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 02:20:21,088 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 02:20:21,102 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 02:20:21,110 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 02:20:21,113 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 02:20:21,118 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 02:20:21,121 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 02:20:21,123 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 02:20:21,127 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 02:20:21,129 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 02:20:21,132 - INFO - app - Completed stale cache cleanup task
2025-07-24 02:20:46,717 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 02:20:46,737 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 02:20:46,749 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 02:20:46,780 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:20:46,786 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 02:20:47,411 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.78492156369685481063097218% which is below threshold 100.0%
2025-07-24 02:20:47,416 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.78492156369685481063097218
2025-07-24 02:20:50,995 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 02:20:51,280 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:51,405 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:51,488 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:52,229 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.980077036011649039632980619% which is below threshold 100.0%
2025-07-24 02:20:52,234 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.980077036011649039632980619
2025-07-24 02:20:52,462 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:52,610 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:52,711 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:52,797 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:52,914 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:53,009 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:53,095 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:53,192 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:53,862 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.621437787832133436197701723% which is below threshold 100.0%
2025-07-24 02:20:53,868 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.621437787832133436197701723
2025-07-24 02:20:54,786 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.50943973787801532817779250% which is below threshold 100.0%
2025-07-24 02:20:54,832 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.50943973787801532817779250
2025-07-24 02:20:55,011 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:55,105 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:55,481 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 02:20:55,779 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 02:20:55,784 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 02:20:55,817 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:20:55,821 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 02:20:55,908 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:55,912 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 02:20:55,914 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 02:20:56,225 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 02:20:56,628 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 02:20:57,038 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 02:20:57,426 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 02:20:57,891 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 02:20:58,270 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 02:20:58,361 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:20:58,465 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:28,483 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 02:21:28,499 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 02:21:28,511 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 02:21:28,546 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:21:28,552 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 02:21:29,301 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.80552801849201129637510155% which is below threshold 100.0%
2025-07-24 02:21:29,351 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.80552801849201129637510155
2025-07-24 02:21:32,981 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 02:21:33,295 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:33,366 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:33,428 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:34,148 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.995060316671698744223021517% which is below threshold 100.0%
2025-07-24 02:21:34,152 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.995060316671698744223021517
2025-07-24 02:21:34,335 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:34,406 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:34,472 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:34,543 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:34,614 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:34,724 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:34,813 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:34,901 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:35,642 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.646233041697127321607244526% which is below threshold 100.0%
2025-07-24 02:21:35,645 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.646233041697127321607244526
2025-07-24 02:21:36,384 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.57737868048401308343471496% which is below threshold 100.0%
2025-07-24 02:21:36,405 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.57737868048401308343471496
2025-07-24 02:21:36,562 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:36,631 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:36,989 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 02:21:37,340 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 02:21:37,346 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 02:21:37,384 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 02:21:37,390 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 02:21:37,491 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:37,493 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 02:21:37,496 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 02:21:37,849 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 02:21:38,202 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 02:21:38,580 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 02:21:38,921 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 02:21:39,323 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 02:21:39,639 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 02:21:39,726 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:39,821 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 02:21:53,110 - INFO - app - Application shutdown initiated
2025-07-24 02:21:53,115 - INFO - app - Scheduler shutdown completed
2025-07-24 02:21:53,121 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 02:21:54,893 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 02:21:54,894 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 02:21:54,924 - INFO - app - Redis connection closed
2025-07-24 02:21:54,924 - INFO - app - Application shutdown completed
2025-07-24 04:01:21,985 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:01:22,038 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:01:22,051 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:01:22,052 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:01:22,540 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:01:22,540 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:01:22,540 - INFO - app - Environment: PRODUCTION
2025-07-24 04:01:22,609 - INFO - app - Application startup initiated
2025-07-24 04:01:22,609 - INFO - app - Initializing core services...
2025-07-24 04:01:22,675 - INFO - app - Firebase initialized
2025-07-24 04:01:22,676 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:01:22,765 - INFO - app - Redis initialized
2025-07-24 04:01:23,569 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:01:23,574 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:01:23,580 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:01:23,580 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:01:23,581 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:01:23,581 - INFO - app - Scheduler initialized
2025-07-24 04:01:23,584 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:01:23,584 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:01:24,810 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:01:24,825 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:01:24,862 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:01:24,862 - INFO - app - Background tasks initialized
2025-07-24 04:01:24,862 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:01:25,527 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:01:25,527 - INFO - app - Application startup completed successfully
2025-07-24 04:01:25,527 - INFO - app - Starting cache validation task
2025-07-24 04:01:25,528 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:01:25,529 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:01:25,531 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:01:25,548 - INFO - app - Found 24 static orders cache entries to check
2025-07-24 04:01:25,581 - INFO - app - Validating cache for 30 users
2025-07-24 04:01:25,581 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:01:25,583 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:01:25,594 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:01:25,595 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,600 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:01:25,603 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:01:25,605 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:01:25,607 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:01:25,608 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,609 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:01:25,610 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:01:25,614 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:01:25,616 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:01:25,622 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,624 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:01:25,626 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:01:25,631 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:01:25,632 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:01:25,635 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:01:25,636 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,637 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:01:25,638 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:01:25,641 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:01:25,644 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:01:25,645 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:01:25,650 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,663 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,671 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,681 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,693 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,704 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,714 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,723 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,732 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,741 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,752 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,762 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,774 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,783 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,790 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,838 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,863 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,874 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,883 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,893 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,903 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 04:01:25,924 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 04:01:26,245 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.11817913652365662114588572% which is below threshold 100.0%
2025-07-24 04:01:26,247 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.11817913652365662114588572
2025-07-24 04:01:27,613 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:01:27,637 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:01:27,659 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:01:27,685 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:01:27,710 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:01:27,741 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:01:27,756 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:01:28,087 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:01:28,092 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:01:28,098 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:01:28,112 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:01:28,112 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:01:28,112 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:01:28,127 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:01:28,127 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:01:28,134 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:01:28,154 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:01:28,155 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:01:28,164 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:01:28,165 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:01:28,173 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:01:28,178 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:01:28,178 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:01:28,181 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:01:28,181 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:01:28,189 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:01:28,189 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:01:30,752 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:01:30,753 - INFO - app - Cache validation completed
2025-07-24 04:01:30,839 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:30,865 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:30,894 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,353 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.517389459823140111448880875% which is below threshold 100.0%
2025-07-24 04:01:31,363 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.517389459823140111448880875
2025-07-24 04:01:31,428 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,449 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,465 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,489 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,512 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,533 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,551 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,573 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:31,924 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.383945746906488877509424555% which is below threshold 100.0%
2025-07-24 04:01:31,928 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.383945746906488877509424555
2025-07-24 04:01:32,307 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.93432075086184904106216857% which is below threshold 100.0%
2025-07-24 04:01:32,308 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.93432075086184904106216857
2025-07-24 04:01:32,329 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:32,355 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:32,426 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:01:32,896 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:01:32,898 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:01:32,912 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:01:32,913 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:01:32,949 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:32,950 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:01:32,951 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:01:33,077 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:01:33,379 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:01:33,540 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:01:33,866 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:01:33,999 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:01:34,366 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:01:34,400 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:34,434 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:01:40,539 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:01:40,542 - INFO - app - Found 24 static orders cache entries to check
2025-07-24 04:01:40,546 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:01:40,549 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:01:40,553 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:01:40,556 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:01:40,558 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:01:40,560 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:01:40,562 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:01:40,564 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:01:40,565 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:01:40,567 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:01:40,568 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:01:40,568 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:01:40,569 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:01:40,569 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:01:40,570 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:01:40,570 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:01:40,570 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:02:04,436 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:02:04,440 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:02:04,444 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:02:04,452 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:02:04,454 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:02:04,849 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.29658666679562072033734380% which is below threshold 100.0%
2025-07-24 04:02:04,851 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.29658666679562072033734380
2025-07-24 04:02:09,253 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:02:09,365 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,407 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,427 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,794 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.389507241056555506652472376% which is below threshold 100.0%
2025-07-24 04:02:09,796 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.389507241056555506652472376
2025-07-24 04:02:09,840 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,865 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,887 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,908 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,931 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,952 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:09,982 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:10,000 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:10,361 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.381654881060266616357455926% which is below threshold 100.0%
2025-07-24 04:02:10,365 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.381654881060266616357455926
2025-07-24 04:02:10,753 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.92844982133600899808696444% which is below threshold 100.0%
2025-07-24 04:02:10,761 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.92844982133600899808696444
2025-07-24 04:02:10,847 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:10,934 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:11,218 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:02:11,539 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:02:11,549 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:02:11,572 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:02:11,573 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:02:11,595 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:11,597 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:02:11,597 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:02:11,670 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:02:11,973 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:02:12,046 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:02:12,336 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:02:12,426 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:02:12,714 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:02:12,743 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:12,765 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:42,767 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:02:42,772 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:02:42,776 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:02:42,785 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:02:42,799 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:02:43,247 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.24132582498355835815698866% which is below threshold 100.0%
2025-07-24 04:02:43,249 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.24132582498355835815698866
2025-07-24 04:02:47,548 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:02:47,708 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:47,738 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:47,769 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,163 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.337675642722493250629485890% which is below threshold 100.0%
2025-07-24 04:02:48,164 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.337675642722493250629485890
2025-07-24 04:02:48,228 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,256 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,282 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,306 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,333 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,363 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,385 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,410 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:48,790 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.404529850318868312271966203% which is below threshold 100.0%
2025-07-24 04:02:48,792 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.404529850318868312271966203
2025-07-24 04:02:49,260 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.98406663859998264662458758% which is below threshold 100.0%
2025-07-24 04:02:49,262 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.98406663859998264662458758
2025-07-24 04:02:49,304 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:49,329 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:49,414 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:02:49,704 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:02:49,706 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:02:49,723 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:02:49,725 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:02:49,754 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:49,755 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:02:49,756 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:02:49,840 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:02:50,137 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:02:50,226 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:02:50,546 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:02:50,656 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:02:50,955 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:02:50,993 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:02:51,033 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:21,035 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:03:21,043 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:03:21,046 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:03:21,054 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:03:21,058 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:03:21,464 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.32895614917404928623931293% which is below threshold 100.0%
2025-07-24 04:03:21,466 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.32895614917404928623931293
2025-07-24 04:03:25,130 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:03:25,225 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,265 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,288 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,751 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.420161260712099916673375881% which is below threshold 100.0%
2025-07-24 04:03:25,756 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.420161260712099916673375881
2025-07-24 04:03:25,828 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,854 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,891 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,925 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,943 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,961 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,978 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:25,995 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:26,428 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.443979907758960485933073028% which is below threshold 100.0%
2025-07-24 04:03:26,431 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.443979907758960485933073028
2025-07-24 04:03:26,880 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.08077996254483478692314619% which is below threshold 100.0%
2025-07-24 04:03:26,881 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.08077996254483478692314619
2025-07-24 04:03:26,904 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:26,928 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:27,024 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:03:27,381 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:03:27,384 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:03:27,393 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:03:27,395 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:03:27,418 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:27,419 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:03:27,419 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:03:27,483 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:03:27,783 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:03:27,892 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:03:28,205 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:03:28,279 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:03:28,573 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:03:28,595 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:28,614 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:03:58,630 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:03:58,637 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:03:58,641 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:03:58,663 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:03:58,666 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:03:59,127 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.31211555572749429378312507% which is below threshold 100.0%
2025-07-24 04:03:59,134 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.31211555572749429378312507
2025-07-24 04:04:02,568 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:04:02,688 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:02,732 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:02,754 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,131 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.400234624279502274085761606% which is below threshold 100.0%
2025-07-24 04:04:03,133 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.400234624279502274085761606
2025-07-24 04:04:03,175 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,197 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,215 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,235 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,261 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,279 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,295 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,312 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:03,683 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.448342659627869056803366225% which is below threshold 100.0%
2025-07-24 04:04:03,686 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.448342659627869056803366225
2025-07-24 04:04:04,052 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.09129302239343187711297996% which is below threshold 100.0%
2025-07-24 04:04:04,054 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.09129302239343187711297996
2025-07-24 04:04:04,083 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:04,117 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:04,198 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:04:04,492 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:04:04,498 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:04:04,508 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:04:04,511 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:04:04,555 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:04,559 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:04:04,562 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:04:04,654 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:04:04,984 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:04:05,077 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:04:05,374 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:04:05,449 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:04:05,785 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:04:05,804 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:05,823 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:35,838 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:04:35,843 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:04:35,847 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:04:35,857 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:04:35,859 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:04:36,228 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.36098712716159232465472552% which is below threshold 100.0%
2025-07-24 04:04:36,232 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.36098712716159232465472552
2025-07-24 04:04:39,571 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:04:39,685 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:39,735 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:39,755 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,189 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.452052080350798730711734820% which is below threshold 100.0%
2025-07-24 04:04:40,190 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.452052080350798730711734820
2025-07-24 04:04:40,232 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,251 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,270 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,289 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,306 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,329 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,347 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,365 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:40,726 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.457371366198274438990536703% which is below threshold 100.0%
2025-07-24 04:04:40,728 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.457371366198274438990536703
2025-07-24 04:04:41,166 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.11791700512689160837322892% which is below threshold 100.0%
2025-07-24 04:04:41,170 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.11791700512689160837322892
2025-07-24 04:04:41,207 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:41,235 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:41,316 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:04:41,622 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:04:41,624 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:04:41,632 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:04:41,634 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:04:41,672 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:41,673 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:04:41,675 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:04:41,773 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:04:42,101 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:04:42,224 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:04:42,553 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:04:42,644 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:04:43,052 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:04:43,080 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:04:43,103 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:05:12,074 - INFO - app - Application shutdown initiated
2025-07-24 04:05:12,075 - INFO - app - Scheduler shutdown completed
2025-07-24 04:05:12,075 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:05:12,648 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:05:12,648 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:05:12,655 - INFO - app - Redis connection closed
2025-07-24 04:05:12,655 - INFO - app - Application shutdown completed
2025-07-24 04:10:30,049 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:10:30,090 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:10:30,099 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:10:30,100 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:10:30,390 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:10:30,391 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:10:30,391 - INFO - app - Environment: PRODUCTION
2025-07-24 04:10:30,439 - INFO - app - Application startup initiated
2025-07-24 04:10:30,439 - INFO - app - Initializing core services...
2025-07-24 04:10:30,474 - INFO - app - Firebase initialized
2025-07-24 04:10:30,474 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:10:30,492 - INFO - app - Redis initialized
2025-07-24 04:10:30,937 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:10:30,940 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:10:30,943 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:10:30,943 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:10:30,944 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:10:30,944 - INFO - app - Scheduler initialized
2025-07-24 04:10:30,946 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:10:30,946 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:10:32,032 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:10:32,052 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:10:32,095 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:10:32,095 - INFO - app - Background tasks initialized
2025-07-24 04:10:32,095 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:10:32,846 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:10:32,847 - INFO - app - Application startup completed successfully
2025-07-24 04:10:32,847 - INFO - app - Starting cache validation task
2025-07-24 04:10:32,850 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:10:32,852 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:10:32,853 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:10:32,888 - INFO - app - Found 24 static orders cache entries to check
2025-07-24 04:10:32,893 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:10:32,894 - INFO - app - Validating cache for 30 users
2025-07-24 04:10:32,898 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:10:32,904 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,905 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:10:32,907 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:10:32,911 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:10:32,913 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:10:32,915 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:10:32,916 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:10:32,917 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,917 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:10:32,919 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:10:32,922 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:10:32,925 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:10:32,926 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:10:32,928 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,930 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:10:32,932 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:10:32,935 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:10:32,936 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:10:32,936 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:10:32,938 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:10:32,938 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,939 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:10:32,940 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:10:32,947 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,957 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,964 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,973 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,980 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,987 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 04:10:32,995 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,001 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,009 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,016 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,023 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,028 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,034 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,040 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,045 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,050 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,058 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,089 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,099 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,108 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:10:33,401 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.61067642848852953692599327% which is below threshold 100.0%
2025-07-24 04:10:33,403 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.61067642848852953692599327
2025-07-24 04:10:33,404 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 04:10:34,434 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:10:34,442 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:10:34,468 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:10:34,472 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:10:34,544 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:10:34,545 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:10:34,559 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:10:34,736 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:10:34,751 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:10:34,757 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:10:34,757 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:10:34,776 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:10:34,782 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:10:34,782 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:10:34,792 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:10:34,800 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:10:34,800 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:10:34,819 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:10:34,819 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:10:34,842 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:10:34,844 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:10:34,862 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:10:34,862 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:10:34,866 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:10:34,866 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:10:34,880 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:10:34,890 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:10:34,890 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:10:36,941 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:10:36,971 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 04:10:36,986 - INFO - app - Cache validation completed
2025-07-24 04:10:36,987 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:36,999 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,013 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,402 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.678443593127278026386120289% which is below threshold 100.0%
2025-07-24 04:10:37,428 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.678443593127278026386120289
2025-07-24 04:10:37,489 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,502 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,516 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,536 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,552 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,569 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,586 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:37,612 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:38,071 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.452772789904019458884011441% which is below threshold 100.0%
2025-07-24 04:10:38,075 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.452772789904019458884011441
2025-07-24 04:10:38,480 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.10212693536727818314118896% which is below threshold 100.0%
2025-07-24 04:10:38,482 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.10212693536727818314118896
2025-07-24 04:10:38,515 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:38,529 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:38,588 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:10:39,000 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:10:39,001 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:10:39,007 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:10:39,009 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:10:39,025 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:39,025 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:10:39,026 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:10:39,093 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:10:39,402 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:10:39,491 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:10:39,811 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:10:39,871 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:10:40,169 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:10:40,215 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:40,229 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:10:47,851 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:10:47,855 - INFO - app - Found 24 static orders cache entries to check
2025-07-24 04:10:47,857 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:10:47,860 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:10:47,862 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:10:47,864 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:10:47,866 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:10:47,868 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:10:47,870 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:10:47,873 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:10:47,878 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:10:47,881 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:10:47,883 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:10:47,885 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:10:47,886 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:10:47,887 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:10:47,888 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:10:47,890 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:10:47,891 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:11:10,240 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:11:10,249 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:11:10,255 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:11:10,269 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:11:10,275 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:11:10,726 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.25490831366784014855506983% which is below threshold 100.0%
2025-07-24 04:11:10,729 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.25490831366784014855506983
2025-07-24 04:11:14,522 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:11:14,637 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:14,677 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:14,705 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,247 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.356727918618940430240431641% which is below threshold 100.0%
2025-07-24 04:11:15,264 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.356727918618940430240431641
2025-07-24 04:11:15,347 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,377 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,410 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,444 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,490 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,521 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,553 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,585 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:15,972 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.409802210685541604482011650% which is below threshold 100.0%
2025-07-24 04:11:15,975 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.409802210685541604482011650
2025-07-24 04:11:16,453 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.99743324326462730144704077% which is below threshold 100.0%
2025-07-24 04:11:16,457 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.99743324326462730144704077
2025-07-24 04:11:16,506 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:16,522 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:16,615 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:11:16,916 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:11:16,919 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:11:16,930 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:11:16,931 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:11:16,965 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:16,966 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:11:16,967 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:11:17,063 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:11:17,359 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:11:17,565 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:11:17,906 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:11:18,023 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:11:18,415 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:11:18,452 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:18,487 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:48,504 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:11:48,516 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:11:48,525 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:11:48,536 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:11:48,540 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:11:49,031 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.27094495918604201323068591% which is below threshold 100.0%
2025-07-24 04:11:49,037 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.27094495918604201323068591
2025-07-24 04:11:52,820 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:11:52,987 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,043 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,083 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,541 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.367166493712595910388271794% which is below threshold 100.0%
2025-07-24 04:11:53,544 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.367166493712595910388271794
2025-07-24 04:11:53,588 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,602 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,623 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,662 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,712 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,746 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,763 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:53,794 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:54,214 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.416506362206103809912037489% which is below threshold 100.0%
2025-07-24 04:11:54,217 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.416506362206103809912037489
2025-07-24 04:11:54,698 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.01272496668076810463252521% which is below threshold 100.0%
2025-07-24 04:11:54,700 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.01272496668076810463252521
2025-07-24 04:11:54,804 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:54,837 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:54,942 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:11:55,239 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:11:55,246 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:11:55,261 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:11:55,263 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:11:55,301 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:55,302 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:11:55,303 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:11:55,416 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:11:55,713 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:11:55,816 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:11:56,101 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:11:56,164 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:11:56,446 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:11:56,464 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:11:56,480 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:00,013 - INFO - app - [SCHEDULER] Starting daily_swap_charge_job...
2025-07-24 04:12:00,013 - INFO - app - Executing daily swap charge job...
2025-07-24 04:12:00,167 - INFO - app - Daily swap charge job completed successfully
2025-07-24 04:12:26,489 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:12:26,501 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:12:26,509 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:12:26,530 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:12:26,533 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:12:26,920 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.36251039692057719834422995% which is below threshold 100.0%
2025-07-24 04:12:26,928 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.36251039692057719834422995
2025-07-24 04:12:30,175 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:12:30,872 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:30,909 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:30,948 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:31,405 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.460695462677848984517305210% which is below threshold 100.0%
2025-07-24 04:12:31,409 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.460695462677848984517305210
2025-07-24 04:12:31,486 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:31,526 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:31,563 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:31,607 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:31,665 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:31,710 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:31,811 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:31,863 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:32,721 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.452772789904019458884011441% which is below threshold 100.0%
2025-07-24 04:12:32,733 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.452772789904019458884011441
2025-07-24 04:12:33,137 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 12 symbols for user 9
2025-07-24 04:12:33,137 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'CADJPY', 'CHFJPY', 'EURCAD', 'EURJPY', 'EURUSD', 'GBPUSD', 'NZDJPY', 'NZDUSD', 'USDCAD', 'USDCHF', 'USDJPY']
2025-07-24 04:12:33,891 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.10186069553994358582858647% which is below threshold 100.0%
2025-07-24 04:12:33,899 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.10186069553994358582858647
2025-07-24 04:12:34,000 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:34,171 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:34,561 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:12:34,851 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:12:34,857 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:12:34,889 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:12:34,894 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:12:34,963 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:34,964 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:12:34,967 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:12:35,167 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:12:35,466 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:12:35,614 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:12:35,934 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:12:36,080 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:12:36,374 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:12:36,479 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:12:36,541 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:06,543 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:13:06,550 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:13:06,554 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:13:06,560 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:13:06,562 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:13:06,937 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.60293314054702309567101242% which is below threshold 100.0%
2025-07-24 04:13:06,938 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.60293314054702309567101242
2025-07-24 04:13:10,436 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:13:10,498 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:10,515 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:10,537 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:10,955 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.702418175730727554424189207% which is below threshold 100.0%
2025-07-24 04:13:10,957 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.702418175730727554424189207
2025-07-24 04:13:11,006 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:11,028 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:11,048 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:11,062 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:11,080 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:11,093 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:11,106 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:11,119 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:11,563 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.546630911191890334904373196% which is below threshold 100.0%
2025-07-24 04:13:11,568 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.546630911191890334904373196
2025-07-24 04:13:11,972 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.33076550708754313682535766% which is below threshold 100.0%
2025-07-24 04:13:11,974 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.33076550708754313682535766
2025-07-24 04:13:11,998 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:12,027 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:12,092 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:13:12,439 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:13:12,442 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:13:12,481 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:13:12,485 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:13:12,550 - INFO - app - Application shutdown initiated
2025-07-24 04:13:12,551 - INFO - app - Scheduler shutdown completed
2025-07-24 04:13:12,551 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:13:13,361 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:13:13,361 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:13:13,366 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:13:13,373 - INFO - app - Redis connection closed
2025-07-24 04:13:13,373 - INFO - app - Application shutdown completed
2025-07-24 04:14:47,917 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:14:47,964 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:14:47,976 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:14:47,976 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:14:48,297 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:14:48,297 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:14:48,297 - INFO - app - Environment: PRODUCTION
2025-07-24 04:14:48,353 - INFO - app - Application startup initiated
2025-07-24 04:14:48,353 - INFO - app - Initializing core services...
2025-07-24 04:14:48,386 - INFO - app - Firebase initialized
2025-07-24 04:14:48,386 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:14:48,404 - INFO - app - Redis initialized
2025-07-24 04:14:48,939 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:14:48,943 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:14:48,945 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:14:48,945 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:14:48,946 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:14:48,946 - INFO - app - Scheduler initialized
2025-07-24 04:14:48,948 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:14:48,949 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:14:49,868 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:14:49,872 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:14:49,922 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:14:49,922 - INFO - app - Background tasks initialized
2025-07-24 04:14:49,922 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:14:50,892 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:14:50,892 - INFO - app - Application startup completed successfully
2025-07-24 04:14:50,893 - INFO - app - Starting cache validation task
2025-07-24 04:14:50,895 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:14:50,897 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:14:50,898 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:14:50,924 - INFO - app - Found 24 static orders cache entries to check
2025-07-24 04:14:50,949 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:14:50,950 - INFO - app - Validating cache for 30 users
2025-07-24 04:14:50,960 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:14:50,965 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:14:50,970 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:14:50,972 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:14:50,975 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:14:50,978 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:14:50,980 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:14:50,983 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:14:50,985 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:14:50,988 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:14:50,989 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:14:50,997 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:14:51,000 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:14:51,002 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:14:51,004 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:14:51,005 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:14:51,006 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:14:51,007 - WARNING - app - User 23: Missing static orders cache, refreshing...
2025-07-24 04:14:51,008 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:14:51,011 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:14:51,013 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:14:51,024 - WARNING - app - User 31: Missing static orders cache, refreshing...
2025-07-24 04:14:51,046 - INFO - app - Cache validation completed
2025-07-24 04:14:51,424 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.81191728886997562768385624% which is below threshold 100.0%
2025-07-24 04:14:51,425 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.81191728886997562768385624
2025-07-24 04:14:51,454 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:51,467 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:51,483 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:51,921 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.922356670915845775378329607% which is below threshold 100.0%
2025-07-24 04:14:51,922 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.922356670915845775378329607
2025-07-24 04:14:51,970 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:51,994 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:52,019 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:52,043 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:52,069 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:52,093 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:52,118 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:52,143 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:52,502 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:14:52,566 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.631679305732891780171208533% which is below threshold 100.0%
2025-07-24 04:14:52,570 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.631679305732891780171208533
2025-07-24 04:14:52,617 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:14:52,618 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:14:52,654 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:14:52,679 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:14:52,738 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:14:52,768 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:14:52,887 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:14:52,907 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:14:52,907 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:14:53,013 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:14:53,024 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:14:53,040 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:14:53,041 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:14:53,049 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:14:53,076 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:14:53,076 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:14:53,119 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:14:53,149 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:14:53,150 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:14:53,165 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:14:53,165 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:14:53,203 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:14:53,208 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.53799907935633040144119032% which is below threshold 100.0%
2025-07-24 04:14:53,211 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.53799907935633040144119032
2025-07-24 04:14:53,238 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:14:53,238 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:14:53,245 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:14:53,252 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:53,256 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:14:53,256 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:14:53,272 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:53,399 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:14:53,862 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:14:53,866 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:14:53,875 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:14:53,877 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:14:53,894 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:53,898 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:14:53,901 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:14:54,076 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:14:54,376 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:14:54,488 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:14:54,891 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:14:55,012 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:14:55,300 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:14:55,329 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:14:55,344 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:00,016 - INFO - app - [SCHEDULER] Starting daily_swap_charge_job...
2025-07-24 04:15:00,016 - INFO - app - Executing daily swap charge job...
2025-07-24 04:15:00,113 - INFO - app - Daily swap charge job completed successfully
2025-07-24 04:15:05,904 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:15:05,907 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:15:05,908 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:15:05,910 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:15:05,911 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:15:05,912 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:15:05,914 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:15:05,915 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:15:05,916 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:15:05,918 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:15:05,920 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:15:05,925 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:15:05,928 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:15:05,929 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:15:05,930 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:15:05,931 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:15:05,932 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:15:05,933 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:15:05,934 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:15:05,935 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:15:05,936 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:15:08,907 - INFO - app - Application shutdown initiated
2025-07-24 04:15:08,908 - INFO - app - Scheduler shutdown completed
2025-07-24 04:15:08,908 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:15:09,732 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:15:09,732 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:15:09,743 - INFO - app - Redis connection closed
2025-07-24 04:15:09,743 - INFO - app - Application shutdown completed
2025-07-24 04:15:15,124 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:15:15,145 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:15:15,157 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:15:15,157 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-24 04:15:15,394 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:15:15,394 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:15:15,394 - INFO - app - Environment: PRODUCTION
2025-07-24 04:15:15,448 - INFO - app - Application startup initiated
2025-07-24 04:15:15,449 - INFO - app - Initializing core services...
2025-07-24 04:15:15,481 - INFO - app - Firebase initialized
2025-07-24 04:15:15,481 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:15:15,501 - INFO - app - Redis initialized
2025-07-24 04:15:17,236 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:15:17,244 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:15:17,246 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:15:17,247 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:15:17,248 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:15:17,248 - INFO - app - Scheduler initialized
2025-07-24 04:15:17,249 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:15:17,250 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:15:18,025 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:15:18,032 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:15:18,089 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:15:18,089 - INFO - app - Background tasks initialized
2025-07-24 04:15:18,089 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:15:18,662 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:15:18,662 - INFO - app - Application startup completed successfully
2025-07-24 04:15:18,663 - INFO - app - Starting cache validation task
2025-07-24 04:15:18,665 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:15:18,667 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:15:18,668 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:15:18,676 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:15:18,679 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:15:18,680 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:15:18,681 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:15:18,682 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:15:18,683 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:15:18,684 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:15:18,684 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:15:18,688 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:15:18,689 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:15:18,692 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:15:18,694 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:15:18,695 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:15:18,695 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:15:18,738 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:15:18,739 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:15:18,740 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:15:18,741 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:15:18,741 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:15:18,742 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:15:18,880 - INFO - app - Validating cache for 37 users
2025-07-24 04:15:18,887 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-24 04:15:18,970 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-24 04:15:19,042 - WARNING - app - User 27: Missing balance/margin cache, refreshing...
2025-07-24 04:15:19,106 - WARNING - app - User 28: Missing balance/margin cache, refreshing...
2025-07-24 04:15:19,453 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 0.0
2025-07-24 04:15:19,457 - WARNING - app - User 30: Missing balance/margin cache, refreshing...
2025-07-24 04:15:19,537 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:15:19,551 - INFO - app - Cache validation completed
2025-07-24 04:15:19,553 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:15:19,606 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:15:19,712 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:20,204 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:15:20,297 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:15:20,377 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:15:20,381 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:15:20,395 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:15:20,410 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:15:20,436 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:15:20,590 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:15:20,607 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:15:20,608 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-24 04:15:20,659 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:15:20,666 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:15:20,674 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:15:20,674 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:15:20,674 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-24 04:15:20,682 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:15:20,683 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-24 04:15:20,688 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:15:20,692 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:15:20,696 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:15:20,696 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-24 04:15:20,703 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:15:20,707 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:15:20,707 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-24 04:15:20,713 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:15:20,713 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-24 04:15:20,717 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:15:20,717 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://u43...
2025-07-24 04:15:20,828 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:15:20,903 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:21,305 - INFO - app - [AUTO-CUTOFF] User 13 margin_level: 0.0
2025-07-24 04:15:21,378 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:21,476 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:21,579 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:21,655 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:21,727 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:22,126 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 0.0
2025-07-24 04:15:22,197 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:22,608 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 0.0
2025-07-24 04:15:22,715 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:22,801 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:22,888 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:22,964 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:23,113 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 27, falling back to DB and updating cache.
2025-07-24 04:15:23,528 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-24 04:15:23,725 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 28, falling back to DB and updating cache.
2025-07-24 04:15:24,033 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-24 04:15:24,107 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:24,180 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:24,256 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:24,340 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:24,343 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:15:24,355 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:15:24,385 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:15:24,465 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:24,467 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:15:24,469 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:15:24,586 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:15:24,881 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-24 04:15:25,016 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:15:25,314 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:15:25,395 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:25,474 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:25,550 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:25,684 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-24 04:15:25,984 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 104.2924986860772639231047125
2025-07-24 04:15:33,678 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:15:33,681 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:15:33,684 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:15:33,686 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:15:33,689 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:15:33,691 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:15:33,693 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:15:33,696 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:15:33,699 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:15:33,703 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:15:33,705 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:15:33,710 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:15:33,711 - WARNING - app - Found stale cache entry for user live:9, will be refreshed on next access
2025-07-24 04:15:33,713 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:15:33,714 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:15:33,715 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:15:33,717 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:15:33,719 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:15:33,720 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:15:33,721 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:15:33,723 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:15:33,724 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:15:56,052 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:15:56,175 - INFO - app - [AUTO-CUTOFF] Found 25 live users and 12 demo users.
2025-07-24 04:15:56,449 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 4, falling back to DB and updating cache.
2025-07-24 04:15:56,755 - INFO - app - [AUTO-CUTOFF] User 4 margin_level: 0.0
2025-07-24 04:15:56,865 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:15:56,883 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:15:56,942 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:15:57,056 - WARNING - app - [AUTO-CUTOFF] User 9 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:57,314 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:15:57,610 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:15:57,856 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:15:58,150 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:15:58,284 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:58,500 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 13, falling back to DB and updating cache.
2025-07-24 04:15:58,825 - INFO - app - [AUTO-CUTOFF] User 13 margin_level: 0.0
2025-07-24 04:15:58,924 - WARNING - app - [AUTO-CUTOFF] User 14 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:59,028 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:59,193 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:59,314 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:59,411 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:15:59,614 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 20, falling back to DB and updating cache.
2025-07-24 04:15:59,901 - INFO - app - [AUTO-CUTOFF] User 20 margin_level: 0.0
2025-07-24 04:16:00,012 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:00,244 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 22, falling back to DB and updating cache.
2025-07-24 04:16:00,557 - INFO - app - [AUTO-CUTOFF] User 22 margin_level: 0.0
2025-07-24 04:16:00,726 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:00,834 - WARNING - app - [AUTO-CUTOFF] User 24 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:00,943 - WARNING - app - [AUTO-CUTOFF] User 25 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:01,071 - WARNING - app - [AUTO-CUTOFF] User 26 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:01,300 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 27, falling back to DB and updating cache.
2025-07-24 04:16:01,613 - INFO - app - [AUTO-CUTOFF] User 27 margin_level: 34131.15089514066496163682864
2025-07-24 04:16:01,865 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 28, falling back to DB and updating cache.
2025-07-24 04:16:02,171 - INFO - app - [AUTO-CUTOFF] User 28 margin_level: 103.2731888657176534590624717
2025-07-24 04:16:02,295 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:02,402 - WARNING - app - [AUTO-CUTOFF] User 30 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:02,513 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:02,628 - WARNING - app - [AUTO-CUTOFF] User 1 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:02,630 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:16:02,644 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:16:02,689 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:16:02,791 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:02,793 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:16:02,795 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:16:03,119 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:16:03,423 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-24 04:16:03,623 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:16:03,628 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:16:03,922 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:16:04,035 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:04,149 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:04,258 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:16:04,467 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 14, falling back to DB and updating cache.
2025-07-24 04:16:04,775 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 104.2924986860772639231047125
2025-07-24 04:16:13,002 - INFO - app - Application shutdown initiated
2025-07-24 04:16:13,003 - INFO - app - Scheduler shutdown completed
2025-07-24 04:16:13,004 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:16:14,540 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:16:14,540 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:16:14,568 - INFO - app - Redis connection closed
2025-07-24 04:16:14,569 - INFO - app - Application shutdown completed
2025-07-24 04:27:24,385 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:27:24,429 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:27:24,442 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:27:24,442 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:27:24,755 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:27:24,755 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:27:24,755 - INFO - app - Environment: PRODUCTION
2025-07-24 04:27:24,802 - INFO - app - Application startup initiated
2025-07-24 04:27:24,802 - INFO - app - Initializing core services...
2025-07-24 04:27:24,842 - INFO - app - Firebase initialized
2025-07-24 04:27:24,842 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:27:24,878 - INFO - app - Redis initialized
2025-07-24 04:27:25,504 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:27:25,509 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:27:25,511 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:27:25,512 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:27:25,513 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:27:25,513 - INFO - app - Scheduler initialized
2025-07-24 04:27:25,515 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:27:25,515 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:27:26,654 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:27:26,656 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:27:26,691 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:27:26,691 - INFO - app - Background tasks initialized
2025-07-24 04:27:26,691 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:27:27,290 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:27:27,290 - INFO - app - Application startup completed successfully
2025-07-24 04:27:27,290 - INFO - app - Starting cache validation task
2025-07-24 04:27:27,292 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:27:27,293 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:27:27,295 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:27:27,330 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:27:27,336 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:27:27,337 - INFO - app - Validating cache for 30 users
2025-07-24 04:27:27,346 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:27:27,348 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,351 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:27:27,354 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:27:27,356 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:27:27,358 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:27:27,359 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,359 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:27:27,361 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:27:27,364 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:27:27,367 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:27:27,368 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:27:27,368 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:27:27,372 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,374 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:27:27,374 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:27:27,376 - WARNING - app - Found stale cache entry for user live:9, will be refreshed on next access
2025-07-24 04:27:27,379 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:27:27,381 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:27:27,381 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:27:27,382 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,385 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:27:27,386 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:27:27,387 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:27:27,389 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:27:27,390 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:27:27,392 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:27:27,393 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,406 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,417 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,428 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,436 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,444 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,452 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,459 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,467 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,477 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,486 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,493 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,500 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,508 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,516 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,524 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,572 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,584 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,596 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,607 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,620 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,912 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:27:27,919 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 04:27:27,929 - INFO - app - Cache validation completed
2025-07-24 04:27:27,937 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:27,957 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:27,994 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:28,512 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.290620788476031569806437210% which is below threshold 100.0%
2025-07-24 04:27:28,513 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.290620788476031569806437210
2025-07-24 04:27:28,579 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:28,613 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:28,648 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:28,682 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:28,716 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:28,748 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:28,776 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:28,802 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:29,137 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:27:29,147 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:27:29,147 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:27:29,154 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:27:29,156 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:27:29,217 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:27:29,364 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.771337899343397421428354855% which is below threshold 100.0%
2025-07-24 04:27:29,367 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.771337899343397421428354855
2025-07-24 04:27:29,454 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:27:29,481 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:27:29,492 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:27:29,492 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:27:29,515 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:27:29,519 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:27:29,519 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:27:29,523 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:27:29,538 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:27:29,538 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:27:29,546 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:27:29,547 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:27:29,550 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:27:29,566 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:27:29,566 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:27:29,579 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:27:29,603 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:27:29,603 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:27:29,604 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:27:29,615 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:27:29,615 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:27:29,968 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.87718861938060737769676198% which is below threshold 100.0%
2025-07-24 04:27:29,970 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.87718861938060737769676198
2025-07-24 04:27:29,992 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:30,020 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:30,135 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:27:31,459 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:27:31,472 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:27:31,550 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:27:31,559 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:27:31,644 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:31,646 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:27:31,648 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:27:32,017 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:27:32,317 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:27:32,558 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:27:32,854 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:27:33,035 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:27:33,345 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:27:33,383 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:33,421 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:27:39,921 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 9 by invalidating refresh token.
2025-07-24 04:27:42,293 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:27:42,296 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:27:42,299 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:27:42,301 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:27:42,303 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:27:42,305 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:27:42,307 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:27:42,309 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:27:42,310 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:27:42,313 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:27:42,314 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:27:42,318 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:27:42,320 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:27:42,321 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:27:42,322 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:27:42,323 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:27:42,324 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:27:42,325 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:27:42,325 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:27:42,326 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:27:42,327 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:27:47,415 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 31
2025-07-24 04:27:47,415 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-24 04:28:03,429 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:28:03,439 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:28:03,445 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:28:03,464 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:28:03,467 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:28:03,963 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.33626059035165770435993655% which is below threshold 100.0%
2025-07-24 04:28:03,965 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.33626059035165770435993655
2025-07-24 04:28:07,297 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:28:07,577 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:07,657 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:07,699 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,134 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.447576008027177264730518512% which is below threshold 100.0%
2025-07-24 04:28:08,136 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.447576008027177264730518512
2025-07-24 04:28:08,223 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,259 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,291 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,326 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,364 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,407 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,440 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,478 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:08,891 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.841849402521973783061742203% which is below threshold 100.0%
2025-07-24 04:28:08,894 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.841849402521973783061742203
2025-07-24 04:28:09,396 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.04753773557019368674372102% which is below threshold 100.0%
2025-07-24 04:28:09,407 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.04753773557019368674372102
2025-07-24 04:28:09,480 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:09,524 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:09,675 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:28:10,007 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:28:10,009 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:28:10,020 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:28:10,023 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:28:10,065 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:10,068 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:28:10,069 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:28:10,194 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:28:10,521 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:28:10,714 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:28:11,029 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:28:11,253 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:28:11,568 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:28:11,665 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:11,704 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:41,706 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:28:41,718 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:28:41,724 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:28:41,742 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:28:41,746 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:28:42,158 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.21922269720298657588301288% which is below threshold 100.0%
2025-07-24 04:28:42,161 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.21922269720298657588301288
2025-07-24 04:28:45,745 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:28:45,863 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:45,915 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:45,962 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:46,983 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.334234733919630114938081146% which is below threshold 100.0%
2025-07-24 04:28:46,990 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.334234733919630114938081146
2025-07-24 04:28:47,129 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:47,161 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:47,195 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:47,223 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:47,257 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:47,291 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:47,323 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:47,376 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:47,789 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.793825442760358587883341026% which is below threshold 100.0%
2025-07-24 04:28:47,791 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.793825442760358587883341026
2025-07-24 04:28:48,283 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.93652938089614550948643225% which is below threshold 100.0%
2025-07-24 04:28:48,286 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.93652938089614550948643225
2025-07-24 04:28:48,374 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:48,436 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:48,587 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:28:48,878 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:28:48,882 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:28:48,896 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:28:48,898 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:28:48,930 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:48,931 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:28:48,932 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:28:49,032 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:28:49,321 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:28:49,444 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:28:49,762 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:28:49,931 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:28:50,258 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:28:50,341 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:28:50,393 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:20,403 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:29:20,412 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:29:20,418 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:29:20,438 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:29:20,443 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:29:20,865 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.22713523733993578088127200% which is below threshold 100.0%
2025-07-24 04:29:20,871 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.22713523733993578088127200
2025-07-24 04:29:24,431 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:29:24,656 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:24,701 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:24,737 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,132 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.348421332006416019482072364% which is below threshold 100.0%
2025-07-24 04:29:25,135 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.348421332006416019482072364
2025-07-24 04:29:25,216 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,248 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,342 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,396 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,439 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,470 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,502 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,537 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:25,985 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.795745727366750777378373553% which is below threshold 100.0%
2025-07-24 04:29:25,987 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.795745727366750777378373553
2025-07-24 04:29:26,497 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.93491828860765902351286795% which is below threshold 100.0%
2025-07-24 04:29:26,499 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.93491828860765902351286795
2025-07-24 04:29:26,541 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:26,579 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:26,689 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:29:27,012 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:29:27,017 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:29:27,032 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:29:27,035 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:29:27,075 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:27,078 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:29:27,079 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:29:27,216 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:29:27,551 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:29:27,743 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:29:28,138 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:29:28,254 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:29:28,652 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:29:28,691 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:28,736 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:29:58,748 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:29:58,766 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:29:58,774 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:29:58,800 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:29:58,803 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:29:59,212 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.19442725057062168749274633% which is below threshold 100.0%
2025-07-24 04:29:59,215 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.19442725057062168749274633
2025-07-24 04:30:02,607 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:30:02,807 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:02,866 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:02,898 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:03,325 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.323361909823968737962673756% which is below threshold 100.0%
2025-07-24 04:30:03,328 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.323361909823968737962673756
2025-07-24 04:30:03,399 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:03,440 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:03,499 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:03,536 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:03,567 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:03,598 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:03,632 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:03,664 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:04,087 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.786009547520306167482506881% which is below threshold 100.0%
2025-07-24 04:30:04,089 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.786009547520306167482506881
2025-07-24 04:30:04,565 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.91165302369595882758083502% which is below threshold 100.0%
2025-07-24 04:30:04,567 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.91165302369595882758083502
2025-07-24 04:30:04,617 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:04,793 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:04,973 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:30:05,268 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:30:05,271 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:30:05,280 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:30:05,282 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:30:05,320 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:05,322 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:30:05,323 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:30:05,441 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:30:05,772 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:30:05,897 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:30:06,212 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:30:06,346 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:30:06,718 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:30:06,764 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:06,808 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:19,061 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 31
2025-07-24 04:30:19,062 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-24 04:30:36,815 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:30:36,825 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:30:36,833 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:30:36,857 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:30:36,860 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:30:37,325 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.20826361754806762350574490% which is below threshold 100.0%
2025-07-24 04:30:37,328 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.20826361754806762350574490
2025-07-24 04:30:40,741 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:30:40,934 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:40,983 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,024 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,420 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.331225614393755529448234709% which is below threshold 100.0%
2025-07-24 04:30:41,423 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.331225614393755529448234709
2025-07-24 04:30:41,483 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,511 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,541 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,582 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,615 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,651 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,679 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:41,711 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:42,191 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.798996735516169133277858445% which is below threshold 100.0%
2025-07-24 04:30:42,195 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.798996735516169133277858445
2025-07-24 04:30:42,682 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.94323316321518567804491493% which is below threshold 100.0%
2025-07-24 04:30:42,689 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.94323316321518567804491493
2025-07-24 04:30:42,748 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:42,788 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:42,910 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:30:43,197 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:30:43,202 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:30:43,216 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:30:43,218 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:30:43,271 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:43,272 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:30:43,273 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:30:43,373 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:30:43,710 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:30:43,835 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:30:44,192 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:30:44,376 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:30:44,735 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:30:44,797 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:30:44,839 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:00,009 - INFO - app - [SCHEDULER] Starting daily_swap_charge_job...
2025-07-24 04:31:00,010 - INFO - app - Executing daily swap charge job...
2025-07-24 04:31:00,140 - INFO - app - Daily swap charge job completed successfully
2025-07-24 04:31:14,855 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:31:14,866 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:31:14,875 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:31:14,898 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:31:14,902 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:31:15,333 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.12621861580718789895160354% which is below threshold 100.0%
2025-07-24 04:31:15,336 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.12621861580718789895160354
2025-07-24 04:31:18,629 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:31:18,739 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:18,790 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:18,830 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,345 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.244783219160641203147825008% which is below threshold 100.0%
2025-07-24 04:31:19,346 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.244783219160641203147825008
2025-07-24 04:31:19,396 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,424 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,452 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,472 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,489 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,511 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,529 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,548 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:19,899 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.757003143202697831425962922% which is below threshold 100.0%
2025-07-24 04:31:19,902 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.757003143202697831425962922
2025-07-24 04:31:20,268 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.84043728321507392558405679% which is below threshold 100.0%
2025-07-24 04:31:20,272 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.84043728321507392558405679
2025-07-24 04:31:20,310 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:20,355 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:20,479 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:31:20,762 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:31:20,769 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:31:20,790 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:31:20,792 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:31:20,838 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:20,840 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:31:20,841 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:31:21,061 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:31:21,344 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:31:21,425 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:31:21,706 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:31:21,818 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:31:22,104 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:31:22,134 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:22,150 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:52,154 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:31:52,159 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:31:52,162 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:31:52,172 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:31:52,173 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:31:52,533 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.00321458276915934852412086% which is below threshold 100.0%
2025-07-24 04:31:52,535 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.00321458276915934852412086
2025-07-24 04:31:55,942 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:31:56,044 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,092 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,111 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,469 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.131018313767909281668283338% which is below threshold 100.0%
2025-07-24 04:31:56,471 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.131018313767909281668283338
2025-07-24 04:31:56,511 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,531 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,552 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,571 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,593 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,619 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,641 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:56,664 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:57,019 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.745279300342619200824711705% which is below threshold 100.0%
2025-07-24 04:31:57,021 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.745279300342619200824711705
2025-07-24 04:31:57,366 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.81228412813999989213873662% which is below threshold 100.0%
2025-07-24 04:31:57,369 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.81228412813999989213873662
2025-07-24 04:31:57,414 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:57,429 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:57,488 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:31:57,764 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:31:57,768 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:31:57,785 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:31:57,788 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:31:57,812 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:57,813 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:31:57,813 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:31:57,854 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:31:58,138 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:31:58,232 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:31:58,518 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:31:58,614 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:31:58,893 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:31:58,926 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:31:58,954 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:27,932 - INFO - app - Starting cache validation task
2025-07-24 04:32:27,938 - INFO - app - Validating cache for 30 users
2025-07-24 04:32:27,941 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:32:27,949 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 04:32:27,963 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 04:32:27,970 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 04:32:27,975 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 04:32:27,981 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 04:32:27,986 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 04:32:27,992 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 04:32:27,997 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,002 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,007 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,013 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,018 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,024 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,030 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,036 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,042 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,047 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,051 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,056 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,061 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,068 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 04:32:28,074 - INFO - app - Cache validation completed
2025-07-24 04:32:28,957 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:32:28,961 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:32:28,966 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:32:28,976 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:32:28,978 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:32:29,352 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.12583779836744168052922744% which is below threshold 100.0%
2025-07-24 04:32:29,355 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.12583779836744168052922744
2025-07-24 04:32:32,760 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:32:32,875 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:32,925 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:32,948 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,306 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.260223755978324268905123667% which is below threshold 100.0%
2025-07-24 04:32:33,307 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.260223755978324268905123667
2025-07-24 04:32:33,355 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,377 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,401 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,424 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,446 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,473 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,501 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,523 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:33,861 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.741893535378717182504522776% which is below threshold 100.0%
2025-07-24 04:32:33,863 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.741893535378717182504522776
2025-07-24 04:32:34,232 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.84090149624734946305229490% which is below threshold 100.0%
2025-07-24 04:32:34,233 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.84090149624734946305229490
2025-07-24 04:32:34,254 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:34,277 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:34,346 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:32:34,617 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:32:34,618 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:32:34,623 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:32:34,625 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:32:34,641 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:34,642 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:32:34,643 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:32:34,738 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:32:34,741 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:32:35,020 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-24 04:32:35,139 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:32:35,412 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:32:35,482 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:32:35,763 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:32:35,786 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:35,802 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:32:38,452 - INFO - app - Application shutdown initiated
2025-07-24 04:32:38,453 - INFO - app - Scheduler shutdown completed
2025-07-24 04:32:38,453 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:32:39,723 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:32:39,723 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:32:39,732 - INFO - app - Redis connection closed
2025-07-24 04:32:39,732 - INFO - app - Application shutdown completed
2025-07-24 04:36:45,758 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:36:45,815 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:36:45,831 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:36:45,831 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:36:46,190 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:36:46,191 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:36:46,191 - INFO - app - Environment: PRODUCTION
2025-07-24 04:36:46,246 - INFO - app - Application startup initiated
2025-07-24 04:36:46,246 - INFO - app - Initializing core services...
2025-07-24 04:36:46,296 - INFO - app - Firebase initialized
2025-07-24 04:36:46,296 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:36:46,317 - INFO - app - Redis initialized
2025-07-24 04:36:46,792 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:36:46,795 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:36:46,799 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:36:46,800 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:36:46,801 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:36:46,801 - INFO - app - Scheduler initialized
2025-07-24 04:36:46,803 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:36:46,804 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:36:48,009 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:36:48,020 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:36:48,045 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:36:48,046 - INFO - app - Background tasks initialized
2025-07-24 04:36:48,046 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:36:48,755 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:36:48,756 - INFO - app - Application startup completed successfully
2025-07-24 04:36:48,756 - INFO - app - Starting cache validation task
2025-07-24 04:36:48,758 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:36:48,759 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:36:48,761 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:36:48,791 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:36:48,807 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:36:48,810 - INFO - app - Validating cache for 30 users
2025-07-24 04:36:48,814 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:36:48,827 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:36:48,831 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:36:48,833 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:36:48,834 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:36:48,835 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:36:48,836 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 04:36:48,837 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:36:48,839 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:36:48,842 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:36:48,845 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:36:48,845 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:36:48,848 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:36:48,850 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:36:48,854 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:36:48,855 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:36:48,857 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:36:48,859 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:36:48,859 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:36:48,860 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:36:48,861 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:36:48,862 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:36:48,863 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:36:48,880 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 04:36:48,903 - INFO - app - Cache validation completed
2025-07-24 04:36:49,369 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.33647215559596115903903439% which is below threshold 100.0%
2025-07-24 04:36:49,371 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.33647215559596115903903439
2025-07-24 04:36:49,407 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:49,438 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:49,471 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:49,977 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.481028335211135689613793903% which is below threshold 100.0%
2025-07-24 04:36:49,979 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.481028335211135689613793903
2025-07-24 04:36:50,026 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:50,048 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:50,072 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:50,096 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:50,119 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:50,147 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:50,178 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:50,221 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:50,377 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:36:50,411 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:36:50,430 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:36:50,449 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:36:50,453 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:36:50,476 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:36:50,495 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:36:50,663 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:36:50,683 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:36:50,683 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:36:50,701 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:36:50,716 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:36:50,717 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:36:50,717 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:36:50,729 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:36:50,736 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:36:50,736 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:36:50,744 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:36:50,748 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:36:50,749 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:36:50,763 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:36:50,763 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:36:50,765 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.840501834377137158854701834% which is below threshold 100.0%
2025-07-24 04:36:50,769 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.840501834377137158854701834
2025-07-24 04:36:50,770 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:36:50,774 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:36:50,782 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:36:50,782 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:36:50,785 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:36:50,785 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:36:51,210 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 68.24564406042497201239148423% which is below threshold 100.0%
2025-07-24 04:36:51,214 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 68.24564406042497201239148423
2025-07-24 04:36:51,236 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:51,252 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:51,342 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:36:51,794 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:36:51,795 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:36:51,804 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:36:51,805 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:36:51,828 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:51,829 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:36:51,829 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:36:51,891 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:36:52,197 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:36:52,269 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:36:52,565 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:36:52,662 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:36:53,060 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:36:53,083 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:36:53,103 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:03,763 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:37:03,766 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:37:03,768 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:37:03,770 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:37:03,771 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:37:03,772 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:37:03,773 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:37:03,774 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:37:03,775 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:37:03,777 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:37:03,778 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:37:03,781 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:37:03,783 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:37:03,783 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:37:03,783 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:37:03,784 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:37:03,785 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:37:03,785 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:37:03,785 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:37:03,786 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:37:03,786 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:37:23,113 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:37:23,123 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:37:23,130 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:37:23,145 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:37:23,148 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:37:24,083 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.21097165267515184339819722% which is below threshold 100.0%
2025-07-24 04:37:24,085 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.21097165267515184339819722
2025-07-24 04:37:27,776 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:37:27,890 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:27,917 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:27,940 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,301 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.346129877888661627103825437% which is below threshold 100.0%
2025-07-24 04:37:28,304 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.346129877888661627103825437
2025-07-24 04:37:28,349 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,365 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,385 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,400 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,414 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,428 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,442 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,456 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:28,898 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.790574434610940231983856134% which is below threshold 100.0%
2025-07-24 04:37:28,902 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.790574434610940231983856134
2025-07-24 04:37:28,971 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-24 04:37:29,308 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-24 04:37:29,341 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:29,354 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:29,399 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:37:29,401 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:37:29,716 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 0.0
2025-07-24 04:37:29,729 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:37:29,752 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:37:29,753 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:37:29,772 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:29,773 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:37:29,773 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:37:29,833 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:37:30,121 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:37:30,178 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:37:30,180 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:37:30,488 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:37:30,558 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:37:30,560 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:37:30,851 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:37:30,889 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:37:30,903 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:00,919 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:38:00,928 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:38:00,935 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:38:00,946 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:38:00,947 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:38:01,391 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.18863036287670702928546559% which is below threshold 100.0%
2025-07-24 04:38:01,394 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.18863036287670702928546559
2025-07-24 04:38:05,126 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:38:05,252 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,306 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,320 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,683 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.321152145338961091809607835% which is below threshold 100.0%
2025-07-24 04:38:05,686 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.321152145338961091809607835
2025-07-24 04:38:05,725 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,740 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,754 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,767 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,781 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,798 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,812 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:05,826 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:07,009 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.784763046986332290090994539% which is below threshold 100.0%
2025-07-24 04:38:07,015 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.784763046986332290090994539
2025-07-24 04:38:07,113 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-24 04:38:07,511 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-24 04:38:07,532 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:07,553 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:07,713 - INFO - app - Application shutdown initiated
2025-07-24 04:38:07,714 - INFO - app - Scheduler shutdown completed
2025-07-24 04:38:07,714 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:38:09,247 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:38:09,247 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:38:09,266 - INFO - app - Redis connection closed
2025-07-24 04:38:09,267 - INFO - app - Application shutdown completed
2025-07-24 04:38:29,771 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:38:29,793 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:38:29,805 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:38:29,805 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:38:30,052 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:38:30,052 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:38:30,052 - INFO - app - Environment: PRODUCTION
2025-07-24 04:38:30,119 - INFO - app - Application startup initiated
2025-07-24 04:38:30,119 - INFO - app - Initializing core services...
2025-07-24 04:38:30,161 - INFO - app - Firebase initialized
2025-07-24 04:38:30,161 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:38:30,179 - INFO - app - Redis initialized
2025-07-24 04:38:30,645 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:38:30,649 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:38:30,651 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:38:30,651 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:38:30,652 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:38:30,652 - INFO - app - Scheduler initialized
2025-07-24 04:38:30,653 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:38:30,654 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:38:31,458 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:38:31,476 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:38:31,503 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:38:31,503 - INFO - app - Background tasks initialized
2025-07-24 04:38:31,503 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:38:32,179 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:38:32,179 - INFO - app - Application startup completed successfully
2025-07-24 04:38:32,180 - INFO - app - Starting cache validation task
2025-07-24 04:38:32,182 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:38:32,183 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:38:32,186 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:38:32,215 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:38:32,223 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:38:32,227 - INFO - app - Validating cache for 30 users
2025-07-24 04:38:32,229 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:38:32,250 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:38:32,250 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,252 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:38:32,255 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:38:32,257 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:38:32,258 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:38:32,259 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,259 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:38:32,262 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:38:32,265 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:38:32,265 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:38:32,268 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:38:32,269 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,271 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:38:32,271 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:38:32,275 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:38:32,277 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:38:32,277 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,277 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:38:32,281 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:38:32,283 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:38:32,284 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:38:32,285 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:38:32,286 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:38:32,286 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,287 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:38:32,298 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,305 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,311 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,323 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,331 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,338 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,344 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,350 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,357 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,365 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,372 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,382 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,388 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,691 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.21105627877287322526983636% which is below threshold 100.0%
2025-07-24 04:38:32,696 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.21105627877287322526983636
2025-07-24 04:38:32,709 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,719 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,726 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,729 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:32,738 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 04:38:32,747 - INFO - app - Cache validation completed
2025-07-24 04:38:32,753 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:32,820 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:33,304 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.350606630711218277718214255% which is below threshold 100.0%
2025-07-24 04:38:33,306 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.350606630711218277718214255
2025-07-24 04:38:33,379 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:33,420 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:33,460 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:33,496 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:33,532 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:33,564 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:33,595 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:33,622 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:34,122 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.790574434610940231983856134% which is below threshold 100.0%
2025-07-24 04:38:34,124 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.790574434610940231983856134
2025-07-24 04:38:34,190 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:38:34,196 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:38:34,232 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:38:34,248 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:38:34,264 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:38:34,284 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:38:34,454 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:38:34,464 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:38:34,471 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:38:34,471 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:38:34,482 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:38:34,485 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:38:34,485 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:38:34,498 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:38:34,500 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:38:34,501 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:38:34,501 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:38:34,511 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:38:34,512 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:38:34,514 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:38:34,514 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:38:34,515 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:38:34,515 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:38:34,522 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:38:34,522 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:38:34,524 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:38:34,524 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:38:34,684 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.92237771007397576002425377% which is below threshold 100.0%
2025-07-24 04:38:34,685 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.92237771007397576002425377
2025-07-24 04:38:34,703 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:34,721 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:34,780 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:38:35,254 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:38:35,259 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:38:35,271 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:38:35,272 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:38:35,287 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:35,288 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:38:35,288 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:38:35,351 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:38:35,766 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:38:35,825 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:38:36,176 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:38:36,235 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:38:36,561 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:38:36,595 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:36,611 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:38:47,189 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:38:47,193 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:38:47,195 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:38:47,197 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:38:47,199 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:38:47,200 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:38:47,202 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:38:47,203 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:38:47,205 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:38:47,207 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:38:47,207 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:38:47,210 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:38:47,213 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:38:47,213 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:38:47,214 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:38:47,216 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:38:47,217 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:38:47,217 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:38:47,218 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:38:47,219 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:38:47,219 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:39:06,620 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:39:06,624 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:39:06,627 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:39:06,633 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:39:06,635 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:39:06,999 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.22336937599133428759333050% which is below threshold 100.0%
2025-07-24 04:39:07,002 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.22336937599133428759333050
2025-07-24 04:39:10,678 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:39:10,802 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:10,847 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:10,871 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,294 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.355749676266390930582745145% which is below threshold 100.0%
2025-07-24 04:39:11,295 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.355749676266390930582745145
2025-07-24 04:39:11,335 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,361 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,385 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,413 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,441 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,459 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,477 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,491 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:11,907 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.795476213737783452536965479% which is below threshold 100.0%
2025-07-24 04:39:11,913 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.795476213737783452536965479
2025-07-24 04:39:12,318 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.93287711659809384571620459% which is below threshold 100.0%
2025-07-24 04:39:12,323 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.93287711659809384571620459
2025-07-24 04:39:12,354 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:12,368 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:12,423 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:39:12,730 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:39:12,734 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:39:12,744 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:39:12,746 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:39:12,768 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:12,769 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:39:12,770 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:39:12,835 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:39:13,242 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:39:13,365 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:39:13,653 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:39:13,716 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:39:14,043 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:39:14,100 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:14,118 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:16,621 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 31 by invalidating refresh token.
2025-07-24 04:39:39,415 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 12 symbols for user 9
2025-07-24 04:39:39,416 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDJPY', 'CADJPY', 'CHFJPY', 'EURCAD', 'EURJPY', 'EURUSD', 'GBPUSD', 'NZDJPY', 'NZDUSD', 'USDCAD', 'USDCHF', 'USDJPY']
2025-07-24 04:39:44,120 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:39:44,129 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:39:44,135 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:39:44,145 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:39:44,148 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:39:44,575 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.22611972416727919842160238% which is below threshold 100.0%
2025-07-24 04:39:44,579 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.22611972416727919842160238
2025-07-24 04:39:47,926 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:39:48,005 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,051 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,095 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,471 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.361651246443363314008482991% which is below threshold 100.0%
2025-07-24 04:39:48,473 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.361651246443363314008482991
2025-07-24 04:39:48,531 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,561 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,583 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,600 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,658 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,685 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,731 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:48,749 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:49,107 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.792039914968450060809012536% which is below threshold 100.0%
2025-07-24 04:39:49,111 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.792039914968450060809012536
2025-07-24 04:39:49,506 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.77927721621274924229169140% which is below threshold 100.0%
2025-07-24 04:39:49,509 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.77927721621274924229169140
2025-07-24 04:39:49,536 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:49,551 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:49,607 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:39:49,902 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:39:49,906 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:39:49,928 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:39:49,930 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:39:49,948 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:49,948 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:39:49,949 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:39:50,002 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:39:50,344 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:39:50,407 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:39:50,699 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:39:50,765 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:39:51,053 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:39:51,108 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:39:51,124 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:21,135 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:40:21,138 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:40:21,141 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:40:21,145 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:40:21,146 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:40:21,790 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.22180379318348872296800650% which is below threshold 100.0%
2025-07-24 04:40:21,793 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.22180379318348872296800650
2025-07-24 04:40:25,252 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:40:25,302 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,319 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,336 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,741 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.352607591887737574871054235% which is below threshold 100.0%
2025-07-24 04:40:25,744 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.352607591887737574871054235
2025-07-24 04:40:25,792 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,812 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,827 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,842 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,856 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,876 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,890 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:25,905 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:26,261 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.794836118868986056038621303% which is below threshold 100.0%
2025-07-24 04:40:26,264 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.794836118868986056038621303
2025-07-24 04:40:26,656 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.93257674345956264169164144% which is below threshold 100.0%
2025-07-24 04:40:26,659 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.93257674345956264169164144
2025-07-24 04:40:26,685 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:26,699 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:26,750 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:40:27,055 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:40:27,058 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:40:27,068 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:40:27,069 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:40:27,084 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:27,084 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:40:27,085 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:40:27,131 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:40:27,429 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:40:27,485 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:40:27,784 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:40:27,838 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:40:28,131 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:40:28,171 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:28,185 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:40:58,186 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:40:58,192 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:40:58,196 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:40:58,201 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:40:58,203 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:40:58,572 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.10332725637355410267321753% which is below threshold 100.0%
2025-07-24 04:40:58,575 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.10332725637355410267321753
2025-07-24 04:41:02,294 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:41:02,371 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,403 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,435 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,794 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.233067723406712717592566452% which is below threshold 100.0%
2025-07-24 04:41:02,796 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.233067723406712717592566452
2025-07-24 04:41:02,842 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,860 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,877 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,894 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,912 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,927 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,947 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:02,962 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:03,309 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.748597686899279387934548615% which is below threshold 100.0%
2025-07-24 04:41:03,311 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.748597686899279387934548615
2025-07-24 04:41:03,678 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.81992998984807044733137922% which is below threshold 100.0%
2025-07-24 04:41:03,682 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.81992998984807044733137922
2025-07-24 04:41:03,704 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:03,719 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:03,764 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:41:04,058 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:41:04,061 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:41:04,068 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:41:04,069 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:41:04,089 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:04,090 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:41:04,091 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:41:04,152 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:41:04,453 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:41:04,525 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:41:04,861 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:41:05,041 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:41:05,880 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:41:05,898 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:05,913 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:35,920 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:41:35,929 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:41:35,934 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:41:35,946 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:41:35,947 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:41:36,264 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.05056288444427250570621687% which is below threshold 100.0%
2025-07-24 04:41:36,272 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.05056288444427250570621687
2025-07-24 04:41:39,576 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:41:39,662 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:39,693 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:39,723 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,128 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.180542169224944437131747143% which is below threshold 100.0%
2025-07-24 04:41:40,131 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.180542169224944437131747143
2025-07-24 04:41:40,196 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,228 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,262 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,302 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,335 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,378 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,414 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,448 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:40,887 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.727103974989135231832254717% which is below threshold 100.0%
2025-07-24 04:41:40,891 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.727103974989135231832254717
2025-07-24 04:41:41,510 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.76780159698840409498699760% which is below threshold 100.0%
2025-07-24 04:41:41,514 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.76780159698840409498699760
2025-07-24 04:41:41,567 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:41,598 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:41,716 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:41:42,130 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:41:42,136 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:41:42,175 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:41:42,177 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:41:42,210 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:41:42,212 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:41:42,213 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:41:42,371 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:41:42,742 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:41:42,952 - INFO - app - Application shutdown initiated
2025-07-24 04:41:42,953 - INFO - app - Scheduler shutdown completed
2025-07-24 04:41:42,954 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:41:44,260 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:41:44,261 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:41:44,276 - INFO - app - Redis connection closed
2025-07-24 04:41:44,276 - INFO - app - Application shutdown completed
2025-07-24 04:41:46,152 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:41:46,181 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:41:46,192 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:41:46,192 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:41:46,465 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:41:46,465 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:41:46,465 - INFO - app - Environment: PRODUCTION
2025-07-24 04:41:46,516 - INFO - app - Application startup initiated
2025-07-24 04:41:46,516 - INFO - app - Initializing core services...
2025-07-24 04:41:46,553 - INFO - app - Firebase initialized
2025-07-24 04:41:46,553 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:41:46,569 - INFO - app - Redis initialized
2025-07-24 04:41:47,073 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:41:47,078 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:41:47,081 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:41:47,081 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:41:47,083 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:41:47,083 - INFO - app - Scheduler initialized
2025-07-24 04:41:47,085 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:41:47,086 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:41:48,066 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:41:48,094 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:41:48,141 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:41:48,141 - INFO - app - Background tasks initialized
2025-07-24 04:41:48,141 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:41:48,782 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:41:48,782 - INFO - app - Application startup completed successfully
2025-07-24 04:41:48,782 - INFO - app - Starting cache validation task
2025-07-24 04:41:48,785 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:41:48,787 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:41:48,790 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:41:48,828 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:41:48,888 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:41:48,888 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:41:48,890 - INFO - app - Application shutdown initiated
2025-07-24 04:41:48,890 - INFO - app - Scheduler shutdown completed
2025-07-24 04:41:48,900 - INFO - app - Redis connection closed
2025-07-24 04:41:48,901 - INFO - app - Application shutdown completed
2025-07-24 04:45:52,538 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:45:52,559 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:45:52,570 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:45:52,570 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:45:52,804 - INFO - app - Application starting up - Trading system initialized
2025-07-24 04:45:52,804 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 04:45:52,804 - INFO - app - Environment: PRODUCTION
2025-07-24 04:45:52,859 - INFO - app - Application startup initiated
2025-07-24 04:45:52,859 - INFO - app - Initializing core services...
2025-07-24 04:45:52,890 - INFO - app - Firebase initialized
2025-07-24 04:45:52,890 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 04:45:52,915 - INFO - app - Redis initialized
2025-07-24 04:45:53,362 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 04:45:53,364 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 04:45:53,366 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 04:45:53,367 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 04:45:53,367 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 04:45:53,367 - INFO - app - Scheduler initialized
2025-07-24 04:45:53,369 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:45:53,369 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 04:45:54,333 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 04:45:54,343 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:45:54,371 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 04:45:54,371 - INFO - app - Background tasks initialized
2025-07-24 04:45:54,371 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 04:45:54,946 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 04:45:54,946 - INFO - app - Application startup completed successfully
2025-07-24 04:45:54,958 - INFO - app - Starting cache validation task
2025-07-24 04:45:54,959 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 04:45:54,960 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 04:45:54,961 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:45:54,976 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:45:54,981 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:45:54,983 - INFO - app - Validating cache for 30 users
2025-07-24 04:45:54,997 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:45:54,997 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:45:55,003 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:45:55,006 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:45:55,008 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:45:55,011 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:45:55,011 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,012 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:45:55,014 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:45:55,017 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:45:55,020 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:45:55,022 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:45:55,023 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:45:55,024 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:45:55,026 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,031 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:45:55,036 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:45:55,037 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:45:55,039 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,039 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:45:55,042 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:45:55,045 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:45:55,046 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:45:55,048 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:45:55,051 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:45:55,051 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,052 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:45:55,060 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,070 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,079 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,088 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,099 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,110 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,119 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,127 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,137 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,144 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,150 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,155 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,161 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,203 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,213 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,221 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,231 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,241 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 04:45:55,528 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.26369371155557274942937831% which is below threshold 100.0%
2025-07-24 04:45:55,530 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.26369371155557274942937831
2025-07-24 04:45:56,713 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:45:56,720 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:45:56,748 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:45:56,763 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:45:56,765 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:45:56,812 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:45:56,830 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 04:45:57,050 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:45:57,058 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:45:57,075 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:45:57,076 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:45:57,079 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:45:57,081 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:45:57,082 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:45:57,085 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:45:57,093 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:45:57,101 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:45:57,101 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:45:57,106 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:45:57,106 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:45:57,113 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:45:57,113 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:45:57,129 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:45:57,133 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 04:45:57,142 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:45:57,143 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:45:57,146 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 04:45:57,146 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 04:45:58,722 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:45:58,742 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 04:45:58,778 - INFO - app - Cache validation completed
2025-07-24 04:45:58,791 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:58,836 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:58,869 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,306 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.628613500048360182576870873% which is below threshold 100.0%
2025-07-24 04:45:59,308 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.628613500048360182576870873
2025-07-24 04:45:59,396 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,421 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,443 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,461 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,479 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,504 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,522 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,539 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:45:59,894 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.809591990054947091105713352% which is below threshold 100.0%
2025-07-24 04:45:59,898 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.809591990054947091105713352
2025-07-24 04:46:00,279 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.96803442713073952481106018% which is below threshold 100.0%
2025-07-24 04:46:00,282 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.96803442713073952481106018
2025-07-24 04:46:00,309 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:00,336 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:00,421 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:46:00,886 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:46:00,888 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:46:00,896 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:46:00,898 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:46:00,921 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:00,922 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:46:00,923 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:46:00,989 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:46:01,297 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:46:01,356 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:46:01,689 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:46:01,804 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:46:02,117 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:46:02,149 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:02,166 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:09,964 - INFO - app - Starting stale cache cleanup task
2025-07-24 04:46:09,966 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 04:46:09,967 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 04:46:09,968 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 04:46:09,968 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 04:46:09,969 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 04:46:09,969 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 04:46:09,969 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 04:46:09,970 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 04:46:09,970 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 04:46:09,971 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 04:46:09,972 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 04:46:09,973 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 04:46:09,974 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 04:46:09,974 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 04:46:09,975 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 04:46:09,975 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 04:46:09,976 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 04:46:09,976 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 04:46:09,977 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 04:46:09,977 - INFO - app - Completed stale cache cleanup task
2025-07-24 04:46:32,170 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:46:32,177 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:46:32,183 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:46:32,193 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:46:32,194 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:46:32,546 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.25755831947077256373554103% which is below threshold 100.0%
2025-07-24 04:46:32,548 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.25755831947077256373554103
2025-07-24 04:46:35,905 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:46:35,980 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,031 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,076 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,524 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.403258027752957839392466657% which is below threshold 100.0%
2025-07-24 04:46:36,537 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.403258027752957839392466657
2025-07-24 04:46:36,586 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,605 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,627 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,647 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,666 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,695 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,714 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:36,733 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:37,107 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.809575145453136633303125347% which is below threshold 100.0%
2025-07-24 04:46:37,110 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.809575145453136633303125347
2025-07-24 04:46:37,520 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.96704456110603397070010220% which is below threshold 100.0%
2025-07-24 04:46:37,524 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.96704456110603397070010220
2025-07-24 04:46:37,572 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:37,598 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:37,656 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:46:37,956 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:46:37,958 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:46:37,967 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:46:37,968 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:46:37,988 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:37,989 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:46:37,990 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:46:38,038 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:46:38,324 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:46:38,403 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:46:38,688 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:46:38,804 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:46:39,091 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:46:39,109 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:46:39,124 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:09,131 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 04:47:09,136 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 04:47:09,143 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 04:47:09,161 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:47:09,164 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 04:47:09,503 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.26077411118418507485782816% which is below threshold 100.0%
2025-07-24 04:47:09,505 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.26077411118418507485782816
2025-07-24 04:47:12,686 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 04:47:12,817 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:12,844 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:12,861 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,217 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.406468129631368461049964685% which is below threshold 100.0%
2025-07-24 04:47:13,219 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 3.406468129631368461049964685
2025-07-24 04:47:13,258 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,278 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,307 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,324 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,343 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,363 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,384 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,402 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:13,752 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.810383686340038607827349569% which is below threshold 100.0%
2025-07-24 04:47:13,754 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.810383686340038607827349569
2025-07-24 04:47:14,135 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.96965917274370433261628349% which is below threshold 100.0%
2025-07-24 04:47:14,138 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.96965917274370433261628349
2025-07-24 04:47:14,166 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:14,181 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:14,247 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 04:47:14,543 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 04:47:14,545 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 04:47:14,555 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 04:47:14,557 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 04:47:14,581 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:14,582 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 04:47:14,582 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 04:47:14,677 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 04:47:14,965 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 04:47:15,047 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 04:47:15,345 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 04:47:15,427 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 04:47:15,719 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 04:47:15,741 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:15,759 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 04:47:22,797 - INFO - app - Application shutdown initiated
2025-07-24 04:47:22,797 - INFO - app - Scheduler shutdown completed
2025-07-24 04:47:22,797 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 04:47:23,424 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 04:47:23,424 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 04:47:23,433 - INFO - app - Redis connection closed
2025-07-24 04:47:23,433 - INFO - app - Application shutdown completed
2025-07-24 05:38:50,661 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:38:50,705 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:38:50,717 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:38:50,717 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:38:51,040 - INFO - app - Application starting up - Trading system initialized
2025-07-24 05:38:51,040 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 05:38:51,040 - INFO - app - Environment: PRODUCTION
2025-07-24 05:38:51,097 - INFO - app - Application startup initiated
2025-07-24 05:38:51,097 - INFO - app - Initializing core services...
2025-07-24 05:38:51,139 - INFO - app - Firebase initialized
2025-07-24 05:38:51,140 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 05:38:51,188 - INFO - app - Redis initialized
2025-07-24 05:38:51,791 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 05:38:51,795 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 05:38:51,799 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 05:38:51,799 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 05:38:51,800 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 05:38:51,800 - INFO - app - Scheduler initialized
2025-07-24 05:38:51,802 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 05:38:51,802 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 05:38:52,892 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 05:38:52,898 - INFO - app - Starting stale cache cleanup task
2025-07-24 05:38:52,944 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 05:38:52,944 - INFO - app - Background tasks initialized
2025-07-24 05:38:52,944 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 05:38:53,582 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 05:38:53,583 - INFO - app - Application startup completed successfully
2025-07-24 05:38:53,594 - INFO - app - Starting cache validation task
2025-07-24 05:38:53,595 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 05:38:53,596 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 05:38:53,597 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:38:53,617 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 05:38:53,629 - INFO - app - Validating cache for 30 users
2025-07-24 05:38:53,629 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:38:53,633 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 05:38:53,640 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,641 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 05:38:53,647 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:38:53,651 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 05:38:53,653 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 05:38:53,654 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,654 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 05:38:53,655 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 05:38:53,657 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 05:38:53,661 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 05:38:53,663 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 05:38:53,665 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,668 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:38:53,670 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 05:38:53,672 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:38:53,674 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 05:38:53,676 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 05:38:53,677 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,678 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 05:38:53,681 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 05:38:53,683 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 05:38:53,684 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 05:38:53,684 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 05:38:53,685 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 05:38:53,686 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,686 - INFO - app - Completed stale cache cleanup task
2025-07-24 05:38:53,695 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,702 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,711 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,718 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,726 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,735 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,746 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,759 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,766 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,775 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,782 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,790 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,796 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,820 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,829 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,845 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,855 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,865 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,875 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,886 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,907 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 05:38:53,920 - INFO - app - Cache validation completed
2025-07-24 05:38:54,218 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 12.62720511431776857905528260% which is below threshold 100.0%
2025-07-24 05:38:54,219 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 12.62720511431776857905528260
2025-07-24 05:38:55,177 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:38:55,221 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:38:55,233 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:38:55,254 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:38:55,273 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:38:55,276 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:38:55,351 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:38:55,523 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:38:55,543 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:38:55,543 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:38:55,573 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:38:55,579 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:38:55,593 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:38:55,593 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:38:55,599 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:38:55,609 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:38:55,609 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:38:55,609 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:38:55,611 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:38:55,629 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:38:55,629 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:38:55,634 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:38:55,634 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:38:55,644 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:38:55,644 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:38:55,679 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:38:55,690 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:38:55,690 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:38:57,693 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 05:38:57,713 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:57,751 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:57,800 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,313 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.818529357522619103382067340% which is below threshold 100.0%
2025-07-24 05:38:58,317 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.818529357522619103382067340
2025-07-24 05:38:58,354 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,367 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,383 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,400 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,417 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,434 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,449 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,466 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:58,819 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.473980143583385832342309260% which is below threshold 100.0%
2025-07-24 05:38:58,827 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.473980143583385832342309260
2025-07-24 05:38:59,271 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.15332007550015353163376295% which is below threshold 100.0%
2025-07-24 05:38:59,274 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.15332007550015353163376295
2025-07-24 05:38:59,302 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:59,318 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:59,388 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:38:59,845 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:38:59,846 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:38:59,855 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:38:59,856 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:38:59,872 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:38:59,873 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:38:59,874 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:38:59,937 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:39:00,255 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:39:00,318 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:39:00,661 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:39:00,754 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:39:01,044 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:39:01,106 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:01,154 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:08,594 - INFO - app - Starting stale cache cleanup task
2025-07-24 05:39:08,598 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 05:39:08,601 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 05:39:08,605 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 05:39:08,608 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 05:39:08,610 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 05:39:08,612 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 05:39:08,614 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 05:39:08,616 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 05:39:08,621 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 05:39:08,623 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 05:39:08,628 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 05:39:08,633 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 05:39:08,634 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 05:39:08,635 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 05:39:08,637 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 05:39:08,638 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 05:39:08,641 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 05:39:08,641 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 05:39:08,642 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 05:39:08,644 - INFO - app - Completed stale cache cleanup task
2025-07-24 05:39:31,166 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:39:31,177 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:39:31,184 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:39:31,196 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:39:31,197 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:39:31,546 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.27293367248249448721420558% which is below threshold 100.0%
2025-07-24 05:39:31,549 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.27293367248249448721420558
2025-07-24 05:39:35,048 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 05:39:35,189 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,259 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,285 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,682 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.462493242053045979577796212% which is below threshold 100.0%
2025-07-24 05:39:35,684 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.462493242053045979577796212
2025-07-24 05:39:35,727 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,747 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,771 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,792 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,815 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,838 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,858 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:35,879 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:36,252 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.416287382382567858478393429% which is below threshold 100.0%
2025-07-24 05:39:36,253 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.416287382382567858478393429
2025-07-24 05:39:36,630 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.01721691043425954983487328% which is below threshold 100.0%
2025-07-24 05:39:36,632 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.01721691043425954983487328
2025-07-24 05:39:36,653 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:36,667 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:36,724 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:39:37,017 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:39:37,019 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:39:37,025 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:39:37,026 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:39:37,052 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:37,053 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:39:37,053 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:39:37,145 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:39:37,428 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:39:37,524 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:39:37,820 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:39:37,928 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:39:38,221 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:39:38,296 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:39:38,380 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:08,389 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:40:08,399 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:40:08,406 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:40:08,425 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:40:08,437 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:40:08,967 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.22478142287902820225153778% which is below threshold 100.0%
2025-07-24 05:40:08,973 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.22478142287902820225153778
2025-07-24 05:40:12,610 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:40:12,759 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:12,798 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:12,834 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:13,271 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.414644887359609817601630539% which is below threshold 100.0%
2025-07-24 05:40:13,275 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.414644887359609817601630539
2025-07-24 05:40:13,369 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:13,404 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:13,445 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:13,486 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:13,518 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:13,550 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:13,593 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:13,630 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:14,041 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.397354049947613288369476234% which is below threshold 100.0%
2025-07-24 05:40:14,044 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.397354049947613288369476234
2025-07-24 05:40:14,504 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.96477449111158336443446872% which is below threshold 100.0%
2025-07-24 05:40:14,506 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.96477449111158336443446872
2025-07-24 05:40:14,550 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:14,585 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:14,703 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:40:14,998 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:40:15,000 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:40:15,007 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:40:15,009 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:40:15,044 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:15,046 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:40:15,046 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:40:15,202 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:40:15,511 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:40:15,656 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:40:15,952 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:40:16,056 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:40:16,357 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:40:16,418 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:16,466 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:46,482 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:40:46,496 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:40:46,504 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:40:46,530 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:40:46,534 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:40:46,960 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.17840632132771093659329181% which is below threshold 100.0%
2025-07-24 05:40:46,964 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.17840632132771093659329181
2025-07-24 05:40:50,261 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:40:50,432 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:50,473 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:50,513 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:50,902 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.366780280989463900289236840% which is below threshold 100.0%
2025-07-24 05:40:50,904 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.366780280989463900289236840
2025-07-24 05:40:50,971 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:51,009 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:51,060 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:51,106 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:51,144 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:51,182 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:51,214 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:51,246 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:51,645 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.379481927426717559823603330% which is below threshold 100.0%
2025-07-24 05:40:51,647 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.379481927426717559823603330
2025-07-24 05:40:52,056 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.01996122865447770674939125% which is below threshold 100.0%
2025-07-24 05:40:52,058 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.01996122865447770674939125
2025-07-24 05:40:52,129 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:52,178 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:52,273 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:40:52,573 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:40:52,596 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:40:52,640 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:40:52,643 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:40:52,674 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:52,675 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:40:52,676 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:40:52,740 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:40:53,052 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:40:53,170 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:40:53,508 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:40:53,652 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:40:54,021 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:40:54,076 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:40:54,117 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:24,125 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:41:24,133 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:41:24,140 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:41:24,159 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:41:24,162 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:41:24,533 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.16960520716468722194282177% which is below threshold 100.0%
2025-07-24 05:41:24,537 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.16960520716468722194282177
2025-07-24 05:41:28,114 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:41:28,273 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:28,308 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:28,350 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:28,834 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.355656187328700766826399220% which is below threshold 100.0%
2025-07-24 05:41:28,835 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.355656187328700766826399220
2025-07-24 05:41:28,907 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:28,951 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:28,983 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:29,010 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:29,041 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:29,080 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:29,109 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:29,142 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:29,526 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.386034477530985645030337128% which is below threshold 100.0%
2025-07-24 05:41:29,530 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.386034477530985645030337128
2025-07-24 05:41:30,077 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.93707872240654569047490154% which is below threshold 100.0%
2025-07-24 05:41:30,080 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.93707872240654569047490154
2025-07-24 05:41:30,113 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:30,147 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:30,258 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:41:30,546 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:41:30,548 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:41:30,557 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:41:30,560 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:41:30,590 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:30,591 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:41:30,592 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:41:30,674 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:41:30,959 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:41:31,026 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:41:31,350 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:41:31,468 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:41:31,804 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:41:31,834 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:31,855 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:41:50,587 - WARNING - app.api.v1.endpoints.groups - Copy group settings failed: No groups found with name 'Group d'
2025-07-24 05:41:55,046 - INFO - app - Application shutdown initiated
2025-07-24 05:41:55,046 - INFO - app - Scheduler shutdown completed
2025-07-24 05:41:55,948 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 05:41:57,504 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 05:41:57,504 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 05:41:57,516 - INFO - app - Redis connection closed
2025-07-24 05:41:57,517 - INFO - app - Application shutdown completed
2025-07-24 05:43:52,363 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:43:52,405 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:52,417 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:52,417 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:52,732 - INFO - app - Application starting up - Trading system initialized
2025-07-24 05:43:52,732 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 05:43:52,732 - INFO - app - Environment: PRODUCTION
2025-07-24 05:43:52,840 - INFO - app - Application startup initiated
2025-07-24 05:43:52,841 - INFO - app - Initializing core services...
2025-07-24 05:43:52,873 - INFO - app - Firebase initialized
2025-07-24 05:43:52,873 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 05:43:52,911 - INFO - app - Redis initialized
2025-07-24 05:43:53,419 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 05:43:53,422 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 05:43:53,425 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 05:43:53,425 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 05:43:53,426 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 05:43:53,426 - INFO - app - Scheduler initialized
2025-07-24 05:43:53,427 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 05:43:53,428 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 05:43:54,554 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 05:43:54,571 - INFO - app - Starting stale cache cleanup task
2025-07-24 05:43:54,603 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 05:43:54,603 - INFO - app - Background tasks initialized
2025-07-24 05:43:54,603 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 05:43:55,195 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 05:43:55,195 - INFO - app - Application startup completed successfully
2025-07-24 05:43:55,198 - INFO - app - Starting cache validation task
2025-07-24 05:43:55,200 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 05:43:55,202 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 05:43:55,203 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:43:55,251 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 05:43:55,257 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:43:55,259 - INFO - app - Validating cache for 30 users
2025-07-24 05:43:55,261 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 05:43:55,269 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,269 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 05:43:55,271 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:43:55,274 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 05:43:55,276 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 05:43:55,277 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 05:43:55,278 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,279 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 05:43:55,280 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 05:43:55,282 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 05:43:55,284 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 05:43:55,288 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 05:43:55,289 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,290 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:43:55,292 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 05:43:55,294 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 05:43:55,295 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:43:55,295 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 05:43:55,299 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 05:43:55,300 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 05:43:55,301 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 05:43:55,301 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 05:43:55,302 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 05:43:55,303 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,303 - INFO - app - Completed stale cache cleanup task
2025-07-24 05:43:55,313 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,322 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,334 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,341 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,348 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,356 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,363 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,370 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,379 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,387 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,396 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,405 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,413 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,420 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,432 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,437 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,442 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,447 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,477 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,495 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 05:43:55,507 - INFO - app - Cache validation completed
2025-07-24 05:43:55,880 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.42712242253085225734070951% which is below threshold 100.0%
2025-07-24 05:43:55,884 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.42712242253085225734070951
2025-07-24 05:43:57,087 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:43:57,111 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:43:57,121 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:43:57,147 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:43:57,190 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:43:57,258 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:43:57,446 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:57,452 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:57,470 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:57,470 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:57,472 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:57,472 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:57,474 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:57,476 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:57,482 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:57,498 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:57,498 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:57,499 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:57,499 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:57,503 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:57,503 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:57,507 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:57,521 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:57,533 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:57,533 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:57,542 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:57,542 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:57,546 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:43:57,555 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:43:57,556 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:43:59,460 - INFO - app - [AUTO-CUTOFF] Sent margin call warning email (HTML) to user 9 at kodideladinesh123@gmail.com
2025-07-24 05:43:59,809 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:43:59,846 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:43:59,896 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:00,463 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.596193303848523030582025758% which is below threshold 100.0%
2025-07-24 05:44:00,478 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.596193303848523030582025758
2025-07-24 05:44:00,589 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:00,633 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:00,676 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:00,715 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:00,766 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:00,815 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:00,858 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:00,903 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:01,349 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.364540765620841488928043230% which is below threshold 100.0%
2025-07-24 05:44:01,351 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.364540765620841488928043230
2025-07-24 05:44:01,757 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.88338019723182942191755891% which is below threshold 100.0%
2025-07-24 05:44:01,760 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.88338019723182942191755891
2025-07-24 05:44:01,805 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:01,827 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:01,930 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:44:02,735 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:44:02,753 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:44:02,768 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:44:02,769 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:44:02,794 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:02,795 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:44:02,796 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:44:02,865 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:44:03,251 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:44:03,399 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:44:03,765 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:44:03,959 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:44:04,273 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:44:04,304 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:04,347 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:10,206 - INFO - app - Starting stale cache cleanup task
2025-07-24 05:44:10,210 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 05:44:10,212 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 05:44:10,215 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 05:44:10,217 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 05:44:10,220 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 05:44:10,223 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 05:44:10,225 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 05:44:10,227 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 05:44:10,231 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 05:44:10,234 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 05:44:10,240 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 05:44:10,246 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 05:44:10,248 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 05:44:10,251 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 05:44:10,254 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 05:44:10,256 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 05:44:10,258 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 05:44:10,260 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 05:44:10,263 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 05:44:10,264 - INFO - app - Completed stale cache cleanup task
2025-07-24 05:44:34,350 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:44:34,365 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:44:34,372 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:44:34,384 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:44:34,386 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:44:34,785 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.14531751711865062478239003% which is below threshold 100.0%
2025-07-24 05:44:34,787 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.14531751711865062478239003
2025-07-24 05:44:38,947 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:44:39,062 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,100 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,119 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,475 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.372605898891920915921129373% which is below threshold 100.0%
2025-07-24 05:44:39,476 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.372605898891920915921129373
2025-07-24 05:44:39,528 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,547 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,569 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,622 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,648 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,668 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,691 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:39,709 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:40,064 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.365719887747573535109203554% which is below threshold 100.0%
2025-07-24 05:44:40,066 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.365719887747573535109203554
2025-07-24 05:44:40,522 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.88990648633264673040084044% which is below threshold 100.0%
2025-07-24 05:44:40,523 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.88990648633264673040084044
2025-07-24 05:44:40,559 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:40,580 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:40,660 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:44:40,993 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:44:40,998 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:44:41,021 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:44:41,022 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:44:41,055 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:41,056 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:44:41,056 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:44:41,130 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:44:41,448 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:44:41,531 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:44:41,859 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:44:41,946 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:44:42,267 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:44:42,336 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:44:42,360 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:12,363 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:45:12,370 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:45:12,373 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:45:12,383 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:45:12,386 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:45:12,775 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.20891402955626910131919997% which is below threshold 100.0%
2025-07-24 05:45:12,778 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.20891402955626910131919997
2025-07-24 05:45:16,081 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:45:16,199 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,240 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,266 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,624 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.451700653628247477302586579% which is below threshold 100.0%
2025-07-24 05:45:16,626 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.451700653628247477302586579
2025-07-24 05:45:16,680 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,706 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,731 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,757 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,781 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,807 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,827 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:16,849 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:17,257 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.391626885332057635489554662% which is below threshold 100.0%
2025-07-24 05:45:17,259 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.391626885332057635489554662
2025-07-24 05:45:17,613 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.94965343425142610680845553% which is below threshold 100.0%
2025-07-24 05:45:17,617 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.94965343425142610680845553
2025-07-24 05:45:17,648 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:17,671 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:17,745 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:45:18,027 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:45:18,030 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:45:18,041 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:45:18,044 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:45:18,071 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:18,072 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:45:18,073 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:45:18,148 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:45:18,432 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:45:18,544 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:45:18,922 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:45:18,984 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:45:19,282 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:45:19,345 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:19,373 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:49,388 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:45:49,396 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:45:49,402 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:45:49,416 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:45:49,418 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:45:49,801 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.13317367209563232620217417% which is below threshold 100.0%
2025-07-24 05:45:49,805 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.13317367209563232620217417
2025-07-24 05:45:53,298 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:45:53,386 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,419 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,441 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,784 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.374706740138446745567454624% which is below threshold 100.0%
2025-07-24 05:45:53,784 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.374706740138446745567454624
2025-07-24 05:45:53,813 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,832 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,853 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,869 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,887 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,904 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,930 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:53,946 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:54,290 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.356067930910181214226276905% which is below threshold 100.0%
2025-07-24 05:45:54,292 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.356067930910181214226276905
2025-07-24 05:45:54,671 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.72299459458057226134620277% which is below threshold 100.0%
2025-07-24 05:45:54,676 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.72299459458057226134620277
2025-07-24 05:45:54,724 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:54,741 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:54,804 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:45:55,077 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:45:55,081 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:45:55,091 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:45:55,092 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:45:55,109 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:55,109 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:45:55,110 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:45:55,180 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:45:55,535 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:45:55,598 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:45:55,886 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:45:55,945 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:45:56,812 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:45:56,838 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:45:56,852 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:46:09,243 - INFO - app - Application shutdown initiated
2025-07-24 05:46:09,244 - INFO - app - Scheduler shutdown completed
2025-07-24 05:46:09,768 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 05:46:11,808 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 05:46:11,808 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 05:46:11,811 - INFO - app - Redis connection closed
2025-07-24 05:46:11,811 - INFO - app - Application shutdown completed
2025-07-24 05:48:24,456 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:24,495 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:24,512 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:24,512 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:24,832 - INFO - app - Application starting up - Trading system initialized
2025-07-24 05:48:24,832 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 05:48:24,832 - INFO - app - Environment: PRODUCTION
2025-07-24 05:48:24,949 - INFO - app - Application startup initiated
2025-07-24 05:48:24,949 - INFO - app - Initializing core services...
2025-07-24 05:48:24,988 - INFO - app - Firebase initialized
2025-07-24 05:48:24,988 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 05:48:25,007 - INFO - app - Redis initialized
2025-07-24 05:48:25,693 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 05:48:25,697 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 05:48:25,700 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 05:48:25,701 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 05:48:25,702 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 05:48:25,702 - INFO - app - Scheduler initialized
2025-07-24 05:48:25,704 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 05:48:25,704 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 05:48:26,653 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 05:48:26,665 - INFO - app - Starting stale cache cleanup task
2025-07-24 05:48:26,704 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 05:48:26,704 - INFO - app - Background tasks initialized
2025-07-24 05:48:26,704 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 05:48:27,279 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 05:48:27,279 - INFO - app - Application startup completed successfully
2025-07-24 05:48:27,280 - INFO - app - Starting cache validation task
2025-07-24 05:48:27,281 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 05:48:27,283 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 05:48:27,285 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:48:27,329 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 05:48:27,340 - INFO - app - Validating cache for 30 users
2025-07-24 05:48:27,341 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:48:27,344 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 05:48:27,352 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 05:48:27,355 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:48:27,358 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 05:48:27,360 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 05:48:27,362 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 05:48:27,363 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 05:48:27,365 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 05:48:27,368 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 05:48:27,369 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 05:48:27,374 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:48:27,375 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 05:48:27,379 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:48:27,380 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 05:48:27,382 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 05:48:27,383 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 05:48:27,385 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 05:48:27,387 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 05:48:27,389 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 05:48:27,390 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 05:48:27,392 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 05:48:27,395 - INFO - app - Completed stale cache cleanup task
2025-07-24 05:48:27,432 - INFO - app - Cache validation completed
2025-07-24 05:48:27,913 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.20104380246818058725676042% which is below threshold 100.0%
2025-07-24 05:48:27,916 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.20104380246818058725676042
2025-07-24 05:48:29,355 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:29,374 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:29,407 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:29,441 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:29,466 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:29,524 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:29,562 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:29,606 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:48:29,821 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:29,831 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:29,848 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:29,848 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:29,855 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:29,857 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:29,891 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:29,891 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:29,893 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:29,893 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:29,898 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:29,898 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:29,900 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:29,915 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:29,925 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:29,925 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:29,934 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:29,934 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:29,973 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:29,975 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:48:29,987 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:29,987 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:29,989 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:48:29,989 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:48:31,223 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:48:31,274 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:31,317 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:31,361 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:31,845 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.658309680515675020570909803% which is below threshold 100.0%
2025-07-24 05:48:31,849 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.658309680515675020570909803
2025-07-24 05:48:31,927 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:31,957 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:31,986 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:32,012 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:32,056 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:32,090 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:32,126 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:32,160 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:32,610 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.396646576671574060660780040% which is below threshold 100.0%
2025-07-24 05:48:32,612 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.396646576671574060660780040
2025-07-24 05:48:33,072 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.96100617355546273949723134% which is below threshold 100.0%
2025-07-24 05:48:33,074 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.96100617355546273949723134
2025-07-24 05:48:33,268 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:33,359 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:33,520 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:48:34,419 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:48:34,424 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:48:34,474 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:48:34,480 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:48:34,575 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:34,577 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:48:34,579 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:48:34,710 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:48:34,995 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:48:35,108 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:48:35,419 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:48:35,621 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:48:35,909 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:48:35,948 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:35,982 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:48:42,280 - INFO - app - Starting stale cache cleanup task
2025-07-24 05:48:42,282 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 05:48:42,285 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 05:48:42,287 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 05:48:42,288 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 05:48:42,290 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 05:48:42,291 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 05:48:42,293 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 05:48:42,294 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 05:48:42,297 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 05:48:42,313 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 05:48:42,345 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 05:48:42,353 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 05:48:42,356 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 05:48:42,360 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 05:48:42,365 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 05:48:42,367 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 05:48:42,370 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 05:48:42,374 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 05:48:42,375 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 05:48:42,376 - INFO - app - Completed stale cache cleanup task
2025-07-24 05:49:05,999 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:49:06,007 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:49:06,013 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:49:06,027 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:49:06,030 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:49:06,171 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:49:06,465 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-24 05:49:06,510 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:06,553 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:06,602 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,030 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.076663727685363758234999879% which is below threshold 100.0%
2025-07-24 05:49:07,032 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.076663727685363758234999879
2025-07-24 05:49:07,120 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,157 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,197 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,236 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,278 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,317 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,360 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,402 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:07,824 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.254309691373205628792140983% which is below threshold 100.0%
2025-07-24 05:49:07,826 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.254309691373205628792140983
2025-07-24 05:49:08,071 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-24 05:49:08,363 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-24 05:49:08,406 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:08,455 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:08,576 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:49:08,589 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:49:08,887 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 0.0
2025-07-24 05:49:08,889 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:49:08,906 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:49:08,908 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:49:08,959 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:08,960 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:49:08,962 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:49:09,117 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:49:09,122 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:49:09,422 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-24 05:49:09,596 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:49:09,601 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:49:09,895 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:49:10,158 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:49:10,167 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:49:10,464 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:49:10,505 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:10,544 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:40,560 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:49:40,575 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:49:40,580 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:49:40,589 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:49:40,590 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:49:40,669 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:49:40,964 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-24 05:49:41,003 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,032 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,053 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,401 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.036599857681171126145873566% which is below threshold 100.0%
2025-07-24 05:49:41,412 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.036599857681171126145873566
2025-07-24 05:49:41,452 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,469 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,487 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,504 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,522 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,542 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,559 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,590 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:41,957 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.239553820187244593725048934% which is below threshold 100.0%
2025-07-24 05:49:41,958 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.239553820187244593725048934
2025-07-24 05:49:42,041 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 26, falling back to DB and updating cache.
2025-07-24 05:49:42,386 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 0.0
2025-07-24 05:49:42,417 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:42,442 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:42,500 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:49:42,502 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:49:42,798 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 0.0
2025-07-24 05:49:42,806 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:49:42,826 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:49:42,829 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:49:42,849 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:42,850 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:49:42,851 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:49:42,942 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:49:42,945 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:49:43,245 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 0.0
2025-07-24 05:49:43,337 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:49:43,339 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:49:43,637 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:49:43,696 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:49:43,698 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_balance_margin cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:49:43,994 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:49:44,024 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:44,052 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:49:53,170 - INFO - app - Application shutdown initiated
2025-07-24 05:49:53,171 - INFO - app - Scheduler shutdown completed
2025-07-24 05:49:54,015 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 05:49:54,093 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 05:49:54,093 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 05:49:54,096 - INFO - app - Redis connection closed
2025-07-24 05:49:54,096 - INFO - app - Application shutdown completed
2025-07-24 05:51:27,269 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:27,305 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:27,320 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:27,320 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:27,640 - INFO - app - Application starting up - Trading system initialized
2025-07-24 05:51:27,640 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 05:51:27,640 - INFO - app - Environment: PRODUCTION
2025-07-24 05:51:27,747 - INFO - app - Application startup initiated
2025-07-24 05:51:27,748 - INFO - app - Initializing core services...
2025-07-24 05:51:27,784 - INFO - app - Firebase initialized
2025-07-24 05:51:27,784 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 05:51:27,802 - INFO - app - Redis initialized
2025-07-24 05:51:28,333 - INFO - app - All group settings, group-symbol settings, and external symbol info cached in Redis at startup.
2025-07-24 05:51:28,336 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 05:51:28,339 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 05:51:28,339 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 05:51:28,340 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 05:51:28,340 - INFO - app - Scheduler initialized
2025-07-24 05:51:28,342 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 05:51:28,342 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 05:51:29,328 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 05:51:29,330 - INFO - app - Starting stale cache cleanup task
2025-07-24 05:51:29,384 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-24 05:51:29,384 - INFO - app - Background tasks initialized
2025-07-24 05:51:29,384 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 05:51:30,010 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 05:51:30,010 - INFO - app - Application startup completed successfully
2025-07-24 05:51:30,010 - INFO - app - Starting cache validation task
2025-07-24 05:51:30,013 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-24 05:51:30,015 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-24 05:51:30,018 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:51:30,032 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 05:51:30,041 - INFO - app - Validating cache for 30 users
2025-07-24 05:51:30,043 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:51:30,049 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 05:51:30,060 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,062 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 05:51:30,067 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:51:30,075 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 05:51:30,080 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 05:51:30,080 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,081 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 05:51:30,083 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 05:51:30,086 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 05:51:30,090 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:51:30,091 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 05:51:30,095 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 05:51:30,097 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:51:30,099 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,104 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 05:51:30,109 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 05:51:30,111 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 05:51:30,112 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,113 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 05:51:30,118 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 05:51:30,120 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 05:51:30,122 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 05:51:30,125 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 05:51:30,128 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 05:51:30,129 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,130 - INFO - app - Completed stale cache cleanup task
2025-07-24 05:51:30,138 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,149 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,157 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,165 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,173 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,183 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,193 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,201 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,210 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,219 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,229 - WARNING - app - User 29: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,237 - WARNING - app - User 31: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,246 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-24 05:51:30,539 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.03509202483655073697241673% which is below threshold 100.0%
2025-07-24 05:51:30,577 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.03509202483655073697241673
2025-07-24 05:51:32,006 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:32,034 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:32,053 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:32,064 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:32,085 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:32,093 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:32,103 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:32,113 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 05:51:32,293 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:32,299 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:32,312 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:32,312 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:32,315 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:32,315 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:32,357 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:32,366 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:32,371 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:32,377 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:32,377 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:32,380 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:32,384 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:32,384 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:32,386 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:32,386 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:32,386 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:32,395 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:32,396 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:32,396 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:32,397 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:32,398 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 05:51:32,409 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 05:51:32,409 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 05:51:34,107 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:51:34,111 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-24 05:51:34,135 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-24 05:51:34,154 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-24 05:51:34,162 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,163 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-24 05:51:34,171 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-24 05:51:34,188 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-24 05:51:34,190 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,196 - INFO - app - Cache validation completed
2025-07-24 05:51:34,218 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,631 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.692831308843338944038708227% which is below threshold 100.0%
2025-07-24 05:51:34,636 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.692831308843338944038708227
2025-07-24 05:51:34,682 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,696 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,711 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,727 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,744 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,761 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,776 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:34,792 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:35,139 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.406652270146985995398054785% which is below threshold 100.0%
2025-07-24 05:51:35,142 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.406652270146985995398054785
2025-07-24 05:51:35,546 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 66.98031880103058010176778467% which is below threshold 100.0%
2025-07-24 05:51:35,549 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 66.98031880103058010176778467
2025-07-24 05:51:35,606 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:35,620 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:35,663 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:51:36,099 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:51:36,131 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:51:36,161 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:51:36,163 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:51:36,179 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:36,180 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:51:36,181 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:51:36,240 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:51:36,568 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:51:36,639 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:51:36,979 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:51:37,043 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:51:37,387 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:51:37,410 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:37,424 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:51:45,024 - INFO - app - Starting stale cache cleanup task
2025-07-24 05:51:45,027 - INFO - app - Found 26 static orders cache entries to check
2025-07-24 05:51:45,030 - WARNING - app - Found stale cache entry for user live:17, will be refreshed on next access
2025-07-24 05:51:45,032 - WARNING - app - Found stale cache entry for user live:16, will be refreshed on next access
2025-07-24 05:51:45,034 - WARNING - app - Found stale cache entry for user live:21, will be refreshed on next access
2025-07-24 05:51:45,036 - WARNING - app - Found stale cache entry for user live:5, will be refreshed on next access
2025-07-24 05:51:45,038 - WARNING - app - Found stale cache entry for user live:8, will be refreshed on next access
2025-07-24 05:51:45,039 - WARNING - app - Found stale cache entry for user live:18, will be refreshed on next access
2025-07-24 05:51:45,041 - WARNING - app - Found stale cache entry for user live:29, will be refreshed on next access
2025-07-24 05:51:45,044 - WARNING - app - Found stale cache entry for user live:2, will be refreshed on next access
2025-07-24 05:51:45,044 - WARNING - app - Found stale cache entry for user live:31, will be refreshed on next access
2025-07-24 05:51:45,047 - WARNING - app - Found stale cache entry for user live:6, will be refreshed on next access
2025-07-24 05:51:45,048 - WARNING - app - Found stale cache entry for user live:23, will be refreshed on next access
2025-07-24 05:51:45,049 - WARNING - app - Found stale cache entry for user live:12, will be refreshed on next access
2025-07-24 05:51:45,050 - WARNING - app - Found stale cache entry for user live:20, will be refreshed on next access
2025-07-24 05:51:45,050 - WARNING - app - Found stale cache entry for user live:30, will be refreshed on next access
2025-07-24 05:51:45,051 - WARNING - app - Found stale cache entry for user live:3, will be refreshed on next access
2025-07-24 05:51:45,051 - WARNING - app - Found stale cache entry for user live:19, will be refreshed on next access
2025-07-24 05:51:45,052 - WARNING - app - Found stale cache entry for user live:13, will be refreshed on next access
2025-07-24 05:51:45,052 - WARNING - app - Found stale cache entry for user live:22, will be refreshed on next access
2025-07-24 05:51:45,053 - INFO - app - Completed stale cache cleanup task
2025-07-24 05:52:07,434 - INFO - app - [SCHEDULER] Starting update_all_users_dynamic_portfolio job...
2025-07-24 05:52:07,440 - INFO - app - [AUTO-CUTOFF] Found 19 live users and 11 demo users.
2025-07-24 05:52:07,445 - WARNING - app - [AUTO-CUTOFF] No user data found for user 5 (live). Skipping portfolio update.
2025-07-24 05:52:07,456 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:52:07,458 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 8.
2025-07-24 05:52:08,106 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 11.27724960346628496266780146% which is below threshold 100.0%
2025-07-24 05:52:08,109 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 11.27724960346628496266780146
2025-07-24 05:52:11,541 - ERROR - app - [AUTO-CUTOFF] Failed to send margin call warning email to user 9 at kodideladinesh123@gmail.com: (451, b'4.7.1 Ratelimit "hostinger_out_ratelimit" exceeded')
2025-07-24 05:52:11,598 - WARNING - app - [AUTO-CUTOFF] User 10 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:11,625 - WARNING - app - [AUTO-CUTOFF] User 11 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:11,645 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,009 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 2.515153353232328527649725093% which is below threshold 100.0%
2025-07-24 05:52:12,011 - INFO - app - [AUTO-CUTOFF] User 14 margin_level: 2.515153353232328527649725093
2025-07-24 05:52:12,122 - WARNING - app - [AUTO-CUTOFF] User 16 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,165 - WARNING - app - [AUTO-CUTOFF] User 17 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,212 - WARNING - app - [AUTO-CUTOFF] User 18 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,246 - WARNING - app - [AUTO-CUTOFF] User 19 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,289 - WARNING - app - [AUTO-CUTOFF] User 20 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,314 - WARNING - app - [AUTO-CUTOFF] User 21 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,355 - WARNING - app - [AUTO-CUTOFF] User 22 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,413 - WARNING - app - [AUTO-CUTOFF] User 23 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:12,768 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 3.417247524685763953225909693% which is below threshold 100.0%
2025-07-24 05:52:12,769 - INFO - app - [AUTO-CUTOFF] User 25 margin_level: 3.417247524685763953225909693
2025-07-24 05:52:13,184 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 67.00601435769948834849182306% which is below threshold 100.0%
2025-07-24 05:52:13,188 - INFO - app - [AUTO-CUTOFF] User 26 margin_level: 67.00601435769948834849182306
2025-07-24 05:52:13,293 - WARNING - app - [AUTO-CUTOFF] User 29 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:13,339 - WARNING - app - [AUTO-CUTOFF] User 31 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:13,495 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 1, falling back to DB and updating cache.
2025-07-24 05:52:13,839 - INFO - app - [AUTO-CUTOFF] User 1 margin_level: 250323.2876712328767123287671
2025-07-24 05:52:13,846 - WARNING - app - [AUTO-CUTOFF] User 2 has no group_name set. Skipping portfolio update.
2025-07-24 05:52:13,871 - WARNING - app - [AUTO-CUTOFF] Group symbol settings missing or incomplete in cache for 'string', fetching from DB.
2025-07-24 05:52:13,873 - ERROR - app - [AUTO-CUTOFF] Group symbol settings not found in DB for group 'string'. Skipping portfolio update for user 3.
2025-07-24 05:52:13,920 - WARNING - app - [AUTO-CUTOFF] User 4 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:13,922 - WARNING - app - [AUTO-CUTOFF] User 5 has no group_name set. Skipping portfolio update.
2025-07-24 05:52:13,923 - WARNING - app - [AUTO-CUTOFF] User 6 has no group_name set. Skipping portfolio update.
2025-07-24 05:52:14,026 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 9, falling back to DB and updating cache.
2025-07-24 05:52:14,352 - INFO - app - [AUTO-CUTOFF] User 9 margin_level: 101.9936699678904406360013927
2025-07-24 05:52:14,425 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 10, falling back to DB and updating cache.
2025-07-24 05:52:14,760 - INFO - app - [AUTO-CUTOFF] User 10 margin_level: 0.0
2025-07-24 05:52:14,846 - WARNING - app.services.portfolio_calculator - [PORTFOLIO] user_static_orders cache miss for user 11, falling back to DB and updating cache.
2025-07-24 05:52:15,134 - INFO - app - [AUTO-CUTOFF] User 11 margin_level: 0.0
2025-07-24 05:52:15,156 - WARNING - app - [AUTO-CUTOFF] User 12 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:15,174 - WARNING - app - [AUTO-CUTOFF] User 13 has no open or pending orders. Skipping portfolio update.
2025-07-24 05:52:41,332 - INFO - app - Application shutdown initiated
2025-07-24 05:52:41,332 - INFO - app - Scheduler shutdown completed
2025-07-24 05:52:41,597 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 05:52:43,131 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 05:52:43,131 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 05:52:43,138 - INFO - app - Redis connection closed
2025-07-24 05:52:43,139 - INFO - app - Application shutdown completed
2025-07-24 21:40:54,174 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-24 21:40:54,253 - INFO - app.core.config - .env file loaded successfully.
2025-07-24 21:40:54,267 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-24 21:40:54,267 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-24 21:40:54,780 - INFO - app - Application starting up - Trading system initialized
2025-07-24 21:40:54,780 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-24 21:40:54,780 - INFO - app - Environment: PRODUCTION
2025-07-24 21:40:54,900 - INFO - app - Application startup initiated
2025-07-24 21:40:54,900 - INFO - app - Initializing core services...
2025-07-24 21:40:54,962 - INFO - app - Firebase initialized
2025-07-24 21:40:54,962 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 21:40:59,032 - WARNING - app - Redis initialization failed
2025-07-24 21:40:59,032 - INFO - app - [SCHEDULER] Initializing APScheduler...
2025-07-24 21:40:59,039 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-24 21:40:59,040 - INFO - app - [SCHEDULER] About to start scheduler...
2025-07-24 21:40:59,042 - INFO - app - [SCHEDULER] Scheduler started successfully.
2025-07-24 21:40:59,042 - INFO - app - Scheduler initialized
2025-07-24 21:40:59,042 - INFO - app - Background tasks initialized
2025-07-24 21:40:59,042 - INFO - app - [SCHEDULER] Starting rotate_service_account_jwt job...
2025-07-24 21:41:00,246 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-24 21:41:00,246 - INFO - app - Application startup completed successfully
2025-07-24 21:41:00,246 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 21:41:00,246 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-24 21:41:01,068 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-24 21:41:47,860 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 21:41:48,022 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 21:41:48,038 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 21:41:48,043 - WARNING - app.dependencies.redis_client - [Redis] Client not initialized, attempting late connection.
2025-07-24 21:50:06,139 - INFO - app - Application shutdown initiated
2025-07-24 21:50:06,139 - INFO - app - Scheduler shutdown completed
2025-07-24 21:50:06,139 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-24 21:50:07,995 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-24 21:50:07,996 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-24 21:50:07,998 - INFO - app - Application shutdown completed
