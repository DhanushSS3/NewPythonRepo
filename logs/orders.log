2025-07-10 03:04:55,714 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 03:04:57,028 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 03:04:57,028 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 03:04:57,028 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 03:04:57,029 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 03:05:01,138 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 03:05:01,138 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 03:05:02,035 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 03:05:07,039 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 03:05:09,913 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 03:05:09,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 03:05:09,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 03:05:09,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 03:05:09,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 03:05:09,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 03:05:09,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 03:05:09,914 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 03:05:16,268 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDNZD
2025-07-10 03:05:16,268 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDNZD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:05:16,268 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDNZD: AllMarginsPerLot=[Decimal('599.27')], HighestMarginPerLot=599.27
2025-07-10 03:05:16,268 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDNZD: CalculatedTotalMargin=5.99
2025-07-10 03:05:16,268 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 5.99
2025-07-10 03:05:16,704 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 03:05:16,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 03:05:16,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 03:05:16,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 03:05:16,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 03:05:16,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:05:16,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 03:05:16,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:05:16,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 03:05:16,706 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 03:05:16,706 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 03:05:16,706 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 03:05:16,706 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 03:05:16,706 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 03:05:16,706 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 03:05:16,706 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 03:05:16,706 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 03:05:25,387 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-10 03:05:25,887 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDNZD
2025-07-10 03:05:25,887 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDNZD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:05:25,887 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDNZD: AllMarginsPerLot=[Decimal('599.27')], HighestMarginPerLot=599.27
2025-07-10 03:05:25,887 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDNZD: CalculatedTotalMargin=5.99
2025-07-10 03:05:25,887 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 5.99
2025-07-10 03:05:33,686 - INFO - orders - Order close request received - Order ID: 7054593495, User ID: 1, Close Price: 0.99975
2025-07-10 03:05:33,687 - INFO - orders - Request to close order 7054593495 for user 1 (user_type: demo) with price 0.99975. Frontend provided type: BUY, company: AUDNZD, status: CLOSED, frontend_status: CLOSED.
2025-07-10 03:05:33,707 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 03:05:33,730 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDNZD
2025-07-10 03:05:33,730 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDNZD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:05:33,731 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDNZD: AllMarginsPerLot=[Decimal('599.27')], HighestMarginPerLot=599.27
2025-07-10 03:05:33,731 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDNZD: CalculatedTotalMargin=5.99
2025-07-10 03:05:33,731 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDNZD. Returning zero margin.
2025-07-10 03:05:33,750 - INFO - orders - Existing entry commission for order 7054593495: 0.10000000
2025-07-10 03:05:33,750 - INFO - orders - Commission calculation for order 7054593495: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 03:05:33,751 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.500000000000000000000000 NZD to USD for PnL on Close (user_id: 1, position: 7054593495)
2025-07-10 03:05:33,751 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: NZDUSD
2025-07-10 03:05:33,752 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: {'b': Decimal('0.5992700000'), 'o': Decimal('0.5992500000')}
2025-07-10 03:05:33,752 - INFO - orders - [CURRENCY_CONVERT] Found direct conversion rate (bid): 0.5992700000
2025-07-10 03:05:33,752 - INFO - orders - [CURRENCY_CONVERT] Direct conversion successful: -0.500000000000000000000000 NZD * 0.5992700000 = -0.2996350000000000000000000000 USD
2025-07-10 03:05:33,798 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=351.79000000, margin=0
2025-07-10 03:05:33,798 - INFO - orders - Setting user data cache for user 1 with wallet_balance=351.79000000, margin=0
2025-07-10 03:05:33,800 - INFO - orders - User data cache updated for user 1
2025-07-10 03:05:33,803 - INFO - orders - Balance/margin cache updated for user 1: balance=351.79000000, margin=0
2025-07-10 03:05:33,804 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 03:05:33,804 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 03:05:33,807 - INFO - orders - Fetched 0 open orders for user 1
2025-07-10 03:05:33,812 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 03:05:33,813 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 1 pending orders
2025-07-10 03:05:33,821 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=351.79000000, margin=0.0
2025-07-10 03:05:33,821 - INFO - orders - Publishing order update for user 1
2025-07-10 03:05:33,822 - INFO - orders - Publishing user data update for user 1
2025-07-10 03:05:33,824 - INFO - orders - Publishing market data trigger
2025-07-10 03:07:02,046 - INFO - orders - Order placement request received - User: 1, Symbol: AUDCHF, Type: BUY
2025-07-10 03:07:02,446 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5212300000', 'o': '0.5211900000'}
2025-07-10 03:07:02,446 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5212300000, ask=0.52128212300000
2025-07-10 03:07:02,446 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5212300000, ask=0.52128212300000
2025-07-10 03:07:02,447 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5.21 CHF to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:07:02,447 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-10 03:07:02,447 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:07:02,447 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-10 03:07:02,447 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-10 03:07:02,449 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7958300000'), 'o': Decimal('0.7958000000')}
2025-07-10 03:07:02,449 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7958300000
2025-07-10 03:07:02,449 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5.21 CHF / 0.7958300000 = 6.546624279054571956322330146 USD
2025-07-10 03:07:02,449 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: BUY, Qty: 0.01, Price: 0.52128212300000, Margin: 6.546624279054571956322330146, Commission: 0.10
2025-07-10 03:07:02,449 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDCHF, OrderType: BUY, Quantity: 0.01, FullMargin: 6.546624279054571956322330146
2025-07-10 03:07:02,449 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 03:07:02,449 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.546624279054571956322330146
2025-07-10 03:07:02,449 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 03:07:02,449 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:07:02,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCHF. Returning zero margin.
2025-07-10 03:07:02,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:07:02,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 03:07:02,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.6624279054571956322330146')], HighestMarginPerLot=654.6624279054571956322330146
2025-07-10 03:07:02,450 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:07:02,451 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:07:02,451 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDCHF, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.55, AdditionalMargin: 6.55, OpenOrders: 0
2025-07-10 03:07:02,451 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.546624279054571956322330146
2025-07-10 03:07:02,463 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=351.79000000, margin=6.55000000 (was 0E-8)
2025-07-10 03:07:02,463 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:07:02,464 - INFO - orders - [PERF] Order processing: 0.4165s
2025-07-10 03:07:02,477 - INFO - orders - [PERF] Order creation: 0.0133s
2025-07-10 03:07:02,477 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:07:02,477 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:07:02,477 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:07:02,478 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:07:02,479 - INFO - orders - [PERF] TOTAL place_order: 0.4326s
2025-07-10 03:07:02,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:07:02,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:07:02,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:07:02,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:07:02,494 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:07:02,508 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:07:02,508 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:07:02,508 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:07:02,508 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:07:02,508 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:07:02,510 - INFO - orders - Background balance/margin cache updated for user 1: balance=351.79000000, margin=6.55
2025-07-10 03:11:24,478 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 03:11:25,608 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 03:11:25,609 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 03:11:25,609 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 03:11:25,609 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 03:11:29,670 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 03:11:29,670 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 03:11:30,619 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 03:11:35,611 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 03:11:36,561 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 03:11:36,562 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 03:11:46,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:11:46,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:11:46,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:11:46,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:11:46,984 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:11:52,457 - INFO - orders - Order placement request received - User: 1, Symbol: AUDSGD, Type: SELL
2025-07-10 03:11:52,847 - INFO - orders - [MARGIN_CALC] Market data for AUDSGD: {'b': '1.0000000000', 'o': '1.0000000000'}
2025-07-10 03:11:52,847 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDSGD, using bid price with spread: bid=1.0000000000, ask=1.00010000000000
2025-07-10 03:11:52,847 - INFO - orders - [MARGIN_CALC] Using prices for AUDSGD: bid=1.0000000000, ask=1.00010000000000
2025-07-10 03:11:52,849 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 10.00 SGD to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:11:52,849 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: SGDUSD
2025-07-10 03:11:52,850 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:11:52,850 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for SGDUSD, trying inverse
2025-07-10 03:11:52,850 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDSGD
2025-07-10 03:11:52,852 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.2806600000'), 'o': Decimal('1.2806200000')}
2025-07-10 03:11:52,852 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.2806600000
2025-07-10 03:11:52,852 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 10.00 SGD / 1.2806600000 = 7.808473755719707026064685397 USD
2025-07-10 03:11:52,852 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDSGD, Type: SELL, Qty: 0.01, Price: 1.0000000000, Margin: 7.808473755719707026064685397, Commission: 0.10
2025-07-10 03:11:52,852 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDSGD, OrderType: SELL, Quantity: 0.01, FullMargin: 7.808473755719707026064685397
2025-07-10 03:11:52,853 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 03:11:52,853 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=7.808473755719707026064685397
2025-07-10 03:11:52,853 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 03:11:52,853 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:11:52,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDSGD. Returning zero margin.
2025-07-10 03:11:52,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDSGD
2025-07-10 03:11:52,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0, TotalSellQty=0.01, NetQty=0.01, IsHedged=False
2025-07-10 03:11:52,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.8473755719707026064685397')], HighestMarginPerLot=780.8473755719707026064685397
2025-07-10 03:11:52,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:11:52,855 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:11:52,856 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDSGD, OrderType: SELL, MarginBefore: 0.0, MarginAfter: 7.81, AdditionalMargin: 7.81, OpenOrders: 0
2025-07-10 03:11:52,856 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=7.808473755719707026064685397
2025-07-10 03:11:52,886 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=351.79000000, margin=14.36000000 (was 6.55000000)
2025-07-10 03:11:52,886 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:11:52,886 - INFO - orders - [PERF] Order processing: 0.4286s
2025-07-10 03:11:52,911 - INFO - orders - [PERF] Order creation: 0.0250s
2025-07-10 03:11:52,912 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:11:52,912 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:11:52,913 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:11:52,914 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:11:52,916 - INFO - orders - [PERF] TOTAL place_order: 0.4592s
2025-07-10 03:11:52,948 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:11:52,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:11:52,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:11:52,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:11:52,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDSGD
2025-07-10 03:11:52,952 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:11:52,953 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:11:52,953 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:11:52,953 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:11:52,973 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:11:52,973 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:11:52,973 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:11:52,973 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:11:52,974 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDSGD
2025-07-10 03:11:52,974 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:11:52,974 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:11:52,974 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:11:52,974 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:11:52,980 - INFO - orders - Background balance/margin cache updated for user 1: balance=351.79000000, margin=14.36
2025-07-10 03:23:45,759 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 03:23:47,051 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 03:23:47,051 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 03:23:47,051 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 03:23:47,051 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 03:23:51,116 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 03:23:51,116 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 03:23:52,063 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 03:23:57,061 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 03:23:57,881 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 03:23:57,881 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 03:24:10,420 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:24:10,420 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:24:10,421 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:24:10,421 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:24:10,421 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDSGD
2025-07-10 03:24:10,421 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:24:10,421 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:24:10,421 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:24:10,421 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:24:16,181 - INFO - orders - Order placement request received - User: 1, Symbol: AUDSGD, Type: BUY
2025-07-10 03:24:16,552 - INFO - orders - [MARGIN_CALC] Market data for AUDSGD: {'b': '1.0000000000', 'o': '1.0000000000'}
2025-07-10 03:24:16,552 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDSGD, using bid price with spread: bid=1.0000000000, ask=1.00010000000000
2025-07-10 03:24:16,552 - INFO - orders - [MARGIN_CALC] Using prices for AUDSGD: bid=1.0000000000, ask=1.00010000000000
2025-07-10 03:24:16,553 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 10.00 SGD to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:24:16,554 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: SGDUSD
2025-07-10 03:24:16,554 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:24:16,554 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for SGDUSD, trying inverse
2025-07-10 03:24:16,554 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDSGD
2025-07-10 03:24:16,555 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.2806600000'), 'o': Decimal('1.2806200000')}
2025-07-10 03:24:16,555 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.2806600000
2025-07-10 03:24:16,555 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 10.00 SGD / 1.2806600000 = 7.808473755719707026064685397 USD
2025-07-10 03:24:16,556 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDSGD, Type: BUY, Qty: 0.01, Price: 1.00010000000000, Margin: 7.808473755719707026064685397, Commission: 0.10
2025-07-10 03:24:16,556 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDSGD, OrderType: BUY, Quantity: 0.01, FullMargin: 7.808473755719707026064685397
2025-07-10 03:24:16,556 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-10 03:24:16,556 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=7.808473755719707026064685397
2025-07-10 03:24:16,556 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-10 03:24:16,556 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:24:16,557 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDSGD
2025-07-10 03:24:16,557 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:24:16,557 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:24:16,557 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:24:16,557 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:24:16,557 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01, TotalSellQty=0.01000000, NetQty=0.01, IsHedged=True
2025-07-10 03:24:16,557 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.8473755719707026064685397')], HighestMarginPerLot=780.847376
2025-07-10 03:24:16,557 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:24:16,557 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:24:16,557 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDSGD, OrderType: BUY, MarginBefore: 7.81, MarginAfter: 7.81, AdditionalMargin: 0.0, OpenOrders: 1
2025-07-10 03:24:16,558 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=7.808473755719707026064685397
2025-07-10 03:24:16,574 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=351.79000000, margin=14.36000000 (was 14.36000000)
2025-07-10 03:24:16,574 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:24:16,574 - INFO - orders - [PERF] Order processing: 0.3914s
2025-07-10 03:24:16,594 - INFO - orders - [PERF] Order creation: 0.0198s
2025-07-10 03:24:16,594 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:24:16,594 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:24:16,595 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:24:16,595 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:24:16,596 - INFO - orders - [PERF] TOTAL place_order: 0.4145s
2025-07-10 03:24:16,614 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:24:16,614 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:24:16,614 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:24:16,614 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:24:16,614 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:24:16,614 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:24:16,614 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:24:16,614 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:24:16,614 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:24:16,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:24:16,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:24:16,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:24:16,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:24:16,622 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:24:16,623 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:24:16,623 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:24:16,623 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:24:16,623 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:24:16,625 - INFO - orders - Background balance/margin cache updated for user 1: balance=351.79000000, margin=14.36
2025-07-10 03:38:44,527 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 03:38:45,808 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 03:38:45,808 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 03:38:45,812 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 03:38:45,812 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 03:38:49,904 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 03:38:49,905 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 03:38:50,814 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 03:38:55,816 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 03:38:58,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 03:38:58,763 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 03:38:58,763 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 03:38:58,763 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 03:38:58,763 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 03:39:06,634 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-10 03:39:07,033 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:39:07,033 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:39:07,033 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:39:07,033 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:39:07,033 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:39:07,033 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:39:07,034 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:39:07,034 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:39:07,034 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:39:07,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:39:07,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:39:07,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:39:07,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:39:07,566 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:39:07,567 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:39:07,567 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:39:07,567 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:39:07,567 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:39:13,558 - INFO - orders - Order placement request received - User: 1, Symbol: AUDUSD, Type: BUY
2025-07-10 03:39:13,956 - INFO - orders - [MARGIN_CALC] Market data for AUDUSD: {'b': '0.6563500000', 'o': '0.6563500000'}
2025-07-10 03:39:13,957 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDUSD, using bid price with spread: bid=0.6563500000, ask=0.65641563500000
2025-07-10 03:39:13,957 - INFO - orders - [MARGIN_CALC] Using prices for AUDUSD: bid=0.6563500000, ask=0.65641563500000
2025-07-10 03:39:13,957 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDUSD, Type: BUY, Qty: 0.01, Price: 0.65641563500000, Margin: 6.56, Commission: 0.10
2025-07-10 03:39:13,957 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDUSD, OrderType: BUY, Quantity: 0.01, FullMargin: 6.56
2025-07-10 03:39:13,957 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 03:39:13,957 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.56
2025-07-10 03:39:13,957 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 03:39:13,957 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:39:13,958 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDUSD. Returning zero margin.
2025-07-10 03:39:13,958 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:39:13,958 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 03:39:13,958 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:39:13,959 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:39:13,961 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:39:13,961 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.56, AdditionalMargin: 6.56, OpenOrders: 0
2025-07-10 03:39:13,961 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.56
2025-07-10 03:39:13,995 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=351.79000000, margin=20.92000000 (was 14.36000000)
2025-07-10 03:39:13,995 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:39:13,995 - INFO - orders - [PERF] Order processing: 0.4358s
2025-07-10 03:39:14,021 - INFO - orders - [PERF] Order creation: 0.0259s
2025-07-10 03:39:14,022 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:39:14,022 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:39:14,022 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:39:14,023 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:39:14,025 - INFO - orders - [PERF] TOTAL place_order: 0.4811s
2025-07-10 03:39:14,055 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:39:14,055 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:39:14,055 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:39:14,060 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:39:14,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:39:14,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:39:14,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:39:14,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:39:14,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:39:14,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:39:14,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:39:14,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:39:14,062 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 20.92
2025-07-10 03:39:14,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:39:14,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:39:14,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:39:14,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:39:14,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:39:14,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:39:14,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:39:14,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:39:14,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:39:14,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:39:14,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:39:14,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:39:14,100 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 20.92
2025-07-10 03:39:14,103 - INFO - orders - Background balance/margin cache updated for user 1: balance=351.79000000, margin=20.92
2025-07-10 03:39:37,288 - INFO - orders - Order close request received - Order ID: 7791060265, User ID: 1, Close Price: 0.65612
2025-07-10 03:39:37,288 - INFO - orders - Request to close order 7791060265 for user 1 (user_type: demo) with price 0.65612. Frontend provided type: BUY, company: AUDUSD, status: CLOSED, frontend_status: CLOSED.
2025-07-10 03:39:37,300 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 03:39:37,312 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:39:37,312 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:39:37,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:39:37,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:39:37,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDUSD. Returning zero margin.
2025-07-10 03:39:37,321 - INFO - orders - Existing entry commission for order 7791060265: 0.10000000
2025-07-10 03:39:37,322 - INFO - orders - Commission calculation for order 7791060265: entry=0.10000000, exit=0.0, total=0.10
2025-07-10 03:39:37,322 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.380000000000000000000000 USD to USD for PnL on Close (user_id: 1, position: 7791060265)
2025-07-10 03:39:37,322 - INFO - orders - [CURRENCY_CONVERT] Currency is already USD, no conversion needed
2025-07-10 03:39:37,350 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=351.31000000, margin=14.36
2025-07-10 03:39:37,350 - INFO - orders - Setting user data cache for user 1 with wallet_balance=351.31000000, margin=14.36
2025-07-10 03:39:37,351 - INFO - orders - User data cache updated for user 1
2025-07-10 03:39:37,358 - INFO - orders - Balance/margin cache updated for user 1: balance=351.31000000, margin=14.36
2025-07-10 03:39:37,359 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 03:39:37,359 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 03:39:37,363 - INFO - orders - Fetched 3 open orders for user 1
2025-07-10 03:39:37,368 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 03:39:37,369 - INFO - orders - Updated static orders cache for user 1 with 3 open orders and 1 pending orders
2025-07-10 03:39:37,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:39:37,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:39:37,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:39:37,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:39:37,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:39:37,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:39:37,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:39:37,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:39:37,372 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:39:37,374 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=351.31000000, margin=14.36
2025-07-10 03:39:37,374 - INFO - orders - Publishing order update for user 1
2025-07-10 03:39:37,375 - INFO - orders - Publishing user data update for user 1
2025-07-10 03:39:37,375 - INFO - orders - Publishing market data trigger
2025-07-10 03:40:05,453 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDUSD, Type: BUY_LIMIT, Quantity: 0.01
2025-07-10 03:40:05,464 - INFO - orders - Validating pending order price: Order type=BUY_LIMIT, Order price=0.65645, Current buy price=0.6565, Current sell price=0.65619
2025-07-10 03:40:05,476 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-07-10 03:40:05,477 - INFO - orders - [DEBUG] User data from cache: {'id': 1, 'email': 'dhanush777ss@gmail.com', 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'user_type': 'demo', 'account_number': '5O42G', 'wallet_balance': Decimal('351.31000000'), 'margin': Decimal('14.36'), 'first_name': None, 'last_name': None, 'country': None, 'phone_number': Decimal('8618025298')}
2025-07-10 03:40:05,478 - INFO - orders - [DEBUG] Group name: Group B
2025-07-10 03:40:05,480 - INFO - orders - User 1 is_barclays_live_user: False (user_type: demo, sending_orders_normalized: barclays)
2025-07-10 03:40:05,485 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDUSD: contract_size=100000.00000000, profit_currency=USD, digit=5.00000
2025-07-10 03:40:05,890 - INFO - orders - [MARGIN_CALC] Market data for AUDUSD: {'b': '0.6563500000', 'o': '0.6563400000'}
2025-07-10 03:40:05,896 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDUSD, using bid price with spread: bid=0.6563500000, ask=0.65641563500000
2025-07-10 03:40:05,896 - INFO - orders - [MARGIN_CALC] Using prices for AUDUSD: bid=0.6563500000, ask=0.65641563500000
2025-07-10 03:40:05,899 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDUSD, Type: BUY_LIMIT, Qty: 0.01, Price: 0.65641563500000, Margin: 6.56, Commission: 0.10
2025-07-10 03:40:05,900 - INFO - orders - Calculated initial margin: 6.56, commission: 0.10 for pending order 8843080535
2025-07-10 03:40:05,915 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '8843080535', 'order_company_name': 'AUDUSD', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.65645'), 'user_type': 'demo', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '2555973759', 'takeprofit_id': '5896492327', 'order_user_id': 1, 'order_status': 'PENDING', 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.56'), 'commission': Decimal('0.10'), 'open_time': None}
2025-07-10 03:40:05,916 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 1 at price 0.65645
2025-07-10 03:40:05,916 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '8843080535', 'order_status': 'PENDING', 'order_user_id': 1, 'order_company_name': 'AUDUSD', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('0.65645'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.56'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '2555973759', 'takeprofit_id': '5896492327', 'close_id': None}
2025-07-10 03:40:06,113 - INFO - orders - Order 8843080535 verified in database on attempt 1 before adding to Redis.
2025-07-10 03:40:06,123 - INFO - orders - Pending order 8843080535 added to Redis for non-Barclays user or demo user.
2025-07-10 03:40:06,132 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:40:06,132 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:40:06,133 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:40:06,133 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:40:06,133 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:40:06,133 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:40:06,134 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:40:06,134 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:40:06,134 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:40:06,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:40:06,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:40:06,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:40:06,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:40:06,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:40:06,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:40:06,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:40:06,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:40:06,160 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:40:06,168 - INFO - orders - [PERF] TOTAL place_order: 0.7157s
2025-07-10 03:40:06,202 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:40:06,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:40:06,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:40:06,205 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:40:06,205 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:40:06,206 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:40:06,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:40:06,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:40:06,208 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:40:06,240 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:40:06,241 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:40:06,241 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:40:06,241 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:40:06,241 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:40:06,242 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:40:06,242 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:40:06,244 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:40:06,245 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:40:06,253 - INFO - orders - Background balance/margin cache updated for user 1: balance=351.31000000, margin=14.36
2025-07-10 03:40:47,389 - INFO - orders - [PENDING_CHECK] Found 1 matching BUY_LIMIT orders for AUDUSD at price 0.65644
2025-07-10 03:40:47,391 - INFO - orders - [PENDING_ORDER] Starting execution of order 8843080535 for user 1
2025-07-10 03:40:47,391 - INFO - orders - [PENDING_ORDER] Order 8843080535: Placed at 0.65645000, Triggered at 0.65644
2025-07-10 03:40:47,391 - INFO - orders - [PENDING_ORDER] Order 8843080535: Type BUY_LIMIT -> BUY
2025-07-10 03:40:47,394 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDUSD: contract_size=100000.00000000, profit_currency=USD, digit=5.00000
2025-07-10 03:40:47,742 - INFO - orders - [MARGIN_CALC] Market data for AUDUSD: {'b': '0.6562900000', 'o': '0.6562900000'}
2025-07-10 03:40:47,743 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDUSD, using bid price with spread: bid=0.6562900000, ask=0.65635562900000
2025-07-10 03:40:47,743 - INFO - orders - [MARGIN_CALC] Using prices for AUDUSD: bid=0.6562900000, ask=0.65635562900000
2025-07-10 03:40:47,743 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDUSD, Type: BUY, Qty: 0.01000000, Price: 0.65635562900000, Margin: 6.56, Commission: 0.10
2025-07-10 03:40:47,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:40:47,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:40:47,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:40:47,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:40:47,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:40:47,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:40:47,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:40:47,750 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:40:47,750 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:40:47,750 - INFO - orders - [PENDING_ORDER] Total user margin: 14.36
2025-07-10 03:40:47,758 - INFO - orders - [PENDING_ORDER] Updated user 1 total margin to 14.36 (includes all symbols)
2025-07-10 03:40:47,778 - INFO - orders - [PENDING_ORDER] Order 8843080535 status is OPEN, margin/commission updated
2025-07-10 03:40:47,804 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:40:47,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:40:47,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:40:47,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:40:47,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:40:47,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:40:47,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:40:47,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:40:47,805 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:40:47,806 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:40:47,806 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:40:47,806 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:40:47,806 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 20.92
2025-07-10 03:40:47,812 - WARNING - orders - [PENDING_ORDER] Cache verification failed for user 1, retrying...
2025-07-10 03:40:47,815 - INFO - orders - [PENDING_ORDER] Successfully executed order 8843080535 for user 1
2025-07-10 03:40:47,815 - INFO - orders - [PENDING_ORDER] Order 8843080535: Final price=0.65635562900000, margin=6.56, commission=0.10
2025-07-10 03:40:47,815 - INFO - orders - [PENDING_ORDER_SUMMARY] Order 8843080535 executed: BUY_LIMIT -> BUY, Placed: 0.65645000, Triggered: 0.65644, Margin: 6.56, Commission: 0.10, AdditionalMargin: None
2025-07-10 03:41:47,449 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-10 03:41:49,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:41:49,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:41:49,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:41:49,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:41:49,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:41:49,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:41:49,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:41:49,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:41:49,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:41:49,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:41:49,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:41:49,831 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:41:49,831 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 20.92
2025-07-10 03:44:06,771 - INFO - orders - Order placement request received - User: 1, Symbol: AUDCAD, Type: BUY
2025-07-10 03:44:07,223 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8976200000', 'o': '0.8976200000'}
2025-07-10 03:44:07,223 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8976200000, ask=0.89770976200000
2025-07-10 03:44:07,223 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8976200000, ask=0.89770976200000
2025-07-10 03:44:09,259 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.98 CAD to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:44:09,260 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-10 03:44:09,275 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:44:09,276 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-10 03:44:09,276 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-10 03:44:09,283 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3689400000'), 'o': Decimal('1.3689200000')}
2025-07-10 03:44:09,283 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3689400000
2025-07-10 03:44:09,283 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.98 CAD / 1.3689400000 = 6.559820006720528291963124753 USD
2025-07-10 03:44:09,283 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: BUY, Qty: 0.01, Price: 0.89770976200000, Margin: 6.559820006720528291963124753, Commission: 0.10
2025-07-10 03:44:09,284 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDCAD, OrderType: BUY, Quantity: 0.01, FullMargin: 6.559820006720528291963124753
2025-07-10 03:44:09,284 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 03:44:09,284 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.559820006720528291963124753
2025-07-10 03:44:09,284 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 03:44:09,284 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:44:09,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-10 03:44:09,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-10 03:44:09,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 03:44:09,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.9820006720528291963124753')], HighestMarginPerLot=655.9820006720528291963124753
2025-07-10 03:44:09,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.56
2025-07-10 03:44:09,292 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:44:09,292 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDCAD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.56, AdditionalMargin: 6.56, OpenOrders: 0
2025-07-10 03:44:09,293 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.559820006720528291963124753
2025-07-10 03:44:09,300 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 03:44:09,300 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 03:44:09,301 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 03:44:09,305 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 03:44:09,305 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 03:44:09,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:09,325 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 03:44:09,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:44:09,337 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 03:44:09,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 03:44:09,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 03:44:09,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 03:44:09,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 03:44:09,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 03:44:09,338 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 03:44:09,339 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 03:44:09,339 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 03:44:09,397 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=351.31000000, margin=20.92000000 (was 14.36000000)
2025-07-10 03:44:09,397 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:44:09,398 - INFO - orders - [PERF] Order processing: 2.6243s
2025-07-10 03:44:09,415 - INFO - orders - [PERF] Order creation: 0.0171s
2025-07-10 03:44:09,415 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:44:09,415 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:44:11,476 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:44:11,486 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:44:11,512 - INFO - orders - [PERF] TOTAL place_order: 4.7450s
2025-07-10 03:44:11,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:44:11,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:11,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:44:11,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:44:11,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:44:11,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:44:11,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:44:11,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:44:11,542 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:44:11,542 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:11,542 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:44:11,542 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:44:11,542 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-10 03:44:11,542 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:11,543 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.982001')], HighestMarginPerLot=655.982001
2025-07-10 03:44:11,543 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.56
2025-07-10 03:44:11,543 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 27.48
2025-07-10 03:44:11,573 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:44:11,573 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:11,573 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:44:11,574 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:44:11,574 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:44:11,574 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:44:11,574 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:44:11,574 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:44:11,574 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:44:11,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:11,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:44:11,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:44:11,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-10 03:44:11,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:11,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.982001')], HighestMarginPerLot=655.982001
2025-07-10 03:44:11,575 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.56
2025-07-10 03:44:11,575 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 27.48
2025-07-10 03:44:11,582 - INFO - orders - Background balance/margin cache updated for user 1: balance=351.31000000, margin=27.48
2025-07-10 03:44:15,814 - INFO - orders - Order close request received - Order ID: 2180510646, User ID: 1, Close Price: 0.89761
2025-07-10 03:44:15,815 - INFO - orders - Request to close order 2180510646 for user 1 (user_type: demo) with price 0.89761. Frontend provided type: BUY, company: AUDCAD, status: CLOSED, frontend_status: CLOSED.
2025-07-10 03:44:15,822 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 03:44:15,831 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCAD
2025-07-10 03:44:15,832 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:15,832 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.982001')], HighestMarginPerLot=655.982001
2025-07-10 03:44:15,832 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCAD: CalculatedTotalMargin=6.56
2025-07-10 03:44:15,832 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCAD. Returning zero margin.
2025-07-10 03:44:15,836 - INFO - orders - Existing entry commission for order 2180510646: 0.10000000
2025-07-10 03:44:15,836 - INFO - orders - Commission calculation for order 2180510646: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 03:44:15,836 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.010000000000000000000000 CAD to USD for PnL on Close (user_id: 1, position: 2180510646)
2025-07-10 03:44:15,836 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-10 03:44:15,837 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:44:15,837 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-10 03:44:15,837 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-10 03:44:15,837 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3689400000'), 'o': Decimal('1.3689200000')}
2025-07-10 03:44:15,837 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3689400000
2025-07-10 03:44:15,837 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.010000000000000000000000 CAD / 1.3689400000 = -0.007304922056481657340716174558 USD
2025-07-10 03:44:15,890 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=351.10000000, margin=14.36
2025-07-10 03:44:15,891 - INFO - orders - Setting user data cache for user 1 with wallet_balance=351.10000000, margin=14.36
2025-07-10 03:44:15,891 - INFO - orders - User data cache updated for user 1
2025-07-10 03:44:15,893 - INFO - orders - Balance/margin cache updated for user 1: balance=351.10000000, margin=14.36
2025-07-10 03:44:15,893 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 03:44:15,893 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 03:44:15,896 - INFO - orders - Fetched 4 open orders for user 1
2025-07-10 03:44:15,898 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 03:44:15,898 - INFO - orders - Updated static orders cache for user 1 with 4 open orders and 1 pending orders
2025-07-10 03:44:15,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:44:15,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:15,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:44:15,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:44:15,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:44:15,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:44:15,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:44:15,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:44:15,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:44:15,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:15,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:44:15,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:44:15,901 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 20.92
2025-07-10 03:44:15,903 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=351.10000000, margin=20.92
2025-07-10 03:44:15,903 - INFO - orders - Publishing order update for user 1
2025-07-10 03:44:15,904 - INFO - orders - Publishing user data update for user 1
2025-07-10 03:44:15,904 - INFO - orders - Publishing market data trigger
2025-07-10 03:44:17,233 - INFO - orders - Order close request received - Order ID: 8843080535, User ID: 1, Close Price: 0.6562
2025-07-10 03:44:17,233 - INFO - orders - Request to close order 8843080535 for user 1 (user_type: demo) with price 0.6562. Frontend provided type: BUY, company: AUDUSD, status: CLOSED, frontend_status: CLOSED.
2025-07-10 03:44:17,242 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 03:44:17,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDUSD
2025-07-10 03:44:17,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:17,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDUSD: AllMarginsPerLot=[Decimal('656')], HighestMarginPerLot=656
2025-07-10 03:44:17,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDUSD: CalculatedTotalMargin=6.56
2025-07-10 03:44:17,249 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDUSD. Returning zero margin.
2025-07-10 03:44:17,259 - INFO - orders - Existing entry commission for order 8843080535: 0.10000000
2025-07-10 03:44:17,259 - INFO - orders - Commission calculation for order 8843080535: entry=0.10000000, exit=0.0, total=0.10
2025-07-10 03:44:17,259 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.240000000000000000000000 USD to USD for PnL on Close (user_id: 1, position: 8843080535)
2025-07-10 03:44:17,259 - INFO - orders - [CURRENCY_CONVERT] Currency is already USD, no conversion needed
2025-07-10 03:44:17,277 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=350.76000000, margin=7.80
2025-07-10 03:44:17,277 - INFO - orders - Setting user data cache for user 1 with wallet_balance=350.76000000, margin=7.80
2025-07-10 03:44:17,278 - INFO - orders - User data cache updated for user 1
2025-07-10 03:44:17,279 - INFO - orders - Balance/margin cache updated for user 1: balance=350.76000000, margin=7.80
2025-07-10 03:44:17,279 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 03:44:17,279 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 03:44:17,281 - INFO - orders - Fetched 3 open orders for user 1
2025-07-10 03:44:17,284 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 03:44:17,285 - INFO - orders - Updated static orders cache for user 1 with 3 open orders and 1 pending orders
2025-07-10 03:44:17,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:44:17,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:17,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:44:17,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:44:17,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:44:17,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:44:17,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:44:17,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:44:17,287 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:44:17,288 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=350.76000000, margin=14.36
2025-07-10 03:44:17,288 - INFO - orders - Publishing order update for user 1
2025-07-10 03:44:17,289 - INFO - orders - Publishing user data update for user 1
2025-07-10 03:44:17,289 - INFO - orders - Publishing market data trigger
2025-07-10 03:44:21,973 - INFO - orders - Order close request received - Order ID: 5127352554, User ID: 1, Close Price: 0.99985
2025-07-10 03:44:21,973 - INFO - orders - Request to close order 5127352554 for user 1 (user_type: demo) with price 0.99985. Frontend provided type: BUY, company: AUDSGD, status: CLOSED, frontend_status: CLOSED.
2025-07-10 03:44:21,985 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 03:44:21,993 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDSGD
2025-07-10 03:44:21,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:44:21,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376'), Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:44:21,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:44:21,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDSGD
2025-07-10 03:44:21,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:21,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:44:21,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:44:21,998 - INFO - orders - Existing entry commission for order 5127352554: 0.10000000
2025-07-10 03:44:21,998 - INFO - orders - Commission calculation for order 5127352554: entry=0.10000000, exit=0.0, total=0.10
2025-07-10 03:44:21,998 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.300000000000000000000000 SGD to USD for PnL on Close (user_id: 1, position: 5127352554)
2025-07-10 03:44:21,998 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: SGDUSD
2025-07-10 03:44:21,998 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:44:21,998 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for SGDUSD, trying inverse
2025-07-10 03:44:21,998 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDSGD
2025-07-10 03:44:21,999 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.2806600000'), 'o': Decimal('1.2806200000')}
2025-07-10 03:44:21,999 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.2806600000
2025-07-10 03:44:21,999 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.300000000000000000000000 SGD / 1.2806600000 = -0.2342542126715912107819405619 USD
2025-07-10 03:44:22,011 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=350.43000000, margin=7.80
2025-07-10 03:44:22,011 - INFO - orders - Setting user data cache for user 1 with wallet_balance=350.43000000, margin=7.80
2025-07-10 03:44:22,012 - INFO - orders - User data cache updated for user 1
2025-07-10 03:44:22,013 - INFO - orders - Balance/margin cache updated for user 1: balance=350.43000000, margin=7.80
2025-07-10 03:44:22,013 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 03:44:22,013 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 03:44:22,015 - INFO - orders - Fetched 2 open orders for user 1
2025-07-10 03:44:22,017 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 03:44:22,017 - INFO - orders - Updated static orders cache for user 1 with 2 open orders and 1 pending orders
2025-07-10 03:44:22,019 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:44:22,019 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:22,019 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:44:22,019 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:44:22,019 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDSGD
2025-07-10 03:44:22,020 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:22,020 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:44:22,020 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:44:22,020 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 14.36
2025-07-10 03:44:22,020 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=350.43000000, margin=14.36
2025-07-10 03:44:22,020 - INFO - orders - Publishing order update for user 1
2025-07-10 03:44:22,021 - INFO - orders - Publishing user data update for user 1
2025-07-10 03:44:22,021 - INFO - orders - Publishing market data trigger
2025-07-10 03:44:23,585 - INFO - orders - Order close request received - Order ID: 7182402224, User ID: 1, Close Price: 1.00015
2025-07-10 03:44:23,585 - INFO - orders - Request to close order 7182402224 for user 1 (user_type: demo) with price 1.00015. Frontend provided type: SELL, company: AUDSGD, status: CLOSED, frontend_status: CLOSED.
2025-07-10 03:44:23,596 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 03:44:23,606 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDSGD
2025-07-10 03:44:23,606 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:23,606 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.847376')], HighestMarginPerLot=780.847376
2025-07-10 03:44:23,606 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDSGD: CalculatedTotalMargin=7.81
2025-07-10 03:44:23,606 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDSGD. Returning zero margin.
2025-07-10 03:44:23,611 - INFO - orders - Existing entry commission for order 7182402224: 0.10000000
2025-07-10 03:44:23,611 - INFO - orders - Commission calculation for order 7182402224: entry=0.10000000, exit=0.0, total=0.10
2025-07-10 03:44:23,611 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.300000000000000000000000 SGD to USD for PnL on Close (user_id: 1, position: 7182402224)
2025-07-10 03:44:23,611 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: SGDUSD
2025-07-10 03:44:23,612 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:44:23,612 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for SGDUSD, trying inverse
2025-07-10 03:44:23,612 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDSGD
2025-07-10 03:44:23,612 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.2806600000'), 'o': Decimal('1.2806200000')}
2025-07-10 03:44:23,612 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.2806600000
2025-07-10 03:44:23,612 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.300000000000000000000000 SGD / 1.2806600000 = -0.2342542126715912107819405619 USD
2025-07-10 03:44:23,630 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=350.10000000, margin=0
2025-07-10 03:44:23,630 - INFO - orders - Setting user data cache for user 1 with wallet_balance=350.10000000, margin=0
2025-07-10 03:44:23,631 - INFO - orders - User data cache updated for user 1
2025-07-10 03:44:23,632 - INFO - orders - Balance/margin cache updated for user 1: balance=350.10000000, margin=0
2025-07-10 03:44:23,632 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 03:44:23,632 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 03:44:23,634 - INFO - orders - Fetched 1 open orders for user 1
2025-07-10 03:44:23,637 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 03:44:23,638 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 1 pending orders
2025-07-10 03:44:23,640 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:44:23,640 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:23,640 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:44:23,640 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:44:23,640 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:44:23,641 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=350.10000000, margin=6.55
2025-07-10 03:44:23,641 - INFO - orders - Publishing order update for user 1
2025-07-10 03:44:23,641 - INFO - orders - Publishing user data update for user 1
2025-07-10 03:44:23,642 - INFO - orders - Publishing market data trigger
2025-07-10 03:44:24,794 - INFO - orders - Order close request received - Order ID: 2622196470, User ID: 1, Close Price: 0.5213300000000001
2025-07-10 03:44:24,795 - INFO - orders - Request to close order 2622196470 for user 1 (user_type: demo) with price 0.5213300000000001. Frontend provided type: BUY, company: AUDCHF, status: CLOSED, frontend_status: CLOSED.
2025-07-10 03:44:24,809 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 03:44:24,825 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDCHF
2025-07-10 03:44:24,825 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:44:24,825 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDCHF: AllMarginsPerLot=[Decimal('654.662428')], HighestMarginPerLot=654.662428
2025-07-10 03:44:24,825 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:44:24,826 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDCHF. Returning zero margin.
2025-07-10 03:44:24,829 - INFO - orders - Existing entry commission for order 2622196470: 0.10000000
2025-07-10 03:44:24,829 - INFO - orders - Commission calculation for order 2622196470: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 03:44:24,830 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -0.09999999999990000000000000000 CHF to USD for PnL on Close (user_id: 1, position: 2622196470)
2025-07-10 03:44:24,830 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-10 03:44:24,830 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:44:24,830 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-10 03:44:24,830 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-10 03:44:24,831 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7958300000'), 'o': Decimal('0.7958000000')}
2025-07-10 03:44:24,831 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7958300000
2025-07-10 03:44:24,832 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -0.09999999999990000000000000000 CHF / 0.7958300000 = -0.1256549765652212155862432932 USD
2025-07-10 03:44:24,855 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=349.77000000, margin=0
2025-07-10 03:44:24,855 - INFO - orders - Setting user data cache for user 1 with wallet_balance=349.77000000, margin=0
2025-07-10 03:44:24,856 - INFO - orders - User data cache updated for user 1
2025-07-10 03:44:24,857 - INFO - orders - Balance/margin cache updated for user 1: balance=349.77000000, margin=0
2025-07-10 03:44:24,857 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 03:44:24,857 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 03:44:24,860 - INFO - orders - Fetched 0 open orders for user 1
2025-07-10 03:44:24,862 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 03:44:24,862 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 1 pending orders
2025-07-10 03:44:24,867 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=349.77000000, margin=0.0
2025-07-10 03:44:24,867 - INFO - orders - Publishing order update for user 1
2025-07-10 03:44:24,867 - INFO - orders - Publishing user data update for user 1
2025-07-10 03:44:24,868 - INFO - orders - Publishing market data trigger
2025-07-10 03:49:43,917 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 03:49:45,127 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 03:49:45,127 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 03:49:45,128 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 03:49:45,128 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 03:49:49,206 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 03:49:49,207 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 03:49:50,130 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 03:49:55,128 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 03:49:55,990 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 03:49:55,993 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 03:49:55,993 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 03:49:55,993 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 03:49:55,994 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 03:49:55,994 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 03:50:25,127 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-10 03:50:38,328 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-10 03:50:38,720 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9100000000', 'o': '95.9060000000'}
2025-07-10 03:50:38,720 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9100000000, ask=95.91959100000000
2025-07-10 03:50:38,720 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9100000000, ask=95.91959100000000
2025-07-10 03:50:38,722 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 959.20 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:50:38,722 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 03:50:38,723 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:50:38,723 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 03:50:38,724 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 03:50:38,725 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 03:50:38,725 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 03:50:38,725 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 959.20 JPY / 146.4780000000 = 6.548423654064091535930310354 USD
2025-07-10 03:50:38,725 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 95.91959100000000, Margin: 6.548423654064091535930310354, Commission: 0.10
2025-07-10 03:50:38,725 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.548423654064091535930310354
2025-07-10 03:50:38,725 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 03:50:38,726 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.548423654064091535930310354
2025-07-10 03:50:38,726 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 03:50:38,726 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:50:38,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 03:50:38,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:38,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 03:50:38,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.8423654064091535930310354')], HighestMarginPerLot=654.8423654064091535930310354
2025-07-10 03:50:38,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:38,727 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:50:38,728 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.55, AdditionalMargin: 6.55, OpenOrders: 0
2025-07-10 03:50:38,728 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.548423654064091535930310354
2025-07-10 03:50:38,755 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=349.77000000, margin=6.55000000 (was 0E-8)
2025-07-10 03:50:38,755 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:50:38,755 - INFO - orders - [PERF] Order processing: 0.4195s
2025-07-10 03:50:38,785 - INFO - orders - [PERF] Order creation: 0.0297s
2025-07-10 03:50:38,785 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:50:38,786 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:50:38,786 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:50:38,789 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:50:38,794 - INFO - orders - [PERF] TOTAL place_order: 0.4698s
2025-07-10 03:50:38,816 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:38,817 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:50:38,817 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.842365')], HighestMarginPerLot=654.842365
2025-07-10 03:50:38,817 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:38,818 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:50:38,839 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:38,839 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:50:38,839 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.842365')], HighestMarginPerLot=654.842365
2025-07-10 03:50:38,839 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:38,839 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:50:38,844 - INFO - orders - Background balance/margin cache updated for user 1: balance=349.77000000, margin=6.55
2025-07-10 03:50:45,306 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: SELL
2025-07-10 03:50:45,656 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9100000000', 'o': '95.9040000000'}
2025-07-10 03:50:45,656 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9100000000, ask=95.91959100000000
2025-07-10 03:50:45,656 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9100000000, ask=95.91959100000000
2025-07-10 03:50:45,658 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 959.10 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:50:45,658 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 03:50:45,659 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:50:45,660 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 03:50:45,660 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 03:50:45,660 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 03:50:45,661 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 03:50:45,661 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 959.10 JPY / 146.4780000000 = 6.547740957686478515544996518 USD
2025-07-10 03:50:45,661 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 95.9100000000, Margin: 6.547740957686478515544996518, Commission: 0.10
2025-07-10 03:50:45,661 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: SELL, Quantity: 0.01, FullMargin: 6.547740957686478515544996518
2025-07-10 03:50:45,661 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-10 03:50:45,661 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=6.547740957686478515544996518
2025-07-10 03:50:45,661 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-10 03:50:45,661 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:50:45,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:45,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 03:50:45,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.842365')], HighestMarginPerLot=654.842365
2025-07-10 03:50:45,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:45,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:45,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01, NetQty=0.01000000, IsHedged=True
2025-07-10 03:50:45,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.842365'), Decimal('654.7740957686478515544996518')], HighestMarginPerLot=654.842365
2025-07-10 03:50:45,662 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:45,663 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:50:45,663 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: SELL, MarginBefore: 6.55, MarginAfter: 6.55, AdditionalMargin: 0.0, OpenOrders: 1
2025-07-10 03:50:45,663 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=6.547740957686478515544996518
2025-07-10 03:50:45,679 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=349.77000000, margin=6.55000000 (was 6.55000000)
2025-07-10 03:50:45,679 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:50:45,679 - INFO - orders - [PERF] Order processing: 0.3720s
2025-07-10 03:50:45,708 - INFO - orders - [PERF] Order creation: 0.0286s
2025-07-10 03:50:45,708 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:50:45,709 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:50:45,710 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:50:45,711 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:50:45,714 - INFO - orders - [PERF] TOTAL place_order: 0.4083s
2025-07-10 03:50:45,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:45,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:50:45,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.842365'), Decimal('654.774096')], HighestMarginPerLot=654.842365
2025-07-10 03:50:45,766 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:45,768 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:50:45,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:45,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:50:45,791 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.842365'), Decimal('654.774096')], HighestMarginPerLot=654.842365
2025-07-10 03:50:45,792 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:45,792 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:50:45,796 - INFO - orders - Background balance/margin cache updated for user 1: balance=349.77000000, margin=6.55
2025-07-10 03:50:51,953 - INFO - orders - Order close request received - Order ID: 6837172294, User ID: 1, Close Price: 95.86
2025-07-10 03:50:51,954 - INFO - orders - Request to close order 6837172294 for user 1 (user_type: demo) with price 95.86. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 03:50:51,987 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 03:50:52,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:52,010 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 03:50:52,011 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.842365'), Decimal('654.774096')], HighestMarginPerLot=654.842365
2025-07-10 03:50:52,020 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:52,021 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:52,021 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:50:52,032 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096')], HighestMarginPerLot=654.774096
2025-07-10 03:50:52,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:52,061 - INFO - orders - Existing entry commission for order 6837172294: 0.10000000
2025-07-10 03:50:52,062 - INFO - orders - Commission calculation for order 6837172294: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 03:50:52,062 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -100.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 6837172294)
2025-07-10 03:50:52,062 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 03:50:52,070 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:50:52,071 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 03:50:52,071 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 03:50:52,074 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 03:50:52,074 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 03:50:52,075 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -100.000000000000000000000000 JPY / 146.4780000000 = -0.6826963776130203853138355248 USD
2025-07-10 03:50:52,126 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=348.89000000, margin=6.55
2025-07-10 03:50:52,126 - INFO - orders - Setting user data cache for user 1 with wallet_balance=348.89000000, margin=6.55
2025-07-10 03:50:52,127 - INFO - orders - User data cache updated for user 1
2025-07-10 03:50:52,130 - INFO - orders - Balance/margin cache updated for user 1: balance=348.89000000, margin=6.55
2025-07-10 03:50:52,130 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 03:50:52,130 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 03:50:52,133 - INFO - orders - Fetched 1 open orders for user 1
2025-07-10 03:50:52,137 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 03:50:52,137 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 1 pending orders
2025-07-10 03:50:52,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:52,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:50:52,141 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096')], HighestMarginPerLot=654.774096
2025-07-10 03:50:52,142 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:52,142 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 03:50:52,144 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=348.89000000, margin=6.55
2025-07-10 03:50:52,144 - INFO - orders - Publishing order update for user 1
2025-07-10 03:50:52,145 - INFO - orders - Publishing user data update for user 1
2025-07-10 03:50:52,146 - INFO - orders - Publishing market data trigger
2025-07-10 03:50:55,149 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: SELL
2025-07-10 03:50:55,485 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9050000000', 'o': '95.9000000000'}
2025-07-10 03:50:55,486 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9050000000, ask=95.91459050000000
2025-07-10 03:50:55,486 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9050000000, ask=95.91459050000000
2025-07-10 03:50:55,487 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 959.05 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:50:55,487 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 03:50:55,488 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:50:55,489 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 03:50:55,489 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 03:50:55,490 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 03:50:55,491 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 03:50:55,492 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 959.05 JPY / 146.4780000000 = 6.547399609497672005352339600 USD
2025-07-10 03:50:55,492 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 95.9050000000, Margin: 6.547399609497672005352339600, Commission: 0.10
2025-07-10 03:50:55,492 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: SELL, Quantity: 0.01, FullMargin: 6.547399609497672005352339600
2025-07-10 03:50:55,492 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-10 03:50:55,493 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=6.547399609497672005352339600
2025-07-10 03:50:55,493 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-10 03:50:55,493 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:50:55,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:55,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 03:50:55,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096')], HighestMarginPerLot=654.774096
2025-07-10 03:50:55,495 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 03:50:55,495 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:55,495 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-10 03:50:55,495 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.7399609497672005352339600')], HighestMarginPerLot=654.774096
2025-07-10 03:50:55,496 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:50:55,497 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:50:55,497 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: SELL, MarginBefore: 6.55, MarginAfter: 13.10, AdditionalMargin: 6.55, OpenOrders: 1
2025-07-10 03:50:55,497 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=6.547399609497672005352339600
2025-07-10 03:50:55,522 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=348.89000000, margin=13.10000000 (was 6.55000000)
2025-07-10 03:50:55,522 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:50:55,523 - INFO - orders - [PERF] Order processing: 0.3706s
2025-07-10 03:50:55,542 - INFO - orders - [PERF] Order creation: 0.0189s
2025-07-10 03:50:55,542 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:50:55,542 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:50:55,543 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:50:55,546 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:50:55,548 - INFO - orders - [PERF] TOTAL place_order: 0.3999s
2025-07-10 03:50:55,577 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:55,578 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-10 03:50:55,580 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961')], HighestMarginPerLot=654.774096
2025-07-10 03:50:55,580 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:50:55,581 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:50:55,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 03:50:55,602 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-10 03:50:55,602 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961')], HighestMarginPerLot=654.774096
2025-07-10 03:50:55,602 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:50:55,602 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:50:55,605 - INFO - orders - Background balance/margin cache updated for user 1: balance=348.89000000, margin=13.10
2025-07-10 03:51:02,144 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-10 03:51:02,444 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9030000000', 'o': '95.8980000000'}
2025-07-10 03:51:02,445 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9030000000, ask=95.91259030000000
2025-07-10 03:51:02,445 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9030000000, ask=95.91259030000000
2025-07-10 03:51:02,446 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 959.13 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:51:02,446 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 03:51:02,447 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:51:02,447 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 03:51:02,447 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 03:51:02,447 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 03:51:02,447 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 03:51:02,448 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 959.13 JPY / 146.4780000000 = 6.547945766599762421660590669 USD
2025-07-10 03:51:02,448 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 95.91259030000000, Margin: 6.547945766599762421660590669, Commission: 0.10
2025-07-10 03:51:02,448 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.547945766599762421660590669
2025-07-10 03:51:02,448 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 2
2025-07-10 03:51:02,448 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.547945766599762421660590669
2025-07-10 03:51:02,448 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 2 existing orders + 1 new order
2025-07-10 03:51:02,448 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 03:51:02,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:02,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-10 03:51:02,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961')], HighestMarginPerLot=654.774096
2025-07-10 03:51:02,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:02,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:02,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:02,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.7945766599762421660590669')], HighestMarginPerLot=654.7945766599762421660590669
2025-07-10 03:51:02,449 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:02,450 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 03:51:02,450 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 13.10, MarginAfter: 13.10, AdditionalMargin: 0.0, OpenOrders: 2
2025-07-10 03:51:02,450 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.547945766599762421660590669
2025-07-10 03:51:02,458 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=348.89000000, margin=13.10000000 (was 13.10000000)
2025-07-10 03:51:02,459 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 03:51:02,459 - INFO - orders - [PERF] Order processing: 0.3139s
2025-07-10 03:51:02,469 - INFO - orders - [PERF] Order creation: 0.0100s
2025-07-10 03:51:02,469 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 03:51:02,469 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 03:51:02,470 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 03:51:02,471 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 03:51:02,471 - INFO - orders - [PERF] TOTAL place_order: 0.3276s
2025-07-10 03:51:02,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:02,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:02,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 03:51:02,494 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:02,495 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:51:02,513 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:02,513 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:02,514 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 03:51:02,514 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:02,514 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:51:02,520 - INFO - orders - Background balance/margin cache updated for user 1: balance=348.89000000, margin=13.10
2025-07-10 03:51:10,508 - INFO - orders - Pending order placement request received - User ID: 1, Symbol: AUDJPY, Type: BUY_LIMIT, Quantity: 0.01
2025-07-10 03:51:10,525 - INFO - orders - Validating pending order price: Order type=BUY_LIMIT, Order price=95.957, Current buy price=95.959, Current sell price=95.854
2025-07-10 03:51:10,534 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-07-10 03:51:10,539 - INFO - orders - [DEBUG] User data from cache: {'wallet_balance': Decimal('348.89000000'), 'margin': Decimal('13.10000000'), 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'user_id': 1, 'user_type': 'demo'}
2025-07-10 03:51:10,540 - INFO - orders - [DEBUG] Group name: Group B
2025-07-10 03:51:10,541 - INFO - orders - User 1 is_barclays_live_user: False (user_type: demo, sending_orders_normalized: barclays)
2025-07-10 03:51:10,547 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDJPY: contract_size=100000.00000000, profit_currency=JPY, digit=3.00000
2025-07-10 03:51:10,840 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9090000000', 'o': '95.9040000000'}
2025-07-10 03:51:10,840 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9090000000, ask=95.91859090000000
2025-07-10 03:51:10,840 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9090000000, ask=95.91859090000000
2025-07-10 03:51:10,841 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 959.19 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:51:10,841 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 03:51:10,842 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:51:10,842 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 03:51:10,842 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 03:51:10,844 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 03:51:10,844 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 03:51:10,844 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 959.19 JPY / 146.4780000000 = 6.548355384426330233891778970 USD
2025-07-10 03:51:10,845 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY_LIMIT, Qty: 0.01, Price: 95.91859090000000, Margin: 6.548355384426330233891778970, Commission: 0.10
2025-07-10 03:51:10,845 - INFO - orders - Calculated initial margin: 6.548355384426330233891778970, commission: 0.10 for pending order 6007857887
2025-07-10 03:51:10,855 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '6007857887', 'order_company_name': 'AUDJPY', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('95.957'), 'user_type': 'demo', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '6482718404', 'takeprofit_id': '3654815668', 'order_user_id': 1, 'order_status': 'PENDING', 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.548355384426330233891778970'), 'commission': Decimal('0.10'), 'open_time': None}
2025-07-10 03:51:10,855 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 1 at price 95.957
2025-07-10 03:51:10,856 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '6007857887', 'order_status': 'PENDING', 'order_user_id': 1, 'order_company_name': 'AUDJPY', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('95.957'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.548355384426330233891778970'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '6482718404', 'takeprofit_id': '3654815668', 'close_id': None}
2025-07-10 03:51:10,876 - INFO - orders - Order 6007857887 verified in database on attempt 1 before adding to Redis.
2025-07-10 03:51:10,879 - INFO - orders - Pending order 6007857887 added to Redis for non-Barclays user or demo user.
2025-07-10 03:51:10,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:10,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:10,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 03:51:10,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:10,886 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:51:10,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:10,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:10,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 03:51:10,901 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:10,902 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:51:10,907 - INFO - orders - [PERF] TOTAL place_order: 0.3997s
2025-07-10 03:51:10,927 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:10,927 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:10,927 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 03:51:10,927 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:10,927 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:51:10,948 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:10,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:10,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 03:51:10,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:10,949 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:51:10,955 - INFO - orders - Background balance/margin cache updated for user 1: balance=348.89000000, margin=13.10
2025-07-10 03:51:12,789 - INFO - orders - [PENDING_CHECK] Found 1 matching BUY_LIMIT orders for AUDJPY at price 95.955
2025-07-10 03:51:12,792 - INFO - orders - [PENDING_ORDER] Starting execution of order 6007857887 for user 1
2025-07-10 03:51:12,792 - INFO - orders - [PENDING_ORDER] Order 6007857887: Placed at 95.95700000, Triggered at 95.955
2025-07-10 03:51:12,792 - INFO - orders - [PENDING_ORDER] Order 6007857887: Type BUY_LIMIT -> BUY
2025-07-10 03:51:12,798 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDJPY: contract_size=100000.00000000, profit_currency=JPY, digit=3.00000
2025-07-10 03:51:13,087 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9050000000', 'o': '95.9010000000'}
2025-07-10 03:51:13,088 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9050000000, ask=95.91459050000000
2025-07-10 03:51:13,088 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9050000000, ask=95.91459050000000
2025-07-10 03:51:13,089 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 959.15 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 03:51:13,089 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 03:51:13,089 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 03:51:13,090 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 03:51:13,090 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 03:51:13,090 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 03:51:13,090 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 03:51:13,091 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 959.15 JPY / 146.4780000000 = 6.548082305875285025737653436 USD
2025-07-10 03:51:13,091 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01000000, Price: 95.91459050000000, Margin: 6.548082305875285025737653436, Commission: 0.10
2025-07-10 03:51:13,101 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:13,101 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:13,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 03:51:13,102 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:13,102 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:51:13,102 - INFO - orders - [PENDING_ORDER] Total user margin: 13.10
2025-07-10 03:51:13,115 - INFO - orders - [PENDING_ORDER] Updated user 1 total margin to 13.10 (includes all symbols)
2025-07-10 03:51:13,141 - INFO - orders - [PENDING_ORDER] Order 6007857887 status is OPEN, margin/commission updated
2025-07-10 03:51:13,173 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 1, Symbol AUDJPY
2025-07-10 03:51:13,173 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 03:51:13,173 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577'), Decimal('654.808231')], HighestMarginPerLot=654.808231
2025-07-10 03:51:13,173 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 03:51:13,174 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 03:51:13,179 - WARNING - orders - [PENDING_ORDER] Cache verification failed for user 1, retrying...
2025-07-10 03:51:13,182 - INFO - orders - [PENDING_ORDER] Successfully executed order 6007857887 for user 1
2025-07-10 03:51:13,182 - INFO - orders - [PENDING_ORDER] Order 6007857887: Final price=95.91459050000000, margin=6.548082305875285025737653436, commission=0.10
2025-07-10 03:51:13,182 - INFO - orders - [PENDING_ORDER_SUMMARY] Order 6007857887 executed: BUY_LIMIT -> BUY, Placed: 95.95700000, Triggered: 95.955, Margin: 6.548082305875285025737653436, Commission: 0.10, AdditionalMargin: None
2025-07-10 04:05:01,177 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 04:05:02,323 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 04:05:02,323 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 04:05:02,323 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 04:05:02,323 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 04:05:06,421 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 04:05:06,421 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 04:05:07,325 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 04:05:12,321 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 04:05:13,284 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 04:05:13,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 04:05:13,285 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 04:05:23,786 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 1, Symbol AUDJPY
2025-07-10 04:05:23,787 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:05:23,787 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577'), Decimal('654.808231')], HighestMarginPerLot=654.808231
2025-07-10 04:05:23,787 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:05:23,787 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 04:10:23,641 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 04:10:23,641 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 04:10:23,641 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 04:10:23,641 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 04:10:23,641 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 04:10:23,642 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 04:10:23,643 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 04:10:23,643 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 04:10:25,502 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 1, Symbol AUDJPY
2025-07-10 04:10:25,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:10:25,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577'), Decimal('654.808231')], HighestMarginPerLot=654.808231
2025-07-10 04:10:25,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:10:25,503 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 04:15:23,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 04:15:23,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 04:15:23,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 04:15:23,719 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 04:15:26,031 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 1, Symbol AUDJPY
2025-07-10 04:15:26,032 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:15:26,032 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577'), Decimal('654.808231')], HighestMarginPerLot=654.808231
2025-07-10 04:15:26,032 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:15:26,032 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 04:28:32,980 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 04:28:34,177 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 04:28:34,178 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 04:28:34,178 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 04:28:34,189 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 04:28:38,308 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 04:28:38,308 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 04:28:39,183 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 04:28:44,179 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 04:28:45,228 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 04:28:45,228 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 04:28:45,228 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 04:28:45,228 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 04:28:45,228 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 04:28:45,229 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 04:28:45,229 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 04:28:49,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 1, Symbol AUDJPY
2025-07-10 04:28:49,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:28:49,386 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577'), Decimal('654.808231')], HighestMarginPerLot=654.808231
2025-07-10 04:28:49,386 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:28:49,386 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 04:32:48,524 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-10 04:32:48,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:48,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:32:48,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577'), Decimal('654.808231')], HighestMarginPerLot=654.808231
2025-07-10 04:32:48,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:32:48,983 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 04:32:57,190 - INFO - orders - Order close request received - Order ID: 6007857887, User ID: 1, Close Price: 95.904
2025-07-10 04:32:57,190 - INFO - orders - Request to close order 6007857887 for user 1 (user_type: demo) with price 95.904. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:32:57,208 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:32:57,233 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:57,234 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:32:57,234 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577'), Decimal('654.808231')], HighestMarginPerLot=654.808231
2025-07-10 04:32:57,235 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:32:57,235 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:57,236 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:32:57,236 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 04:32:57,237 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:32:57,254 - INFO - orders - Existing entry commission for order 6007857887: 0.10000000
2025-07-10 04:32:57,254 - INFO - orders - Commission calculation for order 6007857887: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:32:57,255 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -51.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 6007857887)
2025-07-10 04:32:57,255 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:32:57,257 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:32:57,257 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:32:57,258 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:32:57,260 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:32:57,260 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:32:57,261 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -51.000000000000000000000000 JPY / 146.4780000000 = -0.3481751525826403965100561176 USD
2025-07-10 04:32:57,321 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=348.34000000, margin=13.10
2025-07-10 04:32:57,321 - INFO - orders - Setting user data cache for user 1 with wallet_balance=348.34000000, margin=13.10
2025-07-10 04:32:57,323 - INFO - orders - User data cache updated for user 1
2025-07-10 04:32:57,326 - INFO - orders - Balance/margin cache updated for user 1: balance=348.34000000, margin=13.10
2025-07-10 04:32:57,327 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:32:57,327 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:32:57,332 - INFO - orders - Fetched 3 open orders for user 1
2025-07-10 04:32:57,336 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:32:57,337 - INFO - orders - Updated static orders cache for user 1 with 3 open orders and 1 pending orders
2025-07-10 04:32:57,341 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:57,341 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:32:57,341 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 04:32:57,341 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:32:57,341 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 04:32:57,343 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=348.34000000, margin=13.10
2025-07-10 04:32:57,344 - INFO - orders - Publishing order update for user 1
2025-07-10 04:32:57,345 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:32:57,345 - INFO - orders - Publishing market data trigger
2025-07-10 04:32:57,910 - INFO - orders - Order close request received - Order ID: 6901192288, User ID: 1, Close Price: 95.9
2025-07-10 04:32:57,910 - INFO - orders - Request to close order 6901192288 for user 1 (user_type: demo) with price 95.9. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:32:57,932 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:32:57,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:57,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:32:57,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961'), Decimal('654.794577')], HighestMarginPerLot=654.794577
2025-07-10 04:32:57,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:32:57,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:57,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-10 04:32:57,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961')], HighestMarginPerLot=654.774096
2025-07-10 04:32:57,951 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:32:57,963 - INFO - orders - Existing entry commission for order 6901192288: 0.10000000
2025-07-10 04:32:57,963 - INFO - orders - Commission calculation for order 6901192288: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:32:57,963 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -55.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 6901192288)
2025-07-10 04:32:57,964 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:32:57,966 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:32:57,966 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:32:57,966 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:32:57,967 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:32:57,968 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:32:57,968 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -55.000000000000000000000000 JPY / 146.4780000000 = -0.3754830076871612119226095386 USD
2025-07-10 04:32:58,007 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=347.76000000, margin=13.10
2025-07-10 04:32:58,007 - INFO - orders - Setting user data cache for user 1 with wallet_balance=347.76000000, margin=13.10
2025-07-10 04:32:58,009 - INFO - orders - User data cache updated for user 1
2025-07-10 04:32:58,015 - INFO - orders - Balance/margin cache updated for user 1: balance=347.76000000, margin=13.10
2025-07-10 04:32:58,015 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:32:58,015 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:32:58,022 - INFO - orders - Fetched 2 open orders for user 1
2025-07-10 04:32:58,029 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:32:58,031 - INFO - orders - Updated static orders cache for user 1 with 2 open orders and 1 pending orders
2025-07-10 04:32:58,037 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:58,038 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-10 04:32:58,038 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961')], HighestMarginPerLot=654.774096
2025-07-10 04:32:58,038 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:32:58,038 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.10
2025-07-10 04:32:58,042 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=347.76000000, margin=13.10
2025-07-10 04:32:58,043 - INFO - orders - Publishing order update for user 1
2025-07-10 04:32:58,044 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:32:58,047 - INFO - orders - Publishing market data trigger
2025-07-10 04:32:58,601 - INFO - orders - Order close request received - Order ID: 6766804699, User ID: 1, Close Price: 96
2025-07-10 04:32:58,601 - INFO - orders - Request to close order 6766804699 for user 1 (user_type: demo) with price 96. Frontend provided type: SELL, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:32:58,613 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:32:58,623 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:58,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-10 04:32:58,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096'), Decimal('654.739961')], HighestMarginPerLot=654.774096
2025-07-10 04:32:58,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.10
2025-07-10 04:32:58,624 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:58,625 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 04:32:58,625 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096')], HighestMarginPerLot=654.774096
2025-07-10 04:32:58,625 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 04:32:58,636 - INFO - orders - Existing entry commission for order 6766804699: 0.10000000
2025-07-10 04:32:58,637 - INFO - orders - Commission calculation for order 6766804699: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:32:58,637 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -147.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 6766804699)
2025-07-10 04:32:58,637 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:32:58,638 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:32:58,638 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:32:58,638 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:32:58,639 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:32:58,640 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:32:58,640 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -147.000000000000000000000000 JPY / 146.4780000000 = -1.003563675091139966411338221 USD
2025-07-10 04:32:58,667 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=346.56000000, margin=6.55
2025-07-10 04:32:58,667 - INFO - orders - Setting user data cache for user 1 with wallet_balance=346.56000000, margin=6.55
2025-07-10 04:32:58,668 - INFO - orders - User data cache updated for user 1
2025-07-10 04:32:58,672 - INFO - orders - Balance/margin cache updated for user 1: balance=346.56000000, margin=6.55
2025-07-10 04:32:58,672 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:32:58,673 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:32:58,678 - INFO - orders - Fetched 1 open orders for user 1
2025-07-10 04:32:58,682 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:32:58,684 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 1 pending orders
2025-07-10 04:32:58,695 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:58,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 04:32:58,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096')], HighestMarginPerLot=654.774096
2025-07-10 04:32:58,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 04:32:58,696 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 04:32:58,699 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=346.56000000, margin=6.55
2025-07-10 04:32:58,699 - INFO - orders - Publishing order update for user 1
2025-07-10 04:32:58,701 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:32:58,703 - INFO - orders - Publishing market data trigger
2025-07-10 04:32:59,243 - INFO - orders - Order close request received - Order ID: 4307769882, User ID: 1, Close Price: 96
2025-07-10 04:32:59,244 - INFO - orders - Request to close order 4307769882 for user 1 (user_type: demo) with price 96. Frontend provided type: SELL, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:32:59,270 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:32:59,284 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:32:59,284 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-10 04:32:59,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.774096')], HighestMarginPerLot=654.774096
2025-07-10 04:32:59,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 04:32:59,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 04:32:59,295 - INFO - orders - Existing entry commission for order 4307769882: 0.10000000
2025-07-10 04:32:59,295 - INFO - orders - Commission calculation for order 4307769882: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:32:59,296 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -146.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 4307769882)
2025-07-10 04:32:59,296 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:32:59,297 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:32:59,297 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:32:59,297 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:32:59,298 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:32:59,298 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:32:59,299 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -146.000000000000000000000000 JPY / 146.4780000000 = -0.9967367113150097625581998662 USD
2025-07-10 04:32:59,325 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=345.36000000, margin=0
2025-07-10 04:32:59,325 - INFO - orders - Setting user data cache for user 1 with wallet_balance=345.36000000, margin=0
2025-07-10 04:32:59,326 - INFO - orders - User data cache updated for user 1
2025-07-10 04:32:59,330 - INFO - orders - Balance/margin cache updated for user 1: balance=345.36000000, margin=0
2025-07-10 04:32:59,330 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:32:59,330 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:32:59,334 - INFO - orders - Fetched 0 open orders for user 1
2025-07-10 04:32:59,338 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:32:59,340 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 1 pending orders
2025-07-10 04:32:59,348 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=345.36000000, margin=0.0
2025-07-10 04:32:59,348 - INFO - orders - Publishing order update for user 1
2025-07-10 04:32:59,351 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:32:59,352 - INFO - orders - Publishing market data trigger
2025-07-10 04:33:02,934 - INFO - orders - [get_closed_orders] user_type: demo
2025-07-10 04:33:08,044 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-10 04:33:19,432 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-10 04:33:19,775 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9460000000', 'o': '95.9400000000'}
2025-07-10 04:33:19,776 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9460000000, ask=95.95559460000000
2025-07-10 04:33:19,776 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9460000000, ask=95.95559460000000
2025-07-10 04:33:19,777 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 959.56 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 04:33:19,777 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:33:19,778 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:33:19,778 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:33:19,778 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:33:19,779 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:33:19,780 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:33:19,780 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 959.56 JPY / 146.4780000000 = 6.550881361023498409317440162 USD
2025-07-10 04:33:19,780 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 95.95559460000000, Margin: 6.550881361023498409317440162, Commission: 0.10
2025-07-10 04:33:19,780 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.550881361023498409317440162
2025-07-10 04:33:19,780 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 04:33:19,780 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.550881361023498409317440162
2025-07-10 04:33:19,780 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 04:33:19,781 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 04:33:19,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 04:33:19,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:33:19,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 04:33:19,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.0881361023498409317440162')], HighestMarginPerLot=655.0881361023498409317440162
2025-07-10 04:33:19,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 04:33:19,781 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 04:33:19,782 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.55, AdditionalMargin: 6.55, OpenOrders: 0
2025-07-10 04:33:19,782 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.550881361023498409317440162
2025-07-10 04:33:19,799 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=345.36000000, margin=6.55000000 (was 0E-8)
2025-07-10 04:33:19,799 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 04:33:19,799 - INFO - orders - [PERF] Order processing: 0.3637s
2025-07-10 04:33:19,816 - INFO - orders - [PERF] Order creation: 0.0167s
2025-07-10 04:33:19,816 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 04:33:19,816 - INFO - orders - [PUBLISH_DEBUG] Publishing order update for user 1
2025-07-10 04:33:19,817 - INFO - orders - [PUBLISH_DEBUG] Publishing user data update for user 1
2025-07-10 04:33:19,819 - INFO - orders - [PUBLISH_DEBUG] Publishing market data trigger
2025-07-10 04:33:19,820 - INFO - orders - [PERF] TOTAL place_order: 0.3886s
2025-07-10 04:33:19,845 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:33:19,845 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:33:19,845 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.088136')], HighestMarginPerLot=655.088136
2025-07-10 04:33:19,845 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 04:33:19,845 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 04:33:19,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:33:19,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:33:19,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.088136')], HighestMarginPerLot=655.088136
2025-07-10 04:33:19,866 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 04:33:19,866 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 04:33:19,869 - INFO - orders - Background balance/margin cache updated for user 1: balance=345.36000000, margin=6.55
2025-07-10 04:33:22,650 - INFO - orders - Order close request received - Order ID: 1706360528, User ID: 1, Close Price: 95.89
2025-07-10 04:33:22,651 - INFO - orders - Request to close order 1706360528 for user 1 (user_type: demo) with price 95.89. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:33:22,664 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:33:22,675 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:33:22,675 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:33:22,675 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('655.088136')], HighestMarginPerLot=655.088136
2025-07-10 04:33:22,675 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 04:33:22,676 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 04:33:22,682 - INFO - orders - Existing entry commission for order 1706360528: 0.10000000
2025-07-10 04:33:22,682 - INFO - orders - Commission calculation for order 1706360528: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:33:22,683 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -105.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 1706360528)
2025-07-10 04:33:22,683 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:33:22,683 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:33:22,684 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:33:22,684 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:33:22,685 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:33:22,685 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:33:22,685 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -105.000000000000000000000000 JPY / 146.4780000000 = -0.7168311964936714045795273010 USD
2025-07-10 04:33:22,707 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=344.44000000, margin=0
2025-07-10 04:33:22,708 - INFO - orders - Setting user data cache for user 1 with wallet_balance=344.44000000, margin=0
2025-07-10 04:33:22,709 - INFO - orders - User data cache updated for user 1
2025-07-10 04:33:22,713 - INFO - orders - Balance/margin cache updated for user 1: balance=344.44000000, margin=0
2025-07-10 04:33:22,713 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:33:22,713 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:33:22,718 - INFO - orders - Fetched 0 open orders for user 1
2025-07-10 04:33:22,721 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:33:22,722 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 1 pending orders
2025-07-10 04:33:22,732 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=344.44000000, margin=0.0
2025-07-10 04:33:22,732 - INFO - orders - Publishing order update for user 1
2025-07-10 04:33:22,734 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:33:22,736 - INFO - orders - Publishing market data trigger
2025-07-10 04:53:23,288 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 04:53:24,490 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 04:53:24,490 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 04:53:24,490 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 04:53:24,490 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 04:53:28,569 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 04:53:28,570 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 04:53:29,495 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 04:53:34,492 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 04:53:35,435 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 04:53:35,435 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 04:56:14,738 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 04:56:15,916 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 04:56:15,916 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 04:56:15,916 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 04:56:15,917 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 04:56:19,981 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 04:56:19,981 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 04:56:20,923 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 04:56:25,926 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 04:56:35,814 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-10 04:56:36,177 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.8520000000', 'o': '95.8460000000'}
2025-07-10 04:56:36,177 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.8520000000, ask=95.86158520000000
2025-07-10 04:56:36,177 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.8520000000, ask=95.86158520000000
2025-07-10 04:56:38,235 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 958.62 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 04:56:38,235 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:56:38,240 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:56:38,240 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:56:38,240 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:56:38,246 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:56:38,246 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:56:38,246 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 958.62 JPY / 146.4780000000 = 6.544464015073936017695490108 USD
2025-07-10 04:56:38,246 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 95.86158520000000, Margin: 6.544464015073936017695490108, Commission: 0.10
2025-07-10 04:56:38,246 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.544464015073936017695490108
2025-07-10 04:56:38,246 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 04:56:38,246 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.544464015073936017695490108
2025-07-10 04:56:38,246 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 04:56:38,247 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 04:56:38,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 04:56:38,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:38,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 04:56:38,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.4464015073936017695490108')], HighestMarginPerLot=654.4464015073936017695490108
2025-07-10 04:56:38,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:56:38,249 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 04:56:38,249 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.54, AdditionalMargin: 6.54, OpenOrders: 0
2025-07-10 04:56:38,249 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.544464015073936017695490108
2025-07-10 04:56:38,284 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=344.44000000, margin=6.54000000 (was 0E-8)
2025-07-10 04:56:38,284 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 04:56:38,284 - INFO - orders - [PERF] Order processing: 2.4668s
2025-07-10 04:56:38,324 - INFO - orders - [PERF] Order creation: 0.0397s
2025-07-10 04:56:38,325 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 04:56:38,325 - INFO - orders - [PERF] TOTAL place_order: 2.5116s
2025-07-10 04:56:38,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:38,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:56:38,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402')], HighestMarginPerLot=654.446402
2025-07-10 04:56:38,344 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:56:38,344 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:56:38,387 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:38,387 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:56:38,387 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402')], HighestMarginPerLot=654.446402
2025-07-10 04:56:38,387 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:56:38,391 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:56:38,406 - INFO - orders - Background balance/margin cache updated for user 1: balance=344.44000000, margin=6.54
2025-07-10 04:56:38,941 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-10 04:56:43,018 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: SELL
2025-07-10 04:56:43,349 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.8440000000', 'o': '95.8400000000'}
2025-07-10 04:56:43,349 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.8440000000, ask=95.85358440000000
2025-07-10 04:56:43,350 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.8440000000, ask=95.85358440000000
2025-07-10 04:56:43,351 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 958.44 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 04:56:43,351 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:56:43,351 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:56:43,351 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:56:43,352 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:56:43,352 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:56:43,352 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:56:43,352 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 958.44 JPY / 146.4780000000 = 6.543235161594232581001925204 USD
2025-07-10 04:56:43,352 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 95.8440000000, Margin: 6.543235161594232581001925204, Commission: 0.10
2025-07-10 04:56:43,352 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: SELL, Quantity: 0.01, FullMargin: 6.543235161594232581001925204
2025-07-10 04:56:43,352 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-10 04:56:43,353 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=6.543235161594232581001925204
2025-07-10 04:56:43,353 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-10 04:56:43,353 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 04:56:43,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:43,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:56:43,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402')], HighestMarginPerLot=654.446402
2025-07-10 04:56:43,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:56:43,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:43,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01, NetQty=0.01000000, IsHedged=True
2025-07-10 04:56:43,353 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.3235161594232581001925204')], HighestMarginPerLot=654.446402
2025-07-10 04:56:43,354 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:56:43,354 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 04:56:43,354 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: SELL, MarginBefore: 6.54, MarginAfter: 6.54, AdditionalMargin: 0.0, OpenOrders: 1
2025-07-10 04:56:43,354 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=6.543235161594232581001925204
2025-07-10 04:56:43,366 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=344.44000000, margin=6.54000000 (was 6.54000000)
2025-07-10 04:56:43,367 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 04:56:43,367 - INFO - orders - [PERF] Order processing: 0.3471s
2025-07-10 04:56:43,384 - INFO - orders - [PERF] Order creation: 0.0172s
2025-07-10 04:56:43,384 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 04:56:43,385 - INFO - orders - [PERF] TOTAL place_order: 0.3666s
2025-07-10 04:56:43,403 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:43,403 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:56:43,404 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516')], HighestMarginPerLot=654.446402
2025-07-10 04:56:43,404 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:56:43,404 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:56:43,427 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:43,427 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:56:43,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516')], HighestMarginPerLot=654.446402
2025-07-10 04:56:43,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:56:43,428 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:56:43,433 - INFO - orders - Background balance/margin cache updated for user 1: balance=344.44000000, margin=6.54
2025-07-10 04:56:43,852 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-10 04:56:45,501 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-10 04:56:45,898 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.8700000000', 'o': '95.8630000000'}
2025-07-10 04:56:45,898 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.8700000000, ask=95.87958700000000
2025-07-10 04:56:45,898 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.8700000000, ask=95.87958700000000
2025-07-10 04:56:45,899 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 958.80 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 04:56:45,900 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:56:45,900 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:56:45,901 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:56:45,901 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:56:45,901 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:56:45,902 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:56:45,902 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 958.80 JPY / 146.4780000000 = 6.545692868553639454389055012 USD
2025-07-10 04:56:45,902 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 95.87958700000000, Margin: 6.545692868553639454389055012, Commission: 0.10
2025-07-10 04:56:45,902 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.545692868553639454389055012
2025-07-10 04:56:45,902 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 2
2025-07-10 04:56:45,902 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.545692868553639454389055012
2025-07-10 04:56:45,902 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 2 existing orders + 1 new order
2025-07-10 04:56:45,902 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 04:56:45,902 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:45,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:56:45,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516')], HighestMarginPerLot=654.446402
2025-07-10 04:56:45,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:56:45,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:45,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:56:45,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516'), Decimal('654.5692868553639454389055012')], HighestMarginPerLot=654.5692868553639454389055012
2025-07-10 04:56:45,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.09
2025-07-10 04:56:45,903 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 04:56:45,903 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 6.54, MarginAfter: 13.09, AdditionalMargin: 6.55, OpenOrders: 2
2025-07-10 04:56:45,903 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.545692868553639454389055012
2025-07-10 04:56:45,920 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=344.44000000, margin=13.09000000 (was 6.54000000)
2025-07-10 04:56:45,920 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 04:56:45,920 - INFO - orders - [PERF] Order processing: 0.4179s
2025-07-10 04:56:45,937 - INFO - orders - [PERF] Order creation: 0.0168s
2025-07-10 04:56:45,937 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 04:56:45,938 - INFO - orders - [PERF] TOTAL place_order: 0.4372s
2025-07-10 04:56:45,959 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:45,962 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:56:45,962 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516'), Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 04:56:45,962 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.09
2025-07-10 04:56:45,962 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.09
2025-07-10 04:56:45,980 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 04:56:45,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:56:45,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516'), Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 04:56:45,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.09
2025-07-10 04:56:45,981 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 13.09
2025-07-10 04:56:45,985 - INFO - orders - Background balance/margin cache updated for user 1: balance=344.44000000, margin=13.09
2025-07-10 04:56:46,409 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-10 04:57:03,528 - INFO - orders - Order close request received - Order ID: 9029139681, User ID: 1, Close Price: 95.779
2025-07-10 04:57:03,528 - INFO - orders - Request to close order 9029139681 for user 1 (user_type: demo) with price 95.779. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:57:03,565 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:57:03,593 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:03,594 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0.01000000, NetQty=0.02000000, IsHedged=True
2025-07-10 04:57:03,595 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516'), Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 04:57:03,595 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=13.09
2025-07-10 04:57:03,595 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:03,595 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:57:03,596 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516')], HighestMarginPerLot=654.446402
2025-07-10 04:57:03,596 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:03,623 - INFO - orders - Existing entry commission for order 9029139681: 0.10000000
2025-07-10 04:57:03,626 - INFO - orders - Commission calculation for order 9029139681: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:57:03,627 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -115.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 9029139681)
2025-07-10 04:57:03,628 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:57:03,634 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:57:03,635 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:57:03,636 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:57:03,643 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:57:03,644 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:57:03,646 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -115.000000000000000000000000 JPY / 146.4780000000 = -0.7851008342549734431109108535 USD
2025-07-10 04:57:03,691 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=343.45000000, margin=6.54
2025-07-10 04:57:03,692 - INFO - orders - Setting user data cache for user 1 with wallet_balance=343.45000000, margin=6.54
2025-07-10 04:57:03,693 - INFO - orders - User data cache updated for user 1
2025-07-10 04:57:03,696 - INFO - orders - Balance/margin cache updated for user 1: balance=343.45000000, margin=6.54
2025-07-10 04:57:03,696 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:57:03,696 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:57:03,699 - INFO - orders - Fetched 2 open orders for user 1
2025-07-10 04:57:03,703 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:57:03,704 - INFO - orders - Updated static orders cache for user 1 with 2 open orders and 1 pending orders
2025-07-10 04:57:03,708 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:03,708 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:57:03,708 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516')], HighestMarginPerLot=654.446402
2025-07-10 04:57:03,708 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:03,708 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:57:03,710 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=343.45000000, margin=6.54
2025-07-10 04:57:03,710 - INFO - orders - Publishing order update for user 1
2025-07-10 04:57:03,711 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:57:03,712 - INFO - orders - Publishing market data trigger
2025-07-10 04:57:04,771 - INFO - orders - Order close request received - Order ID: 2889742261, User ID: 1, Close Price: 95.887
2025-07-10 04:57:04,772 - INFO - orders - Request to close order 2889742261 for user 1 (user_type: demo) with price 95.887. Frontend provided type: SELL, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:57:04,783 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:57:04,794 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:04,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:57:04,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402'), Decimal('654.323516')], HighestMarginPerLot=654.446402
2025-07-10 04:57:04,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:04,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:04,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:04,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402')], HighestMarginPerLot=654.446402
2025-07-10 04:57:04,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:04,801 - INFO - orders - Existing entry commission for order 2889742261: 0.10000000
2025-07-10 04:57:04,802 - INFO - orders - Commission calculation for order 2889742261: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:57:04,802 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -96.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 2889742261)
2025-07-10 04:57:04,802 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:57:04,803 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:57:04,803 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:57:04,803 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:57:04,804 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:57:04,804 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:57:04,804 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -96.000000000000000000000000 JPY / 146.4780000000 = -0.6553885225084995699012821038 USD
2025-07-10 04:57:04,830 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=342.59000000, margin=6.54
2025-07-10 04:57:04,830 - INFO - orders - Setting user data cache for user 1 with wallet_balance=342.59000000, margin=6.54
2025-07-10 04:57:04,831 - INFO - orders - User data cache updated for user 1
2025-07-10 04:57:04,834 - INFO - orders - Balance/margin cache updated for user 1: balance=342.59000000, margin=6.54
2025-07-10 04:57:04,834 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:57:04,834 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:57:04,841 - INFO - orders - Fetched 1 open orders for user 1
2025-07-10 04:57:04,846 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:57:04,847 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 1 pending orders
2025-07-10 04:57:04,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:04,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:04,853 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402')], HighestMarginPerLot=654.446402
2025-07-10 04:57:04,854 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:04,854 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:57:04,856 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=342.59000000, margin=6.54
2025-07-10 04:57:04,856 - INFO - orders - Publishing order update for user 1
2025-07-10 04:57:04,857 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:57:04,860 - INFO - orders - Publishing market data trigger
2025-07-10 04:57:06,007 - INFO - orders - Order close request received - Order ID: 5946981187, User ID: 1, Close Price: 95.782
2025-07-10 04:57:06,008 - INFO - orders - Request to close order 5946981187 for user 1 (user_type: demo) with price 95.782. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:57:06,030 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:57:06,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:06,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:06,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.446402')], HighestMarginPerLot=654.446402
2025-07-10 04:57:06,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:06,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 04:57:06,052 - INFO - orders - Existing entry commission for order 5946981187: 0.10000000
2025-07-10 04:57:06,053 - INFO - orders - Commission calculation for order 5946981187: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:57:06,053 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 66.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 5946981187)
2025-07-10 04:57:06,053 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:57:06,053 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:57:06,054 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:57:06,054 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:57:06,055 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:57:06,055 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:57:06,055 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 66.000000000000000000000000 JPY / 146.4780000000 = 0.4505796092245934543071314464 USD
2025-07-10 04:57:06,082 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=342.84000000, margin=0
2025-07-10 04:57:06,083 - INFO - orders - Setting user data cache for user 1 with wallet_balance=342.84000000, margin=0
2025-07-10 04:57:06,084 - INFO - orders - User data cache updated for user 1
2025-07-10 04:57:06,087 - INFO - orders - Balance/margin cache updated for user 1: balance=342.84000000, margin=0
2025-07-10 04:57:06,087 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:57:06,087 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:57:06,090 - INFO - orders - Fetched 0 open orders for user 1
2025-07-10 04:57:06,093 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:57:06,095 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 1 pending orders
2025-07-10 04:57:06,101 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=342.84000000, margin=0.0
2025-07-10 04:57:06,102 - INFO - orders - Publishing order update for user 1
2025-07-10 04:57:06,102 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:57:06,103 - INFO - orders - Publishing market data trigger
2025-07-10 04:57:07,969 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-10 04:57:08,330 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.8420000000', 'o': '95.8360000000'}
2025-07-10 04:57:08,331 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.8420000000, ask=95.85158420000000
2025-07-10 04:57:08,331 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.8420000000, ask=95.85158420000000
2025-07-10 04:57:08,333 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 958.52 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 04:57:08,333 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:57:08,336 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:57:08,336 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:57:08,336 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:57:08,343 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:57:08,343 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:57:08,343 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 958.52 JPY / 146.4780000000 = 6.543781318696322997310176272 USD
2025-07-10 04:57:08,344 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 95.85158420000000, Margin: 6.543781318696322997310176272, Commission: 0.10
2025-07-10 04:57:08,344 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.543781318696322997310176272
2025-07-10 04:57:08,344 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 04:57:08,345 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.543781318696322997310176272
2025-07-10 04:57:08,345 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 04:57:08,345 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 04:57:08,346 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 04:57:08,346 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:08,346 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 04:57:08,346 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.3781318696322997310176272')], HighestMarginPerLot=654.3781318696322997310176272
2025-07-10 04:57:08,346 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:08,347 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 04:57:08,348 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.54, AdditionalMargin: 6.54, OpenOrders: 0
2025-07-10 04:57:08,348 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.543781318696322997310176272
2025-07-10 04:57:08,376 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=342.84000000, margin=6.54000000 (was 0E-8)
2025-07-10 04:57:08,376 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 04:57:08,377 - INFO - orders - [PERF] Order processing: 0.4042s
2025-07-10 04:57:08,388 - INFO - orders - [PERF] Order creation: 0.0113s
2025-07-10 04:57:08,388 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 04:57:08,388 - INFO - orders - [PERF] TOTAL place_order: 0.4237s
2025-07-10 04:57:08,404 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:08,404 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:08,404 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132')], HighestMarginPerLot=654.378132
2025-07-10 04:57:08,404 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:08,404 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:57:08,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:08,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:08,426 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132')], HighestMarginPerLot=654.378132
2025-07-10 04:57:08,426 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:08,426 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:57:08,429 - INFO - orders - Background balance/margin cache updated for user 1: balance=342.84000000, margin=6.54
2025-07-10 04:57:08,845 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-10 04:57:10,633 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: SELL
2025-07-10 04:57:10,992 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.8650000000', 'o': '95.8580000000'}
2025-07-10 04:57:10,992 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.8650000000, ask=95.87458650000000
2025-07-10 04:57:10,992 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.8650000000, ask=95.87458650000000
2025-07-10 04:57:10,994 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 958.65 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 04:57:10,994 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:57:10,995 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:57:10,995 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:57:10,995 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:57:10,996 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:57:10,996 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:57:10,997 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 958.65 JPY / 146.4780000000 = 6.544668823987219923811084258 USD
2025-07-10 04:57:10,997 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 95.8650000000, Margin: 6.544668823987219923811084258, Commission: 0.10
2025-07-10 04:57:10,997 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: SELL, Quantity: 0.01, FullMargin: 6.544668823987219923811084258
2025-07-10 04:57:10,997 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-10 04:57:10,997 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=6.544668823987219923811084258
2025-07-10 04:57:10,997 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-10 04:57:10,997 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 04:57:10,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:10,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:10,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132')], HighestMarginPerLot=654.378132
2025-07-10 04:57:10,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:10,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:10,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01, NetQty=0.01000000, IsHedged=True
2025-07-10 04:57:10,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132'), Decimal('654.4668823987219923811084258')], HighestMarginPerLot=654.4668823987219923811084258
2025-07-10 04:57:10,999 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:10,999 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 04:57:10,999 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: SELL, MarginBefore: 6.54, MarginAfter: 6.54, AdditionalMargin: 0.0, OpenOrders: 1
2025-07-10 04:57:11,000 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=6.544668823987219923811084258
2025-07-10 04:57:11,010 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=342.84000000, margin=6.54000000 (was 6.54000000)
2025-07-10 04:57:11,010 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 04:57:11,011 - INFO - orders - [PERF] Order processing: 0.3764s
2025-07-10 04:57:11,030 - INFO - orders - [PERF] Order creation: 0.0191s
2025-07-10 04:57:11,030 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 04:57:11,030 - INFO - orders - [PERF] TOTAL place_order: 0.3979s
2025-07-10 04:57:11,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:11,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:57:11,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132'), Decimal('654.466882')], HighestMarginPerLot=654.466882
2025-07-10 04:57:11,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:11,044 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:57:11,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:11,061 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:57:11,062 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132'), Decimal('654.466882')], HighestMarginPerLot=654.466882
2025-07-10 04:57:11,062 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:11,062 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:57:11,064 - INFO - orders - Background balance/margin cache updated for user 1: balance=342.84000000, margin=6.54
2025-07-10 04:57:11,496 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-10 04:57:18,979 - INFO - orders - Order close request received - Order ID: 7319909164, User ID: 1, Close Price: 95.89099999999999
2025-07-10 04:57:18,979 - INFO - orders - Request to close order 7319909164 for user 1 (user_type: demo) with price 95.89099999999999. Frontend provided type: SELL, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:57:18,988 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:57:18,995 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:18,995 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 04:57:18,995 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132'), Decimal('654.466882')], HighestMarginPerLot=654.466882
2025-07-10 04:57:18,995 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:18,995 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:18,995 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:18,995 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132')], HighestMarginPerLot=654.378132
2025-07-10 04:57:18,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:19,000 - INFO - orders - Existing entry commission for order 7319909164: 0.10000000
2025-07-10 04:57:19,000 - INFO - orders - Commission calculation for order 7319909164: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:57:19,000 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -104.9999999999900000000000000 JPY to USD for PnL on Close (user_id: 1, position: 7319909164)
2025-07-10 04:57:19,000 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:57:19,001 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:57:19,001 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:57:19,001 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:57:19,002 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:57:19,002 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:57:19,002 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -104.9999999999900000000000000 JPY / 146.4780000000 = -0.7168311964936031349417659990 USD
2025-07-10 04:57:19,028 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=341.92000000, margin=6.54
2025-07-10 04:57:19,028 - INFO - orders - Setting user data cache for user 1 with wallet_balance=341.92000000, margin=6.54
2025-07-10 04:57:19,029 - INFO - orders - User data cache updated for user 1
2025-07-10 04:57:19,031 - INFO - orders - Balance/margin cache updated for user 1: balance=341.92000000, margin=6.54
2025-07-10 04:57:19,032 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:57:19,032 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:57:19,035 - INFO - orders - Fetched 1 open orders for user 1
2025-07-10 04:57:19,038 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:57:19,039 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 1 pending orders
2025-07-10 04:57:19,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:19,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:19,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132')], HighestMarginPerLot=654.378132
2025-07-10 04:57:19,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:19,045 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.54
2025-07-10 04:57:19,047 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=341.92000000, margin=6.54
2025-07-10 04:57:19,047 - INFO - orders - Publishing order update for user 1
2025-07-10 04:57:19,048 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:57:19,049 - INFO - orders - Publishing market data trigger
2025-07-10 04:57:19,591 - INFO - orders - Order close request received - Order ID: 2627247003, User ID: 1, Close Price: 95.781
2025-07-10 04:57:19,592 - INFO - orders - Request to close order 2627247003 for user 1 (user_type: demo) with price 95.781. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 04:57:19,604 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 04:57:19,612 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 04:57:19,612 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 04:57:19,612 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.378132')], HighestMarginPerLot=654.378132
2025-07-10 04:57:19,612 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.54
2025-07-10 04:57:19,613 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 04:57:19,618 - INFO - orders - Existing entry commission for order 2627247003: 0.10000000
2025-07-10 04:57:19,619 - INFO - orders - Commission calculation for order 2627247003: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 04:57:19,619 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -108.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 2627247003)
2025-07-10 04:57:19,619 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 04:57:19,619 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 04:57:19,619 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 04:57:19,619 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 04:57:19,620 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 04:57:19,620 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 04:57:19,620 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -108.000000000000000000000000 JPY / 146.4780000000 = -0.7373120878220620161389423668 USD
2025-07-10 04:57:19,638 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=340.98000000, margin=0
2025-07-10 04:57:19,638 - INFO - orders - Setting user data cache for user 1 with wallet_balance=340.98000000, margin=0
2025-07-10 04:57:19,638 - INFO - orders - User data cache updated for user 1
2025-07-10 04:57:19,640 - INFO - orders - Balance/margin cache updated for user 1: balance=340.98000000, margin=0
2025-07-10 04:57:19,641 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 04:57:19,641 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 04:57:19,643 - INFO - orders - Fetched 0 open orders for user 1
2025-07-10 04:57:19,646 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 04:57:19,647 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 1 pending orders
2025-07-10 04:57:19,653 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=340.98000000, margin=0.0
2025-07-10 04:57:19,653 - INFO - orders - Publishing order update for user 1
2025-07-10 04:57:19,654 - INFO - orders - Publishing user data update for user 1
2025-07-10 04:57:19,655 - INFO - orders - Publishing market data trigger
2025-07-10 05:08:30,695 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 05:08:32,357 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 05:08:32,372 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 05:08:32,373 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 05:08:32,374 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 05:08:36,448 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 05:08:36,449 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 05:08:37,359 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 05:08:42,367 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 05:08:45,294 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:08:45,294 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:08:45,295 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:08:45,295 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:13:31,370 - INFO - orders - [get_rejected_orders] user_type: demo
2025-07-10 05:13:46,202 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: BUY
2025-07-10 05:13:46,503 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.8700000000', 'o': '95.8640000000'}
2025-07-10 05:13:46,503 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.8700000000, ask=95.87958700000000
2025-07-10 05:13:46,503 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.8700000000, ask=95.87958700000000
2025-07-10 05:13:46,504 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 958.80 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 05:13:46,504 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 05:13:46,506 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 05:13:46,507 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 05:13:46,507 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 05:13:46,507 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 05:13:46,508 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 05:13:46,508 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 958.80 JPY / 146.4780000000 = 6.545692868553639454389055012 USD
2025-07-10 05:13:46,508 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 95.87958700000000, Margin: 6.545692868553639454389055012, Commission: 0.10
2025-07-10 05:13:46,508 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.545692868553639454389055012
2025-07-10 05:13:46,508 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 05:13:46,508 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.545692868553639454389055012
2025-07-10 05:13:46,508 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 05:13:46,508 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 05:13:46,508 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 05:13:46,508 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:46,508 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 05:13:46,508 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.5692868553639454389055012')], HighestMarginPerLot=654.5692868553639454389055012
2025-07-10 05:13:46,509 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:46,509 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 05:13:46,509 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.55, AdditionalMargin: 6.55, OpenOrders: 0
2025-07-10 05:13:46,509 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.545692868553639454389055012
2025-07-10 05:13:46,544 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=340.98000000, margin=6.55000000 (was 0E-8)
2025-07-10 05:13:46,544 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 05:13:46,544 - INFO - orders - [PERF] Order processing: 0.3407s
2025-07-10 05:13:46,569 - INFO - orders - [PERF] Order creation: 0.0248s
2025-07-10 05:13:46,569 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 05:13:46,569 - INFO - orders - [PERF] TOTAL place_order: 0.3703s
2025-07-10 05:13:46,584 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:46,584 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:13:46,584 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 05:13:46,584 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:46,584 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 05:13:46,599 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:46,599 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:13:46,599 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 05:13:46,599 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:46,599 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 05:13:46,603 - INFO - orders - Background balance/margin cache updated for user 1: balance=340.98000000, margin=6.55
2025-07-10 05:13:47,011 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-10 05:13:48,414 - INFO - orders - Order placement request received - User: 1, Symbol: AUDJPY, Type: SELL
2025-07-10 05:13:48,758 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.8700000000', 'o': '95.8640000000'}
2025-07-10 05:13:48,758 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.8700000000, ask=95.87958700000000
2025-07-10 05:13:48,758 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.8700000000, ask=95.87958700000000
2025-07-10 05:13:48,759 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 958.70 JPY to USD for margin_calculation (user_id: 1, position: None)
2025-07-10 05:13:48,759 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 05:13:48,759 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 05:13:48,760 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 05:13:48,760 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 05:13:48,760 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 05:13:48,760 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 05:13:48,760 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 958.70 JPY / 146.4780000000 = 6.545010172176026434003741176 USD
2025-07-10 05:13:48,761 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 95.8700000000, Margin: 6.545010172176026434003741176, Commission: 0.10
2025-07-10 05:13:48,761 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 1, Symbol: AUDJPY, OrderType: SELL, Quantity: 0.01, FullMargin: 6.545010172176026434003741176
2025-07-10 05:13:48,761 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-10 05:13:48,761 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=6.545010172176026434003741176
2025-07-10 05:13:48,761 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-10 05:13:48,761 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 05:13:48,761 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:48,761 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:13:48,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 05:13:48,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:48,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:48,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01, NetQty=0.01000000, IsHedged=True
2025-07-10 05:13:48,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287'), Decimal('654.5010172176026434003741176')], HighestMarginPerLot=654.569287
2025-07-10 05:13:48,762 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:48,762 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 05:13:48,763 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 1, Symbol: AUDJPY, OrderType: SELL, MarginBefore: 6.55, MarginAfter: 6.55, AdditionalMargin: 0.0, OpenOrders: 1
2025-07-10 05:13:48,763 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=6.545010172176026434003741176
2025-07-10 05:13:48,777 - INFO - orders - [CACHE_UPDATE] Updating balance/margin cache for user 1: balance=340.98000000, margin=6.55000000 (was 6.55000000)
2025-07-10 05:13:48,777 - INFO - orders - [CACHE_UPDATE] Balance/margin cache updated for user 1
2025-07-10 05:13:48,777 - INFO - orders - [PERF] Order processing: 0.3609s
2025-07-10 05:13:48,795 - INFO - orders - [PERF] Order creation: 0.0181s
2025-07-10 05:13:48,795 - INFO - orders - is_barclays_live_user in place_order: False
2025-07-10 05:13:48,795 - INFO - orders - [PERF] TOTAL place_order: 0.3825s
2025-07-10 05:13:48,809 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:48,809 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 05:13:48,809 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287'), Decimal('654.501017')], HighestMarginPerLot=654.569287
2025-07-10 05:13:48,809 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:48,809 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 05:13:48,825 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:48,825 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 05:13:48,825 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287'), Decimal('654.501017')], HighestMarginPerLot=654.569287
2025-07-10 05:13:48,826 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:48,826 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 05:13:48,829 - INFO - orders - Background balance/margin cache updated for user 1: balance=340.98000000, margin=6.55
2025-07-10 05:13:49,172 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 1
2025-07-10 05:13:49,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:13:49,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:13:49,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:13:49,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:13:49,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:13:49,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:13:49,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:13:49,541 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:13:49,541 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:13:53,478 - INFO - orders - Order close request received - Order ID: 3738098498, User ID: 1, Close Price: 95.92
2025-07-10 05:13:53,478 - INFO - orders - Request to close order 3738098498 for user 1 (user_type: demo) with price 95.92. Frontend provided type: SELL, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 05:13:53,492 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 05:13:53,503 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:53,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 05:13:53,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287'), Decimal('654.501017')], HighestMarginPerLot=654.569287
2025-07-10 05:13:53,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:53,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:53,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:13:53,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 05:13:53,504 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:53,508 - INFO - orders - Existing entry commission for order 3738098498: 0.10000000
2025-07-10 05:13:53,508 - INFO - orders - Commission calculation for order 3738098498: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 05:13:53,509 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -106.000000000000000000000000 JPY to USD for PnL on Close (user_id: 1, position: 3738098498)
2025-07-10 05:13:53,509 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 05:13:53,510 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 05:13:53,510 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 05:13:53,510 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 05:13:53,514 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 05:13:53,514 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 05:13:53,514 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -106.000000000000000000000000 JPY / 146.4780000000 = -0.7236581602698016084326656563 USD
2025-07-10 05:13:53,547 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=340.06000000, margin=6.55
2025-07-10 05:13:53,547 - INFO - orders - Setting user data cache for user 1 with wallet_balance=340.06000000, margin=6.55
2025-07-10 05:13:53,548 - INFO - orders - User data cache updated for user 1
2025-07-10 05:13:53,549 - INFO - orders - Balance/margin cache updated for user 1: balance=340.06000000, margin=6.55
2025-07-10 05:13:53,549 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 05:13:53,549 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 05:13:53,551 - INFO - orders - Fetched 1 open orders for user 1
2025-07-10 05:13:53,552 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 05:13:53,553 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 1 pending orders
2025-07-10 05:13:53,556 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:53,556 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:13:53,556 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 05:13:53,556 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:53,556 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 6.55
2025-07-10 05:13:53,557 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=340.06000000, margin=6.55
2025-07-10 05:13:53,558 - INFO - orders - Publishing order update for user 1
2025-07-10 05:13:53,558 - INFO - orders - Publishing user data update for user 1
2025-07-10 05:13:53,558 - INFO - orders - Publishing market data trigger
2025-07-10 05:13:54,116 - INFO - orders - Order close request received - Order ID: 4797314275, User ID: 1, Close Price: 95.81400000000001
2025-07-10 05:13:54,117 - INFO - orders - Request to close order 4797314275 for user 1 (user_type: demo) with price 95.81400000000001. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-10 05:13:54,129 - INFO - orders - Demo user 1 from group 'default' ('sending_orders' is NOT 'barclays'). Processing close locally.
2025-07-10 05:13:54,143 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol AUDJPY
2025-07-10 05:13:54,143 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:13:54,144 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('654.569287')], HighestMarginPerLot=654.569287
2025-07-10 05:13:54,144 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=6.55
2025-07-10 05:13:54,144 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 1, Symbol AUDJPY. Returning zero margin.
2025-07-10 05:13:54,154 - INFO - orders - Existing entry commission for order 4797314275: 0.10000000
2025-07-10 05:13:54,154 - INFO - orders - Commission calculation for order 4797314275: entry=0.10000000, exit=0.100000000000, total=0.20
2025-07-10 05:13:54,154 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of -105.9999999999900000000000000 JPY to USD for PnL on Close (user_id: 1, position: 4797314275)
2025-07-10 05:13:54,154 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 05:13:54,155 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 05:13:54,155 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 05:13:54,155 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 05:13:54,156 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 05:13:54,156 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 05:13:54,156 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: -105.9999999999900000000000000 JPY / 146.4780000000 = -0.7236581602697333387949043542 USD
2025-07-10 05:13:54,177 - INFO - orders - AFTER COMMIT: User 1 wallet_balance=339.14000000, margin=0
2025-07-10 05:13:54,177 - INFO - orders - Setting user data cache for user 1 with wallet_balance=339.14000000, margin=0
2025-07-10 05:13:54,177 - INFO - orders - User data cache updated for user 1
2025-07-10 05:13:54,180 - INFO - orders - Balance/margin cache updated for user 1: balance=339.14000000, margin=0
2025-07-10 05:13:54,180 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-10 05:13:54,180 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 05:13:54,182 - INFO - orders - Fetched 0 open orders for user 1
2025-07-10 05:13:54,183 - INFO - orders - Fetched 1 pending orders for user 1
2025-07-10 05:13:54,184 - INFO - orders - Updated static orders cache for user 1 with 0 open orders and 1 pending orders
2025-07-10 05:13:54,189 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=339.14000000, margin=0.0
2025-07-10 05:13:54,189 - INFO - orders - Publishing order update for user 1
2025-07-10 05:13:54,189 - INFO - orders - Publishing user data update for user 1
2025-07-10 05:13:54,190 - INFO - orders - Publishing market data trigger
2025-07-10 05:34:42,175 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 05:34:43,357 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 05:34:43,359 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 05:34:43,359 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 05:34:43,359 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 05:34:47,436 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 05:34:47,436 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 05:34:48,344 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 05:34:53,345 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 05:34:56,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:34:56,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:34:56,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:34:56,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:34:56,287 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:34:56,287 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:35:23,055 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 05:35:23,421 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:35:23,422 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:35:23,422 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:35:23,422 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:35:23,422 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:35:23,422 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:35:23,422 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:35:23,422 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:35:23,423 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:35:23,423 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:35:23,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:35:23,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:35:23,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:35:23,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:35:23,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:35:23,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:35:23,424 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:36:00,911 - INFO - orders - Pending order placement request received - User ID: 4, Symbol: AUDJPY, Type: BUY_LIMIT, Quantity: 1
2025-07-10 05:36:00,928 - INFO - orders - Calculated contract_value for pending order: 100000.00000000 (contract_size: 100000.00000000 * quantity: 1)
2025-07-10 05:36:00,932 - INFO - orders - [DEBUG] User data from cache: {'id': 4, 'email': 'dhanush777ss@gmail.com', 'account_number': 'DYY5A', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('6599.06000000'), 'margin': Decimal('1980.00000000'), 'user_type': 'live', 'first_name': None, 'last_name': None, 'country': 'string', 'phone_number': Decimal('8618025298')}
2025-07-10 05:36:00,933 - INFO - orders - [DEBUG] Group name: Standard
2025-07-10 05:36:00,938 - INFO - orders - User 4 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 05:36:00,957 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDJPY: contract_size=100000.00000000, profit_currency=JPY, digit=3.00000
2025-07-10 05:36:01,268 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9290000000', 'o': '95.9270000000'}
2025-07-10 05:36:01,268 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9290000000, ask=95.93859290000000
2025-07-10 05:36:01,268 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9290000000, ask=95.93859290000000
2025-07-10 05:36:01,269 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 95938.59 JPY to USD for margin_calculation (user_id: 4, position: None)
2025-07-10 05:36:01,269 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 05:36:01,270 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 05:36:01,270 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 05:36:01,270 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 05:36:01,271 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 05:36:01,271 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 05:36:01,271 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 95938.59 JPY / 146.4780000000 = 654.9692786630074140826608774 USD
2025-07-10 05:36:01,271 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY_LIMIT, Qty: 1, Price: 95.93859290000000, Margin: 654.9692786630074140826608774, Commission: 10.00
2025-07-10 05:36:01,272 - INFO - orders - Calculated initial margin: 654.9692786630074140826608774, commission: 10.00 for pending order 4118787581
2025-07-10 05:36:01,280 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '4118787581', 'order_company_name': 'AUDJPY', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('1'), 'order_price': Decimal('91'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '5278202292', 'takeprofit_id': '1901974811', 'order_user_id': 4, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('654.9692786630074140826608774'), 'commission': Decimal('10.00'), 'open_time': None}
2025-07-10 05:36:01,281 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 05:36:01,281 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 4 at price 91
2025-07-10 05:36:01,281 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '4118787581', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDJPY', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('91'), 'order_quantity': Decimal('1'), 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('654.9692786630074140826608774'), 'commission': Decimal('10.00'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '5278202292', 'takeprofit_id': '1901974811', 'close_id': None}
2025-07-10 05:36:01,317 - INFO - orders - Order 4118787581 verified in database on attempt 1 before adding to Redis.
2025-07-10 05:36:01,320 - INFO - orders - Skipping Redis storage for Barclays user pending order 4118787581
2025-07-10 05:36:01,328 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:36:01,329 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:36:01,329 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:36:01,329 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:36:01,329 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:36:01,329 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:36:01,329 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:36:01,329 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:36:01,330 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:36:01,330 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:36:01,330 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:36:01,330 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:36:01,330 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:36:01,330 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:36:01,330 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:36:01,331 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:36:01,331 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:36:01,349 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:36:01,350 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:36:01,350 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:36:01,350 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:36:01,350 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:36:01,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:36:01,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:36:01,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:36:01,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:36:01,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:36:01,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:36:01,351 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:36:01,352 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:36:01,352 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:36:01,352 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:36:01,352 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:36:01,352 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:36:01,360 - INFO - orders - [PERF] TOTAL place_order: 0.4508s
2025-07-10 05:36:01,390 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:36:01,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:36:01,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:36:01,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:36:01,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:36:01,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:36:01,391 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:36:01,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:36:01,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:36:01,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:36:01,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:36:01,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:36:01,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:36:01,392 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:36:01,397 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:36:01,400 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:36:01,400 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:36:01,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:36:01,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:36:01,424 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:36:01,425 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:36:01,426 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:36:01,426 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:36:01,426 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:36:01,426 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:36:01,429 - INFO - orders - Background balance/margin cache updated for user 4: balance=6599.06000000, margin=5774.11
2025-07-10 05:36:01,888 - INFO - orders - [BARCLAYS] barclays_push called for user 4, is_barclays_live_user=True
2025-07-10 05:38:12,474 - INFO - orders - Pending order placement request received - User ID: 4, Symbol: AUDJPY, Type: BUY_LIMIT, Quantity: 1
2025-07-10 05:38:12,484 - INFO - orders - Calculated contract_value for pending order: 100000.00000000 (contract_size: 100000.00000000 * quantity: 1)
2025-07-10 05:38:12,486 - INFO - orders - [DEBUG] User data from cache: {'id': 4, 'email': 'dhanush777ss@gmail.com', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'DYY5A', 'wallet_balance': Decimal('6599.06000000'), 'margin': Decimal('5774.11')}
2025-07-10 05:38:12,486 - INFO - orders - [DEBUG] Group name: Standard
2025-07-10 05:38:12,487 - INFO - orders - User 4 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 05:38:12,490 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDJPY: contract_size=100000.00000000, profit_currency=JPY, digit=3.00000
2025-07-10 05:38:12,839 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.8750000000', 'o': '95.8680000000'}
2025-07-10 05:38:12,839 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.8750000000, ask=95.88458750000000
2025-07-10 05:38:12,839 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.8750000000, ask=95.88458750000000
2025-07-10 05:38:12,840 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 95884.59 JPY to USD for margin_calculation (user_id: 4, position: None)
2025-07-10 05:38:12,840 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 05:38:12,841 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 05:38:12,841 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 05:38:12,841 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 05:38:12,842 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 05:38:12,842 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 05:38:12,842 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 95884.59 JPY / 146.4780000000 = 654.6006226190963830745914062 USD
2025-07-10 05:38:12,842 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY_LIMIT, Qty: 1, Price: 95.88458750000000, Margin: 654.6006226190963830745914062, Commission: 10.00
2025-07-10 05:38:12,842 - INFO - orders - Calculated initial margin: 654.6006226190963830745914062, commission: 10.00 for pending order 1825178363
2025-07-10 05:38:12,846 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '1825178363', 'order_company_name': 'AUDJPY', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('1'), 'order_price': Decimal('91'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '9032819276', 'takeprofit_id': '6299191299', 'order_user_id': 4, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('654.6006226190963830745914062'), 'commission': Decimal('10.00'), 'open_time': None}
2025-07-10 05:38:12,846 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 05:38:12,847 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 4 at price 91
2025-07-10 05:38:12,847 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '1825178363', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDJPY', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('91'), 'order_quantity': Decimal('1'), 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('654.6006226190963830745914062'), 'commission': Decimal('10.00'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '9032819276', 'takeprofit_id': '6299191299', 'close_id': None}
2025-07-10 05:38:12,868 - INFO - orders - Order 1825178363 verified in database on attempt 1 before adding to Redis.
2025-07-10 05:38:12,870 - INFO - orders - Skipping Redis storage for Barclays user pending order 1825178363
2025-07-10 05:38:12,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:38:12,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:38:12,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:38:12,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:38:12,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:38:12,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:38:12,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:38:12,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:38:12,878 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:38:12,879 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:38:12,879 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:38:12,879 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:38:12,879 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:38:12,879 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:38:12,879 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:38:12,879 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:38:12,879 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:38:12,898 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:38:12,898 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:38:12,898 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:38:12,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:38:12,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:38:12,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:38:12,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:38:12,900 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:38:12,907 - INFO - orders - [PERF] TOTAL place_order: 0.4332s
2025-07-10 05:38:12,942 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:38:12,942 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:38:12,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:38:12,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:38:12,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:38:12,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:38:12,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:38:12,954 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:38:12,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:38:12,957 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:38:12,957 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:38:12,957 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:38:12,958 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:38:12,959 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:38:12,964 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:38:12,964 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:38:12,964 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:38:12,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:38:12,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:38:12,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:38:12,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:38:12,984 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:38:12,985 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:38:12,985 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:38:12,985 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:38:12,985 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:38:12,985 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:38:12,985 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:38:12,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:38:12,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:38:12,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:38:12,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:38:12,987 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:38:12,987 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:38:12,989 - INFO - orders - Background balance/margin cache updated for user 4: balance=6599.06000000, margin=5774.11
2025-07-10 05:38:13,467 - INFO - orders - [BARCLAYS] barclays_push called for user 4, is_barclays_live_user=True
2025-07-10 05:40:06,474 - INFO - orders - Service provider update request received: {"order_id":"4118787581","order_status":"PENDING","status":"PENDING","order_price":"91"}
2025-07-10 05:40:06,486 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-10 05:40:06,487 - INFO - orders - Update fields: {'order_id': '4118787581', 'order_status': 'PENDING', 'status': 'PENDING', 'order_price': Decimal('91')}
2025-07-10 05:40:06,487 - INFO - orders - Processing regular update for order 4118787581
2025-07-10 05:40:06,508 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:40:06,513 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:40:06,513 - INFO - orders - Using order model: UserOrder
2025-07-10 05:40:06,518 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:40:06,521 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:40:06,523 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:40:06,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:40:06,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:40:06,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:40:06,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:40:06,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:40:06,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:40:06,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:40:06,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:40:06,529 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:40:06,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:40:06,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:40:06,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:40:06,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:40:06,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:40:06,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:40:06,530 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:40:06,530 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:40:06,533 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:41:38,164 - INFO - orders - Service provider update request received: {"order_id":"4118787581","order_status":"PENDING","status":"PENDING","order_price":"93"}
2025-07-10 05:41:38,187 - INFO - orders - Original order status: PENDING
2025-07-10 05:41:38,187 - INFO - orders - Update fields: {'order_id': '4118787581', 'order_status': 'PENDING', 'status': 'PENDING', 'order_price': Decimal('93')}
2025-07-10 05:41:38,188 - INFO - orders - Processing regular update for order 4118787581
2025-07-10 05:41:38,207 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:41:38,209 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:41:38,209 - INFO - orders - Using order model: UserOrder
2025-07-10 05:41:38,214 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:41:38,218 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:41:38,220 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:41:38,225 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:41:38,226 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:41:38,227 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:41:38,227 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:41:38,227 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:41:38,227 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:41:38,229 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:42:39,332 - INFO - orders - Service provider update request received: {"order_id":"4118787581","order_status":"PENDING","status":"PENDING","order_price":"95"}
2025-07-10 05:42:39,336 - INFO - orders - Original order status: PENDING
2025-07-10 05:42:39,336 - INFO - orders - Update fields: {'order_id': '4118787581', 'order_status': 'PENDING', 'status': 'PENDING', 'order_price': Decimal('95')}
2025-07-10 05:42:39,336 - INFO - orders - Processing regular update for order 4118787581
2025-07-10 05:42:39,350 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:42:39,352 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:42:39,352 - INFO - orders - Using order model: UserOrder
2025-07-10 05:42:39,357 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:42:39,361 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:42:39,362 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:42:39,366 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:42:39,367 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:42:39,367 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:42:39,367 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:42:39,367 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:42:39,367 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:42:39,367 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:42:39,367 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:42:39,367 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:42:39,368 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:42:39,368 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:42:39,368 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:42:39,368 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:42:39,368 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:42:39,368 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:42:39,368 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:42:39,368 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:42:39,371 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:42:49,509 - INFO - orders - Service provider update request received: {"order_id":"4118787581","order_status":"PENDING","status":"PENDING","order_price":"99"}
2025-07-10 05:42:49,515 - INFO - orders - Original order status: PENDING
2025-07-10 05:42:49,515 - INFO - orders - Update fields: {'order_id': '4118787581', 'order_status': 'PENDING', 'status': 'PENDING', 'order_price': Decimal('99')}
2025-07-10 05:42:49,515 - INFO - orders - Processing regular update for order 4118787581
2025-07-10 05:42:49,529 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:42:49,531 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:42:49,531 - INFO - orders - Using order model: UserOrder
2025-07-10 05:42:49,535 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:42:49,539 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:42:49,541 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:42:49,546 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:42:49,547 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:42:49,548 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:42:49,548 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:42:49,548 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:42:49,548 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:42:49,548 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:42:49,548 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:42:49,548 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:42:49,551 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:44:03,399 - INFO - orders - Service provider update request received: {"order_id":"9605988963","order_price":"1.00030"}
2025-07-10 05:44:03,403 - INFO - orders - Original order status: OPEN
2025-07-10 05:44:03,404 - INFO - orders - Update fields: {'order_id': '9605988963', 'order_price': Decimal('1.00030')}
2025-07-10 05:44:03,404 - INFO - orders - Processing regular update for order 9605988963
2025-07-10 05:44:03,452 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:44:03,454 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:44:03,454 - INFO - orders - Using order model: UserOrder
2025-07-10 05:44:03,459 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:44:03,463 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:44:03,465 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:44:03,470 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:44:03,470 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:44:03,471 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:44:03,472 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:44:03,472 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:44:03,472 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:44:03,474 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:44:10,321 - INFO - orders - Service provider update request received: {"order_id":"9605988963","order_price":"1.00130"}
2025-07-10 05:44:10,327 - INFO - orders - Original order status: OPEN
2025-07-10 05:44:10,328 - INFO - orders - Update fields: {'order_id': '9605988963', 'order_price': Decimal('1.00130')}
2025-07-10 05:44:10,328 - INFO - orders - Processing regular update for order 9605988963
2025-07-10 05:44:10,344 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:44:10,347 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:44:10,347 - INFO - orders - Using order model: UserOrder
2025-07-10 05:44:10,351 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:44:10,355 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:44:10,356 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:44:10,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:44:10,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:44:10,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:44:10,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:44:10,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:44:10,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:44:10,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:44:10,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:44:10,364 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:44:10,367 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:44:18,987 - INFO - orders - Service provider update request received: {"order_id":"9605988963","order_price":"1.10130"}
2025-07-10 05:44:18,993 - INFO - orders - Original order status: OPEN
2025-07-10 05:44:18,993 - INFO - orders - Update fields: {'order_id': '9605988963', 'order_price': Decimal('1.10130')}
2025-07-10 05:44:18,993 - INFO - orders - Processing regular update for order 9605988963
2025-07-10 05:44:19,008 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:44:19,010 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:44:19,010 - INFO - orders - Using order model: UserOrder
2025-07-10 05:44:19,014 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:44:19,019 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:44:19,021 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:44:19,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:44:19,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:44:19,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:44:19,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:44:19,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:44:19,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:44:19,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:44:19,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:44:19,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:44:19,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:44:19,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:44:19,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:44:19,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:44:19,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:44:19,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:44:19,029 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:44:19,029 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:44:19,031 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:44:26,958 - INFO - orders - Service provider update request received: {"order_id":"9605988963","order_price":"1.23"}
2025-07-10 05:44:26,965 - INFO - orders - Original order status: OPEN
2025-07-10 05:44:26,966 - INFO - orders - Update fields: {'order_id': '9605988963', 'order_price': Decimal('1.23')}
2025-07-10 05:44:26,966 - INFO - orders - Processing regular update for order 9605988963
2025-07-10 05:44:26,984 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:44:26,986 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:44:26,986 - INFO - orders - Using order model: UserOrder
2025-07-10 05:44:26,991 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:44:26,996 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:44:26,998 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:44:27,004 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:44:27,004 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:44:27,005 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:44:27,006 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:44:27,006 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:44:27,006 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:44:27,006 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:44:27,006 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:44:27,009 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:44:43,109 - INFO - orders - Service provider update request received: {"order_id":"9605988963","order_price":"1.55"}
2025-07-10 05:44:43,115 - INFO - orders - Original order status: OPEN
2025-07-10 05:44:43,115 - INFO - orders - Update fields: {'order_id': '9605988963', 'order_price': Decimal('1.55')}
2025-07-10 05:44:43,115 - INFO - orders - Processing regular update for order 9605988963
2025-07-10 05:44:43,130 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:44:43,132 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:44:43,132 - INFO - orders - Using order model: UserOrder
2025-07-10 05:44:43,137 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:44:43,141 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:44:43,142 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:44:43,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:44:43,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:44:43,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:44:43,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:44:43,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:44:43,147 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:44:43,148 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:44:43,149 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:44:43,149 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:44:43,152 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:47:26,739 - INFO - orders - [get_closed_orders] user_type: live
2025-07-10 05:48:36,863 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 05:48:38,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:48:38,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:48:38,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:48:38,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:48:38,900 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:49:05,021 - INFO - orders - Service provider update request received: {"order_id":"4118787581","order_price":"91"}
2025-07-10 05:49:05,024 - INFO - orders - Original order status: PENDING
2025-07-10 05:49:05,025 - INFO - orders - Update fields: {'order_id': '4118787581', 'order_price': Decimal('91')}
2025-07-10 05:49:05,025 - INFO - orders - Processing regular update for order 4118787581
2025-07-10 05:49:05,039 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:49:05,040 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:49:05,040 - INFO - orders - Using order model: UserOrder
2025-07-10 05:49:05,043 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:49:05,046 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:49:05,047 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:49:05,050 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:49:05,050 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:49:05,050 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:49:05,050 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:49:05,050 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:49:05,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:49:05,051 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:49:05,053 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:54:16,702 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 05:54:17,961 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 05:54:17,965 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 05:54:17,965 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 05:54:17,965 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 05:54:22,044 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 05:54:22,044 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 05:54:22,966 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 05:54:27,968 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 05:54:30,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:54:30,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:54:30,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:54:30,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:54:30,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:54:30,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:54:30,903 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:54:30,904 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:54:30,904 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:54:39,385 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:54:39,385 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:55:46,587 - INFO - orders - Pending order placement request received - User ID: 4, Symbol: AUDCHF, Type: SELL_LIMIT, Quantity: 1
2025-07-10 05:55:46,614 - INFO - orders - Calculated contract_value for pending order: 100000.00000000 (contract_size: 100000.00000000 * quantity: 1)
2025-07-10 05:55:46,616 - INFO - orders - [DEBUG] User data from cache: {'id': 4, 'email': 'dhanush777ss@gmail.com', 'account_number': 'DYY5A', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('6599.06000000'), 'margin': Decimal('1980.00000000'), 'user_type': 'live', 'first_name': None, 'last_name': None, 'country': 'string', 'phone_number': Decimal('8618025298')}
2025-07-10 05:55:46,616 - INFO - orders - [DEBUG] Group name: Standard
2025-07-10 05:55:46,617 - INFO - orders - User 4 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 05:55:46,622 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCHF: contract_size=100000.00000000, profit_currency=CHF, digit=5.00000
2025-07-10 05:55:46,932 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5216600000', 'o': '0.5216100000'}
2025-07-10 05:55:46,932 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5216600000, ask=0.52171216600000
2025-07-10 05:55:46,932 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5216600000, ask=0.52171216600000
2025-07-10 05:55:46,932 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 521.66 CHF to USD for margin_calculation (user_id: 4, position: None)
2025-07-10 05:55:46,932 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-10 05:55:46,933 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 05:55:46,933 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-10 05:55:46,933 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-10 05:55:46,933 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7958300000'), 'o': Decimal('0.7958000000')}
2025-07-10 05:55:46,933 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7958300000
2025-07-10 05:55:46,933 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 521.66 CHF / 0.7958300000 = 655.4917507507884849779475516 USD
2025-07-10 05:55:46,933 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: SELL_LIMIT, Qty: 1, Price: 0.5216600000, Margin: 655.4917507507884849779475516, Commission: 10.00
2025-07-10 05:55:46,933 - INFO - orders - Calculated initial margin: 655.4917507507884849779475516, commission: 10.00 for pending order 5828288717
2025-07-10 05:55:46,940 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '5828288717', 'order_company_name': 'AUDCHF', 'order_type': 'SELL_LIMIT', 'order_quantity': Decimal('1'), 'order_price': Decimal('1'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '4005050672', 'takeprofit_id': '3887059868', 'order_user_id': 4, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('655.4917507507884849779475516'), 'commission': Decimal('10.00'), 'open_time': None}
2025-07-10 05:55:46,940 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 05:55:46,940 - INFO - orders - Placing PENDING order: SELL_LIMIT for user 4 at price 1
2025-07-10 05:55:46,940 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '5828288717', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCHF', 'order_type': 'SELL_LIMIT', 'order_price': Decimal('1'), 'order_quantity': Decimal('1'), 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('655.4917507507884849779475516'), 'commission': Decimal('10.00'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '4005050672', 'takeprofit_id': '3887059868', 'close_id': None}
2025-07-10 05:55:46,975 - INFO - orders - Order 5828288717 verified in database on attempt 1 before adding to Redis.
2025-07-10 05:55:46,976 - INFO - orders - Skipping Redis storage for Barclays user pending order 5828288717
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:55:46,981 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:55:46,981 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:55:46,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:55:46,992 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:55:46,992 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:55:46,992 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:55:46,992 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:55:46,992 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:55:46,992 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:55:46,992 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:55:46,996 - INFO - orders - [PERF] TOTAL place_order: 0.4104s
2025-07-10 05:55:47,008 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:55:47,009 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:55:47,009 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:55:47,023 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:55:47,024 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:55:47,025 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:55:47,025 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:55:47,027 - INFO - orders - Background balance/margin cache updated for user 4: balance=6599.06000000, margin=5774.11
2025-07-10 05:55:47,452 - INFO - orders - [BARCLAYS] barclays_push called for user 4, is_barclays_live_user=True
2025-07-10 05:58:15,946 - INFO - orders - Cancel pending order request received - Order ID: 4118787581, User ID: 4
2025-07-10 05:58:15,982 - INFO - orders - Generated cancel_id: 8023737738 for order 4118787581
2025-07-10 05:58:15,983 - INFO - orders - User 4 is_barclays_live_user: True
2025-07-10 05:58:15,984 - INFO - orders - Barclays user detected. Sending cancel request to Firebase for order 4118787581
2025-07-10 05:58:16,323 - INFO - orders - Cancel request sent to Firebase for order 4118787581
2025-07-10 05:58:42,124 - INFO - orders - Service provider update request received: {"order_id":"4118787581","order_status":"CANCELLED","order_price":"91"}
2025-07-10 05:58:42,129 - INFO - orders - Original order status: PENDING
2025-07-10 05:58:42,129 - INFO - orders - Update fields: {'order_id': '4118787581', 'order_status': 'CANCELLED', 'order_price': Decimal('91')}
2025-07-10 05:58:42,129 - INFO - orders - Processing PENDING -> CANCELLED transition for order 4118787581
2025-07-10 05:58:42,144 - ERROR - orders - Error updating user data cache after pending order cancellation: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3462, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:58:42,146 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:58:42,146 - INFO - orders - Using order model: UserOrder
2025-07-10 05:58:42,150 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:58:42,153 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-10 05:58:42,155 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 0 pending orders
2025-07-10 05:58:42,157 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:58:42,157 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:58:42,157 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:58:42,157 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:58:42,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:58:42,158 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:58:42,160 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 05:58:48,731 - INFO - orders - Pending order placement request received - User ID: 4, Symbol: AUDCHF, Type: SELL_LIMIT, Quantity: 1
2025-07-10 05:58:48,742 - INFO - orders - Calculated contract_value for pending order: 100000.00000000 (contract_size: 100000.00000000 * quantity: 1)
2025-07-10 05:58:48,743 - INFO - orders - [DEBUG] User data from cache: {'id': 4, 'email': 'dhanush777ss@gmail.com', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'DYY5A', 'wallet_balance': Decimal('6599.06000000'), 'margin': Decimal('5774.11')}
2025-07-10 05:58:48,743 - INFO - orders - [DEBUG] Group name: Standard
2025-07-10 05:58:48,744 - INFO - orders - User 4 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 05:58:48,746 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCHF: contract_size=100000.00000000, profit_currency=CHF, digit=5.00000
2025-07-10 05:58:49,092 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5218500000', 'o': '0.5218000000'}
2025-07-10 05:58:49,092 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5218500000, ask=0.52190218500000
2025-07-10 05:58:49,092 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5218500000, ask=0.52190218500000
2025-07-10 05:58:49,092 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 521.85 CHF to USD for margin_calculation (user_id: 4, position: None)
2025-07-10 05:58:49,093 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-10 05:58:49,093 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 05:58:49,094 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-10 05:58:49,094 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-10 05:58:49,094 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7958300000'), 'o': Decimal('0.7958000000')}
2025-07-10 05:58:49,094 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7958300000
2025-07-10 05:58:49,094 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 521.85 CHF / 0.7958300000 = 655.7304952062626440320168880 USD
2025-07-10 05:58:49,095 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: SELL_LIMIT, Qty: 1, Price: 0.5218500000, Margin: 655.7304952062626440320168880, Commission: 10.00
2025-07-10 05:58:49,095 - INFO - orders - Calculated initial margin: 655.7304952062626440320168880, commission: 10.00 for pending order 5045010173
2025-07-10 05:58:49,099 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '5045010173', 'order_company_name': 'AUDCHF', 'order_type': 'SELL_LIMIT', 'order_quantity': Decimal('1'), 'order_price': Decimal('1'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '8922239177', 'takeprofit_id': '4439134422', 'order_user_id': 4, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('655.7304952062626440320168880'), 'commission': Decimal('10.00'), 'open_time': None}
2025-07-10 05:58:49,099 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 05:58:49,099 - INFO - orders - Placing PENDING order: SELL_LIMIT for user 4 at price 1
2025-07-10 05:58:49,099 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '5045010173', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCHF', 'order_type': 'SELL_LIMIT', 'order_price': Decimal('1'), 'order_quantity': Decimal('1'), 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('655.7304952062626440320168880'), 'commission': Decimal('10.00'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '8922239177', 'takeprofit_id': '4439134422', 'close_id': None}
2025-07-10 05:58:49,155 - INFO - orders - Order 5045010173 verified in database on attempt 1 before adding to Redis.
2025-07-10 05:58:49,156 - INFO - orders - Skipping Redis storage for Barclays user pending order 5045010173
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:58:49,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:58:49,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:58:49,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:58:49,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:58:49,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:58:49,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:58:49,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:58:49,162 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:58:49,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:58:49,174 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:58:49,179 - INFO - orders - [PERF] TOTAL place_order: 0.4481s
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:58:49,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:58:49,195 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:58:49,195 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:58:49,195 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:58:49,195 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:58:49,195 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:58:49,195 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:58:49,195 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:58:49,212 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:58:49,212 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:58:49,212 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:58:49,212 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:58:49,213 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:58:49,213 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:58:49,213 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:58:49,214 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:58:49,214 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:58:49,219 - INFO - orders - Background balance/margin cache updated for user 4: balance=6599.06000000, margin=5774.11
2025-07-10 05:58:49,633 - INFO - orders - [BARCLAYS] barclays_push called for user 4, is_barclays_live_user=True
2025-07-10 05:59:23,036 - INFO - orders - Service provider update request received: {"order_id":"5045010173","order_status":"PENDING","status":"PENDING","order_price":"91"}
2025-07-10 05:59:23,044 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-10 05:59:23,045 - INFO - orders - Update fields: {'order_id': '5045010173', 'order_status': 'PENDING', 'status': 'PENDING', 'order_price': Decimal('91')}
2025-07-10 05:59:23,045 - INFO - orders - Processing regular update for order 5045010173
2025-07-10 05:59:23,094 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 05:59:23,097 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 05:59:23,097 - INFO - orders - Using order model: UserOrder
2025-07-10 05:59:23,103 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 05:59:23,108 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 05:59:23,109 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 05:59:23,113 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 05:59:23,114 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 05:59:23,115 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 05:59:23,115 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 05:59:23,115 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 05:59:23,115 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 05:59:23,115 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 05:59:23,115 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 05:59:23,118 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 06:00:25,758 - INFO - orders - Pending order placement request received - User ID: 4, Symbol: AUDCHF, Type: SELL_LIMIT, Quantity: 1
2025-07-10 06:00:25,770 - INFO - orders - Calculated contract_value for pending order: 100000.00000000 (contract_size: 100000.00000000 * quantity: 1)
2025-07-10 06:00:25,772 - INFO - orders - [DEBUG] User data from cache: {'id': 4, 'email': 'dhanush777ss@gmail.com', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'DYY5A', 'wallet_balance': Decimal('6599.06000000'), 'margin': Decimal('5774.11')}
2025-07-10 06:00:25,772 - INFO - orders - [DEBUG] Group name: Standard
2025-07-10 06:00:25,773 - INFO - orders - User 4 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 06:00:25,776 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCHF: contract_size=100000.00000000, profit_currency=CHF, digit=5.00000
2025-07-10 06:00:26,074 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': '0.5218400000', 'o': '0.5217900000'}
2025-07-10 06:00:26,074 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5218400000, ask=0.52189218400000
2025-07-10 06:00:26,075 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5218400000, ask=0.52189218400000
2025-07-10 06:00:26,075 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 521.84 CHF to USD for margin_calculation (user_id: 4, position: None)
2025-07-10 06:00:26,075 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-10 06:00:26,076 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 06:00:26,076 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-10 06:00:26,076 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-10 06:00:26,077 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7958300000'), 'o': Decimal('0.7958000000')}
2025-07-10 06:00:26,077 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7958300000
2025-07-10 06:00:26,077 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 521.84 CHF / 0.7958300000 = 655.7179297086061093449606072 USD
2025-07-10 06:00:26,077 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: SELL_LIMIT, Qty: 1, Price: 0.5218400000, Margin: 655.7179297086061093449606072, Commission: 10.00
2025-07-10 06:00:26,077 - INFO - orders - Calculated initial margin: 655.7179297086061093449606072, commission: 10.00 for pending order 3128757828
2025-07-10 06:00:26,082 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '3128757828', 'order_company_name': 'AUDCHF', 'order_type': 'SELL_LIMIT', 'order_quantity': Decimal('1'), 'order_price': Decimal('1.33'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '9597671103', 'takeprofit_id': '6789656330', 'order_user_id': 4, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('655.7179297086061093449606072'), 'commission': Decimal('10.00'), 'open_time': None}
2025-07-10 06:00:26,082 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 06:00:26,083 - INFO - orders - Placing PENDING order: SELL_LIMIT for user 4 at price 1.33
2025-07-10 06:00:26,083 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '3128757828', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCHF', 'order_type': 'SELL_LIMIT', 'order_price': Decimal('1.33'), 'order_quantity': Decimal('1'), 'contract_value': Decimal('100000.00000000'), 'margin': Decimal('655.7179297086061093449606072'), 'commission': Decimal('10.00'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '9597671103', 'takeprofit_id': '6789656330', 'close_id': None}
2025-07-10 06:00:26,102 - INFO - orders - Order 3128757828 verified in database on attempt 1 before adding to Redis.
2025-07-10 06:00:26,103 - INFO - orders - Skipping Redis storage for Barclays user pending order 3128757828
2025-07-10 06:00:26,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:00:26,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:00:26,111 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:00:26,111 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:00:26,111 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:00:26,111 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:00:26,111 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:00:26,111 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:00:26,111 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:00:26,111 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:00:26,112 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:00:26,112 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:00:26,112 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:00:26,112 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:00:26,112 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:00:26,112 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:00:26,112 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:00:26,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:00:26,128 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:00:26,128 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:00:26,128 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:00:26,128 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:00:26,128 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:00:26,128 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:00:26,128 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:00:26,128 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:00:26,133 - INFO - orders - [PERF] TOTAL place_order: 0.3757s
2025-07-10 06:00:26,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:00:26,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:00:26,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:00:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:00:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:00:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:00:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:00:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:00:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:00:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:00:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:00:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:00:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:00:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:00:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:00:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:00:26,163 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:00:26,182 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:00:26,183 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:00:26,183 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:00:26,183 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:00:26,183 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:00:26,183 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:00:26,184 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:00:26,185 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:00:26,188 - INFO - orders - Background balance/margin cache updated for user 4: balance=6599.06000000, margin=5774.11
2025-07-10 06:00:26,587 - INFO - orders - [BARCLAYS] barclays_push called for user 4, is_barclays_live_user=True
2025-07-10 06:01:50,756 - INFO - orders - Service provider update request received: {"order_id":"3128757828","order_status":"PENDING","status":"PENDING","order_price":"91"}
2025-07-10 06:01:50,792 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-10 06:01:50,792 - INFO - orders - Update fields: {'order_id': '3128757828', 'order_status': 'PENDING', 'status': 'PENDING', 'order_price': Decimal('91')}
2025-07-10 06:01:50,792 - INFO - orders - Processing regular update for order 3128757828
2025-07-10 06:01:50,809 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 06:01:50,811 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 06:01:50,811 - INFO - orders - Using order model: UserOrder
2025-07-10 06:01:50,817 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 06:01:50,821 - INFO - orders - Fetched 2 pending orders for user 4
2025-07-10 06:01:50,823 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 2 pending orders
2025-07-10 06:01:50,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:01:50,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:01:50,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:01:50,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:01:50,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:01:50,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:01:50,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:01:50,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:01:50,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:01:50,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:01:50,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:01:50,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:01:50,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:01:50,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:01:50,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:01:50,830 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:01:50,830 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:01:50,833 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 06:03:57,814 - INFO - orders - Pending order placement request received - User ID: 4, Symbol: AUDJPY, Type: SELL_LIMIT, Quantity: 0.01
2025-07-10 06:03:57,823 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-07-10 06:03:57,825 - INFO - orders - [DEBUG] User data from cache: {'id': 4, 'email': 'dhanush777ss@gmail.com', 'group_name': 'Standard', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'DYY5A', 'wallet_balance': Decimal('6599.06000000'), 'margin': Decimal('5774.11')}
2025-07-10 06:03:57,826 - INFO - orders - [DEBUG] Group name: Standard
2025-07-10 06:03:57,827 - INFO - orders - User 4 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 06:03:57,829 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDJPY: contract_size=100000.00000000, profit_currency=JPY, digit=3.00000
2025-07-10 06:03:58,127 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '95.9190000000', 'o': '95.9190000000'}
2025-07-10 06:03:58,128 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=95.9190000000, ask=95.92859190000000
2025-07-10 06:03:58,128 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=95.9190000000, ask=95.92859190000000
2025-07-10 06:03:58,129 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 959.19 JPY to USD for margin_calculation (user_id: 4, position: None)
2025-07-10 06:03:58,129 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 06:03:58,129 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 06:03:58,129 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 06:03:58,129 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 06:03:58,130 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 06:03:58,130 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 06:03:58,130 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 959.19 JPY / 146.4780000000 = 6.548355384426330233891778970 USD
2025-07-10 06:03:58,130 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL_LIMIT, Qty: 0.01, Price: 95.9190000000, Margin: 6.548355384426330233891778970, Commission: 0.10
2025-07-10 06:03:58,130 - INFO - orders - Calculated initial margin: 6.548355384426330233891778970, commission: 0.10 for pending order 9627043752
2025-07-10 06:03:58,133 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '9627043752', 'order_company_name': 'AUDJPY', 'order_type': 'SELL_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('100'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '7991397792', 'takeprofit_id': '8649725670', 'order_user_id': 4, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.548355384426330233891778970'), 'commission': Decimal('0.10'), 'open_time': None}
2025-07-10 06:03:58,133 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 06:03:58,133 - INFO - orders - Placing PENDING order: SELL_LIMIT for user 4 at price 100
2025-07-10 06:03:58,134 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '9627043752', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDJPY', 'order_type': 'SELL_LIMIT', 'order_price': Decimal('100'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.548355384426330233891778970'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '7991397792', 'takeprofit_id': '8649725670', 'close_id': None}
2025-07-10 06:03:58,153 - INFO - orders - Order 9627043752 verified in database on attempt 1 before adding to Redis.
2025-07-10 06:03:58,154 - INFO - orders - Skipping Redis storage for Barclays user pending order 9627043752
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:03:58,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:03:58,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:03:58,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:03:58,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:03:58,161 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:03:58,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:03:58,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:03:58,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:03:58,174 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:03:58,175 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:03:58,175 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:03:58,180 - INFO - orders - [PERF] TOTAL place_order: 0.3664s
2025-07-10 06:03:58,193 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:03:58,194 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:03:58,194 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:03:58,206 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:03:58,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:03:58,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:03:58,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:03:58,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:03:58,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:03:58,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:03:58,208 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:03:58,208 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:03:58,210 - INFO - orders - Background balance/margin cache updated for user 4: balance=6599.06000000, margin=5774.11
2025-07-10 06:03:58,684 - INFO - orders - [BARCLAYS] barclays_push called for user 4, is_barclays_live_user=True
2025-07-10 06:04:28,714 - INFO - orders - Service provider update request received: {"order_id":"9627043752","order_status":"PENDING","status":"PENDING"}
2025-07-10 06:04:28,720 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-10 06:04:28,720 - INFO - orders - Update fields: {'order_id': '9627043752', 'order_status': 'PENDING', 'status': 'PENDING'}
2025-07-10 06:04:28,720 - INFO - orders - Processing regular update for order 9627043752
2025-07-10 06:04:28,735 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 06:04:28,738 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 06:04:28,738 - INFO - orders - Using order model: UserOrder
2025-07-10 06:04:28,742 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 06:04:28,746 - INFO - orders - Fetched 3 pending orders for user 4
2025-07-10 06:04:28,748 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 3 pending orders
2025-07-10 06:04:28,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:04:28,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:04:28,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:04:28,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:04:28,753 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:04:28,754 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:04:28,755 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:04:28,755 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:04:28,757 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 06:08:45,229 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 06:08:46,388 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 06:08:46,388 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 06:08:46,392 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 06:08:46,410 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 06:08:50,505 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 06:08:50,506 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 06:08:51,400 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 06:08:56,393 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 06:17:39,017 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 06:17:40,352 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 06:17:40,352 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 06:17:40,352 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 06:17:40,353 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 06:17:44,429 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 06:17:44,429 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 06:17:45,312 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 06:17:50,325 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 06:17:51,278 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:17:51,279 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:17:51,279 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:17:51,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:17:51,281 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:17:51,281 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:17:51,281 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:17:51,281 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:17:51,281 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 06:18:33,529 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 06:18:34,331 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 06:18:34,331 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 06:18:34,332 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 06:18:34,332 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 06:18:34,332 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 06:18:34,332 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 06:18:34,333 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 06:18:34,333 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 06:18:34,333 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 06:18:34,334 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 06:18:34,334 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 06:18:34,335 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 06:18:34,335 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 06:18:34,335 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 06:18:34,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 06:18:34,336 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 06:18:34,336 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 20:51:57,893 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 20:51:59,003 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 20:51:59,003 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 20:51:59,003 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 20:51:59,004 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 20:52:03,061 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 20:52:03,062 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 20:52:04,009 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 20:52:09,006 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 20:52:12,049 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 20:52:12,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 20:52:12,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 20:52:12,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 20:52:12,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 20:52:12,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 20:52:12,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 20:52:12,051 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 20:52:12,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 20:52:12,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 20:52:12,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 20:52:12,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 20:52:12,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 20:52:12,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 20:52:12,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 20:52:12,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 20:52:12,052 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 20:52:56,689 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 20:52:56,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 20:52:56,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 20:52:56,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 20:52:56,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 20:52:56,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 20:52:56,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 20:52:56,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 20:52:56,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 20:52:56,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 20:52:56,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 20:52:56,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 20:52:56,691 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 20:52:56,692 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 20:52:56,692 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 20:52:56,692 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 20:52:56,692 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 20:52:56,935 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 20:53:53,912 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 20:53:54,713 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 20:53:54,713 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 20:53:54,713 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 20:53:54,714 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 20:53:58,788 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 20:53:58,788 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 20:53:59,714 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 20:54:04,719 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 20:54:14,341 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 20:54:14,764 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 20:54:14,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 20:54:14,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 20:54:14,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 20:54:14,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 20:54:14,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 20:54:14,765 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 20:54:14,765 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 20:56:14,034 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 20:56:17,026 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 20:56:17,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 20:56:17,027 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 20:56:17,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 20:56:17,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 20:56:17,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 20:56:17,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 20:56:17,028 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 20:56:17,029 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 20:56:17,029 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 20:56:17,029 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 20:56:17,029 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 20:56:17,029 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 20:56:17,030 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 20:56:17,030 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 20:56:17,030 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 20:56:17,030 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:03:05,545 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 21:03:06,437 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 21:03:06,437 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 21:03:06,437 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 21:03:06,437 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 21:03:10,489 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 21:03:10,489 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 21:03:11,446 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 21:03:16,438 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 21:03:19,279 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:03:19,280 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:03:19,281 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:03:19,281 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:03:19,281 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:03:19,282 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:03:19,282 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:03:19,282 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:03:19,282 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:03:19,282 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:03:19,282 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:03:19,282 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:03:19,282 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:03:19,283 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:03:19,283 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:03:19,283 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:03:19,283 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:03:25,876 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:03:25,876 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:03:25,877 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:03:25,877 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:05:48,815 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 21:05:49,850 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 21:05:49,850 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 21:05:49,850 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 21:05:49,851 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 21:05:53,944 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 21:05:53,944 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 21:06:00,458 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 21:06:01,627 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 21:06:01,628 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 21:06:01,639 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 21:06:01,645 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 21:06:05,722 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 21:06:05,723 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 21:06:06,629 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 21:06:11,632 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:06:20,943 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:06:20,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:06:20,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:06:20,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:06:20,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:06:20,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:06:20,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:06:20,944 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:08:02,974 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 21:08:03,908 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 21:08:03,909 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 21:08:03,909 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 21:08:03,909 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 21:08:07,997 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 21:08:07,997 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 21:08:14,116 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 21:08:15,007 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 21:08:15,017 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 21:08:15,017 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 21:08:15,017 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 21:08:19,081 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 21:08:19,082 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 21:08:20,584 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 21:08:25,018 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 21:08:39,682 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:08:39,683 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:08:39,683 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:08:39,683 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:08:39,683 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:08:39,683 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:08:39,683 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:08:39,684 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:08:39,684 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:08:39,684 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:08:39,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:08:39,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:08:39,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:08:39,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:08:39,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:08:39,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:08:39,685 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:10:03,117 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 21:10:04,225 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 21:10:04,225 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 21:10:04,225 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 21:10:04,225 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 21:10:08,288 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 21:10:08,288 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 21:10:09,238 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 21:10:14,239 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 21:10:27,532 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:10:27,533 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:10:27,533 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:11:21,617 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 21:11:21,617 - INFO - orders - Using order model: UserOrder
2025-07-10 21:11:21,625 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 21:11:21,626 - INFO - orders - Fetched 2 pending orders for user 4
2025-07-10 21:11:21,627 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 2 pending orders
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:11:21,629 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:11:21,630 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:11:21,630 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:11:21,631 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 21:12:22,031 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 21:12:22,031 - INFO - orders - Using order model: UserOrder
2025-07-10 21:12:22,034 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 21:12:22,037 - INFO - orders - Fetched 1 pending orders for user 4
2025-07-10 21:12:22,037 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 1 pending orders
2025-07-10 21:12:22,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:12:22,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:12:22,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:12:22,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:12:22,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:12:22,041 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:12:22,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:12:22,042 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:12:22,043 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 21:13:22,445 - INFO - orders - Starting update_user_static_orders for user 4, user_type live
2025-07-10 21:13:22,445 - INFO - orders - Using order model: UserOrder
2025-07-10 21:13:22,448 - INFO - orders - Fetched 18 open orders for user 4
2025-07-10 21:13:22,451 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-10 21:13:22,452 - INFO - orders - Updated static orders cache for user 4 with 18 open orders and 0 pending orders
2025-07-10 21:13:22,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:13:22,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:13:22,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:13:22,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:13:22,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:13:22,455 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:13:22,456 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:13:22,456 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:13:22,457 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=6599.06000000, margin=5774.11
2025-07-10 21:13:48,398 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 21:13:49,390 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 21:13:49,390 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 21:13:49,390 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 21:13:49,390 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 21:13:53,441 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 21:13:53,441 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 21:13:54,396 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 21:13:59,405 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 21:14:10,954 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:14:10,954 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:14:10,955 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:14:10,955 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:22:46,194 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 21:22:47,369 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 21:22:47,370 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 21:22:47,370 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 21:22:47,370 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 21:22:51,477 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 21:22:51,478 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 21:22:52,380 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 21:22:57,372 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:23:00,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:23:00,358 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:23:07,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:23:07,158 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:23:07,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:23:07,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:23:07,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:23:07,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:23:07,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:23:07,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:23:07,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:23:07,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:23:07,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:23:07,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:23:07,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:23:07,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:23:07,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:23:07,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:23:07,161 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:23:33,591 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 21:28:25,141 - INFO - orders - Order placement request received - User: 9, Symbol: AUDJPY, Type: BUY
2025-07-10 21:28:25,601 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.7590000000', 'o': '96.7510000000'}
2025-07-10 21:28:25,601 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.7590000000, ask=96.76867590000000
2025-07-10 21:28:25,601 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.7590000000, ask=96.76867590000000
2025-07-10 21:28:25,602 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 967.69 JPY to USD for margin_calculation (user_id: 9, position: None)
2025-07-10 21:28:25,602 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 21:28:25,602 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 21:28:25,603 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 21:28:25,603 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 21:28:25,603 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 21:28:25,603 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 21:28:25,604 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 967.69 JPY / 146.4780000000 = 6.606384576523436966643454990 USD
2025-07-10 21:28:25,604 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 96.76867590000000, Margin: 6.606384576523436966643454990, Commission: 0.10
2025-07-10 21:28:25,604 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 9, Symbol: AUDJPY, OrderType: BUY, Quantity: 0.01, FullMargin: 6.606384576523436966643454990
2025-07-10 21:28:25,604 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 21:28:25,604 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=6.606384576523436966643454990
2025-07-10 21:28:25,604 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 21:28:25,604 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 21:28:25,604 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 9, Symbol AUDJPY. Returning zero margin.
2025-07-10 21:28:25,604 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:28:25,604 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-10 21:28:25,605 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.6384576523436966643454990')], HighestMarginPerLot=660.6384576523436966643454990
2025-07-10 21:28:25,605 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:28:25,605 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 21:28:25,605 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 9, Symbol: AUDJPY, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 6.61, AdditionalMargin: 6.61, OpenOrders: 0
2025-07-10 21:28:25,605 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=6.606384576523436966643454990
2025-07-10 21:28:25,605 - INFO - orders - [PERF] Order processing: 0.4616s
2025-07-10 21:28:25,633 - INFO - orders - [PERF] Order creation: 0.0271s
2025-07-10 21:28:25,633 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-10 21:28:25,633 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-10 21:28:25,633 - INFO - orders - [PERF] TOTAL place_order: 0.4998s
2025-07-10 21:28:25,661 - INFO - orders - Background balance/margin cache updated for user 9: balance=8445.00000000, margin=0.0
2025-07-10 21:28:25,677 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-10 21:28:26,091 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 9
2025-07-10 21:30:22,559 - INFO - orders - Order 4497093422 transitioning to OPEN. Calculating margin.
2025-07-10 21:30:22,559 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-10 21:30:22,560 - INFO - orders - Using group_name: Group B for order 4497093422
2025-07-10 21:30:22,903 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDJPY: contract_size=100000.00000000, profit_currency=JPY, digit=3.00000
2025-07-10 21:30:22,904 - INFO - orders - Using user's leverage from cache: 100.00
2025-07-10 21:30:22,904 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.7720000000', 'o': '96.7650000000'}
2025-07-10 21:30:22,904 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.7720000000, ask=96.78167720000000
2025-07-10 21:30:22,905 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.7720000000, ask=96.78167720000000
2025-07-10 21:30:22,906 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 967.82 JPY to USD for margin_calculation (user_id: 9, position: None)
2025-07-10 21:30:22,906 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 21:30:22,907 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 21:30:22,907 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 21:30:22,907 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 21:30:22,908 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 21:30:22,908 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 21:30:22,909 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 967.82 JPY / 146.4780000000 = 6.607272081814333893144362976 USD
2025-07-10 21:30:22,909 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01000000, Price: 96.78167720000000, Margin: 6.607272081814333893144362976, Commission: 0.10
2025-07-10 21:30:22,909 - INFO - orders - New margin calculated: 6.607272081814333893144362976, contract_value: 1000.00
2025-07-10 21:30:22,909 - INFO - orders - [MARGIN] Final stored margin (USD): 6.607272081814333893144362976
2025-07-10 21:30:22,909 - INFO - orders - Recalculating total hedged margin for user 9 on symbol AUDJPY
2025-07-10 21:30:22,913 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-10 21:30:22,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 9, Symbol AUDJPY. Returning zero margin.
2025-07-10 21:30:22,914 - INFO - orders - Old total margin for AUDJPY: 0.0
2025-07-10 21:30:22,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:30:22,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:30:22,914 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.7272081814333893144362976')], HighestMarginPerLot=660.7272081814333893144362976
2025-07-10 21:30:22,915 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:30:22,915 - INFO - orders - New total margin for AUDJPY: 6.61
2025-07-10 21:30:22,915 - INFO - orders - Margin change for user 9: 6.61
2025-07-10 21:30:22,922 - INFO - orders - User 9 margin updated from 0 to 6.61
2025-07-10 21:30:22,955 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 21:30:22,955 - INFO - orders - Using order model: UserOrder
2025-07-10 21:30:22,957 - INFO - orders - Fetched 1 open orders for user 9
2025-07-10 21:30:22,961 - INFO - orders - Fetched 0 pending orders for user 9
2025-07-10 21:30:22,963 - INFO - orders - Updated static orders cache for user 9 with 1 open orders and 0 pending orders
2025-07-10 21:30:22,967 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:30:22,967 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:30:22,967 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:30:22,968 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:30:22,968 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 6.61
2025-07-10 21:30:22,970 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=6.61
2025-07-10 21:31:00,584 - INFO - orders - Order placement request received - User: 9, Symbol: BTCUSD, Type: BUY
2025-07-10 21:31:00,903 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116498.8000000000', 'o': '116498.7000000000'}
2025-07-10 21:31:00,903 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116498.8000000000, ask=116510.44988000000000
2025-07-10 21:31:00,904 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116498.8000000000, ask=116510.44988000000000
2025-07-10 21:31:00,904 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.13, Price: 116510.44988000000000, Margin: 7573.18, Commission: 30.29
2025-07-10 21:31:00,904 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 9, Symbol: BTCUSD, OrderType: BUY, Quantity: 0.13, FullMargin: 7573.18
2025-07-10 21:31:00,904 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-10 21:31:00,904 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.13, Margin=7573.18
2025-07-10 21:31:00,904 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-10 21:31:00,905 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 21:31:00,907 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 9, Symbol BTCUSD. Returning zero margin.
2025-07-10 21:31:00,907 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:31:00,907 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13, TotalSellQty=0, NetQty=0.13, IsHedged=False
2025-07-10 21:31:00,907 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58255.23076923076923076923077')], HighestMarginPerLot=58255.23076923076923076923077
2025-07-10 21:31:00,908 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.18
2025-07-10 21:31:00,915 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 21:31:00,915 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 9, Symbol: BTCUSD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 7573.18, AdditionalMargin: 7573.18, OpenOrders: 0
2025-07-10 21:31:00,916 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.13, Margin=7573.18
2025-07-10 21:31:00,916 - INFO - orders - [PERF] Order processing: 0.3314s
2025-07-10 21:31:00,962 - INFO - orders - [PERF] Order creation: 0.0455s
2025-07-10 21:31:00,962 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-10 21:31:00,962 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-10 21:31:00,962 - INFO - orders - [PERF] TOTAL place_order: 0.3784s
2025-07-10 21:31:00,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:31:00,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:31:00,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:31:00,977 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:31:00,977 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 6.61
2025-07-10 21:31:00,995 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:31:00,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:31:00,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:31:00,996 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:31:00,996 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 6.61
2025-07-10 21:31:00,999 - INFO - orders - Background balance/margin cache updated for user 9: balance=8445.00000000, margin=6.61
2025-07-10 21:31:01,443 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-10 21:31:01,755 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 9
2025-07-10 21:31:47,819 - INFO - orders - Order 9190132347 transitioning to OPEN. Calculating margin.
2025-07-10 21:31:47,819 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-10 21:31:47,820 - INFO - orders - Using group_name: Group B for order 9190132347
2025-07-10 21:31:48,146 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-10 21:31:48,147 - INFO - orders - Using user's leverage from cache: 100.00
2025-07-10 21:31:48,147 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '116501.4000000000', 'o': '116501.3000000000'}
2025-07-10 21:31:48,148 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=116501.4000000000, ask=116513.05014000000000
2025-07-10 21:31:48,148 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=116501.4000000000, ask=116513.05014000000000
2025-07-10 21:31:48,148 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY, Qty: 0.13000000, Price: 116513.05014000000000, Margin: 7573.35, Commission: 30.29
2025-07-10 21:31:48,148 - INFO - orders - New margin calculated: 7573.35, contract_value: 0.13
2025-07-10 21:31:48,149 - INFO - orders - [MARGIN] Final stored margin (USD): 7573.35
2025-07-10 21:31:48,149 - INFO - orders - Recalculating total hedged margin for user 9 on symbol BTCUSD
2025-07-10 21:31:48,153 - INFO - orders - Found 0 existing open positions for this symbol
2025-07-10 21:31:48,153 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 9, Symbol BTCUSD. Returning zero margin.
2025-07-10 21:31:48,153 - INFO - orders - Old total margin for BTCUSD: 0.0
2025-07-10 21:31:48,154 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:31:48,154 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:31:48,154 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:31:48,154 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:31:48,154 - INFO - orders - New total margin for BTCUSD: 7573.35
2025-07-10 21:31:48,154 - INFO - orders - Margin change for user 9: 7573.35
2025-07-10 21:31:48,159 - INFO - orders - User 9 margin updated from 6.61000000 to 7579.96000000
2025-07-10 21:31:48,191 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 21:31:48,191 - INFO - orders - Using order model: UserOrder
2025-07-10 21:31:48,195 - INFO - orders - Fetched 2 open orders for user 9
2025-07-10 21:31:48,199 - INFO - orders - Fetched 0 pending orders for user 9
2025-07-10 21:31:48,200 - INFO - orders - Updated static orders cache for user 9 with 2 open orders and 0 pending orders
2025-07-10 21:31:48,205 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:31:48,206 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:31:48,206 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:31:48,206 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:31:48,206 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:31:48,206 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:31:48,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:31:48,207 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:31:48,207 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 21:31:48,210 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=7579.96
2025-07-10 21:32:55,615 - INFO - orders - Pending order placement request received - User ID: 9, Symbol: AUDCAD, Type: BUY_LIMIT, Quantity: 3
2025-07-10 21:32:55,626 - INFO - orders - Calculated contract_value for pending order: 300000.00000000 (contract_size: 100000.00000000 * quantity: 3)
2025-07-10 21:32:55,627 - INFO - orders - [DEBUG] User data from cache: {'id': 9, 'email': 'cursordemo3@gmail.com', 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'VTHTN', 'wallet_balance': Decimal('8445.00000000'), 'margin': Decimal('7579.96000000'), 'first_name': None, 'last_name': None}
2025-07-10 21:32:55,627 - INFO - orders - [DEBUG] Group name: Group B
2025-07-10 21:32:55,629 - INFO - orders - User 9 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 21:32:55,633 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDCAD: contract_size=100000.00000000, profit_currency=CAD, digit=5.00000
2025-07-10 21:32:56,030 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.9007000000', 'o': '0.9006400000'}
2025-07-10 21:32:56,030 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.9007000000, ask=0.90079007000000
2025-07-10 21:32:56,030 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.9007000000, ask=0.90079007000000
2025-07-10 21:32:56,030 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 2702.37 CAD to USD for margin_calculation (user_id: 9, position: None)
2025-07-10 21:32:56,030 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-10 21:32:56,031 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 21:32:56,031 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-10 21:32:56,031 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-10 21:32:56,031 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3689400000'), 'o': Decimal('1.3689200000')}
2025-07-10 21:32:56,031 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3689400000
2025-07-10 21:32:56,031 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 2702.37 CAD / 1.3689400000 = 1974.060221777433634783116864 USD
2025-07-10 21:32:56,032 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: BUY_LIMIT, Qty: 3, Price: 0.90079007000000, Margin: 1974.060221777433634783116864, Commission: 30.00
2025-07-10 21:32:56,032 - INFO - orders - Calculated initial margin: 1974.060221777433634783116864, commission: 30.00 for pending order 3333380822
2025-07-10 21:32:56,037 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '3333380822', 'order_company_name': 'AUDCAD', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('3'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '5534900574', 'takeprofit_id': '1634094870', 'order_user_id': 9, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('300000.00000000'), 'margin': Decimal('1974.060221777433634783116864'), 'commission': Decimal('30.00'), 'open_time': None}
2025-07-10 21:32:56,037 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 21:32:56,037 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 9 at price 0.89
2025-07-10 21:32:56,037 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '3333380822', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 9, 'order_company_name': 'AUDCAD', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('0.89'), 'order_quantity': Decimal('3'), 'contract_value': Decimal('300000.00000000'), 'margin': Decimal('1974.060221777433634783116864'), 'commission': Decimal('30.00'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '5534900574', 'takeprofit_id': '1634094870', 'close_id': None}
2025-07-10 21:32:56,081 - INFO - orders - Order 3333380822 verified in database on attempt 1 before adding to Redis.
2025-07-10 21:32:56,082 - INFO - orders - Skipping Redis storage for Barclays user pending order 3333380822
2025-07-10 21:32:56,086 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:32:56,086 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:32:56,086 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:32:56,086 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:32:56,086 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:32:56,086 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:32:56,086 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:32:56,086 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:32:56,086 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 21:32:56,094 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:32:56,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:32:56,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:32:56,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:32:56,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:32:56,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:32:56,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:32:56,095 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:32:56,095 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 21:32:56,099 - INFO - orders - [PERF] TOTAL place_order: 0.4841s
2025-07-10 21:32:56,109 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:32:56,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:32:56,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:32:56,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:32:56,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:32:56,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:32:56,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:32:56,110 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:32:56,111 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 21:32:56,126 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:32:56,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:32:56,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:32:56,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:32:56,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:32:56,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:32:56,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:32:56,127 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:32:56,127 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 21:32:56,131 - INFO - orders - Background balance/margin cache updated for user 9: balance=8445.00000000, margin=7579.96
2025-07-10 21:32:56,547 - INFO - orders - [BARCLAYS] barclays_push called for user 9, is_barclays_live_user=True
2025-07-10 21:33:06,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 21:33:06,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 21:33:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 21:33:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 21:33:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 21:33:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 21:33:06,941 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 21:33:06,941 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 21:35:00,922 - INFO - orders - Service provider update request received: {"order_id":"3333380822","order_status":"PENDING","status":"PENDING"}
2025-07-10 21:35:00,926 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-10 21:35:00,926 - INFO - orders - Update fields: {'order_id': '3333380822', 'order_status': 'PENDING', 'status': 'PENDING'}
2025-07-10 21:35:00,926 - INFO - orders - Processing regular update for order 3333380822
2025-07-10 21:35:00,947 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 21:35:00,953 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 21:35:00,953 - INFO - orders - Using order model: UserOrder
2025-07-10 21:35:00,957 - INFO - orders - Fetched 2 open orders for user 9
2025-07-10 21:35:00,960 - INFO - orders - Fetched 1 pending orders for user 9
2025-07-10 21:35:00,962 - INFO - orders - Updated static orders cache for user 9 with 2 open orders and 1 pending orders
2025-07-10 21:35:00,965 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:35:00,966 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:35:00,966 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:35:00,966 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:35:00,966 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:35:00,966 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:35:00,966 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:35:00,966 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:35:00,966 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 21:35:00,969 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=7579.96
2025-07-10 21:35:03,316 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 21:35:03,328 - INFO - orders - Using order model: UserOrder
2025-07-10 21:35:03,356 - INFO - orders - Fetched 2 open orders for user 9
2025-07-10 21:35:03,381 - INFO - orders - Fetched 0 pending orders for user 9
2025-07-10 21:35:03,392 - INFO - orders - Updated static orders cache for user 9 with 2 open orders and 0 pending orders
2025-07-10 21:35:03,407 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:35:03,407 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:35:03,407 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:35:03,408 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:35:03,408 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:35:03,408 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:35:03,408 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:35:03,408 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:35:03,408 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 21:35:03,416 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=7579.96
2025-07-10 21:35:03,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 21:35:03,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 21:35:03,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 21:35:03,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 21:35:03,428 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 21:35:03,429 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 21:35:03,429 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 21:35:03,429 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 21:35:03,429 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 21:35:06,436 - INFO - orders - [get_closed_orders] user_type: live
2025-07-10 22:58:27,918 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 22:58:29,314 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 22:58:29,315 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 22:58:29,315 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 22:58:29,316 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 22:58:33,412 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 22:58:33,412 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 22:58:34,277 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 22:58:39,285 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 22:58:42,323 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 22:58:42,324 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 22:58:42,325 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 22:58:42,325 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 22:58:42,325 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 22:58:42,325 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 22:58:44,441 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 22:58:44,441 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 22:58:44,441 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 22:58:44,441 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 22:58:44,441 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 22:58:44,441 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 22:58:44,441 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 22:58:44,441 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 22:58:44,441 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:02:21,781 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:02:30,856 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:03:46,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 23:03:46,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 23:03:46,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 23:03:46,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 23:03:46,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 23:03:46,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:03:46,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 23:03:46,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 23:03:46,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 23:03:46,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 23:03:46,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 23:03:46,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 23:03:46,727 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 23:03:46,728 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 23:03:46,728 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 23:03:46,728 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 23:03:46,728 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 23:03:46,745 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 23:03:46,745 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:03:46,745 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 23:03:46,745 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:03:46,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:03:46,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:03:46,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:03:46,746 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:03:46,746 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:05:17,089 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:05:17,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 23:05:17,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:05:17,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 23:05:17,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:05:17,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:05:17,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:05:17,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:05:17,865 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:05:17,866 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:06:24,203 - INFO - orders - Order placement request received - User: 9, Symbol: AUDJPY, Type: SELL
2025-07-10 23:06:24,605 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.6250000000', 'o': '96.6180000000'}
2025-07-10 23:06:24,605 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.6250000000, ask=96.63466250000000
2025-07-10 23:06:24,606 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.6250000000, ask=96.63466250000000
2025-07-10 23:06:24,607 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 966.25 JPY to USD for margin_calculation (user_id: 9, position: None)
2025-07-10 23:06:24,607 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 23:06:24,608 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 23:06:24,608 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 23:06:24,608 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 23:06:24,609 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 23:06:24,609 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 23:06:24,609 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 966.25 JPY / 146.4780000000 = 6.596553748685809473094935758 USD
2025-07-10 23:06:24,609 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 96.6250000000, Margin: 6.596553748685809473094935758, Commission: 0.10
2025-07-10 23:06:24,610 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 9, Symbol: AUDJPY, OrderType: SELL, Quantity: 0.01, FullMargin: 6.596553748685809473094935758
2025-07-10 23:06:24,610 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 1
2025-07-10 23:06:24,610 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=SELL, Qty=0.01, Margin=6.596553748685809473094935758
2025-07-10 23:06:24,610 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 1 existing orders + 1 new order
2025-07-10 23:06:24,610 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-10 23:06:24,610 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 23:06:24,610 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:06:24,611 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 23:06:24,611 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:06:24,611 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:06:24,611 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01, NetQty=0.01000000, IsHedged=True
2025-07-10 23:06:24,612 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.6553748685809473094935758')], HighestMarginPerLot=660.727208
2025-07-10 23:06:24,612 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:06:24,612 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-10 23:06:24,612 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 9, Symbol: AUDJPY, OrderType: SELL, MarginBefore: 6.61, MarginAfter: 6.61, AdditionalMargin: 0.0, OpenOrders: 1
2025-07-10 23:06:24,612 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=SELL, Qty=0.01, Margin=6.596553748685809473094935758
2025-07-10 23:06:24,613 - INFO - orders - [PERF] Order processing: 0.4073s
2025-07-10 23:06:24,701 - INFO - orders - [PERF] Order creation: 0.0880s
2025-07-10 23:06:24,701 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-10 23:06:24,701 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-10 23:06:24,702 - INFO - orders - [PERF] TOTAL place_order: 0.5041s
2025-07-10 23:06:24,714 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 23:06:24,714 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:06:24,715 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 23:06:24,715 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:06:24,715 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:06:24,715 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:06:24,715 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:06:24,716 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:06:24,716 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:06:24,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 23:06:24,740 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:06:24,740 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 23:06:24,741 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:06:24,741 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:06:24,741 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:06:24,741 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:06:24,742 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:06:24,742 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:06:24,746 - INFO - orders - Background balance/margin cache updated for user 9: balance=8445.00000000, margin=7579.96
2025-07-10 23:06:25,113 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-10 23:06:25,511 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 9
2025-07-10 23:08:21,711 - INFO - orders - Order 1609256580 transitioning to OPEN. Calculating margin.
2025-07-10 23:08:21,711 - INFO - orders - Using fixed UserOrder model for Barclays service provider integration
2025-07-10 23:08:21,711 - INFO - orders - Using group_name: Group B for order 1609256580
2025-07-10 23:08:22,040 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDJPY: contract_size=100000.00000000, profit_currency=JPY, digit=3.00000
2025-07-10 23:08:22,040 - INFO - orders - Using user's leverage from cache: 100.00
2025-07-10 23:08:22,041 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.6190000000', 'o': '96.6140000000'}
2025-07-10 23:08:22,041 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.6190000000, ask=96.62866190000000
2025-07-10 23:08:22,041 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.6190000000, ask=96.62866190000000
2025-07-10 23:08:22,041 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 966.19 JPY to USD for margin_calculation (user_id: 9, position: None)
2025-07-10 23:08:22,041 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 23:08:22,041 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 23:08:22,042 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 23:08:22,042 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 23:08:22,042 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 23:08:22,042 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 23:08:22,042 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 966.19 JPY / 146.4780000000 = 6.596144130859241660863747457 USD
2025-07-10 23:08:22,042 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01000000, Price: 96.6190000000, Margin: 6.596144130859241660863747457, Commission: 0.10
2025-07-10 23:08:22,042 - INFO - orders - New margin calculated: 6.596144130859241660863747457, contract_value: 1000.00
2025-07-10 23:08:22,042 - INFO - orders - [MARGIN] Final stored margin (USD): 6.596144130859241660863747457
2025-07-10 23:08:22,042 - INFO - orders - Recalculating total hedged margin for user 9 on symbol AUDJPY
2025-07-10 23:08:22,045 - INFO - orders - Found 1 existing open positions for this symbol
2025-07-10 23:08:22,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol AUDJPY
2025-07-10 23:08:22,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:08:22,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208')], HighestMarginPerLot=660.727208
2025-07-10 23:08:22,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:08:22,045 - INFO - orders - Old total margin for AUDJPY: 6.61
2025-07-10 23:08:22,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:08:22,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:08:22,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.6144130859241660863747457')], HighestMarginPerLot=660.727208
2025-07-10 23:08:22,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:08:22,045 - INFO - orders - New total margin for AUDJPY: 6.61
2025-07-10 23:08:22,045 - INFO - orders - Margin change for user 9: 0.00
2025-07-10 23:08:22,048 - INFO - orders - User 9 margin updated from 7579.96000000 to 7579.96000000
2025-07-10 23:08:22,072 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 23:08:22,072 - INFO - orders - Using order model: UserOrder
2025-07-10 23:08:22,073 - INFO - orders - Fetched 3 open orders for user 9
2025-07-10 23:08:22,075 - INFO - orders - Fetched 0 pending orders for user 9
2025-07-10 23:08:22,075 - INFO - orders - Updated static orders cache for user 9 with 3 open orders and 0 pending orders
2025-07-10 23:08:22,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:08:22,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:08:22,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:08:22,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:08:22,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:08:22,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:08:22,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:08:22,077 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:08:22,077 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:08:22,078 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=7579.96
2025-07-10 23:08:46,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 23:08:46,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 23:08:46,828 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 23:08:46,829 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 23:08:46,829 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 23:13:23,794 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:13:23,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:13:23,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:13:23,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:13:23,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:13:23,795 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:13:23,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:13:23,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:13:23,796 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:13:46,947 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 23:13:46,948 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 23:13:46,948 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 23:13:46,948 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 23:13:46,948 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 23:13:46,948 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:13:46,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 23:13:46,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 23:13:46,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 23:13:46,949 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 23:13:46,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 23:13:46,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 23:13:46,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 23:13:46,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 23:13:46,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 23:13:46,950 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 23:13:46,950 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 23:15:13,245 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:15:34,392 - INFO - orders - [get_closed_orders] user_type: live
2025-07-10 23:15:36,020 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:18:25,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:18:25,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:18:25,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:18:25,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:18:25,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:18:25,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:18:25,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:18:25,488 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:18:25,489 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 23:18:47,042 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 23:18:47,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 23:18:47,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 23:18:47,043 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 23:18:47,043 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 23:21:58,017 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:21:58,683 - INFO - orders - [get_closed_orders] user_type: live
2025-07-10 23:22:01,835 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:22:07,319 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:22:07,544 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:22:59,837 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-10 23:23:00,953 - INFO - orders - [get_closed_orders] user_type: live
2025-07-10 23:23:13,108 - INFO - orders - [get_closed_orders] user_type: live
2025-07-10 23:23:25,847 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:23:25,847 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:23:25,847 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:23:25,847 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:23:25,847 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:23:25,848 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:23:25,848 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:23:25,848 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:23:25,848 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:23:36,633 - INFO - orders - Pending order placement request received - User ID: 9, Symbol: AUDJPY, Type: BUY_LIMIT, Quantity: 0.01
2025-07-10 23:23:36,666 - INFO - orders - Calculated contract_value for pending order: 1000.0000000000 (contract_size: 100000.00000000 * quantity: 0.01)
2025-07-10 23:23:36,670 - INFO - orders - [DEBUG] User data from cache: {'id': 9, 'email': 'cursordemo3@gmail.com', 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'VTHTN', 'wallet_balance': Decimal('8445.00000000'), 'margin': Decimal('7579.96000000'), 'first_name': None, 'last_name': None}
2025-07-10 23:23:36,670 - INFO - orders - [DEBUG] Group name: Group B
2025-07-10 23:23:36,674 - INFO - orders - User 9 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 23:23:36,691 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for AUDJPY: contract_size=100000.00000000, profit_currency=JPY, digit=3.00000
2025-07-10 23:23:37,045 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': '96.7010000000', 'o': '96.6960000000'}
2025-07-10 23:23:37,046 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=96.7010000000, ask=96.71067010000000
2025-07-10 23:23:37,046 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=96.7010000000, ask=96.71067010000000
2025-07-10 23:23:37,047 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 967.11 JPY to USD for margin_calculation (user_id: 9, position: None)
2025-07-10 23:23:37,047 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-10 23:23:37,048 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-10 23:23:37,048 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-10 23:23:37,049 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-10 23:23:37,049 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('146.4780000000'), 'o': Decimal('146.4770000000')}
2025-07-10 23:23:37,050 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 146.4780000000
2025-07-10 23:23:37,050 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 967.11 JPY / 146.4780000000 = 6.602424937533281448408634744 USD
2025-07-10 23:23:37,050 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY_LIMIT, Qty: 0.01, Price: 96.71067010000000, Margin: 6.602424937533281448408634744, Commission: 0.10
2025-07-10 23:23:37,050 - INFO - orders - Calculated initial margin: 6.602424937533281448408634744, commission: 0.10 for pending order 2722667079
2025-07-10 23:23:37,064 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '2722667079', 'order_company_name': 'AUDJPY', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('91'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '4033800526', 'takeprofit_id': '4999347716', 'order_user_id': 9, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.602424937533281448408634744'), 'commission': Decimal('0.10'), 'open_time': None}
2025-07-10 23:23:37,064 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 23:23:37,064 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 9 at price 91
2025-07-10 23:23:37,066 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '2722667079', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 9, 'order_company_name': 'AUDJPY', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('91'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.0000000000'), 'margin': Decimal('6.602424937533281448408634744'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '4033800526', 'takeprofit_id': '4999347716', 'close_id': None}
2025-07-10 23:23:37,098 - INFO - orders - Order 2722667079 verified in database on attempt 1 before adding to Redis.
2025-07-10 23:23:37,101 - INFO - orders - Skipping Redis storage for Barclays user pending order 2722667079
2025-07-10 23:23:37,107 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:23:37,107 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:23:37,107 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:23:37,107 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:23:37,107 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:23:37,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:23:37,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:23:37,108 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:23:37,108 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:23:37,124 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:23:37,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:23:37,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:23:37,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:23:37,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:23:37,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:23:37,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:23:37,125 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:23:37,126 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:23:37,135 - INFO - orders - [PERF] TOTAL place_order: 0.5037s
2025-07-10 23:23:37,151 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:23:37,152 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:23:37,152 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:23:37,152 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:23:37,152 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:23:37,152 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:23:37,152 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:23:37,152 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:23:37,153 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:23:37,167 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:23:37,167 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:23:37,168 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:23:37,168 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:23:37,168 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:23:37,168 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:23:37,168 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:23:37,169 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:23:37,169 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:23:37,173 - INFO - orders - Background balance/margin cache updated for user 9: balance=8445.00000000, margin=7579.96
2025-07-10 23:23:37,589 - INFO - orders - [BARCLAYS] barclays_push called for user 9, is_barclays_live_user=True
2025-07-10 23:23:47,096 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 23:23:47,097 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 23:23:47,097 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 23:23:47,097 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 23:23:47,097 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 23:23:47,098 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:23:47,098 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 23:23:47,098 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 23:23:47,098 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 23:23:47,098 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 23:23:47,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 23:23:47,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 23:23:47,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 23:23:47,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 23:23:47,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 23:23:47,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 23:23:47,099 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 23:26:18,392 - INFO - orders - Service provider update request received: {"order_id":"2722667079","order_status":"PENDING","status":"PENDING"}
2025-07-10 23:26:18,399 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-10 23:26:18,399 - INFO - orders - Update fields: {'order_id': '2722667079', 'order_status': 'PENDING', 'status': 'PENDING'}
2025-07-10 23:26:18,400 - INFO - orders - Processing regular update for order 2722667079
2025-07-10 23:26:18,423 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 23:26:18,432 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 23:26:18,432 - INFO - orders - Using order model: UserOrder
2025-07-10 23:26:18,437 - INFO - orders - Fetched 3 open orders for user 9
2025-07-10 23:26:18,441 - INFO - orders - Fetched 1 pending orders for user 9
2025-07-10 23:26:18,443 - INFO - orders - Updated static orders cache for user 9 with 3 open orders and 1 pending orders
2025-07-10 23:26:18,446 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:26:18,447 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:26:18,447 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:26:18,447 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:26:18,447 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:26:18,447 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:26:18,447 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:26:18,448 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:26:18,448 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:26:18,451 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=7579.96
2025-07-10 23:28:34,865 - INFO - orders - Pending order placement request received - User ID: 9, Symbol: BTCUSD, Type: BUY_LIMIT, Quantity: 1
2025-07-10 23:28:34,882 - INFO - orders - Calculated contract_value for pending order: 1.00000000 (contract_size: 1.00000000 * quantity: 1)
2025-07-10 23:28:34,883 - INFO - orders - [DEBUG] User data from cache: {'id': 9, 'email': 'cursordemo3@gmail.com', 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'user_type': 'live', 'account_number': 'VTHTN', 'wallet_balance': Decimal('8445.00000000'), 'margin': Decimal('7579.96')}
2025-07-10 23:28:34,883 - INFO - orders - [DEBUG] Group name: Group B
2025-07-10 23:28:34,883 - INFO - orders - User 9 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-10 23:28:34,885 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for BTCUSD: contract_size=1.00000000, profit_currency=USD, digit=2.00000
2025-07-10 23:28:35,249 - INFO - orders - [MARGIN_CALC] Market data for BTCUSD: {'b': '118156.1000000000', 'o': '118157.9000000000'}
2025-07-10 23:28:35,249 - WARNING - orders - [MARGIN_CALC] Missing ask price for BTCUSD, using bid price with spread: bid=118156.1000000000, ask=118167.91561000000000
2025-07-10 23:28:35,249 - INFO - orders - [MARGIN_CALC] Using prices for BTCUSD: bid=118156.1000000000, ask=118167.91561000000000
2025-07-10 23:28:35,249 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: BTCUSD, Type: BUY_LIMIT, Qty: 1, Price: 118167.91561000000000, Margin: 59083.96, Commission: 236.34
2025-07-10 23:28:35,250 - INFO - orders - Calculated initial margin: 59083.96, commission: 236.34 for pending order 4123941836
2025-07-10 23:28:35,256 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '4123941836', 'order_company_name': 'BTCUSD', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('1'), 'order_price': Decimal('118205.15'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '6913526404', 'takeprofit_id': '1447018933', 'order_user_id': 9, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('1.00000000'), 'margin': Decimal('59083.96'), 'commission': Decimal('236.34'), 'open_time': None}
2025-07-10 23:28:35,256 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-10 23:28:35,256 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 9 at price 118205.15
2025-07-10 23:28:35,257 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '4123941836', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 9, 'order_company_name': 'BTCUSD', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('118205.15'), 'order_quantity': Decimal('1'), 'contract_value': Decimal('1.00000000'), 'margin': Decimal('59083.96'), 'commission': Decimal('236.34'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '6913526404', 'takeprofit_id': '1447018933', 'close_id': None}
2025-07-10 23:28:35,287 - INFO - orders - Order 4123941836 verified in database on attempt 1 before adding to Redis.
2025-07-10 23:28:35,290 - INFO - orders - Skipping Redis storage for Barclays user pending order 4123941836
2025-07-10 23:28:35,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:28:35,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:28:35,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:28:35,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:28:35,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:28:35,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:28:35,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:28:35,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:28:35,298 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:28:35,312 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:28:35,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:28:35,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:28:35,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:28:35,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:28:35,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:28:35,313 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:28:35,314 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:28:35,314 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:28:35,321 - INFO - orders - [PERF] TOTAL place_order: 0.4572s
2025-07-10 23:28:35,341 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:28:35,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:28:35,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:28:35,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:28:35,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:28:35,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:28:35,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:28:35,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:28:35,342 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:28:35,387 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:28:35,387 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:28:35,387 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:28:35,387 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:28:35,388 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:28:35,388 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:28:35,388 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:28:35,388 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:28:35,388 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:28:35,392 - INFO - orders - Background balance/margin cache updated for user 9: balance=8445.00000000, margin=7579.96
2025-07-10 23:28:35,870 - INFO - orders - [BARCLAYS] barclays_push called for user 9, is_barclays_live_user=True
2025-07-10 23:28:47,177 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 23:28:47,178 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 23:28:47,179 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 23:28:47,179 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 23:28:47,179 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 23:28:47,179 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 23:28:47,179 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 23:28:47,179 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 23:28:47,179 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 23:30:35,421 - INFO - orders - Service provider update request received: {"order_id":"4123941836","order_status":"PENDING","status":"PENDING"}
2025-07-10 23:30:35,426 - INFO - orders - Original order status: PENDING_PROCESSING
2025-07-10 23:30:35,426 - INFO - orders - Update fields: {'order_id': '4123941836', 'order_status': 'PENDING', 'status': 'PENDING'}
2025-07-10 23:30:35,427 - INFO - orders - Processing regular update for order 4123941836
2025-07-10 23:30:35,450 - ERROR - orders - Error updating user data cache after service provider update: get_user_by_id() missing 1 required positional argument: 'user_type'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 3518, in update_order_by_service_provider
    db_user = await get_user_by_id(db, user_id)
                    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
TypeError: get_user_by_id() missing 1 required positional argument: 'user_type'
2025-07-10 23:30:35,452 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 23:30:35,452 - INFO - orders - Using order model: UserOrder
2025-07-10 23:30:35,457 - INFO - orders - Fetched 3 open orders for user 9
2025-07-10 23:30:35,460 - INFO - orders - Fetched 2 pending orders for user 9
2025-07-10 23:30:35,462 - INFO - orders - Updated static orders cache for user 9 with 3 open orders and 2 pending orders
2025-07-10 23:30:35,466 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:30:35,466 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:30:35,466 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:30:35,466 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:30:35,467 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:30:35,467 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:30:35,467 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:30:35,467 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:30:35,467 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:30:35,470 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=7579.96
2025-07-10 23:30:43,912 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 23:30:43,913 - INFO - orders - Using order model: UserOrder
2025-07-10 23:30:43,917 - INFO - orders - Fetched 3 open orders for user 9
2025-07-10 23:30:43,921 - INFO - orders - Fetched 1 pending orders for user 9
2025-07-10 23:30:43,923 - INFO - orders - Updated static orders cache for user 9 with 3 open orders and 1 pending orders
2025-07-10 23:30:43,930 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:30:43,930 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:30:43,930 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:30:43,930 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:30:43,930 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:30:43,930 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:30:43,930 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:30:43,930 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:30:43,930 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:30:43,932 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=7579.96
2025-07-10 23:30:43,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:30:43,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:30:43,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:30:43,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:30:43,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:30:43,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:30:43,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:30:43,938 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:30:43,938 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:30:44,274 - INFO - orders - Starting update_user_static_orders for user 9, user_type live
2025-07-10 23:30:44,274 - INFO - orders - Using order model: UserOrder
2025-07-10 23:30:44,281 - INFO - orders - Fetched 3 open orders for user 9
2025-07-10 23:30:44,289 - INFO - orders - Fetched 0 pending orders for user 9
2025-07-10 23:30:44,291 - INFO - orders - Updated static orders cache for user 9 with 3 open orders and 0 pending orders
2025-07-10 23:30:44,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:30:44,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:30:44,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:30:44,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:30:44,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:30:44,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:30:44,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:30:44,298 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:30:44,298 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:30:44,301 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=8445.00000000, margin=7579.96
2025-07-10 23:30:44,305 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:30:44,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:30:44,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:30:44,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:30:44,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:30:44,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:30:44,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:30:44,306 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:30:44,306 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:31:38,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:31:38,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:31:38,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:31:38,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:31:38,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:31:38,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:31:38,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:31:38,886 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:31:38,886 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:31:40,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:31:40,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:31:40,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:31:40,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:31:40,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:31:40,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:31:40,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:31:40,983 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:31:40,983 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:33:47,246 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 23:33:47,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 23:33:47,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 23:33:47,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 23:33:47,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 23:33:47,247 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:33:47,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 23:33:47,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 23:33:47,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 23:33:47,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 23:33:47,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 23:33:47,248 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 23:33:47,249 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 23:33:47,249 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 23:33:47,249 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 23:33:47,249 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 23:33:47,249 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 23:36:42,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:36:42,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:36:42,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:36:42,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:36:42,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:36:42,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:36:42,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:36:42,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:36:42,940 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:36:42,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDJPY
2025-07-10 23:36:42,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:36:42,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDJPY: AllMarginsPerLot=[Decimal('660.727208'), Decimal('659.614413')], HighestMarginPerLot=660.727208
2025-07-10 23:36:42,944 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDJPY: CalculatedTotalMargin=6.61
2025-07-10 23:36:42,945 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol BTCUSD
2025-07-10 23:36:42,945 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: TotalBuyQty=0.13000000, TotalSellQty=0, NetQty=0.13000000, IsHedged=False
2025-07-10 23:36:42,945 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol BTCUSD: AllMarginsPerLot=[Decimal('58256.53846153846153846153846')], HighestMarginPerLot=58256.53846153846153846153846
2025-07-10 23:36:42,945 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol BTCUSD: CalculatedTotalMargin=7573.35
2025-07-10 23:36:42,945 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 7579.96
2025-07-10 23:38:47,357 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 9 positions for User 4, Symbol AUDCAD
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.07000000, TotalSellQty=0.02000000, NetQty=0.07000000, IsHedged=True
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('655.706338'), Decimal('655.701512'), Decimal('655.759422'), Decimal('655.691862'), Decimal('655.696687'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764'), Decimal('650.706764')], HighestMarginPerLot=655.759422
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=45.90
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCHF
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('655.464939')], HighestMarginPerLot=655.464939
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=6.55
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 6 positions for User 4, Symbol AUDJPY
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.06000000, TotalSellQty=0, NetQty=0.06000000, IsHedged=False
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95100'), Decimal('655.103666'), Decimal('651.752583'), Decimal('651.745686'), Decimal('651.787069'), Decimal('653.442838')], HighestMarginPerLot=95100
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=5706.00
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol AUDSGD
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDSGD: AllMarginsPerLot=[Decimal('783.177351'), Decimal('783.177351')], HighestMarginPerLot=783.177351
2025-07-10 23:38:47,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDSGD: CalculatedTotalMargin=15.66
2025-07-10 23:38:47,358 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 5774.11
2025-07-10 23:41:03,343 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-10 23:41:04,212 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-10 23:41:04,212 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-10 23:41:04,212 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-10 23:41:04,212 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-10 23:41:08,269 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-10 23:41:08,270 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-10 23:41:09,220 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-10 23:41:14,227 - INFO - orders - Starting the users with orders cache updater task.
2025-07-10 23:41:17,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDJPY
2025-07-10 23:41:17,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:41:17,288 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717')], HighestMarginPerLot=96717
2025-07-10 23:41:17,289 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-10 23:41:17,289 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-10 23:41:17,467 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 13, Symbol XAGUSD
2025-07-10 23:41:17,468 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-10 23:41:17,468 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1842'), Decimal('1843')], HighestMarginPerLot=1843
2025-07-10 23:41:17,468 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=36.86
2025-07-10 23:41:17,468 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 36.86
2025-07-10 23:41:19,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-10 23:41:19,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-10 23:41:19,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-10 23:41:19,680 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-10 23:41:19,680 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-10 23:41:19,742 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 18, Symbol XAGUSD
2025-07-10 23:41:19,742 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-10 23:41:19,742 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1827.44')], HighestMarginPerLot=1827.44
2025-07-10 23:41:19,742 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 18, Symbol XAGUSD: CalculatedTotalMargin=456.86
2025-07-10 23:41:19,742 - INFO - orders - [TOTAL_USER_MARGIN] User 18 total margin across all symbols: 456.86
2025-07-10 23:41:19,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-10 23:41:19,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-10 23:41:19,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-10 23:41:19,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-10 23:41:19,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 20, Symbol EURUSD
2025-07-10 23:41:19,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=1.01000000, TotalSellQty=0, NetQty=1.01000000, IsHedged=False
2025-07-10 23:41:19,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180'), Decimal('1181.89')], HighestMarginPerLot=1181.89
2025-07-10 23:41:19,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=1193.71
2025-07-10 23:41:19,864 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 1200.29
2025-07-10 23:41:19,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 22, Symbol AUDJPY
2025-07-10 23:41:19,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-10 23:41:19,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96723'), Decimal('96712')], HighestMarginPerLot=96723
2025-07-10 23:41:19,991 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 22, Symbol AUDJPY: CalculatedTotalMargin=967.23
2025-07-10 23:41:19,992 - INFO - orders - [TOTAL_USER_MARGIN] User 22 total margin across all symbols: 967.23
2025-07-10 23:41:22,282 - INFO - orders - Starting update_user_static_orders for user 11, user_type demo
2025-07-10 23:41:22,282 - INFO - orders - Using order model: DemoUserOrder
2025-07-10 23:41:22,312 - INFO - orders - Fetched 0 open orders for user 11
2025-07-10 23:41:22,342 - INFO - orders - Fetched 0 pending orders for user 11
2025-07-10 23:41:22,342 - INFO - orders - Updated static orders cache for user 11 with 0 open orders and 0 pending orders
2025-07-10 23:41:22,490 - INFO - orders - User 11: Updated balance/margin cache after static orders update - balance=99998.61000000, margin=0.0
2025-07-11 00:00:54,751 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-11 00:00:55,647 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-11 00:00:55,647 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-11 00:00:55,647 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-11 00:00:55,647 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-11 00:00:59,749 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-11 00:00:59,749 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-11 00:01:00,661 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-11 00:01:05,647 - INFO - orders - Starting the users with orders cache updater task.
2025-07-11 00:01:06,630 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDCAD
2025-07-11 00:01:06,631 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-11 00:01:06,631 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('451'), Decimal('451'), Decimal('451')], HighestMarginPerLot=451
2025-07-11 00:01:06,632 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=9.02
2025-07-11 00:01:06,632 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 9.02
2025-07-11 00:01:09,225 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-11 00:01:13,035 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-11 00:01:13,035 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-11 00:01:13,035 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-11 00:01:13,035 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-11 00:01:13,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-11 00:01:13,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:01:13,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-11 00:01:13,036 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-11 00:01:13,036 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-11 00:01:13,134 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDCAD
2025-07-11 00:01:13,135 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-11 00:01:13,135 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('900')], HighestMarginPerLot=900
2025-07-11 00:01:13,135 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=9.00
2025-07-11 00:01:13,136 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDJPY
2025-07-11 00:01:13,136 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-11 00:01:13,137 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95777')], HighestMarginPerLot=95777
2025-07-11 00:01:13,137 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=957.77
2025-07-11 00:01:13,138 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 966.77
2025-07-11 00:01:13,231 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDJPY
2025-07-11 00:01:13,231 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:01:13,231 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717')], HighestMarginPerLot=96717
2025-07-11 00:01:13,231 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-11 00:01:13,232 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-11 00:01:13,409 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 13, Symbol XAGUSD
2025-07-11 00:01:13,409 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-11 00:01:13,409 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1842'), Decimal('1843')], HighestMarginPerLot=1843
2025-07-11 00:01:13,410 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=36.86
2025-07-11 00:01:13,410 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 36.86
2025-07-11 00:01:13,566 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:13,656 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-11 00:01:13,656 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-11 00:01:13,656 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-11 00:01:13,657 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-11 00:01:13,657 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-11 00:01:13,780 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 18, Symbol XAGUSD
2025-07-11 00:01:13,780 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-11 00:01:13,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1827.44')], HighestMarginPerLot=1827.44
2025-07-11 00:01:13,781 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 18, Symbol XAGUSD: CalculatedTotalMargin=456.86
2025-07-11 00:01:13,781 - INFO - orders - [TOTAL_USER_MARGIN] User 18 total margin across all symbols: 456.86
2025-07-11 00:01:13,939 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-11 00:01:13,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:01:13,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-11 00:01:13,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-11 00:01:13,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 20, Symbol EURUSD
2025-07-11 00:01:13,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=1.01000000, TotalSellQty=0, NetQty=1.01000000, IsHedged=False
2025-07-11 00:01:13,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180'), Decimal('1181.89')], HighestMarginPerLot=1181.89
2025-07-11 00:01:13,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=1193.71
2025-07-11 00:01:13,940 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 1200.29
2025-07-11 00:01:14,105 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 22, Symbol AUDJPY
2025-07-11 00:01:14,105 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-11 00:01:14,105 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96723'), Decimal('96712')], HighestMarginPerLot=96723
2025-07-11 00:01:14,106 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 22, Symbol AUDJPY: CalculatedTotalMargin=967.23
2025-07-11 00:01:14,106 - INFO - orders - [TOTAL_USER_MARGIN] User 22 total margin across all symbols: 967.23
2025-07-11 00:01:14,269 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:14,474 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol USDZAR
2025-07-11 00:01:14,475 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol USDZAR: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:01:14,475 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol USDZAR: AllMarginsPerLot=[Decimal('17782')], HighestMarginPerLot=17782
2025-07-11 00:01:14,475 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol USDZAR: CalculatedTotalMargin=177.82
2025-07-11 00:01:14,475 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 177.82
2025-07-11 00:01:14,680 - INFO - orders - Starting update_user_static_orders for user 4, user_type demo
2025-07-11 00:01:14,680 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:01:14,715 - INFO - orders - Fetched 0 open orders for user 4
2025-07-11 00:01:14,761 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-11 00:01:14,765 - INFO - orders - Updated static orders cache for user 4 with 0 open orders and 0 pending orders
2025-07-11 00:01:14,938 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=100000.00000000, margin=0.0
2025-07-11 00:01:15,109 - INFO - orders - Starting update_user_static_orders for user 9, user_type demo
2025-07-11 00:01:15,109 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:01:15,147 - INFO - orders - Fetched 28 open orders for user 9
2025-07-11 00:01:15,190 - INFO - orders - Fetched 6 pending orders for user 9
2025-07-11 00:01:15,193 - INFO - orders - Updated static orders cache for user 9 with 28 open orders and 6 pending orders
2025-07-11 00:01:15,356 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDUSD
2025-07-11 00:01:15,357 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDUSD: TotalBuyQty=0.10000000, TotalSellQty=0.22000000, NetQty=0.22000000, IsHedged=True
2025-07-11 00:01:15,357 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDUSD: AllMarginsPerLot=[Decimal('647.4'), Decimal('647.0909090909090909090909091')], HighestMarginPerLot=647.4
2025-07-11 00:01:15,357 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDUSD: CalculatedTotalMargin=142.43
2025-07-11 00:01:15,357 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CHFSGD
2025-07-11 00:01:15,357 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFSGD: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:01:15,357 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFSGD: AllMarginsPerLot=[Decimal('1223.5389131'), Decimal('1223.150636')], HighestMarginPerLot=1223.5389131
2025-07-11 00:01:15,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CHFSGD: CalculatedTotalMargin=122.35
2025-07-11 00:01:15,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CADJPY
2025-07-11 00:01:15,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CADJPY: TotalBuyQty=0.15000000, TotalSellQty=0.15000000, NetQty=0.15000000, IsHedged=True
2025-07-11 00:01:15,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CADJPY: AllMarginsPerLot=[Decimal('729.6658264666666666666666667'), Decimal('729.8549729333333333333333333')], HighestMarginPerLot=729.8549729333333333333333333
2025-07-11 00:01:15,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CADJPY: CalculatedTotalMargin=109.48
2025-07-11 00:01:15,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 9, Symbol EURAUD
2025-07-11 00:01:15,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURAUD: TotalBuyQty=0.27000000, TotalSellQty=0.26000000, NetQty=0.27000000, IsHedged=True
2025-07-11 00:01:15,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURAUD: AllMarginsPerLot=[Decimal('1148.786564545454545454545455'), Decimal('1148.503559047619047619047619'), Decimal('1148.863536'), Decimal('1148.622352')], HighestMarginPerLot=1148.863536
2025-07-11 00:01:15,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURAUD: CalculatedTotalMargin=310.19
2025-07-11 00:01:15,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CHFJPY
2025-07-11 00:01:15,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFJPY: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:01:15,362 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFJPY: AllMarginsPerLot=[Decimal('1223.5584187'), Decimal('1223.1379417')], HighestMarginPerLot=1223.5584187
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CHFJPY: CalculatedTotalMargin=122.36
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol EURGBP
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURGBP: TotalBuyQty=0, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=False
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURGBP: AllMarginsPerLot=[Decimal('1148.51044')], HighestMarginPerLot=1148.51044
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURGBP: CalculatedTotalMargin=114.85
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol EURJPY
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURJPY: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURJPY: AllMarginsPerLot=[Decimal('1148.7277223'), Decimal('1148.5285533')], HighestMarginPerLot=1148.7277223
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURJPY: CalculatedTotalMargin=114.87
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol EURNZD
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURNZD: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURNZD: AllMarginsPerLot=[Decimal('1148.532825'), Decimal('1148.192298')], HighestMarginPerLot=1148.532825
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURNZD: CalculatedTotalMargin=114.85
2025-07-11 00:01:15,363 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 9, Symbol GBPUSD
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol GBPUSD: TotalBuyQty=0.50000000, TotalSellQty=0.50000000, NetQty=0.50000000, IsHedged=True
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol GBPUSD: AllMarginsPerLot=[Decimal('0'), Decimal('0'), Decimal('0'), Decimal('0')], HighestMarginPerLot=0
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol GBPUSD: CalculatedTotalMargin=0.00
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol NZDJPY
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol NZDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol NZDJPY: AllMarginsPerLot=[Decimal('597.837949')], HighestMarginPerLot=597.837949
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol NZDJPY: CalculatedTotalMargin=5.98
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDCHF
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDCHF: TotalBuyQty=0.15000000, TotalSellQty=0.15000000, NetQty=0.15000000, IsHedged=True
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDCHF: AllMarginsPerLot=[Decimal('999.8084502'), Decimal('1000.203773866666666666666667')], HighestMarginPerLot=1000.203773866666666666666667
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDCHF: CalculatedTotalMargin=150.03
2025-07-11 00:01:15,364 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.20000000, TotalSellQty=0, NetQty=0.20000000, IsHedged=False
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.0169162'), Decimal('1000.0169154')], HighestMarginPerLot=1000.0169162
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=200.00
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDSGD
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDSGD: TotalBuyQty=0, TotalSellQty=0.31000000, NetQty=0.31000000, IsHedged=False
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDSGD: AllMarginsPerLot=[Decimal('999.7869010967741935483870968')], HighestMarginPerLot=999.7869010967741935483870968
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDSGD: CalculatedTotalMargin=309.93
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-11 00:01:15,365 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=False
2025-07-11 00:01:15,366 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('999.8738813')], HighestMarginPerLot=999.8738813
2025-07-11 00:01:15,366 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=99.99
2025-07-11 00:01:15,366 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 1917.31
2025-07-11 00:01:15,387 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=98181.73000000, margin=1917.31
2025-07-11 00:01:15,392 - INFO - orders - Starting update_user_static_orders for user 10, user_type demo
2025-07-11 00:01:15,392 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:01:15,419 - INFO - orders - Fetched 0 open orders for user 10
2025-07-11 00:01:15,454 - INFO - orders - Fetched 1 pending orders for user 10
2025-07-11 00:01:15,457 - INFO - orders - Updated static orders cache for user 10 with 0 open orders and 1 pending orders
2025-07-11 00:01:15,472 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:15,607 - INFO - orders - User 10: Updated balance/margin cache after static orders update - balance=9958.40000000, margin=0.0
2025-07-11 00:01:15,609 - INFO - orders - Starting update_user_static_orders for user 11, user_type demo
2025-07-11 00:01:15,609 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:01:15,646 - INFO - orders - Fetched 0 open orders for user 11
2025-07-11 00:01:15,681 - INFO - orders - Fetched 0 pending orders for user 11
2025-07-11 00:01:15,682 - INFO - orders - Updated static orders cache for user 11 with 0 open orders and 0 pending orders
2025-07-11 00:01:15,858 - INFO - orders - User 11: Updated balance/margin cache after static orders update - balance=99998.61000000, margin=0.0
2025-07-11 00:01:16,790 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:21,416 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:23,743 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:26,073 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:30,652 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:33,033 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:34,295 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-11 00:01:35,268 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:39,723 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:40,443 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:42,164 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:49,167 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:51,436 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:56,222 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:01:58,363 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:02:00,702 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:03:21,070 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-11 00:03:22,054 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-11 00:03:22,054 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-11 00:03:22,054 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-11 00:03:22,054 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-11 00:03:26,115 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-11 00:03:26,115 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-11 00:03:27,060 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-11 00:03:32,068 - INFO - orders - Starting the users with orders cache updater task.
2025-07-11 00:03:33,301 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDCAD
2025-07-11 00:03:33,303 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-11 00:03:33,303 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('451'), Decimal('451'), Decimal('451')], HighestMarginPerLot=451
2025-07-11 00:03:33,303 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=9.02
2025-07-11 00:03:33,303 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 9.02
2025-07-11 00:03:37,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-11 00:03:37,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-11 00:03:37,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-11 00:03:37,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-11 00:03:37,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-11 00:03:37,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:03:37,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-11 00:03:37,528 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-11 00:03:37,528 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-11 00:03:37,615 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDCAD
2025-07-11 00:03:37,615 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-11 00:03:37,615 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('900')], HighestMarginPerLot=900
2025-07-11 00:03:37,615 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=9.00
2025-07-11 00:03:37,615 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDJPY
2025-07-11 00:03:37,615 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-11 00:03:37,615 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95777')], HighestMarginPerLot=95777
2025-07-11 00:03:37,615 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=957.77
2025-07-11 00:03:37,615 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 966.77
2025-07-11 00:03:37,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDJPY
2025-07-11 00:03:37,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:03:37,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717')], HighestMarginPerLot=96717
2025-07-11 00:03:37,705 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-11 00:03:37,705 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-11 00:03:37,962 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 13, Symbol XAGUSD
2025-07-11 00:03:37,963 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-11 00:03:37,963 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1842'), Decimal('1843')], HighestMarginPerLot=1843
2025-07-11 00:03:37,963 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=36.86
2025-07-11 00:03:37,963 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 36.86
2025-07-11 00:03:37,970 - INFO - orders - Starting update_user_static_orders for user 14, user_type live
2025-07-11 00:03:37,970 - INFO - orders - Using order model: UserOrder
2025-07-11 00:03:38,010 - INFO - orders - Fetched 0 open orders for user 14
2025-07-11 00:03:38,049 - INFO - orders - Fetched 0 pending orders for user 14
2025-07-11 00:03:38,050 - INFO - orders - Updated static orders cache for user 14 with 0 open orders and 0 pending orders
2025-07-11 00:03:38,095 - INFO - orders - User 14: Updated balance/margin cache after static orders update - balance=10000.00000000, margin=0.0
2025-07-11 00:03:38,229 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:03:38,264 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-11 00:03:38,264 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-11 00:03:38,264 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-11 00:03:38,264 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-11 00:03:38,264 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-11 00:03:38,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 18, Symbol XAGUSD
2025-07-11 00:03:38,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-11 00:03:38,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1827.44')], HighestMarginPerLot=1827.44
2025-07-11 00:03:38,358 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 18, Symbol XAGUSD: CalculatedTotalMargin=456.86
2025-07-11 00:03:38,358 - INFO - orders - [TOTAL_USER_MARGIN] User 18 total margin across all symbols: 456.86
2025-07-11 00:03:38,519 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-11 00:03:38,519 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:03:38,519 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-11 00:03:38,519 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-11 00:03:38,519 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 20, Symbol EURUSD
2025-07-11 00:03:38,520 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=1.01000000, TotalSellQty=0, NetQty=1.01000000, IsHedged=False
2025-07-11 00:03:38,520 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180'), Decimal('1181.89')], HighestMarginPerLot=1181.89
2025-07-11 00:03:38,520 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=1193.71
2025-07-11 00:03:38,520 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 1200.29
2025-07-11 00:03:38,672 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:03:38,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 22, Symbol AUDJPY
2025-07-11 00:03:38,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-11 00:03:38,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96723'), Decimal('96712')], HighestMarginPerLot=96723
2025-07-11 00:03:38,690 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 22, Symbol AUDJPY: CalculatedTotalMargin=967.23
2025-07-11 00:03:38,690 - INFO - orders - [TOTAL_USER_MARGIN] User 22 total margin across all symbols: 967.23
2025-07-11 00:03:39,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol USDZAR
2025-07-11 00:03:39,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol USDZAR: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:03:39,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol USDZAR: AllMarginsPerLot=[Decimal('17782')], HighestMarginPerLot=17782
2025-07-11 00:03:39,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol USDZAR: CalculatedTotalMargin=177.82
2025-07-11 00:03:39,045 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 177.82
2025-07-11 00:03:43,339 - INFO - orders - Starting update_user_static_orders for user 4, user_type demo
2025-07-11 00:03:43,339 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:03:43,357 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:03:43,379 - INFO - orders - Fetched 0 open orders for user 4
2025-07-11 00:03:43,423 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-11 00:03:43,424 - INFO - orders - Updated static orders cache for user 4 with 0 open orders and 0 pending orders
2025-07-11 00:03:43,669 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=100000.00000000, margin=0.0
2025-07-11 00:03:43,779 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:03:43,815 - INFO - orders - Starting update_user_static_orders for user 9, user_type demo
2025-07-11 00:03:43,815 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:03:43,851 - INFO - orders - Fetched 28 open orders for user 9
2025-07-11 00:03:43,886 - INFO - orders - Fetched 6 pending orders for user 9
2025-07-11 00:03:43,890 - INFO - orders - Updated static orders cache for user 9 with 28 open orders and 6 pending orders
2025-07-11 00:03:44,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDUSD
2025-07-11 00:03:44,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDUSD: TotalBuyQty=0.10000000, TotalSellQty=0.22000000, NetQty=0.22000000, IsHedged=True
2025-07-11 00:03:44,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDUSD: AllMarginsPerLot=[Decimal('647.4'), Decimal('647.0909090909090909090909091')], HighestMarginPerLot=647.4
2025-07-11 00:03:44,044 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDUSD: CalculatedTotalMargin=142.43
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CHFSGD
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFSGD: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFSGD: AllMarginsPerLot=[Decimal('1223.5389131'), Decimal('1223.150636')], HighestMarginPerLot=1223.5389131
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CHFSGD: CalculatedTotalMargin=122.35
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CADJPY
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CADJPY: TotalBuyQty=0.15000000, TotalSellQty=0.15000000, NetQty=0.15000000, IsHedged=True
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CADJPY: AllMarginsPerLot=[Decimal('729.6658264666666666666666667'), Decimal('729.8549729333333333333333333')], HighestMarginPerLot=729.8549729333333333333333333
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CADJPY: CalculatedTotalMargin=109.48
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 9, Symbol EURAUD
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURAUD: TotalBuyQty=0.27000000, TotalSellQty=0.26000000, NetQty=0.27000000, IsHedged=True
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURAUD: AllMarginsPerLot=[Decimal('1148.786564545454545454545455'), Decimal('1148.503559047619047619047619'), Decimal('1148.863536'), Decimal('1148.622352')], HighestMarginPerLot=1148.863536
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURAUD: CalculatedTotalMargin=310.19
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CHFJPY
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFJPY: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFJPY: AllMarginsPerLot=[Decimal('1223.5584187'), Decimal('1223.1379417')], HighestMarginPerLot=1223.5584187
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CHFJPY: CalculatedTotalMargin=122.36
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol EURGBP
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURGBP: TotalBuyQty=0, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=False
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURGBP: AllMarginsPerLot=[Decimal('1148.51044')], HighestMarginPerLot=1148.51044
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURGBP: CalculatedTotalMargin=114.85
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol EURJPY
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURJPY: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURJPY: AllMarginsPerLot=[Decimal('1148.7277223'), Decimal('1148.5285533')], HighestMarginPerLot=1148.7277223
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURJPY: CalculatedTotalMargin=114.87
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol EURNZD
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURNZD: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURNZD: AllMarginsPerLot=[Decimal('1148.532825'), Decimal('1148.192298')], HighestMarginPerLot=1148.532825
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURNZD: CalculatedTotalMargin=114.85
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 9, Symbol GBPUSD
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol GBPUSD: TotalBuyQty=0.50000000, TotalSellQty=0.50000000, NetQty=0.50000000, IsHedged=True
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol GBPUSD: AllMarginsPerLot=[Decimal('0'), Decimal('0'), Decimal('0'), Decimal('0')], HighestMarginPerLot=0
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol GBPUSD: CalculatedTotalMargin=0.00
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol NZDJPY
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol NZDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol NZDJPY: AllMarginsPerLot=[Decimal('597.837949')], HighestMarginPerLot=597.837949
2025-07-11 00:03:44,045 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol NZDJPY: CalculatedTotalMargin=5.98
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDCHF
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDCHF: TotalBuyQty=0.15000000, TotalSellQty=0.15000000, NetQty=0.15000000, IsHedged=True
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDCHF: AllMarginsPerLot=[Decimal('999.8084502'), Decimal('1000.203773866666666666666667')], HighestMarginPerLot=1000.203773866666666666666667
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDCHF: CalculatedTotalMargin=150.03
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.20000000, TotalSellQty=0, NetQty=0.20000000, IsHedged=False
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.0169162'), Decimal('1000.0169154')], HighestMarginPerLot=1000.0169162
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=200.00
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDSGD
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDSGD: TotalBuyQty=0, TotalSellQty=0.31000000, NetQty=0.31000000, IsHedged=False
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDSGD: AllMarginsPerLot=[Decimal('999.7869010967741935483870968')], HighestMarginPerLot=999.7869010967741935483870968
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDSGD: CalculatedTotalMargin=309.93
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=False
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('999.8738813')], HighestMarginPerLot=999.8738813
2025-07-11 00:03:44,046 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=99.99
2025-07-11 00:03:44,046 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 1917.31
2025-07-11 00:03:44,047 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=98181.73000000, margin=1917.31
2025-07-11 00:03:44,048 - INFO - orders - Starting update_user_static_orders for user 10, user_type demo
2025-07-11 00:03:44,048 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:03:44,078 - INFO - orders - Fetched 0 open orders for user 10
2025-07-11 00:03:44,106 - INFO - orders - Fetched 1 pending orders for user 10
2025-07-11 00:03:44,109 - INFO - orders - Updated static orders cache for user 10 with 0 open orders and 1 pending orders
2025-07-11 00:03:44,251 - INFO - orders - User 10: Updated balance/margin cache after static orders update - balance=9958.40000000, margin=0.0
2025-07-11 00:03:44,252 - INFO - orders - Starting update_user_static_orders for user 11, user_type demo
2025-07-11 00:03:44,252 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:03:44,281 - INFO - orders - Fetched 0 open orders for user 11
2025-07-11 00:03:44,309 - INFO - orders - Fetched 0 pending orders for user 11
2025-07-11 00:03:44,310 - INFO - orders - Updated static orders cache for user 11 with 0 open orders and 0 pending orders
2025-07-11 00:03:44,456 - INFO - orders - User 11: Updated balance/margin cache after static orders update - balance=99998.61000000, margin=0.0
2025-07-11 00:03:45,139 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:03:47,317 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:03:49,642 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:03:51,922 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:01,219 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:03,500 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:06,039 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:08,122 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:12,703 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:15,007 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:17,338 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:19,615 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:22,299 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:24,272 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:26,551 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:31,145 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:33,662 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:34,675 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-11 00:04:35,917 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:38,300 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:40,610 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:42,078 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-11 00:04:42,873 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:45,124 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:47,414 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:49,698 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:51,985 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:56,658 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:04:58,917 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:03,541 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:05,846 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:08,503 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:12,729 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:15,065 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:22,744 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:24,314 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:26,749 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:28,808 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:33,414 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:35,742 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:40,361 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:42,623 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:44,927 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:49,579 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:51,863 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:54,185 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:56,490 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:05:58,995 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:01,306 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:03,596 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:05,948 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:08,343 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:12,850 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:15,212 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:19,895 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:22,358 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:24,447 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:27,110 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:29,087 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:31,386 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:33,672 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:35,977 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:38,279 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:40,549 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:45,534 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:47,819 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:49,782 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:54,481 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:56,721 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:06:59,032 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:01,342 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:05,931 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:08,309 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:10,531 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:12,842 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:22,409 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:24,473 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:29,172 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:31,393 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:33,643 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:38,052 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:38,631 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:40,948 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:45,332 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:46,381 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-11 00:07:49,912 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:07:52,268 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:22,437 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-11 00:09:23,591 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-11 00:09:23,591 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-11 00:09:23,591 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-11 00:09:23,591 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-11 00:09:27,695 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-11 00:09:27,695 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-11 00:09:28,601 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-11 00:09:33,599 - INFO - orders - Starting the users with orders cache updater task.
2025-07-11 00:09:34,544 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDCAD
2025-07-11 00:09:34,544 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-11 00:09:34,544 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('451'), Decimal('451'), Decimal('451')], HighestMarginPerLot=451
2025-07-11 00:09:34,544 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=9.02
2025-07-11 00:09:34,544 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 9.02
2025-07-11 00:09:36,724 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:36,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-11 00:09:36,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-11 00:09:36,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-11 00:09:36,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-11 00:09:36,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-11 00:09:36,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:09:36,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-11 00:09:36,745 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-11 00:09:36,745 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-11 00:09:36,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDCAD
2025-07-11 00:09:36,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-11 00:09:36,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('900')], HighestMarginPerLot=900
2025-07-11 00:09:36,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=9.00
2025-07-11 00:09:36,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDJPY
2025-07-11 00:09:36,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-11 00:09:36,824 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95777')], HighestMarginPerLot=95777
2025-07-11 00:09:36,825 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=957.77
2025-07-11 00:09:36,825 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 966.77
2025-07-11 00:09:36,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDJPY
2025-07-11 00:09:36,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:09:36,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717')], HighestMarginPerLot=96717
2025-07-11 00:09:36,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-11 00:09:36,900 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-11 00:09:41,072 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 13, Symbol XAGUSD
2025-07-11 00:09:41,072 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-11 00:09:41,073 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1842'), Decimal('1843')], HighestMarginPerLot=1843
2025-07-11 00:09:41,073 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=36.86
2025-07-11 00:09:41,073 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 36.86
2025-07-11 00:09:41,221 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:41,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-11 00:09:41,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-11 00:09:41,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-11 00:09:41,297 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-11 00:09:41,297 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-11 00:09:41,373 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 18, Symbol XAGUSD
2025-07-11 00:09:41,373 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-11 00:09:41,373 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1827.44')], HighestMarginPerLot=1827.44
2025-07-11 00:09:41,374 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 18, Symbol XAGUSD: CalculatedTotalMargin=456.86
2025-07-11 00:09:41,374 - INFO - orders - [TOTAL_USER_MARGIN] User 18 total margin across all symbols: 456.86
2025-07-11 00:09:41,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-11 00:09:41,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:09:41,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-11 00:09:41,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-11 00:09:41,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 20, Symbol EURUSD
2025-07-11 00:09:41,539 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=1.01000000, TotalSellQty=0, NetQty=1.01000000, IsHedged=False
2025-07-11 00:09:41,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180'), Decimal('1181.89')], HighestMarginPerLot=1181.89
2025-07-11 00:09:41,540 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=1193.71
2025-07-11 00:09:41,540 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 1200.29
2025-07-11 00:09:41,718 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 22, Symbol AUDJPY
2025-07-11 00:09:41,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-11 00:09:41,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96723'), Decimal('96712')], HighestMarginPerLot=96723
2025-07-11 00:09:41,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 22, Symbol AUDJPY: CalculatedTotalMargin=967.23
2025-07-11 00:09:41,719 - INFO - orders - [TOTAL_USER_MARGIN] User 22 total margin across all symbols: 967.23
2025-07-11 00:09:41,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol USDZAR
2025-07-11 00:09:41,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol USDZAR: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:09:41,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol USDZAR: AllMarginsPerLot=[Decimal('17782')], HighestMarginPerLot=17782
2025-07-11 00:09:41,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol USDZAR: CalculatedTotalMargin=177.82
2025-07-11 00:09:41,986 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 177.82
2025-07-11 00:09:42,135 - INFO - orders - Starting update_user_static_orders for user 4, user_type demo
2025-07-11 00:09:42,135 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:09:42,168 - INFO - orders - Fetched 0 open orders for user 4
2025-07-11 00:09:42,202 - INFO - orders - Fetched 0 pending orders for user 4
2025-07-11 00:09:42,203 - INFO - orders - Updated static orders cache for user 4 with 0 open orders and 0 pending orders
2025-07-11 00:09:42,308 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:42,373 - INFO - orders - User 4: Updated balance/margin cache after static orders update - balance=100000.00000000, margin=0.0
2025-07-11 00:09:42,526 - INFO - orders - Starting update_user_static_orders for user 9, user_type demo
2025-07-11 00:09:42,526 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:09:42,559 - INFO - orders - Fetched 28 open orders for user 9
2025-07-11 00:09:42,588 - INFO - orders - Fetched 6 pending orders for user 9
2025-07-11 00:09:42,590 - INFO - orders - Updated static orders cache for user 9 with 28 open orders and 6 pending orders
2025-07-11 00:09:42,747 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol AUDUSD
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDUSD: TotalBuyQty=0.10000000, TotalSellQty=0.22000000, NetQty=0.22000000, IsHedged=True
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol AUDUSD: AllMarginsPerLot=[Decimal('647.4'), Decimal('647.0909090909090909090909091')], HighestMarginPerLot=647.4
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol AUDUSD: CalculatedTotalMargin=142.43
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CHFSGD
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFSGD: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFSGD: AllMarginsPerLot=[Decimal('1223.5389131'), Decimal('1223.150636')], HighestMarginPerLot=1223.5389131
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CHFSGD: CalculatedTotalMargin=122.35
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CADJPY
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CADJPY: TotalBuyQty=0.15000000, TotalSellQty=0.15000000, NetQty=0.15000000, IsHedged=True
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CADJPY: AllMarginsPerLot=[Decimal('729.6658264666666666666666667'), Decimal('729.8549729333333333333333333')], HighestMarginPerLot=729.8549729333333333333333333
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CADJPY: CalculatedTotalMargin=109.48
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 9, Symbol EURAUD
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURAUD: TotalBuyQty=0.27000000, TotalSellQty=0.26000000, NetQty=0.27000000, IsHedged=True
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURAUD: AllMarginsPerLot=[Decimal('1148.786564545454545454545455'), Decimal('1148.503559047619047619047619'), Decimal('1148.863536'), Decimal('1148.622352')], HighestMarginPerLot=1148.863536
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURAUD: CalculatedTotalMargin=310.19
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol CHFJPY
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFJPY: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol CHFJPY: AllMarginsPerLot=[Decimal('1223.5584187'), Decimal('1223.1379417')], HighestMarginPerLot=1223.5584187
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol CHFJPY: CalculatedTotalMargin=122.36
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol EURGBP
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURGBP: TotalBuyQty=0, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=False
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURGBP: AllMarginsPerLot=[Decimal('1148.51044')], HighestMarginPerLot=1148.51044
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURGBP: CalculatedTotalMargin=114.85
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol EURJPY
2025-07-11 00:09:42,748 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURJPY: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURJPY: AllMarginsPerLot=[Decimal('1148.7277223'), Decimal('1148.5285533')], HighestMarginPerLot=1148.7277223
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURJPY: CalculatedTotalMargin=114.87
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol EURNZD
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURNZD: TotalBuyQty=0.10000000, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=True
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol EURNZD: AllMarginsPerLot=[Decimal('1148.532825'), Decimal('1148.192298')], HighestMarginPerLot=1148.532825
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol EURNZD: CalculatedTotalMargin=114.85
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 9, Symbol GBPUSD
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol GBPUSD: TotalBuyQty=0.50000000, TotalSellQty=0.50000000, NetQty=0.50000000, IsHedged=True
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol GBPUSD: AllMarginsPerLot=[Decimal('0'), Decimal('0'), Decimal('0'), Decimal('0')], HighestMarginPerLot=0
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol GBPUSD: CalculatedTotalMargin=0.00
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol NZDJPY
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol NZDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol NZDJPY: AllMarginsPerLot=[Decimal('597.837949')], HighestMarginPerLot=597.837949
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol NZDJPY: CalculatedTotalMargin=5.98
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDCHF
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDCHF: TotalBuyQty=0.15000000, TotalSellQty=0.15000000, NetQty=0.15000000, IsHedged=True
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDCHF: AllMarginsPerLot=[Decimal('999.8084502'), Decimal('1000.203773866666666666666667')], HighestMarginPerLot=1000.203773866666666666666667
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDCHF: CalculatedTotalMargin=150.03
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.20000000, TotalSellQty=0, NetQty=0.20000000, IsHedged=False
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.0169162'), Decimal('1000.0169154')], HighestMarginPerLot=1000.0169162
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=200.00
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDSGD
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDSGD: TotalBuyQty=0, TotalSellQty=0.31000000, NetQty=0.31000000, IsHedged=False
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDSGD: AllMarginsPerLot=[Decimal('999.7869010967741935483870968')], HighestMarginPerLot=999.7869010967741935483870968
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDSGD: CalculatedTotalMargin=309.93
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0, TotalSellQty=0.10000000, NetQty=0.10000000, IsHedged=False
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('999.8738813')], HighestMarginPerLot=999.8738813
2025-07-11 00:09:42,749 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=99.99
2025-07-11 00:09:42,749 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 1917.31
2025-07-11 00:09:42,752 - INFO - orders - User 9: Updated balance/margin cache after static orders update - balance=98181.73000000, margin=1917.31
2025-07-11 00:09:42,756 - INFO - orders - Starting update_user_static_orders for user 10, user_type demo
2025-07-11 00:09:42,756 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:09:42,782 - INFO - orders - Fetched 0 open orders for user 10
2025-07-11 00:09:42,810 - INFO - orders - Fetched 1 pending orders for user 10
2025-07-11 00:09:42,811 - INFO - orders - Updated static orders cache for user 10 with 0 open orders and 1 pending orders
2025-07-11 00:09:42,827 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:42,952 - INFO - orders - User 10: Updated balance/margin cache after static orders update - balance=9958.40000000, margin=0.0
2025-07-11 00:09:42,953 - INFO - orders - Starting update_user_static_orders for user 11, user_type demo
2025-07-11 00:09:42,953 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:09:42,983 - INFO - orders - Fetched 0 open orders for user 11
2025-07-11 00:09:43,018 - INFO - orders - Fetched 0 pending orders for user 11
2025-07-11 00:09:43,019 - INFO - orders - Updated static orders cache for user 11 with 0 open orders and 0 pending orders
2025-07-11 00:09:43,191 - INFO - orders - User 11: Updated balance/margin cache after static orders update - balance=99998.61000000, margin=0.0
2025-07-11 00:09:44,158 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:45,494 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:46,360 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:48,636 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:09:53,233 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:00,159 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:02,503 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:07,078 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:08,764 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-11 00:10:09,354 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:16,007 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:16,717 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:18,546 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:25,624 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:26,222 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:27,700 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:32,357 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:34,634 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:36,955 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:39,235 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:41,586 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:43,839 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:48,457 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:50,742 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:53,064 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:55,391 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:10:57,712 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:00,026 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:04,594 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:06,986 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:16,618 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-11 00:11:17,793 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-11 00:11:17,793 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-11 00:11:17,793 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-11 00:11:17,793 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-11 00:11:21,871 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-11 00:11:21,871 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-11 00:11:22,793 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-11 00:11:27,796 - INFO - orders - Starting the users with orders cache updater task.
2025-07-11 00:11:32,714 - INFO - orders - Starting update_user_static_orders for user 5, user_type live
2025-07-11 00:11:32,714 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:32,743 - INFO - orders - Fetched 0 open orders for user 5
2025-07-11 00:11:32,778 - INFO - orders - Fetched 0 pending orders for user 5
2025-07-11 00:11:32,779 - INFO - orders - Updated static orders cache for user 5 with 0 open orders and 0 pending orders
2025-07-11 00:11:32,865 - WARNING - orders - User 5: Could not get user data for balance/margin cache update
2025-07-11 00:11:32,869 - INFO - orders - Starting update_user_static_orders for user 8, user_type live
2025-07-11 00:11:32,869 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:32,936 - INFO - orders - Fetched 0 open orders for user 8
2025-07-11 00:11:32,975 - INFO - orders - Fetched 0 pending orders for user 8
2025-07-11 00:11:32,975 - INFO - orders - Updated static orders cache for user 8 with 0 open orders and 0 pending orders
2025-07-11 00:11:33,011 - INFO - orders - User 8: Updated balance/margin cache after static orders update - balance=0E-8, margin=0.0
2025-07-11 00:11:33,016 - INFO - orders - Starting update_user_static_orders for user 12, user_type live
2025-07-11 00:11:33,016 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,051 - INFO - orders - Fetched 0 open orders for user 12
2025-07-11 00:11:33,085 - INFO - orders - Fetched 0 pending orders for user 12
2025-07-11 00:11:33,087 - INFO - orders - Updated static orders cache for user 12 with 0 open orders and 0 pending orders
2025-07-11 00:11:33,129 - INFO - orders - User 12: Updated balance/margin cache after static orders update - balance=0E-8, margin=0.0
2025-07-11 00:11:33,129 - INFO - orders - Starting update_user_static_orders for user 13, user_type live
2025-07-11 00:11:33,129 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,169 - INFO - orders - Fetched 2 open orders for user 13
2025-07-11 00:11:33,205 - INFO - orders - Fetched 0 pending orders for user 13
2025-07-11 00:11:33,207 - INFO - orders - Updated static orders cache for user 13 with 2 open orders and 0 pending orders
2025-07-11 00:11:33,246 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 13, Symbol XAGUSD
2025-07-11 00:11:33,246 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=False
2025-07-11 00:11:33,246 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1842'), Decimal('1843')], HighestMarginPerLot=1843
2025-07-11 00:11:33,246 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=36.86
2025-07-11 00:11:33,246 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 36.86
2025-07-11 00:11:33,247 - INFO - orders - User 13: Updated balance/margin cache after static orders update - balance=148.15000000, margin=36.86
2025-07-11 00:11:33,248 - INFO - orders - Starting update_user_static_orders for user 16, user_type live
2025-07-11 00:11:33,248 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,283 - INFO - orders - Fetched 0 open orders for user 16
2025-07-11 00:11:33,321 - INFO - orders - Fetched 0 pending orders for user 16
2025-07-11 00:11:33,322 - INFO - orders - Updated static orders cache for user 16 with 0 open orders and 0 pending orders
2025-07-11 00:11:33,356 - INFO - orders - User 16: Updated balance/margin cache after static orders update - balance=0E-8, margin=0.0
2025-07-11 00:11:33,357 - INFO - orders - Starting update_user_static_orders for user 17, user_type live
2025-07-11 00:11:33,357 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,389 - INFO - orders - Fetched 1 open orders for user 17
2025-07-11 00:11:33,424 - INFO - orders - Fetched 0 pending orders for user 17
2025-07-11 00:11:33,425 - INFO - orders - Updated static orders cache for user 17 with 1 open orders and 0 pending orders
2025-07-11 00:11:33,459 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-11 00:11:33,459 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-11 00:11:33,459 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-11 00:11:33,459 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-11 00:11:33,459 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-11 00:11:33,460 - INFO - orders - User 17: Updated balance/margin cache after static orders update - balance=26302.98000000, margin=293.63
2025-07-11 00:11:33,461 - INFO - orders - Starting update_user_static_orders for user 18, user_type live
2025-07-11 00:11:33,461 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,493 - INFO - orders - Fetched 1 open orders for user 18
2025-07-11 00:11:33,529 - INFO - orders - Fetched 0 pending orders for user 18
2025-07-11 00:11:33,530 - INFO - orders - Updated static orders cache for user 18 with 1 open orders and 0 pending orders
2025-07-11 00:11:33,563 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 18, Symbol XAGUSD
2025-07-11 00:11:33,563 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-11 00:11:33,563 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 18, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1827.44')], HighestMarginPerLot=1827.44
2025-07-11 00:11:33,563 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 18, Symbol XAGUSD: CalculatedTotalMargin=456.86
2025-07-11 00:11:33,563 - INFO - orders - [TOTAL_USER_MARGIN] User 18 total margin across all symbols: 456.86
2025-07-11 00:11:33,565 - INFO - orders - User 18: Updated balance/margin cache after static orders update - balance=15000.00000000, margin=456.86
2025-07-11 00:11:33,565 - INFO - orders - Starting update_user_static_orders for user 19, user_type live
2025-07-11 00:11:33,565 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,598 - INFO - orders - Fetched 0 open orders for user 19
2025-07-11 00:11:33,633 - INFO - orders - Fetched 0 pending orders for user 19
2025-07-11 00:11:33,634 - INFO - orders - Updated static orders cache for user 19 with 0 open orders and 0 pending orders
2025-07-11 00:11:33,679 - INFO - orders - User 19: Updated balance/margin cache after static orders update - balance=9616.06000000, margin=0.0
2025-07-11 00:11:33,680 - INFO - orders - Starting update_user_static_orders for user 20, user_type live
2025-07-11 00:11:33,680 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,711 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:33,713 - INFO - orders - Fetched 3 open orders for user 20
2025-07-11 00:11:33,750 - INFO - orders - Fetched 0 pending orders for user 20
2025-07-11 00:11:33,752 - INFO - orders - Updated static orders cache for user 20 with 3 open orders and 0 pending orders
2025-07-11 00:11:33,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-11 00:11:33,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:11:33,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-11 00:11:33,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-11 00:11:33,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 20, Symbol EURUSD
2025-07-11 00:11:33,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=1.01000000, TotalSellQty=0, NetQty=1.01000000, IsHedged=False
2025-07-11 00:11:33,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180'), Decimal('1181.89')], HighestMarginPerLot=1181.89
2025-07-11 00:11:33,789 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=1193.71
2025-07-11 00:11:33,789 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 1200.29
2025-07-11 00:11:33,791 - INFO - orders - User 20: Updated balance/margin cache after static orders update - balance=10000.00000000, margin=1200.29
2025-07-11 00:11:33,791 - INFO - orders - Starting update_user_static_orders for user 21, user_type live
2025-07-11 00:11:33,791 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,829 - INFO - orders - Fetched 0 open orders for user 21
2025-07-11 00:11:33,863 - INFO - orders - Fetched 0 pending orders for user 21
2025-07-11 00:11:33,865 - INFO - orders - Updated static orders cache for user 21 with 0 open orders and 0 pending orders
2025-07-11 00:11:33,901 - INFO - orders - User 21: Updated balance/margin cache after static orders update - balance=0E-8, margin=0.0
2025-07-11 00:11:33,901 - INFO - orders - Starting update_user_static_orders for user 22, user_type live
2025-07-11 00:11:33,901 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:33,935 - INFO - orders - Fetched 2 open orders for user 22
2025-07-11 00:11:33,974 - INFO - orders - Fetched 2 pending orders for user 22
2025-07-11 00:11:33,975 - INFO - orders - Updated static orders cache for user 22 with 2 open orders and 2 pending orders
2025-07-11 00:11:34,007 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 22, Symbol AUDJPY
2025-07-11 00:11:34,007 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-11 00:11:34,007 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96723'), Decimal('96712')], HighestMarginPerLot=96723
2025-07-11 00:11:34,007 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 22, Symbol AUDJPY: CalculatedTotalMargin=967.23
2025-07-11 00:11:34,007 - INFO - orders - [TOTAL_USER_MARGIN] User 22 total margin across all symbols: 967.23
2025-07-11 00:11:34,008 - INFO - orders - User 22: Updated balance/margin cache after static orders update - balance=2000.00000000, margin=967.23
2025-07-11 00:11:34,009 - INFO - orders - Starting update_user_static_orders for user 23, user_type live
2025-07-11 00:11:34,009 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:34,044 - INFO - orders - Fetched 0 open orders for user 23
2025-07-11 00:11:34,078 - INFO - orders - Fetched 0 pending orders for user 23
2025-07-11 00:11:34,078 - INFO - orders - Updated static orders cache for user 23 with 0 open orders and 0 pending orders
2025-07-11 00:11:34,120 - INFO - orders - User 23: Updated balance/margin cache after static orders update - balance=1000000.00000000, margin=0.0
2025-07-11 00:11:34,133 - INFO - orders - Starting update_user_static_orders for user 24, user_type live
2025-07-11 00:11:34,133 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:34,182 - INFO - orders - Fetched 0 open orders for user 24
2025-07-11 00:11:34,217 - INFO - orders - Fetched 0 pending orders for user 24
2025-07-11 00:11:34,217 - INFO - orders - Updated static orders cache for user 24 with 0 open orders and 0 pending orders
2025-07-11 00:11:34,260 - INFO - orders - User 24: Updated balance/margin cache after static orders update - balance=500000.00000000, margin=0.0
2025-07-11 00:11:34,260 - INFO - orders - Starting update_user_static_orders for user 25, user_type live
2025-07-11 00:11:34,260 - INFO - orders - Using order model: UserOrder
2025-07-11 00:11:34,293 - INFO - orders - Fetched 0 open orders for user 25
2025-07-11 00:11:34,329 - INFO - orders - Fetched 0 pending orders for user 25
2025-07-11 00:11:34,330 - INFO - orders - Updated static orders cache for user 25 with 0 open orders and 0 pending orders
2025-07-11 00:11:34,365 - INFO - orders - User 25: Updated balance/margin cache after static orders update - balance=250000.00000000, margin=0.0
2025-07-11 00:11:34,366 - INFO - orders - Starting update_user_static_orders for user 1, user_type demo
2025-07-11 00:11:34,366 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:11:34,403 - INFO - orders - Fetched 1 open orders for user 1
2025-07-11 00:11:34,441 - INFO - orders - Fetched 0 pending orders for user 1
2025-07-11 00:11:34,441 - INFO - orders - Updated static orders cache for user 1 with 1 open orders and 0 pending orders
2025-07-11 00:11:34,475 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 1, Symbol USDZAR
2025-07-11 00:11:34,475 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol USDZAR: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-11 00:11:34,475 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol USDZAR: AllMarginsPerLot=[Decimal('17782')], HighestMarginPerLot=17782
2025-07-11 00:11:34,475 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol USDZAR: CalculatedTotalMargin=177.82
2025-07-11 00:11:34,475 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 177.82
2025-07-11 00:11:34,480 - INFO - orders - User 1: Updated balance/margin cache after static orders update - balance=17070.93000000, margin=177.82
2025-07-11 00:11:34,481 - INFO - orders - Starting update_user_static_orders for user 2, user_type demo
2025-07-11 00:11:34,481 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:11:34,517 - INFO - orders - Fetched 0 open orders for user 2
2025-07-11 00:11:34,553 - INFO - orders - Fetched 0 pending orders for user 2
2025-07-11 00:11:34,554 - INFO - orders - Updated static orders cache for user 2 with 0 open orders and 0 pending orders
2025-07-11 00:11:34,594 - INFO - orders - User 2: Updated balance/margin cache after static orders update - balance=100000.00000000, margin=0.0
2025-07-11 00:11:34,595 - INFO - orders - Starting update_user_static_orders for user 3, user_type demo
2025-07-11 00:11:34,595 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:11:34,647 - INFO - orders - Fetched 0 open orders for user 3
2025-07-11 00:11:34,684 - INFO - orders - Fetched 0 pending orders for user 3
2025-07-11 00:11:34,685 - INFO - orders - Updated static orders cache for user 3 with 0 open orders and 0 pending orders
2025-07-11 00:11:34,723 - INFO - orders - User 3: Updated balance/margin cache after static orders update - balance=100000.00000000, margin=0.0
2025-07-11 00:11:34,726 - INFO - orders - Starting update_user_static_orders for user 6, user_type demo
2025-07-11 00:11:34,726 - INFO - orders - Using order model: DemoUserOrder
2025-07-11 00:11:34,764 - INFO - orders - Fetched 0 open orders for user 6
2025-07-11 00:11:34,806 - INFO - orders - Fetched 0 pending orders for user 6
2025-07-11 00:11:34,808 - INFO - orders - Updated static orders cache for user 6 with 0 open orders and 0 pending orders
2025-07-11 00:11:34,829 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:34,853 - INFO - orders - User 6: Updated balance/margin cache after static orders update - balance=100000.00000000, margin=0.0
2025-07-11 00:11:35,437 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:36,089 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:36,877 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:39,206 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:40,380 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-11 00:11:43,539 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:44,018 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:46,067 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:51,007 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:53,698 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-11 00:11:55,949 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:22,304 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 21:47:23,452 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 21:47:23,466 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 21:47:23,467 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 21:47:23,467 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 21:47:27,605 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 21:47:27,605 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 21:47:28,457 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-13 21:47:33,466 - INFO - orders - Starting the users with orders cache updater task.
2025-07-13 21:47:36,590 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-13 21:47:36,591 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-13 21:47:36,591 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-13 21:47:36,591 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-13 21:47:36,591 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-13 21:47:36,592 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:36,592 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-13 21:47:36,592 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-13 21:47:36,592 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 297.78
2025-07-13 21:47:38,721 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:38,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-13 21:47:38,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-13 21:47:38,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-13 21:47:38,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-13 21:47:38,757 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-13 21:47:38,758 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:38,758 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-13 21:47:38,758 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-13 21:47:38,758 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-13 21:47:38,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDCAD
2025-07-13 21:47:38,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:38,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('900')], HighestMarginPerLot=900
2025-07-13 21:47:38,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=9.00
2025-07-13 21:47:38,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 10, Symbol AUDJPY
2025-07-13 21:47:38,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-13 21:47:38,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95777'), Decimal('658.76335'), Decimal('658.70886')], HighestMarginPerLot=95777
2025-07-13 21:47:38,796 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=1915.54
2025-07-13 21:47:38,796 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 1924.54
2025-07-13 21:47:38,810 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-13 21:47:38,831 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:38,848 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 11, Symbol AUDJPY
2025-07-13 21:47:38,848 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-13 21:47:38,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717'), Decimal('657.768094')], HighestMarginPerLot=96717
2025-07-13 21:47:38,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=1934.34
2025-07-13 21:47:38,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol CADCHF
2025-07-13 21:47:38,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol CADCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:38,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol CADCHF: AllMarginsPerLot=[Decimal('730.981298')], HighestMarginPerLot=730.981298
2025-07-13 21:47:38,849 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol CADCHF: CalculatedTotalMargin=7.31
2025-07-13 21:47:38,849 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 1941.65
2025-07-13 21:47:40,987 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-13 21:47:40,997 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 13, Symbol XAGUSD
2025-07-13 21:47:40,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:40,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1843')], HighestMarginPerLot=1843
2025-07-13 21:47:40,998 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=18.43
2025-07-13 21:47:40,998 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 18.43
2025-07-13 21:47:41,026 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:41,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-13 21:47:41,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-13 21:47:41,099 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-13 21:47:41,100 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-13 21:47:41,100 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-13 21:47:43,175 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-13 21:47:43,222 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:43,291 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-13 21:47:43,292 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:43,292 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-13 21:47:43,292 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-13 21:47:43,292 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol EURUSD
2025-07-13 21:47:43,292 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:43,292 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180')], HighestMarginPerLot=1180
2025-07-13 21:47:43,293 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=11.80
2025-07-13 21:47:43,293 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 18.38
2025-07-13 21:47:45,409 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-13 21:47:45,440 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:45,572 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-13 21:47:45,600 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:47:45,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1907')], HighestMarginPerLot=1907
2025-07-13 21:47:45,601 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.07
2025-07-13 21:47:45,601 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 62.21
2025-07-13 21:47:45,606 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:45,655 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-13 21:47:45,655 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-13 21:47:45,655 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-13 21:47:45,655 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-13 21:47:45,655 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 19.76
2025-07-13 21:47:45,868 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:45,971 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-13 21:47:45,996 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:46,073 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-13 21:47:46,096 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 21:47:59,923 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-13 21:48:00,383 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 21:48:00,383 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1907')], HighestMarginPerLot=1907
2025-07-13 21:48:00,384 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.07
2025-07-13 21:48:00,384 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 62.21
2025-07-13 21:49:54,644 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 21:49:55,662 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 21:49:55,662 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 21:49:55,662 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 21:49:55,663 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 21:49:59,725 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 21:49:59,725 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 21:50:00,664 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-13 21:50:00,836 - ERROR - orders - Error getting symbols with open orders: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-13 21:50:05,654 - INFO - orders - Starting the users with orders cache updater task.
2025-07-13 21:50:05,856 - ERROR - orders - Error getting symbols with open orders: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-13 21:52:07,551 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 21:52:08,584 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 21:52:08,597 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 21:52:08,626 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 21:52:08,627 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 21:52:12,731 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 21:52:12,732 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 21:52:13,670 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-13 21:52:13,887 - ERROR - orders - Error getting symbols with open orders: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-13 21:52:18,593 - INFO - orders - Starting the users with orders cache updater task.
2025-07-13 21:52:18,906 - ERROR - orders - Error getting symbols with open orders: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-13 21:54:43,339 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 21:54:44,324 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 21:54:44,324 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 21:54:44,324 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 21:54:44,325 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 21:54:48,390 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 21:54:48,390 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 21:55:19,309 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 21:55:20,356 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 21:55:20,356 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 21:55:20,356 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 21:55:20,356 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 21:55:24,456 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 21:55:24,457 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 21:55:54,717 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 21:55:55,720 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 21:55:55,735 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 21:55:55,735 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 21:55:55,748 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 21:55:59,872 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 21:55:59,872 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 21:56:00,756 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-13 21:56:30,089 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 21:56:31,215 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 21:56:31,215 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 21:56:31,227 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 21:56:31,227 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 21:56:35,316 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 21:56:35,316 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 21:56:36,218 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-13 21:56:36,391 - ERROR - orders - Error getting symbols with open orders: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-13 21:56:41,220 - INFO - orders - Starting the users with orders cache updater task.
2025-07-13 21:56:41,386 - ERROR - orders - Error getting symbols with open orders: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-13 21:57:35,378 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 21:57:36,548 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 21:57:36,566 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 21:57:36,588 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 21:57:36,594 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 21:57:40,687 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 21:57:40,687 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 21:57:41,552 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-13 21:57:41,850 - ERROR - orders - Error getting symbols with open orders: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-13 21:57:46,558 - INFO - orders - Starting the users with orders cache updater task.
2025-07-13 21:57:46,742 - ERROR - orders - Error getting symbols with open orders: (pymysql.err.OperationalError) (1226, "User 'u436589492_testingserver' has exceeded the 'max_user_connections' resource (current value: 50)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-13 22:03:07,270 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 22:03:08,436 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 22:03:08,450 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 22:03:08,466 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 22:03:08,479 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 22:03:12,579 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 22:03:12,580 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 22:03:13,437 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-13 22:03:18,440 - INFO - orders - Starting the users with orders cache updater task.
2025-07-13 22:03:19,685 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-13 22:03:19,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-13 22:03:19,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-13 22:03:19,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-13 22:03:19,686 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-13 22:03:19,687 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:19,687 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-13 22:03:19,687 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-13 22:03:19,687 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-13 22:03:19,688 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:19,688 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-13 22:03:19,688 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-13 22:03:19,688 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 301.07
2025-07-13 22:03:21,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-13 22:03:21,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-13 22:03:21,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-13 22:03:21,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-13 22:03:21,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-13 22:03:21,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:21,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-13 22:03:21,696 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-13 22:03:21,696 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-13 22:03:21,760 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDCAD
2025-07-13 22:03:21,760 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:21,760 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('900')], HighestMarginPerLot=900
2025-07-13 22:03:21,760 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=9.00
2025-07-13 22:03:21,760 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 10, Symbol AUDJPY
2025-07-13 22:03:21,760 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-13 22:03:21,760 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95777'), Decimal('658.76335'), Decimal('658.70886')], HighestMarginPerLot=95777
2025-07-13 22:03:21,760 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=1915.54
2025-07-13 22:03:21,760 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 1924.54
2025-07-13 22:03:21,823 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDJPY
2025-07-13 22:03:21,823 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:21,823 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717')], HighestMarginPerLot=96717
2025-07-13 22:03:21,823 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-13 22:03:21,823 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-13 22:03:21,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 13, Symbol XAGUSD
2025-07-13 22:03:21,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:21,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1843')], HighestMarginPerLot=1843
2025-07-13 22:03:21,940 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=18.43
2025-07-13 22:03:21,941 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 18.43
2025-07-13 22:03:22,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-13 22:03:22,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-13 22:03:22,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-13 22:03:22,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-13 22:03:22,343 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-13 22:03:22,778 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-13 22:03:22,778 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:22,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-13 22:03:22,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-13 22:03:22,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol EURUSD
2025-07-13 22:03:22,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:22,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180')], HighestMarginPerLot=1180
2025-07-13 22:03:22,779 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=11.80
2025-07-13 22:03:22,779 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 18.38
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1907')], HighestMarginPerLot=1907
2025-07-13 22:03:23,739 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.07
2025-07-13 22:03:23,739 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 62.21
2025-07-13 22:03:23,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-13 22:03:23,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-13 22:03:23,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-13 22:03:23,867 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-13 22:03:23,868 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 19.76
2025-07-13 22:03:46,610 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-13 22:03:53,064 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:03:53,064 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:03:53,064 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:03:53,064 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:03:53,064 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:03:53,064 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:53,064 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:03:53,065 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:03:53,065 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-13 22:03:53,065 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:03:53,065 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1907')], HighestMarginPerLot=1907
2025-07-13 22:03:53,065 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.07
2025-07-13 22:03:53,065 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 62.21
2025-07-13 22:06:51,272 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 22:07:17,719 - INFO - orders - Pending order placement request received - User ID: 26, Symbol: XAGUSD, Type: BUY_LIMIT, Quantity: 0.01
2025-07-13 22:07:17,960 - INFO - orders - Calculated contract_value for pending order: 50.0000000000 (contract_size: 5000.00000000 * quantity: 0.01)
2025-07-13 22:07:17,963 - INFO - orders - [DEBUG] User data from cache: {'id': 26, 'email': 'forworkcursor@gmail.com', 'account_number': 'XDWTP', 'group_name': 'Royal+', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('109757.17000000'), 'margin': Decimal('62.21000000'), 'user_type': 'live', 'first_name': None, 'last_name': None, 'country': 'India', 'phone_number': Decimal('918618025298')}
2025-07-13 22:07:17,964 - INFO - orders - [DEBUG] Group name: Royal+
2025-07-13 22:07:17,964 - INFO - orders - User 26 is_barclays_live_user: True (user_type: live, sending_orders_normalized: barclays)
2025-07-13 22:07:18,064 - INFO - orders - [SYMBOL_INFO] Retrieved external symbol info for XAGUSD: contract_size=5000.00000000, profit_currency=USD, digit=3.00000
2025-07-13 22:07:18,476 - INFO - orders - [MARGIN_CALC] Market data for XAGUSD: {'b': '39.0550000000', 'o': '39.0390000000'}
2025-07-13 22:07:18,476 - WARNING - orders - [MARGIN_CALC] Missing ask price for XAGUSD, using bid price with spread: bid=39.0550000000, ask=39.05890550000000
2025-07-13 22:07:18,476 - INFO - orders - [MARGIN_CALC] Using prices for XAGUSD: bid=39.0550000000, ask=39.05890550000000
2025-07-13 22:07:18,477 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: XAGUSD, Type: BUY_LIMIT, Qty: 0.01, Price: 39.05890550000000, Margin: 19.53, Commission: 0.10
2025-07-13 22:07:18,477 - INFO - orders - Calculated initial margin: 19.53, commission: 0.10 for pending order 8762343187
2025-07-13 22:07:18,660 - INFO - orders - [DEBUG][pending_order] Prepared order_data_for_internal_processing: {'order_id': '8762343187', 'order_company_name': 'XAGUSD', 'order_type': 'BUY_LIMIT', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('38.99'), 'user_type': 'live', 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1149439187', 'takeprofit_id': '1352007130', 'order_user_id': 26, 'order_status': 'PENDING_PROCESSING', 'contract_value': Decimal('50.0000000000'), 'margin': Decimal('19.53'), 'commission': Decimal('0.10'), 'open_time': None}
2025-07-13 22:07:18,660 - INFO - orders - [BARCLAYS] Setting initial order_status to PENDING_PROCESSING for Barclays user. Will be updated to PENDING after service provider confirmation.
2025-07-13 22:07:18,660 - INFO - orders - Placing PENDING order: BUY_LIMIT for user 26 at price 38.99
2025-07-13 22:07:18,662 - INFO - orders - [ENTER-CRUD] create_order called with: {'order_id': '8762343187', 'order_status': 'PENDING_PROCESSING', 'order_user_id': 26, 'order_company_name': 'XAGUSD', 'order_type': 'BUY_LIMIT', 'order_price': Decimal('38.99'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('50.0000000000'), 'margin': Decimal('19.53'), 'commission': Decimal('0.10'), 'status': 'PENDING', 'stop_loss': Decimal('0'), 'take_profit': Decimal('0'), 'stoploss_id': '1149439187', 'takeprofit_id': '1352007130', 'close_id': None}
2025-07-13 22:07:19,597 - INFO - orders - Order 8762343187 verified in database on attempt 1 before adding to Redis.
2025-07-13 22:07:19,735 - INFO - orders - Skipping Redis storage for Barclays user pending order 8762343187
2025-07-13 22:07:19,801 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:07:19,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:07:19,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:07:19,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:07:19,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:07:19,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:07:19,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:07:19,802 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:07:19,803 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-13 22:07:19,803 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:07:19,803 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1907')], HighestMarginPerLot=1907
2025-07-13 22:07:19,803 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.07
2025-07-13 22:07:19,803 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 62.21
2025-07-13 22:07:19,898 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:07:19,898 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:07:19,899 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1907')], HighestMarginPerLot=1907
2025-07-13 22:07:19,900 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.07
2025-07-13 22:07:19,900 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 62.21
2025-07-13 22:07:19,981 - INFO - orders - [PERF] TOTAL place_order: 2.2694s
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-13 22:07:20,371 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:07:20,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1907')], HighestMarginPerLot=1907
2025-07-13 22:07:20,372 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.07
2025-07-13 22:07:20,372 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 62.21
2025-07-13 22:07:20,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:07:20,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:07:20,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:07:20,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:07:20,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:07:20,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:07:20,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:07:20,725 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:07:20,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol XAGUSD
2025-07-13 22:07:20,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:07:20,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1907')], HighestMarginPerLot=1907
2025-07-13 22:07:20,726 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol XAGUSD: CalculatedTotalMargin=19.07
2025-07-13 22:07:20,726 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 62.21
2025-07-13 22:07:20,728 - INFO - orders - Background balance/margin cache updated for user 26: balance=109757.17000000, margin=62.21
2025-07-13 22:07:21,678 - INFO - orders - [BARCLAYS] barclays_push called for user 26, is_barclays_live_user=True
2025-07-13 22:21:19,441 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-13 22:21:20,450 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-13 22:21:20,450 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-13 22:21:20,450 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-13 22:21:20,450 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-13 22:21:24,544 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-13 22:21:24,544 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-13 22:21:25,459 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-13 22:21:30,465 - INFO - orders - Starting the users with orders cache updater task.
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 4, Symbol BTCUSD
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: TotalBuyQty=0.01000000, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=True
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol BTCUSD: AllMarginsPerLot=[Decimal('29445'), Decimal('29449')], HighestMarginPerLot=29449
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol BTCUSD: CalculatedTotalMargin=294.49
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDJPY
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('328.948621')], HighestMarginPerLot=328.948621
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=3.29
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol AUDCAD
2025-07-13 22:21:33,445 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:33,446 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCAD: AllMarginsPerLot=[Decimal('328.723894')], HighestMarginPerLot=328.723894
2025-07-13 22:21:33,446 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCAD: CalculatedTotalMargin=3.29
2025-07-13 22:21:33,446 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 301.07
2025-07-13 22:21:35,478 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 22:21:35,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 9, Symbol USDNOK
2025-07-13 22:21:35,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-13 22:21:35,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDNOK: AllMarginsPerLot=[Decimal('1000.10107'), Decimal('1000.144676')], HighestMarginPerLot=1000.144676
2025-07-13 22:21:35,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDNOK: CalculatedTotalMargin=20.00
2025-07-13 22:21:35,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol USDTRY
2025-07-13 22:21:35,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:35,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol USDTRY: AllMarginsPerLot=[Decimal('1000.092768')], HighestMarginPerLot=1000.092768
2025-07-13 22:21:35,895 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol USDTRY: CalculatedTotalMargin=10.00
2025-07-13 22:21:35,895 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 30.00
2025-07-13 22:21:35,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 10, Symbol AUDCAD
2025-07-13 22:21:35,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:35,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDCAD: AllMarginsPerLot=[Decimal('900')], HighestMarginPerLot=900
2025-07-13 22:21:35,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDCAD: CalculatedTotalMargin=9.00
2025-07-13 22:21:35,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 10, Symbol AUDJPY
2025-07-13 22:21:35,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-13 22:21:35,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('95777'), Decimal('658.76335'), Decimal('658.70886')], HighestMarginPerLot=95777
2025-07-13 22:21:35,986 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=1915.54
2025-07-13 22:21:35,986 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 1924.54
2025-07-13 22:21:36,053 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDJPY
2025-07-13 22:21:36,053 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:36,053 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717')], HighestMarginPerLot=96717
2025-07-13 22:21:36,053 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-13 22:21:36,053 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-13 22:21:36,189 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 13, Symbol XAGUSD
2025-07-13 22:21:36,189 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0, TotalSellQty=0.01000000, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:36,189 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1843')], HighestMarginPerLot=1843
2025-07-13 22:21:36,189 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=18.43
2025-07-13 22:21:36,189 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 18.43
2025-07-13 22:21:36,369 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 22:21:36,377 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 17, Symbol EURUSD
2025-07-13 22:21:36,377 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: TotalBuyQty=0.25000000, TotalSellQty=0, NetQty=0.25000000, IsHedged=False
2025-07-13 22:21:36,377 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 17, Symbol EURUSD: AllMarginsPerLot=[Decimal('1174.52')], HighestMarginPerLot=1174.52
2025-07-13 22:21:36,377 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 17, Symbol EURUSD: CalculatedTotalMargin=293.63
2025-07-13 22:21:36,377 - INFO - orders - [TOTAL_USER_MARGIN] User 17 total margin across all symbols: 293.63
2025-07-13 22:21:36,633 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-13 22:21:36,633 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:36,633 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-13 22:21:36,633 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-13 22:21:36,633 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol EURUSD
2025-07-13 22:21:36,633 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:36,633 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180')], HighestMarginPerLot=1180
2025-07-13 22:21:36,633 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=11.80
2025-07-13 22:21:36,633 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 18.38
2025-07-13 22:21:37,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 1, Symbol AUDJPY
2025-07-13 22:21:37,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-13 22:21:37,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 1, Symbol AUDJPY: AllMarginsPerLot=[Decimal('658.782104'), Decimal('658.74124'), Decimal('658.74124')], HighestMarginPerLot=658.782104
2025-07-13 22:21:37,199 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 1, Symbol AUDJPY: CalculatedTotalMargin=19.76
2025-07-13 22:21:37,199 - INFO - orders - [TOTAL_USER_MARGIN] User 1 total margin across all symbols: 19.76
2025-07-13 22:21:37,228 - WARNING - orders - [SLTP_CHECK] No adjusted price available for AUDJPY in group Group B
2025-07-13 22:21:39,893 - WARNING - orders - [SLTP_CHECK] No adjusted price available for CADCHF in group Royal+
2025-07-13 22:21:44,007 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:21:44,008 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:21:44,008 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:21:44,008 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:21:44,008 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:21:44,008 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:21:44,008 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:21:44,008 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:21:44,008 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 43.14
2025-07-13 22:22:21,697 - INFO - orders - [get_rejected_orders] user_type: live
2025-07-13 22:22:26,159 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:22:26,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:22:26,160 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:22:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:22:26,161 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:22:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:22:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:22:26,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:22:26,162 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 43.14
2025-07-13 22:22:36,407 - INFO - orders - Order placement request received - User: 26, Symbol: AUDSGD, Type: BUY
2025-07-13 22:22:36,857 - INFO - orders - [MARGIN_CALC] Market data for AUDSGD: {'b': '1.0000000000', 'o': '1.0000000000'}
2025-07-13 22:22:36,857 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDSGD, using bid price with spread: bid=1.0000000000, ask=1.00010000000000
2025-07-13 22:22:36,857 - INFO - orders - [MARGIN_CALC] Using prices for AUDSGD: bid=1.0000000000, ask=1.00010000000000
2025-07-13 22:22:36,860 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 10.00 SGD to USD for margin_calculation (user_id: 26, position: None)
2025-07-13 22:22:36,860 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: SGDUSD
2025-07-13 22:22:36,862 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-13 22:22:36,862 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for SGDUSD, trying inverse
2025-07-13 22:22:36,863 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDSGD
2025-07-13 22:22:36,863 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.2814900000'), 'o': Decimal('1.2814400000')}
2025-07-13 22:22:36,863 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.2814900000
2025-07-13 22:22:36,864 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 10.00 SGD / 1.2814900000 = 7.803416335671757095256303210 USD
2025-07-13 22:22:36,864 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDSGD, Type: BUY, Qty: 0.01, Price: 1.00010000000000, Margin: 7.803416335671757095256303210, Commission: 0.10
2025-07-13 22:22:36,864 - INFO - orders - [HEDGING_MARGIN_DEBUG] Starting hedging calculation for User: 26, Symbol: AUDSGD, OrderType: BUY, Quantity: 0.01, FullMargin: 7.803416335671757095256303210
2025-07-13 22:22:36,864 - INFO - orders - [HEDGING_MARGIN_DEBUG] Existing open orders count: 0
2025-07-13 22:22:36,864 - INFO - orders - [HEDGING_MARGIN_DEBUG] Created simulated order: Type=BUY, Qty=0.01, Margin=7.803416335671757095256303210
2025-07-13 22:22:36,864 - INFO - orders - [HEDGING_MARGIN_DEBUG] About to calculate margin before and after for 0 existing orders + 1 new order
2025-07-13 22:22:36,864 - INFO - orders - [HEDGING_MARGIN_DEBUG] Executing margin calculation tasks...
2025-07-13 22:22:36,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 26, Symbol AUDSGD. Returning zero margin.
2025-07-13 22:22:36,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDSGD
2025-07-13 22:22:36,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-13 22:22:36,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDSGD: AllMarginsPerLot=[Decimal('780.3416335671757095256303210')], HighestMarginPerLot=780.3416335671757095256303210
2025-07-13 22:22:36,864 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDSGD: CalculatedTotalMargin=7.80
2025-07-13 22:22:36,866 - INFO - orders - [HEDGING_MARGIN_DEBUG] Margin calculation tasks completed
2025-07-13 22:22:36,866 - INFO - orders - [HEDGING_MARGIN_DEBUG] User: 26, Symbol: AUDSGD, OrderType: BUY, MarginBefore: 0.0, MarginAfter: 7.80, AdditionalMargin: 7.80, OpenOrders: 0
2025-07-13 22:22:36,866 - INFO - orders - [HEDGING_MARGIN_DEBUG] Simulated order: Type=BUY, Qty=0.01, Margin=7.803416335671757095256303210
2025-07-13 22:22:36,867 - INFO - orders - [PERF] Order processing: 0.4555s
2025-07-13 22:22:37,060 - INFO - orders - [PERF] Order creation: 0.1934s
2025-07-13 22:22:37,060 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-13 22:22:37,060 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-13 22:22:37,060 - INFO - orders - [PERF] TOTAL place_order: 0.6552s
2025-07-13 22:22:37,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:22:37,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:22:37,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:22:37,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:22:37,285 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:22:37,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:22:37,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:22:37,286 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:22:37,286 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 43.14
2025-07-13 22:22:37,537 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 5 positions for User 26, Symbol CADCHF
2025-07-13 22:22:37,537 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: TotalBuyQty=0.05000000, TotalSellQty=0, NetQty=0.05000000, IsHedged=False
2025-07-13 22:22:37,537 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.128224'), Decimal('731.119039'), Decimal('731.128224'), Decimal('731.155779'), Decimal('730.715147')], HighestMarginPerLot=731.155779
2025-07-13 22:22:37,537 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol CADCHF: CalculatedTotalMargin=36.56
2025-07-13 22:22:37,537 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 26, Symbol AUDJPY
2025-07-13 22:22:37,537 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-13 22:22:37,537 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.928141')], HighestMarginPerLot=657.928141
2025-07-13 22:22:37,538 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=6.58
2025-07-13 22:22:37,538 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 43.14
2025-07-13 22:22:37,542 - INFO - orders - Background balance/margin cache updated for user 26: balance=109799.72000000, margin=43.14
2025-07-13 22:22:38,622 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-13 22:22:38,939 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 26
