2025-07-14 23:07:24,094 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:07:24,137 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:07:24,151 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:07:24,151 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:07:24,731 - INFO - app - Application starting up - Trading system initialized
2025-07-14 23:07:24,731 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 23:07:24,731 - INFO - app - Environment: PRODUCTION
2025-07-14 23:07:24,819 - INFO - app - Application startup initiated
2025-07-14 23:07:24,819 - INFO - app - Initializing core services...
2025-07-14 23:07:24,870 - INFO - app - Firebase initialized
2025-07-14 23:07:24,870 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 23:07:26,921 - INFO - app - Redis initialized
2025-07-14 23:07:26,955 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 23:07:26,958 - INFO - app - Scheduler initialized
2025-07-14 23:07:26,962 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:07:26,965 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 23:07:28,121 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:07:28,146 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:07:32,236 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 23:07:32,236 - INFO - app - Background tasks initialized
2025-07-14 23:07:32,932 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 23:07:32,932 - INFO - app - Application startup completed successfully
2025-07-14 23:07:32,933 - INFO - app - Starting cache validation task
2025-07-14 23:07:32,936 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 23:07:32,938 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 23:07:32,957 - INFO - app - Validating cache for 31 users
2025-07-14 23:07:35,017 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:07:37,045 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:07:41,100 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:07:43,135 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:07:45,153 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:07:45,160 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:07:45,170 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:07:45,180 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:07:45,184 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:07:45,188 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:07:45,199 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:07:45,204 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:07:45,208 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:07:45,215 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:07:45,219 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:07:45,223 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:07:45,233 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:07:45,236 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:07:45,242 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:07:45,247 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:07:45,251 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:07:45,251 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:07:47,940 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:07:49,389 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 23:07:49,391 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:07:49,397 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:07:49,403 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:07:49,408 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:07:49,412 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:07:49,418 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:07:49,421 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:07:49,421 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 23:07:49,428 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:07:49,431 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:07:49,434 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:07:49,437 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:07:49,439 - INFO - app - Cache validation completed
2025-07-14 23:07:49,439 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:07:49,445 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:07:51,473 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:07:51,480 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:07:51,487 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:07:51,504 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:07:51,508 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:07:51,515 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:07:51,517 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:07:51,523 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:07:51,523 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:07:53,274 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:07:53,315 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:07:53,323 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:07:53,344 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:07:53,360 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:07:53,397 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:07:53,418 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:07:53,609 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:07:53,635 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:07:53,639 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:07:53,639 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:07:53,657 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:07:53,657 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:07:53,669 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:07:53,696 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:07:53,696 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:07:53,703 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:07:53,715 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:07:53,730 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:07:53,730 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:07:53,744 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:07:53,747 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:07:53,747 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:07:53,747 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:07:53,766 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:07:53,766 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:07:53,770 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:07:53,771 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:08:27,408 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.471229684889930073817989755% which is below threshold 100.0%
2025-07-14 23:08:27,469 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000060-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:08:27.469029', 'account_type': 'live'}
2025-07-14 23:08:27,844 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:08:27,956 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:08:27,965 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:08:29,293 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.31080994456272395292142573% which is below threshold 100.0%
2025-07-14 23:08:29,789 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:08:29,810 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:08:29,857 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:08:29,859 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:08:53,153 - INFO - app - Application shutdown initiated
2025-07-14 23:08:53,154 - INFO - app - Scheduler shutdown completed
2025-07-14 23:08:53,154 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 23:08:55,427 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 23:08:55,428 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 23:08:55,451 - INFO - app - Redis connection closed
2025-07-14 23:08:55,451 - INFO - app - Application shutdown completed
2025-07-14 23:11:38,638 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:11:38,661 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:11:38,675 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:11:38,676 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:11:38,949 - INFO - app - Application starting up - Trading system initialized
2025-07-14 23:11:38,949 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 23:11:38,949 - INFO - app - Environment: PRODUCTION
2025-07-14 23:11:39,002 - INFO - app - Application startup initiated
2025-07-14 23:11:39,002 - INFO - app - Initializing core services...
2025-07-14 23:11:39,039 - INFO - app - Firebase initialized
2025-07-14 23:11:39,040 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 23:11:41,095 - INFO - app - Redis initialized
2025-07-14 23:11:41,100 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 23:11:41,102 - INFO - app - Scheduler initialized
2025-07-14 23:11:41,105 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:11:41,107 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 23:11:42,281 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:11:42,299 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:11:46,372 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 23:11:46,372 - INFO - app - Background tasks initialized
2025-07-14 23:11:47,496 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 23:11:47,497 - INFO - app - Application startup completed successfully
2025-07-14 23:11:47,497 - INFO - app - Starting cache validation task
2025-07-14 23:11:47,501 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 23:11:47,502 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 23:11:47,531 - INFO - app - Validating cache for 31 users
2025-07-14 23:11:49,536 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:11:53,617 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:11:55,655 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:11:55,660 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:11:55,664 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:11:55,673 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:11:55,675 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 23:11:55,680 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:11:55,685 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:11:55,703 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:11:55,707 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:11:55,711 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:11:55,715 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 23:11:55,718 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:11:55,722 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:11:55,727 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:11:55,733 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:11:55,738 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:11:55,742 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:11:57,781 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 23:11:57,813 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:11:57,828 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:11:57,845 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:11:57,866 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:11:57,877 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:11:57,877 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:11:57,886 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 23:11:59,999 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 23:12:00,061 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 23:12:02,177 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 23:12:02,206 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 23:12:02,501 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:12:04,281 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:12:04,296 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:12:04,302 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:12:04,317 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:12:04,332 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 23:12:04,333 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:12:04,348 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:12:04,356 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:12:04,374 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:12:04,383 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:12:04,389 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:12:04,393 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 23:12:04,414 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:12:04,429 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:12:04,438 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:12:04,445 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:12:04,460 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:12:04,465 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 23:12:04,469 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:12:04,492 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:12:04,503 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:12:04,511 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:12:04,518 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:12:04,524 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 23:12:04,531 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:12:04,531 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:12:04,592 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 23:12:04,653 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 23:12:06,737 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 23:12:06,771 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 23:12:06,871 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 23:12:06,913 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 23:12:06,941 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 23:12:06,961 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:12:06,974 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 23:12:07,002 - INFO - app - Cache validation completed
2025-07-14 23:12:08,272 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:12:08,311 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:12:08,340 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:12:08,341 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:12:08,390 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:12:08,397 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:12:08,534 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:12:08,567 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:12:08,567 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:12:08,615 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:12:08,625 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:12:08,632 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:12:08,632 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:12:08,638 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:12:08,646 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:12:08,646 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:12:08,650 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:12:08,658 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:12:08,659 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:12:08,664 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:12:08,665 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:12:08,668 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:12:08,668 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:12:08,681 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:12:08,681 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:12:08,687 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:12:08,687 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:12:41,564 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.362486511348157582833589839% which is below threshold 100.0%
2025-07-14 23:12:41,654 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000061-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:12:41.654127', 'account_type': 'live'}
2025-07-14 23:12:41,970 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:12:42,102 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:12:42,124 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:12:42,940 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.21772840492920491844630356% which is below threshold 100.0%
2025-07-14 23:12:43,416 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:12:43,454 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:12:43,516 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:12:43,519 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:13:41,565 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.504739665860506490979345620% which is below threshold 100.0%
2025-07-14 23:13:41,614 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000062-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:13:41.614497', 'account_type': 'live'}
2025-07-14 23:13:41,988 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:13:42,091 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:13:42,093 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:13:42,693 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.39255239821668467653943111% which is below threshold 100.0%
2025-07-14 23:13:43,103 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:13:43,109 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:13:43,124 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:13:43,124 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:14:41,572 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.893389739274152584135071000% which is below threshold 100.0%
2025-07-14 23:14:41,631 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000063-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:14:41.631815', 'account_type': 'live'}
2025-07-14 23:14:41,927 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:14:42,139 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:14:42,155 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:14:43,208 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.88039250850277848566472610% which is below threshold 100.0%
2025-07-14 23:14:43,724 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:14:43,733 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:14:43,769 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:14:43,770 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:15:16,211 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 4
2025-07-14 23:15:16,212 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 4
2025-07-14 23:15:16,215 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 4 using refresh token.
2025-07-14 23:15:27,151 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 4 by invalidating refresh token.
2025-07-14 23:15:37,262 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-14 23:15:37,262 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-14 23:15:41,476 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.729782185123691253288451187% which is below threshold 100.0%
2025-07-14 23:15:41,497 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000064-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:15:41.497903', 'account_type': 'live'}
2025-07-14 23:15:41,884 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:15:41,933 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:15:41,940 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:15:42,701 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.67648010741343416814082749% which is below threshold 100.0%
2025-07-14 23:15:43,231 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:15:43,249 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:15:43,286 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:15:43,287 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:15:53,372 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000065-001', 'user_id': '14', 'order_company_name': 'AUDCHF', 'order_type': 'BUY', 'order_quantity': '10.0', 'price': '0.5220899999999999', 'status': 'OPEN', 'contract_value': '1000000.0', 'account_type': 'live', 'timestamp': '2025-07-15T06:15:53.372889'}
2025-07-14 23:15:53,763 - INFO - app.core.firebase - Order data (ID: 1000065-001) sent to Firebase successfully.
2025-07-14 23:16:36,841 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000066-001', 'user_id': '14', 'order_company_name': 'AUDCHF', 'order_type': 'BUY', 'order_quantity': '10.0', 'price': '0.5220899999999999', 'status': 'OPEN', 'contract_value': '1000000.0', 'account_type': 'live', 'timestamp': '2025-07-15T06:16:36.841050'}
2025-07-14 23:16:37,181 - INFO - app.core.firebase - Order data (ID: 1000066-001) sent to Firebase successfully.
2025-07-14 23:16:41,584 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.623667245383532598944157613% which is below threshold 100.0%
2025-07-14 23:16:41,638 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000067-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:16:41.638878', 'account_type': 'live'}
2025-07-14 23:16:41,992 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:16:42,088 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:16:42,095 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:16:43,119 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.54407699328126708585558592% which is below threshold 100.0%
2025-07-14 23:16:43,640 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:16:43,647 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:16:43,658 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:16:43,659 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:16:47,434 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000068-001', 'order_company_name': 'AUDCHF', 'order_price': '0.51', 'contract_value': '1000000.0', 'order_quantity': '10.0', 'order_type': 'BUY_LIMIT', 'order_status': 'PENDING-PROCESSING', 'status': 'PENDING', 'action': 'place_pending_order', 'account_type': 'live', 'timestamp': '2025-07-15T06:16:47.434455'}
2025-07-14 23:16:47,828 - INFO - app.core.firebase - Order data (ID: 1000068-001) sent to Firebase successfully.
2025-07-14 23:16:56,697 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000071-001', 'order_company_name': 'AUDCHF', 'order_price': '0.51', 'contract_value': '1000000.0', 'order_quantity': '10.0', 'order_type': 'SELL_STOP', 'order_status': 'PENDING-PROCESSING', 'status': 'PENDING', 'action': 'place_pending_order', 'account_type': 'live', 'timestamp': '2025-07-15T06:16:56.697778'}
2025-07-14 23:16:57,028 - INFO - app.core.firebase - Order data (ID: 1000071-001) sent to Firebase successfully.
2025-07-14 23:17:04,004 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000074-001', 'user_id': '14', 'order_company_name': 'AUDCHF', 'order_type': 'BUY', 'order_quantity': '10.0', 'price': '0.52203', 'status': 'OPEN', 'contract_value': '1000000.0', 'account_type': 'live', 'timestamp': '2025-07-15T06:17:04.004564'}
2025-07-14 23:17:04,300 - INFO - app.core.firebase - Order data (ID: 1000074-001) sent to Firebase successfully.
2025-07-14 23:17:07,005 - INFO - app - Starting cache validation task
2025-07-14 23:17:07,014 - INFO - app - Validating cache for 31 users
2025-07-14 23:17:07,017 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,021 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,029 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,038 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,046 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,054 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,062 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,072 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,080 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,088 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,100 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,108 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,117 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,125 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,135 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,143 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,152 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,160 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,170 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,181 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,189 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,199 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,207 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 23:17:07,222 - INFO - app - Cache validation completed
2025-07-14 23:17:15,184 - INFO - app - Application shutdown initiated
2025-07-14 23:17:15,185 - INFO - app - Scheduler shutdown completed
2025-07-14 23:17:15,187 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 23:17:17,324 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 23:17:17,324 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 23:17:17,346 - INFO - app - Redis connection closed
2025-07-14 23:17:17,346 - INFO - app - Application shutdown completed
2025-07-14 23:31:33,534 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:31:33,609 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:31:33,649 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:31:33,649 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:31:34,227 - INFO - app - Application starting up - Trading system initialized
2025-07-14 23:31:34,228 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 23:31:34,228 - INFO - app - Environment: DEVELOPMENT
2025-07-14 23:31:34,326 - INFO - app - Application startup initiated
2025-07-14 23:31:34,327 - INFO - app - Initializing core services...
2025-07-14 23:31:34,412 - INFO - app - Firebase initialized
2025-07-14 23:31:34,412 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 23:31:36,444 - INFO - app - Redis initialized
2025-07-14 23:31:36,481 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 23:31:36,484 - INFO - app - Scheduler initialized
2025-07-14 23:31:36,489 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:31:36,490 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 23:31:37,784 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:31:37,803 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:31:41,909 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 23:31:41,909 - INFO - app - Background tasks initialized
2025-07-14 23:31:42,791 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 23:31:42,791 - INFO - app - Application startup completed successfully
2025-07-14 23:31:42,792 - INFO - app - Starting cache validation task
2025-07-14 23:31:42,797 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 23:31:42,800 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 23:31:42,884 - INFO - app - Validating cache for 31 users
2025-07-14 23:31:44,834 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:31:46,883 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-14 23:31:48,921 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:31:48,944 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:31:50,982 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:31:50,994 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:31:51,005 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:31:51,028 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:31:51,043 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:31:51,048 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:31:51,061 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:31:51,067 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 23:31:51,074 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:31:51,099 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:31:51,105 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:31:51,114 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:31:51,120 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:31:51,124 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:31:51,126 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 23:31:51,128 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:31:51,148 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:31:51,155 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:31:51,162 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:31:51,168 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:31:51,174 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 23:31:51,174 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:31:51,174 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:31:51,248 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 23:31:51,315 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 23:31:53,390 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 23:31:53,446 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 23:31:55,527 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 23:31:57,640 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 23:31:57,680 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 23:31:57,799 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:31:59,717 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:31:59,728 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:31:59,734 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:31:59,743 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:31:59,749 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:31:59,752 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 23:31:59,753 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:31:59,757 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:31:59,765 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:31:59,768 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:31:59,771 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:31:59,779 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:31:59,781 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 23:31:59,789 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:31:59,799 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:31:59,804 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:31:59,817 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:32:01,845 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:32:01,864 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 23:32:01,872 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:32:01,883 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:32:01,892 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:32:01,897 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:32:01,903 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:32:01,903 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:32:01,920 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,018 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,056 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,089 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,121 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,165 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,197 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,220 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,231 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 23:32:02,260 - INFO - app - Cache validation completed
2025-07-14 23:32:04,097 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:32:04,135 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:32:04,157 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:32:04,179 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:32:04,189 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:32:04,236 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:32:04,242 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:32:04,404 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:32:04,433 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:32:04,435 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:32:04,435 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:32:04,439 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:32:04,464 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:32:04,465 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:32:04,466 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:32:04,467 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:32:04,485 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:32:04,493 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:32:04,514 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:32:04,514 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:32:04,514 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:32:04,514 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:32:04,529 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:32:04,537 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:32:04,547 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:32:04,547 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:32:04,558 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:32:04,559 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:32:37,165 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.371685329653806011073962037% which is below threshold 100.0%
2025-07-14 23:32:37,237 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000075-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:32:37.236944', 'account_type': 'live'}
2025-07-14 23:32:37,576 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:32:37,737 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:32:37,779 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:32:39,216 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.23059666325037732668862440% which is below threshold 100.0%
2025-07-14 23:32:39,768 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:32:39,788 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:32:39,838 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:32:39,839 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:33:36,888 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.371356800428604281493948744% which is below threshold 100.0%
2025-07-14 23:33:36,945 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000076-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:33:36.945294', 'account_type': 'live'}
2025-07-14 23:33:37,275 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:33:37,361 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:33:37,370 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:33:38,054 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.31958220554028696693922571% which is below threshold 100.0%
2025-07-14 23:33:38,515 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:33:38,533 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:33:38,566 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:33:38,567 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:34:37,076 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.535621413029469071500595143% which is below threshold 100.0%
2025-07-14 23:34:37,111 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000077-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:34:37.111790', 'account_type': 'live'}
2025-07-14 23:34:37,482 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:34:37,554 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:34:37,564 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:34:38,339 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.51441514585129741057191933% which is below threshold 100.0%
2025-07-14 23:34:38,760 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:34:38,810 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:34:38,841 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:34:38,843 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:35:36,978 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.622747363552967756120120393% which is below threshold 100.0%
2025-07-14 23:35:37,026 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000078-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:35:37.026740', 'account_type': 'live'}
2025-07-14 23:35:37,373 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:35:37,531 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:35:37,543 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:35:38,410 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.46027971429326262367607979% which is below threshold 100.0%
2025-07-14 23:35:38,833 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:35:38,850 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:35:38,881 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:35:38,881 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:36:36,981 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.300394487785030692211077500% which is below threshold 100.0%
2025-07-14 23:36:37,003 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000079-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:36:37.003052', 'account_type': 'live'}
2025-07-14 23:36:37,400 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:36:37,565 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:36:37,579 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:36:38,352 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.14205485400602521209244912% which is below threshold 100.0%
2025-07-14 23:36:38,837 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:36:38,887 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:36:38,937 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:36:38,938 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:37:02,271 - INFO - app - Starting cache validation task
2025-07-14 23:37:02,281 - INFO - app - Validating cache for 31 users
2025-07-14 23:37:02,284 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,290 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,300 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,309 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,321 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,334 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,347 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,357 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,366 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,376 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,386 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,397 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,409 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,422 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,434 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,449 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,460 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,471 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,480 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,491 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,507 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,517 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,530 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,540 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 23:37:02,556 - INFO - app - Cache validation completed
2025-07-14 23:37:36,989 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.052913422440567799587064035% which is below threshold 100.0%
2025-07-14 23:37:37,013 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000080-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:37:37.013416', 'account_type': 'live'}
2025-07-14 23:37:37,308 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:37:37,377 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:37:37,397 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:37:38,216 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.83377644060151905522817538% which is below threshold 100.0%
2025-07-14 23:37:38,628 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:37:38,643 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:37:38,681 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:37:38,683 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:38:36,891 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.042827575226874701480655947% which is below threshold 100.0%
2025-07-14 23:38:36,946 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000081-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:38:36.946157', 'account_type': 'live'}
2025-07-14 23:38:37,316 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:38:37,407 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:38:37,413 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:38:38,119 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.82126999537903233018489946% which is below threshold 100.0%
2025-07-14 23:38:38,600 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:38:38,620 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:38:38,660 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:38:38,661 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:39:04,590 - INFO - app - Application shutdown initiated
2025-07-14 23:39:04,590 - INFO - app - Scheduler shutdown completed
2025-07-14 23:39:04,592 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 23:39:05,568 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 23:39:05,569 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 23:39:05,616 - INFO - app - Redis connection closed
2025-07-14 23:39:05,617 - INFO - app - Application shutdown completed
2025-07-14 23:39:08,944 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:09,011 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:09,036 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:09,037 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:09,599 - INFO - app - Application starting up - Trading system initialized
2025-07-14 23:39:09,599 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 23:39:09,599 - INFO - app - Environment: DEVELOPMENT
2025-07-14 23:39:09,703 - INFO - app - Application startup initiated
2025-07-14 23:39:09,703 - INFO - app - Initializing core services...
2025-07-14 23:39:09,757 - INFO - app - Firebase initialized
2025-07-14 23:39:09,757 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 23:39:11,794 - INFO - app - Redis initialized
2025-07-14 23:39:11,800 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 23:39:11,803 - INFO - app - Scheduler initialized
2025-07-14 23:39:11,807 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:39:11,808 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 23:39:12,956 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:39:12,975 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:39:17,059 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 23:39:17,059 - INFO - app - Background tasks initialized
2025-07-14 23:39:17,792 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 23:39:17,793 - INFO - app - Application startup completed successfully
2025-07-14 23:39:17,794 - INFO - app - Starting cache validation task
2025-07-14 23:39:17,798 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 23:39:17,803 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 23:39:17,864 - INFO - app - Validating cache for 31 users
2025-07-14 23:39:19,847 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:39:21,899 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:39:23,935 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:39:25,980 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:39:26,003 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:39:26,018 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:39:26,029 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:39:26,040 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:39:26,047 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:39:26,051 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:39:26,069 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:39:26,079 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:39:26,087 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:39:26,094 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:39:26,100 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:39:26,109 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:39:26,138 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:39:26,144 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:39:26,153 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:39:26,162 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:39:26,167 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:39:26,168 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:39:32,531 - INFO - app - Cache validation completed
2025-07-14 23:39:32,795 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:39:32,797 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:39:32,799 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:39:32,800 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:39:32,801 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:39:32,802 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:39:32,803 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:39:32,804 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:39:32,806 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:39:32,807 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:39:32,808 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:39:32,810 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:39:32,810 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:39:32,811 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:39:32,812 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:39:32,813 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:39:32,814 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:39:32,816 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:39:32,817 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:39:32,818 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:39:32,819 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:39:32,819 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:39:32,820 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:39:35,229 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:35,244 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:35,260 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:35,328 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:35,335 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:35,382 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:35,421 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:35,711 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:35,718 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:35,722 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:35,743 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:35,744 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:35,750 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:35,750 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:35,758 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:35,758 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:35,788 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:35,791 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:35,828 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:35,828 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:35,838 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:35,841 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:35,841 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:35,856 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:35,866 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:35,867 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:35,889 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:35,889 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:43,389 - INFO - app - Application shutdown initiated
2025-07-14 23:39:43,390 - INFO - app - Scheduler shutdown completed
2025-07-14 23:39:43,858 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 23:39:44,784 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 23:39:44,784 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 23:39:44,786 - INFO - app - Redis connection closed
2025-07-14 23:39:44,786 - INFO - app - Application shutdown completed
2025-07-14 23:39:48,089 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:39:48,174 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:39:48,214 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:39:48,242 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:39:49,130 - INFO - app - Application starting up - Trading system initialized
2025-07-14 23:39:49,130 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 23:39:49,130 - INFO - app - Environment: DEVELOPMENT
2025-07-14 23:39:49,265 - INFO - app - Application startup initiated
2025-07-14 23:39:49,265 - INFO - app - Initializing core services...
2025-07-14 23:39:49,355 - INFO - app - Firebase initialized
2025-07-14 23:39:49,355 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 23:39:51,406 - INFO - app - Redis initialized
2025-07-14 23:39:51,411 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 23:39:51,413 - INFO - app - Scheduler initialized
2025-07-14 23:39:51,418 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:39:51,419 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 23:39:52,375 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:39:52,405 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:39:56,483 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 23:39:56,484 - INFO - app - Background tasks initialized
2025-07-14 23:39:57,174 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 23:39:57,174 - INFO - app - Application startup completed successfully
2025-07-14 23:39:57,174 - INFO - app - Starting cache validation task
2025-07-14 23:39:57,180 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 23:39:57,184 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 23:39:57,274 - INFO - app - Validating cache for 31 users
2025-07-14 23:39:59,213 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:40:03,285 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:40:03,291 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:40:05,360 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:40:05,382 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:40:05,394 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:40:05,401 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:40:05,418 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:40:05,424 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:40:05,428 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:40:05,442 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:40:05,447 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:40:05,449 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:40:05,452 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:40:05,459 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:40:05,469 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:40:05,508 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:40:05,516 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:40:05,524 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:40:05,532 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:40:05,539 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:40:05,539 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:40:09,763 - INFO - app - Cache validation completed
2025-07-14 23:40:12,175 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:40:13,938 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:40:13,946 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:40:13,955 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:40:13,962 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:40:13,970 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:40:13,974 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:40:13,978 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:40:13,984 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:40:13,988 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:40:13,991 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:40:13,997 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:40:13,998 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:40:13,999 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:40:14,001 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:40:14,003 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:40:16,029 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:40:16,053 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:40:16,062 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:40:16,067 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:40:16,074 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:40:16,077 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:40:16,077 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:40:18,393 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:18,418 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:18,432 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:18,456 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:18,477 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:18,491 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:18,531 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:18,745 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:18,751 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:18,768 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:18,769 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:18,776 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:18,781 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:18,782 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:18,800 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:18,808 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:18,809 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:18,826 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:18,831 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:18,831 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:18,834 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:18,849 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:18,850 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:18,856 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:18,856 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:18,858 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:18,881 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:18,881 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:36,969 - INFO - app - Application shutdown initiated
2025-07-14 23:40:36,969 - INFO - app - Scheduler shutdown completed
2025-07-14 23:40:37,415 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 23:40:37,827 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 23:40:37,828 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 23:40:37,837 - INFO - app - Redis connection closed
2025-07-14 23:40:37,837 - INFO - app - Application shutdown completed
2025-07-14 23:40:40,643 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:40,736 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:40,761 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:40,762 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:41,527 - INFO - app - Application starting up - Trading system initialized
2025-07-14 23:40:41,527 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 23:40:41,527 - INFO - app - Environment: DEVELOPMENT
2025-07-14 23:40:41,629 - INFO - app - Application startup initiated
2025-07-14 23:40:41,629 - INFO - app - Initializing core services...
2025-07-14 23:40:41,710 - INFO - app - Firebase initialized
2025-07-14 23:40:41,710 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 23:40:43,752 - INFO - app - Redis initialized
2025-07-14 23:40:43,757 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 23:40:43,759 - INFO - app - Scheduler initialized
2025-07-14 23:40:43,763 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:40:43,763 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 23:40:44,807 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:40:44,836 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:40:48,950 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 23:40:48,950 - INFO - app - Background tasks initialized
2025-07-14 23:40:49,600 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 23:40:49,601 - INFO - app - Application startup completed successfully
2025-07-14 23:40:49,601 - INFO - app - Starting cache validation task
2025-07-14 23:40:49,605 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 23:40:49,609 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 23:40:49,616 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 23:40:52,268 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 23:40:52,268 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 23:40:52,269 - INFO - app - Application shutdown initiated
2025-07-14 23:40:52,270 - INFO - app - Scheduler shutdown completed
2025-07-14 23:40:52,282 - INFO - app - Redis connection closed
2025-07-14 23:40:52,282 - INFO - app - Application shutdown completed
2025-07-14 23:40:55,383 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:40:55,421 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:40:55,443 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:40:55,444 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:40:55,921 - INFO - app - Application starting up - Trading system initialized
2025-07-14 23:40:55,921 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-14 23:40:55,921 - INFO - app - Environment: DEVELOPMENT
2025-07-14 23:40:56,018 - INFO - app - Application startup initiated
2025-07-14 23:40:56,018 - INFO - app - Initializing core services...
2025-07-14 23:40:56,101 - INFO - app - Firebase initialized
2025-07-14 23:40:56,101 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-14 23:40:58,154 - INFO - app - Redis initialized
2025-07-14 23:40:58,161 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-14 23:40:58,164 - INFO - app - Scheduler initialized
2025-07-14 23:40:58,171 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:40:58,172 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-14 23:40:59,134 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-14 23:40:59,146 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:41:03,247 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-14 23:41:03,247 - INFO - app - Background tasks initialized
2025-07-14 23:41:03,935 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-14 23:41:03,936 - INFO - app - Application startup completed successfully
2025-07-14 23:41:03,937 - INFO - app - Starting cache validation task
2025-07-14 23:41:03,948 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-14 23:41:03,953 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-14 23:41:04,024 - INFO - app - Validating cache for 31 users
2025-07-14 23:41:05,989 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:41:10,081 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:41:10,088 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:41:12,162 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:41:12,183 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:41:12,208 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:41:12,217 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:41:12,237 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:41:12,252 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:41:12,264 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:41:12,279 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:41:12,290 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:41:12,299 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:41:12,304 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:41:12,314 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:41:12,327 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:41:12,368 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:41:12,382 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:41:12,394 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:41:12,402 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:41:12,408 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:41:12,408 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:41:16,641 - INFO - app - Cache validation completed
2025-07-14 23:41:18,937 - INFO - app - Starting stale cache cleanup task
2025-07-14 23:41:20,807 - INFO - app - Found 24 static orders cache entries to check
2025-07-14 23:41:20,819 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-14 23:41:20,831 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-14 23:41:20,839 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-14 23:41:20,845 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-14 23:41:20,850 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-14 23:41:20,855 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-14 23:41:20,863 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-14 23:41:20,866 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-14 23:41:20,868 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-14 23:41:20,873 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-14 23:41:22,932 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-14 23:41:22,948 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-14 23:41:22,953 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-14 23:41:22,961 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-14 23:41:22,971 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-14 23:41:22,995 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-14 23:41:23,000 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-14 23:41:23,003 - WARNING - app - Found stale cache entry for user 14, will be refreshed on next access
2025-07-14 23:41:23,009 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-14 23:41:23,012 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-14 23:41:23,012 - INFO - app - Completed stale cache cleanup task
2025-07-14 23:41:25,138 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:41:25,216 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:41:25,235 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:41:25,241 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:41:25,242 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:41:25,244 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:41:25,316 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-14 23:41:25,414 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:41:25,438 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:41:25,438 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:41:25,498 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:41:25,521 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:41:25,521 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:41:25,524 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:41:25,526 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:41:25,540 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:41:25,541 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:41:25,550 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:41:25,550 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:41:25,553 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:41:25,553 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:41:25,563 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:41:25,564 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:41:25,567 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:41:25,567 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:41:25,591 - INFO - app.core.config - .env file loaded successfully.
2025-07-14 23:41:25,609 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-14 23:41:25,609 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-14 23:41:58,620 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.371356800428604281493948744% which is below threshold 100.0%
2025-07-14 23:41:58,679 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000082-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:41:58.679899', 'account_type': 'live'}
2025-07-14 23:41:59,028 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:41:59,120 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:41:59,133 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:41:59,856 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.23015293020481966450095358% which is below threshold 100.0%
2025-07-14 23:42:00,375 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:42:00,401 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:42:00,435 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:42:00,436 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:42:34,462 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-14 23:42:34,464 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-14 23:42:34,468 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-14 23:42:34,471 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-14 23:42:34,481 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-14 23:42:34,488 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-14 23:42:58,623 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.387783261688690760494613384% which is below threshold 100.0%
2025-07-14 23:42:58,675 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000083-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:42:58.675432', 'account_type': 'live'}
2025-07-14 23:42:59,032 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:42:59,140 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:42:59,152 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:43:00,261 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.23906172442716965149957535% which is below threshold 100.0%
2025-07-14 23:43:00,782 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:43:00,798 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:43:00,832 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:43:00,832 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:43:56,020 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000084-001', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '0.35', 'price': '117114.6', 'status': 'OPEN', 'contract_value': '0.35', 'account_type': 'live', 'timestamp': '2025-07-15T06:43:56.020828'}
2025-07-14 23:43:56,376 - INFO - app.core.firebase - Order data (ID: 1000084-001) sent to Firebase successfully.
2025-07-14 23:43:58,632 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.430787737267597162518353412% which is below threshold 100.0%
2025-07-14 23:43:58,700 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000085-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:43:58.700064', 'account_type': 'live'}
2025-07-14 23:43:59,037 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:43:59,161 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:43:59,176 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:44:00,335 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.31565004809042214509155817% which is below threshold 100.0%
2025-07-14 23:44:00,887 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:44:00,897 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:44:00,945 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:44:00,947 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:44:58,980 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.356572985294526450393350568% which is below threshold 100.0%
2025-07-14 23:44:59,047 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000086-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:44:59.047880', 'account_type': 'live'}
2025-07-14 23:45:00,046 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:45:00,294 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:45:00,318 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:45:02,136 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.21127720911302047923578520% which is below threshold 100.0%
2025-07-14 23:45:03,696 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:45:03,740 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:45:03,801 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:45:03,803 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:45:58,740 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.321091828972739655751914946% which is below threshold 100.0%
2025-07-14 23:45:58,799 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000087-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:45:58.799180', 'account_type': 'live'}
2025-07-14 23:45:59,150 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:45:59,275 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:45:59,294 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:46:00,073 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 64.34560889214608525711493832% which is below threshold 100.0%
2025-07-14 23:46:04,273 - INFO - app - Sent margin call warning email (HTML) to user 14 at cursordemo3@gmail.com
2025-07-14 23:46:08,060 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.16635777157810653921197244% which is below threshold 100.0%
2025-07-14 23:46:08,680 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:46:08,709 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:46:08,771 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:46:08,772 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:46:11,221 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000084-001', 'close_price': '116934.6', 'user_id': '14', 'order_type': 'BUY', 'order_company_name': 'BTCUSD', 'order_quantity': '0.35000000', 'contract_value': '0.35000000', 'order_status': 'CLOSED', 'status': 'CLOSED', 'action': 'close_order', 'close_id': '1000088-003', 'account_type': 'live', 'timestamp': '2025-07-15T06:46:11.221824'}
2025-07-14 23:46:11,542 - INFO - app.core.firebase - Order data (ID: 1000084-001) sent to Firebase successfully.
2025-07-14 23:46:16,648 - INFO - app - Starting cache validation task
2025-07-14 23:46:16,667 - INFO - app - Validating cache for 31 users
2025-07-14 23:46:16,674 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,684 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,710 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,733 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,755 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,779 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,800 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,822 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,843 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,866 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,884 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,903 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,921 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,938 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,956 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,977 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-14 23:46:16,998 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-14 23:46:17,020 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-14 23:46:17,042 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-14 23:46:17,069 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-14 23:46:17,086 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-14 23:46:17,107 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-14 23:46:17,128 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-14 23:46:17,155 - INFO - app - Cache validation completed
2025-07-14 23:46:58,851 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.152227807219050651625082448% which is below threshold 100.0%
2025-07-14 23:46:58,912 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000092-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:46:58.912830', 'account_type': 'live'}
2025-07-14 23:46:59,258 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:46:59,396 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:46:59,435 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:47:00,571 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.95616484122856163523682749% which is below threshold 100.0%
2025-07-14 23:47:01,315 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:47:01,332 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:47:01,388 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:47:01,390 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:47:22,757 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000093-001', 'order_company_name': 'BTCUSD', 'order_price': '1123.0', 'contract_value': '0.35', 'order_quantity': '0.35', 'order_type': 'BUY_LIMIT', 'order_status': 'PENDING-PROCESSING', 'status': 'PENDING', 'action': 'place_pending_order', 'account_type': 'live', 'timestamp': '2025-07-15T06:47:22.757618'}
2025-07-14 23:47:23,119 - INFO - app.core.firebase - Order data (ID: 1000093-001) sent to Firebase successfully.
2025-07-14 23:47:58,855 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.010960240382306932219366545% which is below threshold 100.0%
2025-07-14 23:47:59,008 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000096-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:47:59.008607', 'account_type': 'live'}
2025-07-14 23:47:59,311 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:47:59,437 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:47:59,481 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:48:00,809 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.82584385907939575437587343% which is below threshold 100.0%
2025-07-14 23:48:01,624 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:48:01,635 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:48:01,664 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:48:01,665 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:48:58,553 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.9445973368915575570566813999% which is below threshold 100.0%
2025-07-14 23:48:58,613 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000097-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T06:48:58.613769', 'account_type': 'live'}
2025-07-14 23:48:58,963 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-14 23:48:59,018 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-14 23:48:59,029 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-14 23:48:59,883 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.69757087560203480956035817% which is below threshold 100.0%
2025-07-14 23:49:00,337 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-14 23:49:00,409 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-14 23:49:00,455 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-14 23:49:00,456 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-14 23:49:21,534 - INFO - app - Application shutdown initiated
2025-07-14 23:49:21,535 - INFO - app - Scheduler shutdown completed
2025-07-14 23:49:21,537 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-14 23:49:23,340 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-14 23:49:23,340 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-14 23:49:23,355 - INFO - app - Redis connection closed
2025-07-14 23:49:23,355 - INFO - app - Application shutdown completed
2025-07-15 00:13:55,982 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 00:13:56,022 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 00:13:56,039 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 00:13:56,039 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 00:13:56,521 - INFO - app - Application starting up - Trading system initialized
2025-07-15 00:13:56,521 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 00:13:56,521 - INFO - app - Environment: PRODUCTION
2025-07-15 00:13:56,575 - INFO - app - Application startup initiated
2025-07-15 00:13:56,575 - INFO - app - Initializing core services...
2025-07-15 00:13:56,632 - INFO - app - Firebase initialized
2025-07-15 00:13:56,632 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 00:13:58,683 - INFO - app - Redis initialized
2025-07-15 00:13:58,698 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 00:13:58,699 - INFO - app - Scheduler initialized
2025-07-15 00:13:58,701 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 00:13:58,702 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 00:13:59,964 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 00:13:59,966 - INFO - app - Starting stale cache cleanup task
2025-07-15 00:14:04,077 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 00:14:04,077 - INFO - app - Background tasks initialized
2025-07-15 00:14:04,708 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 00:14:04,708 - INFO - app - Application startup completed successfully
2025-07-15 00:14:04,709 - INFO - app - Starting cache validation task
2025-07-15 00:14:04,712 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 00:14:04,715 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 00:14:04,741 - INFO - app - Validating cache for 31 users
2025-07-15 00:14:06,753 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 00:14:08,793 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-15 00:14:10,837 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 00:14:12,871 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 00:14:12,879 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 00:14:12,883 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 00:14:12,887 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 00:14:14,933 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 00:14:14,942 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 00:14:14,949 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 00:14:14,950 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 00:14:14,951 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 00:14:14,954 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 00:14:14,960 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 00:14:14,961 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 00:14:14,967 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 00:14:14,970 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 00:14:14,973 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 00:14:14,973 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 00:14:14,977 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 00:14:14,991 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 00:14:14,994 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 00:14:14,997 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 00:14:14,999 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 00:14:15,003 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 00:14:15,003 - INFO - app - Completed stale cache cleanup task
2025-07-15 00:14:15,015 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 00:14:19,096 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 00:14:19,116 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 00:14:19,127 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-15 00:14:19,721 - INFO - app - Starting stale cache cleanup task
2025-07-15 00:14:21,171 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 00:14:21,176 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 00:14:21,178 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 00:14:21,180 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 00:14:21,183 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 00:14:21,184 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 00:14:21,187 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 00:14:21,190 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 00:14:21,193 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 00:14:21,194 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 00:14:21,196 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 00:14:21,197 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 00:14:21,199 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 00:14:21,200 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 00:14:21,201 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 00:14:23,248 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 00:14:23,256 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 00:14:23,258 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 00:14:23,262 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,267 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 00:14:23,270 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 00:14:23,273 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 00:14:23,275 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 00:14:23,275 - INFO - app - Completed stale cache cleanup task
2025-07-15 00:14:23,279 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,294 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,308 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,319 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,332 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,345 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,352 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,388 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,405 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,422 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,429 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,437 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,444 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 00:14:23,456 - INFO - app - Cache validation completed
2025-07-15 00:14:24,718 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 00:14:24,767 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 00:14:24,786 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 00:14:24,808 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 00:14:24,816 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 00:14:24,899 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 00:14:24,931 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 00:14:24,983 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 00:14:24,999 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 00:14:24,999 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 00:14:25,032 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 00:14:25,052 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 00:14:25,052 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 00:14:25,065 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 00:14:25,079 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 00:14:25,087 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 00:14:25,087 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 00:14:25,088 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 00:14:25,102 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 00:14:25,102 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 00:14:25,107 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 00:14:25,107 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 00:14:25,150 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 00:14:25,161 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 00:14:25,162 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 00:14:25,176 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 00:14:25,187 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 00:14:25,187 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 00:14:27,668 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 00:14:27,669 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 00:14:27,670 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 00:14:27,671 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 00:14:27,676 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 00:14:27,680 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 00:14:49,876 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-15 00:14:49,877 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-15 00:14:59,085 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.689044561198676785366802880% which is below threshold 100.0%
2025-07-15 00:14:59,140 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000098-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T07:14:59.140931', 'account_type': 'live'}
2025-07-15 00:14:59,455 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 00:14:59,534 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 00:14:59,548 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 00:15:00,458 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.62504120743994213174952949% which is below threshold 100.0%
2025-07-15 00:15:00,826 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 00:15:00,837 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 00:15:00,852 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 00:15:00,853 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 00:15:02,780 - INFO - app.api.v1.endpoints.users - Logout successful for user ID 14 by invalidating refresh token.
2025-07-15 00:15:08,679 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 3 symbols for user 11
2025-07-15 00:15:08,680 - INFO - app.api.v1.endpoints.favorites - Symbols: ['AUDCAD', 'AUDCHF', 'EURGBP']
2025-07-15 00:15:59,135 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.681488389019037005026497146% which is below threshold 100.0%
2025-07-15 00:15:59,209 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000100-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T07:15:59.209003', 'account_type': 'live'}
2025-07-15 00:15:59,546 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 00:15:59,643 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 00:15:59,652 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 00:16:00,567 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.61538148037126392988963267% which is below threshold 100.0%
2025-07-15 00:16:00,986 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 00:16:01,000 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 00:16:01,018 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 00:16:01,018 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 00:16:59,072 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.381212677184656168894347528% which is below threshold 100.0%
2025-07-15 00:16:59,156 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000101-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T07:16:59.156596', 'account_type': 'live'}
2025-07-15 00:16:59,448 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 00:16:59,552 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 00:16:59,568 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 00:17:00,309 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.24261158879163077833438589% which is below threshold 100.0%
2025-07-15 00:17:00,694 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 00:17:00,714 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 00:17:00,749 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 00:17:00,750 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 00:17:04,202 - INFO - app - Application shutdown initiated
2025-07-15 00:17:04,202 - INFO - app - Scheduler shutdown completed
2025-07-15 00:17:04,507 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 00:17:06,006 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 00:17:06,006 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 00:17:06,009 - INFO - app - Redis connection closed
2025-07-15 00:17:06,009 - INFO - app - Application shutdown completed
2025-07-15 01:28:06,741 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:28:06,787 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:28:06,799 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:28:06,799 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:28:07,254 - INFO - app - Application starting up - Trading system initialized
2025-07-15 01:28:07,254 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 01:28:07,254 - INFO - app - Environment: PRODUCTION
2025-07-15 01:28:07,300 - INFO - app - Application startup initiated
2025-07-15 01:28:07,300 - INFO - app - Initializing core services...
2025-07-15 01:28:07,349 - INFO - app - Firebase initialized
2025-07-15 01:28:07,349 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 01:28:09,392 - INFO - app - Redis initialized
2025-07-15 01:28:09,429 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 01:28:09,431 - INFO - app - Scheduler initialized
2025-07-15 01:28:09,434 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 01:28:09,434 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 01:28:10,908 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 01:28:10,941 - INFO - app - Starting stale cache cleanup task
2025-07-15 01:28:15,011 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 01:28:15,011 - INFO - app - Background tasks initialized
2025-07-15 01:28:15,708 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 01:28:15,708 - INFO - app - Application startup completed successfully
2025-07-15 01:28:15,709 - INFO - app - Starting cache validation task
2025-07-15 01:28:15,713 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 01:28:15,716 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 01:28:15,745 - INFO - app - Validating cache for 31 users
2025-07-15 01:28:17,773 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 01:28:19,810 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-15 01:28:19,815 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 01:28:21,849 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 01:28:23,886 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 01:28:23,892 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 01:28:23,906 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 01:28:23,914 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 01:28:25,991 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 01:28:26,006 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 01:28:26,015 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 01:28:26,020 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 01:28:26,028 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 01:28:26,057 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 01:28:26,070 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 01:28:26,084 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 01:28:26,100 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 01:28:26,108 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 01:28:26,115 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 01:28:26,133 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 01:28:26,187 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 01:28:26,205 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 01:28:26,215 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 01:28:26,224 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 01:28:26,238 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 01:28:26,238 - INFO - app - Completed stale cache cleanup task
2025-07-15 01:28:26,278 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 01:28:28,354 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 01:28:28,393 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 01:28:30,482 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-15 01:28:30,530 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 01:28:30,583 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 01:28:30,715 - INFO - app - Starting stale cache cleanup task
2025-07-15 01:28:32,654 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 01:28:32,660 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,660 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 01:28:32,665 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 01:28:32,674 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 01:28:32,686 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 01:28:32,697 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 01:28:32,706 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 01:28:32,719 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 01:28:32,723 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,729 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 01:28:32,744 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 01:28:32,769 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 01:28:32,775 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 01:28:32,779 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 01:28:32,785 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 01:28:32,787 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,791 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 01:28:32,796 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 01:28:32,820 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 01:28:32,827 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 01:28:32,841 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,842 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 01:28:32,848 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 01:28:32,848 - INFO - app - Completed stale cache cleanup task
2025-07-15 01:28:32,872 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,896 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,954 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,963 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,971 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,981 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 01:28:32,993 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 01:28:33,082 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 01:28:33,189 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 01:28:33,253 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 01:28:33,336 - INFO - app - Cache validation completed
2025-07-15 01:28:35,065 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:28:35,173 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:28:35,231 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:28:35,238 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:28:35,284 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:28:35,288 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:28:35,296 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:28:35,451 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:28:35,472 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:28:35,473 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:28:35,502 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:28:35,523 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:28:35,524 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:28:35,550 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:28:35,554 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:28:35,575 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:28:35,576 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:28:35,581 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:28:35,582 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:28:35,582 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:28:35,609 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:28:35,610 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:28:35,610 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:28:35,635 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:28:35,636 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:28:35,650 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:28:35,676 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:28:35,676 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:29:09,875 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.5595610849551304892811022408% which is below threshold 100.0%
2025-07-15 01:29:09,924 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000102-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:29:09.924774', 'account_type': 'live'}
2025-07-15 01:29:10,286 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:29:10,458 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:29:10,475 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:29:11,413 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.21691924065397495720877442% which is below threshold 100.0%
2025-07-15 01:29:11,831 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:29:11,844 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:29:11,877 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:29:11,879 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:30:09,985 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.6778316060277531380858876481% which is below threshold 100.0%
2025-07-15 01:30:10,015 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000103-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:30:10.015183', 'account_type': 'live'}
2025-07-15 01:30:10,302 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:30:10,382 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:30:10,394 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:30:11,418 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.33220791255209511288124946% which is below threshold 100.0%
2025-07-15 01:30:11,934 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:30:11,944 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:30:11,968 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:30:11,969 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:31:09,886 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7980733024515861643707528121% which is below threshold 100.0%
2025-07-15 01:31:09,915 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000104-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:31:09.915036', 'account_type': 'live'}
2025-07-15 01:31:10,298 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:31:10,404 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:31:10,419 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:31:11,527 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.51318272851722762829397546% which is below threshold 100.0%
2025-07-15 01:31:12,046 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:31:12,058 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:31:12,089 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:31:12,090 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:32:09,897 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7642347922558080176293836539% which is below threshold 100.0%
2025-07-15 01:32:09,921 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000105-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:32:09.921953', 'account_type': 'live'}
2025-07-15 01:32:10,209 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:32:10,279 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:32:10,292 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:32:11,334 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.47041368958770851271810589% which is below threshold 100.0%
2025-07-15 01:32:11,859 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:32:11,891 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:32:11,930 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:32:11,930 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:33:05,760 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 11
2025-07-15 01:33:05,766 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 11
2025-07-15 01:33:05,777 - WARNING - app.api.v1.endpoints.users - Refresh token valid, but user ID 11 not found or inactive.
2025-07-15 01:33:05,779 - INFO - app.api.v1.endpoints.users - Invalidated refresh token for invalid user ID 11.
2025-07-15 01:33:05,779 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: User not found or inactive
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 331, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive
2025-07-15 01:33:05,877 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 11
2025-07-15 01:33:05,881 - WARNING - app.api.v1.endpoints.users - Refresh token validation failed for user ID 11. Data found: False, User ID match: False
2025-07-15 01:33:05,881 - ERROR - app.api.v1.endpoints.users - Unexpected error during refresh token process for token: eyJhbGciOiJIUzI1NiIs... : 401: Invalid or expired refresh token
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 312, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Invalid or expired refresh token
2025-07-15 01:33:09,900 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7193248471707315840415665284% which is below threshold 100.0%
2025-07-15 01:33:09,929 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000106-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:33:09.929076', 'account_type': 'live'}
2025-07-15 01:33:10,310 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:33:10,410 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:33:10,421 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:33:11,229 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.41472860570134158248993904% which is below threshold 100.0%
2025-07-15 01:33:11,756 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:33:11,773 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:33:11,814 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:33:11,815 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:33:16,453 - INFO - app.api.v1.endpoints.favorites - Direct SQL query found 0 symbols for user 14
2025-07-15 01:33:16,453 - INFO - app.api.v1.endpoints.favorites - Symbols: []
2025-07-15 01:33:33,353 - INFO - app - Starting cache validation task
2025-07-15 01:33:33,364 - INFO - app - Validating cache for 31 users
2025-07-15 01:33:33,366 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,371 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,383 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,394 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,406 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,417 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,428 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,441 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,452 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,463 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,472 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,480 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,491 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,500 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,508 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,517 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,526 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,535 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,544 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,562 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,575 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,587 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,597 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 01:33:33,612 - INFO - app - Cache validation completed
2025-07-15 01:34:09,906 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7379524542396696512283202301% which is below threshold 100.0%
2025-07-15 01:34:09,931 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000107-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:34:09.931585', 'account_type': 'live'}
2025-07-15 01:34:10,316 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:34:10,421 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:34:10,451 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:34:11,544 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.43802117726199900235158034% which is below threshold 100.0%
2025-07-15 01:34:12,059 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:34:12,069 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:34:12,094 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:34:12,095 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:35:09,819 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7635777338054045584693570683% which is below threshold 100.0%
2025-07-15 01:35:09,843 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000108-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:35:09.843744', 'account_type': 'live'}
2025-07-15 01:35:10,216 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:35:10,305 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:35:10,319 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:35:11,344 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.47041368958770851271810589% which is below threshold 100.0%
2025-07-15 01:35:11,863 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:35:11,872 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:35:11,903 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:35:11,904 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:35:14,785 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000109-001', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '116865.0', 'status': 'OPEN', 'contract_value': '0.01', 'account_type': 'live', 'timestamp': '2025-07-15T08:35:14.785206'}
2025-07-15 01:35:15,132 - INFO - app.core.firebase - Order data (ID: 1000109-001) sent to Firebase successfully.
2025-07-15 01:36:09,814 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.6794742521537617859859541120% which is below threshold 100.0%
2025-07-15 01:36:09,837 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000110-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:36:09.837453', 'account_type': 'live'}
2025-07-15 01:36:10,121 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:36:10,161 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:36:10,178 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:36:10,937 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.36552202428011634953521011% which is below threshold 100.0%
2025-07-15 01:36:11,380 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:36:11,451 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:36:11,508 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:36:11,509 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:37:09,923 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.6538489725880268787449172738% which is below threshold 100.0%
2025-07-15 01:37:09,978 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000111-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:37:09.978617', 'account_type': 'live'}
2025-07-15 01:37:10,275 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:37:10,381 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:37:10,392 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:37:11,251 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.33384631148953878865111093% which is below threshold 100.0%
2025-07-15 01:37:12,489 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:37:12,518 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:37:12,561 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:37:12,563 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:37:47,462 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000109-001', 'stoploss_id': '1000112-005', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'stop_loss': '115555', 'action': 'add_stoploss', 'timestamp': '2025-07-15T08:37:47.462592', 'contract_value': '0.01000000', 'order_quantity': '0.01', 'order_status': 'OPEN', 'status': 'STOPLOSS', 'account_type': 'live'}
2025-07-15 01:37:47,778 - INFO - app.core.firebase - Order data (ID: 1000109-001) sent to Firebase successfully.
2025-07-15 01:38:09,927 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.8289550496205487448920023351% which is below threshold 100.0%
2025-07-15 01:38:09,978 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000113-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:38:09.978649', 'account_type': 'live'}
2025-07-15 01:38:10,335 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:38:10,407 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:38:10,416 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:38:11,697 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.60240720398551464192757089% which is below threshold 100.0%
2025-07-15 01:38:12,287 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:38:12,303 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:38:12,316 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:38:12,317 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:38:33,618 - INFO - app - Starting cache validation task
2025-07-15 01:38:33,627 - INFO - app - Validating cache for 31 users
2025-07-15 01:38:33,629 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,633 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,641 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,648 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,653 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,658 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,664 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,669 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,674 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,678 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,684 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,688 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,693 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,698 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,702 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,707 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,712 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,717 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,722 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,728 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,733 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,738 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,743 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 01:38:33,749 - INFO - app - Cache validation completed
2025-07-15 01:39:09,829 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.8299406372961539336320422135% which is below threshold 100.0%
2025-07-15 01:39:09,876 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000117-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:39:09.876683', 'account_type': 'live'}
2025-07-15 01:39:10,237 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:39:10,297 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:39:10,302 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:39:10,852 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.55369896890776203101939748% which is below threshold 100.0%
2025-07-15 01:39:11,265 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:39:11,274 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:39:11,295 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:39:11,296 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:40:07,979 - INFO - app - Application shutdown initiated
2025-07-15 01:40:07,980 - INFO - app - Scheduler shutdown completed
2025-07-15 01:40:07,981 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 01:40:09,325 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 01:40:09,326 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 01:40:09,334 - INFO - app - Redis connection closed
2025-07-15 01:40:09,334 - INFO - app - Application shutdown completed
2025-07-15 01:45:03,533 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:45:03,579 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:45:03,594 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:45:03,595 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:45:04,016 - INFO - app - Application starting up - Trading system initialized
2025-07-15 01:45:04,016 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 01:45:04,016 - INFO - app - Environment: PRODUCTION
2025-07-15 01:45:04,080 - INFO - app - Application startup initiated
2025-07-15 01:45:04,080 - INFO - app - Initializing core services...
2025-07-15 01:45:04,119 - INFO - app - Firebase initialized
2025-07-15 01:45:04,119 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 01:45:06,149 - INFO - app - Redis initialized
2025-07-15 01:45:06,184 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 01:45:06,188 - INFO - app - Scheduler initialized
2025-07-15 01:45:06,192 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 01:45:06,193 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 01:45:07,517 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 01:45:07,531 - INFO - app - Starting stale cache cleanup task
2025-07-15 01:45:11,675 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 01:45:11,675 - INFO - app - Background tasks initialized
2025-07-15 01:45:12,421 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 01:45:12,421 - INFO - app - Application startup completed successfully
2025-07-15 01:45:12,422 - INFO - app - Starting cache validation task
2025-07-15 01:45:12,426 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 01:45:12,429 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 01:45:12,478 - INFO - app - Validating cache for 31 users
2025-07-15 01:45:14,470 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 01:45:16,531 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-15 01:45:18,583 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 01:45:20,643 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 01:45:20,650 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 01:45:20,653 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 01:45:20,659 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 01:45:22,721 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 01:45:22,735 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 01:45:22,741 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 01:45:22,745 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 01:45:22,746 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 01:45:22,750 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 01:45:22,758 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 01:45:22,762 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 01:45:22,768 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 01:45:22,776 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 01:45:22,782 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 01:45:22,784 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 01:45:22,788 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 01:45:22,803 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 01:45:22,806 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 01:45:22,813 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 01:45:22,813 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 01:45:22,821 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 01:45:22,821 - INFO - app - Completed stale cache cleanup task
2025-07-15 01:45:22,844 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 01:45:24,918 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 01:45:24,932 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 01:45:27,006 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 01:45:27,023 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 01:45:27,430 - INFO - app - Starting stale cache cleanup task
2025-07-15 01:45:29,075 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 01:45:29,083 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 01:45:29,087 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 01:45:29,090 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 01:45:29,096 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 01:45:29,100 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 01:45:29,102 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 01:45:29,103 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 01:45:29,110 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 01:45:29,114 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 01:45:29,116 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 01:45:29,121 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 01:45:29,121 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 01:45:29,125 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 01:45:29,130 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 01:45:29,135 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 01:45:29,138 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 01:45:29,142 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 01:45:29,147 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 01:45:29,151 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 01:45:29,154 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 01:45:29,157 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 01:45:29,160 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 01:45:29,160 - INFO - app - Completed stale cache cleanup task
2025-07-15 01:45:31,198 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 01:45:31,223 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,271 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,298 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,314 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,351 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,375 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,402 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,419 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,438 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,451 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 01:45:33,470 - INFO - app - Cache validation completed
2025-07-15 01:45:34,816 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:45:34,819 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:45:34,883 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:45:34,885 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:45:34,889 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:45:34,895 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:45:34,899 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 01:45:35,079 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:45:35,099 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:45:35,100 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:45:35,100 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:45:35,122 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:45:35,122 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:45:35,146 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:45:35,149 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:45:35,160 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:45:35,164 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:45:35,169 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:45:35,169 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:45:35,172 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 01:45:35,172 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:45:35,172 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:45:35,182 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:45:35,182 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:45:35,182 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:45:35,182 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:45:35,190 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 01:45:35,190 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 01:46:06,570 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.8681485861871150837875881659% which is below threshold 100.0%
2025-07-15 01:46:06,591 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000118-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:46:06.591840', 'account_type': 'live'}
2025-07-15 01:46:06,880 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:46:06,956 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:46:06,965 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:46:07,510 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.61029199887196212677016205% which is below threshold 100.0%
2025-07-15 01:46:07,924 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:46:07,933 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:46:07,951 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:46:07,951 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:46:29,943 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000119-001', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '116867.1', 'status': 'OPEN', 'contract_value': '0.01', 'account_type': 'live', 'timestamp': '2025-07-15T08:46:29.943069'}
2025-07-15 01:46:30,240 - INFO - app.core.firebase - Order data (ID: 1000119-001) sent to Firebase successfully.
2025-07-15 01:47:06,606 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.8049724161808224855510319608% which is below threshold 100.0%
2025-07-15 01:47:06,644 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000120-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:47:06.644042', 'account_type': 'live'}
2025-07-15 01:47:06,942 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:47:07,084 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:47:07,101 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:47:08,342 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.52154538976042989403586605% which is below threshold 100.0%
2025-07-15 01:47:08,853 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:47:08,869 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:47:08,903 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:47:08,903 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:47:13,236 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000119-001', 'takeprofit_id': '1000121-006', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'take_profit': '129869', 'action': 'add_takeprofit', 'timestamp': '2025-07-15T08:47:13.236822', 'contract_value': '0.01000000', 'order_quantity': '0.01', 'order_status': 'OPEN', 'status': 'TAKEPROFIT', 'account_type': 'live'}
2025-07-15 01:47:13,558 - INFO - app.core.firebase - Order data (ID: 1000119-001) sent to Firebase successfully.
2025-07-15 01:48:06,710 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7737621397866581754497691450% which is below threshold 100.0%
2025-07-15 01:48:06,807 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000122-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:48:06.807081', 'account_type': 'live'}
2025-07-15 01:48:07,215 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:48:07,328 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:48:07,345 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:48:08,546 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.48246274844015870760907283% which is below threshold 100.0%
2025-07-15 01:48:09,076 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:48:09,141 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:48:09,183 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:48:09,184 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:48:19,117 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000126-001', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '116864.7', 'status': 'OPEN', 'contract_value': '0.01', 'account_type': 'live', 'timestamp': '2025-07-15T08:48:19.117677'}
2025-07-15 01:48:19,502 - INFO - app.core.firebase - Order data (ID: 1000126-001) sent to Firebase successfully.
2025-07-15 01:49:06,610 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.6042410595825657121629100613% which is below threshold 100.0%
2025-07-15 01:49:06,650 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000127-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:49:06.650008', 'account_type': 'live'}
2025-07-15 01:49:07,016 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:49:07,080 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:49:07,089 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:49:07,619 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000126-001', 'close_price': '116716.4', 'user_id': '14', 'order_type': 'BUY', 'order_company_name': 'BTCUSD', 'order_quantity': '0.01000000', 'contract_value': '0.01000000', 'order_status': 'CLOSED', 'status': 'CLOSED', 'action': 'close_order', 'close_id': '1000128-003', 'account_type': 'live', 'timestamp': '2025-07-15T08:49:07.619620'}
2025-07-15 01:49:07,936 - INFO - app.core.firebase - Order data (ID: 1000126-001) sent to Firebase successfully.
2025-07-15 01:49:08,449 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.27097275226513773098267687% which is below threshold 100.0%
2025-07-15 01:49:08,861 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:49:08,871 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:49:08,893 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:49:08,894 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:50:06,611 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.6416933912555628842844254403% which is below threshold 100.0%
2025-07-15 01:50:06,658 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000129-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T08:50:06.658710', 'account_type': 'live'}
2025-07-15 01:50:07,020 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 01:50:07,095 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 01:50:07,103 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 01:50:08,147 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.31766712198228249042372888% which is below threshold 100.0%
2025-07-15 01:50:08,565 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 01:50:08,576 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 01:50:08,597 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 01:50:08,598 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 01:50:26,750 - INFO - app - Application shutdown initiated
2025-07-15 01:50:26,750 - INFO - app - Scheduler shutdown completed
2025-07-15 01:50:26,751 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 01:50:28,636 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 01:50:28,636 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 01:50:28,649 - INFO - app - Redis connection closed
2025-07-15 01:50:28,649 - INFO - app - Application shutdown completed
2025-07-15 02:01:11,082 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:01:11,111 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:01:11,124 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:01:11,125 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:01:11,562 - INFO - app - Application starting up - Trading system initialized
2025-07-15 02:01:11,562 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 02:01:11,562 - INFO - app - Environment: PRODUCTION
2025-07-15 02:01:11,615 - INFO - app - Application startup initiated
2025-07-15 02:01:11,616 - INFO - app - Initializing core services...
2025-07-15 02:01:11,650 - INFO - app - Firebase initialized
2025-07-15 02:01:11,650 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 02:01:13,685 - INFO - app - Redis initialized
2025-07-15 02:01:13,690 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 02:01:13,690 - INFO - app - Scheduler initialized
2025-07-15 02:01:13,692 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:01:13,693 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 02:01:15,101 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:01:15,102 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:01:19,203 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 02:01:19,203 - INFO - app - Background tasks initialized
2025-07-15 02:01:19,881 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 02:01:19,881 - INFO - app - Application startup completed successfully
2025-07-15 02:01:19,882 - INFO - app - Starting cache validation task
2025-07-15 02:01:19,884 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 02:01:19,887 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 02:01:19,930 - INFO - app - Validating cache for 31 users
2025-07-15 02:01:21,940 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:01:23,965 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-15 02:01:23,969 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:01:26,024 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:01:28,057 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:01:28,067 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:01:28,073 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:01:28,078 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:01:28,088 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:01:28,091 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:01:30,122 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:01:30,135 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 02:01:30,135 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:01:30,152 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:01:30,167 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:01:30,178 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:01:30,186 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:01:30,195 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:01:32,049 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 02:01:32,050 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 02:01:32,230 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 02:01:32,236 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:01:32,241 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 02:01:32,242 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 02:01:32,263 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 02:01:32,266 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 02:01:32,290 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:01:32,315 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:01:32,325 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 02:01:32,328 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:01:32,335 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:01:32,335 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:01:32,354 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 02:01:32,381 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 02:01:34,440 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 02:01:34,500 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 02:01:34,890 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:01:36,538 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:01:36,543 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:01:36,546 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:01:36,548 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 02:01:36,550 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:01:36,556 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:01:36,560 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:01:36,563 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:01:36,568 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:01:36,571 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:01:36,572 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 02:01:36,574 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:01:36,596 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:01:38,665 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:01:38,713 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:01:38,731 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:01:38,738 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 02:01:38,743 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:01:38,755 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:01:38,806 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:01:38,814 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:01:38,836 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 02:01:38,847 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:01:38,874 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:01:38,874 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:01:38,975 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,064 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,149 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,238 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,319 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,420 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,470 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,529 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,564 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,600 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,629 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 02:01:39,679 - INFO - app - Cache validation completed
2025-07-15 02:01:40,865 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:01:40,871 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:01:40,970 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:01:40,987 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:01:40,993 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:01:40,998 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:01:41,018 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:01:41,134 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:01:41,164 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:01:41,173 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:01:41,173 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:01:41,189 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:01:41,190 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:01:41,252 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:01:41,253 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:01:41,269 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:01:41,269 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:01:41,274 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:01:41,274 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:01:41,289 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:01:41,296 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:01:41,307 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:01:41,308 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:01:41,313 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:01:41,313 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:01:41,313 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:01:41,330 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:01:41,330 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:01:41,785 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000133-001', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_quantity': '0.01', 'price': '116828.8', 'status': 'OPEN', 'contract_value': '0.01', 'account_type': 'live', 'timestamp': '2025-07-15T09:01:41.785391'}
2025-07-15 02:01:42,087 - INFO - app.core.firebase - Order data (ID: 1000133-001) sent to Firebase successfully.
2025-07-15 02:02:14,149 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7142983500251451214673631486% which is below threshold 100.0%
2025-07-15 02:02:14,162 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000134-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:02:14.162286', 'account_type': 'live'}
2025-07-15 02:02:14,457 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:02:14,561 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:02:14,571 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:02:15,482 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.40842759645442260875845747% which is below threshold 100.0%
2025-07-15 02:02:16,093 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:02:16,105 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:02:16,134 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:02:16,135 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:03:14,258 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7231686391055918201277220542% which is below threshold 100.0%
2025-07-15 02:03:14,308 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000135-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:03:14.308770', 'account_type': 'live'}
2025-07-15 02:03:14,668 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:03:14,738 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:03:14,746 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:03:15,898 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.41941852265977410438116751% which is below threshold 100.0%
2025-07-15 02:03:16,355 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:03:16,397 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:03:16,431 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:03:16,432 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:03:18,858 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000133-001', 'stoploss_id': '1000136-005', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'stop_loss': '116757.3', 'action': 'add_stoploss', 'timestamp': '2025-07-15T09:03:18.857987', 'contract_value': '0.01000000', 'order_quantity': '0.01', 'order_status': 'OPEN', 'status': 'STOPLOSS', 'account_type': 'live'}
2025-07-15 02:03:19,175 - INFO - app.core.firebase - Order data (ID: 1000133-001) sent to Firebase successfully.
2025-07-15 02:03:58,802 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'order_id': '1000133-001', 'takeprofit_id': '1000137-006', 'user_id': '14', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'take_profit': '116997.3', 'action': 'add_takeprofit', 'timestamp': '2025-07-15T09:03:58.801841', 'contract_value': '0.01000000', 'order_quantity': '0.01', 'order_status': 'OPEN', 'status': 'TAKEPROFIT', 'account_type': 'live'}
2025-07-15 02:03:59,215 - INFO - app.core.firebase - Order data (ID: 1000133-001) sent to Firebase successfully.
2025-07-15 02:04:14,171 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.8240271112425228011918029431% which is below threshold 100.0%
2025-07-15 02:04:14,225 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000138-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:04:14.225601', 'account_type': 'live'}
2025-07-15 02:04:14,677 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:04:14,802 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:04:14,817 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:04:16,108 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.52198912280598738555698089% which is below threshold 100.0%
2025-07-15 02:04:16,655 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:04:16,695 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:04:16,730 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:04:16,731 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:05:14,055 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.7484653894461249977887455996% which is below threshold 100.0%
2025-07-15 02:05:14,075 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000139-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:05:14.075191', 'account_type': 'live'}
2025-07-15 02:05:14,372 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:05:14,464 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:05:14,477 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:05:15,907 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.45218650140864741497852981% which is below threshold 100.0%
2025-07-15 02:05:16,329 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:05:16,338 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:05:16,369 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:05:16,370 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:05:58,166 - INFO - app - Application shutdown initiated
2025-07-15 02:05:58,166 - INFO - app - Scheduler shutdown completed
2025-07-15 02:05:58,572 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 02:05:59,125 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 02:05:59,125 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 02:05:59,146 - INFO - app - Redis connection closed
2025-07-15 02:05:59,146 - INFO - app - Application shutdown completed
2025-07-15 02:23:01,685 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:23:01,730 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:23:01,742 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:23:01,742 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:23:02,296 - INFO - app - Application starting up - Trading system initialized
2025-07-15 02:23:02,296 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 02:23:02,296 - INFO - app - Environment: PRODUCTION
2025-07-15 02:23:02,345 - INFO - app - Application startup initiated
2025-07-15 02:23:02,345 - INFO - app - Initializing core services...
2025-07-15 02:23:02,393 - INFO - app - Firebase initialized
2025-07-15 02:23:02,393 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 02:23:04,480 - INFO - app - Redis initialized
2025-07-15 02:23:04,486 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 02:23:04,488 - INFO - app - Scheduler initialized
2025-07-15 02:23:04,520 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:23:04,520 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 02:23:06,918 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:23:06,969 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:23:11,098 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 02:23:11,099 - INFO - app - Background tasks initialized
2025-07-15 02:23:11,809 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 02:23:11,810 - INFO - app - Application startup completed successfully
2025-07-15 02:23:11,810 - INFO - app - Starting cache validation task
2025-07-15 02:23:11,813 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 02:23:11,815 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 02:23:11,838 - INFO - app - Validating cache for 31 users
2025-07-15 02:23:13,890 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:23:15,933 - WARNING - app - User 4: Missing balance/margin cache, refreshing...
2025-07-15 02:23:17,960 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:23:22,047 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:23:22,053 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:23:22,064 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:23:22,068 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:23:22,071 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:23:22,076 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:23:22,088 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:23:22,095 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:23:22,097 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 02:23:22,100 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:23:22,111 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:23:22,116 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:23:22,124 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:23:22,129 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:23:22,133 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:23:22,133 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 02:23:22,140 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:23:22,159 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:23:22,165 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:23:22,176 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 02:23:22,178 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:23:22,185 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:23:22,185 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:23:22,212 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 02:23:22,242 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 02:23:22,268 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 02:23:22,303 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 02:23:24,381 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 02:23:24,407 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 02:23:26,471 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 02:23:26,506 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 02:23:26,536 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 02:23:26,573 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 02:23:26,596 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 02:23:26,816 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:23:28,648 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:23:28,657 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:23:28,663 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:23:28,669 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:23:28,674 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:23:28,679 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:23:28,680 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 02:23:28,683 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:23:28,697 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:23:28,702 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:23:28,715 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:23:28,718 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 02:23:28,720 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:23:28,723 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:23:28,727 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:23:28,731 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:23:28,736 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:23:28,740 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:23:28,741 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 02:23:28,779 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:23:28,787 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:23:28,795 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:23:28,799 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:23:28,799 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:23:28,806 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 02:23:28,838 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 02:23:28,862 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 02:23:28,882 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:23:28,901 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 02:23:28,926 - INFO - app - Cache validation completed
2025-07-15 02:23:30,118 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:23:30,175 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:23:30,214 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:23:30,272 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:23:30,297 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:23:30,298 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:23:30,366 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:23:30,381 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:23:30,402 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:23:30,402 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:23:30,429 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:23:30,455 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:23:30,455 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:23:30,491 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:23:30,509 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:23:30,509 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:23:30,536 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:23:30,552 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:23:30,552 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:23:30,567 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:23:30,569 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:23:30,579 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:23:30,579 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:23:30,580 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:23:30,580 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:23:30,605 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:23:30,622 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:23:30,622 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:24:05,373 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.004389655878272340619100689% which is below threshold 100.0%
2025-07-15 02:24:05,498 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000143-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:24:05.498804', 'account_type': 'live'}
2025-07-15 02:24:05,868 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:24:05,963 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:24:05,971 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:24:06,901 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.77024069513990117860275564% which is below threshold 100.0%
2025-07-15 02:24:07,311 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:24:07,320 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:24:07,345 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:24:07,346 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:25:04,959 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.288567435677768427330598959% which is below threshold 100.0%
2025-07-15 02:25:05,010 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000144-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:25:05.010673', 'account_type': 'live'}
2025-07-15 02:25:05,371 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:25:05,539 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:25:05,548 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:25:06,407 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.12403246569414491515721769% which is below threshold 100.0%
2025-07-15 02:25:06,815 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:25:06,829 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:25:06,863 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:25:06,864 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:26:04,864 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.210048950854555057707421981% which is below threshold 100.0%
2025-07-15 02:26:04,914 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000145-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:26:04.914547', 'account_type': 'live'}
2025-07-15 02:26:05,271 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:26:05,431 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:26:05,483 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:26:06,295 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.01736586820432227389019464% which is below threshold 100.0%
2025-07-15 02:26:06,718 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:26:06,729 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:26:06,764 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:26:06,765 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:27:04,972 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.339160936358834782652646050% which is below threshold 100.0%
2025-07-15 02:27:05,025 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000146-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:27:05.025914', 'account_type': 'live'}
2025-07-15 02:27:05,371 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:27:05,529 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:27:05,556 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:27:06,510 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.05283037853773836912540968% which is below threshold 100.0%
2025-07-15 02:27:07,025 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:27:07,039 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:27:07,069 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:27:07,070 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:27:13,209 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 02:27:13,211 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 02:27:13,217 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 02:28:04,932 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.438376762369757115816660475% which is below threshold 100.0%
2025-07-15 02:28:04,958 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000147-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:28:04.957949', 'account_type': 'live'}
2025-07-15 02:28:05,289 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:28:05,376 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:28:05,382 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:28:06,407 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.31190221052101960023475526% which is below threshold 100.0%
2025-07-15 02:28:06,932 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:28:06,941 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:28:06,965 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:28:06,966 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:28:28,930 - INFO - app - Starting cache validation task
2025-07-15 02:28:28,940 - INFO - app - Validating cache for 31 users
2025-07-15 02:28:28,942 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:28:28,945 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 02:28:28,953 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 02:28:28,962 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 02:28:28,968 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 02:28:28,972 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 02:28:28,977 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 02:28:28,986 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 02:28:28,993 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,001 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,013 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,021 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,031 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,042 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,056 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,071 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,085 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,095 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,107 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,118 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,126 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,135 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,145 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 02:28:29,156 - INFO - app - Cache validation completed
2025-07-15 02:29:04,980 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.355915926844122991233323983% which is below threshold 100.0%
2025-07-15 02:29:05,017 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000148-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:29:05.017111', 'account_type': 'live'}
2025-07-15 02:29:05,389 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:29:05,474 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:29:05,482 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:29:06,414 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.22428200067897982632561663% which is below threshold 100.0%
2025-07-15 02:29:06,870 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:29:06,879 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:29:06,910 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:29:06,911 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:30:04,990 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.355258868393719532073297397% which is below threshold 100.0%
2025-07-15 02:30:05,040 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000149-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:30:05.040833', 'account_type': 'live'}
2025-07-15 02:30:05,398 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:30:05,491 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:30:05,501 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:30:06,829 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.20806867786052661418647315% which is below threshold 100.0%
2025-07-15 02:30:07,278 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:30:07,287 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:30:07,313 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:30:07,314 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:31:04,991 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.353944751492912613753244226% which is below threshold 100.0%
2025-07-15 02:31:05,041 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000150-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:31:05.041801', 'account_type': 'live'}
2025-07-15 02:31:05,404 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:31:05,493 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:31:05,506 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:31:06,426 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.20636201230068962259275676% which is below threshold 100.0%
2025-07-15 02:31:06,944 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:31:06,958 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:31:06,983 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:31:06,985 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:32:04,893 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.241259227248719367808684796% which is below threshold 100.0%
2025-07-15 02:32:04,945 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000151-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:32:04.945498', 'account_type': 'live'}
2025-07-15 02:32:05,236 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:32:05,285 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:32:05,290 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:32:05,918 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.06590343672609116857234081% which is below threshold 100.0%
2025-07-15 02:32:06,339 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:32:06,362 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:32:06,394 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:32:06,394 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:32:33,491 - INFO - app - Application shutdown initiated
2025-07-15 02:32:33,491 - INFO - app - Scheduler shutdown completed
2025-07-15 02:32:33,881 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 02:32:35,607 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 02:32:35,607 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 02:32:35,613 - INFO - app - Redis connection closed
2025-07-15 02:32:35,614 - INFO - app - Application shutdown completed
2025-07-15 02:32:37,509 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:32:37,538 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:32:37,552 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:32:37,552 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:32:37,897 - INFO - app - Application starting up - Trading system initialized
2025-07-15 02:32:37,897 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 02:32:37,897 - INFO - app - Environment: PRODUCTION
2025-07-15 02:32:37,948 - INFO - app - Application startup initiated
2025-07-15 02:32:37,948 - INFO - app - Initializing core services...
2025-07-15 02:32:37,989 - INFO - app - Firebase initialized
2025-07-15 02:32:37,989 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 02:32:40,032 - INFO - app - Redis initialized
2025-07-15 02:32:40,061 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 02:32:40,063 - INFO - app - Scheduler initialized
2025-07-15 02:32:40,066 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:32:40,066 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 02:32:41,265 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:32:41,270 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:32:45,359 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 02:32:45,359 - INFO - app - Background tasks initialized
2025-07-15 02:32:46,057 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 02:32:46,057 - INFO - app - Application startup completed successfully
2025-07-15 02:32:46,057 - INFO - app - Starting cache validation task
2025-07-15 02:32:46,061 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 02:32:46,064 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 02:32:46,089 - INFO - app - Validating cache for 31 users
2025-07-15 02:32:48,110 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:32:52,181 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:32:54,212 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:32:54,229 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:32:54,245 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:32:54,262 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:32:54,279 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:32:54,296 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:32:54,306 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:32:54,316 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:32:54,330 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:32:54,337 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:32:54,352 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:32:54,365 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:32:54,385 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:32:54,410 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:32:54,460 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:32:54,484 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:32:54,521 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:32:54,536 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:32:54,537 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:32:55,181 - INFO - app - Cache validation completed
2025-07-15 02:32:57,555 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:32:57,585 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:32:57,612 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:32:57,617 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:32:57,647 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:32:57,653 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:32:57,681 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:32:57,810 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:32:57,834 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:32:57,835 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:32:57,894 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:32:57,896 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:32:57,900 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:32:57,912 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:32:57,914 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:32:57,916 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:32:57,916 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:32:57,918 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:32:57,918 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:32:57,921 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:32:57,922 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:32:57,928 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:32:57,929 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:32:57,930 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:32:57,930 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:32:57,931 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:32:57,947 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:32:57,947 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:33:01,069 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:33:04,670 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:33:04,685 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:33:04,693 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:33:04,699 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:33:04,706 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:33:04,712 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:33:04,720 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:33:04,742 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:33:04,752 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:33:04,759 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:33:04,777 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:33:04,789 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:33:04,799 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:33:04,810 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:33:04,816 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:33:04,820 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:33:04,839 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:33:04,848 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:33:04,865 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:33:04,877 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:33:04,877 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:33:40,513 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.353616222267710884173230933% which is below threshold 100.0%
2025-07-15 02:33:40,606 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000152-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:33:40.606320', 'account_type': 'live'}
2025-07-15 02:33:40,942 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:33:41,035 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:33:41,046 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:33:41,868 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.20571347938795133026729728% which is below threshold 100.0%
2025-07-15 02:33:42,388 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:33:42,400 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:33:42,424 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:33:42,425 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:34:40,559 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.393696787742321892934852655% which is below threshold 100.0%
2025-07-15 02:34:40,657 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000153-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:34:40.657360', 'account_type': 'live'}
2025-07-15 02:34:41,034 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:34:41,155 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:34:41,167 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:34:41,978 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.17895296340970479669278252% which is below threshold 100.0%
2025-07-15 02:34:42,390 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:34:42,414 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:34:42,453 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:34:42,454 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:35:40,545 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.371685329653806011073962037% which is below threshold 100.0%
2025-07-15 02:35:40,573 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000154-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:35:40.573529', 'account_type': 'live'}
2025-07-15 02:35:40,955 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:35:41,116 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:35:41,131 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:35:42,084 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.22837799802258901575027032% which is below threshold 100.0%
2025-07-15 02:35:42,599 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:35:42,608 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:35:42,635 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:35:42,636 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:36:40,860 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.364786215924569689893682888% which is below threshold 100.0%
2025-07-15 02:36:40,910 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000155-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:36:40.910503', 'account_type': 'live'}
2025-07-15 02:36:41,368 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:36:41,502 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:36:41,516 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:36:42,497 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.26742650603166328826530212% which is below threshold 100.0%
2025-07-15 02:36:43,011 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:36:43,022 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:36:43,038 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:36:43,038 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:37:40,557 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.390740024715506326714733019% which is below threshold 100.0%
2025-07-15 02:37:40,613 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000156-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:37:40.613599', 'account_type': 'live'}
2025-07-15 02:37:40,968 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:37:41,052 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:37:41,063 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:37:41,890 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.25220304923791563023711660% which is below threshold 100.0%
2025-07-15 02:37:42,517 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:37:42,539 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:37:42,587 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:37:42,589 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:37:55,206 - INFO - app - Starting cache validation task
2025-07-15 02:37:55,215 - INFO - app - Validating cache for 31 users
2025-07-15 02:37:55,217 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,221 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,231 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,239 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,249 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,258 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,266 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,273 - WARNING - app - User 14: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,279 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,287 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,294 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,302 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,313 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,325 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,336 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,347 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,358 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,368 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,378 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,395 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,434 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,441 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,450 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,458 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 02:37:55,472 - INFO - app - Cache validation completed
2025-07-15 02:38:40,663 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.435748528568143279176554133% which is below threshold 100.0%
2025-07-15 02:38:40,715 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000157-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:38:40.715118', 'account_type': 'live'}
2025-07-15 02:38:41,179 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:38:41,405 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:38:41,475 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:38:42,714 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.26923557152509068026119083% which is below threshold 100.0%
2025-07-15 02:38:43,201 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:38:43,216 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:38:43,256 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:38:43,257 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:39:40,465 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.456117340530650513137378286% which is below threshold 100.0%
2025-07-15 02:39:40,512 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000158-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:39:40.512725', 'account_type': 'live'}
2025-07-15 02:39:40,811 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:39:40,882 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:39:40,887 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:39:41,593 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.33361099644214827005210860% which is below threshold 100.0%
2025-07-15 02:39:42,002 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:39:42,007 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:39:42,022 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:39:42,022 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:40:40,627 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.456117340530650513137378286% which is below threshold 100.0%
2025-07-15 02:40:40,652 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000159-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:40:40.652272', 'account_type': 'live'}
2025-07-15 02:40:40,985 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:40:41,080 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:40:41,096 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:40:41,910 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 61.33480566233403445430085524% which is below threshold 100.0%
2025-07-15 02:40:42,331 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:40:42,350 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:40:42,378 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:40:42,380 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:40:53,034 - INFO - app - Application shutdown initiated
2025-07-15 02:40:53,034 - INFO - app - Scheduler shutdown completed
2025-07-15 02:40:53,035 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 02:40:53,989 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 02:40:53,989 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 02:40:53,998 - INFO - app - Redis connection closed
2025-07-15 02:40:53,998 - INFO - app - Application shutdown completed
2025-07-15 02:40:55,966 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:40:55,995 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:40:56,014 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:40:56,015 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:40:56,317 - INFO - app - Application starting up - Trading system initialized
2025-07-15 02:40:56,317 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 02:40:56,317 - INFO - app - Environment: PRODUCTION
2025-07-15 02:40:56,378 - INFO - app - Application startup initiated
2025-07-15 02:40:56,378 - INFO - app - Initializing core services...
2025-07-15 02:40:56,417 - INFO - app - Firebase initialized
2025-07-15 02:40:56,417 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 02:40:58,448 - INFO - app - Redis initialized
2025-07-15 02:40:58,450 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 02:40:58,452 - INFO - app - Scheduler initialized
2025-07-15 02:40:58,455 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:40:58,455 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 02:41:00,079 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:41:00,081 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:41:04,180 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 02:41:04,180 - INFO - app - Background tasks initialized
2025-07-15 02:41:04,841 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 02:41:04,841 - INFO - app - Application startup completed successfully
2025-07-15 02:41:04,841 - INFO - app - Starting cache validation task
2025-07-15 02:41:04,844 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 02:41:04,847 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 02:41:04,990 - INFO - app - Validating cache for 31 users
2025-07-15 02:41:06,886 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:41:08,921 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:41:10,959 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:41:11,004 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:41:11,048 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:41:11,105 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:41:11,139 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:41:13,219 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:41:13,227 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:41:13,238 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:41:13,254 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:41:13,260 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:41:13,266 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:41:13,273 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:41:13,280 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:41:13,293 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:41:13,321 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:41:13,329 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:41:13,346 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:41:13,358 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:41:13,358 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:41:15,609 - INFO - app - Cache validation completed
2025-07-15 02:41:19,843 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:41:19,851 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:41:19,856 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:41:19,860 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:41:19,864 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:41:19,870 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:41:19,875 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:41:19,880 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:41:19,890 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:41:19,895 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:41:19,900 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:41:19,908 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:41:19,913 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:41:19,917 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:41:19,919 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:41:19,922 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:41:19,924 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:41:19,930 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:41:19,933 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:41:19,938 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:41:19,940 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:41:19,940 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:41:20,153 - INFO - app - Application shutdown initiated
2025-07-15 02:41:20,153 - INFO - app - Scheduler shutdown completed
2025-07-15 02:41:20,154 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 02:41:21,596 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:21,600 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:21,619 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:21,641 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:21,647 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:21,651 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:21,664 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:21,847 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 02:41:21,847 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 02:41:21,913 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:21,914 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:21,933 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:21,934 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:21,934 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:21,940 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:21,941 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:21,948 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:21,951 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:21,955 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:21,956 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:21,957 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:21,971 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:21,971 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:21,972 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:21,972 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:21,979 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:21,979 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:21,979 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:22,001 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:22,001 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:22,580 - INFO - app - Redis connection closed
2025-07-15 02:41:22,580 - INFO - app - Application shutdown completed
2025-07-15 02:41:24,471 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:24,499 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:24,514 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:24,514 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:24,791 - INFO - app - Application starting up - Trading system initialized
2025-07-15 02:41:24,792 - INFO - app - SL/TP Epsilon accuracy configured: 0.00001
2025-07-15 02:41:24,792 - INFO - app - Environment: PRODUCTION
2025-07-15 02:41:24,856 - INFO - app - Application startup initiated
2025-07-15 02:41:24,856 - INFO - app - Initializing core services...
2025-07-15 02:41:24,893 - INFO - app - Firebase initialized
2025-07-15 02:41:24,893 - WARNING - app.dependencies.redis_client - Redis client not initialized, attempting late connection.
2025-07-15 02:41:26,945 - INFO - app - Redis initialized
2025-07-15 02:41:26,950 - INFO - app - [SWAP] daily_swap_charge_job triggered
2025-07-15 02:41:26,952 - INFO - app - Scheduler initialized
2025-07-15 02:41:26,955 - INFO - app.firebase_stream - Starting Firebase Admin event processing task for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:41:26,956 - INFO - app.firebase_stream - Attempting to start Firebase Admin listener for path: 'datafeeds'.
2025-07-15 02:41:27,866 - INFO - app.firebase_stream - Firebase Admin listener started successfully for path: 'datafeeds'. Queuing data for Redis publishing.
2025-07-15 02:41:27,883 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:41:32,010 - INFO - app - Cleaned up pending order stream for new trigger price format
2025-07-15 02:41:32,011 - INFO - app - Background tasks initialized
2025-07-15 02:41:32,692 - INFO - app - Service account JWT for 'barclays_service_provider' was generated and pushed to Firebase.
2025-07-15 02:41:32,692 - INFO - app - Application startup completed successfully
2025-07-15 02:41:32,692 - INFO - app - Starting cache validation task
2025-07-15 02:41:32,694 - INFO - app - Starting Barclays pending order margin checker task.
2025-07-15 02:41:32,696 - INFO - app - Starting auto-cutoff order monitoring task.
2025-07-15 02:41:32,717 - INFO - app - Validating cache for 31 users
2025-07-15 02:41:34,725 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:41:36,785 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:41:38,842 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:41:38,866 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:41:38,911 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:41:38,934 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:41:38,987 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:41:39,037 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:41:39,054 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:41:41,126 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:41:41,164 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:41:41,182 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:41:41,202 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:41:41,219 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:41:41,240 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:41:41,262 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:41:41,309 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:41:41,324 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:41:41,365 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:41:41,384 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:41:41,384 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:41:42,228 - INFO - app - Cache validation completed
2025-07-15 02:41:44,220 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:44,251 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:44,290 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:44,327 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:44,343 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:44,348 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:44,370 - INFO - app.shared_state - Initialized redis_publish_queue in shared_state with maxsize=500.
2025-07-15 02:41:44,544 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:44,564 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:44,568 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:44,568 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:44,591 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:44,591 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:44,600 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:44,621 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:44,621 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:44,644 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:44,652 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:44,666 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:44,666 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:44,672 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:44,672 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:44,687 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:44,694 - INFO - app.core.config - .env file loaded successfully.
2025-07-15 02:41:44,704 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:44,705 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:44,717 - INFO - app.core.config - Settings instance loaded. Project: Trading App, API Prefix: /api/v1
2025-07-15 02:41:44,717 - INFO - app.database.session - Attempting to connect to database using URL: mysql+aiomysql://roo...
2025-07-15 02:41:47,695 - INFO - app - Starting stale cache cleanup task
2025-07-15 02:41:49,012 - INFO - app - Found 24 static orders cache entries to check
2025-07-15 02:41:49,029 - WARNING - app - Found stale cache entry for user 9, will be refreshed on next access
2025-07-15 02:41:49,045 - WARNING - app - Found stale cache entry for user 2, will be refreshed on next access
2025-07-15 02:41:49,052 - WARNING - app - Found stale cache entry for user 3, will be refreshed on next access
2025-07-15 02:41:49,066 - WARNING - app - Found stale cache entry for user 10, will be refreshed on next access
2025-07-15 02:41:49,081 - WARNING - app - Found stale cache entry for user 17, will be refreshed on next access
2025-07-15 02:41:49,092 - WARNING - app - Found stale cache entry for user 18, will be refreshed on next access
2025-07-15 02:41:49,121 - WARNING - app - Found stale cache entry for user 23, will be refreshed on next access
2025-07-15 02:41:49,131 - WARNING - app - Found stale cache entry for user 19, will be refreshed on next access
2025-07-15 02:41:49,139 - WARNING - app - Found stale cache entry for user 8, will be refreshed on next access
2025-07-15 02:41:49,160 - WARNING - app - Found stale cache entry for user 5, will be refreshed on next access
2025-07-15 02:41:49,166 - WARNING - app - Found stale cache entry for user 24, will be refreshed on next access
2025-07-15 02:41:49,171 - WARNING - app - Found stale cache entry for user 13, will be refreshed on next access
2025-07-15 02:41:49,178 - WARNING - app - Found stale cache entry for user 16, will be refreshed on next access
2025-07-15 02:41:49,197 - WARNING - app - Found stale cache entry for user 25, will be refreshed on next access
2025-07-15 02:41:49,211 - WARNING - app - Found stale cache entry for user 12, will be refreshed on next access
2025-07-15 02:41:49,242 - WARNING - app - Found stale cache entry for user 21, will be refreshed on next access
2025-07-15 02:41:49,250 - WARNING - app - Found stale cache entry for user 22, will be refreshed on next access
2025-07-15 02:41:49,274 - WARNING - app - Found stale cache entry for user 6, will be refreshed on next access
2025-07-15 02:41:49,286 - WARNING - app - Found stale cache entry for user 20, will be refreshed on next access
2025-07-15 02:41:49,286 - INFO - app - Completed stale cache cleanup task
2025-07-15 02:42:27,578 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.142371930462998764224683664% which is below threshold 100.0%
2025-07-15 02:42:27,610 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000160-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:42:27.610798', 'account_type': 'live'}
2025-07-15 02:42:27,979 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:42:28,050 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:42:28,058 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:42:29,012 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.90974353800099082175741906% which is below threshold 100.0%
2025-07-15 02:42:29,582 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:42:29,628 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:42:29,681 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:42:29,682 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:42:43,030 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 02:42:43,031 - INFO - app.api.v1.endpoints.users - Refresh token decoded. User ID from token payload: 14
2025-07-15 02:42:43,031 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 02:42:43,033 - INFO - app.api.v1.endpoints.users - Refresh token validated successfully for user ID: 14
2025-07-15 02:42:43,046 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 02:42:43,049 - INFO - app.api.v1.endpoints.users - New access and refresh tokens generated for user ID 14 using refresh token.
2025-07-15 02:43:27,363 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.017530824886341523819632401% which is below threshold 100.0%
2025-07-15 02:43:27,454 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000161-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:43:27.454237', 'account_type': 'live'}
2025-07-15 02:43:27,789 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:43:27,882 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:43:27,893 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:43:28,813 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.81832087729163371379914881% which is below threshold 100.0%
2025-07-15 02:43:29,342 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:43:29,361 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:43:29,397 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:43:29,398 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:44:27,488 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.9955193667978256419587417836% which is below threshold 100.0%
2025-07-15 02:44:27,539 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000162-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:44:27.539198', 'account_type': 'live'}
2025-07-15 02:44:27,898 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:44:28,012 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:44:28,029 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:44:29,124 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.81034050913383493827024803% which is below threshold 100.0%
2025-07-15 02:44:29,642 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:44:29,652 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:44:29,678 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:44:29,679 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:45:27,390 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 1.046112867478891997280788874% which is below threshold 100.0%
2025-07-15 02:45:27,448 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000163-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:45:27.448021', 'account_type': 'live'}
2025-07-15 02:45:27,799 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:45:27,899 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:45:27,912 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:45:28,824 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.82345452729562376134480331% which is below threshold 100.0%
2025-07-15 02:45:29,341 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:45:29,351 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:45:29,374 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:45:29,375 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:46:27,385 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.8795485503016151002140494260% which is below threshold 100.0%
2025-07-15 02:46:27,439 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000164-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:46:27.439507', 'account_type': 'live'}
2025-07-15 02:46:27,805 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:46:27,917 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:46:27,928 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:46:28,830 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.61575332866344125080290081% which is below threshold 100.0%
2025-07-15 02:46:29,364 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:46:29,373 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:46:29,400 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:46:29,401 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:46:42,262 - INFO - app - Starting cache validation task
2025-07-15 02:46:42,274 - INFO - app - Validating cache for 31 users
2025-07-15 02:46:42,277 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,282 - WARNING - app - User 8: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,294 - WARNING - app - User 9: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,304 - WARNING - app - User 10: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,313 - WARNING - app - User 11: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,322 - WARNING - app - User 12: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,335 - WARNING - app - User 13: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,355 - WARNING - app - User 16: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,457 - WARNING - app - User 17: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,526 - WARNING - app - User 18: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,608 - WARNING - app - User 19: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,644 - WARNING - app - User 20: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,670 - WARNING - app - User 21: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,693 - WARNING - app - User 22: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,718 - WARNING - app - User 23: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,738 - WARNING - app - User 24: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,757 - WARNING - app - User 25: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,772 - WARNING - app - User 26: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,790 - WARNING - app - User 1: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,809 - WARNING - app - User 2: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,830 - WARNING - app - User 3: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,850 - WARNING - app - User 5: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,866 - WARNING - app - User 6: Missing balance/margin cache, refreshing...
2025-07-15 02:46:42,883 - INFO - app - Cache validation completed
2025-07-15 02:47:27,400 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.9199576450014278385556844401% which is below threshold 100.0%
2025-07-15 02:47:27,455 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000165-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:47:27.455012', 'account_type': 'live'}
2025-07-15 02:47:27,810 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:47:27,903 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:47:27,912 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:47:28,760 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.66630476254581779215230120% which is below threshold 100.0%
2025-07-15 02:47:29,351 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:47:29,359 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:47:29,380 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:47:29,381 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:48:27,448 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 0.9304705802078831851161098096% which is below threshold 100.0%
2025-07-15 02:48:27,496 - INFO - app.core.firebase - [FIREBASE] Payload being pushed to Firebase (all stringified): {'action': 'close_order', 'close_id': '1000166-003', 'order_id': '1000057-001', 'user_id': '4', 'order_company_name': 'BTCUSD', 'order_type': 'BUY', 'order_status': 'OPEN', 'status': 'CLOSED', 'order_quantity': '0.26000000', 'contract_value': '0.26000000', 'timestamp': '2025-07-15T09:48:27.496155', 'account_type': 'live'}
2025-07-15 02:48:27,817 - INFO - app.core.firebase - Order data (ID: 1000057-001) sent to Firebase successfully.
2025-07-15 02:48:27,938 - WARNING - app - No user data found for user 5 (live). Skipping portfolio update.
2025-07-15 02:48:27,948 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 8.
2025-07-15 02:48:28,751 - WARNING - app.services.portfolio_calculator - MARGIN CALL ALERT: User has margin level 60.67948022066776075306822628% which is below threshold 100.0%
2025-07-15 02:48:29,259 - WARNING - app - User 2 has no group_name set. Skipping portfolio update.
2025-07-15 02:48:29,282 - WARNING - app - No group settings found for group string. Skipping portfolio update for user 3.
2025-07-15 02:48:29,316 - WARNING - app - User 5 has no group_name set. Skipping portfolio update.
2025-07-15 02:48:29,317 - WARNING - app - User 6 has no group_name set. Skipping portfolio update.
2025-07-15 02:49:25,412 - INFO - app - Application shutdown initiated
2025-07-15 02:49:25,412 - INFO - app - Scheduler shutdown completed
2025-07-15 02:49:25,414 - INFO - app.firebase_stream - Firebase event processing task cancelled.
2025-07-15 02:49:26,698 - INFO - app.firebase_stream - Firebase listener closed.
2025-07-15 02:49:26,699 - INFO - app.firebase_stream - Firebase Admin event processing task finished.
2025-07-15 02:49:26,711 - INFO - app - Redis connection closed
2025-07-15 02:49:26,712 - INFO - app - Application shutdown completed
