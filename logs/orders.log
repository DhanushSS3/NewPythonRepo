2025-07-06 21:12:08,504 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 21:12:08,506 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 21:12:32,143 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 21:12:32,143 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:09:52,228 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:09:52,229 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:10:08,433 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:10:08,433 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:10:47,919 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:10:47,920 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:10:53,256 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:10:53,256 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:11:04,479 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:11:04,479 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:11:08,343 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:11:08,343 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:19:08,615 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:19:08,615 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:19:12,272 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:19:12,272 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:20:39,152 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: live
2025-07-06 23:23:33,390 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:23:33,390 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:23:42,366 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:23:42,366 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-06 23:42:35,954 - app.api.v1.endpoints.orders - INFO - [get_rejected_orders] user_type: live
2025-07-06 23:59:50,155 - INFO - orders - Application starting up - Orders logging initialized
2025-07-06 23:59:50,155 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-07 00:06:11,044 - INFO - orders - Application starting up - Orders logging initialized
2025-07-07 00:06:11,044 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-07 00:06:25,004 - INFO - orders - Application starting up - Orders logging initialized
2025-07-07 00:06:25,004 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-07 00:11:04,207 - INFO - orders - Application starting up - Orders logging initialized
2025-07-07 00:11:04,207 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-07 00:12:36,492 - INFO - orders - Application starting up - Orders logging initialized
2025-07-07 00:12:36,493 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-07 00:13:00,783 - INFO - orders - Application starting up - Orders logging initialized
2025-07-07 00:13:00,784 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-07 00:13:07,768 - INFO - orders - Starting the pending order checker background task.
2025-07-07 00:13:07,769 - INFO - orders - Starting the SL/TP checker task (triggered by market updates).
2025-07-07 00:13:09,873 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:12,287 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:14,672 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:16,893 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:19,549 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:21,484 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:23,813 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:26,102 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:27,803 - INFO - orders - Order placement request received - User: 4, Symbol: AUDCAD, Type: BUY
2025-07-07 00:13:28,146 - INFO - orders - [MARGIN_CALC] Market data for AUDCAD: {'b': '0.8888700000', 'o': '0.8888100000'}
2025-07-07 00:13:28,146 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCAD, using bid price with spread: bid=0.8888700000, ask=0.88895888700000
2025-07-07 00:13:28,146 - INFO - orders - [MARGIN_CALC] Using prices for AUDCAD: bid=0.8888700000, ask=0.88895888700000
2025-07-07 00:13:28,147 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 8.89 CAD to USD for margin_calculation (user_id: 4, position: None)
2025-07-07 00:13:28,147 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CADUSD
2025-07-07 00:13:28,148 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-07 00:13:28,148 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CADUSD, trying inverse
2025-07-07 00:13:28,148 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCAD
2025-07-07 00:13:28,148 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('1.3646600000'), 'o': Decimal('1.3646100000')}
2025-07-07 00:13:28,149 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 1.3646600000
2025-07-07 00:13:28,149 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 8.89 CAD / 1.3646600000 = 6.514443158002725953717409465 USD
2025-07-07 00:13:28,149 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCAD, Type: BUY, Qty: 0.01, Price: 0.88895888700000, Margin: 6.514443158002725953717409465, Commission: 0.00
2025-07-07 00:13:28,149 - INFO - orders - [PERF] Order processing: 0.3326s
2025-07-07 00:13:28,150 - DEBUG - orders - [DEBUG][create_user_order] Received order_data: {'order_id': '9066577232', 'order_status': 'PROCESSING', 'order_user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_price': Decimal('0.88895888700000'), 'order_quantity': Decimal('0.01'), 'contract_value': Decimal('1000.00'), 'margin': Decimal('6.514443158002725953717409465'), 'commission': Decimal('0.00'), 'status': 'OPEN', 'stop_loss': None, 'take_profit': None, 'stoploss_id': None, 'takeprofit_id': None, 'close_id': None}
2025-07-07 00:13:28,150 - DEBUG - orders - [DEBUG][create_user_order] Created OrderActionHistory record for order_id: 9066577232
2025-07-07 00:13:28,223 - INFO - orders - [PERF] Order creation: 0.0742s
2025-07-07 00:13:28,224 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-07 00:13:28,224 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-07 00:13:28,224 - INFO - orders - Publishing order update for user 4
2025-07-07 00:13:28,225 - INFO - orders - Publishing user data update for user 4
2025-07-07 00:13:28,226 - INFO - orders - Publishing market data trigger
2025-07-07 00:13:28,227 - INFO - orders - [PERF] TOTAL place_order: 0.4257s
2025-07-07 00:13:28,228 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:28,258 - ERROR - orders - Error updating portfolio: calculate_user_portfolio() missing 1 required positional argument: 'redis_client'
2025-07-07 00:13:28,261 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-07 00:13:28,264 - DEBUG - orders - [BARCLAYS] Calling send_order_to_firebase with data: {'order_id': '9066577232', 'user_id': 4, 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': 0.01, 'price': 0.888958887, 'status': 'OPEN', 'contract_value': 1000.0}
2025-07-07 00:13:28,661 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:30,709 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:33,090 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:35,438 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:37,661 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 00:13:39,925 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:36:37,098 - INFO - orders - Application starting up - Orders logging initialized
2025-07-07 01:36:37,099 - INFO - orders - SL/TP Epsilon accuracy configured: 0.00001
2025-07-07 01:36:44,000 - INFO - orders - Starting the pending order checker background task.
2025-07-07 01:36:44,002 - INFO - orders - Starting the SL/TP checker task (triggered by market updates).
2025-07-07 01:36:46,874 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:36:48,481 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:36:50,797 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:36:53,074 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:36:55,442 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:36:57,692 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:36:59,998 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:02,419 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:04,658 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:07,019 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:09,275 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:11,614 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:13,875 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:16,128 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:18,499 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:20,738 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:23,009 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:25,335 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:28,104 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:29,335 - INFO - orders - Order close request received - Order ID: 1621588803, User ID: 4, Close Price: 94.298
2025-07-07 01:37:29,336 - INFO - orders - user_to_operate_on: <app.database.models.User object at 0x000002403B825E50>, type: <class 'app.database.models.User'>, user_type: live, attrs: ['__abstract__', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__mapper__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__table__', '__table_args__', '__tablename__', '__weakref__', '_sa_class_manager', '_sa_instance_state', '_sa_registry', 'account_number', 'address_proof', 'address_proof_image', 'bank_account_number', 'bank_branch_name', 'bank_holder_name', 'bank_ifsc_code', 'city', 'country', 'created_at', 'email', 'fund_manager', 'group_name', 'hashed_password', 'id', 'id_proof', 'id_proof_image', 'isActive', 'is_self_trading', 'is_service_account', 'leverage', 'margin', 'metadata', 'money_requests', 'name', 'net_profit', 'orders', 'otps', 'phone_number', 'pincode', 'referred_by_id', 'reffered_code', 'registry', 'rock_orders', 'security_answer', 'security_question', 'state', 'status', 'updated_at', 'user_favorites', 'user_type', 'wallet_balance', 'wallet_transactions']
2025-07-07 01:37:29,336 - INFO - orders - Using order model: user_orders for user 4 (user_type: live)
2025-07-07 01:37:29,336 - INFO - orders - Request to close order 1621588803 for user 4 (user_type: live) with price 94.298. Frontend provided type: BUY, company: AUDJPY, status: CLOSED, frontend_status: CLOSED.
2025-07-07 01:37:29,341 - INFO - orders - User group: Standard, sending_orders setting: barclays
2025-07-07 01:37:29,342 - INFO - orders - Live user 4 from group 'Standard' has 'sending_orders' set to 'barclays'. Pushing close request to Firebase and skipping local DB update.
2025-07-07 01:37:29,349 - INFO - orders - [FIREBASE_CLOSE_REQUEST] Preparing to send payload for user-initiated close: {'order_id': '1621588803', 'close_price': '94.298', 'user_id': 4, 'order_type': 'BUY', 'order_company_name': 'AUDJPY', 'order_quantity': '0.01000000', 'contract_value': '1000.00000000', 'order_status': 'CLOSED', 'status': 'CLOSED', 'action': 'close_order', 'close_id': '2392229723'}
2025-07-07 01:37:30,569 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:32,807 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:35,117 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:37,614 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:39,709 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:42,009 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:44,379 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:46,647 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:48,991 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:51,261 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:53,573 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:55,868 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:37:58,212 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:00,576 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:02,828 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:05,064 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:07,467 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:09,690 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:12,348 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:14,713 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:16,908 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:19,194 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:21,476 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:23,810 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:26,103 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:28,401 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:30,678 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:32,986 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:35,393 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:37,608 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:39,890 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:42,165 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:44,460 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:46,767 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:49,058 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:51,342 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:53,661 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:55,955 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:38:58,244 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:00,561 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:02,881 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:05,141 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:07,430 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:09,790 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:12,022 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:14,576 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:16,925 - INFO - orders - Market data update received, triggering SL/TP check
2025-07-07 01:39:19,208 - INFO - orders - Market data update received, triggering SL/TP check
