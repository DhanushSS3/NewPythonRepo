2025-07-22 03:20:03,635 - ERROR - database - Error in database session: 500: Failed to record rejected order: name 'RejectedOrder' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 5331, in service_provider_rejected_order
    select(RejectedOrder)
           ^^^^^^^^^^^^^
NameError: name 'RejectedOrder' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 5384, in service_provider_rejected_order
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Failed to record rejected order: name 'RejectedOrder' is not defined
2025-07-22 03:30:31,869 - ERROR - database - Error in database session: 401: Could not validate credentials
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 94, in decode_token
    payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 174, in decode
    _validate_claims(
    ~~~~~~~~~~~~~~~~^
        claims,
        ^^^^^^^
    ...<5 lines>...
        options=defaults,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 497, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 331, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 444, in get_user_from_service_or_user_token
    payload = decode_token(token)
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 99, in decode_token
    raise JWTError("Could not validate credentials")
jose.exceptions.JWTError: Could not validate credentials

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 497, in get_user_from_service_or_user_token
    raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Could not validate credentials
2025-07-22 03:30:31,945 - ERROR - database - Error in database session: 401: Could not validate credentials
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 94, in decode_token
    payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 174, in decode
    _validate_claims(
    ~~~~~~~~~~~~~~~~^
        claims,
        ^^^^^^^
    ...<5 lines>...
        options=defaults,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 497, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\jose\jwt.py", line 331, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
jose.exceptions.ExpiredSignatureError: Signature has expired.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 444, in get_user_from_service_or_user_token
    payload = decode_token(token)
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 99, in decode_token
    raise JWTError("Could not validate credentials")
jose.exceptions.JWTError: Could not validate credentials

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\core\security.py", line 497, in get_user_from_service_or_user_token
    raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: Could not validate credentials
2025-07-22 03:56:52,270 - ERROR - database - Error in database session: 500: An error occurred while refreshing token.
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 345, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 376, in refresh_access_token
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: An error occurred while refreshing token.
2025-07-22 03:56:52,295 - ERROR - database - Error in database session: 500: An error occurred while refreshing token.
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 345, in refresh_access_token
     raise HTTPException(
    ...<3 lines>...
    )
fastapi.exceptions.HTTPException: 401: User not found or inactive

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\users.py", line 376, in refresh_access_token
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: An error occurred while refreshing token.
2025-07-22 21:31:22,598 - ERROR - database - Error in database session: 503: Redis unavailable
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\dependencies\redis_client.py", line 44, in get_redis_client
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 503: Redis unavailable
2025-07-22 21:42:03,492 - ERROR - database - Error in database session: Expected ASGI message "websocket.accept", "websocket.close" or "websocket.http.response.start", but got 'websocket.send'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 383, in app
    await dependant.call(**solved_result.values)
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\admin_wallet.py", line 105, in admin_raw_market_data_websocket
    await websocket.send_text(json.dumps({
    ...<2 lines>...
    }, cls=DecimalEncoder))
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\starlette\websockets.py", line 165, in send_text
    await self.send({"type": "websocket.send", "text": data})
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\starlette\websockets.py", line 65, in send
    raise RuntimeError(
    ...<2 lines>...
    )
RuntimeError: Expected ASGI message "websocket.accept", "websocket.close" or "websocket.http.response.start", but got 'websocket.send'
2025-07-22 22:43:47,658 - ERROR - database - Error in database session: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'message'), 'msg': 'Field required', 'input': OrderResponse(order_id='1000333-001', order_user_id=14, order_company_name='AUDJPY', order_type='BUY', order_quantity=Decimal('0.01000000'), order_price=Decimal('97.09700000'), status='CLOSED', stop_loss=None, take_profit=None, order_status='OPEN', contract_value=Decimal('1000.00000000'), margin=Decimal('6.52134765'), created_at=datetime.datetime(2025, 7, 16, 1, 51, 54), updated_at=datetime.datetime(2025, 7, 22, 22, 43, 47), net_profit=None, close_price=Decimal('96.62400000'), commission=Decimal('0.10000000'), swap=None, cancel_message=None, close_message='CLOSED', stoploss_id=None, takeprofit_id=None, close_id='1223-003')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'message'), 'msg': 'Field required', 'input': OrderResponse(order_id='1000333-001', order_user_id=14, order_company_name='AUDJPY', order_type='BUY', order_quantity=Decimal('0.01000000'), order_price=Decimal('97.09700000'), status='CLOSED', stop_loss=None, take_profit=None, order_status='OPEN', contract_value=Decimal('1000.00000000'), margin=Decimal('6.52134765'), created_at=datetime.datetime(2025, 7, 16, 1, 51, 54), updated_at=datetime.datetime(2025, 7, 22, 22, 43, 47), net_profit=None, close_price=Decimal('96.62400000'), commission=Decimal('0.10000000'), swap=None, cancel_message=None, close_message='CLOSED', stoploss_id=None, takeprofit_id=None, close_id='1223-003')}

2025-07-22 22:45:16,023 - ERROR - database - Error in database session: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'message'), 'msg': 'Field required', 'input': OrderResponse(order_id='1000330-001', order_user_id=14, order_company_name='BTCUSD', order_type='BUY', order_quantity=Decimal('0.40000000'), order_price=Decimal('141908.50000000'), status='CLOSED', stop_loss=None, take_profit=None, order_status='OPEN', contract_value=Decimal('0.40000000'), margin=Decimal('9422.73000000'), created_at=datetime.datetime(2025, 7, 15, 23, 0, 9), updated_at=datetime.datetime(2025, 7, 22, 22, 45, 16), net_profit=None, close_price=Decimal('118669.70000000'), commission=Decimal('235.57000000'), swap=None, cancel_message=None, close_message='CLOSED', stoploss_id=None, takeprofit_id=None, close_id='1224-003')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'message'), 'msg': 'Field required', 'input': OrderResponse(order_id='1000330-001', order_user_id=14, order_company_name='BTCUSD', order_type='BUY', order_quantity=Decimal('0.40000000'), order_price=Decimal('141908.50000000'), status='CLOSED', stop_loss=None, take_profit=None, order_status='OPEN', contract_value=Decimal('0.40000000'), margin=Decimal('9422.73000000'), created_at=datetime.datetime(2025, 7, 15, 23, 0, 9), updated_at=datetime.datetime(2025, 7, 22, 22, 45, 16), net_profit=None, close_price=Decimal('118669.70000000'), commission=Decimal('235.57000000'), swap=None, cancel_message=None, close_message='CLOSED', stoploss_id=None, takeprofit_id=None, close_id='1224-003')}

2025-07-22 22:45:23,428 - ERROR - database - Error in database session: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'message'), 'msg': 'Field required', 'input': OrderResponse(order_id='1000330-001', order_user_id=14, order_company_name='BTCUSD', order_type='BUY', order_quantity=Decimal('0.40000000'), order_price=Decimal('141908.50000000'), status='CLOSED', stop_loss=None, take_profit=None, order_status='OPEN', contract_value=Decimal('0.40000000'), margin=Decimal('9422.73000000'), created_at=datetime.datetime(2025, 7, 15, 23, 0, 9), updated_at=datetime.datetime(2025, 7, 22, 22, 45, 23), net_profit=None, close_price=Decimal('118669.70000000'), commission=Decimal('235.57000000'), swap=None, cancel_message=None, close_message='CLOSED', stoploss_id=None, takeprofit_id=None, close_id='1225-003')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\database\session.py", line 70, in get_db
    yield session
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'message'), 'msg': 'Field required', 'input': OrderResponse(order_id='1000330-001', order_user_id=14, order_company_name='BTCUSD', order_type='BUY', order_quantity=Decimal('0.40000000'), order_price=Decimal('141908.50000000'), status='CLOSED', stop_loss=None, take_profit=None, order_status='OPEN', contract_value=Decimal('0.40000000'), margin=Decimal('9422.73000000'), created_at=datetime.datetime(2025, 7, 15, 23, 0, 9), updated_at=datetime.datetime(2025, 7, 22, 22, 45, 23), net_profit=None, close_price=Decimal('118669.70000000'), commission=Decimal('235.57000000'), swap=None, cancel_message=None, close_message='CLOSED', stoploss_id=None, takeprofit_id=None, close_id='1225-003')}

