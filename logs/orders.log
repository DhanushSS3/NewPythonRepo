2025-07-25 02:29:55,465 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-25 02:29:56,502 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-25 02:29:56,502 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-25 02:29:56,502 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-25 02:29:56,503 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-25 02:29:56,545 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-25 02:29:56,545 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-25 02:29:57,776 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 27, Symbol AUDJPY
2025-07-25 02:29:57,777 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 27, Symbol AUDJPY: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-25 02:29:57,777 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 27, Symbol AUDJPY: AllMarginsPerLot=[Decimal('648.460213'), Decimal('651.498922')], HighestMarginPerLot=651.498922
2025-07-25 02:29:57,777 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 27, Symbol AUDJPY: CalculatedTotalMargin=13.03
2025-07-25 02:29:57,777 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 27, Symbol AUDUSD
2025-07-25 02:29:57,777 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 27, Symbol AUDUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:29:57,777 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 27, Symbol AUDUSD: AllMarginsPerLot=[Decimal('652')], HighestMarginPerLot=652
2025-07-25 02:29:57,777 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 27, Symbol AUDUSD: CalculatedTotalMargin=6.52
2025-07-25 02:29:57,777 - INFO - orders - [TOTAL_USER_MARGIN] User 27 total margin across all symbols: 19.55
2025-07-25 02:29:57,916 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 28, Symbol EURPLN
2025-07-25 02:29:57,916 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 28, Symbol EURPLN: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-25 02:29:57,916 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 28, Symbol EURPLN: AllMarginsPerLot=[Decimal('4257'), Decimal('4257')], HighestMarginPerLot=4257
2025-07-25 02:29:57,916 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 28, Symbol EURPLN: CalculatedTotalMargin=85.14
2025-07-25 02:29:57,916 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 28, Symbol BTCUSD
2025-07-25 02:29:57,916 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 28, Symbol BTCUSD: TotalBuyQty=0.40000000, TotalSellQty=0, NetQty=0.40000000, IsHedged=False
2025-07-25 02:29:57,916 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 28, Symbol BTCUSD: AllMarginsPerLot=[Decimal('24050.95')], HighestMarginPerLot=24050.95
2025-07-25 02:29:57,916 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 28, Symbol BTCUSD: CalculatedTotalMargin=9620.38
2025-07-25 02:29:57,916 - INFO - orders - [TOTAL_USER_MARGIN] User 28 total margin across all symbols: 9705.52
2025-07-25 02:30:01,502 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-25 02:30:10,326 - INFO - orders - Starting the users with orders cache updater task.
2025-07-25 02:30:12,979 - INFO - orders - Order placement request received - User: 4, Symbol: AUDCHF, Type: BUY
2025-07-25 02:30:13,008 - INFO - orders - [PERF] Step: Extract order details: 0.0000s
2025-07-25 02:30:13,017 - INFO - orders - [PERF] Step: Fetch user data: 0.0093s
2025-07-25 02:30:13,017 - INFO - orders - [PERF] Step: Prepare async tasks: 0.0096s
2025-07-25 02:30:13,032 - INFO - orders - [PERF] Individual async task 'raw_market_data' took 0.0111s
2025-07-25 02:30:13,032 - INFO - orders - [PERF] Individual async task 'batch_cache_data' took 0.0140s
2025-07-25 02:30:13,048 - INFO - orders - [PERF] Individual async task 'external_symbol_info' took 0.0295s
2025-07-25 02:30:13,079 - INFO - orders - [PERF] Individual async task 'open_orders' took 0.0586s
2025-07-25 02:30:13,206 - INFO - orders - [PERF] Individual async task 'order_id' took 0.1843s
2025-07-25 02:30:13,209 - INFO - orders - [PERF] Step: Await all async tasks: 0.1918s
2025-07-25 02:30:13,210 - INFO - orders - [PERF] Step: Extract and post-process async results: 0.0000s
2025-07-25 02:30:13,210 - INFO - orders - [PERF] Step: Validate critical data: 0.0000s
2025-07-25 02:30:13,211 - INFO - orders - [PERF] Step: Fetch group settings: 0.0000s
2025-07-25 02:30:13,212 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': Decimal('0.5225900000'), 'o': Decimal('0.5225400000')}
2025-07-25 02:30:13,212 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5225900000, ask=0.52264225900000
2025-07-25 02:30:13,212 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5225900000, ask=0.52264225900000
2025-07-25 02:30:13,220 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5.23 CHF to USD for margin_calculation (user_id: 4, position: None)
2025-07-25 02:30:13,220 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-25 02:30:13,227 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-25 02:30:13,227 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-25 02:30:13,227 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-25 02:30:13,232 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7965500000'), 'o': Decimal('0.7965100000')}
2025-07-25 02:30:13,232 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7965500000
2025-07-25 02:30:13,233 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5.23 CHF / 0.7965500000 = 6.565815077521812817776661854 USD
2025-07-25 02:30:13,233 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: BUY, Qty: 0.01, Price: 0.52264225900000, Margin: 6.565815077521812817776661854, Commission: 0.10
2025-07-25 02:30:13,233 - INFO - orders - [PERF] Step: Margin calculation: 0.0217s
2025-07-25 02:30:13,234 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 11 positions for User 4, Symbol AUDCHF
2025-07-25 02:30:13,234 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.06000000, TotalSellQty=0.05000000, NetQty=0.06000000, IsHedged=True
2025-07-25 02:30:13,234 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:30:13,235 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=39.42
2025-07-25 02:30:13,235 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 12 positions for User 4, Symbol AUDCHF
2025-07-25 02:30:13,235 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.07000000, TotalSellQty=0.05000000, NetQty=0.07000000, IsHedged=True
2025-07-25 02:30:13,235 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('656.5815077521812817776661854')], HighestMarginPerLot=657.059939
2025-07-25 02:30:13,235 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=45.99
2025-07-25 02:30:13,236 - INFO - orders - [PERF] Step: Hedged margin calculation: 0.0030s
2025-07-25 02:30:13,237 - INFO - orders - [PERF] Step: User lock and margin update: 0.0000s
2025-07-25 02:30:13,237 - INFO - orders - [PERF] Step: Prepare result dict: 0.0000s
2025-07-25 02:30:13,237 - INFO - orders - [PERF] TOTAL process_new_order_ultra_optimized: 0.2294s
2025-07-25 02:30:13,237 - INFO - orders - [PERF] Order processing: 0.2296s
2025-07-25 02:30:13,481 - INFO - orders - [PERF] Order creation: 0.2442s
2025-07-25 02:30:13,482 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-25 02:30:13,482 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-25 02:30:13,482 - INFO - orders - [PERF] TOTAL place_order: 0.5048s
2025-07-25 02:30:14,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDJPY
2025-07-25 02:30:14,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-25 02:30:14,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('661.217113'), Decimal('661.197136'), Decimal('661.11035')], HighestMarginPerLot=661.217113
2025-07-25 02:30:14,162 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=13.22
2025-07-25 02:30:14,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol CADCHF
2025-07-25 02:30:14,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:30:14,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.183336')], HighestMarginPerLot=731.183336
2025-07-25 02:30:14,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADCHF: CalculatedTotalMargin=7.31
2025-07-25 02:30:14,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 11 positions for User 4, Symbol AUDCHF
2025-07-25 02:30:14,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.06000000, TotalSellQty=0.05000000, NetQty=0.06000000, IsHedged=True
2025-07-25 02:30:14,163 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:30:14,164 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=39.42
2025-07-25 02:30:14,164 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 59.95
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDJPY
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('661.217113'), Decimal('661.197136'), Decimal('661.11035')], HighestMarginPerLot=661.217113
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=13.22
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol CADCHF
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.183336')], HighestMarginPerLot=731.183336
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADCHF: CalculatedTotalMargin=7.31
2025-07-25 02:30:14,342 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 11 positions for User 4, Symbol AUDCHF
2025-07-25 02:30:14,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.06000000, TotalSellQty=0.05000000, NetQty=0.06000000, IsHedged=True
2025-07-25 02:30:14,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:30:14,343 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=39.42
2025-07-25 02:30:14,343 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 59.95
2025-07-25 02:30:14,358 - INFO - orders - Background balance/margin cache updated for user 4: balance=222.84000000, margin=59.95
2025-07-25 02:30:15,134 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-25 02:30:15,559 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 4
2025-07-25 02:30:21,719 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDJPY
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('661.217113'), Decimal('661.197136'), Decimal('661.11035')], HighestMarginPerLot=661.217113
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=13.22
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol CADCHF
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.183336')], HighestMarginPerLot=731.183336
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADCHF: CalculatedTotalMargin=7.31
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 12 positions for User 4, Symbol AUDCHF
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.07000000, TotalSellQty=0.05000000, NetQty=0.07000000, IsHedged=True
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:30:21,720 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=45.99
2025-07-25 02:30:21,720 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 66.52
2025-07-25 02:32:12,170 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-25 02:32:13,427 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-25 02:32:13,427 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-25 02:32:13,428 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-25 02:32:13,428 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-25 02:32:13,492 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-25 02:32:13,492 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-25 02:32:14,988 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 9, Symbol JP225
2025-07-25 02:32:14,989 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol JP225: TotalBuyQty=10.00000000, TotalSellQty=0, NetQty=10.00000000, IsHedged=False
2025-07-25 02:32:14,989 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 9, Symbol JP225: AllMarginsPerLot=[Decimal('2.842981409')], HighestMarginPerLot=2.842981409
2025-07-25 02:32:14,989 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 9, Symbol JP225: CalculatedTotalMargin=28.43
2025-07-25 02:32:14,989 - INFO - orders - [TOTAL_USER_MARGIN] User 9 total margin across all symbols: 28.43
2025-07-25 02:32:15,113 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 10, Symbol AUDJPY
2025-07-25 02:32:15,113 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-25 02:32:15,113 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 10, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.942134'), Decimal('658.016896'), Decimal('657.957697')], HighestMarginPerLot=658.016896
2025-07-25 02:32:15,113 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 10, Symbol AUDJPY: CalculatedTotalMargin=13.16
2025-07-25 02:32:15,113 - INFO - orders - [TOTAL_USER_MARGIN] User 10 total margin across all symbols: 13.16
2025-07-25 02:32:15,743 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 11, Symbol AUDJPY
2025-07-25 02:32:15,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:32:15,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 11, Symbol AUDJPY: AllMarginsPerLot=[Decimal('96717')], HighestMarginPerLot=96717
2025-07-25 02:32:15,744 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 11, Symbol AUDJPY: CalculatedTotalMargin=967.17
2025-07-25 02:32:15,744 - INFO - orders - [TOTAL_USER_MARGIN] User 11 total margin across all symbols: 967.17
2025-07-25 02:32:16,052 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 13, Symbol XAGUSD
2025-07-25 02:32:16,053 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:32:16,053 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 13, Symbol XAGUSD: AllMarginsPerLot=[Decimal('1948')], HighestMarginPerLot=1948
2025-07-25 02:32:16,053 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 13, Symbol XAGUSD: CalculatedTotalMargin=19.48
2025-07-25 02:32:16,053 - INFO - orders - [TOTAL_USER_MARGIN] User 13 total margin across all symbols: 19.48
2025-07-25 02:32:17,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol AUDCAD
2025-07-25 02:32:17,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:32:17,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol AUDCAD: AllMarginsPerLot=[Decimal('657.55194')], HighestMarginPerLot=657.55194
2025-07-25 02:32:17,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol AUDCAD: CalculatedTotalMargin=6.58
2025-07-25 02:32:17,203 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 20, Symbol EURUSD
2025-07-25 02:32:17,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:32:17,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 20, Symbol EURUSD: AllMarginsPerLot=[Decimal('1180')], HighestMarginPerLot=1180
2025-07-25 02:32:17,204 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 20, Symbol EURUSD: CalculatedTotalMargin=11.80
2025-07-25 02:32:17,204 - INFO - orders - [TOTAL_USER_MARGIN] User 20 total margin across all symbols: 18.38
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 22, Symbol AUDJPY
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.694948'), Decimal('657.769712'), Decimal('657.703888')], HighestMarginPerLot=657.769712
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 22, Symbol AUDJPY: CalculatedTotalMargin=13.16
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 2 positions for User 22, Symbol CHFSGD
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol CHFSGD: TotalBuyQty=0.02000000, TotalSellQty=0, NetQty=0.02000000, IsHedged=False
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol CHFSGD: AllMarginsPerLot=[Decimal('1257.355412'), Decimal('1257.355412')], HighestMarginPerLot=1257.355412
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 22, Symbol CHFSGD: CalculatedTotalMargin=25.15
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 4 positions for User 22, Symbol AUDCHF
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDCHF: TotalBuyQty=0.03000000, TotalSellQty=0.01000000, NetQty=0.03000000, IsHedged=True
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 22, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:32:17,793 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 22, Symbol AUDCHF: CalculatedTotalMargin=19.71
2025-07-25 02:32:17,793 - INFO - orders - [TOTAL_USER_MARGIN] User 22 total margin across all symbols: 58.02
2025-07-25 02:32:18,373 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 26, Symbol AUDJPY
2025-07-25 02:32:18,374 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: TotalBuyQty=0.03000000, TotalSellQty=0, NetQty=0.03000000, IsHedged=False
2025-07-25 02:32:18,374 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 26, Symbol AUDJPY: AllMarginsPerLot=[Decimal('657.872549'), Decimal('657.877022'), Decimal('657.861456')], HighestMarginPerLot=657.877022
2025-07-25 02:32:18,374 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 26, Symbol AUDJPY: CalculatedTotalMargin=19.74
2025-07-25 02:32:18,374 - INFO - orders - [TOTAL_USER_MARGIN] User 26 total margin across all symbols: 19.74
2025-07-25 02:32:18,430 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-25 02:32:23,428 - INFO - orders - Starting the users with orders cache updater task.
2025-07-25 02:32:23,860 - INFO - orders - Order placement request received - User: 4, Symbol: AUDCHF, Type: BUY
2025-07-25 02:32:23,885 - INFO - orders - [PERF] Step: Extract order details: 0.0000s
2025-07-25 02:32:23,890 - INFO - orders - [PERF] Step: Fetch user data: 0.0048s
2025-07-25 02:32:23,890 - INFO - orders - [PERF] Step: Prepare async tasks: 0.0053s
2025-07-25 02:32:23,897 - INFO - orders - [PERF] Individual async task 'raw_market_data' took 0.0024s
2025-07-25 02:32:23,898 - INFO - orders - [PERF] Individual async task 'batch_cache_data' took 0.0070s
2025-07-25 02:32:23,923 - INFO - orders - [PERF] Individual async task 'external_symbol_info' took 0.0312s
2025-07-25 02:32:23,960 - INFO - orders - [PERF] Individual async task 'open_orders' took 0.0648s
2025-07-25 02:32:24,086 - INFO - orders - [PERF] Individual async task 'order_id' took 0.1905s
2025-07-25 02:32:24,086 - INFO - orders - [PERF] Step: Await all async tasks: 0.1953s
2025-07-25 02:32:24,086 - INFO - orders - [PERF] Step: Extract and post-process async results: 0.0000s
2025-07-25 02:32:24,086 - INFO - orders - [PERF] Step: Validate critical data: 0.0000s
2025-07-25 02:32:24,086 - INFO - orders - [PERF] Step: Fetch group settings: 0.0000s
2025-07-25 02:32:24,086 - INFO - orders - [MARGIN_CALC] Market data for AUDCHF: {'b': Decimal('0.5225000000'), 'o': Decimal('0.5224500000')}
2025-07-25 02:32:24,086 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDCHF, using bid price with spread: bid=0.5225000000, ask=0.52255225000000
2025-07-25 02:32:24,086 - INFO - orders - [MARGIN_CALC] Using prices for AUDCHF: bid=0.5225000000, ask=0.52255225000000
2025-07-25 02:32:24,087 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 5.23 CHF to USD for margin_calculation (user_id: 4, position: None)
2025-07-25 02:32:24,087 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: CHFUSD
2025-07-25 02:32:24,088 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-25 02:32:24,088 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for CHFUSD, trying inverse
2025-07-25 02:32:24,088 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDCHF
2025-07-25 02:32:24,089 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('0.7965400000'), 'o': Decimal('0.7965100000')}
2025-07-25 02:32:24,089 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 0.7965400000
2025-07-25 02:32:24,089 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 5.23 CHF / 0.7965400000 = 6.565897506716549074748286338 USD
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDCHF, Type: BUY, Qty: 0.01, Price: 0.52255225000000, Margin: 6.565897506716549074748286338, Commission: 0.10
2025-07-25 02:32:24,089 - INFO - orders - [PERF] Step: Margin calculation: 0.0027s
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 12 positions for User 4, Symbol AUDCHF
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.07000000, TotalSellQty=0.05000000, NetQty=0.07000000, IsHedged=True
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=45.99
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 13 positions for User 4, Symbol AUDCHF
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.08000000, TotalSellQty=0.05000000, NetQty=0.08000000, IsHedged=True
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('656.5897506716549074748286338')], HighestMarginPerLot=657.059939
2025-07-25 02:32:24,089 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=52.56
2025-07-25 02:32:24,089 - INFO - orders - [PERF] Step: Hedged margin calculation: 0.0006s
2025-07-25 02:32:24,089 - INFO - orders - [PERF] Step: User lock and margin update: 0.0000s
2025-07-25 02:32:24,089 - INFO - orders - [PERF] Step: Prepare result dict: 0.0000s
2025-07-25 02:32:24,089 - INFO - orders - [PERF] TOTAL process_new_order_ultra_optimized: 0.2046s
2025-07-25 02:32:24,090 - INFO - orders - [PERF] Order processing: 0.2047s
2025-07-25 02:32:24,863 - INFO - orders - [PERF] Order creation: 0.7736s
2025-07-25 02:32:24,863 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-25 02:32:24,863 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-25 02:32:24,863 - INFO - orders - [PERF] TOTAL place_order: 1.0048s
2025-07-25 02:32:25,492 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDJPY
2025-07-25 02:32:25,492 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-25 02:32:25,492 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('661.217113'), Decimal('661.197136'), Decimal('661.11035')], HighestMarginPerLot=661.217113
2025-07-25 02:32:25,492 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=13.22
2025-07-25 02:32:25,492 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol CADCHF
2025-07-25 02:32:25,492 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:32:25,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.183336')], HighestMarginPerLot=731.183336
2025-07-25 02:32:25,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADCHF: CalculatedTotalMargin=7.31
2025-07-25 02:32:25,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 12 positions for User 4, Symbol AUDCHF
2025-07-25 02:32:25,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.07000000, TotalSellQty=0.05000000, NetQty=0.07000000, IsHedged=True
2025-07-25 02:32:25,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:32:25,493 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=45.99
2025-07-25 02:32:25,493 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 66.52
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDJPY
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('661.217113'), Decimal('661.197136'), Decimal('661.11035')], HighestMarginPerLot=661.217113
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=13.22
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol CADCHF
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.183336')], HighestMarginPerLot=731.183336
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADCHF: CalculatedTotalMargin=7.31
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 12 positions for User 4, Symbol AUDCHF
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.07000000, TotalSellQty=0.05000000, NetQty=0.07000000, IsHedged=True
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:32:25,665 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=45.99
2025-07-25 02:32:25,665 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 66.52
2025-07-25 02:32:25,669 - INFO - orders - Background balance/margin cache updated for user 4: balance=222.84000000, margin=66.52
2025-07-25 02:32:26,460 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-25 02:32:26,819 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 4
2025-07-25 02:32:29,084 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 3 positions for User 4, Symbol AUDJPY
2025-07-25 02:32:29,084 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: TotalBuyQty=0.01000000, TotalSellQty=0.02000000, NetQty=0.02000000, IsHedged=True
2025-07-25 02:32:29,084 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDJPY: AllMarginsPerLot=[Decimal('661.217113'), Decimal('661.197136'), Decimal('661.11035')], HighestMarginPerLot=661.217113
2025-07-25 02:32:29,084 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDJPY: CalculatedTotalMargin=13.22
2025-07-25 02:32:29,084 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 4, Symbol CADCHF
2025-07-25 02:32:29,085 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: TotalBuyQty=0.01000000, TotalSellQty=0, NetQty=0.01000000, IsHedged=False
2025-07-25 02:32:29,085 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol CADCHF: AllMarginsPerLot=[Decimal('731.183336')], HighestMarginPerLot=731.183336
2025-07-25 02:32:29,085 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol CADCHF: CalculatedTotalMargin=7.31
2025-07-25 02:32:29,085 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 12 positions for User 4, Symbol AUDCHF
2025-07-25 02:32:29,085 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: TotalBuyQty=0.07000000, TotalSellQty=0.05000000, NetQty=0.07000000, IsHedged=True
2025-07-25 02:32:29,085 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 4, Symbol AUDCHF: AllMarginsPerLot=[Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939'), Decimal('657.059939')], HighestMarginPerLot=657.059939
2025-07-25 02:32:29,085 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 4, Symbol AUDCHF: CalculatedTotalMargin=45.99
2025-07-25 02:32:29,085 - INFO - orders - [TOTAL_USER_MARGIN] User 4 total margin across all symbols: 66.52
2025-07-25 02:34:55,534 - INFO - orders - [CLEANUP] Starting pending order stream cleanup
2025-07-25 02:34:56,647 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream
2025-07-25 02:34:56,647 - INFO - orders - [CLEANUP] Pending order stream cleanup completed
2025-07-25 02:34:56,647 - INFO - orders - [CLEANUP] Starting pending order stream cleanup with trigger price validation
2025-07-25 02:34:56,648 - INFO - orders - [PENDING_TRIGGER_WORKER] Starting pending order trigger worker
2025-07-25 02:34:56,709 - INFO - orders - [CLEANUP] Cleared pending_trigger_queue stream to remove old format entries
2025-07-25 02:34:56,709 - INFO - orders - [CLEANUP] Pending order stream cleanup with trigger price validation completed
2025-07-25 02:35:01,822 - INFO - orders - Starting the simplified pending order checker background task.
2025-07-25 02:35:06,648 - INFO - orders - Starting the users with orders cache updater task.
2025-07-25 02:35:15,237 - INFO - orders - Fetching rejected orders for user: 31
2025-07-25 02:35:15,262 - INFO - orders - Found 0 rejected orders for user 31
2025-07-25 02:35:24,393 - INFO - orders - Order placement request received - User: 31, Symbol: AUDJPY, Type: BUY
2025-07-25 02:35:24,399 - INFO - orders - [PERF] Step: Extract order details: 0.0000s
2025-07-25 02:35:24,402 - INFO - orders - [PERF] Step: Fetch user data: 0.0026s
2025-07-25 02:35:24,403 - INFO - orders - [PERF] Step: Prepare async tasks: 0.0036s
2025-07-25 02:35:24,433 - INFO - orders - [PERF] Individual async task 'batch_cache_data' took 0.0292s
2025-07-25 02:35:24,435 - INFO - orders - [PERF] Individual async task 'external_symbol_info' took 0.0294s
2025-07-25 02:35:24,436 - INFO - orders - [PERF] Individual async task 'raw_market_data' took 0.0229s
2025-07-25 02:35:24,441 - INFO - orders - [PERF] Individual async task 'open_orders' took 0.0239s
2025-07-25 02:35:24,495 - INFO - orders - [PERF] Individual async task 'order_id' took 0.0766s
2025-07-25 02:35:24,496 - INFO - orders - [PERF] Step: Await all async tasks: 0.0925s
2025-07-25 02:35:24,496 - INFO - orders - [PERF] Step: Extract and post-process async results: 0.0000s
2025-07-25 02:35:24,496 - INFO - orders - [PERF] Step: Validate critical data: 0.0000s
2025-07-25 02:35:24,496 - INFO - orders - [PERF] Step: Fetch group settings: 0.0000s
2025-07-25 02:35:24,496 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': Decimal('97.0000000000'), 'o': Decimal('96.9950000000')}
2025-07-25 02:35:24,496 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=97.0000000000, ask=97.00970000000000
2025-07-25 02:35:24,496 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=97.0000000000, ask=97.00970000000000
2025-07-25 02:35:24,499 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 970.10 JPY to USD for margin_calculation (user_id: 31, position: None)
2025-07-25 02:35:24,499 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-25 02:35:24,502 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-25 02:35:24,502 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-25 02:35:24,502 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-25 02:35:24,505 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.8200000000'), 'o': Decimal('147.8160000000')}
2025-07-25 02:35:24,506 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.8200000000
2025-07-25 02:35:24,506 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 970.10 JPY / 147.8200000000 = 6.562711405763766743336490326 USD
2025-07-25 02:35:24,506 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: BUY, Qty: 0.01, Price: 97.00970000000000, Margin: 6.562711405763766743336490326, Commission: 0.10
2025-07-25 02:35:24,506 - INFO - orders - [PERF] Step: Margin calculation: 0.0100s
2025-07-25 02:35:24,507 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 31, Symbol AUDJPY. Returning zero margin.
2025-07-25 02:35:24,507 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 31, Symbol AUDJPY
2025-07-25 02:35:24,507 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 31, Symbol AUDJPY: TotalBuyQty=0.01, TotalSellQty=0, NetQty=0.01, IsHedged=False
2025-07-25 02:35:24,507 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 31, Symbol AUDJPY: AllMarginsPerLot=[Decimal('656.2711405763766743336490326')], HighestMarginPerLot=656.2711405763766743336490326
2025-07-25 02:35:24,507 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 31, Symbol AUDJPY: CalculatedTotalMargin=6.56
2025-07-25 02:35:24,508 - INFO - orders - [PERF] Step: Hedged margin calculation: 0.0014s
2025-07-25 02:35:24,508 - INFO - orders - [PERF] Step: User lock and margin update: 0.0000s
2025-07-25 02:35:24,508 - INFO - orders - [PERF] Step: Prepare result dict: 0.0000s
2025-07-25 02:35:24,508 - INFO - orders - [PERF] TOTAL process_new_order_ultra_optimized: 0.1093s
2025-07-25 02:35:24,508 - INFO - orders - [PERF] Order processing: 0.1097s
2025-07-25 02:35:24,549 - INFO - orders - [PERF] Order creation: 0.0406s
2025-07-25 02:35:24,550 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-25 02:35:24,550 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-25 02:35:24,550 - INFO - orders - [PERF] TOTAL place_order: 0.1691s
2025-07-25 02:35:24,583 - INFO - orders - Background balance/margin cache updated for user 31: balance=5000.00000000, margin=0.0
2025-07-25 02:35:24,602 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-25 02:35:24,978 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 31
2025-07-25 02:35:26,343 - INFO - orders - Order placement request received - User: 31, Symbol: AUDJPY, Type: SELL
2025-07-25 02:35:26,357 - INFO - orders - [PERF] Step: Extract order details: 0.0000s
2025-07-25 02:35:26,361 - INFO - orders - [PERF] Step: Fetch user data: 0.0039s
2025-07-25 02:35:26,362 - INFO - orders - [PERF] Step: Prepare async tasks: 0.0045s
2025-07-25 02:35:26,378 - INFO - orders - [PERF] Individual async task 'external_symbol_info' took 0.0133s
2025-07-25 02:35:26,379 - INFO - orders - [PERF] Individual async task 'batch_cache_data' took 0.0155s
2025-07-25 02:35:26,382 - INFO - orders - [PERF] Individual async task 'raw_market_data' took 0.0127s
2025-07-25 02:35:26,389 - INFO - orders - [PERF] Individual async task 'open_orders' took 0.0190s
2025-07-25 02:35:26,409 - INFO - orders - [PERF] Individual async task 'order_id' took 0.0363s
2025-07-25 02:35:26,410 - INFO - orders - [PERF] Step: Await all async tasks: 0.0479s
2025-07-25 02:35:26,412 - INFO - orders - [PERF] Step: Extract and post-process async results: 0.0000s
2025-07-25 02:35:26,413 - INFO - orders - [PERF] Step: Validate critical data: 0.0000s
2025-07-25 02:35:26,413 - INFO - orders - [PERF] Step: Fetch group settings: 0.0000s
2025-07-25 02:35:26,413 - INFO - orders - [MARGIN_CALC] Market data for AUDJPY: {'b': Decimal('97.0130000000'), 'o': Decimal('97.0070000000')}
2025-07-25 02:35:26,413 - WARNING - orders - [MARGIN_CALC] Missing ask price for AUDJPY, using bid price with spread: bid=97.0130000000, ask=97.02270130000000
2025-07-25 02:35:26,414 - INFO - orders - [MARGIN_CALC] Using prices for AUDJPY: bid=97.0130000000, ask=97.02270130000000
2025-07-25 02:35:26,421 - INFO - orders - [CURRENCY_CONVERT] Starting conversion of 970.13 JPY to USD for margin_calculation (user_id: 31, position: None)
2025-07-25 02:35:26,422 - INFO - orders - [CURRENCY_CONVERT] Trying direct conversion with symbol: JPYUSD
2025-07-25 02:35:26,425 - INFO - orders - [CURRENCY_CONVERT] Direct conversion prices from cache: None
2025-07-25 02:35:26,426 - INFO - orders - [CURRENCY_CONVERT] No direct conversion rate found for JPYUSD, trying inverse
2025-07-25 02:35:26,426 - INFO - orders - [CURRENCY_CONVERT] Trying inverse conversion with symbol: USDJPY
2025-07-25 02:35:26,429 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion prices from cache: {'b': Decimal('147.8190000000'), 'o': Decimal('147.8160000000')}
2025-07-25 02:35:26,429 - INFO - orders - [CURRENCY_CONVERT] Found inverse conversion rate (bid): 147.8190000000
2025-07-25 02:35:26,430 - INFO - orders - [CURRENCY_CONVERT] Inverse conversion successful: 970.13 JPY / 147.8190000000 = 6.562958753610834872377705166 USD
2025-07-25 02:35:26,430 - INFO - orders - [MARGIN_CALC_OPTIMIZED] Symbol: AUDJPY, Type: SELL, Qty: 0.01, Price: 97.0130000000, Margin: 6.562958753610834872377705166, Commission: 0.10
2025-07-25 02:35:26,430 - INFO - orders - [PERF] Step: Margin calculation: 0.0166s
2025-07-25 02:35:26,430 - INFO - orders - [MARGIN_TOTAL_CONTRIB] No open positions for User 31, Symbol AUDJPY. Returning zero margin.
2025-07-25 02:35:26,431 - INFO - orders - [MARGIN_TOTAL_CONTRIB] Calculating margin for 1 positions for User 31, Symbol AUDJPY
2025-07-25 02:35:26,431 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 31, Symbol AUDJPY: TotalBuyQty=0, TotalSellQty=0.01, NetQty=0.01, IsHedged=False
2025-07-25 02:35:26,431 - INFO - orders - [MARGIN_TOTAL_CONTRIB_CALC] User 31, Symbol AUDJPY: AllMarginsPerLot=[Decimal('656.2958753610834872377705166')], HighestMarginPerLot=656.2958753610834872377705166
2025-07-25 02:35:26,431 - INFO - orders - [MARGIN_TOTAL_CONTRIB_EXIT] User 31, Symbol AUDJPY: CalculatedTotalMargin=6.56
2025-07-25 02:35:26,432 - INFO - orders - [PERF] Step: Hedged margin calculation: 0.0020s
2025-07-25 02:35:26,432 - INFO - orders - [PERF] Step: User lock and margin update: 0.0000s
2025-07-25 02:35:26,432 - INFO - orders - [PERF] Step: Prepare result dict: 0.0000s
2025-07-25 02:35:26,432 - INFO - orders - [PERF] TOTAL process_new_order_ultra_optimized: 0.0754s
2025-07-25 02:35:26,432 - INFO - orders - [PERF] Order processing: 0.0756s
2025-07-25 02:35:26,466 - INFO - orders - [PERF] Order creation: 0.0327s
2025-07-25 02:35:26,466 - INFO - orders - is_barclays_live_user in place_order: True
2025-07-25 02:35:26,466 - INFO - orders - [BARCLAYS] Scheduling barclays_push in place_order
2025-07-25 02:35:26,467 - INFO - orders - [PERF] TOTAL place_order: 0.1304s
2025-07-25 02:35:26,515 - INFO - orders - Background balance/margin cache updated for user 31: balance=5000.00000000, margin=0.0
2025-07-25 02:35:26,544 - INFO - orders - [BARCLAYS] barclays_push called in place_order
2025-07-25 02:35:26,871 - INFO - orders - [PUBLISH_ASYNC] Triggering websocket updates for user 31
